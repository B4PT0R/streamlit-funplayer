!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FunPlayer={})}(this,function(e){"use strict";var t=Object.defineProperty,i=(e,i,n)=>((e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n)(e,"symbol"!=typeof i?i+"":i,n);function n(e,t){for(var i=0;i<t.length;i++){const n=t[i];if("string"!=typeof n&&!Array.isArray(n))for(const t in n)if("default"!==t&&!(t in e)){const i=Object.getOwnPropertyDescriptor(n,t);i&&Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>n[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}if(void 0===globalThis.EventTarget){class e{constructor(){this._listeners=new Map}addEventListener(e,t,i){this._listeners.has(e)||this._listeners.set(e,new Set),this._listeners.get(e).add(t)}removeEventListener(e,t){this._listeners.has(e)&&this._listeners.get(e).delete(t)}dispatchEvent(e){return this._listeners.has(e.type)&&this._listeners.get(e.type).forEach(t=>{"function"==typeof t?t.call(this,e):t&&"function"==typeof t.handleEvent&&t.handleEvent(e)}),!0}on(e,t){this.addEventListener(e,t)}off(e,t){this.removeEventListener(e,t)}emit(e,...t){const i={type:e,detail:t};this.dispatchEvent(i)}}globalThis.EventTarget=e,"undefined"!=typeof window&&(window.EventTarget=e)}void 0===globalThis.process&&(globalThis.process={env:{NODE_ENV:"production"},nextTick:e=>setTimeout(e,0),version:"v16.0.0"}),void 0===globalThis.Buffer&&(globalThis.Buffer={from:e=>new Uint8Array(e),isBuffer:()=>!1});var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var i=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),i}var o,l,u={exports:{}},c={};function h(){if(o)return c;o=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function v(){}function _(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var b=_.prototype=new v;b.constructor=_,m(b,y.prototype),b.isPureReactComponent=!0;var T=Array.isArray,S=Object.prototype.hasOwnProperty,w={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function A(t,i,n){var r,s={},a=null,o=null;if(null!=i)for(r in void 0!==i.ref&&(o=i.ref),void 0!==i.key&&(a=""+i.key),i)S.call(i,r)&&!x.hasOwnProperty(r)&&(s[r]=i[r]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];s.children=u}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:e,type:t,key:a,ref:o,props:s,_owner:w.current}}function E(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var C=/\/+/g;function M(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function k(i,n,r,s,a){var o=typeof i;"undefined"!==o&&"boolean"!==o||(i=null);var l=!1;if(null===i)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(i.$$typeof){case e:case t:l=!0}}if(l)return a=a(l=i),i=""===s?"."+M(l,0):s,T(a)?(r="",null!=i&&(r=i.replace(C,"$&/")+"/"),k(a,n,r,"",function(e){return e})):null!=a&&(E(a)&&(a=function(t,i){return{$$typeof:e,type:t.type,key:i,ref:t.ref,props:t.props,_owner:t._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+i)),n.push(a)),1;if(l=0,s=""===s?".":s+":",T(i))for(var u=0;u<i.length;u++){var c=s+M(o=i[u],u);l+=k(o,n,r,c,a)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(i),"function"==typeof c)for(i=c.call(i),u=0;!(o=i.next()).done;)l+=k(o=o.value,n,r,c=s+M(o,u++),a);else if("object"===o)throw n=String(i),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(i).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,i){if(null==e)return e;var n=[],r=0;return k(e,n,"","",function(e){return t.call(i,e,r++)}),n}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},D={transition:null},O={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:D,ReactCurrentOwner:w};function R(){throw Error("act(...) is not supported in production builds of React.")}return c.Children={map:I,forEach:function(e,t,i){I(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},c.Component=y,c.Fragment=i,c.Profiler=r,c.PureComponent=_,c.StrictMode=n,c.Suspense=u,c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,c.act=R,c.cloneElement=function(t,i,n){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),s=t.key,a=t.ref,o=t._owner;if(null!=i){if(void 0!==i.ref&&(a=i.ref,o=w.current),void 0!==i.key&&(s=""+i.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(u in i)S.call(i,u)&&!x.hasOwnProperty(u)&&(r[u]=void 0===i[u]&&void 0!==l?l[u]:i[u])}var u=arguments.length-2;if(1===u)r.children=n;else if(1<u){l=Array(u);for(var c=0;c<u;c++)l[c]=arguments[c+2];r.children=l}return{$$typeof:e,type:t.type,key:s,ref:a,props:r,_owner:o}},c.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},c.createElement=A,c.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},c.createRef=function(){return{current:null}},c.forwardRef=function(e){return{$$typeof:l,render:e}},c.isValidElement=E,c.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},c.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},c.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},c.unstable_act=R,c.useCallback=function(e,t){return L.current.useCallback(e,t)},c.useContext=function(e){return L.current.useContext(e)},c.useDebugValue=function(){},c.useDeferredValue=function(e){return L.current.useDeferredValue(e)},c.useEffect=function(e,t){return L.current.useEffect(e,t)},c.useId=function(){return L.current.useId()},c.useImperativeHandle=function(e,t,i){return L.current.useImperativeHandle(e,t,i)},c.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},c.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},c.useMemo=function(e,t){return L.current.useMemo(e,t)},c.useReducer=function(e,t,i){return L.current.useReducer(e,t,i)},c.useRef=function(e){return L.current.useRef(e)},c.useState=function(e){return L.current.useState(e)},c.useSyncExternalStore=function(e,t,i){return L.current.useSyncExternalStore(e,t,i)},c.useTransition=function(){return L.current.useTransition()},c.version="18.3.1",c}function d(){return l||(l=1,u.exports=h()),u.exports}var p=d();const f=s(p);var m,g,y,v,_,b={},T={exports:{}},S={},w={exports:{}},x={};function A(){return g||(g=1,w.exports=(m||(m=1,function(e){function t(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,s=e[n];if(!(0<r(s,t)))break e;e[n]=t,e[i]=s,i=n}}function i(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,s=e.length,a=s>>>1;n<a;){var o=2*(n+1)-1,l=e[o],u=o+1,c=e[u];if(0>r(l,i))u<s&&0>r(c,l)?(e[n]=c,e[u]=i,n=u):(e[n]=l,e[o]=i,n=o);else{if(!(u<s&&0>r(c,i)))break e;e[n]=c,e[u]=i,n=u}}}return t}function r(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,d=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var r=i(u);null!==r;){if(null===r.callback)n(u);else{if(!(r.startTime<=e))break;n(u),r.sortIndex=r.expirationTime,t(l,r)}r=i(u)}}function b(e){if(m=!1,_(e),!f)if(null!==i(l))f=!0,L(T);else{var t=i(u);null!==t&&D(b,t.startTime-e)}}function T(t,r){f=!1,m&&(m=!1,y(A),A=-1),p=!0;var s=d;try{for(_(r),h=i(l);null!==h&&(!(h.expirationTime>r)||t&&!M());){var a=h.callback;if("function"==typeof a){h.callback=null,d=h.priorityLevel;var o=a(h.expirationTime<=r);r=e.unstable_now(),"function"==typeof o?h.callback=o:h===i(l)&&n(l),_(r)}else n(l);h=i(l)}if(null!==h)var c=!0;else{var g=i(u);null!==g&&D(b,g.startTime-r),c=!1}return c}finally{h=null,d=s,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,w=!1,x=null,A=-1,E=5,C=-1;function M(){return!(e.unstable_now()-C<E)}function k(){if(null!==x){var t=e.unstable_now();C=t;var i=!0;try{i=x(!0,t)}finally{i?S():(w=!1,x=null)}}else w=!1}if("function"==typeof v)S=function(){v(k)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=k,S=function(){P.postMessage(null)}}else S=function(){g(k,0)};function L(e){x=e,w||(w=!0,S())}function D(t,i){A=g(function(){t(e.unstable_now())},i)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,L(T))},e.unstable_forceFrameRate=function(e){0>e||125<e||(E=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var i=d;d=t;try{return e()}finally{d=i}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=d;d=e;try{return t()}finally{d=i}},e.unstable_scheduleCallback=function(n,r,s){var a=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,n){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return n={id:c++,callback:r,priorityLevel:n,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(n.sortIndex=s,t(u,n),null===i(l)&&n===i(u)&&(m?(y(A),A=-1):m=!0,D(b,s-a))):(n.sortIndex=o,t(l,n),f||p||(f=!0,L(T))),n},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(e){var t=d;return function(){var i=d;d=t;try{return e.apply(this,arguments)}finally{d=i}}}}(x)),x)),w.exports}function E(){if(y)return S;y=1;var e=d(),t=A();function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function s(e,t){a(e,t),a(e+"Capture",t)}function a(e,t){for(r[e]=t,e=0;e<t.length;e++)n.add(t[e])}var o=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function p(e,t,i,n,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){f[e]=new p(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];f[t]=new p(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){f[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){f[e]=new p(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){f[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){f[e]=new p(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){f[e]=new p(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){f[e]=new p(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){f[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)});var m=/[\-:]([a-z])/g;function g(e){return e[1].toUpperCase()}function v(e,t,i,n){var r=f.hasOwnProperty(t)?f[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null==t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!l.call(h,e)||!l.call(c,e)&&(u.test(e)?h[e]=!0:(c[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(m,g);f[t]=new p(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(m,g);f[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(m,g);f[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){f[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)}),f.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){f[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)});var _=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),T=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),M=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),O=Symbol.for("react.offscreen"),R=Symbol.iterator;function N(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=R&&e[R]||e["@@iterator"])?e:null}var F,U=Object.assign;function B(e){if(void 0===F)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var j=!1;function z(e,t){if(!e||j)return"";j=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&"string"==typeof u.stack){for(var r=u.stack.split("\n"),s=n.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{j=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?B(e):""}function V(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case w:return"Fragment";case T:return"Portal";case E:return"Profiler";case x:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case L:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return H(e(t))}catch(i){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===x?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function $(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=W(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function Y(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(Le){return e.body}}function Q(e,t){var i=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function K(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=G(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function J(e,t){Z(e,t);var i=G(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?te(e,t.type,i):t.hasOwnProperty("defaultValue")&&te(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ee(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function te(e,t,i){"number"===t&&Y(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var ie=Array.isArray;function ne(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+G(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(ie(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ae(e,t){var i=G(t.value),n=G(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,he,de=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction(function(){return he(e,t)})}:he);function pe(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function ge(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ye(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=ge(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(fe).forEach(function(e){me.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _e(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Te=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,xe=null,Ae=null;function Ee(e){if(e=Tr(e)){if("function"!=typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=wr(t),we(e.stateNode,e.type,t))}}function Ce(e){xe?Ae?Ae.push(e):Ae=[e]:xe=e}function Me(){if(xe){var e=xe,t=Ae;if(Ae=xe=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function ke(e,t){return e(t)}function Ie(){}var Pe=!1;function De(e,t,i){if(Pe)return e(t,i);Pe=!0;try{return ke(e,t,i)}finally{Pe=!1,(null!==xe||null!==Ae)&&(Ie(),Me())}}function Oe(e,t){var n=e.stateNode;if(null===n)return null;var r=wr(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(i(231,t,typeof n));return n}var Re=!1;if(o)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Re=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(he){Re=!1}function Fe(e,t,i,n,r,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(i,u)}catch(c){this.onError(c)}}var Ue=!1,Be=null,je=!1,ze=null,Ve={onError:function(e){Ue=!0,Be=e}};function He(e,t,i,n,r,s,a,o,l){Ue=!1,Be=null,Fe.apply(Ve,arguments)}function qe(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(qe(e)!==e)throw Error(i(188))}function $e(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var s=n.return;if(null===s)break;var a=s.alternate;if(null===a){if(null!==(r=s.return)){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return We(s),e;if(a===r)return We(s),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=s,r=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?Xe(e):null}function Xe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Xe(e);if(null!==t)return t;e=e.sibling}return null}var Ye=t.unstable_scheduleCallback,Qe=t.unstable_cancelCallback,Ke=t.unstable_shouldYield,Ze=t.unstable_requestPaint,Je=t.unstable_now,et=t.unstable_getCurrentPriorityLevel,tt=t.unstable_ImmediatePriority,it=t.unstable_UserBlockingPriority,nt=t.unstable_NormalPriority,rt=t.unstable_LowPriority,st=t.unstable_IdlePriority,at=null,ot=null;var lt=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ut(e)/ct|0)|0},ut=Math.log,ct=Math.LN2;var ht=64,dt=4194304;function pt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&i;if(0!==a){var o=a&~r;0!==o?n=pt(o):0!==(s&=a)&&(n=pt(s))}else 0!==(a=i&~r)?n=pt(a):0!==s&&(n=pt(s));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(s=t&-t)||16===r&&4194240&s))return t;if(4&n&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-lt(t)),n|=e[i],t&=~r;return n}function mt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function yt(){var e=ht;return!(4194240&(ht<<=1))&&(ht=64),e}function vt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function _t(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-lt(t)]=i}function bt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-lt(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var Tt=0;function St(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var wt,xt,At,Et,Ct,Mt=!1,kt=[],It=null,Pt=null,Lt=null,Dt=new Map,Ot=new Map,Rt=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ft(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Lt=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function Ut(e,t,i,n,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=Tr(t))&&xt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Bt(e){var t=br(e.target);if(null!==t){var i=qe(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ge(i)))return e.blockedOn=t,void Ct(e.priority,function(){At(i)})}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function jt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=Tr(i))&&xt(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);Te=n,i.target.dispatchEvent(n),Te=null,t.shift()}return!0}function zt(e,t,i){jt(e)&&i.delete(t)}function Vt(){Mt=!1,null!==It&&jt(It)&&(It=null),null!==Pt&&jt(Pt)&&(Pt=null),null!==Lt&&jt(Lt)&&(Lt=null),Dt.forEach(zt),Ot.forEach(zt)}function Ht(e,i){e.blockedOn===i&&(e.blockedOn=null,Mt||(Mt=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Vt)))}function qt(e){function t(t){return Ht(t,e)}if(0<kt.length){Ht(kt[0],e);for(var i=1;i<kt.length;i++){var n=kt[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==It&&Ht(It,e),null!==Pt&&Ht(Pt,e),null!==Lt&&Ht(Lt,e),Dt.forEach(t),Ot.forEach(t),i=0;i<Rt.length;i++)(n=Rt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<Rt.length&&null===(i=Rt[0]).blockedOn;)Bt(i),null===i.blockedOn&&Rt.shift()}var Gt=_.ReactCurrentBatchConfig,Wt=!0;function $t(e,t,i,n){var r=Tt,s=Gt.transition;Gt.transition=null;try{Tt=1,Yt(e,t,i,n)}finally{Tt=r,Gt.transition=s}}function Xt(e,t,i,n){var r=Tt,s=Gt.transition;Gt.transition=null;try{Tt=4,Yt(e,t,i,n)}finally{Tt=r,Gt.transition=s}}function Yt(e,t,i,n){if(Wt){var r=Kt(e,t,i,n);if(null===r)Wn(e,t,n,Qt,i),Ft(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return It=Ut(It,e,t,i,n,r),!0;case"dragenter":return Pt=Ut(Pt,e,t,i,n,r),!0;case"mouseover":return Lt=Ut(Lt,e,t,i,n,r),!0;case"pointerover":var s=r.pointerId;return Dt.set(s,Ut(Dt.get(s)||null,e,t,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,Ot.set(s,Ut(Ot.get(s)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Ft(e,n),4&t&&-1<Nt.indexOf(e)){for(;null!==r;){var s=Tr(r);if(null!==s&&wt(s),null===(s=Kt(e,t,i,n))&&Wn(e,t,n,Qt,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else Wn(e,t,n,null,i)}}var Qt=null;function Kt(e,t,i,n){if(Qt=null,null!==(e=br(e=Se(n))))if(null===(t=qe(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Zt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(et()){case tt:return 1;case it:return 4;case nt:case rt:return 16;case st:return 536870912;default:return 16}default:return 16}}var Jt=null,ei=null,ti=null;function ii(){if(ti)return ti;var e,t,i=ei,n=i.length,r="value"in Jt?Jt.value:Jt.textContent,s=r.length;for(e=0;e<n&&i[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&i[n-t]===r[s-t];t++);return ti=r.slice(e,1<t?1-t:void 0)}function ni(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ri(){return!0}function si(){return!1}function ai(e){function t(t,i,n,r,s){for(var a in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ri:si,this.isPropagationStopped=si,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ri)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ri)},persist:function(){},isPersistent:ri}),t}var oi,li,ui,ci={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hi=ai(ci),di=U({},ci,{view:0,detail:0}),pi=ai(di),fi=U({},di,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ei,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ui&&(ui&&"mousemove"===e.type?(oi=e.screenX-ui.screenX,li=e.screenY-ui.screenY):li=oi=0,ui=e),oi)},movementY:function(e){return"movementY"in e?e.movementY:li}}),mi=ai(fi),gi=ai(U({},fi,{dataTransfer:0})),yi=ai(U({},di,{relatedTarget:0})),vi=ai(U({},ci,{animationName:0,elapsedTime:0,pseudoElement:0})),_i=U({},ci,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bi=ai(_i),Ti=ai(U({},ci,{data:0})),Si={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ai(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xi[e])&&!!t[e]}function Ei(){return Ai}var Ci=U({},di,{key:function(e){if(e.key){var t=Si[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ni(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ei,charCode:function(e){return"keypress"===e.type?ni(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ni(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mi=ai(Ci),ki=ai(U({},fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ii=ai(U({},di,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ei})),Pi=ai(U({},ci,{propertyName:0,elapsedTime:0,pseudoElement:0})),Li=U({},fi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Di=ai(Li),Oi=[9,13,27,32],Ri=o&&"CompositionEvent"in window,Ni=null;o&&"documentMode"in document&&(Ni=document.documentMode);var Fi=o&&"TextEvent"in window&&!Ni,Ui=o&&(!Ri||Ni&&8<Ni&&11>=Ni),Bi=String.fromCharCode(32),ji=!1;function zi(e,t){switch(e){case"keyup":return-1!==Oi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vi(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Hi=!1;var qi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qi[e.type]:"textarea"===t}function Wi(e,t,i,n){Ce(n),0<(t=Xn(t,"onChange")).length&&(i=new hi("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var $i=null,Xi=null;function Yi(e){jn(e,0)}function Qi(e){if(X(Sr(e)))return e}function Ki(e,t){if("change"===e)return t}var Zi=!1;if(o){var Ji;if(o){var en="oninput"in document;if(!en){var tn=document.createElement("div");tn.setAttribute("oninput","return;"),en="function"==typeof tn.oninput}Ji=en}else Ji=!1;Zi=Ji&&(!document.documentMode||9<document.documentMode)}function nn(){$i&&($i.detachEvent("onpropertychange",rn),Xi=$i=null)}function rn(e){if("value"===e.propertyName&&Qi(Xi)){var t=[];Wi(t,Xi,e,Se(e)),De(Yi,t)}}function sn(e,t,i){"focusin"===e?(nn(),Xi=i,($i=t).attachEvent("onpropertychange",rn)):"focusout"===e&&nn()}function an(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qi(Xi)}function on(e,t){if("click"===e)return Qi(t)}function ln(e,t){if("input"===e||"change"===e)return Qi(t)}var un="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function cn(e,t){if(un(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!l.call(t,r)||!un(e[r],t[r]))return!1}return!0}function hn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dn(e,t){var i,n=hn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hn(n)}}function pn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fn(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=Y((e=t.contentWindow).document)}return t}function mn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gn(e){var t=fn(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&pn(i.ownerDocument.documentElement,i)){if(null!==n&&mn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!e.extend&&s>n&&(r=n,n=s,s=r),r=dn(i,s);var a=dn(i,n);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var yn=o&&"documentMode"in document&&11>=document.documentMode,vn=null,_n=null,bn=null,Tn=!1;function Sn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;Tn||null==vn||vn!==Y(n)||("selectionStart"in(n=vn)&&mn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},bn&&cn(bn,n)||(bn=n,0<(n=Xn(_n,"onSelect")).length&&(t=new hi("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=vn)))}function wn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var xn={animationend:wn("Animation","AnimationEnd"),animationiteration:wn("Animation","AnimationIteration"),animationstart:wn("Animation","AnimationStart"),transitionend:wn("Transition","TransitionEnd")},An={},En={};function Cn(e){if(An[e])return An[e];if(!xn[e])return e;var t,i=xn[e];for(t in i)if(i.hasOwnProperty(t)&&t in En)return An[e]=i[t];return e}o&&(En=document.createElement("div").style,"AnimationEvent"in window||(delete xn.animationend.animation,delete xn.animationiteration.animation,delete xn.animationstart.animation),"TransitionEvent"in window||delete xn.transitionend.transition);var Mn=Cn("animationend"),kn=Cn("animationiteration"),In=Cn("animationstart"),Pn=Cn("transitionend"),Ln=new Map,Dn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function On(e,t){Ln.set(e,t),s(t,[e])}for(var Rn=0;Rn<Dn.length;Rn++){var Nn=Dn[Rn];On(Nn.toLowerCase(),"on"+(Nn[0].toUpperCase()+Nn.slice(1)))}On(Mn,"onAnimationEnd"),On(kn,"onAnimationIteration"),On(In,"onAnimationStart"),On("dblclick","onDoubleClick"),On("focusin","onFocus"),On("focusout","onBlur"),On(Pn,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Un=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fn));function Bn(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,s,a,o,l,u){if(He.apply(this,arguments),Ue){if(!Ue)throw Error(i(198));var c=Be;Ue=!1,Be=null,je||(je=!0,ze=c)}}(r,t,void 0,e),e.currentTarget=null}function jn(e,t){t=!!(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Bn(r,o,u),s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,u=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Bn(r,o,u),s=l}}}if(je)throw e=ze,je=!1,ze=null,e}function zn(e,t){var i=t[yr];void 0===i&&(i=t[yr]=new Set);var n=e+"__bubble";i.has(n)||(Gn(t,e,2,!1),i.add(n))}function Vn(e,t,i){var n=0;t&&(n|=4),Gn(i,e,n,t)}var Hn="_reactListening"+Math.random().toString(36).slice(2);function qn(e){if(!e[Hn]){e[Hn]=!0,n.forEach(function(t){"selectionchange"!==t&&(Un.has(t)||Vn(t,!1,e),Vn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hn]||(t[Hn]=!0,Vn("selectionchange",!1,t))}}function Gn(e,t,i,n){switch(Zt(t)){case 1:var r=$t;break;case 4:r=Xt;break;default:r=Yt}i=r.bind(null,t,i,e),r=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Wn(e,t,i,n,r){var s=n;if(!(1&t||2&t||null===n))e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=br(o)))return;if(5===(l=a.tag)||6===l){n=s=a;continue e}o=o.parentNode}}n=n.return}De(function(){var n=s,r=Se(i),a=[];e:{var o=Ln.get(e);if(void 0!==o){var l=hi,u=e;switch(e){case"keypress":if(0===ni(i))break e;case"keydown":case"keyup":l=Mi;break;case"focusin":u="focus",l=yi;break;case"focusout":u="blur",l=yi;break;case"beforeblur":case"afterblur":l=yi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Ii;break;case Mn:case kn:case In:l=vi;break;case Pn:l=Pi;break;case"scroll":l=pi;break;case"wheel":l=Di;break;case"copy":case"cut":case"paste":l=bi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=ki}var c=!!(4&t),h=!c&&"scroll"===e,d=c?null!==o?o+"Capture":null:o;c=[];for(var p,f=n;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Oe(f,d))&&c.push($n(f,m,p)))),h)break;f=f.return}0<c.length&&(o=new l(o,u,null,i,r),a.push({event:o,listeners:c}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||i===Te||!(u=i.relatedTarget||i.fromElement)||!br(u)&&!u[gr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(u=(u=i.relatedTarget||i.toElement)?br(u):null)&&(u!==(h=qe(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=n),l!==u)){if(c=mi,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(c=ki,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?o:Sr(l),p=null==u?o:Sr(u),(o=new c(m,f+"leave",l,i,r)).target=h,o.relatedTarget=p,m=null,br(r)===n&&((c=new c(d,f+"enter",u,i,r)).target=p,c.relatedTarget=h,m=c),h=m,l&&u)e:{for(d=u,f=0,p=c=l;p;p=Yn(p))f++;for(p=0,m=d;m;m=Yn(m))p++;for(;0<f-p;)c=Yn(c),f--;for(;0<p-f;)d=Yn(d),p--;for(;f--;){if(c===d||null!==d&&c===d.alternate)break e;c=Yn(c),d=Yn(d)}c=null}else c=null;null!==l&&Qn(a,o,l,c,!1),null!==u&&null!==h&&Qn(a,h,u,c,!0)}if("select"===(l=(o=n?Sr(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Ki;else if(Gi(o))if(Zi)g=ln;else{g=an;var y=sn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=on);switch(g&&(g=g(e,n))?Wi(a,g,i,r):(y&&y(e,o,n),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&te(o,"number",o.value)),y=n?Sr(n):window,e){case"focusin":(Gi(y)||"true"===y.contentEditable)&&(vn=y,_n=n,bn=null);break;case"focusout":bn=_n=vn=null;break;case"mousedown":Tn=!0;break;case"contextmenu":case"mouseup":case"dragend":Tn=!1,Sn(a,i,r);break;case"selectionchange":if(yn)break;case"keydown":case"keyup":Sn(a,i,r)}var v;if(Ri)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Hi?zi(e,i)&&(_="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(_="onCompositionStart");_&&(Ui&&"ko"!==i.locale&&(Hi||"onCompositionStart"!==_?"onCompositionEnd"===_&&Hi&&(v=ii()):(ei="value"in(Jt=r)?Jt.value:Jt.textContent,Hi=!0)),0<(y=Xn(n,_)).length&&(_=new Ti(_,e,null,i,r),a.push({event:_,listeners:y}),v?_.data=v:null!==(v=Vi(i))&&(_.data=v))),(v=Fi?function(e,t){switch(e){case"compositionend":return Vi(t);case"keypress":return 32!==t.which?null:(ji=!0,Bi);case"textInput":return(e=t.data)===Bi&&ji?null:e;default:return null}}(e,i):function(e,t){if(Hi)return"compositionend"===e||!Ri&&zi(e,t)?(e=ii(),ti=ei=Jt=null,Hi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ui&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=Xn(n,"onBeforeInput")).length&&(r=new Ti("onBeforeInput","beforeinput",null,i,r),a.push({event:r,listeners:n}),r.data=v))}jn(a,t)})}function $n(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Xn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Oe(e,i))&&n.unshift($n(e,s,r)),null!=(s=Oe(e,t))&&n.push($n(e,s,r))),e=e.return}return n}function Yn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Qn(e,t,i,n,r){for(var s=t._reactName,a=[];null!==i&&i!==n;){var o=i,l=o.alternate,u=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==u&&(o=u,r?null!=(l=Oe(i,s))&&a.unshift($n(i,l,o)):r||null!=(l=Oe(i,s))&&a.push($n(i,l,o))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var Kn=/\r\n?/g,Zn=/\u0000|\uFFFD/g;function Jn(e){return("string"==typeof e?e:""+e).replace(Kn,"\n").replace(Zn,"")}function er(e,t,n){if(t=Jn(t),Jn(e)!==t&&n)throw Error(i(425))}function tr(){}var ir=null,nr=null;function rr(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var sr="function"==typeof setTimeout?setTimeout:void 0,ar="function"==typeof clearTimeout?clearTimeout:void 0,or="function"==typeof Promise?Promise:void 0,lr="function"==typeof queueMicrotask?queueMicrotask:void 0!==or?function(e){return or.resolve(null).then(e).catch(ur)}:sr;function ur(e){setTimeout(function(){throw e})}function cr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void qt(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);qt(t)}function hr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var pr=Math.random().toString(36).slice(2),fr="__reactFiber$"+pr,mr="__reactProps$"+pr,gr="__reactContainer$"+pr,yr="__reactEvents$"+pr,vr="__reactListeners$"+pr,_r="__reactHandles$"+pr;function br(e){var t=e[fr];if(t)return t;for(var i=e.parentNode;i;){if(t=i[gr]||i[fr]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=dr(e);null!==e;){if(i=e[fr])return i;e=dr(e)}return t}i=(e=i).parentNode}return null}function Tr(e){return!(e=e[fr]||e[gr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Sr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function wr(e){return e[mr]||null}var xr=[],Ar=-1;function Er(e){return{current:e}}function Cr(e){0>Ar||(e.current=xr[Ar],xr[Ar]=null,Ar--)}function Mr(e,t){Ar++,xr[Ar]=e.current,e.current=t}var kr={},Ir=Er(kr),Pr=Er(!1),Lr=kr;function Dr(e,t){var i=e.type.contextTypes;if(!i)return kr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in i)s[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Or(e){return null!=(e=e.childContextTypes)}function Rr(){Cr(Pr),Cr(Ir)}function Nr(e,t,n){if(Ir.current!==kr)throw Error(i(168));Mr(Ir,t),Mr(Pr,n)}function Fr(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var s in r=r.getChildContext())if(!(s in t))throw Error(i(108,q(e)||"Unknown",s));return U({},n,r)}function Ur(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||kr,Lr=Ir.current,Mr(Ir,e),Mr(Pr,Pr.current),!0}function Br(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Fr(e,t,Lr),r.__reactInternalMemoizedMergedChildContext=e,Cr(Pr),Cr(Ir),Mr(Ir,e)):Cr(Pr),Mr(Pr,n)}var jr=null,zr=!1,Vr=!1;function Hr(e){null===jr?jr=[e]:jr.push(e)}function qr(){if(!Vr&&null!==jr){Vr=!0;var e=0,t=Tt;try{var i=jr;for(Tt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}jr=null,zr=!1}catch(r){throw null!==jr&&(jr=jr.slice(e+1)),Ye(tt,qr),r}finally{Tt=t,Vr=!1}}return null}var Gr=[],Wr=0,$r=null,Xr=0,Yr=[],Qr=0,Kr=null,Zr=1,Jr="";function es(e,t){Gr[Wr++]=Xr,Gr[Wr++]=$r,$r=e,Xr=t}function ts(e,t,i){Yr[Qr++]=Zr,Yr[Qr++]=Jr,Yr[Qr++]=Kr,Kr=e;var n=Zr;e=Jr;var r=32-lt(n)-1;n&=~(1<<r),i+=1;var s=32-lt(t)+r;if(30<s){var a=r-r%5;s=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Zr=1<<32-lt(t)+r|i<<r|n,Jr=s+e}else Zr=1<<s|i<<r|n,Jr=e}function is(e){null!==e.return&&(es(e,1),ts(e,1,0))}function ns(e){for(;e===$r;)$r=Gr[--Wr],Gr[Wr]=null,Xr=Gr[--Wr],Gr[Wr]=null;for(;e===Kr;)Kr=Yr[--Qr],Yr[Qr]=null,Jr=Yr[--Qr],Yr[Qr]=null,Zr=Yr[--Qr],Yr[Qr]=null}var rs=null,ss=null,as=!1,os=null;function ls(e,t){var i=Lu(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function us(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,rs=e,ss=hr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,rs=e,ss=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Kr?{id:Zr,overflow:Jr}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Lu(18,null,null,0)).stateNode=t,i.return=e,e.child=i,rs=e,ss=null,!0);default:return!1}}function cs(e){return!(!(1&e.mode)||128&e.flags)}function hs(e){if(as){var t=ss;if(t){var n=t;if(!us(e,t)){if(cs(e))throw Error(i(418));t=hr(n.nextSibling);var r=rs;t&&us(e,t)?ls(r,n):(e.flags=-4097&e.flags|2,as=!1,rs=e)}}else{if(cs(e))throw Error(i(418));e.flags=-4097&e.flags|2,as=!1,rs=e}}}function ds(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;rs=e}function ps(e){if(e!==rs)return!1;if(!as)return ds(e),as=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!rr(e.type,e.memoizedProps)),t&&(t=ss)){if(cs(e))throw fs(),Error(i(418));for(;t;)ls(e,t),t=hr(t.nextSibling)}if(ds(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ss=hr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ss=null}}else ss=rs?hr(e.stateNode.nextSibling):null;return!0}function fs(){for(var e=ss;e;)e=hr(e.nextSibling)}function ms(){ss=rs=null,as=!1}function gs(e){null===os?os=[e]:os.push(e)}var ys=_.ReactCurrentBatchConfig;function vs(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var s=r,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=s.refs;null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function _s(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bs(e){return(0,e._init)(e._payload)}function Ts(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function n(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Ou(e,t)).index=0,e.sibling=null,e}function a(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Uu(i,e.mode,n)).return=e,t):((t=s(t,i)).return=e,t)}function u(e,t,i,n){var r=i.type;return r===w?h(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===D&&bs(r)===t.type)?((n=s(t,i.props)).ref=vs(e,t,i),n.return=e,n):((n=Ru(i.type,i.key,i.props,null,e.mode,n)).ref=vs(e,t,i),n.return=e,n)}function c(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Bu(i,e.mode,n)).return=e,t):((t=s(t,i.children||[])).return=e,t)}function h(e,t,i,n,r){return null===t||7!==t.tag?((t=Nu(i,e.mode,n,r)).return=e,t):((t=s(t,i)).return=e,t)}function d(e,t,i){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Uu(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case b:return(i=Ru(t.type,t.key,t.props,null,e.mode,i)).ref=vs(e,null,t),i.return=e,i;case T:return(t=Bu(t,e.mode,i)).return=e,t;case D:return d(e,(0,t._init)(t._payload),i)}if(ie(t)||N(t))return(t=Nu(t,e.mode,i,null)).return=e,t;_s(e,t)}return null}function p(e,t,i,n){var r=null!==t?t.key:null;if("string"==typeof i&&""!==i||"number"==typeof i)return null!==r?null:l(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case b:return i.key===r?u(e,t,i,n):null;case T:return i.key===r?c(e,t,i,n):null;case D:return p(e,t,(r=i._init)(i._payload),n)}if(ie(i)||N(i))return null!==r?null:h(e,t,i,n,null);_s(e,i)}return null}function f(e,t,i,n,r){if("string"==typeof n&&""!==n||"number"==typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case b:return u(t,e=e.get(null===n.key?i:n.key)||null,n,r);case T:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case D:return f(e,t,i,(0,n._init)(n._payload),r)}if(ie(n)||N(n))return h(t,e=e.get(i)||null,n,r,null);_s(t,n)}return null}return function l(u,c,h,m){if("object"==typeof h&&null!==h&&h.type===w&&null===h.key&&(h=h.props.children),"object"==typeof h&&null!==h){switch(h.$$typeof){case b:e:{for(var g=h.key,y=c;null!==y;){if(y.key===g){if((g=h.type)===w){if(7===y.tag){n(u,y.sibling),(c=s(y,h.props.children)).return=u,u=c;break e}}else if(y.elementType===g||"object"==typeof g&&null!==g&&g.$$typeof===D&&bs(g)===y.type){n(u,y.sibling),(c=s(y,h.props)).ref=vs(u,y,h),c.return=u,u=c;break e}n(u,y);break}t(u,y),y=y.sibling}h.type===w?((c=Nu(h.props.children,u.mode,m,h.key)).return=u,u=c):((m=Ru(h.type,h.key,h.props,null,u.mode,m)).ref=vs(u,c,h),m.return=u,u=m)}return o(u);case T:e:{for(y=h.key;null!==c;){if(c.key===y){if(4===c.tag&&c.stateNode.containerInfo===h.containerInfo&&c.stateNode.implementation===h.implementation){n(u,c.sibling),(c=s(c,h.children||[])).return=u,u=c;break e}n(u,c);break}t(u,c),c=c.sibling}(c=Bu(h,u.mode,m)).return=u,u=c}return o(u);case D:return l(u,c,(y=h._init)(h._payload),m)}if(ie(h))return function(i,s,o,l){for(var u=null,c=null,h=s,m=s=0,g=null;null!==h&&m<o.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(i,h,o[m],l);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(i,h),s=a(y,s,m),null===c?u=y:c.sibling=y,c=y,h=g}if(m===o.length)return n(i,h),as&&es(i,m),u;if(null===h){for(;m<o.length;m++)null!==(h=d(i,o[m],l))&&(s=a(h,s,m),null===c?u=h:c.sibling=h,c=h);return as&&es(i,m),u}for(h=r(i,h);m<o.length;m++)null!==(g=f(h,i,m,o[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=a(g,s,m),null===c?u=g:c.sibling=g,c=g);return e&&h.forEach(function(e){return t(i,e)}),as&&es(i,m),u}(u,c,h,m);if(N(h))return function(s,o,l,u){var c=N(l);if("function"!=typeof c)throw Error(i(150));if(null==(l=c.call(l)))throw Error(i(151));for(var h=c=null,m=o,g=o=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var _=p(s,m,v.value,u);if(null===_){null===m&&(m=y);break}e&&m&&null===_.alternate&&t(s,m),o=a(_,o,g),null===h?c=_:h.sibling=_,h=_,m=y}if(v.done)return n(s,m),as&&es(s,g),c;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(s,v.value,u))&&(o=a(v,o,g),null===h?c=v:h.sibling=v,h=v);return as&&es(s,g),c}for(m=r(s,m);!v.done;g++,v=l.next())null!==(v=f(m,s,g,v.value,u))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),o=a(v,o,g),null===h?c=v:h.sibling=v,h=v);return e&&m.forEach(function(e){return t(s,e)}),as&&es(s,g),c}(u,c,h,m);_s(u,h)}return"string"==typeof h&&""!==h||"number"==typeof h?(h=""+h,null!==c&&6===c.tag?(n(u,c.sibling),(c=s(c,h)).return=u,u=c):(n(u,c),(c=Uu(h,u.mode,m)).return=u,u=c),o(u)):n(u,c)}}var Ss=Ts(!0),ws=Ts(!1),xs=Er(null),As=null,Es=null,Cs=null;function Ms(){Cs=Es=As=null}function ks(e){var t=xs.current;Cr(xs),e._currentValue=t}function Is(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Ps(e,t){As=e,Cs=Es=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Ls(e){var t=e._currentValue;if(Cs!==e)if(e={context:e,memoizedValue:t,next:null},null===Es){if(null===As)throw Error(i(308));Es=e,As.dependencies={lanes:0,firstContext:e}}else Es=Es.next=e;return t}var Ds=null;function Os(e){null===Ds?Ds=[e]:Ds.push(e)}function Rs(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Os(t)):(i.next=r.next,r.next=i),t.interleaved=i,Ns(e,n)}function Ns(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Fs=!1;function Us(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function js(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zs(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,2&kl){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Ns(e,i)}return null===(r=n.interleaved)?(t.next=t,Os(n)):(t.next=r.next,r.next=t),n.interleaved=t,Ns(e,i)}function Vs(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,bt(e,i)}}function Hs(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?r=s=a:s=s.next=a,i=i.next}while(null!==i);null===s?r=s=t:s=s.next=t}else r=s=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function qs(e,t,i,n){var r=e.updateQueue;Fs=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,u=l.next;l.next=null,null===a?s=u:a.next=u,a=l;var c=e.alternate;null!==c&&((o=(c=c.updateQueue).lastBaseUpdate)!==a&&(null===o?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(null!==s){var h=r.baseState;for(a=0,c=u=l=null,o=s;;){var d=o.lane,p=o.eventTime;if((n&d)===d){null!==c&&(c=c.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(d=t,p=i,m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,h,d):f))break e;h=U({},h,d);break e;case 2:Fs=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(u=c=p,l=h):c=c.next=p,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(d=o).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===c&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Fl|=a,e.lanes=a,e.memoizedState=h}}function Gs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],s=r.callback;if(null!==s){if(r.callback=null,r=n,"function"!=typeof s)throw Error(i(191,s));s.call(r)}}}var Ws={},$s=Er(Ws),Xs=Er(Ws),Ys=Er(Ws);function Qs(e){if(e===Ws)throw Error(i(174));return e}function Ks(e,t){switch(Mr(Ys,t),Mr(Xs,e),Mr($s,Ws),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Cr($s),Mr($s,t)}function Zs(){Cr($s),Cr(Xs),Cr(Ys)}function Js(e){Qs(Ys.current);var t=Qs($s.current),i=ue(t,e.type);t!==i&&(Mr(Xs,e),Mr($s,i))}function ea(e){Xs.current===e&&(Cr($s),Cr(Xs))}var ta=Er(0);function ia(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ra(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var sa=_.ReactCurrentDispatcher,aa=_.ReactCurrentBatchConfig,oa=0,la=null,ua=null,ca=null,ha=!1,da=!1,pa=0,fa=0;function ma(){throw Error(i(321))}function ga(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!un(e[i],t[i]))return!1;return!0}function ya(e,t,n,r,s,a){if(oa=a,la=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sa.current=null===e||null===e.memoizedState?eo:to,e=n(r,s),da){a=0;do{if(da=!1,pa=0,25<=a)throw Error(i(301));a+=1,ca=ua=null,t.updateQueue=null,sa.current=io,e=n(r,s)}while(da)}if(sa.current=Ja,t=null!==ua&&null!==ua.next,oa=0,ca=ua=la=null,ha=!1,t)throw Error(i(300));return e}function va(){var e=0!==pa;return pa=0,e}function _a(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?la.memoizedState=ca=e:ca=ca.next=e,ca}function ba(){if(null===ua){var e=la.alternate;e=null!==e?e.memoizedState:null}else e=ua.next;var t=null===ca?la.memoizedState:ca.next;if(null!==t)ca=t,ua=e;else{if(null===e)throw Error(i(310));e={memoizedState:(ua=e).memoizedState,baseState:ua.baseState,baseQueue:ua.baseQueue,queue:ua.queue,next:null},null===ca?la.memoizedState=ca=e:ca=ca.next=e}return ca}function Ta(e,t){return"function"==typeof t?t(e):t}function Sa(e){var t=ba(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=ua,s=r.baseQueue,a=n.pending;if(null!==a){if(null!==s){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,n.pending=null}if(null!==s){a=s.next,r=r.baseState;var l=o=null,u=null,c=a;do{var h=c.lane;if((oa&h)===h)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=d,o=r):u=u.next=d,la.lanes|=h,Fl|=h}c=c.next}while(null!==c&&c!==a);null===u?o=r:u.next=l,un(r,t.memoizedState)||(bo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){s=e;do{a=s.lane,la.lanes|=a,Fl|=a,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wa(e){var t=ba(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,a=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{a=e(a,o.action),o=o.next}while(o!==s);un(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function xa(){}function Aa(e,t){var n=la,r=ba(),s=t(),a=!un(r.memoizedState,s);if(a&&(r.memoizedState=s,bo=!0),r=r.queue,Fa(Ma.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ca&&1&ca.memoizedState.tag){if(n.flags|=2048,La(9,Ca.bind(null,n,r,s,t),void 0,null),null===Il)throw Error(i(349));30&oa||Ea(n,t,s)}return s}function Ea(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=la.updateQueue)?(t={lastEffect:null,stores:null},la.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Ca(e,t,i,n){t.value=i,t.getSnapshot=n,ka(t)&&Ia(e)}function Ma(e,t,i){return i(function(){ka(t)&&Ia(e)})}function ka(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!un(e,i)}catch(n){return!0}}function Ia(e){var t=Ns(e,1);null!==t&&nu(t,e,1,-1)}function Pa(e){var t=_a();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ta,lastRenderedState:e},t.queue=e,e=e.dispatch=Ya.bind(null,la,e),[t.memoizedState,e]}function La(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=la.updateQueue)?(t={lastEffect:null,stores:null},la.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function Da(){return ba().memoizedState}function Oa(e,t,i,n){var r=_a();la.flags|=e,r.memoizedState=La(1|t,i,void 0,void 0===n?null:n)}function Ra(e,t,i,n){var r=ba();n=void 0===n?null:n;var s=void 0;if(null!==ua){var a=ua.memoizedState;if(s=a.destroy,null!==n&&ga(n,a.deps))return void(r.memoizedState=La(t,i,s,n))}la.flags|=e,r.memoizedState=La(1|t,i,s,n)}function Na(e,t){return Oa(8390656,8,e,t)}function Fa(e,t){return Ra(2048,8,e,t)}function Ua(e,t){return Ra(4,2,e,t)}function Ba(e,t){return Ra(4,4,e,t)}function ja(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function za(e,t,i){return i=null!=i?i.concat([e]):null,Ra(4,4,ja.bind(null,t,e),i)}function Va(){}function Ha(e,t){var i=ba();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&ga(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function qa(e,t){var i=ba();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&ga(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Ga(e,t,i){return 21&oa?(un(i,t)||(i=yt(),la.lanes|=i,Fl|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=i)}function Wa(e,t){var i=Tt;Tt=0!==i&&4>i?i:4,e(!0);var n=aa.transition;aa.transition={};try{e(!1),t()}finally{Tt=i,aa.transition=n}}function $a(){return ba().memoizedState}function Xa(e,t,i){var n=iu(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},Qa(e))Ka(t,i);else if(null!==(i=Rs(e,t,i,n))){nu(i,e,n,tu()),Za(i,t,n)}}function Ya(e,t,i){var n=iu(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(Qa(e))Ka(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,i);if(r.hasEagerState=!0,r.eagerState=o,un(o,a)){var l=t.interleaved;return null===l?(r.next=r,Os(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(u){}null!==(i=Rs(e,t,r,n))&&(nu(i,e,n,r=tu()),Za(i,t,n))}}function Qa(e){var t=e.alternate;return e===la||null!==t&&t===la}function Ka(e,t){da=ha=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Za(e,t,i){if(4194240&i){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,bt(e,i)}}var Ja={readContext:Ls,useCallback:ma,useContext:ma,useEffect:ma,useImperativeHandle:ma,useInsertionEffect:ma,useLayoutEffect:ma,useMemo:ma,useReducer:ma,useRef:ma,useState:ma,useDebugValue:ma,useDeferredValue:ma,useTransition:ma,useMutableSource:ma,useSyncExternalStore:ma,useId:ma,unstable_isNewReconciler:!1},eo={readContext:Ls,useCallback:function(e,t){return _a().memoizedState=[e,void 0===t?null:t],e},useContext:Ls,useEffect:Na,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,Oa(4194308,4,ja.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Oa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Oa(4,2,e,t)},useMemo:function(e,t){var i=_a();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=_a();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Xa.bind(null,la,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},_a().memoizedState=e},useState:Pa,useDebugValue:Va,useDeferredValue:function(e){return _a().memoizedState=e},useTransition:function(){var e=Pa(!1),t=e[0];return e=Wa.bind(null,e[1]),_a().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=la,s=_a();if(as){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Il)throw Error(i(349));30&oa||Ea(r,t,n)}s.memoizedState=n;var a={value:n,getSnapshot:t};return s.queue=a,Na(Ma.bind(null,r,a,e),[e]),r.flags|=2048,La(9,Ca.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=_a(),t=Il.identifierPrefix;if(as){var i=Jr;t=":"+t+"R"+(i=(Zr&~(1<<32-lt(Zr)-1)).toString(32)+i),0<(i=pa++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=fa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},to={readContext:Ls,useCallback:Ha,useContext:Ls,useEffect:Fa,useImperativeHandle:za,useInsertionEffect:Ua,useLayoutEffect:Ba,useMemo:qa,useReducer:Sa,useRef:Da,useState:function(){return Sa(Ta)},useDebugValue:Va,useDeferredValue:function(e){return Ga(ba(),ua.memoizedState,e)},useTransition:function(){return[Sa(Ta)[0],ba().memoizedState]},useMutableSource:xa,useSyncExternalStore:Aa,useId:$a,unstable_isNewReconciler:!1},io={readContext:Ls,useCallback:Ha,useContext:Ls,useEffect:Fa,useImperativeHandle:za,useInsertionEffect:Ua,useLayoutEffect:Ba,useMemo:qa,useReducer:wa,useRef:Da,useState:function(){return wa(Ta)},useDebugValue:Va,useDeferredValue:function(e){var t=ba();return null===ua?t.memoizedState=e:Ga(t,ua.memoizedState,e)},useTransition:function(){return[wa(Ta)[0],ba().memoizedState]},useMutableSource:xa,useSyncExternalStore:Aa,useId:$a,unstable_isNewReconciler:!1};function no(e,t){if(e&&e.defaultProps){for(var i in t=U({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function ro(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:U({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var so={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=tu(),r=iu(e),s=js(n,r);s.payload=t,null!=i&&(s.callback=i),null!==(t=zs(e,s,r))&&(nu(t,e,r,n),Vs(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=tu(),r=iu(e),s=js(n,r);s.tag=1,s.payload=t,null!=i&&(s.callback=i),null!==(t=zs(e,s,r))&&(nu(t,e,r,n),Vs(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=tu(),n=iu(e),r=js(i,n);r.tag=2,null!=t&&(r.callback=t),null!==(t=zs(e,r,n))&&(nu(t,e,n,i),Vs(t,e,n))}};function ao(e,t,i,n,r,s,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!cn(i,n)||!cn(r,s))}function oo(e,t,i){var n=!1,r=kr,s=t.contextType;return"object"==typeof s&&null!==s?s=Ls(s):(r=Or(t)?Lr:Ir.current,s=(n=null!=(n=t.contextTypes))?Dr(e,r):kr),t=new t(i,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=so,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function lo(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&so.enqueueReplaceState(t,t.state,null)}function uo(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs={},Us(e);var s=t.contextType;"object"==typeof s&&null!==s?r.context=Ls(s):(s=Or(t)?Lr:Ir.current,r.context=Dr(e,s)),r.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(ro(e,t,s,i),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&so.enqueueReplaceState(r,r.state,null),qs(e,i,r,n),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function co(e,t){try{var i="",n=t;do{i+=V(n),n=n.return}while(n);var r=i}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function ho(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}var po="function"==typeof WeakMap?WeakMap:Map;function fo(e,t,i){(i=js(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Gl||(Gl=!0,Wl=n)},i}function mo(e,t,i){(i=js(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(i.callback=function(){"function"!=typeof n&&(null===$l?$l=new Set([this]):$l.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function go(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new po;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=Eu.bind(null,e,t,i),t.then(e,e))}function yo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,i,n,r){return 1&e.mode?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=js(-1,1)).tag=2,zs(i,t,1))),i.lanes|=1),e)}var _o=_.ReactCurrentOwner,bo=!1;function To(e,t,i,n){t.child=null===e?ws(t,null,i,n):Ss(t,e.child,i,n)}function So(e,t,i,n,r){i=i.render;var s=t.ref;return Ps(t,r),n=ya(e,t,i,n,s,r),i=va(),null===e||bo?(as&&i&&is(t),t.flags|=1,To(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Go(e,t,r))}function wo(e,t,i,n,r){if(null===e){var s=i.type;return"function"!=typeof s||Du(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Ru(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,xo(e,t,s,n,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((i=null!==(i=i.compare)?i:cn)(a,n)&&e.ref===t.ref)return Go(e,t,r)}return t.flags|=1,(e=Ou(s,n)).ref=t.ref,e.return=t,t.child=e}function xo(e,t,i,n,r){if(null!==e){var s=e.memoizedProps;if(cn(s,n)&&e.ref===t.ref){if(bo=!1,t.pendingProps=n=s,0===(e.lanes&r))return t.lanes=e.lanes,Go(e,t,r);131072&e.flags&&(bo=!0)}}return Co(e,t,i,n,r)}function Ao(e,t,i){var n=t.pendingProps,r=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(1&t.mode){if(!(1073741824&i))return e=null!==s?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Mr(Ol,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:i,Mr(Ol,Dl),Dl|=n}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mr(Ol,Dl),Dl|=i;else null!==s?(n=s.baseLanes|i,t.memoizedState=null):n=i,Mr(Ol,Dl),Dl|=n;return To(e,t,r,i),t.child}function Eo(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,i,n,r){var s=Or(i)?Lr:Ir.current;return s=Dr(t,s),Ps(t,r),i=ya(e,t,i,n,s,r),n=va(),null===e||bo?(as&&n&&is(t),t.flags|=1,To(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Go(e,t,r))}function Mo(e,t,i,n,r){if(Or(i)){var s=!0;Ur(t)}else s=!1;if(Ps(t,r),null===t.stateNode)qo(e,t),oo(t,i,n),uo(t,i,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,u=i.contextType;"object"==typeof u&&null!==u?u=Ls(u):u=Dr(t,u=Or(i)?Lr:Ir.current);var c=i.getDerivedStateFromProps,h="function"==typeof c||"function"==typeof a.getSnapshotBeforeUpdate;h||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==n||l!==u)&&lo(t,a,n,u),Fs=!1;var d=t.memoizedState;a.state=d,qs(t,n,a,r),l=t.memoizedState,o!==n||d!==l||Pr.current||Fs?("function"==typeof c&&(ro(t,i,c,n),l=t.memoizedState),(o=Fs||ao(t,i,o,n,d,l,u))?(h||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=u,n=o):("function"==typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,Bs(e,t),o=t.memoizedProps,u=t.type===t.elementType?o:no(t.type,o),a.props=u,h=t.pendingProps,d=a.context,"object"==typeof(l=i.contextType)&&null!==l?l=Ls(l):l=Dr(t,l=Or(i)?Lr:Ir.current);var p=i.getDerivedStateFromProps;(c="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==h||d!==l)&&lo(t,a,n,l),Fs=!1,d=t.memoizedState,a.state=d,qs(t,n,a,r);var f=t.memoizedState;o!==h||d!==f||Pr.current||Fs?("function"==typeof p&&(ro(t,i,p,n),f=t.memoizedState),(u=Fs||ao(t,i,u,n,d,f,l)||!1)?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(n,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),a.props=n,a.state=f,a.context=l,n=u):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return ko(e,t,i,n,s,r)}function ko(e,t,i,n,r,s){Eo(e,t);var a=!!(128&t.flags);if(!n&&!a)return r&&Br(t,i,!1),Go(e,t,s);n=t.stateNode,_o.current=t;var o=a&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=Ss(t,e.child,null,s),t.child=Ss(t,null,o,s)):To(e,t,o,s),t.memoizedState=n.state,r&&Br(t,i,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Nr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Nr(0,t.context,!1),Ks(e,t.containerInfo)}function Po(e,t,i,n,r){return ms(),gs(r),t.flags|=256,To(e,t,i,n),t.child}var Lo,Do,Oo,Ro,No={dehydrated:null,treeContext:null,retryLane:0};function Fo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,n){var r,s=t.pendingProps,a=ta.current,o=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Mr(ta,1&a),null===e)return hs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},1&s||null===o?o=Fu(l,s,0,null):(o.childLanes=0,o.pendingProps=l),e=Nu(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Fo(n),t.memoizedState=No,e):Bo(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,s,a,o){if(n)return 256&t.flags?(t.flags&=-257,jo(e,t,o,r=ho(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,s=t.mode,r=Fu({mode:"visible",children:r.children},s,0,null),(a=Nu(a,s,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,1&t.mode&&Ss(t,e.child,null,o),t.child.memoizedState=Fo(o),t.memoizedState=No,a);if(!(1&t.mode))return jo(e,t,o,null);if("$!"===s.data){if(r=s.nextSibling&&s.nextSibling.dataset)var l=r.dgst;return r=l,jo(e,t,o,r=ho(a=Error(i(419)),r,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(r=Il)){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(r.suspendedLanes|o))?0:s)&&s!==a.retryLane&&(a.retryLane=s,Ns(e,s),nu(r,e,s,-1))}return gu(),jo(e,t,o,r=ho(Error(i(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Mu.bind(null,e),s._reactRetry=t,null):(e=a.treeContext,ss=hr(s.nextSibling),rs=t,as=!0,os=null,null!==e&&(Yr[Qr++]=Zr,Yr[Qr++]=Jr,Yr[Qr++]=Kr,Zr=e.id,Jr=e.overflow,Kr=t),t=Bo(t,r.children),t.flags|=4096,t)}(e,t,l,s,r,a,n);if(o){o=s.fallback,l=t.mode,r=(a=e.child).sibling;var u={mode:"hidden",children:s.children};return 1&l||t.child===a?(s=Ou(a,u)).subtreeFlags=14680064&a.subtreeFlags:((s=t.child).childLanes=0,s.pendingProps=u,t.deletions=null),null!==r?o=Ou(r,o):(o=Nu(o,l,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=null===(l=e.child.memoizedState)?Fo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=No,s}return e=(o=e.child).sibling,s=Ou(o,{mode:"visible",children:s.children}),!(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Bo(e,t){return(t=Fu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function jo(e,t,i,n){return null!==n&&gs(n),Ss(t,e.child,null,i),(e=Bo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Is(e.return,t,i)}function Vo(e,t,i,n,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function Ho(e,t,i){var n=t.pendingProps,r=n.revealOrder,s=n.tail;if(To(e,t,n.children,i),2&(n=ta.current))n=1&n|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,i,t);else if(19===e.tag)zo(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Mr(ta,n),1&t.mode)switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===ia(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Vo(t,!1,r,i,s);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ia(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Vo(t,!0,i,null,s);break;case"together":Vo(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function qo(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Go(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Ou(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ou(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wo(e,t){if(!as)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function $o(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function Xo(e,t,n){var s=t.pendingProps;switch(ns(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $o(t),null;case 1:case 17:return Or(t.type)&&Rr(),$o(t),null;case 3:return s=t.stateNode,Zs(),Cr(Pr),Cr(Ir),ra(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==e&&null!==e.child||(ps(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==os&&(ou(os),os=null))),Do(e,t),$o(t),null;case 5:ea(t);var a=Qs(Ys.current);if(n=t.type,null!==e&&null!=t.stateNode)Oo(e,t,n,s,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(null===t.stateNode)throw Error(i(166));return $o(t),null}if(e=Qs($s.current),ps(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[fr]=t,s[mr]=o,e=!!(1&t.mode),n){case"dialog":zn("cancel",s),zn("close",s);break;case"iframe":case"object":case"embed":zn("load",s);break;case"video":case"audio":for(a=0;a<Fn.length;a++)zn(Fn[a],s);break;case"source":zn("error",s);break;case"img":case"image":case"link":zn("error",s),zn("load",s);break;case"details":zn("toggle",s);break;case"input":K(s,o),zn("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},zn("invalid",s);break;case"textarea":se(s,o),zn("invalid",s)}for(var l in _e(n,o),a=null,o)if(o.hasOwnProperty(l)){var u=o[l];"children"===l?"string"==typeof u?s.textContent!==u&&(!0!==o.suppressHydrationWarning&&er(s.textContent,u,e),a=["children",u]):"number"==typeof u&&s.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&er(s.textContent,u,e),a=["children",""+u]):r.hasOwnProperty(l)&&null!=u&&"onScroll"===l&&zn("scroll",s)}switch(n){case"input":$(s),ee(s,o,!0);break;case"textarea":$(s),oe(s);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(s.onclick=tr)}s=a,t.updateQueue=s,null!==s&&(t.flags|=4)}else{l=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof s.is?e=l.createElement(n,{is:s.is}):(e=l.createElement(n),"select"===n&&(l=e,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):e=l.createElementNS(e,n),e[fr]=t,e[mr]=s,Lo(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,s),n){case"dialog":zn("cancel",e),zn("close",e),a=s;break;case"iframe":case"object":case"embed":zn("load",e),a=s;break;case"video":case"audio":for(a=0;a<Fn.length;a++)zn(Fn[a],e);a=s;break;case"source":zn("error",e),a=s;break;case"img":case"image":case"link":zn("error",e),zn("load",e),a=s;break;case"details":zn("toggle",e),a=s;break;case"input":K(e,s),a=Q(e,s),zn("invalid",e);break;case"option":default:a=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},a=U({},s,{value:void 0}),zn("invalid",e);break;case"textarea":se(e,s),a=re(e,s),zn("invalid",e)}for(o in _e(n,a),u=a)if(u.hasOwnProperty(o)){var c=u[o];"style"===o?ye(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&de(e,c):"children"===o?"string"==typeof c?("textarea"!==n||""!==c)&&pe(e,c):"number"==typeof c&&pe(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(r.hasOwnProperty(o)?null!=c&&"onScroll"===o&&zn("scroll",e):null!=c&&v(e,o,c,l))}switch(n){case"input":$(e),ee(e,s,!1);break;case"textarea":$(e),oe(e);break;case"option":null!=s.value&&e.setAttribute("value",""+G(s.value));break;case"select":e.multiple=!!s.multiple,null!=(o=s.value)?ne(e,!!s.multiple,o,!1):null!=s.defaultValue&&ne(e,!!s.multiple,s.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=tr)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return $o(t),null;case 6:if(e&&null!=t.stateNode)Ro(e,t,e.memoizedProps,s);else{if("string"!=typeof s&&null===t.stateNode)throw Error(i(166));if(n=Qs(Ys.current),Qs($s.current),ps(t)){if(s=t.stateNode,n=t.memoizedProps,s[fr]=t,(o=s.nodeValue!==n)&&null!==(e=rs))switch(e.tag){case 3:er(s.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&er(s.nodeValue,n,!!(1&e.mode))}o&&(t.flags|=4)}else(s=(9===n.nodeType?n:n.ownerDocument).createTextNode(s))[fr]=t,t.stateNode=s}return $o(t),null;case 13:if(Cr(ta),s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(as&&null!==ss&&1&t.mode&&!(128&t.flags))fs(),ms(),t.flags|=98560,o=!1;else if(o=ps(t),null!==s&&null!==s.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[fr]=t}else ms(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;$o(t),o=!1}else null!==os&&(ou(os),os=null),o=!0;if(!o)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((s=null!==s)!==(null!==e&&null!==e.memoizedState)&&s&&(t.child.flags|=8192,1&t.mode&&(null===e||1&ta.current?0===Rl&&(Rl=3):gu())),null!==t.updateQueue&&(t.flags|=4),$o(t),null);case 4:return Zs(),Do(e,t),null===e&&qn(t.stateNode.containerInfo),$o(t),null;case 10:return ks(t.type._context),$o(t),null;case 19:if(Cr(ta),null===(o=t.memoizedState))return $o(t),null;if(s=!!(128&t.flags),null===(l=o.rendering))if(s)Wo(o,!1);else{if(0!==Rl||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=ia(e))){for(t.flags|=128,Wo(o,!1),null!==(s=l.updateQueue)&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;null!==n;)e=s,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Mr(ta,1&ta.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Hl&&(t.flags|=128,s=!0,Wo(o,!1),t.lanes=4194304)}else{if(!s)if(null!==(e=ia(l))){if(t.flags|=128,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wo(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!as)return $o(t),null}else 2*Je()-o.renderingStartTime>Hl&&1073741824!==n&&(t.flags|=128,s=!0,Wo(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=ta.current,Mr(ta,s?1&n|2:1&n),t):($o(t),null);case 22:case 23:return du(),s=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==s&&(t.flags|=8192),s&&1&t.mode?!!(1073741824&Dl)&&($o(t),6&t.subtreeFlags&&(t.flags|=8192)):$o(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Yo(e,t){switch(ns(t),t.tag){case 1:return Or(t.type)&&Rr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Zs(),Cr(Pr),Cr(Ir),ra(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ea(t),null;case 13:if(Cr(ta),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));ms()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Cr(ta),null;case 4:return Zs(),null;case 10:return ks(t.type._context),null;case 22:case 23:return du(),null;default:return null}}Lo=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Do=function(){},Oo=function(e,t,i,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,Qs($s.current);var a,o=null;switch(i){case"input":s=Q(e,s),n=Q(e,n),o=[];break;case"select":s=U({},s,{value:void 0}),n=U({},n,{value:void 0}),o=[];break;case"textarea":s=re(e,s),n=re(e,n),o=[];break;default:"function"!=typeof s.onClick&&"function"==typeof n.onClick&&(e.onclick=tr)}for(c in _e(i,n),i=null,s)if(!n.hasOwnProperty(c)&&s.hasOwnProperty(c)&&null!=s[c])if("style"===c){var l=s[c];for(a in l)l.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(r.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in n){var u=n[c];if(l=null!=s?s[c]:void 0,n.hasOwnProperty(c)&&u!==l&&(null!=u||null!=l))if("style"===c)if(l){for(a in l)!l.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in u)u.hasOwnProperty(a)&&l[a]!==u[a]&&(i||(i={}),i[a]=u[a])}else i||(o||(o=[]),o.push(c,i)),i=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(o=o||[]).push(c,u)):"children"===c?"string"!=typeof u&&"number"!=typeof u||(o=o||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(r.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&zn("scroll",e),o||l===u||(o=[])):(o=o||[]).push(c,u))}i&&(o=o||[]).push("style",i);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Ro=function(e,t,i,n){i!==n&&(t.flags|=4)};var Qo=!1,Ko=!1,Zo="function"==typeof WeakSet?WeakSet:Set,Jo=null;function el(e,t){var i=e.ref;if(null!==i)if("function"==typeof i)try{i(null)}catch(n){Au(e,t,n)}else i.current=null}function tl(e,t,i){try{i()}catch(n){Au(e,t,n)}}var il=!1;function nl(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&tl(t,i,s)}r=r.next}while(r!==n)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function sl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"==typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fr],delete t[mr],delete t[yr],delete t[vr],delete t[_r])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ul(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!=(i=i._reactRootContainer)||null!==t.onclick||(t.onclick=tr));else if(4!==n&&null!==(e=e.child))for(ul(e,t,i),e=e.sibling;null!==e;)ul(e,t,i),e=e.sibling}function cl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}var hl=null,dl=!1;function pl(e,t,i){for(i=i.child;null!==i;)fl(e,t,i),i=i.sibling}function fl(e,t,i){if(ot&&"function"==typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(at,i)}catch(o){}switch(i.tag){case 5:Ko||el(i,t);case 6:var n=hl,r=dl;hl=null,pl(e,t,i),dl=r,null!==(hl=n)&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):hl.removeChild(i.stateNode));break;case 18:null!==hl&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?cr(e.parentNode,i):1===e.nodeType&&cr(e,i),qt(e)):cr(hl,i.stateNode));break;case 4:n=hl,r=dl,hl=i.stateNode.containerInfo,dl=!0,pl(e,t,i),hl=n,dl=r;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(2&s||4&s)&&tl(i,t,a),r=r.next}while(r!==n)}pl(e,t,i);break;case 1:if(!Ko&&(el(i,t),"function"==typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(o){Au(i,t,o)}pl(e,t,i);break;case 21:pl(e,t,i);break;case 22:1&i.mode?(Ko=(n=Ko)||null!==i.memoizedState,pl(e,t,i),Ko=n):pl(e,t,i);break;default:pl(e,t,i)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Zo),t.forEach(function(t){var n=ku.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))})}}function gl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var s=n[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(i(160));fl(a,o,s),hl=null,dl=!1;var u=s.alternate;null!==u&&(u.return=null),s.return=null}catch(c){Au(s,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),vl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(g){Au(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Au(e,e.return,g)}}break;case 1:gl(t,e),vl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(gl(t,e),vl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var s=e.stateNode;try{pe(s,"")}catch(g){Au(e,e.return,g)}}if(4&r&&null!=(s=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===l&&"radio"===a.type&&null!=a.name&&Z(s,a),be(l,o);var c=be(l,a);for(o=0;o<u.length;o+=2){var h=u[o],d=u[o+1];"style"===h?ye(s,d):"dangerouslySetInnerHTML"===h?de(s,d):"children"===h?pe(s,d):v(s,h,d,c)}switch(l){case"input":J(s,a);break;case"textarea":ae(s,a);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(s,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(s,!!a.multiple,a.defaultValue,!0):ne(s,!!a.multiple,a.multiple?[]:"",!1))}s[mr]=a}catch(g){Au(e,e.return,g)}}break;case 6:if(gl(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(i(162));s=e.stateNode,a=e.memoizedProps;try{s.nodeValue=a}catch(g){Au(e,e.return,g)}}break;case 3:if(gl(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(g){Au(e,e.return,g)}break;case 4:default:gl(t,e),vl(e);break;case 13:gl(t,e),vl(e),8192&(s=e.child).flags&&(a=null!==s.memoizedState,s.stateNode.isHidden=a,!a||null!==s.alternate&&null!==s.alternate.memoizedState||(Vl=Je())),4&r&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Ko=(c=Ko)||h,gl(t,e),Ko=c):gl(t,e),vl(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!h&&1&e.mode)for(Jo=e,h=e.child;null!==h;){for(d=Jo=h;null!==Jo;){switch(f=(p=Jo).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Au(r,n,g)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(d);continue}}null!==f?(f.return=p,Jo=f):Sl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{s=d.stateNode,c?"function"==typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=null!=(u=d.memoizedProps.style)&&u.hasOwnProperty("display")?u.display:null,l.style.display=ge("display",o))}catch(g){Au(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){Au(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),vl(e),4&r&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ol(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var s=r.stateNode;32&r.flags&&(pe(s,""),r.flags&=-33),cl(e,ll(e),s);break;case 3:case 4:var a=r.stateNode.containerInfo;ul(e,ll(e),a);break;default:throw Error(i(161))}}catch(o){Au(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _l(e,t,i){Jo=e,bl(e)}function bl(e,t,i){for(var n=!!(1&e.mode);null!==Jo;){var r=Jo,s=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||Qo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Ko;o=Qo;var u=Ko;if(Qo=a,(Ko=l)&&!u)for(Jo=r;null!==Jo;)l=(a=Jo).child,22===a.tag&&null!==a.memoizedState?wl(r):null!==l?(l.return=a,Jo=l):wl(r);for(;null!==s;)Jo=s,bl(s),s=s.sibling;Jo=r,Qo=o,Ko=u}Tl(e)}else 8772&r.subtreeFlags&&null!==s?(s.return=r,Jo=s):Tl(e)}}function Tl(e){for(;null!==Jo;){var t=Jo;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:Ko||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ko)if(null===n)r.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:no(t.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Gs(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Gs(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&qt(d)}}}break;default:throw Error(i(163))}Ko||512&t.flags&&sl(t)}catch(p){Au(t,t.return,p)}}if(t===e){Jo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Jo=n;break}Jo=t.return}}function Sl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Jo=i;break}Jo=t.return}}function wl(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{rl(4,t)}catch(l){Au(t,i,l)}break;case 1:var n=t.stateNode;if("function"==typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(l){Au(t,r,l)}}var s=t.return;try{sl(t)}catch(l){Au(t,s,l)}break;case 5:var a=t.return;try{sl(t)}catch(l){Au(t,a,l)}}}catch(l){Au(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var xl,Al=Math.ceil,El=_.ReactCurrentDispatcher,Cl=_.ReactCurrentOwner,Ml=_.ReactCurrentBatchConfig,kl=0,Il=null,Pl=null,Ll=0,Dl=0,Ol=Er(0),Rl=0,Nl=null,Fl=0,Ul=0,Bl=0,jl=null,zl=null,Vl=0,Hl=1/0,ql=null,Gl=!1,Wl=null,$l=null,Xl=!1,Yl=null,Ql=0,Kl=0,Zl=null,Jl=-1,eu=0;function tu(){return 6&kl?Je():-1!==Jl?Jl:Jl=Je()}function iu(e){return 1&e.mode?2&kl&&0!==Ll?Ll&-Ll:null!==ys.transition?(0===eu&&(eu=yt()),eu):0!==(e=Tt)?e:e=void 0===(e=window.event)?16:Zt(e.type):1}function nu(e,t,n,r){if(50<Kl)throw Kl=0,Zl=null,Error(i(185));_t(e,n,r),2&kl&&e===Il||(e===Il&&(!(2&kl)&&(Ul|=n),4===Rl&&lu(e,Ll)),ru(e,r),1===n&&0===kl&&!(1&t.mode)&&(Hl=Je()+500,zr&&qr()))}function ru(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-lt(s),o=1<<a,l=r[a];-1===l?0!==(o&i)&&0===(o&n)||(r[a]=mt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var n=ft(e,e===Il?Ll:0);if(0===n)null!==i&&Qe(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&Qe(i),1===t)0===e.tag?function(e){zr=!0,Hr(e)}(uu.bind(null,e)):Hr(uu.bind(null,e)),lr(function(){!(6&kl)&&qr()}),i=null;else{switch(St(n)){case 1:i=tt;break;case 4:i=it;break;case 16:default:i=nt;break;case 536870912:i=st}i=Iu(i,su.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function su(e,t){if(Jl=-1,eu=0,6&kl)throw Error(i(327));var n=e.callbackNode;if(wu()&&e.callbackNode!==n)return null;var r=ft(e,e===Il?Ll:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||t)t=yu(e,r);else{t=r;var s=kl;kl|=2;var a=mu();for(Il===e&&Ll===t||(ql=null,Hl=Je()+500,pu(e,t));;)try{_u();break}catch(l){fu(e,l)}Ms(),El.current=a,kl=s,null!==Pl?t=0:(Il=null,Ll=0,t=Rl)}if(0!==t){if(2===t&&(0!==(s=gt(e))&&(r=s,t=au(e,s))),1===t)throw n=Nl,pu(e,0),lu(e,r),ru(e,Je()),n;if(6===t)lu(e,r);else{if(s=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!un(s(),r))return!1}catch(o){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)||(t=yu(e,r),2===t&&(a=gt(e),0!==a&&(r=a,t=au(e,a))),1!==t)))throw n=Nl,pu(e,0),lu(e,r),ru(e,Je()),n;switch(e.finishedWork=s,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:Su(e,zl,ql);break;case 3:if(lu(e,r),(130023424&r)===r&&10<(t=Vl+500-Je())){if(0!==ft(e,0))break;if(((s=e.suspendedLanes)&r)!==r){tu(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=sr(Su.bind(null,e,zl,ql),t);break}Su(e,zl,ql);break;case 4:if(lu(e,r),(4194240&r)===r)break;for(t=e.eventTimes,s=-1;0<r;){var o=31-lt(r);a=1<<o,(o=t[o])>s&&(s=o),r&=~a}if(r=s,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Al(r/1960))-r)){e.timeoutHandle=sr(Su.bind(null,e,zl,ql),r);break}Su(e,zl,ql);break;default:throw Error(i(329))}}}return ru(e,Je()),e.callbackNode===n?su.bind(null,e):null}function au(e,t){var i=jl;return e.current.memoizedState.isDehydrated&&(pu(e,t).flags|=256),2!==(e=yu(e,t))&&(t=zl,zl=i,null!==t&&ou(t)),e}function ou(e){null===zl?zl=e:zl.push.apply(zl,e)}function lu(e,t){for(t&=~Bl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-lt(t),n=1<<i;e[i]=-1,t&=~n}}function uu(e){if(6&kl)throw Error(i(327));wu();var t=ft(e,0);if(!(1&t))return ru(e,Je()),null;var n=yu(e,t);if(0!==e.tag&&2===n){var r=gt(e);0!==r&&(t=r,n=au(e,r))}if(1===n)throw n=Nl,pu(e,0),lu(e,t),ru(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Su(e,zl,ql),ru(e,Je()),null}function cu(e,t){var i=kl;kl|=1;try{return e(t)}finally{0===(kl=i)&&(Hl=Je()+500,zr&&qr())}}function hu(e){null!==Yl&&0===Yl.tag&&!(6&kl)&&wu();var t=kl;kl|=1;var i=Ml.transition,n=Tt;try{if(Ml.transition=null,Tt=1,e)return e()}finally{Tt=n,Ml.transition=i,!(6&(kl=t))&&qr()}}function du(){Dl=Ol.current,Cr(Ol)}function pu(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,ar(i)),null!==Pl)for(i=Pl.return;null!==i;){var n=i;switch(ns(n),n.tag){case 1:null!=(n=n.type.childContextTypes)&&Rr();break;case 3:Zs(),Cr(Pr),Cr(Ir),ra();break;case 5:ea(n);break;case 4:Zs();break;case 13:case 19:Cr(ta);break;case 10:ks(n.type._context);break;case 22:case 23:du()}i=i.return}if(Il=e,Pl=e=Ou(e.current,null),Ll=Dl=t,Rl=0,Nl=null,Bl=Ul=Fl=0,zl=jl=null,null!==Ds){for(t=0;t<Ds.length;t++)if(null!==(n=(i=Ds[t]).interleaved)){i.interleaved=null;var r=n.next,s=i.pending;if(null!==s){var a=s.next;s.next=r,n.next=a}i.pending=n}Ds=null}return e}function fu(e,t){for(;;){var n=Pl;try{if(Ms(),sa.current=Ja,ha){for(var r=la.memoizedState;null!==r;){var s=r.queue;null!==s&&(s.pending=null),r=r.next}ha=!1}if(oa=0,ca=ua=la=null,da=!1,pa=0,Cl.current=null,null===n||null===n.return){Rl=1,Nl=t,Pl=null;break}e:{var a=e,o=n.return,l=n,u=t;if(t=Ll,l.flags|=32768,null!==u&&"object"==typeof u&&"function"==typeof u.then){var c=u,h=l,d=h.tag;if(!(1&h.mode||0!==d&&11!==d&&15!==d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=yo(o);if(null!==f){f.flags&=-257,vo(f,o,l,0,t),1&f.mode&&go(a,c,t),u=c;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(!(1&t)){go(a,c,t),gu();break e}u=Error(i(426))}else if(as&&1&l.mode){var y=yo(o);if(null!==y){!(65536&y.flags)&&(y.flags|=256),vo(y,o,l,0,t),gs(co(u,l));break e}}a=u=co(u,l),4!==Rl&&(Rl=2),null===jl?jl=[a]:jl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Hs(a,fo(0,u,t));break e;case 1:l=u;var v=a.type,_=a.stateNode;if(!(128&a.flags||"function"!=typeof v.getDerivedStateFromError&&(null===_||"function"!=typeof _.componentDidCatch||null!==$l&&$l.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,Hs(a,mo(a,l,t));break e}}a=a.return}while(null!==a)}Tu(n)}catch(b){t=b,Pl===n&&null!==n&&(Pl=n=n.return);continue}break}}function mu(){var e=El.current;return El.current=Ja,null===e?Ja:e}function gu(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Il||!(268435455&Fl)&&!(268435455&Ul)||lu(Il,Ll)}function yu(e,t){var n=kl;kl|=2;var r=mu();for(Il===e&&Ll===t||(ql=null,pu(e,t));;)try{vu();break}catch(s){fu(e,s)}if(Ms(),kl=n,El.current=r,null!==Pl)throw Error(i(261));return Il=null,Ll=0,Rl}function vu(){for(;null!==Pl;)bu(Pl)}function _u(){for(;null!==Pl&&!Ke();)bu(Pl)}function bu(e){var t=xl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?Tu(e):Pl=t,Cl.current=null}function Tu(e){var t=e;do{var i=t.alternate;if(e=t.return,32768&t.flags){if(null!==(i=Yo(i,t)))return i.flags&=32767,void(Pl=i);if(null===e)return Rl=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(i=Xo(i,t,Dl)))return void(Pl=i);if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Rl&&(Rl=5)}function Su(e,t,n){var r=Tt,s=Ml.transition;try{Ml.transition=null,Tt=1,function(e,t,n,r){do{wu()}while(null!==Yl);if(6&kl)throw Error(i(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-lt(i),s=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~s}}(e,a),e===Il&&(Pl=Il=null,Ll=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Xl||(Xl=!0,Iu(nt,function(){return wu(),null})),a=!!(15990&n.flags),!!(15990&n.subtreeFlags)||a){a=Ml.transition,Ml.transition=null;var o=Tt;Tt=1;var l=kl;kl|=4,Cl.current=null,function(e,t){if(ir=Wt,mn(e=fn())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(T){n=null;break e}var o=0,l=-1,u=-1,c=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==s&&3!==d.nodeType||(l=o+s),d!==a||0!==r&&3!==d.nodeType||(u=o+r),3===d.nodeType&&(o+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++c===s&&(l=o),p===a&&++h===r&&(u=o),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===u?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(nr={focusedElem:e,selectionRange:n},Wt=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,1028&t.subtreeFlags&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var m=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,_=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:no(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(i(163))}}catch(T){Au(t,t.return,T)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}m=il,il=!1}(e,n),yl(n,e),gn(nr),Wt=!!ir,nr=ir=null,e.current=n,_l(n),Ze(),kl=l,Tt=o,Ml.transition=a}else e.current=n;if(Xl&&(Xl=!1,Yl=e,Ql=s),a=e.pendingLanes,0===a&&($l=null),function(e){if(ot&&"function"==typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(at,e,void 0,!(128&~e.current.flags))}catch(t){}}(n.stateNode),ru(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Gl)throw Gl=!1,e=Wl,Wl=null,e;!!(1&Ql)&&0!==e.tag&&wu(),a=e.pendingLanes,1&a?e===Zl?Kl++:(Kl=0,Zl=e):Kl=0,qr()}(e,t,n,r)}finally{Ml.transition=s,Tt=r}return null}function wu(){if(null!==Yl){var e=St(Ql),t=Ml.transition,n=Tt;try{if(Ml.transition=null,Tt=16>e?16:e,null===Yl)var r=!1;else{if(e=Yl,Yl=null,Ql=0,6&kl)throw Error(i(331));var s=kl;for(kl|=4,Jo=e.current;null!==Jo;){var a=Jo,o=a.child;if(16&Jo.flags){var l=a.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(Jo=c;null!==Jo;){var h=Jo;switch(h.tag){case 0:case 11:case 15:nl(8,h,a)}var d=h.child;if(null!==d)d.return=h,Jo=d;else for(;null!==Jo;){var p=(h=Jo).sibling,f=h.return;if(al(h),h===c){Jo=null;break}if(null!==p){p.return=f,Jo=p;break}Jo=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Jo=a}}if(2064&a.subtreeFlags&&null!==o)o.return=a,Jo=o;else e:for(;null!==Jo;){if(2048&(a=Jo).flags)switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,Jo=v;break e}Jo=a.return}}var _=e.current;for(Jo=_;null!==Jo;){var b=(o=Jo).child;if(2064&o.subtreeFlags&&null!==b)b.return=o,Jo=b;else e:for(o=_;null!==Jo;){if(2048&(l=Jo).flags)try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(S){Au(l,l.return,S)}if(l===o){Jo=null;break e}var T=l.sibling;if(null!==T){T.return=l.return,Jo=T;break e}Jo=l.return}}if(kl=s,qr(),ot&&"function"==typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(at,e)}catch(S){}r=!0}return r}finally{Tt=n,Ml.transition=t}}return!1}function xu(e,t,i){e=zs(e,t=fo(0,t=co(i,t),1),1),t=tu(),null!==e&&(_t(e,1,t),ru(e,t))}function Au(e,t,i){if(3===e.tag)xu(e,e,i);else for(;null!==t;){if(3===t.tag){xu(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===$l||!$l.has(n))){t=zs(t,e=mo(t,e=co(i,e),1),1),e=tu(),null!==t&&(_t(t,1,e),ru(t,e));break}}t=t.return}}function Eu(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=tu(),e.pingedLanes|=e.suspendedLanes&i,Il===e&&(Ll&i)===i&&(4===Rl||3===Rl&&(130023424&Ll)===Ll&&500>Je()-Vl?pu(e,0):Bl|=i),ru(e,t)}function Cu(e,t){0===t&&(1&e.mode?(t=dt,!(130023424&(dt<<=1))&&(dt=4194304)):t=1);var i=tu();null!==(e=Ns(e,t))&&(_t(e,t,i),ru(e,i))}function Mu(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Cu(e,i)}function ku(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Cu(e,n)}function Iu(e,t){return Ye(e,t)}function Pu(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lu(e,t,i,n){return new Pu(e,t,i,n)}function Du(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ou(e,t){var i=e.alternate;return null===i?((i=Lu(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Ru(e,t,n,r,s,a){var o=2;if(r=e,"function"==typeof e)Du(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case w:return Nu(n.children,s,a,t);case x:o=8,s|=8;break;case E:return(e=Lu(12,n,t,2|s)).elementType=E,e.lanes=a,e;case I:return(e=Lu(13,n,t,s)).elementType=I,e.lanes=a,e;case P:return(e=Lu(19,n,t,s)).elementType=P,e.lanes=a,e;case O:return Fu(n,s,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case M:o=9;break e;case k:o=11;break e;case L:o=14;break e;case D:o=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Lu(o,n,t,s)).elementType=e,t.type=r,t.lanes=a,t}function Nu(e,t,i,n){return(e=Lu(7,e,n,t)).lanes=i,e}function Fu(e,t,i,n){return(e=Lu(22,e,n,t)).elementType=O,e.lanes=i,e.stateNode={isHidden:!1},e}function Uu(e,t,i){return(e=Lu(6,e,null,t)).lanes=i,e}function Bu(e,t,i){return(t=Lu(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ju(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zu(e,t,i,n,r,s,a,o,l){return e=new ju(e,t,i,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Lu(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Us(s),e}function Vu(e){if(!e)return kr;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Or(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Or(n))return Fr(e,n,t)}return t}function Hu(e,t,i,n,r,s,a,o,l){return(e=zu(i,n,!0,e,0,s,0,o,l)).context=Vu(null),i=e.current,(s=js(n=tu(),r=iu(i))).callback=null!=t?t:null,zs(i,s,r),e.current.lanes=r,_t(e,r,n),ru(e,n),e}function qu(e,t,i,n){var r=t.current,s=tu(),a=iu(r);return i=Vu(i),null===t.context?t.context=i:t.pendingContext=i,(t=js(s,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=zs(r,t,a))&&(nu(e,r,a,s),Vs(e,r,a)),a}function Gu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function $u(e,t){Wu(e,t),(e=e.alternate)&&Wu(e,t)}xl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)bo=!0;else{if(0===(e.lanes&n)&&!(128&t.flags))return bo=!1,function(e,t,i){switch(t.tag){case 3:Io(t),ms();break;case 5:Js(t);break;case 1:Or(t.type)&&Ur(t);break;case 4:Ks(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Mr(xs,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Mr(ta,1&ta.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Uo(e,t,i):(Mr(ta,1&ta.current),null!==(e=Go(e,t,i))?e.sibling:null);Mr(ta,1&ta.current);break;case 19:if(n=0!==(i&t.childLanes),128&e.flags){if(n)return Ho(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Mr(ta,ta.current),n)break;return null;case 22:case 23:return t.lanes=0,Ao(e,t,i)}return Go(e,t,i)}(e,t,n);bo=!!(131072&e.flags)}else bo=!1,as&&1048576&t.flags&&ts(t,Xr,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;qo(e,t),e=t.pendingProps;var s=Dr(t,Ir.current);Ps(t,n),s=ya(null,t,r,e,s,n);var a=va();return t.flags|=1,"object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Or(r)?(a=!0,Ur(t)):a=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Us(t),s.updater=so,t.stateNode=s,s._reactInternals=t,uo(t,r,e,n),t=ko(null,t,r,!0,a,n)):(t.tag=0,as&&a&&is(t),To(null,t,s,n),t=t.child),t;case 16:r=t.elementType;e:{switch(qo(e,t),e=t.pendingProps,r=(s=r._init)(r._payload),t.type=r,s=t.tag=function(e){if("function"==typeof e)return Du(e)?1:0;if(null!=e){if((e=e.$$typeof)===k)return 11;if(e===L)return 14}return 2}(r),e=no(r,e),s){case 0:t=Co(null,t,r,e,n);break e;case 1:t=Mo(null,t,r,e,n);break e;case 11:t=So(null,t,r,e,n);break e;case 14:t=wo(null,t,r,no(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,s=t.pendingProps,Co(e,t,r,s=t.elementType===r?s:no(r,s),n);case 1:return r=t.type,s=t.pendingProps,Mo(e,t,r,s=t.elementType===r?s:no(r,s),n);case 3:e:{if(Io(t),null===e)throw Error(i(387));r=t.pendingProps,s=(a=t.memoizedState).element,Bs(e,t),qs(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Po(e,t,r,n,s=co(Error(i(423)),t));break e}if(r!==s){t=Po(e,t,r,n,s=co(Error(i(424)),t));break e}for(ss=hr(t.stateNode.containerInfo.firstChild),rs=t,as=!0,os=null,n=ws(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ms(),r===s){t=Go(e,t,n);break e}To(e,t,r,n)}t=t.child}return t;case 5:return Js(t),null===e&&hs(t),r=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,o=s.children,rr(r,s)?o=null:null!==a&&rr(r,a)&&(t.flags|=32),Eo(e,t),To(e,t,o,n),t.child;case 6:return null===e&&hs(t),null;case 13:return Uo(e,t,n);case 4:return Ks(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ss(t,null,r,n):To(e,t,r,n),t.child;case 11:return r=t.type,s=t.pendingProps,So(e,t,r,s=t.elementType===r?s:no(r,s),n);case 7:return To(e,t,t.pendingProps,n),t.child;case 8:case 12:return To(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,s=t.pendingProps,a=t.memoizedProps,o=s.value,Mr(xs,r._currentValue),r._currentValue=o,null!==a)if(un(a.value,o)){if(a.children===s.children&&!Pr.current){t=Go(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var u=l.firstContext;null!==u;){if(u.context===r){if(1===a.tag){(u=js(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}a.lanes|=n,null!==(u=a.alternate)&&(u.lanes|=n),Is(a.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(i(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Is(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}To(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,r=t.pendingProps.children,Ps(t,n),r=r(s=Ls(s)),t.flags|=1,To(e,t,r,n),t.child;case 14:return s=no(r=t.type,t.pendingProps),wo(e,t,r,s=no(r.type,s),n);case 15:return xo(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,s=t.pendingProps,s=t.elementType===r?s:no(r,s),qo(e,t),t.tag=1,Or(r)?(e=!0,Ur(t)):e=!1,Ps(t,n),oo(t,r,s),uo(t,r,s,n),ko(null,t,r,!0,e,n);case 19:return Ho(e,t,n);case 22:return Ao(e,t,n)}throw Error(i(156,t.tag))};var Xu="function"==typeof reportError?reportError:function(e){};function Yu(e){this._internalRoot=e}function Qu(e){this._internalRoot=e}function Ku(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ju(){}function ec(e,t,i,n,r){var s=i._reactRootContainer;if(s){var a=s;if("function"==typeof r){var o=r;r=function(){var e=Gu(a);o.call(e)}}qu(t,a,e,r)}else a=function(e,t,i,n,r){if(r){if("function"==typeof n){var s=n;n=function(){var e=Gu(a);s.call(e)}}var a=Hu(t,n,e,0,null,!1,0,"",Ju);return e._reactRootContainer=a,e[gr]=a.current,qn(8===e.nodeType?e.parentNode:e),hu(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof n){var o=n;n=function(){var e=Gu(l);o.call(e)}}var l=zu(e,0,!1,null,0,!1,0,"",Ju);return e._reactRootContainer=l,e[gr]=l.current,qn(8===e.nodeType?e.parentNode:e),hu(function(){qu(t,l,i,n)}),l}(i,t,e,r,n);return Gu(a)}Qu.prototype.render=Yu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));qu(e,t,null,null)},Qu.prototype.unmount=Yu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hu(function(){qu(null,e,null,null)}),t[gr]=null}},Qu.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Rt.length&&0!==t&&t<Rt[i].priority;i++);Rt.splice(i,0,e),0===i&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=pt(t.pendingLanes);0!==i&&(bt(t,1|i),ru(t,Je()),!(6&kl)&&(Hl=Je()+500,qr()))}break;case 13:hu(function(){var t=Ns(e,1);if(null!==t){var i=tu();nu(t,e,1,i)}}),$u(e,1)}},xt=function(e){if(13===e.tag){var t=Ns(e,134217728);if(null!==t)nu(t,e,134217728,tu());$u(e,134217728)}},At=function(e){if(13===e.tag){var t=iu(e),i=Ns(e,t);if(null!==i)nu(i,e,t,tu());$u(e,t)}},Et=function(){return Tt},Ct=function(e,t){var i=Tt;try{return Tt=e,t()}finally{Tt=i}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=wr(r);if(!s)throw Error(i(90));X(r),J(r,s)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},ke=cu,Ie=hu;var tc={usingClientEntryPoint:!1,Events:[Tr,Sr,wr,Ce,Me,cu]},ic={findFiberByHostInstance:br,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nc={bundleType:ic.bundleType,version:ic.version,rendererPackageName:ic.rendererPackageName,rendererConfig:ic.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:ic.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{at=rc.inject(nc),ot=rc}catch(he){}}return S.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,S.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ku(t))throw Error(i(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,n)},S.createRoot=function(e,t){if(!Ku(e))throw Error(i(299));var n=!1,r="",s=Xu;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=zu(e,1,!1,null,0,n,0,r,s),e[gr]=t.current,qn(8===e.nodeType?e.parentNode:e),new Yu(t)},S.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=$e(t))?null:e.stateNode},S.flushSync=function(e){return hu(e)},S.hydrate=function(e,t,n){if(!Zu(t))throw Error(i(200));return ec(null,e,t,!0,n)},S.hydrateRoot=function(e,t,n){if(!Ku(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,s=!1,a="",o=Xu;if(null!=n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Hu(t,null,e,1,null!=n?n:null,s,0,a,o),e[gr]=t.current,qn(e),r)for(e=0;e<r.length;e++)s=(s=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Qu(t)},S.render=function(e,t,n){if(!Zu(t))throw Error(i(200));return ec(null,e,t,!1,n)},S.unmountComponentAtNode=function(e){if(!Zu(e))throw Error(i(40));return!!e._reactRootContainer&&(hu(function(){ec(null,null,e,!1,function(){e._reactRootContainer=null,e[gr]=null})}),!0)},S.unstable_batchedUpdates=cu,S.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zu(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return ec(e,t,n,!1,r)},S.version="18.3.1-next-f1338f8080-20240426",S}const C=s(function(){if(_)return b;_=1;var e=(v||(v=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),T.exports=E()),T.exports);return b.createRoot=e.createRoot,b.hydrateRoot=e.hydrateRoot,b}());var M,k,I={exports:{}},P={};var L,D,O=(k||(k=1,I.exports=function(){if(M)return P;M=1;var e=d(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(e,i,a){var o,l={},u=null,c=null;for(o in void 0!==a&&(u=""+a),void 0!==i.key&&(u=""+i.key),void 0!==i.ref&&(c=i.ref),i)n.call(i,o)&&!s.hasOwnProperty(o)&&(l[o]=i[o]);if(e&&e.defaultProps)for(o in i=e.defaultProps)void 0===l[o]&&(l[o]=i[o]);return{$$typeof:t,type:e,key:u,ref:c,props:l,_owner:r.current}}return P.Fragment=i,P.jsx=a,P.jsxs=a,P}()),I.exports);function R(){return D?L:(D=1,e="undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:{},L=e);var e}const N=s(R()),F=a(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var U,B;function j(){if(B)return U;B=1;var e,t=void 0!==r?r:"undefined"!=typeof window?window:{},i=F;return"undefined"!=typeof document?e=document:(e=t["__GLOBAL_DOCUMENT_CACHE@4"])||(e=t["__GLOBAL_DOCUMENT_CACHE@4"]=i),U=e}const z=s(j());var V,H,q,G,W,$,X,Y,Q,K,Z={exports:{}},J={exports:{}};function ee(){return V||(V=1,function(e){function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(J)),J.exports}function te(){if(q)return H;q=1,H=function(t){if(!t)return!1;var i=e.call(t);return"[object Function]"===i||"function"==typeof t&&"[object RegExp]"!==i||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)};var e=Object.prototype.toString;return H}function ie(){if(W)return G;function e(e,i){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,i){if(!e)return;if("string"==typeof e)return t(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,i)}(e))||i){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}return W=1,G=function(){function t(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var i=t.prototype;return i.getIsEnabled=function(){return this.enabled_},i.enable=function(){this.enabled_=!0},i.disable=function(){this.enabled_=!1},i.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},i.addInterceptor=function(e,t){this.typeToInterceptorsMap_.has(e)||this.typeToInterceptorsMap_.set(e,new Set);var i=this.typeToInterceptorsMap_.get(e);return!i.has(t)&&(i.add(t),!0)},i.removeInterceptor=function(e,t){var i=this.typeToInterceptorsMap_.get(e);return!(!i||!i.has(t))&&(i.delete(t),!0)},i.clearInterceptorsByType=function(e){return!!this.typeToInterceptorsMap_.get(e)&&(this.typeToInterceptorsMap_.delete(e),this.typeToInterceptorsMap_.set(e,new Set),!0)},i.clear=function(){return!!this.typeToInterceptorsMap_.size&&(this.typeToInterceptorsMap_=new Map,!0)},i.getForType=function(e){return this.typeToInterceptorsMap_.get(e)||new Set},i.execute=function(t,i){for(var n,r=e(this.getForType(t));!(n=r()).done;){var s=n.value;try{i=s(i)}catch(a){}}return i},t}()}var ne=function(){if(K)return Z.exports;K=1;var e=R(),t=ee(),i=te(),n=ie(),r=function(){if(X)return $;X=1;var e=function(){function e(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var i=e.prototype;return i.getIsEnabled=function(){return this.enabled_},i.enable=function(){this.enabled_=!0},i.disable=function(){this.enabled_=!1},i.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},i.getMaxAttempts=function(){return this.maxAttempts_},i.setMaxAttempts=function(e){this.maxAttempts_=e},i.getDelayFactor=function(){return this.delayFactor_},i.setDelayFactor=function(e){this.delayFactor_=e},i.getFuzzFactor=function(){return this.fuzzFactor_},i.setFuzzFactor=function(e){this.fuzzFactor_=e},i.getInitialDelay=function(){return this.initialDelay_},i.setInitialDelay=function(e){this.initialDelay_=e},i.createRetry=function(e){var i=void 0===e?{}:e,n=i.maxAttempts,r=i.delayFactor,s=i.fuzzFactor,a=i.initialDelay;return new t({maxAttempts:n||this.maxAttempts_,delayFactor:r||this.delayFactor_,fuzzFactor:s||this.fuzzFactor_,initialDelay:a||this.initialDelay_})},e}(),t=function(){function e(e){this.maxAttempts_=e.maxAttempts,this.delayFactor_=e.delayFactor,this.fuzzFactor_=e.fuzzFactor,this.currentDelay_=e.initialDelay,this.currentAttempt_=1}var t=e.prototype;return t.moveToNextAttempt=function(){this.currentAttempt_++;var e=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+e},t.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},t.getCurrentDelay=function(){return this.currentDelay_},t.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},t.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},t.getCurrentFuzzedDelay=function(){var e=this.getCurrentMinPossibleDelay(),t=this.getCurrentMaxPossibleDelay();return e+Math.random()*(t-e)},e}();return $=e}();o.httpHandler=function(){if(Q)return Y;Q=1;var e=R();return Y=function(t,i){return void 0===i&&(i=!1),function(n,r,s){if(n)t(n);else if(r.statusCode>=400&&r.statusCode<=599){var a=s;if(i)if(e.TextDecoder){var o=(void 0===(l=r.headers&&r.headers["content-type"])&&(l=""),l.toLowerCase().split(";").reduce(function(e,t){var i=t.split("="),n=i[0],r=i[1];return"charset"===n.trim()?r.trim():e},"utf-8"));try{a=new TextDecoder(o).decode(s)}catch(u){}}else a=String.fromCharCode.apply(null,new Uint8Array(s));t({cause:a})}else t(null,s);var l}}}(),o.requestInterceptorsStorage=new n,o.responseInterceptorsStorage=new n,o.retryManager=new r;var s=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var i=e.indexOf(":"),n=e.slice(0,i).trim().toLowerCase(),r=e.slice(i+1).trim();void 0===t[n]?t[n]=r:Array.isArray(t[n])?t[n].push(r):t[n]=[t[n],r]}),t):t};function a(e,n,r){var s=e;return i(n)?(r=n,"string"==typeof e&&(s={uri:e})):s=t({},n,{uri:e}),s.callback=r,s}function o(e,t,i){return l(t=a(e,t,i))}function l(e){if(void 0===e.callback)throw new Error("callback argument missing");if(e.requestType&&o.requestInterceptorsStorage.getIsEnabled()){var t={uri:e.uri||e.url,headers:e.headers||{},body:e.body,metadata:e.metadata||{},retry:e.retry,timeout:e.timeout},i=o.requestInterceptorsStorage.execute(e.requestType,t);e.uri=i.uri,e.headers=i.headers,e.body=i.body,e.metadata=i.metadata,e.retry=i.retry,e.timeout=i.timeout}var n=!1,r=function(t,i,r){n||(n=!0,e.callback(t,i,r))};function a(){var e=void 0;if(e=p.response?p.response:p.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(i){}return null}(p),b)try{e=JSON.parse(e)}catch(t){}return e}function u(t){if(clearTimeout(f),clearTimeout(e.retryTimeout),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,d||!o.retryManager.getIsEnabled()||!e.retry||!e.retry.shouldRetry()){if(e.requestType&&o.responseInterceptorsStorage.getIsEnabled()){var i={headers:T.headers||{},body:T.body,responseUrl:p.responseURL,responseType:p.responseType},n=o.responseInterceptorsStorage.execute(e.requestType,i);T.body=n.body,T.headers=n.headers}return r(t,T)}e.retryTimeout=setTimeout(function(){e.retry.moveToNextAttempt(),e.xhr=p,l(e)},e.retry.getCurrentFuzzedDelay())}function c(){if(!d){var t;clearTimeout(f),clearTimeout(e.retryTimeout),t=e.useXDR&&void 0===p.status?200:1223===p.status?204:p.status;var i=T,n=null;if(0!==t?(i={body:a(),statusCode:t,method:g,headers:{},url:m,rawRequest:p},p.getAllResponseHeaders&&(i.headers=s(p.getAllResponseHeaders()))):n=new Error("Internal XMLHttpRequest Error"),e.requestType&&o.responseInterceptorsStorage.getIsEnabled()){var l={headers:i.headers||{},body:i.body,responseUrl:p.responseURL,responseType:p.responseType},u=o.responseInterceptorsStorage.execute(e.requestType,l);i.body=u.body,i.headers=u.headers}return r(n,i,i.body)}}var h,d,p=e.xhr||null;p||(p=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var f,m=p.url=e.uri||e.url,g=p.method=e.method||"GET",y=e.body||e.data,v=p.headers=e.headers||{},_=!!e.sync,b=!1,T={body:void 0,headers:{},statusCode:0,method:g,url:m,rawRequest:p};if("json"in e&&!1!==e.json&&(b=!0,v.accept||v.Accept||(v.Accept="application/json"),"GET"!==g&&"HEAD"!==g&&(v["content-type"]||v["Content-Type"]||(v["Content-Type"]="application/json"),y=JSON.stringify(!0===e.json?y:e.json))),p.onreadystatechange=function(){4!==p.readyState||o.responseInterceptorsStorage.getIsEnabled()||setTimeout(c,0)},p.onload=c,p.onerror=u,p.onprogress=function(){},p.onabort=function(){d=!0,clearTimeout(e.retryTimeout)},p.ontimeout=u,p.open(g,m,!_,e.username,e.password),_||(p.withCredentials=!!e.withCredentials),!_&&e.timeout>0&&(f=setTimeout(function(){if(!d){d=!0,p.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",u(e)}},e.timeout)),p.setRequestHeader)for(h in v)v.hasOwnProperty(h)&&p.setRequestHeader(h,v[h]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(p.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(p),p.send(y||null),p}return Z.exports=o,Z.exports.default=o,o.XMLHttpRequest=e.XMLHttpRequest||function(){},o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:e.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,i,n){return(i=a(t,i,n)).method=e.toUpperCase(),l(i)}}),Z.exports}();const re=s(ne);var se,ae,oe,le,ue,ce,he,de={exports:{}};function pe(){if(ae)return se;ae=1;var e=j(),t=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function i(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function n(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+(0|n)/1e3}var i=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):i[1]>59?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}function r(){this.values=t(null)}function s(e,t,i,n){var r=n?e.split(n):[e];for(var s in r)if("string"==typeof r[s]){var a=r[s].split(i);if(2===a.length)t(a[0].trim(),a[1].trim())}}function a(e,t,a){var o=e;function l(){var t=n(e);if(null===t)throw new i(i.Errors.BadTimeStamp,"Malformed timestamp: "+o);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function u(){e=e.replace(/^\s+/,"")}if(u(),t.startTime=l(),u(),"--\x3e"!==e.substr(0,3))throw new i(i.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);e=e.substr(3),u(),t.endTime=l(),u(),function(e,t){var i=new r;s(e,function(e,t){switch(e){case"region":for(var n=a.length-1;n>=0;n--)if(a[n].id===t){i.set(e,a[n].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var r=t.split(","),s=r[0];i.integer(e,s),i.percent(e,s)&&i.set("snapToLines",!1),i.alt(e,s,["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start","center","end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(n){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(n){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(n){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}(e,t)}i.prototype=t(Error.prototype),i.prototype.constructor=i,i.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},r.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var o=e.createElement&&e.createElement("textarea"),l={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},u={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},c={v:"title",lang:"lang"},h={rt:"ruby"};function d(e,t){function i(){if(!t)return null;var e,i=t.match(/^([^<]*)(<[^>]*>?)?/);return e=i[1]?i[1]:i[2],t=t.substr(e.length),e}function r(e){return o.innerHTML=e,e=o.textContent,o.textContent="",e}function s(e,t){return!h[t.localName]||h[t.localName]===e.localName}function a(t,i){var n=l[t];if(!n)return null;var r=e.document.createElement(n),s=c[t];return s&&i&&(r[s]=i.trim()),r}for(var d,p=e.document.createElement("div"),f=p,m=[];null!==(d=i());)if("<"!==d[0])f.appendChild(e.document.createTextNode(r(d)));else{if("/"===d[1]){m.length&&m[m.length-1]===d.substr(2).replace(">","")&&(m.pop(),f=f.parentNode);continue}var g,y=n(d.substr(1,d.length-2));if(y){g=e.document.createProcessingInstruction("timestamp",y),f.appendChild(g);continue}var v=d.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!v)continue;if(!(g=a(v[1],v[3])))continue;if(!s(f,g))continue;if(v[2]){var _=v[2].split(".");_.forEach(function(e){var t=/^bg_/.test(e),i=t?e.slice(3):e;if(u.hasOwnProperty(i)){var n=t?"background-color":"color",r=u[i];g.style[n]=r}}),g.className=_.join(" ")}m.push(v[1]),f.appendChild(g),f=g}return p}var p=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function f(e){for(var t=0;t<p.length;t++){var i=p[t];if(e>=i[0]&&e<=i[1])return!0}return!1}function m(e){var t=[],i="";if(!e||!e.childNodes)return"ltr";function n(e,t){for(var i=t.childNodes.length-1;i>=0;i--)e.push(t.childNodes[i])}function r(e){if(!e||!e.length)return null;var t=e.pop(),i=t.textContent||t.innerText;if(i){var s=i.match(/^.*(\n|\r)/);return s?(e.length=0,s[0]):i}return"ruby"===t.tagName?r(e):t.childNodes?(n(e,t),r(e)):void 0}for(n(t,e);i=r(t);)for(var s=0;s<i.length;s++)if(f(i.charCodeAt(s)))return"rtl";return"ltr"}function g(){}function y(e,t,i){g.call(this),this.cue=t,this.cueDiv=d(e,t.text);var n={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(n,this.cueDiv),this.div=e.document.createElement("div"),n={direction:m(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:i.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":case"line-left":r=t.position;break;case"center":r=t.position-t.size/2;break;case"end":case"line-right":r=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function v(e){var t,i,n,r;if(e.div){i=e.div.offsetHeight,n=e.div.offsetWidth,r=e.div.offsetTop;var s=(s=e.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();e=e.div.getBoundingClientRect(),t=s?Math.max(s[0]&&s[0].height||0,e.height/s.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||i,this.bottom=e.bottom||r+(e.height||i),this.width=e.width||n,this.lineHeight=void 0!==t?t:e.lineHeight}function _(e,t,i,n){var r=new v(t),s=t.cue,a=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,i=t.textTrackList,n=0,r=0;r<i.length&&i[r]!==t;r++)"showing"===i[r].mode&&n++;return-1*++n}(s),o=[];if(s.snapToLines){var l;switch(s.vertical){case"":o=["+y","-y"],l="height";break;case"rl":o=["+x","-x"],l="width";break;case"lr":o=["-x","+x"],l="width"}var u=r.lineHeight,c=u*Math.round(a),h=i[l]+u,d=o[0];Math.abs(c)>h&&(c=c<0?-1:1,c*=Math.ceil(h/u)*u),a<0&&(c+=""===s.vertical?i.height:i.width,o=o.reverse()),r.move(d,c)}else{var p=r.lineHeight/i.height*100;switch(s.lineAlign){case"center":a-=p/2;break;case"end":a-=p}switch(s.vertical){case"":t.applyStyles({top:t.formatStyle(a,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(a,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(a,"%")})}o=["+y","-x","+x","-y"],r=new v(t)}var f=function(e,t){for(var r,s=new v(e),a=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(i,t[o])||e.within(i)&&e.overlapsAny(n);)e.move(t[o]);if(e.within(i))return e;var l=e.intersectPercentage(i);a>l&&(r=new v(e),a=l),e=new v(s)}return r||s}(r,o);t.move(f.toCSSCompatValues(i))}function b(){}g.prototype.applyStyles=function(e,t){for(var i in t=t||this.div,e)e.hasOwnProperty(i)&&(t.style[i]=e[i])},g.prototype.formatStyle=function(e,t){return 0===e?0:e+t},y.prototype=t(g.prototype),y.prototype.constructor=y,v.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},v.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},v.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},v.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},v.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},v.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},v.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},v.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,i=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,n=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||n,height:e.height||t,bottom:e.bottom||n+(e.height||t),width:e.width||i}},b.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},b.convertCueToDOMTree=function(e,t){return e&&t?d(e,t):null};return b.processCues=function(e,t,i){if(!e||!t||!i)return null;for(;i.firstChild;)i.removeChild(i.firstChild);var n=e.document.createElement("div");if(n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin="1.5%",i.appendChild(n),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var r=[],s=v.getSimpleBoxPosition(n),a={font:Math.round(.05*s.height*100)/100+"px sans-serif"};!function(){for(var i,o,l=0;l<t.length;l++)o=t[l],i=new y(e,o,a),n.appendChild(i.div),_(0,i,s,r),o.displayState=i.div,r.push(v.getSimpleBoxPosition(i))}()}else for(var o=0;o<t.length;o++)n.appendChild(t[o].displayState)},b.Parser=function(e,t,i){i||(i=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=i||new TextDecoder("utf8"),this.regionList=[]},b.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof i))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function o(){for(var e=t.buffer,i=0;i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var n=e.substr(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.substr(i),n}function l(e){e.match(/X-TIMESTAMP-MAP/)?s(e,function(e,i){if("X-TIMESTAMP-MAP"===e)!function(e){var i=new r;s(e,function(e,t){switch(e){case"MPEGT":i.integer(e+"S",t);break;case"LOCA":i.set(e+"L",n(t))}},/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:i.get("MPEGTS"),LOCAL:i.get("LOCAL")})}(i)},/=/):s(e,function(e,i){if("Region"===e)!function(e){var i=new r;if(s(e,function(e,t){switch(e){case"id":i.set(e,t);break;case"width":i.percent(e,t);break;case"lines":i.integer(e,t);break;case"regionanchor":case"viewportanchor":var n=t.split(",");if(2!==n.length)break;var s=new r;if(s.percent("x",n[0]),s.percent("y",n[1]),!s.has("x")||!s.has("y"))break;i.set(e+"X",s.get("x")),i.set(e+"Y",s.get("y"));break;case"scroll":i.alt(e,t,["up"])}},/=/,/\s/),i.has("id")){var n=new(t.vttjs.VTTRegion||t.window.VTTRegion);n.width=i.get("width",100),n.lines=i.get("lines",3),n.regionAnchorX=i.get("regionanchorX",0),n.regionAnchorY=i.get("regionanchorY",100),n.viewportAnchorX=i.get("viewportanchorX",0),n.viewportAnchorY=i.get("viewportanchorY",100),n.scroll=i.get("scroll",""),t.onregion&&t.onregion(n),t.regionList.push({id:i.get("id"),region:n})}}(i)},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var u;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var c=(u=o()).match(/^WEBVTT([ \t].*)?$/);if(!c||!c[0])throw new i(i.Errors.BadSignature);t.state="HEADER"}for(var h=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(h?h=!1:u=o(),t.state){case"HEADER":/:/.test(u)?l(u):u||(t.state="ID");continue;case"NOTE":u||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(u)){t.state="NOTE";break}if(!u)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(p){t.cue.align="middle"}if(t.state="CUE",-1===u.indexOf("--\x3e")){t.cue.id=u;continue}case"CUE":try{a(u,t.cue,t.regionList)}catch(p){t.reportOrThrowError(p),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var d=-1!==u.indexOf("--\x3e");if(!u||d&&(h=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=u.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":u||(t.state="ID");continue}}}catch(p){t.reportOrThrowError(p),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new i(i.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},se=b}function fe(){if(le)return oe;le=1;var e={"":1,lr:1,rl:1},t={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function i(e){return"string"==typeof e&&(!!t[e.toLowerCase()]&&e.toLowerCase())}function n(t,n,r){this.hasBeenReset=!1;var s="",a=!1,o=t,l=n,u=r,c=null,h="",d=!0,p="auto",f="start",m="auto",g="auto",y=100,v="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return s},set:function(e){s=""+e}},pauseOnExit:{enumerable:!0,get:function(){return a},set:function(e){a=!!e}},startTime:{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");o=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return u},set:function(e){u=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return c},set:function(e){c=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return h},set:function(t){var i=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);if(!1===i)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");h=i,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return d},set:function(e){d=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return p},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("Line: an invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return f},set:function(e){var t=i(e);t&&(f=t,this.hasBeenReset=!0)}},position:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");m=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return g},set:function(e){var t=i(e);t&&(g=t,this.hasBeenReset=!0)}},size:{enumerable:!0,get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return v},set:function(e){var t=i(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");v=t,this.hasBeenReset=!0}}}),this.displayState=void 0}return n.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},oe=n}function me(){if(ce)return ue;ce=1;var e={"":!0,up:!0};function t(e){return"number"==typeof e&&e>=0&&e<=100}return ue=function(){var i=100,n=3,r=0,s=100,a=0,o=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return i},set:function(e){if(!t(e))throw new Error("Width must be between 0 and 100.");i=e}},lines:{enumerable:!0,get:function(){return n},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");n=e}},regionAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!t(e))throw new Error("RegionAnchorX must be between 0 and 100.");s=e}},regionAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!t(e))throw new Error("RegionAnchorY must be between 0 and 100.");r=e}},viewportAnchorY:{enumerable:!0,get:function(){return o},set:function(e){if(!t(e))throw new Error("ViewportAnchorY must be between 0 and 100.");o=e}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!t(e))throw new Error("ViewportAnchorX must be between 0 and 100.");a=e}},scroll:{enumerable:!0,get:function(){return l},set:function(t){var i=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);!1===i||(l=i)}}})}}const ge=s(function(){if(he)return de.exports;he=1;var e=R(),t=de.exports={WebVTT:pe(),VTTCue:fe(),VTTRegion:me()};e.vttjs=t,e.WebVTT=t.WebVTT;var i=t.VTTCue,n=t.VTTRegion,r=e.VTTCue,s=e.VTTRegion;return t.shim=function(){e.VTTCue=i,e.VTTRegion=n},t.restore=function(){e.VTTCue=r,e.VTTRegion=s},e.VTTCue||t.shim(),de.exports}());function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ye.apply(null,arguments)}var ve="https://example.com",_e=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=N.location&&N.location.href||"");var i=/^\/\//.test(e),n=!N.location&&!/\/\//i.test(e);e=new N.URL(e,N.location||ve);var r=new URL(t,e);return n?r.href.slice(19):i?r.href.slice(r.protocol.length):r.href},be=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(i,1),i>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,n=0;n<i;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();function Te(e){for(var t,i=(t=e,N.atob?N.atob(t):Buffer.from(t,"base64").toString("binary")),n=new Uint8Array(i.length),r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return n}let Se=class extends be{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}};const we=String.fromCharCode(9),xe=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),i={};return t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),i},Ae=function(e){const t={};if(!e)return t;const i=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let n,r=i.length;for(;r--;)""!==i[r]&&(n=/([^=]*)=(.*)/.exec(i[r]).slice(1),n[0]=n[0].replace(/^\s+|\s+$/g,""),n[1]=n[1].replace(/^\s+|\s+$/g,""),n[1]=n[1].replace(/^['"](.*)['"]$/g,"$1"),t[n[0]]=n[1]);return t},Ee=e=>{const t=e.split("x"),i={};return t[0]&&(i.width=parseInt(t[0],10)),t[1]&&(i.height=parseInt(t[1],10)),i};let Ce=class extends be{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,i;if(0===(e=e.trim()).length)return;if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});this.tagMappers.reduce((t,i)=>{const n=i(e);return n===e?t:t.concat([n])},[e]).forEach(e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return i={type:"tag",tagType:"inf"},t[1]&&(i.duration=parseFloat(t[1])),t[2]&&(i.title=t[2]),void this.trigger("data",i);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"targetduration"},t[1]&&(i.duration=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"version"},t[1]&&(i.version=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"media-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"playlist-type"},t[1]&&(i.playlistType=t[1]),void this.trigger("data",i);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return i=ye(xe(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",i);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return i={type:"tag",tagType:"allow-cache"},t[1]&&(i.allowed=!/NO/.test(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(i={type:"tag",tagType:"map"},t[1]){const e=Ae(t[1]);e.URI&&(i.uri=e.URI),e.BYTERANGE&&(i.byterange=xe(e.BYTERANGE))}this.trigger("data",i)}else{if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t)return i={type:"tag",tagType:"stream-inf"},t[1]&&(i.attributes=Ae(t[1]),i.attributes.RESOLUTION&&(i.attributes.RESOLUTION=Ee(i.attributes.RESOLUTION)),i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))),void this.trigger("data",i);if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return i={type:"tag",tagType:"media"},t[1]&&(i.attributes=Ae(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return i={type:"tag",tagType:"program-date-time"},t[1]&&(i.dateTimeString=t[1],i.dateTimeObject=new Date(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return i={type:"tag",tagType:"key"},t[1]&&(i.attributes=Ae(t[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void this.trigger("data",i);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return i={type:"tag",tagType:"start"},t[1]&&(i.attributes=Ae(t[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"cue-out-cont"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"cue-out"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e),t)return i={type:"tag",tagType:"cue-in"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"skip"},i.attributes=Ae(t[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split(we)),void this.trigger("data",i);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"part"},i.attributes=Ae(t[1]),["DURATION"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),["INDEPENDENT","GAP"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/.test(i.attributes[e]))}),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=xe(i.attributes.BYTERANGE)),void this.trigger("data",i);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"server-control"},i.attributes=Ae(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/.test(i.attributes[e]))}),void this.trigger("data",i);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"part-inf"},i.attributes=Ae(t[1]),["PART-TARGET"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),void this.trigger("data",i);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"preload-hint"},i.attributes=Ae(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(e){if(i.attributes.hasOwnProperty(e)){i.attributes[e]=parseInt(i.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[t]=i.attributes[e],delete i.attributes[e]}}),void this.trigger("data",i);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"rendition-report"},i.attributes=Ae(t[1]),["LAST-MSN","LAST-PART"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseInt(i.attributes[e],10))}),void this.trigger("data",i);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){i={type:"tag",tagType:"daterange"},i.attributes=Ae(t[1]),["ID","CLASS"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=String(i.attributes[e]))}),["START-DATE","END-DATE"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=new Date(i.attributes[e]))}),["DURATION","PLANNED-DURATION"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),["END-ON-NEXT"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/i.test(i.attributes[e]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=i.attributes[e].toString(16))});const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in i.attributes){if(!e.test(t))continue;const n=/[0-9A-Fa-f]{6}/g.test(i.attributes[t]),r=/^\d+(\.\d+)?$/.test(i.attributes[t]);i.attributes[t]=n?i.attributes[t].toString(16):r?parseFloat(i.attributes[t]):String(i.attributes[t])}return void this.trigger("data",i)}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t)this.trigger("data",{type:"tag",tagType:"independent-segments"});else if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"i-frames-only"});else{if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(e),t)return i={type:"tag",tagType:"content-steering"},i.attributes=Ae(t[1]),void this.trigger("data",i);if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(e),t)return i={type:"tag",tagType:"i-frame-playlist"},i.attributes=Ae(t[1]),i.attributes.URI&&(i.uri=i.attributes.URI),i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes.RESOLUTION&&(i.attributes.RESOLUTION=Ee(i.attributes.RESOLUTION)),i.attributes["AVERAGE-BANDWIDTH"]&&(i.attributes["AVERAGE-BANDWIDTH"]=parseInt(i.attributes["AVERAGE-BANDWIDTH"],10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),void this.trigger("data",i);if(t=/^#EXT-X-DEFINE:(.*)$/.exec(e),t)return i={type:"tag",tagType:"define"},i.attributes=Ae(t[1]),void this.trigger("data",i);this.trigger("data",{type:"tag",data:e.slice(4)})}}}}else this.trigger("data",{type:"comment",text:e.slice(1)})})}addParser({expression:e,customType:t,dataParser:i,segment:n}){"function"!=typeof i&&(i=e=>e),this.customParsers.push(r=>{if(e.exec(r))return this.trigger("data",{type:"custom",data:i(r),customType:t,segment:n}),!0})}addTagMapper({expression:e,map:t}){this.tagMappers.push(i=>e.test(i)?t(i):i)}};const Me=function(e){const t={};return Object.keys(e).forEach(function(i){var n;t[(n=i,n.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()))]=e[i]}),t},ke=function(e){const{serverControl:t,targetDuration:i,partTargetDuration:n}=e;if(!t)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=i&&3*i,l=n&&2*n;i&&!t.hasOwnProperty(s)&&(t[s]=o,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&t[s]<o&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${t[s]}) to targetDuration * 3 (${o})`}),t[s]=o),n&&!t.hasOwnProperty(a)&&(t[a]=3*n,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[a]}).`})),n&&t[a]<l&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${t[a]}) to partTargetDuration * 2 (${l}).`}),t[a]=l)};let Ie=class extends be{constructor(e={}){super(),this.lineStream=new Se,this.parseStream=new Ce,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,i=[];let n,r,s={},a=!1;const o=function(){},l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let u=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let c=0,h=0;const d={};this.on("end",()=>{s.uri||!s.parts&&!s.preloadHints||(!s.map&&n&&(s.map=n),!s.key&&r&&(s.key=r),s.timeline||"number"!=typeof u||(s.timeline=u),this.manifest.preloadSegment=s)}),this.parseStream.on("data",function(e){let p,f;if(t.manifest.definitions)for(const i in t.manifest.definitions)if(e.uri&&(e.uri=e.uri.replace(`{$${i}}`,t.manifest.definitions[i])),e.attributes)for(const n in e.attributes)"string"==typeof e.attributes[n]&&(e.attributes[n]=e.attributes[n].replace(`{$${i}}`,t.manifest.definitions[i]));({tag(){({version(){e.version&&(this.manifest.version=e.version)},"allow-cache"(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const t={};"length"in e&&(s.byterange=t,t.length=e.length,"offset"in e||(e.offset=c)),"offset"in e&&(s.byterange=t,t.offset=e.offset),c=t.offset+t.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.title&&(s.title=e.title),e.duration>0&&(s.duration=e.duration),0===e.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=i},key(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("com.apple.streamingkeydelivery"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:e.attributes});if("com.microsoft.playready"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:e.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:Te(e.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(r.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence"(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,u=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type"(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map(){n={},e.uri&&(n.uri=e.uri),e.byterange&&(n.byterange=e.byterange),r&&(n.key=r)},"stream-inf"(){this.manifest.playlists=i,this.manifest.mediaGroups=this.manifest.mediaGroups||l,e.attributes?(s.attributes||(s.attributes={}),ye(s.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,!(e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const t=this.manifest.mediaGroups[e.attributes.TYPE];t[e.attributes["GROUP-ID"]]=t[e.attributes["GROUP-ID"]]||{},p=t[e.attributes["GROUP-ID"]],f={default:/yes/i.test(e.attributes.DEFAULT)},f.default?f.autoselect=!0:f.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(f.language=e.attributes.LANGUAGE),e.attributes.URI&&(f.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(f.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(f.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(f.forced=/yes/i.test(e.attributes.FORCED)),p[e.attributes.NAME]=f},discontinuity(){u+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(i.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),s.dateTimeString=e.dateTimeString,s.dateTimeObject=e.dateTimeObject;const{lastProgramDateTime:t}=this;this.lastProgramDateTime=new Date(e.dateTimeString).getTime(),null===t&&this.manifest.segments.reduceRight((e,t)=>(t.programDateTime=e-1e3*t.duration,t.programDateTime),this.lastProgramDateTime)},targetduration(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):(this.manifest.targetDuration=e.duration,ke.call(this,this.manifest))},start(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){s.cueOut=e.data},"cue-out-cont"(){s.cueOutCont=e.data},"cue-in"(){s.cueIn=e.data},skip(){this.manifest.skip=Me(e.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",e.attributes,["SKIPPED-SEGMENTS"])},part(){a=!0;const t=this.manifest.segments.length,i=Me(e.attributes);s.parts=s.parts||[],s.parts.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=h),h=i.byterange.offset+i.byterange.length);const n=s.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${n} for segment #${t}`,e.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})})},"server-control"(){const t=this.manifest.serverControl=Me(e.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),ke.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const t=this.manifest.segments.length,i=Me(e.attributes),n=i.type&&"PART"===i.type;s.preloadHints=s.preloadHints||[],s.preloadHints.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=n?h:0,n&&(h=i.byterange.offset+i.byterange.length)));const r=s.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${r} for segment #${t}`,e.attributes,["TYPE","URI"]),i.type)for(let e=0;e<s.preloadHints.length-1;e++){const n=s.preloadHints[e];n.type&&(n.type===i.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${r} for segment #${t} has the same TYPE ${i.type} as preload hint #${e}`}))}},"rendition-report"(){const t=Me(e.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);const i=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];a&&n.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${i}`,e.attributes,n)},"part-inf"(){this.manifest.partInf=Me(e.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",e.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),ke.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(Me(e.attributes));const t=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${t}`,e.attributes,["ID","START-DATE"]);const i=this.manifest.dateRanges[t];i.endDate&&i.startDate&&new Date(i.endDate)<new Date(i.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),i.duration&&i.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),i.plannedDuration&&i.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const n=!!i.endOnNext;if(n&&!i.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),n&&(i.duration||i.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),i.duration&&i.endDate){const e=i.startDate.getTime()+1e3*i.duration;this.manifest.dateRanges[t].endDate=new Date(e)}if(d[i.id]){for(const t in d[i.id])if(i[t]&&JSON.stringify(d[i.id][t])!==JSON.stringify(i[t])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const e=this.manifest.dateRanges.findIndex(e=>e.id===i.id);this.manifest.dateRanges[e]=ye(this.manifest.dateRanges[e],i),d[i.id]=ye(d[i.id],i),this.manifest.dateRanges.pop()}else d[i.id]=i},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=Me(e.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",e.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const t=(e,t)=>{e in this.manifest.definitions?this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${e}`}):this.manifest.definitions[e]=t};if("QUERYPARAM"in e.attributes){if("NAME"in e.attributes||"IMPORT"in e.attributes)return void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});const i=this.params.get(e.attributes.QUERYPARAM);return i?void t(e.attributes.QUERYPARAM,decodeURIComponent(i)):void this.trigger("error",{message:`EXT-X-DEFINE: No query param ${e.attributes.QUERYPARAM}`})}return"NAME"in e.attributes?"IMPORT"in e.attributes?void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"}):"VALUE"in e.attributes&&"string"==typeof e.attributes.VALUE?void t(e.attributes.NAME,e.attributes.VALUE):void this.trigger("error",{message:`EXT-X-DEFINE: No value for ${e.attributes.NAME}`}):"IMPORT"in e.attributes?this.mainDefinitions[e.attributes.IMPORT]?void t(e.attributes.IMPORT,this.mainDefinitions[e.attributes.IMPORT]):void this.trigger("error",{message:`EXT-X-DEFINE: No value ${e.attributes.IMPORT} to import, or IMPORT used on main playlist`}):void this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:e.attributes,uri:e.uri,timeline:u}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",e.attributes,["BANDWIDTH","URI"])}}[e.tagType]||o).call(t)},uri(){s.uri=e.uri,i.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),r&&(s.key=r),s.timeline=u,n&&(s.map=n),h=0,null!==this.lastProgramDateTime&&(s.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*s.duration),s={}},comment(){},custom(){e.segment?(s.custom=s.custom||{},s.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,i){const n=[];i.forEach(function(e){t.hasOwnProperty(e)||n.push(e)}),n.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${n.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}};var Pe,Le,De={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},Oe=["video","audio","text"],Re=["Video","Audio","Text"],Ne=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,i){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(i).toString(16)).slice(-2)}):e},Fe=function(e){void 0===e&&(e="");var t=e.split(","),i=[];return t.forEach(function(e){var t;e=e.trim(),Oe.forEach(function(n){var r=De[n].exec(e.toLowerCase());if(r&&!(r.length<=1)){t=n;var s=e.substring(0,r[1].length),a=e.replace(s,"");i.push({type:s,details:a,mediaType:n})}}),t||i.push({type:e,details:"",mediaType:"unknown"})}),i},Ue=function(e){return void 0===e&&(e=""),De.audio.test(e.trim().toLowerCase())},Be=function(e){if(e&&"string"==typeof e){var t,i=e.toLowerCase().split(",").map(function(e){return Ne(e.trim())}),n="video";1===i.length&&Ue(i[0])?n="audio":1===i.length&&(void 0===(t=i[0])&&(t=""),De.text.test(t.trim().toLowerCase()))&&(n="application");var r="mp4";return i.every(function(e){return De.mp4.test(e)})?r="mp4":i.every(function(e){return De.webm.test(e)})?r="webm":i.every(function(e){return De.ogg.test(e)})&&(r="ogg"),n+"/"+r+';codecs="'+e+'"'}},je=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=!1),N.MediaSource&&N.MediaSource.isTypeSupported&&N.MediaSource.isTypeSupported(Be(e))||t&&N.ManagedMediaSource&&N.ManagedMediaSource.isTypeSupported&&N.ManagedMediaSource.isTypeSupported(Be(e))||!1},ze=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every(function(e){e=e.trim();for(var t=0;t<Re.length;t++){if(De["muxer"+Re[t]].test(e))return!0}return!1})},Ve="mp4a.40.2",He=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,qe=/^application\/dash\+xml/i,Ge=function(e){return He.test(e)?"hls":qe.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null},We=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},$e=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||We(e)||e instanceof ArrayBuffer||(e="number"!=typeof e||"number"==typeof e&&e!=e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},Xe=N.BigInt||Number,Ye=[Xe("0x1"),Xe("0x100"),Xe("0x10000"),Xe("0x1000000"),Xe("0x100000000"),Xe("0x10000000000"),Xe("0x1000000000000"),Xe("0x100000000000000"),Xe("0x10000000000000000")];Pe=new Uint16Array([65484]),255===(Le=new Uint8Array(Pe.buffer,Pe.byteOffset,Pe.byteLength))[0]||Le[0];var Qe,Ke,Ze=function(e,t){var i=void 0===t?{}:t,n=i.signed,r=void 0!==n&&n,s=i.le,a=void 0!==s&&s;e=$e(e);var o=a?"reduce":"reduceRight",l=(e[o]?e[o]:Array.prototype[o]).call(e,function(t,i,n){var r=a?n:Math.abs(n+1-e.length);return t+Xe(i)*Ye[r]},Xe(0));if(r){var u=Ye[e.length]/Xe(2)-Xe(1);(l=Xe(l))>u&&(l-=u,l-=u,l-=Xe(2))}return Number(l)},Je=function(e,t){var i={}.le,n=void 0!==i&&i;("bigint"!=typeof e&&"number"!=typeof e||"number"==typeof e&&e!=e)&&(e=0),e=Xe(e);for(var r,s=(r=e,Math.ceil(function(e){return e.toString(2).length}(r)/8)),a=new Uint8Array(new ArrayBuffer(s)),o=0;o<s;o++){var l=n?o:Math.abs(o+1-a.length);a[l]=Number(e/Ye[o]&Xe(255)),e<0&&(a[l]=Math.abs(~a[l]),a[l]-=0===o?1:2)}return a},et=function(e,t){if("string"!=typeof e&&e&&"function"==typeof e.toString&&(e=e.toString()),"string"!=typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i},tt=function(e,t,i){var n=void 0===i?{}:i,r=n.offset,s=void 0===r?0:r,a=n.mask,o=void 0===a?[]:a;e=$e(e);var l=(t=$e(t)).every?t.every:Array.prototype.every;return t.length&&e.length-s>=t.length&&l.call(t,function(t,i){return t===(o[i]?o[i]&e[s+i]:e[s+i])})},it={},nt={},rt={};function st(){if(Qe)return rt;function e(e,t){return void 0===t&&(t=Object),t&&"function"==typeof t.freeze?t.freeze(e):e}Qe=1;var t=e({HTML:"text/html",isHTML:function(e){return e===t.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),i=e({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===i.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return rt.assign=function(e,t){if(null===e||"object"!=typeof e)throw new TypeError("target is not an object");for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},rt.find=function(e,t,i){if(void 0===i&&(i=Array.prototype),e&&"function"==typeof i.find)return i.find.call(e,t);for(var n=0;n<e.length;n++)if(Object.prototype.hasOwnProperty.call(e,n)){var r=e[n];if(t.call(void 0,r,n,e))return r}},rt.freeze=e,rt.MIME_TYPE=t,rt.NAMESPACE=i,rt}function at(){if(Ke)return nt;Ke=1;var e=st(),t=e.find,i=e.NAMESPACE;function n(e){return""!==e}function r(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function s(e){if(!e)return[];var t=function(e){return e?e.split(/[\t\n\f\r ]+/).filter(n):[]}(e);return Object.keys(t.reduce(r,{}))}function a(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}function o(e,t){var i=e.prototype;if(!(i instanceof t)){let n=function(){};n.prototype=t.prototype,n=new n,a(i,n),e.prototype=i=n}i.constructor!=e&&(i.constructor=e)}var l={},u=l.ELEMENT_NODE=1,c=l.ATTRIBUTE_NODE=2,h=l.TEXT_NODE=3,d=l.CDATA_SECTION_NODE=4,p=l.ENTITY_REFERENCE_NODE=5,f=l.ENTITY_NODE=6,m=l.PROCESSING_INSTRUCTION_NODE=7,g=l.COMMENT_NODE=8,y=l.DOCUMENT_NODE=9,v=l.DOCUMENT_TYPE_NODE=10,_=l.DOCUMENT_FRAGMENT_NODE=11,b=l.NOTATION_NODE=12,T={},S={};T.INDEX_SIZE_ERR=(S[1]="Index size error",1),T.DOMSTRING_SIZE_ERR=(S[2]="DOMString size error",2);var w=T.HIERARCHY_REQUEST_ERR=(S[3]="Hierarchy request error",3);T.WRONG_DOCUMENT_ERR=(S[4]="Wrong document",4),T.INVALID_CHARACTER_ERR=(S[5]="Invalid character",5),T.NO_DATA_ALLOWED_ERR=(S[6]="No data allowed",6),T.NO_MODIFICATION_ALLOWED_ERR=(S[7]="No modification allowed",7);var x=T.NOT_FOUND_ERR=(S[8]="Not found",8);T.NOT_SUPPORTED_ERR=(S[9]="Not supported",9);var A=T.INUSE_ATTRIBUTE_ERR=(S[10]="Attribute in use",10);function E(e,t){if(t instanceof Error)var i=t;else i=this,Error.call(this,S[e]),this.message=S[e],Error.captureStackTrace&&Error.captureStackTrace(this,E);return i.code=e,t&&(this.message=this.message+": "+t),i}function C(){}function M(e,t){this._node=e,this._refresh=t,k(this)}function k(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!==t){var i=e._refresh(e._node);if(ge(e,"length",i.length),!e.$$length||i.length<e.$$length)for(var n=i.length;n in e;n++)Object.prototype.hasOwnProperty.call(e,n)&&delete e[n];a(i,e),e._inc=t}}function I(){}function P(e,t){for(var i=e.length;i--;)if(e[i]===t)return i}function L(e,t,n,r){if(r?t[P(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var s=e.ownerDocument;s&&(r&&B(s,e,r),function(e,t,n){e&&e._inc++;var r=n.namespaceURI;r===i.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(s,e,n))}}function D(e,t,i){var n=P(t,i);if(!(n>=0))throw new E(x,new Error(e.tagName+"@"+i));for(var r=t.length-1;n<r;)t[n]=t[++n];if(t.length=r,e){var s=e.ownerDocument;s&&(B(s,e,i),i.ownerElement=null)}}function O(){}function R(){}function N(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function F(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(F(e,t))return!0}while(e=e.nextSibling)}function U(){this.ownerDocument=this}function B(e,t,n,r){e&&e._inc++,n.namespaceURI===i.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function j(e,t,i){if(e&&e._inc){e._inc++;var n=t.childNodes;if(i)n[n.length++]=i;else{for(var r=t.firstChild,s=0;r;)n[s++]=r,r=r.nextSibling;n.length=s,delete n[n.length]}}}function z(e,t){var i=t.previousSibling,n=t.nextSibling;return i?i.nextSibling=n:e.firstChild=n,n?n.previousSibling=i:e.lastChild=i,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,j(e.ownerDocument,e),t}function V(e){return e&&e.nodeType===R.DOCUMENT_TYPE_NODE}function H(e){return e&&e.nodeType===R.ELEMENT_NODE}function q(e){return e&&e.nodeType===R.TEXT_NODE}function G(e,i){var n=e.childNodes||[];if(t(n,H)||V(i))return!1;var r=t(n,V);return!(i&&r&&n.indexOf(r)>n.indexOf(i))}function W(e,i){var n=e.childNodes||[];if(t(n,function(e){return H(e)&&e!==i}))return!1;var r=t(n,V);return!(i&&r&&n.indexOf(r)>n.indexOf(i))}function $(e,t,i){if(!function(e){return e&&(e.nodeType===R.DOCUMENT_NODE||e.nodeType===R.DOCUMENT_FRAGMENT_NODE||e.nodeType===R.ELEMENT_NODE)}(e))throw new E(w,"Unexpected parent node type "+e.nodeType);if(i&&i.parentNode!==e)throw new E(x,"child not in parent");if(!function(e){return e&&(H(e)||q(e)||V(e)||e.nodeType===R.DOCUMENT_FRAGMENT_NODE||e.nodeType===R.COMMENT_NODE||e.nodeType===R.PROCESSING_INSTRUCTION_NODE)}(t)||V(t)&&e.nodeType!==R.DOCUMENT_NODE)throw new E(w,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function X(e,i,n){var r=e.childNodes||[],s=i.childNodes||[];if(i.nodeType===R.DOCUMENT_FRAGMENT_NODE){var a=s.filter(H);if(a.length>1||t(s,q))throw new E(w,"More than one element or text in fragment");if(1===a.length&&!G(e,n))throw new E(w,"Element in fragment can not be inserted before doctype")}if(H(i)&&!G(e,n))throw new E(w,"Only one element can be added and only after doctype");if(V(i)){if(t(r,V))throw new E(w,"Only one doctype is allowed");var o=t(r,H);if(n&&r.indexOf(o)<r.indexOf(n))throw new E(w,"Doctype can only be inserted before an element");if(!n&&o)throw new E(w,"Doctype can not be appended since element is present")}}function Y(e,i,n){var r=e.childNodes||[],s=i.childNodes||[];if(i.nodeType===R.DOCUMENT_FRAGMENT_NODE){var a=s.filter(H);if(a.length>1||t(s,q))throw new E(w,"More than one element or text in fragment");if(1===a.length&&!W(e,n))throw new E(w,"Element in fragment can not be inserted before doctype")}if(H(i)&&!W(e,n))throw new E(w,"Only one element can be added and only after doctype");if(V(i)){if(t(r,function(e){return V(e)&&e!==n}))throw new E(w,"Only one doctype is allowed");var o=t(r,H);if(n&&r.indexOf(o)<r.indexOf(n))throw new E(w,"Doctype can only be inserted before an element")}}function Q(e,t,i,n){$(e,t,i),e.nodeType===R.DOCUMENT_NODE&&(n||X)(e,t,i);var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===_){var s=t.firstChild;if(null==s)return t;var a=t.lastChild}else s=a=t;var o=i?i.previousSibling:e.lastChild;s.previousSibling=o,a.nextSibling=i,o?o.nextSibling=s:e.firstChild=s,null==i?e.lastChild=a:i.previousSibling=a;do{s.parentNode=e}while(s!==a&&(s=s.nextSibling));return j(e.ownerDocument||e,e),t.nodeType==_&&(t.firstChild=t.lastChild=null),t}function K(){this._nsMap={}}function Z(){}function J(){}function ee(){}function te(){}function ie(){}function ne(){}function re(){}function se(){}function ae(){}function oe(){}function le(){}function ue(){}function ce(e,t){var i=[],n=9==this.nodeType&&this.documentElement||this,r=n.prefix,s=n.namespaceURI;if(s&&null==r&&null==(r=n.lookupPrefix(s)))var a=[{namespace:s,prefix:null}];return pe(this,i,e,t,a),i.join("")}function he(e,t,n){var r=e.prefix||"",s=e.namespaceURI;if(!s)return!1;if("xml"===r&&s===i.XML||s===i.XMLNS)return!1;for(var a=n.length;a--;){var o=n[a];if(o.prefix===r)return o.namespace!==s}return!0}function de(e,t,i){e.push(" ",t,'="',i.replace(/[<>&"\t\n\r]/g,N),'"')}function pe(e,t,n,r,s){if(s||(s=[]),r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case u:var a=e.attributes,o=a.length,l=e.firstChild,f=e.tagName,b=f;if(!(n=i.isHTML(e.namespaceURI)||n)&&!e.prefix&&e.namespaceURI){for(var T,S=0;S<a.length;S++)if("xmlns"===a.item(S).name){T=a.item(S).value;break}if(!T)for(var w=s.length-1;w>=0;w--){if(""===(x=s[w]).prefix&&x.namespace===e.namespaceURI){T=x.namespace;break}}if(T!==e.namespaceURI)for(w=s.length-1;w>=0;w--){var x;if((x=s[w]).namespace===e.namespaceURI){x.prefix&&(b=x.prefix+":"+f);break}}}t.push("<",b);for(var A=0;A<o;A++){"xmlns"==(E=a.item(A)).prefix?s.push({prefix:E.localName,namespace:E.value}):"xmlns"==E.nodeName&&s.push({prefix:"",namespace:E.value})}for(A=0;A<o;A++){var E,C,M;if(he(E=a.item(A),0,s))de(t,(C=E.prefix||"")?"xmlns:"+C:"xmlns",M=E.namespaceURI),s.push({prefix:C,namespace:M});pe(E,t,n,r,s)}if(f===b&&he(e,0,s))de(t,(C=e.prefix||"")?"xmlns:"+C:"xmlns",M=e.namespaceURI),s.push({prefix:C,namespace:M});if(l||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(f)){if(t.push(">"),n&&/^script$/i.test(f))for(;l;)l.data?t.push(l.data):pe(l,t,n,r,s.slice()),l=l.nextSibling;else for(;l;)pe(l,t,n,r,s.slice()),l=l.nextSibling;t.push("</",b,">")}else t.push("/>");return;case y:case _:for(l=e.firstChild;l;)pe(l,t,n,r,s.slice()),l=l.nextSibling;return;case c:return de(t,e.name,e.value);case h:return t.push(e.data.replace(/[<&>]/g,N));case d:return t.push("<![CDATA[",e.data,"]]>");case g:return t.push("\x3c!--",e.data,"--\x3e");case v:var k=e.publicId,I=e.systemId;if(t.push("<!DOCTYPE ",e.name),k)t.push(" PUBLIC ",k),I&&"."!=I&&t.push(" ",I),t.push(">");else if(I&&"."!=I)t.push(" SYSTEM ",I,">");else{var P=e.internalSubset;P&&t.push(" [",P,"]"),t.push(">")}return;case m:return t.push("<?",e.target," ",e.data,"?>");case p:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function fe(e,t,i){var n;switch(t.nodeType){case u:(n=t.cloneNode(!1)).ownerDocument=e;case _:break;case c:i=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,i)for(var r=t.firstChild;r;)n.appendChild(fe(e,r,i)),r=r.nextSibling;return n}function me(e,t,i){var n=new t.constructor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=t[r];"object"!=typeof s&&s!=n[r]&&(n[r]=s)}switch(t.childNodes&&(n.childNodes=new C),n.ownerDocument=e,n.nodeType){case u:var a=t.attributes,o=n.attributes=new I,l=a.length;o._ownerElement=n;for(var h=0;h<l;h++)n.setAttributeNode(me(e,a.item(h),!0));break;case c:i=!0}if(i)for(var d=t.firstChild;d;)n.appendChild(me(e,d,i)),d=d.nextSibling;return n}function ge(e,t,i){e[t]=i}T.INVALID_STATE_ERR=(S[11]="Invalid state",11),T.SYNTAX_ERR=(S[12]="Syntax error",12),T.INVALID_MODIFICATION_ERR=(S[13]="Invalid modification",13),T.NAMESPACE_ERR=(S[14]="Invalid namespace",14),T.INVALID_ACCESS_ERR=(S[15]="Invalid access",15),E.prototype=Error.prototype,a(T,E),C.prototype={length:0,item:function(e){return e>=0&&e<this.length?this[e]:null},toString:function(e,t){for(var i=[],n=0;n<this.length;n++)pe(this[n],i,e,t);return i.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},M.prototype.item=function(e){return k(this),this[e]||null},o(M,C),I.prototype={length:0,item:C.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var i=this[t];if(i.nodeName==e)return i}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new E(A);var i=this.getNamedItem(e.nodeName);return L(this._ownerElement,this,e,i),i},setNamedItemNS:function(e){var t,i=e.ownerElement;if(i&&i!=this._ownerElement)throw new E(A);return t=this.getNamedItemNS(e.namespaceURI,e.localName),L(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return D(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);return D(this._ownerElement,this,i),i},getNamedItemNS:function(e,t){for(var i=this.length;i--;){var n=this[i];if(n.localName==t&&n.namespaceURI==e)return n}return null}},O.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,i){var n=new U;if(n.implementation=this,n.childNodes=new C,n.doctype=i||null,i&&n.appendChild(i),t){var r=n.createElementNS(e,t);n.appendChild(r)}return n},createDocumentType:function(e,t,i){var n=new ne;return n.name=e,n.nodeName=e,n.publicId=t||"",n.systemId=i||"",n}},R.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return Q(this,e,t)},replaceChild:function(e,t){Q(this,e,t,Y),t&&this.removeChild(t)},removeChild:function(e){return z(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return me(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==h&&e.nodeType==h?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var i=t._nsMap;if(i)for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)&&i[n]===e)return n;t=t.nodeType==c?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var i=t._nsMap;if(i&&Object.prototype.hasOwnProperty.call(i,e))return i[e];t=t.nodeType==c?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},a(l,R),a(l,R.prototype),U.prototype={nodeName:"#document",nodeType:y,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==_){for(var i=e.firstChild;i;){var n=i.nextSibling;this.insertBefore(i,t),i=n}return e}return Q(this,e,t),e.ownerDocument=this,null===this.documentElement&&e.nodeType===u&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),z(this,e)},replaceChild:function(e,t){Q(this,e,t,Y),e.ownerDocument=this,t&&this.removeChild(t),H(e)&&(this.documentElement=e)},importNode:function(e,t){return fe(this,e,t)},getElementById:function(e){var t=null;return F(this.documentElement,function(i){if(i.nodeType==u&&i.getAttribute("id")==e)return t=i,!0}),t},getElementsByClassName:function(e){var t=s(e);return new M(this,function(i){var n=[];return t.length>0&&F(i.documentElement,function(r){if(r!==i&&r.nodeType===u){var a=r.getAttribute("class");if(a){var o=e===a;if(!o){var l=s(a);o=t.every((c=l,function(e){return c&&-1!==c.indexOf(e)}))}o&&n.push(r)}}var c}),n})},createElement:function(e){var t=new K;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new C,(t.attributes=new I)._ownerElement=t,t},createDocumentFragment:function(){var e=new oe;return e.ownerDocument=this,e.childNodes=new C,e},createTextNode:function(e){var t=new ee;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new te;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new ie;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var i=new le;return i.ownerDocument=this,i.tagName=i.nodeName=i.target=e,i.nodeValue=i.data=t,i},createAttribute:function(e){var t=new Z;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new ae;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var i=new K,n=t.split(":"),r=i.attributes=new I;return i.childNodes=new C,i.ownerDocument=this,i.nodeName=t,i.tagName=t,i.namespaceURI=e,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=t,r._ownerElement=i,i},createAttributeNS:function(e,t){var i=new Z,n=t.split(":");return i.ownerDocument=this,i.nodeName=t,i.name=t,i.namespaceURI=e,i.specified=!0,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=t,i}},o(U,R),K.prototype={nodeType:u,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t,this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===_?this.insertBefore(e,null):function(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,j(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+i,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new M(this,function(t){var i=[];return F(t,function(n){n===t||n.nodeType!=u||"*"!==e&&n.tagName!=e||i.push(n)}),i})},getElementsByTagNameNS:function(e,t){return new M(this,function(i){var n=[];return F(i,function(r){r===i||r.nodeType!==u||"*"!==e&&r.namespaceURI!==e||"*"!==t&&r.localName!=t||n.push(r)}),n})}},U.prototype.getElementsByTagName=K.prototype.getElementsByTagName,U.prototype.getElementsByTagNameNS=K.prototype.getElementsByTagNameNS,o(K,R),Z.prototype.nodeType=c,o(Z,R),J.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(S[w])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){i=this.data.substring(0,e)+i+this.data.substring(e+t),this.nodeValue=this.data=i,this.length=i.length}},o(J,R),ee.prototype={nodeName:"#text",nodeType:h,splitText:function(e){var t=this.data,i=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},o(ee,J),te.prototype={nodeName:"#comment",nodeType:g},o(te,J),ie.prototype={nodeName:"#cdata-section",nodeType:d},o(ie,J),ne.prototype.nodeType=v,o(ne,R),re.prototype.nodeType=b,o(re,R),se.prototype.nodeType=f,o(se,R),ae.prototype.nodeType=p,o(ae,R),oe.prototype.nodeName="#document-fragment",oe.prototype.nodeType=_,o(oe,R),le.prototype.nodeType=m,o(le,R),ue.prototype.serializeToString=function(e,t,i){return ce.call(e,t,i)},R.prototype.toString=ce;try{if(Object.defineProperty){let e=function(t){switch(t.nodeType){case u:case _:var i=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&i.push(e(t)),t=t.nextSibling;return i.join("");default:return t.nodeValue}};Object.defineProperty(M.prototype,"length",{get:function(){return k(this),this.$$length}}),Object.defineProperty(R.prototype,"textContent",{get:function(){return e(this)},set:function(e){switch(this.nodeType){case u:case _:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ge=function(e,t,i){e["$$"+t]=i}}}catch(ye){}return nt.DocumentType=ne,nt.DOMException=E,nt.DOMImplementation=O,nt.Element=K,nt.Node=R,nt.NodeList=C,nt.XMLSerializer=ue,nt}var ot,lt={},ut={};var ct,ht,dt,pt={};function ft(){if(ct)return pt;ct=1;var e=st().NAMESPACE,t=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,i=new RegExp("[\\-\\.0-9"+t.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+t.source+i.source+"*(?::"+t.source+i.source+"*)?$");function r(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,r)}function s(){}function a(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function o(t,i,n,r,s,a){function o(e,t,i){n.attributeNames.hasOwnProperty(e)&&a.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,s),i)}for(var l,u=++i,c=0;;){var h=t.charAt(u);switch(h){case"=":if(1===c)l=t.slice(i,u),c=3;else{if(2!==c)throw new Error("attribute equal must after attrName");c=3}break;case"'":case'"':if(3===c||1===c){if(1===c&&(a.warning('attribute value must after "="'),l=t.slice(i,u)),i=u+1,!((u=t.indexOf(h,i))>0))throw new Error("attribute value no end '"+h+"' match");o(l,d=t.slice(i,u),i-1),c=5}else{if(4!=c)throw new Error('attribute value must after "="');o(l,d=t.slice(i,u),i),a.warning('attribute "'+l+'" missed start quot('+h+")!!"),i=u+1,c=5}break;case"/":switch(c){case 0:n.setTagName(t.slice(i,u));case 5:case 6:case 7:c=7,n.closed=!0;case 4:case 1:break;case 2:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==c&&n.setTagName(t.slice(i,u)),u;case">":switch(c){case 0:n.setTagName(t.slice(i,u));case 5:case 6:case 7:break;case 4:case 1:"/"===(d=t.slice(i,u)).slice(-1)&&(n.closed=!0,d=d.slice(0,-1));case 2:2===c&&(d=l),4==c?(a.warning('attribute "'+d+'" missed quot(")!'),o(l,d,i)):(e.isHTML(r[""])&&d.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+d+'" missed value!! "'+d+'" instead!!'),o(d,d,i));break;case 3:throw new Error("attribute value missed!!")}return u;case"":h=" ";default:if(h<=" ")switch(c){case 0:n.setTagName(t.slice(i,u)),c=6;break;case 1:l=t.slice(i,u),c=2;break;case 4:var d=t.slice(i,u);a.warning('attribute "'+d+'" missed quot(")!!'),o(l,d,i);case 5:c=6}else switch(c){case 2:n.tagName,e.isHTML(r[""])&&l.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+l+'" missed value!! "'+l+'" instead2!!'),o(l,l,i),i=u,c=1;break;case 5:a.warning('attribute space is required"'+l+'"!!');case 6:c=1,i=u;break;case 3:c=4,i=u;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function l(t,i,n){for(var r=t.tagName,s=null,a=t.length;a--;){var o=t[a],l=o.qName,u=o.value;if((f=l.indexOf(":"))>0)var c=o.prefix=l.slice(0,f),d=l.slice(f+1),p="xmlns"===c&&d;else d=l,c=null,p="xmlns"===l&&"";o.localName=d,!1!==p&&(null==s&&(s={},h(n,n={})),n[p]=s[p]=u,o.uri=e.XMLNS,i.startPrefixMapping(p,u))}for(a=t.length;a--;){(c=(o=t[a]).prefix)&&("xml"===c&&(o.uri=e.XML),"xmlns"!==c&&(o.uri=n[c||""]))}var f;(f=r.indexOf(":"))>0?(c=t.prefix=r.slice(0,f),d=t.localName=r.slice(f+1)):(c=null,d=t.localName=r);var m=t.uri=n[c||""];if(i.startElement(m,d,r,t),!t.closed)return t.currentNSMap=n,t.localNSMap=s,!0;if(i.endElement(m,d,r),s)for(c in s)Object.prototype.hasOwnProperty.call(s,c)&&i.endPrefixMapping(c)}function u(e,t,i,n,r){if(/^(?:script|textarea)$/i.test(i)){var s=e.indexOf("</"+i+">",t),a=e.substring(t+1,s);if(/[&<]/.test(a))return/^script$/i.test(i)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,n),r.characters(a,0,a.length),s)}return t+1}function c(e,t,i,n){var r=n[i];return null==r&&((r=e.lastIndexOf("</"+i+">"))<t&&(r=e.lastIndexOf("</"+i)),n[i]=r),r<t}function h(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}function d(e,t,i,n){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(r=e.indexOf("--\x3e",t+4))>t?(i.comment(e,t+4,r-t-4),r+3):(n.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var r=e.indexOf("]]>",t+9);return i.startCDATA(),i.characters(e,t+9,r-t-9),i.endCDATA(),r+3}var s=function(e,t){var i,n=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=t,r.exec(e);for(;i=r.exec(e);)if(n.push(i),i[1])return n}(e,t),a=s.length;if(a>1&&/!doctype/i.test(s[0][0])){var o=s[1][0],l=!1,u=!1;a>3&&(/^public$/i.test(s[2][0])?(l=s[3][0],u=a>4&&s[4][0]):/^system$/i.test(s[2][0])&&(u=s[3][0]));var c=s[a-1];return i.startDTD(o,l,u),i.endDTD(),c.index+c[0].length}return-1}function p(e,t,i){var n=e.indexOf("?>",t);if(n){var r=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return r?(r[0].length,i.processingInstruction(r[1],r[2]),n+2):-1}return-1}function f(){this.attributeNames={}}return r.prototype=new Error,r.prototype.name=r.name,s.prototype={parse:function(t,i,n){var s=this.domBuilder;s.startDocument(),h(i,i={}),function(t,i,n,s,h){function m(e){if(e>65535){var t=55296+((e-=65536)>>10),i=56320+(1023&e);return String.fromCharCode(t,i)}return String.fromCharCode(e)}function g(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?m(parseInt(t.substr(1).replace("x","0x"))):(h.error("entity not found:"+e),e)}function y(e){if(e>A){var i=t.substring(A,e).replace(/&#?\w+;/g,g);S&&v(A),s.characters(i,0,e-A),A=e}}function v(e,i){for(;e>=b&&(i=T.exec(t));)_=i.index,b=_+i[0].length,S.lineNumber++;S.columnNumber=e-_+1}var _=0,b=0,T=/.*(?:\r\n?|\n)|.*$/g,S=s.locator,w=[{currentNSMap:i}],x={},A=0;for(;;){try{var E=t.indexOf("<",A);if(E<0){if(!t.substr(A).match(/^\s*$/)){var C=s.doc,M=C.createTextNode(t.substr(A));C.appendChild(M),s.currentElement=M}return}switch(E>A&&y(E),t.charAt(E+1)){case"/":var k=t.indexOf(">",E+3),I=t.substring(E+2,k).replace(/[ \t\n\r]+$/g,""),P=w.pop();k<0?(I=t.substring(E+2).replace(/[\s<].*/,""),h.error("end tag name: "+I+" is not complete:"+P.tagName),k=E+1+I.length):I.match(/\s</)&&(I=I.replace(/[\s<].*/,""),h.error("end tag name: "+I+" maybe not complete"),k=E+1+I.length);var L=P.localNSMap,D=P.tagName==I;if(D||P.tagName&&P.tagName.toLowerCase()==I.toLowerCase()){if(s.endElement(P.uri,P.localName,I),L)for(var O in L)Object.prototype.hasOwnProperty.call(L,O)&&s.endPrefixMapping(O);D||h.fatalError("end tag name: "+I+" is not match the current start tagName:"+P.tagName)}else w.push(P);k++;break;case"?":S&&v(E),k=p(t,E,s);break;case"!":S&&v(E),k=d(t,E,s,h);break;default:S&&v(E);var R=new f,N=w[w.length-1].currentNSMap,F=(k=o(t,E,R,N,g,h),R.length);if(!R.closed&&c(t,k,R.tagName,x)&&(R.closed=!0,n.nbsp||h.warning("unclosed xml attribute")),S&&F){for(var U=a(S,{}),B=0;B<F;B++){var j=R[B];v(j.offset),j.locator=a(S,{})}s.locator=U,l(R,s,N)&&w.push(R),s.locator=S}else l(R,s,N)&&w.push(R);e.isHTML(R.uri)&&!R.closed?k=u(t,k,R.tagName,g,s):k++}}catch(z){if(z instanceof r)throw z;h.error("element parse error: "+z),k=-1}k>A?A=k:y(Math.max(E,A)+1)}}(t,i,n,s,this.errorHandler),s.endDocument()}},f.prototype={setTagName:function(e){if(!n.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,i){if(!n.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},pt.XMLReader=s,pt.ParseError=r,pt}function mt(){if(ht)return lt;ht=1;var e,t,i=st(),n=at(),r=(ot||(ot=1,e=ut,t=st().freeze,e.XML_ENTITIES=t({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),e.HTML_ENTITIES=t({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),e.entityMap=e.HTML_ENTITIES),ut),s=ft(),a=n.DOMImplementation,o=i.NAMESPACE,l=s.ParseError,u=s.XMLReader;function c(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function h(e){this.options=e||{locator:{}}}function d(){this.cdata=!1}function p(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function f(e,t,i){return"string"==typeof e?e.substr(t,i):e.length>=t+i||t?new java.lang.String(e,t,i)+"":e}function m(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}return h.prototype.parseFromString=function(e,t){var i=this.options,n=new u,s=i.domBuilder||new d,a=i.errorHandler,l=i.locator,h=i.xmlns||{},p=/\/x?html?$/.test(t),f=p?r.HTML_ENTITIES:r.XML_ENTITIES;l&&s.setDocumentLocator(l),n.errorHandler=function(e,t,i){if(!e){if(t instanceof d)return t;e=t}var n={},r=e instanceof Function;function s(t){var s=e[t];!s&&r&&(s=2==e.length?function(i){e(t,i)}:e),n[t]=s&&function(e){s("[xmldom "+t+"]\t"+e+function(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}(i))}||function(){}}return i=i||{},s("warning"),s("error"),s("fatalError"),n}(a,s,l),n.domBuilder=i.domBuilder||s,p&&(h[""]=o.HTML),h.xml=h.xml||o.XML;var m=i.normalizeLineEndings||c;return e&&"string"==typeof e?n.parse(m(e),h,f):n.errorHandler.error("invalid doc source"),s.doc},d.prototype={startDocument:function(){this.doc=(new a).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,i,n){var r=this.doc,s=r.createElementNS(e,i||t),a=n.length;m(this,s),this.currentElement=s,this.locator&&p(this.locator,s);for(var o=0;o<a;o++){e=n.getURI(o);var l=n.getValue(o),u=(i=n.getQName(o),r.createAttributeNS(e,i));this.locator&&p(n.getLocator(o),u),u.value=u.nodeValue=l,s.setAttributeNode(u)}},endElement:function(e,t,i){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&p(this.locator,i),m(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){if(e=f.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&p(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,i){e=f.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&p(this.locator,n),m(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,i){var n=this.doc.implementation;if(n&&n.createDocumentType){var r=n.createDocumentType(e,t,i);this.locator&&p(this.locator,r),m(this,r),this.doc.doctype=r}},warning:function(e){},error:function(e){},fatalError:function(e){throw new l(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){d.prototype[e]=function(){return null}}),lt.__DOMHandler=d,lt.normalizeLineEndings=c,lt.DOMParser=h,lt}var gt=function(){if(dt)return it;dt=1;var e=at();return it.DOMImplementation=e.DOMImplementation,it.XMLSerializer=e.XMLSerializer,it.DOMParser=mt().DOMParser,it}();const yt=e=>!!e&&"object"==typeof e,vt=(...e)=>e.reduce((e,t)=>("object"!=typeof t||Object.keys(t).forEach(i=>{Array.isArray(e[i])&&Array.isArray(t[i])?e[i]=e[i].concat(t[i]):yt(e[i])&&yt(t[i])?e[i]=vt(e[i],t[i]):e[i]=t[i]}),e),{}),_t=e=>Object.keys(e).map(t=>e[t]),bt=e=>e.reduce((e,t)=>e.concat(t),[]),Tt=e=>{if(!e.length)return[];const t=[];for(let i=0;i<e.length;i++)t.push(e[i]);return t};var St="INVALID_NUMBER_OF_PERIOD",wt="DASH_EMPTY_MANIFEST",xt="DASH_INVALID_XML",At="NO_BASE_URL",Et="SEGMENT_TIME_UNSPECIFIED",Ct="UNSUPPORTED_UTC_TIMING_SCHEME";const Mt=({baseUrl:e="",source:t="",range:i="",indexRange:n=""})=>{const r={uri:t,resolvedUri:_e(e||"",t)};if(i||n){const e=(i||n).split("-");let t,s=N.BigInt?N.BigInt(e[0]):parseInt(e[0],10),a=N.BigInt?N.BigInt(e[1]):parseInt(e[1],10);s<Number.MAX_SAFE_INTEGER&&"bigint"==typeof s&&(s=Number(s)),a<Number.MAX_SAFE_INTEGER&&"bigint"==typeof a&&(a=Number(a)),t="bigint"==typeof a||"bigint"==typeof s?N.BigInt(a)-N.BigInt(s)+N.BigInt(1):a-s+1,"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),r.byterange={length:t,offset:s}}return r},kt=e=>(e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e),It={static(e){const{duration:t,timescale:i=1,sourceDuration:n,periodDuration:r}=e,s=kt(e.endNumber),a=t/i;return"number"==typeof s?{start:0,end:s}:"number"==typeof r?{start:0,end:r/a}:{start:0,end:n/a}},dynamic(e){const{NOW:t,clientOffset:i,availabilityStartTime:n,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=e,u=kt(e.endNumber),c=(t+i)/1e3,h=n+a,d=c+o-h,p=Math.ceil(d*r/s),f=Math.floor((c-h-l)*r/s),m=Math.floor((c-h)*r/s);return{start:Math.max(0,f),end:"number"==typeof u?u:Math.min(p,m)}}},Pt=e=>{const{type:t,duration:i,timescale:n=1,periodDuration:r,sourceDuration:s}=e,{start:a,end:o}=It[t](e),l=((e,t)=>{const i=[];for(let n=e;n<t;n++)i.push(n);return i})(a,o).map((e=>t=>{const{duration:i,timescale:n=1,periodStart:r,startNumber:s=1}=e;return{number:s+t,duration:i/n,timeline:r,time:t*i}})(e));if("static"===t){const e=l.length-1,t="number"==typeof r?r:s;l[e].duration=t-i/n*e}return l},Lt=e=>{const{baseUrl:t,initialization:i={},sourceDuration:n,indexRange:r="",periodStart:s,presentationTime:a,number:o=0,duration:l}=e;if(!t)throw new Error(At);const u=Mt({baseUrl:t,source:i.sourceURL,range:i.range}),c=Mt({baseUrl:t,source:t,indexRange:r});if(c.map=u,l){const t=Pt(e);t.length&&(c.duration=t[0].duration,c.timeline=t[0].timeline)}else n&&(c.duration=n,c.timeline=s);return c.presentationTime=a||s,c.number=o,[c]},Dt=(e,t,i)=>{const n=e.sidx.map?e.sidx.map:null,r=e.sidx.duration,s=e.timeline||0,a=e.sidx.byterange,o=a.offset+a.length,l=t.timescale,u=t.references.filter(e=>1!==e.referenceType),c=[],h=e.endList?"static":"dynamic",d=e.sidx.timeline;let p,f=d,m=e.mediaSequence||0;p="bigint"==typeof t.firstOffset?N.BigInt(o)+t.firstOffset:o+t.firstOffset;for(let g=0;g<u.length;g++){const e=t.references[g],a=e.referencedSize,o=e.subsegmentDuration;let u;u="bigint"==typeof p?p+N.BigInt(a)-N.BigInt(1):p+a-1;const y=Lt({baseUrl:i,timescale:l,timeline:s,periodStart:d,presentationTime:f,number:m,duration:o,sourceDuration:r,indexRange:`${p}-${u}`,type:h})[0];n&&(y.map=n),c.push(y),p+="bigint"==typeof p?N.BigInt(a):a,f+=o/l,m++}return e.segments=c,e},Ot=["AUDIO","SUBTITLES"],Rt=1/60,Nt=e=>{return(t=e,i=({timeline:e})=>e,_t(t.reduce((e,t)=>(t.forEach(t=>{e[i(t)]=t}),e),{}))).sort((e,t)=>e.timeline>t.timeline?1:-1);var t,i},Ft=e=>{let t=[];var i,n;return i=e,n=(e,i,n,r)=>{t=t.concat(e.playlists||[])},Ot.forEach(function(e){for(var t in i.mediaGroups[e])for(var r in i.mediaGroups[e][t]){var s=i.mediaGroups[e][t][r];n(s,e,t,r)}}),t},Ut=({playlist:e,mediaSequence:t})=>{e.mediaSequence=t,e.segments.forEach((t,i)=>{t.number=e.mediaSequence+i})},Bt=({oldManifest:e,newManifest:t})=>{const i=e.playlists.concat(Ft(e)),n=t.playlists.concat(Ft(t));return t.timelineStarts=Nt([e.timelineStarts,t.timelineStarts]),(({oldPlaylists:e,newPlaylists:t,timelineStarts:i})=>{t.forEach(t=>{t.discontinuitySequence=i.findIndex(function({timeline:e}){return e===t.timeline});const n=((e,t)=>{for(let i=0;i<e.length;i++)if(e[i].attributes.NAME===t)return e[i];return null})(e,t.attributes.NAME);if(!n)return;if(t.sidx)return;const r=t.segments[0],s=n.segments.findIndex(function(e){return Math.abs(e.presentationTime-r.presentationTime)<Rt});if(-1===s)return Ut({playlist:t,mediaSequence:n.mediaSequence+n.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!n.segments.length&&t.timeline>n.timeline||n.segments.length&&t.timeline>n.segments[n.segments.length-1].timeline)&&t.discontinuitySequence--);n.segments[s].discontinuity&&!r.discontinuity&&(r.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),Ut({playlist:t,mediaSequence:n.segments[s].number})})})({oldPlaylists:i,newPlaylists:n,timelineStarts:t.timelineStarts}),t},jt=e=>e&&e.uri+"-"+(e=>{let t;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?N.BigInt(e.offset)+N.BigInt(e.length)-N.BigInt(1):e.offset+e.length-1,`${e.offset}-${t}`})(e.byterange),zt=e=>{const t=e.reduce(function(e,t){return e[t.attributes.baseUrl]||(e[t.attributes.baseUrl]=[]),e[t.attributes.baseUrl].push(t),e},{});let i=[];return Object.values(t).forEach(e=>{const t=_t(e.reduce((e,t)=>{const i=t.attributes.id+(t.attributes.lang||"");return e[i]?(t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),e[i].segments.push(...t.segments)),t.attributes.contentProtection&&(e[i].attributes.contentProtection=t.attributes.contentProtection)):(e[i]=t,e[i].attributes.timelineStarts=[]),e[i].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e},{}));i=i.concat(t)}),i.map(e=>{var t,i;return e.discontinuityStarts=(t=e.segments||[],i="discontinuity",t.reduce((e,t,n)=>(t[i]&&e.push(n),e),[])),e})},Vt=(e,t)=>{const i=jt(e.sidx),n=i&&t[i]&&t[i].sidx;return n&&Dt(e,n,e.sidx.resolvedUri),e},Ht=(e,t={})=>{if(!Object.keys(t).length)return e;for(const i in e)e[i]=Vt(e[i],t);return e},qt=({attributes:e,segments:t,sidx:i,discontinuityStarts:n})=>{const r={attributes:{NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuityStarts:n,timelineStarts:e.timelineStarts,segments:t};return e.frameRate&&(r.attributes["FRAME-RATE"]=e.frameRate),e.contentProtection&&(r.contentProtection=e.contentProtection),e.serviceLocation&&(r.attributes.serviceLocation=e.serviceLocation),i&&(r.sidx=i),r},Gt=({attributes:e})=>"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType,Wt=({attributes:e})=>"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType,$t=({attributes:e})=>"text/vtt"===e.mimeType||"text"===e.contentType,Xt=e=>e?Object.keys(e).reduce((t,i)=>{const n=e[i];return t.concat(n.playlists)},[]):[],Yt=({dashPlaylists:e,locations:t,contentSteering:i,sidxMapping:n={},previousManifest:r,eventStream:s})=>{if(!e.length)return{};const{sourceDuration:a,type:o,suggestedPresentationDelay:l,minimumUpdatePeriod:u}=e[0].attributes,c=zt(e.filter(Gt)).map(qt),h=zt(e.filter(Wt)),d=zt(e.filter($t)),p=e.map(e=>e.attributes.captionServices).filter(Boolean),f={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:a,playlists:Ht(c,n)};u>=0&&(f.minimumUpdatePeriod=1e3*u),t&&(f.locations=t),i&&(f.contentSteering=i),"dynamic"===o&&(f.suggestedPresentationDelay=l),s&&s.length>0&&(f.eventStream=s);const m=0===f.playlists.length,g=h.length?((e,t={},i=!1)=>{let n;const r=e.reduce((e,r)=>{const s=r.attributes.role&&r.attributes.role.value||"",a=r.attributes.lang||"";let o=r.attributes.label||"main";if(a&&!r.attributes.label){const e=s?` (${s})`:"";o=`${r.attributes.lang}${e}`}e[o]||(e[o]={language:a,autoselect:!0,default:"main"===s,playlists:[],uri:""});const l=Vt((({attributes:e,segments:t,sidx:i,mediaSequence:n,discontinuitySequence:r,discontinuityStarts:s},a)=>{const o={attributes:{NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs,"PROGRAM-ID":1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuitySequence:r,discontinuityStarts:s,timelineStarts:e.timelineStarts,mediaSequence:n,segments:t};return e.contentProtection&&(o.contentProtection=e.contentProtection),e.serviceLocation&&(o.attributes.serviceLocation=e.serviceLocation),i&&(o.sidx=i),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o})(r,i),t);return e[o].playlists.push(l),void 0===n&&"main"===s&&(n=r,n.default=!0),e},{});n||(r[Object.keys(r)[0]].default=!0);return r})(h,n,m):null,y=d.length?((e,t={})=>e.reduce((e,i)=>{const n=i.attributes.label||i.attributes.lang||"text",r=i.attributes.lang||"und";return e[n]||(e[n]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),e[n].playlists.push(Vt((({attributes:e,segments:t,mediaSequence:i,discontinuityStarts:n,discontinuitySequence:r})=>{void 0===t&&(t=[{uri:e.baseUrl,timeline:e.periodStart,resolvedUri:e.baseUrl||"",duration:e.sourceDuration,number:0}],e.duration=e.sourceDuration);const s={NAME:e.id,BANDWIDTH:e.bandwidth,"PROGRAM-ID":1};e.codecs&&(s.CODECS=e.codecs);const a={attributes:s,uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,timelineStarts:e.timelineStarts,discontinuityStarts:n,discontinuitySequence:r,mediaSequence:i,segments:t};return e.serviceLocation&&(a.attributes.serviceLocation=e.serviceLocation),a})(i),t)),e},{}))(d,n):null,v=c.concat(Xt(g),Xt(y)),_=v.map(({timelineStarts:e})=>e);var b,T;return f.timelineStarts=Nt(_),b=v,T=f.timelineStarts,b.forEach(e=>{e.mediaSequence=0,e.discontinuitySequence=T.findIndex(function({timeline:t}){return t===e.timeline}),e.segments&&e.segments.forEach((e,t)=>{e.number=t})}),g&&(f.mediaGroups.AUDIO.audio=g),y&&(f.mediaGroups.SUBTITLES.subs=y),p.length&&(f.mediaGroups["CLOSED-CAPTIONS"].cc=p.reduce((e,t)=>t?(t.forEach(t=>{const{channel:i,language:n}=t;e[n]={autoselect:!1,default:!1,instreamId:i,language:n},t.hasOwnProperty("aspectRatio")&&(e[n].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[n].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[n]["3D"]=t["3D"])}),e):e,{})),r?Bt({oldManifest:r,newManifest:f}):f},Qt=(e,t,i)=>{const{NOW:n,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:l=0}=e,u=(n+r)/1e3+l-(s+o);return Math.ceil((u*a-t)/i)},Kt=(e,t)=>{const{type:i,minimumUpdatePeriod:n=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:o=1,periodStart:l}=e,u=[];let c=-1;for(let h=0;h<t.length;h++){const d=t[h],p=d.d,f=d.r||0,m=d.t||0;let g;if(c<0&&(c=m),m&&m>c&&(c=m),f<0){const o=h+1;g=o===t.length?"dynamic"===i&&n>0&&r.indexOf("$Number$")>0?Qt(e,c,p):(s*a-c)/p:(t[o].t-c)/p}else g=f+1;const y=o+u.length+g;let v=o+u.length;for(;v<y;)u.push({number:v,duration:p/a,time:c,timeline:l}),c+=p,v++}return u},Zt=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Jt=(e,t)=>e.replace(Zt,(e=>(t,i,n,r)=>{if("$$"===t)return"$";if(void 0===e[i])return t;const s=""+e[i];return"RepresentationID"===i?s:(r=n?parseInt(r,10):1,s.length>=r?s:`${new Array(r-s.length+1).join("0")}${s}`)})(t)),ei=(e,t)=>{const i={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:n={sourceURL:"",range:""}}=e,r=Mt({baseUrl:e.baseUrl,source:Jt(n.sourceURL,i),range:n.range}),s=((e,t)=>e.duration||t?e.duration?Pt(e):Kt(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}])(e,t);return s.map(t=>{i.Number=t.number,i.Time=t.time;const n=Jt(e.media||"",i),s=e.timescale||1,a=e.presentationTimeOffset||0,o=e.periodStart+(t.time-a)/s;return{uri:n,timeline:t.timeline,duration:t.duration,resolvedUri:_e(e.baseUrl||"",n),map:r,number:t.number,presentationTime:o}})},ti=(e,t)=>{const{duration:i,segmentUrls:n=[],periodStart:r}=e;if(!i&&!t||i&&t)throw new Error(Et);const s=n.map(t=>((e,t)=>{const{baseUrl:i,initialization:n={}}=e,r=Mt({baseUrl:i,source:n.sourceURL,range:n.range}),s=Mt({baseUrl:i,source:t.media,range:t.mediaRange});return s.map=r,s})(e,t));let a;i&&(a=Pt(e)),t&&(a=Kt(e,t));return a.map((t,i)=>{if(s[i]){const n=s[i],a=e.timescale||1,o=e.presentationTimeOffset||0;return n.timeline=t.timeline,n.duration=t.duration,n.number=t.number,n.presentationTime=r+(t.time-o)/a,n}}).filter(e=>e)},ii=({attributes:e,segmentInfo:t})=>{let i,n;t.template?(n=ei,i=vt(e,t.template)):t.base?(n=Lt,i=vt(e,t.base)):t.list&&(n=ti,i=vt(e,t.list));const r={attributes:e};if(!n)return r;const s=n(i,t.segmentTimeline);if(i.duration){const{duration:e,timescale:t=1}=i;i.duration=e/t}else s.length?i.duration=s.reduce((e,t)=>Math.max(e,Math.ceil(t.duration)),0):i.duration=0;return r.attributes=i,r.segments=s,t.base&&i.indexRange&&(r.sidx=s[0],r.segments=[]),r},ni=(e,t)=>Tt(e.childNodes).filter(({tagName:e})=>e===t),ri=e=>e.textContent.trim(),si=e=>{const t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;const[i,n,r,s,a,o]=t.slice(1);return 31536e3*parseFloat(i||0)+2592e3*parseFloat(n||0)+86400*parseFloat(r||0)+3600*parseFloat(s||0)+60*parseFloat(a||0)+parseFloat(o||0)},ai={mediaPresentationDuration:e=>si(e),availabilityStartTime(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:e=>si(e),suggestedPresentationDelay:e=>si(e),type:e=>e,timeShiftBufferDepth:e=>si(e),start:e=>si(e),width:e=>parseInt(e,10),height:e=>parseInt(e,10),bandwidth:e=>parseInt(e,10),frameRate:e=>(e=>parseFloat(e.split("/").reduce((e,t)=>e/t)))(e),startNumber:e=>parseInt(e,10),timescale:e=>parseInt(e,10),presentationTimeOffset:e=>parseInt(e,10),duration(e){const t=parseInt(e,10);return isNaN(t)?si(e):t},d:e=>parseInt(e,10),t:e=>parseInt(e,10),r:e=>parseInt(e,10),presentationTime:e=>parseInt(e,10),DEFAULT:e=>e},oi=e=>e&&e.attributes?Tt(e.attributes).reduce((e,t)=>{const i=ai[t.name]||ai.DEFAULT;return e[t.name]=i(t.value),e},{}):{},li={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},ui=(e,t)=>t.length?bt(e.map(function(e){return t.map(function(t){const i=ri(t),n=_e(e.baseUrl,i),r=vt(oi(t),{baseUrl:n});return n!==i&&!r.serviceLocation&&e.serviceLocation&&(r.serviceLocation=e.serviceLocation),r})})):e,ci=e=>{const t=ni(e,"SegmentTemplate")[0],i=ni(e,"SegmentList")[0],n=i&&ni(i,"SegmentURL").map(e=>vt({tag:"SegmentURL"},oi(e))),r=ni(e,"SegmentBase")[0],s=i||t,a=s&&ni(s,"SegmentTimeline")[0],o=i||r||t,l=o&&ni(o,"Initialization")[0],u=t&&oi(t);u&&l?u.initialization=l&&oi(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const c={template:u,segmentTimeline:a&&ni(a,"S").map(e=>oi(e)),list:i&&vt(oi(i),{segmentUrls:n,initialization:oi(l)}),base:r&&vt(oi(r),{initialization:oi(l)})};return Object.keys(c).forEach(e=>{c[e]||delete c[e]}),c},hi=e=>bt(ni(e.node,"EventStream").map(t=>{const i=oi(t),n=i.schemeIdUri;return ni(t,"Event").map(t=>{const r=oi(t),s=r.presentationTime||0,a=i.timescale||1,o=r.duration||0,l=s/a+e.attributes.start;return{schemeIdUri:n,value:i.value,id:r.id,start:l,end:l+o/a,messageData:ri(t)||r.messageData,contentEncoding:i.contentEncoding,presentationTimeOffset:i.presentationTimeOffset||0}})})),di=(e,t,i)=>n=>{const r=oi(n),s=ui(t,ni(n,"BaseURL")),a=ni(n,"Role")[0],o={role:oi(a)};let l=vt(e,r,o);const u=ni(n,"Accessibility")[0],c=(e=>{if("urn:scte:dash:cc:cea-608:2015"===e.schemeIdUri)return("string"!=typeof e.value?[]:e.value.split(";")).map(e=>{let t,i;return i=e,/^CC\d=/.test(e)?[t,i]=e.split("="):/^CC\d$/.test(e)&&(t=e),{channel:t,language:i}});if("urn:scte:dash:cc:cea-708:2015"===e.schemeIdUri)return("string"!=typeof e.value?[]:e.value.split(";")).map(e=>{const t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){const[i,n=""]=e.split("=");t.channel=i,t.language=e,n.split(",").forEach(e=>{const[i,n]=e.split(":");"lang"===i?t.language=n:"er"===i?t.easyReader=Number(n):"war"===i?t.aspectRatio=Number(n):"3D"===i&&(t["3D"]=Number(n))})}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})})(oi(u));c&&(l=vt(l,{captionServices:c}));const h=ni(n,"Label")[0];if(h&&h.childNodes.length){const e=h.childNodes[0].nodeValue.trim();l=vt(l,{label:e})}const d=ni(n,"ContentProtection").reduce((e,t)=>{const i=oi(t);i.schemeIdUri&&(i.schemeIdUri=i.schemeIdUri.toLowerCase());const n=li[i.schemeIdUri];if(n){e[n]={attributes:i};const r=ni(t,"cenc:pssh")[0];if(r){const t=ri(r);e[n].pssh=t&&Te(t)}}return e},{});Object.keys(d).length&&(l=vt(l,{contentProtection:d}));const p=ci(n),f=ni(n,"Representation"),m=vt(i,p);return bt(f.map(((e,t,i)=>n=>{const r=ni(n,"BaseURL"),s=ui(t,r),a=vt(e,oi(n)),o=ci(n);return s.map(e=>({segmentInfo:vt(i,o),attributes:vt(a,e)}))})(l,s,m)))},pi=(e,t)=>(i,n)=>{const r=ui(t,ni(i.node,"BaseURL")),s=vt(e,{periodStart:i.attributes.start});"number"==typeof i.attributes.duration&&(s.periodDuration=i.attributes.duration);const a=ni(i.node,"AdaptationSet"),o=ci(i.node);return bt(a.map(di(s,r,o)))},fi=(e,t)=>{if(e.length>1&&t({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!e.length)return null;const i=vt({serverURL:ri(e[0])},oi(e[0]));return i.queryBeforeStart="true"===i.queryBeforeStart,i},mi=e=>{if(""===e)throw new Error(wt);const t=new gt.DOMParser;let i,n;try{i=t.parseFromString(e,"application/xml"),n=i&&"MPD"===i.documentElement.tagName?i.documentElement:null}catch(r){}if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error(xt);return n},gi=(e,t={})=>{const i=((e,t={})=>{const{manifestUri:i="",NOW:n=Date.now(),clientOffset:r=0,eventHandler:s=function(){}}=t,a=ni(e,"Period");if(!a.length)throw new Error(St);const o=ni(e,"Location"),l=oi(e),u=ui([{baseUrl:i}],ni(e,"BaseURL")),c=ni(e,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=n,l.clientOffset=r,o.length&&(l.locations=o.map(ri));const h=[];return a.forEach((e,t)=>{const i=oi(e),n=h[t-1];i.start=(({attributes:e,priorPeriodAttributes:t,mpdType:i})=>"number"==typeof e.start?e.start:t&&"number"==typeof t.start&&"number"==typeof t.duration?t.start+t.duration:t||"static"!==i?null:0)({attributes:i,priorPeriodAttributes:n?n.attributes:null,mpdType:l.type}),h.push({node:e,attributes:i})}),{locations:l.locations,contentSteeringInfo:fi(c,s),representationInfo:bt(h.map(pi(l,u))),eventStream:bt(h.map(hi))}})(mi(e),t),n=i.representationInfo.map(ii);return Yt({dashPlaylists:n,locations:i.locations,contentSteering:i.contentSteeringInfo,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest,eventStream:i.eventStream})},yi=e=>(e=>{const t=ni(e,"UTCTiming")[0];if(!t)return null;const i=oi(t);switch(i.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":i.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":i.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":i.method="DIRECT",i.value=Date.parse(i.value);break;default:throw new Error(Ct)}return i})(mi(e));var vi,_i,bi,Ti;var Si=function(){if(Ti)return bi;Ti=1;var e=function(){if(_i)return vi;_i=1;var e=Math.pow(2,32);return vi={getUint64:function(t){var i,n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getBigUint64?(i=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(i):i:n.getUint32(0)*e+n.getUint32(4)},MAX_UINT32:e}}().getUint64;return bi=function(t){var i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8)},r=12;0===n.version?(n.earliestPresentationTime=i.getUint32(r),n.firstOffset=i.getUint32(r+4),r+=8):(n.earliestPresentationTime=e(t.subarray(r)),n.firstOffset=e(t.subarray(r+8)),r+=16),r+=2;var s=i.getUint16(r);for(r+=2;s>0;r+=12,s--)n.references.push({referenceType:(128&t[r])>>>7,referencedSize:2147483647&i.getUint32(r),subsegmentDuration:i.getUint32(r+4),startsWithSap:!!(128&t[r+8]),sapType:(112&t[r+8])>>>4,sapDeltaTime:268435455&i.getUint32(r+8)});return n}}();const wi=s(Si);var xi=$e([73,68,51]),Ai=function e(t,i){return void 0===i&&(i=0),(t=$e(t)).length-i<10||!tt(t,xi,{offset:i})?i:(i+=function(e,t){void 0===t&&(t=0);var i=(e=$e(e))[t+5],n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&i)>>4?n+20:n+10}(t,i),e(t,i))},Ei=function(e){return"string"==typeof e?et(e):e},Ci=function e(t,i,n){void 0===n&&(n=!1),i=function(e){return Array.isArray(e)?e.map(function(e){return Ei(e)}):[Ei(e)]}(i),t=$e(t);var r=[];if(!i.length)return r;for(var s=0;s<t.length;){var a=(t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3])>>>0,o=t.subarray(s+4,s+8);if(0===a)break;var l=s+a;if(l>t.length){if(n)break;l=t.length}var u=t.subarray(s+8,l);tt(o,i[0])&&(1===i.length?r.push(u):r.push.apply(r,e(u,i.slice(1),n))),s=l}return r},Mi={EBML:$e([26,69,223,163]),DocType:$e([66,130]),Segment:$e([24,83,128,103]),SegmentInfo:$e([21,73,169,102]),Tracks:$e([22,84,174,107]),Track:$e([174]),TrackNumber:$e([215]),DefaultDuration:$e([35,227,131]),TrackEntry:$e([174]),TrackType:$e([131]),FlagDefault:$e([136]),CodecID:$e([134]),CodecPrivate:$e([99,162]),VideoTrack:$e([224]),AudioTrack:$e([225]),Cluster:$e([31,67,182,117]),Timestamp:$e([231]),TimestampScale:$e([42,215,177]),BlockGroup:$e([160]),BlockDuration:$e([155]),Block:$e([161]),SimpleBlock:$e([163])},ki=[128,64,32,16,8,4,2,1],Ii=function(e,t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var r=function(e){for(var t=1,i=0;i<ki.length&&!(e&ki[i]);i++)t++;return t}(e[t]),s=e.subarray(t,t+r);return i&&((s=Array.prototype.slice.call(e,t,t+r))[0]^=ki[r-1]),{length:r,value:Ze(s,{signed:n}),bytes:s}},Pi=function e(t){return"string"==typeof t?t.match(/.{1,2}/g).map(function(t){return e(t)}):"number"==typeof t?Je(t):t},Li=function e(t,i,n){if(n>=i.length)return i.length;var r=Ii(i,n,!1);if(tt(t.bytes,r.bytes))return n;var s=Ii(i,n+r.length);return e(t,i,n+s.length+s.value+r.length)},Di=function e(t,i){i=function(e){return Array.isArray(e)?e.map(function(e){return Pi(e)}):[Pi(e)]}(i),t=$e(t);var n=[];if(!i.length)return n;for(var r=0;r<t.length;){var s=Ii(t,r,!1),a=Ii(t,r+s.length),o=r+s.length+a.length;127===a.value&&(a.value=Li(s,t,o),a.value!==t.length&&(a.value-=o));var l=o+a.value>t.length?t.length:o+a.value,u=t.subarray(o,l);tt(i[0],s.bytes)&&(1===i.length?n.push(u):n=n.concat(e(u,i.slice(1)))),r+=s.length+a.length+u.length}return n},Oi=$e([0,0,0,1]),Ri=$e([0,0,1]),Ni=$e([0,0,3]),Fi=function(e){for(var t=[],i=1;i<e.length-2;)tt(e.subarray(i,i+3),Ni)&&(t.push(i+2),i++),i++;if(0===t.length)return e;var n=e.length-t.length,r=new Uint8Array(n),s=0;for(i=0;i<n;s++,i++)s===t[0]&&(s++,t.shift()),r[i]=e[s];return r},Ui=function(e,t,i,n){e=$e(e),i=[].concat(i);for(var r,s=0,a=0;s<e.length&&(a<n||r);){var o=void 0;if(tt(e.subarray(s),Oi)?o=4:tt(e.subarray(s),Ri)&&(o=3),o){if(a++,r)return Fi(e.subarray(r,s));var l=void 0;"h264"===t?l=31&e[s+o]:"h265"===t&&(l=e[s+o]>>1&63),-1!==i.indexOf(l)&&(r=s+o),s+=o+("h264"===t?1:2)}else s++}return e.subarray(0,0)},Bi={webm:$e([119,101,98,109]),matroska:$e([109,97,116,114,111,115,107,97]),flac:$e([102,76,97,67]),ogg:$e([79,103,103,83]),ac3:$e([11,119]),riff:$e([82,73,70,70]),avi:$e([65,86,73]),wav:$e([87,65,86,69]),"3gp":$e([102,116,121,112,51,103]),mp4:$e([102,116,121,112]),fmp4:$e([115,116,121,112]),mov:$e([102,116,121,112,113,116]),moov:$e([109,111,111,118]),moof:$e([109,111,111,102])},ji={aac:function(e){var t=Ai(e);return tt(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Ai(e);return tt(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=Di(e,[Mi.EBML,Mi.DocType])[0];return tt(t,Bi.webm)},mkv:function(e){var t=Di(e,[Mi.EBML,Mi.DocType])[0];return tt(t,Bi.matroska)},mp4:function(e){return!ji["3gp"](e)&&!ji.mov(e)&&(!(!tt(e,Bi.mp4,{offset:4})&&!tt(e,Bi.fmp4,{offset:4}))||(!(!tt(e,Bi.moof,{offset:4})&&!tt(e,Bi.moov,{offset:4}))||void 0))},mov:function(e){return tt(e,Bi.mov,{offset:4})},"3gp":function(e){return tt(e,Bi["3gp"],{offset:4})},ac3:function(e){var t=Ai(e);return tt(e,Bi.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];for(var t=0;t+188<e.length&&t<188;){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=Ai(e);return tt(e,Bi.flac,{offset:t})},ogg:function(e){return tt(e,Bi.ogg)},avi:function(e){return tt(e,Bi.riff)&&tt(e,Bi.avi,{offset:8})},wav:function(e){return tt(e,Bi.riff)&&tt(e,Bi.wav,{offset:8})},h264:function(e){return function(e,t,i){return Ui(e,"h264",t,i)}(e,7,3).length},h265:function(e){return function(e,t,i){return Ui(e,"h265",t,i)}(e,[32,33],3).length}},zi=Object.keys(ji).filter(function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e}).concat(["ts","h264","h265"]);zi.forEach(function(e){var t=ji[e];ji[e]=function(e){return t($e(e))}});var Vi,Hi,qi=ji,Gi=function(e){e=$e(e);for(var t=0;t<zi.length;t++){var i=zi[t];if(qi[i](e))return i}return""};var Wi=function(){if(Hi)return Vi;Hi=1;var e,t,i,n,r,s,a,o=9e4;return r=function(t,i){return e(n(t,i))},s=function(e,n){return t(i(e),n)},a=function(e,t,n){return i(n?e:e-t)},Vi={ONE_SECOND_IN_TS:o,secondsToVideoTs:e=function(e){return e*o},secondsToAudioTs:t=function(e,t){return e*t},videoTsToSeconds:i=function(e){return e/o},audioTsToSeconds:n=function(e,t){return e/t},audioTsToVideoTs:r,videoTsToAudioTs:s,metadataTsToSeconds:a}}(),$i="8.23.3";const Xi={},Yi=function(e,t){return Xi[e]=Xi[e]||[],t&&(Xi[e]=Xi[e].concat(t)),Xi[e]},Qi=function(e,t){const i=Yi(e).indexOf(t);return!(i<=-1)&&(Xi[e]=Xi[e].slice(),Xi[e].splice(i,1),!0)},Ki={prefixed:!0},Zi=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],Ji=Zi[0];let en;for(let iE=0;iE<Zi.length;iE++)if(Zi[iE][1]in z){en=Zi[iE];break}if(en){for(let e=0;e<en.length;e++)Ki[Ji[e]]=en[e];Ki.prefixed=en[0]!==Ji[0]}let tn=[];const nn=function e(t,i=":",n=""){let r,s="info";function a(...e){r("log",s,e)}return r=((e,t,i)=>(n,r,s)=>{const a=t.levels[r],o=new RegExp(`^(${a})$`);let l=e;if("log"!==n&&s.unshift(n.toUpperCase()+":"),i&&(l=`%c${e}`,s.unshift(i)),s.unshift(l+":"),tn){tn.push([].concat(s));const e=tn.length-1e3;tn.splice(0,e>0?e:0)}if(!N.console)return;let u=N.console[n];u||"debug"!==n||(u=N.console.info||N.console.log),u&&a&&o.test(n)&&u[Array.isArray(s)?"apply":"call"](N.console,s)})(t,a,n),a.createLogger=(r,s,a)=>{const o=void 0!==s?s:i;return e(`${t} ${o} ${r}`,o,void 0!==a?a:n)},a.createNewLogger=(t,i,n)=>e(t,i,n),a.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:s},a.level=e=>{if("string"==typeof e){if(!a.levels.hasOwnProperty(e))throw new Error(`"${e}" in not a valid log level`);s=e}return s},a.history=()=>tn?[].concat(tn):[],a.history.filter=e=>(tn||[]).filter(t=>new RegExp(`.*${e}.*`).test(t[0])),a.history.clear=()=>{tn&&(tn.length=0)},a.history.disable=()=>{null!==tn&&(tn.length=0,tn=null)},a.history.enable=()=>{null===tn&&(tn=[])},a.error=(...e)=>r("error",s,e),a.warn=(...e)=>r("warn",s,e),a.debug=(...e)=>r("debug",s,e),a}("VIDEOJS"),rn=nn.createLogger,sn=Object.prototype.toString,an=function(e){return un(e)?Object.keys(e):[]};function on(e,t){an(e).forEach(i=>t(e[i],i))}function ln(e,t,i=0){return an(e).reduce((i,n)=>t(i,e[n],n),i)}function un(e){return!!e&&"object"==typeof e}function cn(e){return un(e)&&"[object Object]"===sn.call(e)&&e.constructor===Object}function hn(...e){const t={};return e.forEach(e=>{e&&on(e,(e,i)=>{cn(e)?(cn(t[i])||(t[i]={}),t[i]=hn(t[i],e)):t[i]=e})}),t}function dn(e={}){const t=[];for(const i in e)if(e.hasOwnProperty(i)){const n=e[i];t.push(n)}return t}function pn(e,t,i,n=!0){const r=i=>Object.defineProperty(e,t,{value:i,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const e=i();return r(e),e}};return n&&(s.set=r),Object.defineProperty(e,t,s)}var fn=Object.freeze({__proto__:null,each:on,reduce:ln,isObject:un,isPlain:cn,merge:hn,values:dn,defineLazyProperty:pn});let mn,gn=!1,yn=null,vn=!1,_n=!1,bn=!1,Tn=!1,Sn=!1,wn=null,xn=null;const An=Boolean(N.cast&&N.cast.framework&&N.cast.framework.CastReceiverContext);let En=null,Cn=!1,Mn=!1,kn=!1,In=!1,Pn=!1,Ln=!1,Dn=!1;const On=Boolean(jn()&&("ontouchstart"in N||N.navigator.maxTouchPoints||N.DocumentTouch&&N.document instanceof N.DocumentTouch)),Rn=N.navigator&&N.navigator.userAgentData;if(Rn&&Rn.platform&&Rn.brands&&(vn="Android"===Rn.platform,bn=Boolean(Rn.brands.find(e=>"Microsoft Edge"===e.brand)),Tn=Boolean(Rn.brands.find(e=>"Chromium"===e.brand)),Sn=!bn&&Tn,wn=xn=(Rn.brands.find(e=>"Chromium"===e.brand)||{}).version||null,Mn="Windows"===Rn.platform),!Tn){const e=N.navigator&&N.navigator.userAgent||"";gn=/iPod/i.test(e),yn=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),vn=/Android/i.test(e),mn=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const i=t[1]&&parseFloat(t[1]),n=t[2]&&parseFloat(t[2]);return i&&n?parseFloat(t[1]+"."+t[2]):i||null}(),_n=/Firefox/i.test(e),bn=/Edg/i.test(e),Tn=/Chrome/i.test(e)||/CriOS/i.test(e),Sn=!bn&&Tn,wn=xn=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),En=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let i=t&&parseFloat(t[1]);return!i&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(i=11),i}(),Pn=/Tizen/i.test(e),Ln=/Web0S/i.test(e),Dn=Pn||Ln,Cn=/Safari/i.test(e)&&!Sn&&!vn&&!bn&&!Dn,Mn=/Windows/i.test(e),kn=/iPad/i.test(e)||Cn&&On&&!/iPhone/i.test(e),In=/iPhone/i.test(e)&&!kn}const Nn=In||kn||gn,Fn=(Cn||Nn)&&!Sn;var Un=Object.freeze({__proto__:null,get IS_IPOD(){return gn},get IOS_VERSION(){return yn},get IS_ANDROID(){return vn},get ANDROID_VERSION(){return mn},get IS_FIREFOX(){return _n},get IS_EDGE(){return bn},get IS_CHROMIUM(){return Tn},get IS_CHROME(){return Sn},get CHROMIUM_VERSION(){return wn},get CHROME_VERSION(){return xn},IS_CHROMECAST_RECEIVER:An,get IE_VERSION(){return En},get IS_SAFARI(){return Cn},get IS_WINDOWS(){return Mn},get IS_IPAD(){return kn},get IS_IPHONE(){return In},get IS_TIZEN(){return Pn},get IS_WEBOS(){return Ln},get IS_SMART_TV(){return Dn},TOUCH_ENABLED:On,IS_IOS:Nn,IS_ANY_SAFARI:Fn});function Bn(e){return"string"==typeof e&&Boolean(e.trim())}function jn(){return z===N.document}function zn(e){return un(e)&&1===e.nodeType}function Vn(){try{return N.parent!==N.self}catch(e){return!0}}function Hn(e){return function(t,i){if(!Bn(t))return z[e](null);Bn(i)&&(i=z.querySelector(i));const n=zn(i)?i:z;return n[e]&&n[e](t)}}function qn(e="div",t={},i={},n){const r=z.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){const i=t[e];"textContent"===e?Gn(r,i):r[e]===i&&"tabIndex"!==e||(r[e]=i)}),Object.getOwnPropertyNames(i).forEach(function(e){r.setAttribute(e,i[e])}),n&&cr(r,n),r}function Gn(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function Wn(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function $n(e,t){return function(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}(t),e.classList.contains(t)}function Xn(e,...t){return e.classList.add(...t.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e}function Yn(e,...t){return e?(e.classList.remove(...t.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e):(nn.warn("removeClass was called with an element that doesn't exist"),null)}function Qn(e,t,i){return"function"==typeof i&&(i=i(e,t)),"boolean"!=typeof i&&(i=void 0),t.split(/\s+/).forEach(t=>e.classList.toggle(t,i)),e}function Kn(e,t){Object.getOwnPropertyNames(t).forEach(function(i){const n=t[i];null==n||!1===n?e.removeAttribute(i):e.setAttribute(i,!0===n?"":n)})}function Zn(e){const t={},i=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(e&&e.attributes&&e.attributes.length>0){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;let s=n[e].value;i.includes(r)&&(s=null!==s),t[r]=s}}return t}function Jn(e,t){return e.getAttribute(t)}function er(e,t,i){e.setAttribute(t,i)}function tr(e,t){e.removeAttribute(t)}function ir(){z.body.focus(),z.onselectstart=function(){return!1}}function nr(){z.onselectstart=function(){return!0}}function rr(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(e=>{void 0!==t[e]&&(i[e]=t[e])}),i.height||(i.height=parseFloat(mr(e,"height"))),i.width||(i.width=parseFloat(mr(e,"width"))),i}}function sr(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,i=e.offsetHeight;let n=0,r=0;for(;e.offsetParent&&e!==z[Ki.fullscreenElement];)n+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:n,top:r,width:t,height:i}}function ar(e,t){const i={x:0,y:0};if(Nn){let t=e;for(;t&&"html"!==t.nodeName.toLowerCase();){const e=mr(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);i.x+=t[4],i.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);i.x+=t[12],i.y+=t[13]}if(t.assignedSlot&&t.assignedSlot.parentElement&&N.WebKitCSSMatrix){const e=N.getComputedStyle(t.assignedSlot.parentElement).transform,n=new N.WebKitCSSMatrix(e);i.x+=n.m41,i.y+=n.m42}t=t.parentNode||t.host}}const n={},r=sr(t.target),s=sr(e),a=s.width,o=s.height;let l=t.offsetY-(s.top-r.top),u=t.offsetX-(s.left-r.left);return t.changedTouches&&(u=t.changedTouches[0].pageX-s.left,l=t.changedTouches[0].pageY+s.top,Nn&&(u-=i.x,l-=i.y)),n.y=1-Math.max(0,Math.min(1,l/o)),n.x=Math.max(0,Math.min(1,u/a)),n}function or(e){return un(e)&&3===e.nodeType}function lr(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function ur(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(e=>("function"==typeof e&&(e=e()),zn(e)||or(e)?e:"string"==typeof e&&/\S/.test(e)?z.createTextNode(e):void 0)).filter(e=>e)}function cr(e,t){return ur(t).forEach(t=>e.appendChild(t)),e}function hr(e,t){return cr(lr(e),t)}function dr(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||("mousedown"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons)))}const pr=Hn("querySelector"),fr=Hn("querySelectorAll");function mr(e,t){if(!e||!t)return"";if("function"==typeof N.getComputedStyle){let n;try{n=N.getComputedStyle(e)}catch(i){return""}return n?n.getPropertyValue(t)||n[t]:""}return""}function gr(e){[...z.styleSheets].forEach(t=>{try{const i=[...t.cssRules].map(e=>e.cssText).join(""),n=z.createElement("style");n.textContent=i,e.document.head.appendChild(n)}catch(i){const n=z.createElement("link");n.rel="stylesheet",n.type=t.type,n.media=t.media.mediaText,n.href=t.href,e.document.head.appendChild(n)}})}var yr=Object.freeze({__proto__:null,isReal:jn,isEl:zn,isInFrame:Vn,createEl:qn,textContent:Gn,prependTo:Wn,hasClass:$n,addClass:Xn,removeClass:Yn,toggleClass:Qn,setAttributes:Kn,getAttributes:Zn,getAttribute:Jn,setAttribute:er,removeAttribute:tr,blockTextSelection:ir,unblockTextSelection:nr,getBoundingClientRect:rr,findPosition:sr,getPointerPosition:ar,isTextNode:or,emptyEl:lr,normalizeContent:ur,appendContent:cr,insertContent:hr,isSingleLeftClick:dr,$:pr,$$:fr,computedStyle:mr,copyStyleSheetsToWindow:gr});let vr,_r=!1;const br=function(){if(!1===vr.options.autoSetup)return;const e=Array.prototype.slice.call(z.getElementsByTagName("video")),t=Array.prototype.slice.call(z.getElementsByTagName("audio")),i=Array.prototype.slice.call(z.getElementsByTagName("video-js")),n=e.concat(t,i);if(n&&n.length>0)for(let r=0,s=n.length;r<s;r++){const e=n[r];if(!e||!e.getAttribute){Tr(1);break}if(void 0===e.player){null!==e.getAttribute("data-setup")&&vr(e)}}else _r||Tr(1)};function Tr(e,t){jn()&&(t&&(vr=t),N.setTimeout(br,e))}function Sr(){_r=!0,N.removeEventListener("load",Sr)}jn()&&("complete"===z.readyState?Sr():N.addEventListener("load",Sr));const wr=function(e){const t=z.createElement("style");return t.className=e,t},xr=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var Ar=new WeakMap;let Er,Cr=3;function Mr(){return Cr++}function kr(e,t){if(!Ar.has(e))return;const i=Ar.get(e);0===i.handlers[t].length&&(delete i.handlers[t],e.removeEventListener?e.removeEventListener(t,i.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&Ar.delete(e)}function Ir(e,t,i,n){i.forEach(function(i){e(t,i,n)})}function Pr(e){if(e.fixed_)return e;function t(){return!0}function i(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const n=e||N.event;e={};const r=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const t in n)r.includes(t)||"returnValue"===t&&n.preventDefault||(e[t]=n[t]);if(e.target||(e.target=e.srcElement||z),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){n.preventDefault&&n.preventDefault(),e.returnValue=!1,n.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),e.cancelBubble=!0,n.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=i,e.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=i,null!==e.clientX&&void 0!==e.clientX){const t=z.documentElement,i=z.body;e.pageX=e.clientX+(t&&t.scrollLeft||i&&i.scrollLeft||0)-(t&&t.clientLeft||i&&i.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||i&&i.scrollTop||0)-(t&&t.clientTop||i&&i.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const Lr=["touchstart","touchmove"];function Dr(e,t,i){if(Array.isArray(t))return Ir(Dr,e,t,i);Ar.has(e)||Ar.set(e,{});const n=Ar.get(e);if(n.handlers||(n.handlers={}),n.handlers[t]||(n.handlers[t]=[]),i.guid||(i.guid=Mr()),n.handlers[t].push(i),n.dispatcher||(n.disabled=!1,n.dispatcher=function(t,i){if(n.disabled)return;t=Pr(t);const r=n.handlers[t.type];if(r){const n=r.slice(0);for(let r=0,a=n.length;r<a&&!t.isImmediatePropagationStopped();r++)try{n[r].call(e,t,i)}catch(s){nn.error(s)}}}),1===n.handlers[t].length)if(e.addEventListener){let i=!1;(function(){if("boolean"!=typeof Er){Er=!1;try{const e=Object.defineProperty({},"passive",{get(){Er=!0}});N.addEventListener("test",null,e),N.removeEventListener("test",null,e)}catch(e){}}return Er})()&&Lr.indexOf(t)>-1&&(i={passive:!0}),e.addEventListener(t,n.dispatcher,i)}else e.attachEvent&&e.attachEvent("on"+t,n.dispatcher)}function Or(e,t,i){if(!Ar.has(e))return;const n=Ar.get(e);if(!n.handlers)return;if(Array.isArray(t))return Ir(Or,e,t,i);const r=function(e,t){n.handlers[t]=[],kr(e,t)};if(void 0===t){for(const t in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},t)&&r(e,t);return}const s=n.handlers[t];if(s)if(i){if(i.guid)for(let e=0;e<s.length;e++)s[e].guid===i.guid&&s.splice(e--,1);kr(e,t)}else r(e,t)}function Rr(e,t,i){const n=Ar.has(e)?Ar.get(e):{},r=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=Pr(t),n.dispatcher&&n.dispatcher.call(e,t,i),r&&!t.isPropagationStopped()&&!0===t.bubbles)Rr.call(null,r,t,i);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){Ar.has(t.target)||Ar.set(t.target,{});const e=Ar.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function Nr(e,t,i){if(Array.isArray(t))return Ir(Nr,e,t,i);const n=function(){Or(e,t,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||Mr(),Dr(e,t,n)}function Fr(e,t,i){const n=function(){Or(e,t,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||Mr(),Dr(e,t,n)}var Ur=Object.freeze({__proto__:null,fixEvent:Pr,on:Dr,off:Or,trigger:Rr,one:Nr,any:Fr});const Br=30,jr=function(e,t,i){t.guid||(t.guid=Mr());const n=t.bind(e);return n.guid=i?i+"_"+t.guid:t.guid,n},zr=function(e,t){let i=N.performance.now();return function(...n){const r=N.performance.now();r-i>=t&&(e(...n),i=r)}},Vr=function(e,t,i,n=N){let r;const s=function(){const s=this,a=arguments;let o=function(){r=null,o=null,i||e.apply(s,a)};!r&&i&&e.apply(s,a),n.clearTimeout(r),r=n.setTimeout(o,t)};return s.cancel=()=>{n.clearTimeout(r),r=null},s};var Hr=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:Br,bind_:jr,throttle:zr,debounce:Vr});let qr,Gr=class{on(e,t){const i=this.addEventListener;this.addEventListener=()=>{},Dr(this,e,t),this.addEventListener=i}off(e,t){Or(this,e,t)}one(e,t){const i=this.addEventListener;this.addEventListener=()=>{},Nr(this,e,t),this.addEventListener=i}any(e,t){const i=this.addEventListener;this.addEventListener=()=>{},Fr(this,e,t),this.addEventListener=i}trigger(e){const t=e.type||e;"string"==typeof e&&(e={type:t}),e=Pr(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Rr(this,e)}queueTrigger(e){qr||(qr=new Map);const t=e.type||e;let i=qr.get(this);i||(i=new Map,qr.set(this,i));const n=i.get(t);i.delete(t),N.clearTimeout(n);const r=N.setTimeout(()=>{i.delete(t),0===i.size&&(i=null,qr.delete(this)),this.trigger(e)},0);i.set(t,r)}};Gr.prototype.allowedEvents_={},Gr.prototype.addEventListener=Gr.prototype.on,Gr.prototype.removeEventListener=Gr.prototype.off,Gr.prototype.dispatchEvent=Gr.prototype.trigger;const Wr=e=>"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e,$r=e=>e instanceof Gr||!!e.eventBusEl_&&["on","one","off","trigger"].every(t=>"function"==typeof e[t]),Xr=e=>"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,Yr=(e,t,i)=>{if(!e||!e.nodeName&&!$r(e))throw new Error(`Invalid target for ${Wr(t)}#${i}; must be a DOM node or evented object.`)},Qr=(e,t,i)=>{if(!Xr(e))throw new Error(`Invalid event type for ${Wr(t)}#${i}; must be a non-empty string or array.`)},Kr=(e,t,i)=>{if("function"!=typeof e)throw new Error(`Invalid listener for ${Wr(t)}#${i}; must be a function.`)},Zr=(e,t,i)=>{const n=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let r,s,a;return n?(r=e.eventBusEl_,t.length>=3&&t.shift(),[s,a]=t):(r=t[0],s=t[1],a=t[2]),Yr(r,e,i),Qr(s,e,i),Kr(a,e,i),a=jr(e,a),{isTargetingSelf:n,target:r,type:s,listener:a}},Jr=(e,t,i,n)=>{Yr(e,e,t),e.nodeName?Ur[t](e,i,n):e[t](i,n)},es={on(...e){const{isTargetingSelf:t,target:i,type:n,listener:r}=Zr(this,e,"on");if(Jr(i,"on",n,r),!t){const e=()=>this.off(i,n,r);e.guid=r.guid;const t=()=>this.off("dispose",e);t.guid=r.guid,Jr(this,"on","dispose",e),Jr(i,"on","dispose",t)}},one(...e){const{isTargetingSelf:t,target:i,type:n,listener:r}=Zr(this,e,"one");if(t)Jr(i,"one",n,r);else{const e=(...t)=>{this.off(i,n,e),r.apply(null,t)};e.guid=r.guid,Jr(i,"one",n,e)}},any(...e){const{isTargetingSelf:t,target:i,type:n,listener:r}=Zr(this,e,"any");if(t)Jr(i,"any",n,r);else{const e=(...t)=>{this.off(i,n,e),r.apply(null,t)};e.guid=r.guid,Jr(i,"any",n,e)}},off(e,t,i){if(!e||Xr(e))Or(this.eventBusEl_,e,t);else{const n=e,r=t;Yr(n,this,"off"),Qr(r,this,"off"),Kr(i,this,"off"),i=jr(this,i),this.off("dispose",i),n.nodeName?(Or(n,r,i),Or(n,"dispose",i)):$r(n)&&(n.off(r,i),n.off("dispose",i))}},trigger(e,t){Yr(this.eventBusEl_,this,"trigger");const i=e&&"string"!=typeof e?e.type:e;if(!Xr(i))throw new Error(`Invalid event type for ${Wr(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return Rr(this.eventBusEl_,e,t)}};function ts(e,t={}){const{eventBusKey:i}=t;if(i){if(!e[i].nodeName)throw new Error(`The eventBusKey "${i}" does not refer to an element.`);e.eventBusEl_=e[i]}else e.eventBusEl_=qn("span",{className:"vjs-event-bus"});return Object.assign(e,es),e.eventedCallbacks&&e.eventedCallbacks.forEach(e=>{e()}),e.on("dispose",()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach(function(e){e&&Ar.has(e)&&Ar.delete(e)}),N.setTimeout(()=>{e.eventBusEl_=null},0)}),e}const is={state:{},setState(e){let t;return"function"==typeof e&&(e=e()),on(e,(e,i)=>{this.state[i]!==e&&(t=t||{},t[i]={from:this.state[i],to:e}),this.state[i]=e}),t&&$r(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function ns(e,t){return Object.assign(e,is),e.state=Object.assign({},e.state,t),"function"==typeof e.handleStateChanged&&$r(e)&&e.on("statechanged",e.handleStateChanged),e}const rs=function(e){return"string"!=typeof e?e:e.replace(/./,e=>e.toLowerCase())},ss=function(e){return"string"!=typeof e?e:e.replace(/./,e=>e.toUpperCase())},as=function(e,t){return ss(e)===ss(t)};var os=Object.freeze({__proto__:null,toLowerCase:rs,toTitleCase:ss,titleCaseEquals:as});let ls=class e{constructor(e,t,i){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=hn({},this.options_),t=this.options_=hn(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${Mr()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(e=>this.addClass(e)),["on","off","one","any","trigger"].forEach(e=>{this[e]=void 0}),!1!==t.evented&&(ts(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),ns(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(i),!1!==t.reportTouchActivity&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=hn(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,i){return qn(e,t,i)}localize(e,t,i=e){const n=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),s=r&&r[n],a=n&&n.split("-")[0],o=r&&r[a];let l=i;return s&&s[e]?l=s[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,i){const n=t[i-1];let r=n;return void 0===n&&(r=e),r})),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((e,t)=>e.concat(t),[]);let t=this;for(let i=0;i<e.length;i++)if(t=t.getChild(e[i]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const i="http://www.w3.org/2000/svg",n=qn("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),r=z.createElementNS(i,"svg");r.setAttributeNS(null,"viewBox","0 0 512 512");const s=z.createElementNS(i,"use");return r.appendChild(s),s.setAttributeNS(null,"href",`#vjs-icon-${e}`),n.appendChild(r),this.iconIsSet_?t.replaceChild(n,t.querySelector(".vjs-icon-placeholder")):t.appendChild(n),this.iconIsSet_=!0,n}addChild(t,i={},n=this.children_.length){let r,s;if("string"==typeof t){s=ss(t);const n=i.componentClass||s;i.name=s;const a=e.getComponent(n);if(!a)throw new Error(`Component ${n} does not exist`);if("function"!=typeof a)return null;r=new a(this.player_||this,i)}else r=t;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),s=s||r.name&&ss(r.name()),s&&(this.childNameIndex_[s]=r,this.childNameIndex_[rs(s)]=r),"function"==typeof r.el&&r.el()){let e=null;this.children_[n+1]&&(this.children_[n+1].el_?e=this.children_[n+1].el_:zn(this.children_[n+1])&&(e=this.children_[n+1])),this.contentEl().insertBefore(r.el(),e)}return r}removeChild(e){if("string"==typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let n=this.children_.length-1;n>=0;n--)if(this.children_[n]===e){t=!0,this.children_.splice(n,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[ss(e.name())]=null,this.childNameIndex_[rs(e.name())]=null;const i=e.el();i&&i.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const t=this.options_.children;if(t){const i=this.options_,n=e=>{const t=e.name;let n=e.opts;if(void 0!==i[t]&&(n=i[t]),!1===n)return;!0===n&&(n={}),n.playerOptions=this.options_.playerOptions;const r=this.addChild(t,n);r&&(this[t]=r)};let r;const s=e.getComponent("Tech");r=Array.isArray(t)?t:Object.keys(t),r.concat(Object.keys(this.options_).filter(function(e){return!r.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(e=>{let i,n;return"string"==typeof e?(i=e,n=t[i]||this.options_[i]||{}):(i=e.name,n=e),{name:i,opts:n}}).filter(t=>{const i=e.getComponent(t.opts.componentClass||ss(t.name));return i&&!s.isTech(i)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)}$(e,t){return pr(e,t||this.contentEl())}$$(e,t){return fr(e,t||this.contentEl())}hasClass(e){return $n(this.el_,e)}addClass(...e){Xn(this.el_,...e)}removeClass(...e){Yn(this.el_,...e)}toggleClass(e,t){Qn(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return Jn(this.el_,e)}setAttribute(e,t){er(this.el_,e,t)}removeAttribute(e){tr(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,i){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(i||this.trigger("componentresize"));if(!this.el_)return 0;const n=this.el_.style[e],r=n.indexOf("px");return-1!==r?parseInt(n.slice(0,r),10):parseInt(this.el_["offset"+ss(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=mr(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const i=`offset${ss(e)}`;t=this.el_[i]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect();return{boundingClientRect:{x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},center:{x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2}}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&("Tab"===e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;let i;this.on("touchstart",function(n){1===n.touches.length&&(t={pageX:n.touches[0].pageX,pageY:n.touches[0].pageY},e=N.performance.now(),i=!0)}),this.on("touchmove",function(e){if(e.touches.length>1)i=!1;else if(t){const n=e.touches[0].pageX-t.pageX,r=e.touches[0].pageY-t.pageY;Math.sqrt(n*n+r*r)>10&&(i=!1)}});const n=function(){i=!1};this.on("touchleave",n),this.on("touchcancel",n),this.on("touchend",function(n){if(t=null,!0===i){N.performance.now()-e<200&&(n.preventDefault(),this.trigger("tap"))}})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=jr(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const i=function(i){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",i),this.on("touchcancel",i)}setTimeout(e,t){var i;return e=jr(this,e),this.clearTimersOnDispose_(),i=N.setTimeout(()=>{this.setTimeoutIds_.has(i)&&this.setTimeoutIds_.delete(i),e()},t),this.setTimeoutIds_.add(i),i}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),N.clearTimeout(e)),e}setInterval(e,t){e=jr(this,e),this.clearTimersOnDispose_();const i=N.setInterval(e,t);return this.setIntervalIds_.add(i),i}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),N.clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=jr(this,e),t=N.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=jr(this,t);const i=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,i),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),N.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((e,i)=>this[t](i))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return Boolean(this.el_.disabled)}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(e){const t=N.getComputedStyle(e,null),i=t.getPropertyValue("visibility");return"none"!==t.getPropertyValue("display")&&!["hidden","collapse"].includes(i)}return e||(e=this.el()),!!(function(e){if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(z.documentElement.clientWidth||N.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(z.documentElement.clientHeight||N.innerHeight))return!1;let i=z.elementFromPoint(t.x,t.y);for(;i;){if(i===e)return!0;if(!i.parentNode)return!1;i=i.parentNode}}(e)&&(i=e,t(i.parentElement)&&t(i)&&"0"!==i.style.opacity&&"0px"!==N.getComputedStyle(i).height&&"0px"!==N.getComputedStyle(i).width)&&(!e.parentElement||e.tabIndex>=0));var i}static registerComponent(t,i){if("string"!=typeof t||!t)throw new Error(`Illegal component name, "${t}"; must be a non-empty string.`);const n=e.getComponent("Tech"),r=n&&n.isTech(i),s=e===i||e.prototype.isPrototypeOf(i.prototype);if(r||!s){let e;throw e=r?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${t}"; ${e}.`)}t=ss(t),e.components_||(e.components_={});const a=e.getComponent("Player");if("Player"===t&&a&&a.players){const e=a.players,t=Object.keys(e);if(e&&t.length>0)for(let i=0;i<t.length;i++)if(null!==e[t[i]])throw new Error("Can not register Player component after player has been created.")}return e.components_[t]=i,e.components_[rs(t)]=i,i}static getComponent(t){if(t&&e.components_)return e.components_[t]}};function us(e,t,i,n){return function(e,t,i){if("number"!=typeof t||t<0||t>i)throw new Error(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is non-numeric or out of bounds (0-${i}).`)}(e,n,i.length-1),i[n][t]}function cs(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:us.bind(null,"start",0,e),end:us.bind(null,"end",1,e)},N.Symbol&&N.Symbol.iterator&&(t[N.Symbol.iterator]=()=>(e||[]).values()),t}function hs(e,t){return Array.isArray(e)?cs(e):void 0===e||void 0===t?cs():cs([[e,t]])}ls.registerComponent("Component",ls);const ds=function(e,t){e=e<0?0:e;let i=Math.floor(e%60),n=Math.floor(e/60%60),r=Math.floor(e/3600);const s=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=n=i="-"),r=r>0||a>0?r+":":"",n=((r||s>=10)&&n<10?"0"+n:n)+":",i=i<10?"0"+i:i,r+n+i};let ps=ds;function fs(e){ps=e}function ms(){ps=ds}function gs(e,t=e){return ps(e,t)}var ys=Object.freeze({__proto__:null,createTimeRanges:hs,createTimeRange:hs,setFormatTime:fs,resetFormatTime:ms,formatTime:gs});function vs(e,t){let i,n,r=0;if(!t)return 0;e&&e.length||(e=hs(0,0));for(let s=0;s<e.length;s++)i=e.start(s),n=e.end(s),n>t&&(n=t),r+=n-i;return r/t}function _s(e){if(e instanceof _s)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:un(e)&&("number"==typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=_s.defaultMessages[this.code]||"")}function bs(e){return null!=e&&"function"==typeof e.then}function Ts(e){bs(e)&&e.then(null,e=>{})}_s.prototype.code=0,_s.prototype.message="",_s.prototype.status=null,_s.prototype.metadata=null,_s.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],_s.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."},_s.MEDIA_ERR_CUSTOM=0,_s.prototype.MEDIA_ERR_CUSTOM=0,_s.MEDIA_ERR_ABORTED=1,_s.prototype.MEDIA_ERR_ABORTED=1,_s.MEDIA_ERR_NETWORK=2,_s.prototype.MEDIA_ERR_NETWORK=2,_s.MEDIA_ERR_DECODE=3,_s.prototype.MEDIA_ERR_DECODE=3,_s.MEDIA_ERR_SRC_NOT_SUPPORTED=4,_s.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4,_s.MEDIA_ERR_ENCRYPTED=5,_s.prototype.MEDIA_ERR_ENCRYPTED=5;const Ss=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,i,n)=>(e[i]&&(t[i]=e[i]),t),{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})};var ws=function(e){const t=e.$$("track"),i=Array.prototype.map.call(t,e=>e.track);return Array.prototype.map.call(t,function(e){const t=Ss(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===i.indexOf(e)}).map(Ss))},xs=function(e,t){return e.forEach(function(e){const i=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(e=>i.addCue(e))}),t.textTracks()},As=Ss;const Es="vjs-modal-dialog";let Cs=class extends ls{constructor(e,t){super(e,t),this.handleKeyDown_=e=>this.handleKeyDown(e),this.close_=e=>this.close(e),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=qn("div",{className:`${Es}-content`},{role:"document"}),this.descEl_=qn("p",{className:`${Es}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),Gn(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${Es} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_)return void(this.options_.fillAlways&&this.fill());const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"==typeof e){const t=this.closeable_=!!e;let i=this.getChild("closeButton");if(t&&!i){const e=this.contentEl_;this.contentEl_=this.el_,i=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(i,"close",this.close_)}!t&&i&&(this.off(i,"close",this.close_),this.removeChild(i),i.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),i=t.parentNode,n=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,i.removeChild(t),this.empty(),hr(t,e),this.trigger("modalfill"),n?i.insertBefore(t,n):i.appendChild(t);const r=this.getChild("closeButton");r&&i.appendChild(r.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),lr(this.contentEl()),this.trigger("modalempty")}content(e){return void 0!==e&&(this.content_=e),this.content_}conditionalFocus_(){const e=z.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),"Escape"===e.key&&this.closeable())return e.preventDefault(),void this.close();if("Tab"!==e.key)return;const t=this.focusableEls_(),i=this.el_.querySelector(":focus");let n;for(let r=0;r<t.length;r++)if(i===t[r]){n=r;break}z.activeElement===this.el_&&(n=0),e.shiftKey&&0===n?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,e=>(e instanceof N.HTMLAnchorElement||e instanceof N.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof N.HTMLInputElement||e instanceof N.HTMLSelectElement||e instanceof N.HTMLTextAreaElement||e instanceof N.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof N.HTMLIFrameElement||e instanceof N.HTMLObjectElement||e instanceof N.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable"))}};Cs.prototype.options_={pauseOnOpen:!0,temporary:!0},ls.registerComponent("ModalDialog",Cs);let Ms=class extends Gr{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},$r(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let i=0,n=this.length;i<n;i++)if(this[i]===e){t=this[i],t.off&&t.off(),this.tracks_.splice(i,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let i=0,n=this.length;i<n;i++){const n=this[i];if(n.id===e){t=n;break}}return t}};Ms.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const iE in Ms.prototype.allowedEvents_)Ms.prototype["on"+iE]=null;const ks=function(e,t){for(let i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].enabled=!1)};let Is=class extends Ms{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){ks(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&ks(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,ks(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}};const Ps=function(e,t){for(let i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].selected=!1)};let Ls=class extends Ms{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){Ps(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&Ps(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,Ps(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}},Ds=class extends Ms{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_);-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map(e=>e.toJSON())}},Os=class e{constructor(t){e.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let i=0;const n=e.length;this.cues_=e,this.length_=e.length;const r=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<n)for(i=t;i<n;i++)r.call(this,i)}getCueById(e){let t=null;for(let i=0,n=this.length;i<n;i++){const n=this[i];if(n.id===e){t=n;break}}return t}};const Rs={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Ns={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},Fs={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Us={disabled:"disabled",hidden:"hidden",showing:"showing"};let Bs=class extends Gr{constructor(e={}){super();const t={id:e.id||"vjs_track_"+Mr(),kind:e.kind||"",language:e.language||""};let i=e.label||"";for(const n in t)Object.defineProperty(this,n,{get:()=>t[n],set(){}});Object.defineProperty(this,"label",{get:()=>i,set(e){e!==i&&(i=e,this.trigger("labelchange"))}})}};const js=function(e){return new URL(e,z.baseURI)},zs=function(e){return new URL(e,z.baseURI).href},Vs=function(e){if("string"==typeof e){const t=e.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return t?t[1].toLowerCase():""}return""},Hs=function(e,t=N.location){return js(e).origin!==t.origin};var qs=Object.freeze({__proto__:null,parseUrl:js,getAbsoluteURL:zs,getFileExtension:Vs,isCrossOrigin:Hs});const Gs=function(e,t){const i=new N.WebVTT.Parser(N,N.vttjs,N.WebVTT.StringDecoder()),n=[];i.oncue=function(e){t.addCue(e)},i.onparsingerror=function(e){n.push(e)},i.onflush=function(){t.trigger({type:"loadeddata",target:t})},i.parse(e),n.length>0&&(N.console&&N.console.groupCollapsed&&N.console.groupCollapsed(`Text Track parsing errors for ${t.src}`),n.forEach(e=>nn.error(e)),N.console&&N.console.groupEnd&&N.console.groupEnd()),i.flush()},Ws=function(e,t){const i={uri:e},n=Hs(e);n&&(i.cors=n);const r="use-credentials"===t.tech_.crossOrigin();r&&(i.withCredentials=r),re(i,jr(this,function(e,i,n){if(e)return nn.error(e,i);t.loaded_=!0,"function"!=typeof N.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],e=>{if("vttjserror"!==e.type)return Gs(n,t);nn.error(`vttjs failed to load, stopping trying to process ${t.src}`)}):Gs(n,t)}))};let $s=class extends Bs{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=hn(e,{kind:Fs[e.kind]||"subtitles",language:e.language||e.srclang||""});let i=Us[t.mode]||"disabled";const n=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(i="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const r=new Os(this.cues_),s=new Os(this.activeCues_);let a=!1;this.timeupdateHandler=jr(this,function(e={}){this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,a&&(this.trigger("cuechange"),a=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))});this.tech_.one("dispose",()=>{this.stopTracking()}),"disabled"!==i&&this.startTracking(),Object.defineProperties(this,{default:{get:()=>n,set(){}},mode:{get:()=>i,set(e){Us[e]&&i!==e&&(i=e,this.preload_||"disabled"===i||0!==this.cues.length||Ws(this.src,this),this.stopTracking(),"disabled"!==i&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?r:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return s;const e=this.tech_.currentTime(),t=[];for(let i=0,n=this.cues.length;i<n;i++){const n=this.cues[i];n.startTime<=e&&n.endTime>=e&&t.push(n)}if(a=!1,t.length!==this.activeCues_.length)a=!0;else for(let i=0;i<t.length;i++)-1===this.activeCues_.indexOf(t[i])&&(a=!0);return this.activeCues_=t,s.setCues_(this.activeCues_),s},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&Ws(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new N.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const i in e)i in t||(t[i]=e[i]);t.id=e.id,t.originalCue_=e}const i=this.tech_.textTracks();for(let n=0;n<i.length;n++)i[n]!==this&&i[n].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}toJSON(){return As(this)}removeCue(e){let t=this.cues_.length;for(;t--;){const i=this.cues_[t];if(i===e||i.originalCue_&&i.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}};$s.prototype.allowedEvents_={cuechange:"cuechange"};let Xs=class extends Bs{constructor(e={}){const t=hn(e,{kind:Ns[e.kind]||""});super(t);let i=!1;Object.defineProperty(this,"enabled",{get:()=>i,set(e){"boolean"==typeof e&&e!==i&&(i=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}},Ys=class extends Bs{constructor(e={}){const t=hn(e,{kind:Rs[e.kind]||""});super(t);let i=!1;Object.defineProperty(this,"selected",{get:()=>i,set(e){"boolean"==typeof e&&e!==i&&(i=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}},Qs=class e extends Gr{constructor(t={}){let i;super();const n=new $s(t);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get:()=>i},track:{get:()=>n}}),i=e.NONE,n.addEventListener("loadeddata",()=>{i=e.LOADED,this.trigger({type:"load",target:this})})}};Qs.prototype.allowedEvents_={load:"load"},Qs.NONE=0,Qs.LOADING=1,Qs.LOADED=2,Qs.ERROR=3;const Ks={audio:{ListClass:Is,TrackClass:Xs,capitalName:"Audio"},video:{ListClass:Ls,TrackClass:Ys,capitalName:"Video"},text:{ListClass:Ds,TrackClass:$s,capitalName:"Text"}};Object.keys(Ks).forEach(function(e){Ks[e].getterName=`${e}Tracks`,Ks[e].privateName=`${e}Tracks_`});const Zs={remoteText:{ListClass:Ds,TrackClass:$s,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:class{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,i=e.length;t<i;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let i=0,n=this.trackElements_.length;i<n;i++)if(e===this.trackElements_[i].track){t=this.trackElements_[i];break}return t}removeTrackElement_(e){for(let t=0,i=this.trackElements_.length;t<i;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}},TrackClass:Qs,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Js=Object.assign({},Ks,Zs);Zs.names=Object.keys(Zs),Ks.names=Object.keys(Ks),Js.names=[].concat(Zs.names).concat(Ks.names);let ea=class e extends ls{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=e=>this.onDurationChange(e),this.trackProgress_=e=>this.trackProgress(e),this.trackCurrentTime_=e=>this.trackCurrentTime(e),this.stopTrackingCurrentTime_=e=>this.stopTrackingCurrentTime(e),this.disposeSourceHandler_=e=>this.disposeSourceHandler(e),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),Js.names.forEach(t=>{const i=Js[t];e&&e[i.getterName]&&(this[i.privateName]=e[i.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(t=>{!1===e[`native${t}Tracks`]&&(this[`featuresNative${t}Tracks`]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new Js.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(jr(this,function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return hs(0,0)}bufferedPercent(){return vs(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Ks.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){(e=[].concat(e)).forEach(e=>{const t=this[`${e}Tracks`]()||[];let i=t.length;for(;i--;){const n=t[i];"text"===e&&this.removeRemoteTextTrack(n),t.removeTrack(n)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const i=e[t];this.removeRemoteTextTrack(i)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new _s(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?hs(0,0):hs()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Ks.names.forEach(e=>{const t=Ks[e],i=()=>{this.trigger(`${e}trackchange`)},n=this[t.getterName]();n.addEventListener("removetrack",i),n.addEventListener("addtrack",i),this.on("dispose",()=>{n.removeEventListener("removetrack",i),n.removeEventListener("addtrack",i)})})}addWebVttScript_(){if(!N.WebVTT)if(z.body.contains(this.el())){if(!this.options_["vtt.js"]&&cn(ge)&&Object.keys(ge).length>0)return void this.trigger("vttjsloaded");const e=z.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),N.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),i=t=>e.addTrack(t.track),n=t=>e.removeTrack(t.track);t.on("addtrack",i),t.on("removetrack",n),this.addWebVttScript_();const r=()=>this.trigger("texttrackchange"),s=()=>{r();for(let t=0;t<e.length;t++){const i=e[t];i.removeEventListener("cuechange",r),"showing"===i.mode&&i.addEventListener("cuechange",r)}};s(),e.addEventListener("change",s),e.addEventListener("addtrack",s),e.addEventListener("removetrack",s),this.on("dispose",function(){t.off("addtrack",i),t.off("removetrack",n),e.removeEventListener("change",s),e.removeEventListener("addtrack",s),e.removeEventListener("removetrack",s);for(let t=0;t<e.length;t++){e[t].removeEventListener("cuechange",r)}})}addTextTrack(e,t,i){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,i,n,r={}){const s=e.textTracks();r.kind=t,i&&(r.label=i),n&&(r.language=n),r.tech=e;const a=new Js.text.TrackClass(r);return s.addTrack(a),a}(this,e,t,i)}createRemoteTextTrack(e){const t=hn(e,{tech:this});return new Zs.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const i=this.createRemoteTextTrack(e);return"boolean"!=typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(i),this.remoteTextTracks().addTrack(i.track),!1===t&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(i.track)),i}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=Mr();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(t,i){return e.canPlayType(t.type)}static isTech(t){return t.prototype instanceof e||t instanceof e||t===e}static registerTech(t,i){if(e.techs_||(e.techs_={}),!e.isTech(i))throw new Error(`Tech ${t} must be a Tech`);if(!e.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!e.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return t=ss(t),e.techs_[t]=i,e.techs_[rs(t)]=i,"Tech"!==t&&e.defaultTechOrder_.push(t),i}static getTech(t){if(t)return e.techs_&&e.techs_[t]?e.techs_[t]:(t=ss(t),N&&N.videojs&&N.videojs[t]?(nn.warn(`The ${t} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),N.videojs[t]):void 0)}};Js.names.forEach(function(e){const t=Js[e];ea.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),ea.prototype.featuresVolumeControl=!0,ea.prototype.featuresMuteControl=!0,ea.prototype.featuresFullscreenResize=!1,ea.prototype.featuresPlaybackRate=!1,ea.prototype.featuresProgressEvents=!1,ea.prototype.featuresSourceset=!1,ea.prototype.featuresTimeupdateEvents=!1,ea.prototype.featuresNativeTextTracks=!1,ea.prototype.featuresVideoFrameCallback=!1,ea.withSourceHandlers=function(e){e.registerSourceHandler=function(t,i){let n=e.sourceHandlers;n||(n=e.sourceHandlers=[]),void 0===i&&(i=n.length),n.splice(i,0,t)},e.canPlayType=function(t){const i=e.sourceHandlers||[];let n;for(let e=0;e<i.length;e++)if(n=i[e].canPlayType(t),n)return n;return""},e.selectSourceHandler=function(t,i){const n=e.sourceHandlers||[];let r;for(let e=0;e<n.length;e++)if(r=n[e].canHandleSource(t,i),r)return n[e];return null},e.canPlaySource=function(t,i){const n=e.selectSourceHandler(t,i);return n?n.canHandleSource(t,i):""};["seekable","seeking","duration"].forEach(function(e){const t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){let i=e.selectSourceHandler(t,this.options_);i||(e.nativeSourceHandler?i=e.nativeSourceHandler:nn.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),i!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=i.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},ls.registerComponent("Tech",ea),ea.registerTech("Tech",ea),ea.defaultTechOrder_=[];const ta={},ia={},na={};function ra(e,t,i){e.setTimeout(()=>ca(t,ta[t.type],i,e),1)}function sa(e,t,i,n=null){const r="call"+ss(i),s=e.reduce(ua(r),n),a=s===na,o=a?null:t[i](s);return function(e,t,i,n){for(let r=e.length-1;r>=0;r--){const s=e[r];s[t]&&s[t](n,i)}}(e,i,o,a),o}const aa={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},oa={setCurrentTime:1,setMuted:1,setVolume:1},la={play:1,pause:1};function ua(e){return(t,i)=>t===na?na:i[e]?i[e](t):t}function ca(e={},t=[],i,n,r=[],s=!1){const[a,...o]=t;if("string"==typeof a)ca(e,ta[a],i,n,r,s);else if(a){const t=function(e,t){const i=ia[e.id()];let n=null;if(null==i)return n=t(e),ia[e.id()]=[[t,n]],n;for(let r=0;r<i.length;r++){const[e,s]=i[r];e===t&&(n=s)}return null===n&&(n=t(e),i.push([t,n])),n}(n,a);if(!t.setSource)return r.push(t),ca(e,o,i,n,r,s);t.setSource(Object.assign({},e),function(a,l){if(a)return ca(e,o,i,n,r,s);r.push(t),ca(l,e.type===l.type?o:ta[l.type],i,n,r,s)})}else o.length?ca(e,o,i,n,r,s):s?i(e,r):ca(e,ta["*"],i,n,r,!0)}const ha={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},da=function(e=""){const t=Vs(e);return ha[t.toLowerCase()]||""},pa=function(e){if(Array.isArray(e)){let t=[];e.forEach(function(e){e=pa(e),Array.isArray(e)?t=t.concat(e):un(e)&&t.push(e)}),e=t}else e="string"==typeof e&&e.trim()?[fa({src:e})]:un(e)&&"string"==typeof e.src&&e.src&&e.src.trim()?[fa(e)]:[];return e};function fa(e){if(!e.type){const t=da(e.src);t&&(e.type=t)}return e}const ma=Pn?10009:Ln?461:8,ga={codes:{play:415,pause:19,ff:417,rw:412,back:ma},names:{415:"play",19:"pause",417:"ff",412:"rw",[ma]:"back"},isEventKey(e,t){return t=t.toLowerCase(),!(!this.names[e.keyCode]||this.names[e.keyCode]!==t)},getEventName(e){if(this.names[e.keyCode])return this.names[e.keyCode];if(this.codes[e.code]){const t=this.codes[e.code];return this.names[t]}return null}};class ya extends Gr{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const e=t.key.substring(5).toLowerCase();this.move(e)}else if(ga.isEventKey(t,"play")||ga.isEventKey(t,"pause")||ga.isEventKey(t,"ff")||ga.isEventKey(t,"rw")){t.preventDefault();const e=ga.getEventName(t);this.performMediaAction_(e)}else ga.isEventKey(t,"Back")&&e.target&&"function"==typeof e.target.closeable&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+5);break;case"rw":this.userSeek_(this.player_.currentTime()-5)}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let i=null;const n=this.getCurrentComponent(e.target);t&&(i=Boolean(t.closest(".video-js")),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(e.currentTarget.contains(e.relatedTarget)||i)&&t||(n&&"CloseButton"===n.name()?this.refocusComponent():(this.pause(),n&&n.el()&&(this.lastFocusedComponent_=n)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function i(e){for(const n of e)n.hasOwnProperty("el_")&&n.getIsFocusable()&&n.getIsAvailableToBeFocused(n.el())&&t.push(n),n.hasOwnProperty("children_")&&n.children_.length>0&&i(n.children_)}return e.children_.forEach(e=>{if(e.hasOwnProperty("el_")){if(e.getIsFocusable&&e.getIsAvailableToBeFocused&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el()))return void t.push(e);e.hasOwnProperty("children_")&&e.children_.length>0?i(e.children_):e.hasOwnProperty("items")&&e.items.length>0?i(e.items):this.findSuitableDOMChild(e)&&t.push(e)}if("ErrorDisplay"===e.name_&&e.opened_){const i=e.el_.querySelector(".vjs-errors-ok-button-container");if(i){i.querySelectorAll("button").forEach((e,i)=>{t.push({name:()=>"ModalButton"+(i+1),el:()=>e,getPositions:()=>{const t=e.getBoundingClientRect();return{boundingClientRect:{x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left},center:{x:t.left+t.width/2,y:t.top+t.height/2,width:0,height:0,top:t.top+t.height/2,right:t.left+t.width/2,bottom:t.top+t.height/2,left:t.left+t.width/2}}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:e=>!0,focus:()=>e.focus()})})}}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){return e.el()?function t(i){if(e.getIsFocusable(i)&&e.getIsAvailableToBeFocused(i))return i;for(let e=0;e<i.children.length;e++){const n=t(i.children[e]);if(n)return n}return null}(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length)for(const i of this.focusableComponents)if(i.el()===t)return i}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name())return this.focusableComponents.splice(t,1),void this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const i=t.getPositions(),n=this.focusableComponents.filter(n=>n!==t&&this.isInDirection_(i.boundingClientRect,n.getPositions().boundingClientRect,e)),r=this.findBestCandidate_(i.center,n,e);r?this.focus(r):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,i){let n=1/0,r=null;for(const s of t){const t=s.getPositions().center,a=this.calculateDistance_(e,t,i);a<n&&(n=a,r=s)}return r}isInDirection_(e,t,i){switch(i){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name())return void this.focus(this.focusableComponents[e])}else this.focus(this.updateFocusableComponents()[0])}focus(e){"object"==typeof e&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,i){const n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);let s;switch(i){case"right":case"left":s=n+100*r;break;case"up":s=2*r+.5*n;break;case"down":s=5*r+n;break;default:s=n+r}return s}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if("TextTrackSelect"===t.constructor.name){e.focus(t);break}}}ls.registerComponent("MediaLoader",class extends ls{constructor(e,t,i){if(super(e,hn({createEl:!1},t),i),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let n=0,r=t.playerOptions.techOrder;n<r.length;n++){const t=ss(r[n]);let i=ea.getTech(t);if(t||(i=ls.getComponent(t)),i&&i.isSupported()){e.loadTech_(t);break}}}});let va=class extends ls{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=e=>this.handleMouseOver(e),this.handleMouseOut_=e=>this.handleMouseOut(e),this.handleClick_=e=>this.handleClick(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.emitTapEvents(),this.enable()}createEl(e="div",t={},i={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&nn.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),i=Object.assign({role:"button"},i),this.tabIndex_=t.tabIndex;const n=qn(e,t,i);return this.player_.options_.experimentalSvgIcons||n.appendChild(qn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(n),n}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=qn("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(void 0===e)return this.controlText_||"Need Text";const i=this.localize(e);this.controlText_=e,Gn(this.controlTextEl_,i),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",i)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){" "===e.key||"Enter"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}};ls.registerComponent("ClickableComponent",va);let _a=class extends va{constructor(e,t){super(e,t),this.update(),this.update_=e=>this.update(e),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return qn("div",{className:"vjs-poster"})}crossOrigin(e){if(void 0===e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(qn("picture",{className:"vjs-poster",tabIndex:-1},{},qn("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?Ts(this.player_.play()):this.player_.pause())}};_a.prototype.crossorigin=_a.prototype.crossOrigin,ls.registerComponent("PosterImage",_a);const ba="#222",Ta="#ccc",Sa={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function wa(e,t){let i;if(4===e.length)i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");i=e.slice(1)}return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+t+")"}function xa(e,t,i){try{e.style[t]=i}catch(n){return}}function Aa(e){return e?`${e}px`:""}ls.registerComponent("TextTrackDisplay",class extends ls{constructor(e,t,i){super(e,t,i);const n=e=>this.updateDisplay(e),r=e=>{this.updateDisplayOverlay(),this.updateDisplay(e)};e.on("loadstart",e=>this.toggleDisplay(e)),e.on("useractive",n),e.on("userinactive",n),e.on("texttrackchange",n),e.on("loadedmetadata",e=>{this.updateDisplayOverlay(),this.preselectTrack(e)}),e.ready(jr(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",r),e.on("playerresize",r);const t=N.screen.orientation||N,i=N.screen.orientation?"change":"orientationchange";t.addEventListener(i,r),e.on("dispose",()=>t.removeEventListener(i,r));const n=this.options_.playerOptions.tracks||[];for(let e=0;e<n.length;e++)this.player_.addRemoteTextTrack(n[e],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),i=this.player_.cache_.selectedLanguage;let n,r,s;for(let a=0;a<t.length;a++){const o=t[a];i&&i.enabled&&i.language&&i.language===o.language&&o.kind in e?o.kind===i.kind?s=o:s||(s=o):i&&!i.enabled?(s=null,n=null,r=null):o.default&&("descriptions"!==o.kind||n?o.kind in e&&!r&&(r=o):n=o)}s?s.mode="showing":r?r.mode="showing":n&&(n.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"==typeof N.WebVTT&&N.WebVTT.processCues(N,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let i=0;i<e.length;++i){const n=e[i];"showing"===n.mode&&t.push(n)}return void this.updateForTrack(t)}let i=null,n=null,r=e.length;for(;r--;){const t=e[r];"showing"===t.mode&&("descriptions"===t.kind?i=t:n=t)}if(n?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(n)):i&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(i)),!N.CSS.supports("inset","10px")){const e=this.el_,t=e.querySelectorAll(".vjs-text-track-cue"),i=this.player_.controlBar.el_.getBoundingClientRect().height,n=this.player_.el_.getBoundingClientRect().height;e.style="",xa(e,"position","relative"),xa(e,"height",n-i+"px"),xa(e,"top","unset"),xa(e,"bottom",Dn?n+"px":"0px"),t.length>0&&t.forEach(e=>{if(e.style.inset){const t=e.style.inset.split(" ");3===t.length&&Object.assign(e.style,{top:t[0],right:t[1],bottom:t[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!N.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),i=e/t,n=this.player_.videoWidth()/this.player_.videoHeight();let r=0,s=0;Math.abs(i-n)>.1&&(i>n?r=Math.round((e-t*n)/2):s=Math.round((t-e/n)/2)),xa(this.el_,"insetInline",Aa(r)),xa(this.el_,"insetBlock",Aa(s))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),i=e.activeCues;let n=i.length;for(;n--;){const e=i[n];if(!e)continue;const r=e.displayState;if(t.color&&(r.firstChild.style.color=t.color),t.textOpacity&&xa(r.firstChild,"color",wa(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(r.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&xa(r.firstChild,"backgroundColor",wa(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?xa(r,"backgroundColor",wa(t.windowColor,t.windowOpacity)):r.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?r.firstChild.style.textShadow=`2px 2px 3px ${ba}, 2px 2px 4px ${ba}, 2px 2px 5px ${ba}`:"raised"===t.edgeStyle?r.firstChild.style.textShadow=`1px 1px ${ba}, 2px 2px ${ba}, 3px 3px ${ba}`:"depressed"===t.edgeStyle?r.firstChild.style.textShadow=`1px 1px ${Ta}, 0 1px ${Ta}, -1px -1px ${ba}, 0 -1px ${ba}`:"uniform"===t.edgeStyle&&(r.firstChild.style.textShadow=`0 0 4px ${ba}, 0 0 4px ${ba}, 0 0 4px ${ba}, 0 0 4px ${ba}`)),t.fontPercent&&1!==t.fontPercent){const e=N.parseFloat(r.style.fontSize);r.style.fontSize=e*t.fontPercent+"px",r.style.height="auto",r.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?r.firstChild.style.fontVariant="small-caps":r.firstChild.style.fontFamily=Sa[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!=typeof N.WebVTT||e.every(e=>!e.activeCues))return;const t=[];for(let i=0;i<e.length;++i){const n=e[i];for(let e=0;e<n.activeCues.length;++e)t.push(n.activeCues[e])}N.WebVTT.processCues(N,t,this.el_);for(let i=0;i<e.length;++i){const t=e[i];for(let e=0;e<t.activeCues.length;++e){const n=t.activeCues[e].displayState;Xn(n,"vjs-text-track-cue","vjs-text-track-cue-"+(t.language?t.language:i)),t.language&&er(n,"lang",t.language)}this.player_.textTrackSettings&&this.updateDisplayState(t)}}});ls.registerComponent("LoadingSpinner",class extends ls{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),i=qn("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),n=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return n.appendChild(i),n}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}});let Ea=class extends va{createEl(e,t={},i={}){const n=qn("button",t=Object.assign({className:this.buildCSSClass()},t),i=Object.assign({type:"button"},i));return this.player_.options_.experimentalSvgIcons||n.appendChild(qn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(n),n}addChild(e,t={}){const i=this.constructor.name;return nn.warn(`Adding an actionable (user controllable) child to a Button (${i}) is not supported; use a ClickableComponent instead.`),ls.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){" "!==e.key&&"Enter"!==e.key?super.handleKeyDown(e):e.stopPropagation()}};ls.registerComponent("Button",Ea);let Ca=class extends Ea{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",e=>this.handleMouseDown(e))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if("tap"===e.type||this.mouseused_&&"clientX"in e&&"clientY"in e)return Ts(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const i=this.player_.getChild("controlBar"),n=i&&i.getChild("playToggle");if(!n)return void this.player_.tech(!0).focus();const r=()=>n.focus();bs(t)?t.then(r,()=>{}):this.setTimeout(r,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}};Ca.prototype.controlText_="Play Video",ls.registerComponent("BigPlayButton",Ca);ls.registerComponent("CloseButton",class extends Ea{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){"Escape"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}});let Ma=class extends Ea{constructor(e,t={}){super(e,t),t.replay=void 0===t.replay||t.replay,this.setIcon("play"),this.on(e,"play",e=>this.handlePlay(e)),this.on(e,"pause",e=>this.handlePause(e)),t.replay&&this.on(e,"ended",e=>this.handleEnded(e))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?Ts(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",e=>this.handleSeeked(e))}};Ma.prototype.controlText_="Play",ls.registerComponent("PlayToggle",Ma);let ka=class extends ls{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],e=>this.update(e)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),i=qn("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}`},{role:"presentation"});return t.appendChild(i),this.contentEl_=qn("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){(this.player_.options_.enableSmoothSeeking||"seeking"!==e.type)&&this.updateContent(e)}updateTextNode_(e=0){e=gs(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,nn.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=z.createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}};ka.prototype.labelText_="Time",ka.prototype.controlText_="Time",ls.registerComponent("TimeDisplay",ka);let Ia=class extends ka{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():e&&e.target&&"function"==typeof e.target.pendingSeekTime?e.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}};Ia.prototype.labelText_="Current Time",Ia.prototype.controlText_="Current Time",ls.registerComponent("CurrentTimeDisplay",Ia);let Pa=class extends ka{constructor(e,t){super(e,t);const i=e=>this.updateContent(e);this.on(e,"durationchange",i),this.on(e,"loadstart",i),this.on(e,"loadedmetadata",i)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}};Pa.prototype.labelText_="Duration",Pa.prototype.controlText_="Duration",ls.registerComponent("DurationDisplay",Pa);ls.registerComponent("TimeDivider",class extends ls{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),i=super.createEl("span",{textContent:"/"});return t.appendChild(i),e.appendChild(t),e}});let La=class extends ka{constructor(e,t){super(e,t),this.on(e,"durationchange",e=>this.updateContent(e))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(qn("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!=typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}};La.prototype.labelText_="Remaining Time",La.prototype.controlText_="Remaining Time",ls.registerComponent("RemainingTimeDisplay",La);ls.registerComponent("LiveDisplay",class extends ls{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",e=>this.updateShowing(e))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=qn("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(qn("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}`})),this.contentEl_.appendChild(z.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}});let Da=class extends Ea{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=e=>this.updateLiveEdgeStatus(e),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=qn("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}};function Oa(e,t,i){return e=Number(e),Math.min(i,Math.max(t,isNaN(e)?t:e))}Da.prototype.controlText_="Seek to live, currently playing live",ls.registerComponent("SeekToLive",Da);var Ra=Object.freeze({__proto__:null,clamp:Oa});let Na=class extends ls{constructor(e,t){super(e,t),this.handleMouseDown_=e=>this.handleMouseDown(e),this.handleMouseUp_=e=>this.handleMouseUp(e),this.handleKeyDown_=e=>this.handleKeyDown(e),this.handleClick_=e=>this.handleClick(e),this.handleMouseMove_=e=>this.handleMouseMove(e),this.update_=e=>this.update(e),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},i={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),i=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},i),super.createEl(e,t,i)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||Sn||e.preventDefault(),ir(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;nr(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"})),e}getProgress(){return Number(Oa(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=ar(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,i=t&&t.enabled,n=t&&t.horizontalSeek;i?n&&"ArrowLeft"===e.key||!n&&"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):n&&"ArrowRight"===e.key||!n&&"ArrowUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):"ArrowUp"===e.key||"ArrowRight"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}};ls.registerComponent("Slider",Na);const Fa=(e,t)=>Oa(e/t*100,0,100).toFixed(2)+"%";ls.registerComponent("LoadProgressBar",class extends ls{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",e=>this.update(e))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=qn("span",{className:"vjs-control-text"}),i=qn("span",{textContent:this.localize("Loaded")}),n=z.createTextNode(": ");return this.percentageEl_=qn("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(i),t.appendChild(n),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),i=e&&e.isLive()?e.seekableEnd():this.player_.duration(),n=this.player_.bufferedEnd(),r=this.partEls_,s=Fa(n,i);this.percent_!==s&&(this.el_.style.width=s,Gn(this.percentageEl_,s),this.percent_=s);for(let a=0;a<t.length;a++){const e=t.start(a),i=t.end(a);let s=r[a];s||(s=this.el_.appendChild(qn()),r[a]=s),s.dataset.start===e&&s.dataset.end===i||(s.dataset.start=e,s.dataset.end=i,s.style.left=Fa(e,n),s.style.width=Fa(i-e,n))}for(let a=r.length;a>t.length;a--)this.el_.removeChild(r[a-1]);r.length=t.length})}});ls.registerComponent("TimeTooltip",class extends ls{constructor(e,t){super(e,t),this.update=zr(jr(this,this.update),Br)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,i){const n=sr(this.el_),r=rr(this.player_.el()),s=e.width*t;if(!r||!n)return;let a=e.left-r.left+s,o=e.width-s+(r.right-e.right);o||(o=e.width-s,a=s);let l=n.width/2;a<l?l+=l-a:o<l&&(l=o),l<0?l=0:l>n.width&&(l=n.width),l=Math.round(l),this.el_.style.right=`-${l}px`,this.write(i)}write(e){Gn(this.el_,e)}updateTime(e,t,i,n){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let r;const s=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),i=e-t*e;r=(i<1?"":"-")+gs(i,e)}else r=gs(i,s);this.update(e,t,r),n&&n()})}});let Ua=class extends ls{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=zr(jr(this,this.update),Br)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t,i){const n=this.getChild("timeTooltip");if(!n)return;const r=i&&i.target&&"function"==typeof i.target.pendingSeekTime?i.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,r)}};Ua.prototype.options_={children:[]},Nn||vn||Ua.prototype.options_.children.push("timeTooltip"),ls.registerComponent("PlayProgressBar",Ua);let Ba=class extends ls{constructor(e,t){super(e,t),this.update=zr(jr(this,this.update),Br)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const i=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,i,()=>{this.el_.style.left=e.width*t+"px"})}};Ba.prototype.options_={children:["timeTooltip"]},ls.registerComponent("MouseTimeDisplay",Ba);let ja=class e extends Na{constructor(t,i){(i=hn(e.prototype.options_,i)).children=[...i.children];const n=t.options_.disableSeekWhileScrubbingOnMobile&&(Nn||vn)||t.options_.disableSeekWhileScrubbingOnSTV;(!Nn&&!vn||n)&&i.children.splice(1,0,"mouseTimeDisplay"),super(t,i),this.shouldDisableSeekWhileScrubbing_=n,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=jr(this,this.update),this.update=zr(this.update_,Br),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in z&&"visibilityState"in z&&this.on(z,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===z.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,Br))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===z.visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const i=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),n=this.player_.liveTracker;let r=this.player_.duration();n&&n.isLive()&&(r=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===i&&this.duration_===r||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[gs(i,r),gs(r,r)],"{1} of {2}")),this.currentTime_=i,this.duration_=r),this.bar&&this.bar.update(rr(this.el()),this.getProgress(),e)}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(void 0!==e)if(null!==e){const t=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,t))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(null!==this.pendingSeekTime())return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let t;const i=this.player_.liveTracker;return i&&i.isLive()?(t=(e-i.seekableStart())/i.liveWindow(),i.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){dr(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!dr(e)||isNaN(this.player_.duration()))return;let i;t||this.player_.scrubbing()||this.player_.scrubbing(!0);const n=this.calculateDistance(e),r=this.player_.liveTracker;if(r&&r.isLive()){if(n>=.99)return void r.seekToLiveEdge();const e=r.seekableStart(),t=r.liveCurrentTime();if(i=e+n*r.liveWindow(),i>=t&&(i=t),i<=e&&(i=e+.1),i===1/0)return}else i=n*this.player_.duration(),i===this.player_.duration()&&(i-=.1);this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(i):this.userSeek_(i),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Ts(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const t=null!==this.pendingSeekTime()?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(t+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){null!==this.pendingSeekTime()&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if("Home"===e.key)e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if("End"===e.key)e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const i=.1*parseInt(e.key,10);t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*i):this.userSeek_(this.player_.duration()*i)}else"PageDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):"PageUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in z&&"visibilityState"in z&&this.off(z,"visibilitychange",this.toggleVisibility_),super.dispose()}};ja.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12},ls.registerComponent("SeekBar",ja);let za=class extends ls{constructor(e,t){super(e,t),this.handleMouseMove=zr(jr(this,this.handleMouseMove),Br),this.throttledHandleMouseSeek=zr(jr(this,this.handleMouseSeek),Br),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.handleMouseDownHandler_=e=>this.handleMouseDown(e),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const i=t.getChild("playProgressBar"),n=t.getChild("mouseTimeDisplay");if(!i&&!n)return;const r=t.el(),s=sr(r);let a=ar(r,e).x;a=Oa(a,0,1),n&&n.update(s,a),i&&i.update(s,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&Ts(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}};za.prototype.options_={children:["seekBar"]},ls.registerComponent("ProgressControl",za);let Va=class extends Ea{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],e=>this.handlePictureInPictureChange(e)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],e=>this.handlePictureInPictureEnabledChange(e)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){"audio"===this.player_.currentType().substring(0,5)||this.player_.audioPosterMode()||this.player_.audioOnlyMode()?(this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()):this.show()}handlePictureInPictureEnabledChange(){z.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in N?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){"function"==typeof z.exitPictureInPicture&&super.show()}};Va.prototype.controlText_="Picture-in-Picture",ls.registerComponent("PictureInPictureToggle",Va);let Ha=class extends Ea{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",e=>this.handleFullscreenChange(e)),!1===z[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}};Ha.prototype.controlText_="Fullscreen",ls.registerComponent("FullscreenToggle",Ha);ls.registerComponent("VolumeLevel",class extends ls{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}});ls.registerComponent("VolumeLevelTooltip",class extends ls{constructor(e,t){super(e,t),this.update=zr(jr(this,this.update),Br)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,i,n){if(!i){const i=rr(this.el_),n=rr(this.player_.el()),r=e.width*t;if(!n||!i)return;const s=e.left-n.left+r,a=e.width-r+(n.right-e.right);let o=i.width/2;s<o?o+=o-s:a<o&&(o=a),o<0?o=0:o>i.width&&(o=i.width),this.el_.style.right=`-${o}px`}this.write(`${n}%`)}write(e){Gn(this.el_,e)}updateVolume(e,t,i,n,r){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,i,n.toFixed(0)),r&&r()})}});let qa=class extends ls{constructor(e,t){super(e,t),this.update=zr(jr(this,this.update),Br)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,i){const n=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,i,n,()=>{i?this.el_.style.bottom=e.height*t+"px":this.el_.style.left=e.width*t+"px"})}};qa.prototype.options_={children:["volumeLevelTooltip"]},ls.registerComponent("MouseVolumeLevelDisplay",qa);let Ga=class extends Na{constructor(e,t){super(e,t),this.on("slideractive",e=>this.updateLastVolume_(e)),this.on(e,"volumechange",e=>this.updateARIAAttributes(e)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){dr(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const i=this.el(),n=rr(i),r=this.vertical();let s=ar(i,e);s=r?s.y:s.x,s=Oa(s,0,1),t.update(n,s,r)}dr(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)})}};Ga.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},Nn||vn||Ga.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Ga.prototype.playerEvent="volumechange",ls.registerComponent("VolumeBar",Ga);let Wa=class extends ls{constructor(e,t={}){t.vertical=t.vertical||!1,(void 0===t.volumeBar||cn(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(this,e),this.throttledHandleMouseMove=zr(jr(this,this.handleMouseMove),Br),this.handleMouseUpHandler_=e=>this.handleMouseUp(e),this.on("mousedown",e=>this.handleMouseDown(e)),this.on("touchstart",e=>this.handleMouseDown(e)),this.on("mousemove",e=>this.handleMouseMove(e)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}};Wa.prototype.options_={children:["volumeBar"]},ls.registerComponent("VolumeControl",Wa);let $a=class extends Ea{constructor(e,t){super(e,t),function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(this,e),this.on(e,["loadstart","volumechange"],e=>this.update(e))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),i=this.player_.lastVolume_();if(0===t){const e=i<.1?.1:i;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),Nn&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),Yn(this.el_,[0,1,2,3].reduce((e,t)=>e+`${t?" ":""}vjs-vol-${t}`,"")),Xn(this.el_,`vjs-vol-${t}`)}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)}};$a.prototype.controlText_="Mute",ls.registerComponent("MuteToggle",$a);let Xa=class extends ls{constructor(e,t={}){void 0!==t.inline?t.inline=t.inline:t.inline=!0,(void 0===t.volumeControl||cn(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=e=>this.handleKeyPress(e),this.on(e,["loadstart"],e=>this.volumePanelState_(e)),this.on(this.muteToggle,"keyup",e=>this.handleKeyPress(e)),this.on(this.volumeControl,"keyup",e=>this.handleVolumeControlKeyUp(e)),this.on("keydown",e=>this.handleKeyPress(e)),this.on("mouseover",e=>this.handleMouseOver(e)),this.on("mouseout",e=>this.handleMouseOut(e)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){"Escape"===e.key&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),Dr(z,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),Or(z,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){"Escape"===e.key&&this.handleMouseOut()}};Xa.prototype.options_={children:["muteToggle","volumeControl"]},ls.registerComponent("VolumePanel",Xa);class Ya extends Ea{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),i=this.player_.liveTracker,n=i&&i.isLive()?i.seekableEnd():this.player_.duration();let r;r=t+this.skipTime<=n?t+this.skipTime:n,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}Ya.prototype.controlText_="Skip Forward",ls.registerComponent("SkipForward",Ya);class Qa extends Ea{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),i=this.player_.liveTracker,n=i&&i.isLive()&&i.seekableStart();let r;r=n&&t-this.skipTime<=n?n:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}Qa.prototype.controlText_="Skip Backward",ls.registerComponent("SkipBackward",Qa);let Ka=class extends ls{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",e=>this.handleKeyDown(e)),this.boundHandleBlur_=e=>this.handleBlur(e),this.boundHandleTapClick_=e=>this.handleTapClick(e)}addEventListenerForItem(e){e instanceof ls&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof ls&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=qn(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),Dr(t,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||z.activeElement;if(!this.children().some(e=>e.el()===t)){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const i=t.filter(t=>t.el()===e.target)[0];if(!i)return;"CaptionSettingsMenuItem"!==i.name()&&this.menuButton_.focus()}}handleKeyDown(e){"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):"ArrowRight"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}};ls.registerComponent("Menu",Ka);let Za=class extends ls{constructor(e,t={}){super(e,t),this.menuButton_=new Ea(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const i=Ea.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+i,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const n=e=>this.handleClick(e);this.handleMenuKeyUp_=e=>this.handleMenuKeyUp(e),this.on(this.menuButton_,"tap",n),this.on(this.menuButton_,"click",n),this.on(this.menuButton_,"keydown",e=>this.handleKeyDown(e)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),Dr(z,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",e=>this.handleMouseLeave(e)),this.on("keydown",e=>this.handleSubmenuKeyDown(e))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new Ka(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=qn("li",{className:"vjs-menu-title",textContent:ss(this.options_.title),tabIndex:-1}),i=new ls(this.player_,{el:t});e.addItem(i)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";!0===this.options_.inline?e+="-inline":e+="-popup";return`vjs-menu-button ${e} ${Ea.prototype.buildCSSClass()} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),Or(z,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){"Escape"===e.key||"Tab"===e.key?(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus())):"Up"!==e.key&&("Down"!==e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)||this.buttonPressed_||(e.preventDefault(),this.pressButton())}handleMenuKeyUp(e){"Escape"!==e.key&&"Tab"!==e.key||this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){"Escape"!==e.key&&"Tab"!==e.key||(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),Nn&&Vn())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}};ls.registerComponent("MenuButton",Za);let Ja=class extends Za{constructor(e,t){const i=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!i)return;const n=jr(this,this.update);i.addEventListener("removetrack",n),i.addEventListener("addtrack",n),i.addEventListener("labelchange",n),this.player_.on("ready",n),this.player_.on("dispose",function(){i.removeEventListener("removetrack",n),i.removeEventListener("addtrack",n),i.removeEventListener("labelchange",n)})}};ls.registerComponent("TrackButton",Ja);let eo=class extends va{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,i){this.nonIconControl=!0;const n=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),i),r=qn("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?n.appendChild(r):n.replaceChild(r,n.querySelector(".vjs-icon-placeholder")),n}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}};ls.registerComponent("MenuItem",eo);let to=class extends eo{constructor(e,t){const i=t.track,n=e.textTracks();t.label=i.label||i.language||"Unknown",t.selected="showing"===i.mode,super(e,t),this.track=i,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const r=(...e)=>{this.handleTracksChange.apply(this,e)},s=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],r),n.addEventListener("change",r),n.addEventListener("selectedlanguagechange",s),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],r),n.removeEventListener("change",r),n.removeEventListener("selectedlanguagechange",s)}),void 0===n.onchange){let e;this.on(["tap","click"],function(){if("object"!=typeof N.Event)try{e=new N.Event("change")}catch(t){}e||(e=z.createEvent("Event"),e.initEvent("change",!0,!0)),n.dispatchEvent(e)})}this.handleTracksChange()}handleClick(e){const t=this.track,i=this.player_.textTracks();if(super.handleClick(e),i)for(let n=0;n<i.length;n++){const e=i[n];-1!==this.kinds.indexOf(e.kind)&&(e===t?"showing"!==e.mode&&(e.mode="showing"):"disabled"!==e.mode&&(e.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}};ls.registerComponent("TextTrackMenuItem",to);let io=class extends to{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let i=!0;for(let n=0,r=t.length;n<r;n++){const e=t[n];if(this.options_.kinds.indexOf(e.kind)>-1&&"showing"===e.mode){i=!1;break}}i!==this.isSelected_&&this.selected(i)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let i=!0;for(let n=0,r=t.length;n<r;n++){const e=t[n];if(["captions","descriptions","subtitles"].indexOf(e.kind)>-1&&"showing"===e.mode){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}};ls.registerComponent("OffTextTrackMenuItem",io);let no=class extends Ja{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=to){let i;this.label_&&(i=`${this.label_} off`),e.push(new io(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;const n=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let r=0;r<n.length;r++){const i=n[r];if(this.kinds_.indexOf(i.kind)>-1){const n=new t(this.player_,{track:i,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});n.addClass(`vjs-${i.kind}-menu-item`),e.push(n)}}return e}};ls.registerComponent("TextTrackButton",no);let ro=class extends eo{constructor(e,t){const i=t.track,n=t.cue,r=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=n.text,t.selected=n.startTime<=r&&r<n.endTime,super(e,t),this.track=i,this.cue=n}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}};ls.registerComponent("ChaptersTrackMenuItem",ro);let so=class extends no{constructor(e,t,i){super(e,t,i),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(e=>{e.selected(this.track_.activeCues[0]===e.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const i=e[t];if(i.kind===this.kind_)return i}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(ss(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new ro(this.player_,{track:this.track_,cue:n});e.push(r)}return e}};so.prototype.kind_="chapters",so.prototype.controlText_="Chapters",ls.registerComponent("ChaptersButton",so);let ao=class extends no{constructor(e,t,i){super(e,t,i),this.setIcon("audio-description");const n=e.textTracks(),r=jr(this,this.handleTracksChange);n.addEventListener("change",r),this.on("dispose",function(){n.removeEventListener("change",r)})}handleTracksChange(e){const t=this.player().textTracks();let i=!1;for(let n=0,r=t.length;n<r;n++){const e=t[n];if(e.kind!==this.kind_&&"showing"===e.mode){i=!0;break}}i?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}};ao.prototype.kind_="descriptions",ao.prototype.controlText_="Descriptions",ls.registerComponent("DescriptionsButton",ao);let oo=class extends no{constructor(e,t,i){super(e,t,i),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}};oo.prototype.kind_="subtitles",oo.prototype.controlText_="Subtitles",ls.registerComponent("SubtitlesButton",oo);let lo=class extends to{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}};ls.registerComponent("CaptionSettingsMenuItem",lo);let uo=class extends no{constructor(e,t,i){super(e,t,i),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new lo(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}};uo.prototype.kind_="captions",uo.prototype.controlText_="Captions",ls.registerComponent("CaptionsButton",uo);let co=class extends to{createEl(e,t,i){const n=super.createEl(e,t,i),r=n.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",n):r.appendChild(qn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(qn("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),n}};ls.registerComponent("SubsCapsMenuItem",co);let ho=class extends no{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(ss(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new lo(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,co),e}};ho.prototype.kinds_=["captions","subtitles"],ho.prototype.controlText_="Subtitles",ls.registerComponent("SubsCapsButton",ho);let po=class extends eo{constructor(e,t){const i=t.track,n=e.audioTracks();t.label=i.label||i.language||"Unknown",t.selected=i.enabled,super(e,t),this.track=i,this.addClass(`vjs-${i.kind}-menu-item`);const r=(...e)=>{this.handleTracksChange.apply(this,e)};n.addEventListener("change",r),this.on("dispose",()=>{n.removeEventListener("change",r)})}createEl(e,t,i){const n=super.createEl(e,t,i),r=n.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(r.appendChild(qn("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(qn("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),n}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const i=e[t];i!==this.track&&(i.enabled=i===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}};ls.registerComponent("AudioTrackMenuItem",po);let fo=class extends Ja{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let i=0;i<t.length;i++){const n=t[i];e.push(new po(this.player_,{track:n,selectable:!0,multiSelectable:!1}))}return e}};fo.prototype.controlText_="Audio Track",ls.registerComponent("AudioTrackButton",fo);let mo=class extends eo{constructor(e,t){const i=t.rate,n=parseFloat(i,10);t.label=i,t.selected=n===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=i,this.rate=n,this.on(e,"ratechange",e=>this.update(e))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}};mo.prototype.contentElType="button",ls.registerComponent("PlaybackRateMenuItem",mo);let go=class extends Za{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",e=>this.updateVisibility(e)),this.on(e,"ratechange",e=>this.updateLabel(e)),this.on(e,"playbackrateschange",e=>this.handlePlaybackRateschange(e))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=qn("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let i=e.length-1;i>=0;i--)t.push(new mo(this.player(),{rate:e[i]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}};go.prototype.controlText_="Playback Rate",ls.registerComponent("PlaybackRateMenuButton",go);let yo=class extends ls{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},i={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,i)}};ls.registerComponent("Spacer",yo);ls.registerComponent("CustomControlSpacer",class extends yo{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:""})}});let vo=class extends ls{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}};vo.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},ls.registerComponent("ControlBar",vo);let _o=class extends Cs{constructor(e,t){super(e,t),this.on(e,"error",e=>{this.open(e)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}};_o.prototype.options_=Object.assign({},Cs.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),ls.registerComponent("ErrorDisplay",_o);class bo extends ls{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim();return qn("select",{id:this.options_.id},{},this.options_.SelectOptions.map(e=>{const t=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${Mr()}`)+"-"+e[1].replace(/\W+/g,""),i=qn("option",{id:t,value:this.localize(e[0]),textContent:this.localize(e[1])});return i.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${t}`),i}))}}ls.registerComponent("TextTrackSelect",bo);class To extends ls{constructor(e,t={}){super(e,t);const i=qn("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(i);const n=this.options_.selects;for(const r of n){const t=this.options_.selectConfigs[r],i=t.className,n=t.id.replace("%s",this.options_.id_);let s=null;const a=`vjs_select_${Mr()}`;if("colors"===this.options_.type){s=qn("span",{className:i});const e=qn("label",{id:n,className:"vjs-label",textContent:this.localize(t.label)});e.setAttribute("for",a),s.appendChild(e)}const o=new bo(e,{SelectOptions:t.options,legendId:this.options_.legendId,id:a,labelId:n});this.addChild(o),"colors"===this.options_.type&&(s.appendChild(o.el()),this.el().appendChild(s))}}createEl(){return qn("fieldset",{className:this.options_.className})}}ls.registerComponent("TextTrackFieldset",To);class So extends ls{constructor(e,t={}){super(e,t);const i=this.options_.textTrackComponentid,n=new To(e,{id_:i,legendId:`captions-text-legend-${i}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(n);const r=new To(e,{id_:i,legendId:`captions-background-${i}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(r);const s=new To(e,{id_:i,legendId:`captions-window-${i}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(s)}createEl(){return qn("div",{className:"vjs-track-settings-colors"})}}ls.registerComponent("TextTrackSettingsColors",So);class wo extends ls{constructor(e,t={}){super(e,t);const i=this.options_.textTrackComponentid,n=new To(e,{id_:i,legendId:`captions-font-size-${i}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(n);const r=new To(e,{id_:i,legendId:`captions-edge-style-${i}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(r);const s=new To(e,{id_:i,legendId:`captions-font-family-${i}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(s)}createEl(){return qn("div",{className:"vjs-track-settings-font"})}}ls.registerComponent("TextTrackSettingsFont",wo);class xo extends ls{constructor(e,t={}){super(e,t);const i=new Ea(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});i.el().classList.remove("vjs-control","vjs-button"),i.el().textContent=this.localize("Reset"),this.addChild(i);const n=this.localize("Done"),r=new Ea(e,{controlText:n,className:"vjs-done-button"});r.el().classList.remove("vjs-control","vjs-button"),r.el().textContent=n,this.addChild(r)}createEl(){return qn("div",{className:"vjs-track-settings-controls"})}}ls.registerComponent("TrackSettingsControls",xo);const Ao="vjs-text-track-settings",Eo=["#000","Black"],Co=["#00F","Blue"],Mo=["#0FF","Cyan"],ko=["#0F0","Green"],Io=["#F0F","Magenta"],Po=["#F00","Red"],Lo=["#FFF","White"],Do=["#FF0","Yellow"],Oo=["1","Opaque"],Ro=["0.5","Semi-Transparent"],No=["0","Transparent"],Fo={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Eo,Lo,Po,ko,Co,Do,Io,Mo],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Oo,Ro,No],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Lo,Eo,Po,ko,Co,Do,Io,Mo],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Oo,Ro],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[No,Ro,Oo],className:"vjs-window-opacity vjs-opacity"}};function Uo(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}Fo.windowColor.options=Fo.backgroundColor.options;ls.registerComponent("TextTrackSettings",class extends Cs{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=qn("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new So(e,{textTrackComponentid:this.id_,selectConfigs:Fo,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const i=new wo(e,{textTrackComponentid:this.id_,selectConfigs:Fo,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(i);const n=new xo(e);this.addChild(n)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),on(Fo,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return ln(Fo,(e,t,i)=>{const n=(r=this.$(t.selector),s=t.parser,Uo(r.options[r.options.selectedIndex].value,s));var r,s;return void 0!==n&&(e[i]=n),e},{})}setValues(e){on(Fo,(t,i)=>{!function(e,t,i){if(t)for(let n=0;n<e.options.length;n++)if(Uo(e.options[n].value,i)===t){e.selectedIndex=n;break}}(this.$(t.selector),e[i],t.parser)})}setDefaults(){on(Fo,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(N.localStorage.getItem(Ao))}catch(t){nn.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?N.localStorage.setItem(Ao,JSON.stringify(e)):N.localStorage.removeItem(Ao)}catch(t){nn.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}});ls.registerComponent("ResizeManager",class extends ls{constructor(e,t){let i=t.ResizeObserver||N.ResizeObserver;null===t.ResizeObserver&&(i=!1);super(e,hn({createEl:!i,reportTouchActivity:!1},t)),this.ResizeObserver=t.ResizeObserver||N.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=Vr(()=>{this.resizeHandler()},100,!1,this),i?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){Or(this,"resize",e),Or(this,"unload",t),t=null};Dr(this.el_.contentWindow,"unload",t),Dr(this.el_.contentWindow,"resize",e)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}});const Bo={trackingThreshold:20,liveTolerance:15};ls.registerComponent("LiveTracker",class extends ls{constructor(e,t){super(e,hn(Bo,t,{createEl:!1})),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=e=>this.handlePlay(e),this.handleFirstTimeupdate_=e=>this.handleFirstTimeupdate(e),this.handleSeeked_=e=>this.handleSeeked(e),this.seekToLiveEdge_=e=>this.seekToLiveEdge(e),this.reset_(),this.on(this.player_,"durationchange",e=>this.handleDurationchange(e)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(N.performance.now().toFixed(4)),i=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+i;const n=this.liveCurrentTime(),r=this.player_.currentTime();let s=this.player_.paused()||this.seekedBehindLive_||Math.abs(n-r)>this.options_.liveTolerance;this.timeupdateSeen_&&n!==1/0||(s=!1),s!==this.behindLiveEdge_&&(this.behindLiveEdge_=s,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,Br),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let i=e?e.length:0;for(;i--;)t.push(e.end(i));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let i=e?e.length:0;for(;i--;)t.push(e.start(i));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"==typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}});ls.registerComponent("TitleBar",class extends ls{constructor(e,t){super(e,t),this.on("statechanged",e=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:qn("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${Mr()}`}),description:qn("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${Mr()}`})},qn("div",{className:"vjs-title-bar"},{},dn(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,i={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(e=>{const n=this.state[e],r=this.els[e],s=i[e];lr(r),n&&Gn(r,n),t&&(t.removeAttribute(s),n&&t.setAttribute(s,r.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}});const jo={initialDisplay:4e3,position:[],takeFocus:!1};ls.registerComponent("TransientButton",class extends Ea{constructor(e,t){super(e,t=hn(jo,t)),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],e=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=qn("button",{},{type:"button",class:this.buildCSSClass()},qn("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}});const zo=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const i=e.$$("source"),n=[];let r="";if(!i.length)return!1;for(let s=0;s<i.length;s++){const e=i[s].src;e&&-1===n.indexOf(e)&&n.push(e)}return!!n.length&&(1===n.length&&(r=n[0]),e.triggerSourceset(r),!0)},Vo=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=z.createElement(this.nodeName.toLowerCase());t.innerHTML=e;const i=z.createDocumentFragment();for(;t.childNodes.length;)i.appendChild(t.childNodes[0]);return this.innerText="",N.Element.prototype.appendChild.call(this,i),this.innerHTML}}),Ho=(e,t)=>{let i={};for(let n=0;n<e.length&&(i=Object.getOwnPropertyDescriptor(e[n],t),!(i&&i.set&&i.get));n++);return i.enumerable=!0,i.configurable=!0,i},qo=function(e){const t=e.el();if(t.resetSourceWatch_)return;const i={},n=(e=>Ho([e.el(),N.HTMLMediaElement.prototype,N.Element.prototype,Vo],"innerHTML"))(e),r=i=>(...n)=>{const r=i.apply(t,n);return zo(e),r};["append","appendChild","insertAdjacentHTML"].forEach(e=>{t[e]&&(i[e]=t[e],t[e]=r(i[e]))}),Object.defineProperty(t,"innerHTML",hn(n,{set:r(n.set)})),t.resetSourceWatch_=()=>{t.resetSourceWatch_=null,Object.keys(i).forEach(e=>{t[e]=i[e]}),Object.defineProperty(t,"innerHTML",n)},e.one("sourceset",t.resetSourceWatch_)},Go=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?zs(N.Element.prototype.getAttribute.call(this,"src")):""},set(e){return N.Element.prototype.setAttribute.call(this,"src",e),e}}),Wo=function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const i=(e=>Ho([e.el(),N.HTMLMediaElement.prototype,Go],"src"))(e),n=t.setAttribute,r=t.load;Object.defineProperty(t,"src",hn(i,{set:n=>{const r=i.set.call(t,n);return e.triggerSourceset(t.src),r}})),t.setAttribute=(i,r)=>{const s=n.call(t,i,r);return/src/i.test(i)&&e.triggerSourceset(t.src),s},t.load=()=>{const i=r.call(t);return zo(e)||(e.triggerSourceset(""),qo(e)),i},t.currentSrc?e.triggerSourceset(t.currentSrc):zo(e)||qo(e),t.resetSourceset_=()=>{t.resetSourceset_=null,t.load=r,t.setAttribute=n,Object.defineProperty(t,"src",i),t.resetSourceWatch_&&t.resetSourceWatch_()}};let $o=class e extends ea{constructor(e,t){super(e,t);const i=e.source;let n=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,i&&(this.el_.currentSrc!==i.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(i):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const i=[];for(;t--;){const r=e[t];"track"===r.nodeName.toLowerCase()&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),this.textTracks().addTrack(r.track),n||this.el_.hasAttribute("crossorigin")||!Hs(r.src)||(n=!0)):i.push(r))}for(let n=0;n<i.length;n++)this.el_.removeChild(i[n])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&n&&nn.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),(On||In)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),e.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){Wo(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const i=()=>{t=[];for(let i=0;i<e.length;i++){const n=e[i];"metadata"===n.kind&&t.push({track:n,storedMode:n.mode})}};i(),e.addEventListener("change",i),this.on("dispose",()=>e.removeEventListener("change",i));const n=()=>{for(let e=0;e<t.length;e++){const i=t[e];"disabled"===i.track.mode&&i.track.mode!==i.storedMode&&(i.track.mode=i.storedMode)}e.removeEventListener("change",n)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",i),e.removeEventListener("change",n),e.addEventListener("change",n)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",i),e.addEventListener("change",i),e.removeEventListener("change",n)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const i=e.toLowerCase();this[`${i}TracksListeners_`]&&Object.keys(this[`${i}TracksListeners_`]).forEach(e=>{this.el()[`${i}Tracks`].removeEventListener(e,this[`${i}TracksListeners_`][e])}),this[`featuresNative${e}Tracks`]=!t,this[`${i}TracksListeners_`]=null,this.proxyNativeTracksForType_(i)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=Ks[e],i=this.el()[t.getterName],n=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!i||!i.addEventListener)return;const r={change:t=>{const i={type:"change",target:n,currentTarget:n,srcElement:n};n.trigger(i),"text"===e&&this[Zs.remoteText.getterName]().trigger(i)},addtrack(e){n.addTrack(e.track)},removetrack(e){n.removeTrack(e.track)}},s=function(){const e=[];for(let t=0;t<n.length;t++){let r=!1;for(let e=0;e<i.length;e++)if(i[e]===n[t]){r=!0;break}r||e.push(n[t])}for(;e.length;)n.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=r,Object.keys(r).forEach(e=>{const t=r[e];i.addEventListener(e,t),this.on("dispose",n=>i.removeEventListener(e,t))}),this.on("loadstart",s),this.on("dispose",e=>this.off("loadstart",s))}proxyNativeTracks_(){Ks.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let t=this.options_.tag;if(!t||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(t){const i=t.cloneNode(!0);t.parentNode&&t.parentNode.insertBefore(i,t),e.disposeMediaElement(t),t=i}else{t=z.createElement("video");const e=hn({},this.options_.tag&&Zn(this.options_.tag));On&&!0===this.options_.nativeControlsForTouch||delete e.controls,Kn(t,Object.assign(e,{id:this.options_.techId,class:"vjs-tech"}))}t.playerId=this.options_.playerId}void 0!==this.options_.preload&&er(t,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(t.disablePictureInPicture=this.options_.disablePictureInPicture);const i=["loop","muted","playsinline","autoplay"];for(let e=0;e<i.length;e++){const n=i[e],r=this.options_[n];void 0!==r&&(r?er(t,n,n):tr(t,n),t[n]=r)}return t}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const i=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",i),void this.ready(function(){this.off("loadstart",t),this.off("loadedmetadata",i),e||this.trigger("loadstart")})}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(e){this.trigger(e)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&Fn?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){nn(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&vn&&Sn&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return"function"==typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)Ts(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return nn.error("Invalid source URL."),!1;const i={src:e};t&&(i.type=t);const n=qn("source",{},i);return this.el_.appendChild(n),!0}removeSourceElement(e){if(!e)return nn.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const i of t)if(i.src===e)return this.el_.removeChild(i),!0;return nn.warn(`No matching source element found with src: ${e}`),!1}reset(){e.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,i){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,i):super.addTextTrack(e,t,i)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=z.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const i=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(i),i}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let i=t.length;for(;i--;)e!==t[i]&&e!==t[i].track||this.el().removeChild(t[i])}}getVideoPlaybackQuality(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),N.performance&&(e.creationTime=N.performance.now()),e}};pn($o,"TEST_VID",function(){if(!jn())return;const e=z.createElement("video"),t=z.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e}),$o.isSupported=function(){try{$o.TEST_VID.volume=.5}catch(e){return!1}return!(!$o.TEST_VID||!$o.TEST_VID.canPlayType)},$o.canPlayType=function(e){return $o.TEST_VID.canPlayType(e)},$o.canPlaySource=function(e,t){return $o.canPlayType(e.type)},$o.canControlVolume=function(){try{const e=$o.TEST_VID.volume;$o.TEST_VID.volume=e/2+.1;const t=e!==$o.TEST_VID.volume;return t&&Nn?(N.setTimeout(()=>{$o&&$o.prototype&&($o.prototype.featuresVolumeControl=e!==$o.TEST_VID.volume)}),!1):t}catch(e){return!1}},$o.canMuteVolume=function(){try{const e=$o.TEST_VID.muted;return $o.TEST_VID.muted=!e,$o.TEST_VID.muted?er($o.TEST_VID,"muted","muted"):tr($o.TEST_VID,"muted"),e!==$o.TEST_VID.muted}catch(e){return!1}},$o.canControlPlaybackRate=function(){if(vn&&Sn&&xn<58)return!1;try{const e=$o.TEST_VID.playbackRate;return $o.TEST_VID.playbackRate=e/2+.1,e!==$o.TEST_VID.playbackRate}catch(e){return!1}},$o.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(z.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(z.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(z.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(z.createElement("audio"),"innerHTML",{get:e,set:e})}catch(e){return!1}return!0},$o.supportsNativeTextTracks=function(){return Fn||Nn&&Sn},$o.supportsNativeVideoTracks=function(){return!(!$o.TEST_VID||!$o.TEST_VID.videoTracks)},$o.supportsNativeAudioTracks=function(){return!(!$o.TEST_VID||!$o.TEST_VID.audioTracks)},$o.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([e,t]){pn($o.prototype,e,()=>$o[t](),!0)}),$o.prototype.featuresVolumeControl=$o.canControlVolume(),$o.prototype.movingMediaElementInDOM=!Nn,$o.prototype.featuresFullscreenResize=!0,$o.prototype.featuresProgressEvents=!0,$o.prototype.featuresTimeupdateEvents=!0,$o.prototype.featuresVideoFrameCallback=!(!$o.TEST_VID||!$o.TEST_VID.requestVideoFrameCallback),$o.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},$o.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let i=t.length;for(;i--;)e.removeChild(t[i]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){$o.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){$o.prototype["set"+ss(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(e){$o.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){$o.prototype["set"+ss(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){$o.prototype[e]=function(){return this.el_[e]()}}),ea.withSourceHandlers($o),$o.nativeSourceHandler={},$o.nativeSourceHandler.canPlayType=function(e){try{return $o.TEST_VID.canPlayType(e)}catch(t){return""}},$o.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return $o.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=Vs(e.src);return $o.nativeSourceHandler.canPlayType(`video/${t}`)}return""},$o.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},$o.nativeSourceHandler.dispose=function(){},$o.registerSourceHandler($o.nativeSourceHandler),ea.registerTech("Html5",$o);const Xo=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Yo={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},Qo=["tiny","xsmall","small","medium","large","xlarge","huge"],Ko={};Qo.forEach(e=>{const t="x"===e.charAt(0)?`x-${e.substring(1)}`:e;Ko[e]=`vjs-layout-${t}`});const Zo={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};let Jo=class e extends ls{constructor(t,i,n){if(t.id=t.id||i.id||`vjs_video_${Mr()}`,(i=Object.assign(e.getTagSettings(t),i)).initChildren=!1,i.createEl=!1,i.evented=!1,i.reportTouchActivity=!1,!i.language){const e=t.closest("[lang]");e&&(i.language=e.getAttribute("lang"))}if(super(null,i,n),this.boundDocumentFullscreenChange_=e=>this.documentFullscreenChange_(e),this.boundFullWindowOnEscKey_=e=>this.fullWindowOnEscKey(e),this.boundUpdateStyleEl_=e=>this.updateStyleEl_(e),this.boundApplyInitTime_=e=>this.applyInitTime_(e),this.boundUpdateCurrentBreakpoint_=e=>this.updateCurrentBreakpoint_(e),this.boundHandleTechClick_=e=>this.handleTechClick_(e),this.boundHandleTechDoubleClick_=e=>this.handleTechDoubleClick_(e),this.boundHandleTechTouchStart_=e=>this.handleTechTouchStart_(e),this.boundHandleTechTouchMove_=e=>this.handleTechTouchMove_(e),this.boundHandleTechTouchEnd_=e=>this.handleTechTouchEnd_(e),this.boundHandleTechTap_=e=>this.handleTechTap_(e),this.boundUpdatePlayerHeightOnAudioOnlyMode_=e=>this.updatePlayerHeightOnAudioOnlyMode_(e),this.isFullscreen_=!1,this.log=rn(this.id_),this.fsApi_=Ki,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=t,this.tagAttributes=t&&Zn(t),this.language(this.options_.language),i.languages){const e={};Object.getOwnPropertyNames(i.languages).forEach(function(t){e[t.toLowerCase()]=i.languages[t]}),this.languages_=e}else this.languages_=e.prototype.options_.languages;this.resetCache_(),this.poster_=i.poster||"",this.controls_=!!i.controls,t.controls=!1,t.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],t.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),i.plugins&&Object.keys(i.plugins).forEach(e=>{if("function"!=typeof this[e])throw new Error(`plugin "${e}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),ts(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(Dr(z,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=hn(this.options_);if(i.plugins&&Object.keys(i.plugins).forEach(e=>{this[e](i.plugins[e])}),i.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(i.playbackRates),i.experimentalSvgIcons){const e=(new N.DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play">\n      <path d="M16 10v28l22-14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">\n      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">\n      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">\n      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">\n      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">\n      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">\n      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">\n      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">\n      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">\n      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">\n      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">\n      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">\n      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>\n    </symbol>\n    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">\n      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">\n      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">\n      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">\n      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">\n      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">\n      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-share">\n      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">\n      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-square">\n      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">\n      <circle cx="24" cy="24" r="20"></circle>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">\n      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">\n      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">\n      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">\n      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">\n      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">\n      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">\n      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">\n      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">\n      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>\n    </symbol>\n    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">\n      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">\n      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">\n      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">\n      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">\n      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">\n      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">\n      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>\n      <path fill="none" d="M-1-3h24v24H-1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">\n      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">\n      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">\n      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">\n      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">\n      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>\n    </symbol>\n  </defs>\n</svg>',"image/svg+xml");if(e.querySelector("parsererror"))nn.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const t=e.documentElement;t.style.display="none",this.el_.appendChild(t),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio("audio"===t.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),i.spatialNavigation&&i.spatialNavigation.enabled&&(this.spatialNavigation=new ya(this),this.addClass("vjs-spatial-navigation-enabled")),On&&this.addClass("vjs-touch-enabled"),Nn||this.addClass("vjs-workinghover"),e.players[this.id_]=this;const s=$i.split(".")[0];this.addClass(`vjs-v${s}`),this.userActive(!0),this.reportUserActivity(),this.one("play",e=>this.listenForUserActivity_(e)),this.on("keydown",e=>this.handleKeyDown(e)),this.on("languagechange",e=>this.handleLanguagechange(e)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){var t;this.trigger("dispose"),this.off("dispose"),Or(z,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Or(z,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),e.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),t=this,ia.hasOwnProperty(t.id())&&delete ia[t.id()],Js.names.forEach(e=>{const t=this[Js[e].getterName]();t&&t.off&&t.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,i=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const n="video-js"===this.tag.tagName.toLowerCase();i?e=this.el_=t.parentNode:n||(e=this.el_=super.createEl("div"));const r=Zn(t);if(n){for(e=this.el_=t,t=this.tag=z.createElement("video");e.children.length;)t.appendChild(e.firstChild);$n(e,"video-js")||Xn(e,"video-js"),e.appendChild(t),i=this.playerElIngest_=e,Object.keys(e).forEach(i=>{try{t[i]=e[i]}catch(n){}})}t.setAttribute("tabindex","-1"),r.tabindex="-1",Sn&&Mn&&(t.setAttribute("role","application"),r.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in r&&delete r.width,"height"in r&&delete r.height,Object.getOwnPropertyNames(r).forEach(function(i){n&&"class"===i||e.setAttribute(i,r[i]),n&&t.setAttribute(i,r[i])}),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused");const s=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(e=>Un[e]).map(e=>"vjs-device-"+e.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...s),!0!==N.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=wr("vjs-styles-dimensions");const e=pr(".vjs-styles-defaults"),t=pr("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const a=t.getElementsByTagName("a");for(let o=0;o<a.length;o++){const e=a.item(o);Xn(e,"vjs-hidden"),e.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!i&&t.parentNode.insertBefore(e,t),Wn(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if(void 0===e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):nn.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const i=e+"_";if(void 0===t)return this[i]||0;if(""===t||"auto"===t)return this[i]=void 0,void this.updateStyleEl_();const n=parseFloat(t);isNaN(n)?nn.error(`Improper value "${t}" supplied for for ${e}`):(this[i]=n,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;var t,i;this.fluid_=!!e,$r(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),i=()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)},$r(t=this)?i():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(i))):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===N.VIDEOJS_NO_DYNAMIC_STYLE){const e="number"==typeof this.width_?this.width_:this.options_.width,t="number"==typeof this.height_?this.height_:this.options_.height,i=this.tech_&&this.tech_.el();return void(i&&(e>=0&&(i.width=e),t>=0&&(i.height=t)))}let e,t,i,n;i=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const r=i.split(":"),s=r[1]/r[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/s:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*s,n=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(n),xr(this.styleEl_,`\n      .${n} {\n        width: ${e}px;\n        height: ${t}px;\n      }\n\n      .${n}.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ${100*s}%;\n      }\n    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const i=ss(e),n=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==i&&this.tag&&(ea.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=i,this.isReady_=!1;let r=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(r=!1);const s={source:t,autoplay:r,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${n}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};Js.names.forEach(e=>{const t=Js[e];s[t.getterName]=this[t.privateName]}),Object.assign(s,this.options_[i]),Object.assign(s,this.options_[n]),Object.assign(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(s.startTime=this.cache_.currentTime);const a=ea.getTech(e);if(!a)throw new Error(`No Tech named '${i}' exists! '${i}' should be registered using videojs.registerTech()'`);this.tech_=new a(s),this.tech_.ready(jr(this,this.handleTechReady_),!0),xs(this.textTracksJson_||[],this.tech_),Xo.forEach(e=>{this.on(this.tech_,e,t=>this[`handleTech${ss(e)}_`](t))}),Object.keys(Yo).forEach(e=>{this.on(this.tech_,e,t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${Yo[e]}_`].bind(this),event:t}):this[`handleTech${Yo[e]}_`](t)})}),this.on(this.tech_,"loadstart",e=>this.handleTechLoadStart_(e)),this.on(this.tech_,"sourceset",e=>this.handleTechSourceset_(e)),this.on(this.tech_,"waiting",e=>this.handleTechWaiting_(e)),this.on(this.tech_,"ended",e=>this.handleTechEnded_(e)),this.on(this.tech_,"seeking",e=>this.handleTechSeeking_(e)),this.on(this.tech_,"play",e=>this.handleTechPlay_(e)),this.on(this.tech_,"pause",e=>this.handleTechPause_(e)),this.on(this.tech_,"durationchange",e=>this.handleTechDurationChange_(e)),this.on(this.tech_,"fullscreenchange",(e,t)=>this.handleTechFullscreenChange_(e,t)),this.on(this.tech_,"fullscreenerror",(e,t)=>this.handleTechFullscreenError_(e,t)),this.on(this.tech_,"enterpictureinpicture",e=>this.handleTechEnterPictureInPicture_(e)),this.on(this.tech_,"leavepictureinpicture",e=>this.handleTechLeavePictureInPicture_(e)),this.on(this.tech_,"error",e=>this.handleTechError_(e)),this.on(this.tech_,"posterchange",e=>this.handleTechPosterChange_(e)),this.on(this.tech_,"textdata",e=>this.handleTechTextData_(e)),this.on(this.tech_,"ratechange",e=>this.handleTechRateChange_(e)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===i&&this.tag||Wn(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){Js.names.forEach(e=>{const t=Js[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=ws(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&nn.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}version(){return{"video.js":$i}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!=typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const i=this.play();if(bs(i))return i.catch(e=>{throw t(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${e||""}`)})};let i;return"any"!==e||this.muted()?i="muted"!==e||this.muted()?this.play():t():(i=this.play(),bs(i)&&(i=i.catch(t))),bs(i)?i.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})}):void 0}updateSourceCaches_(e=""){let t=e,i="";"string"!=typeof t&&(t=e.src,i=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!i&&(i=((e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const i=e.cache_.sources.filter(e=>e.src===t);if(i.length)return i[0].type;const n=e.$$("source");for(let r=0;r<n.length;r++){const e=n[r];if(e.type&&e.src&&e.src===t)return e.type}return da(t)})(this,t)),this.cache_.source=hn({},e,{src:t,type:i});const n=this.cache_.sources.filter(e=>e.src&&e.src===t),r=[],s=this.$$("source"),a=[];for(let o=0;o<s.length;o++){const e=Zn(s[o]);r.push(e),e.src&&e.src===t&&a.push(e.src)}a.length&&!n.length?this.cache_.sources=r:n.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const i=this.currentSource().src,n=e.src;i&&!/^blob:/.test(i)&&/^blob:/.test(n)&&(!this.lastSource_||this.lastSource_.tech!==n&&this.lastSource_.player!==i)&&(t=()=>{}),t(n),e.src||this.tech_.any(["sourceset","loadstart"],e=>{if("sourceset"===e.type)return;const t=this.techGet_("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?Ts(this.play()):this.pause()))}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),t=>t.contains(e.target))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!z.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const i=this.el();let n=z[this.fsApi_.fullscreenElement]===i;!n&&i.matches&&(n=i.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(n)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in oa)return function(e,t,i,n){return t[i](e.reduce(ua(i),n))}(this.middleware_,this.tech_,e,t);if(e in la)return sa(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(i){throw nn(i),i}},!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in aa)return function(e,t,i){return e.reduceRight(ua(i),t[i]())}(this.middleware_,this.tech_,e);if(e in la)return sa(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw nn(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t;if("TypeError"===t.name)throw nn(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t;throw nn(t),t}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=Ts){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),i=Boolean(Fn||Nn);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=e=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&i&&this.load());const n=this.techGet_("play");i&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===n?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(n)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||hs(0,0)}scrubbing(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0===e?(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime):(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),this.cache_.initTime=0,void(isFinite(e)&&(this.cache_.currentTime=Number(e)))):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_)))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=hs(0,0)),e}seekable(){let e=this.techGet_("seekable");return e&&e.length||(e=hs(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return vs(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let i=e.end(e.length-1);return i>t&&(i=t),i}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((i,n)=>{function r(){t.off("fullscreenerror",a),t.off("fullscreenchange",s)}function s(){r(),i()}function a(e,t){r(),n(t)}t.one("fullscreenchange",s),t.one("fullscreenerror",a);const o=t.requestFullscreenHelper_(e);o&&(o.then(r,r),o.then(i,n))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),e}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,i)=>{function n(){e.off("fullscreenerror",s),e.off("fullscreenchange",r)}function r(){n(),t()}function s(e,t){n(),i(t)}e.one("fullscreenchange",r),e.one("fullscreenerror",s);const a=e.exitFullscreenHelper_();a&&(a.then(n,n),a.then(t,i))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=z[this.fsApi_.exitFullscreen]();return e&&Ts(e.then(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=z.documentElement.style.overflow,Dr(z,"keydown",this.boundFullWindowOnEscKey_),z.documentElement.style.overflow="hidden",Xn(z.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){"Escape"===e.key&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,Or(z,"keydown",this.boundFullWindowOnEscKey_),z.documentElement.style.overflow=this.docOrigOverflow,Yn(z.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&N.documentPictureInPicture){const e=z.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(qn("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),N.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>(gr(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",t=>{const i=t.target.querySelector(".video-js");e.parentNode.replaceChild(i,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in z&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return N.documentPictureInPicture&&N.documentPictureInPicture.window?(N.documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in z?z.exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;if(!t||!t.hotkeys)return;(e=>{const t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if("input"===t)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type);return-1!==["textarea"].indexOf(t)})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:i=t=>"f"===e.key.toLowerCase(),muteKey:n=t=>"m"===e.key.toLowerCase(),playPauseKey:r=t=>"k"===e.key.toLowerCase()||" "===e.key.toLowerCase()}=t;if(i.call(this,e)){e.preventDefault(),e.stopPropagation();const t=ls.getComponent("FullscreenToggle");!1!==z[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else if(n.call(this,e)){e.preventDefault(),e.stopPropagation();ls.getComponent("MuteToggle").prototype.handleClick.call(this,e)}else if(r.call(this,e)){e.preventDefault(),e.stopPropagation();ls.getComponent("PlayToggle").prototype.handleClick.call(this,e)}}canPlayType(e){let t;for(let i=0,n=this.options_.techOrder;i<n.length;i++){const r=n[i];let s=ea.getTech(r);if(s||(s=ls.getComponent(r)),s){if(s.isSupported()&&(t=s.canPlayType(e),t))return t}else nn.error(`The "${r}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(e){const t=this.options_.techOrder.map(e=>[e,ea.getTech(e)]).filter(([e,t])=>t?t.isSupported():(nn.error(`The "${e}" tech is undefined. Skipped browser support check for that tech.`),!1)),i=function(e,t,i){let n;return e.some(e=>t.some(t=>{if(n=i(e,t),n)return!0})),n};let n;const r=([e,t],i)=>{if(t.canPlaySource(i,this.options_[e.toLowerCase()]))return{source:i,tech:e}};var s;return n=this.options_.sourceOrder?i(e,t,(s=r,(e,t)=>s(t,e))):i(t,e,r),n||!1}handleSrc_(e,t){if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const i=pa(e);if(i.length){if(this.changingSrc_=!0,t||(this.cache_.sources=i),this.updateSourceCaches_(i[0]),ra(this,i[0],(e,n)=>{this.middleware_=n,t||(this.cache_.sources=i),this.updateSourceCaches_(e);if(this.src_(e))return i.length>1?this.handleSrc_(i.slice(1)):(this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void this.triggerReady());var r,s;r=n,s=this.tech_,r.forEach(e=>e.setTech&&e.setTech(s))}),i.length>1){const e=()=>{this.error(null),this.handleSrc_(i.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=()=>{this.off("error",e),this.off("playing",t)}}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(as(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1))}addSourceElement(e,t){return!!this.tech_&&this.tech_.addSourceElement(e,t)}removeSourceElement(e){return!!this.tech_&&this.tech_.removeSourceElement(e)}load(){this.tech_&&this.tech_.vhs?this.src(this.currentSource()):this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{Ts(this.play().then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),$r(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:i,remainingTimeDisplay:n}=this.controlBar||{},{seekBar:r}=i||{};e&&e.updateContent(),t&&t.updateContent(),n&&n.updateContent(),r&&(r.update(),r.loadProgressBar&&r.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(Yi("beforeerror").forEach(t=>{const i=t(this,e);un(i)&&!Array.isArray(i)||"string"==typeof i||"number"==typeof i||null===i?e=i:this.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",function(){this.off(["click","touchstart"],t)})}if(null===e)return this.error_=null,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new _s(e),this.addClass("vjs-error"),nn.error(`(CODE:${this.error_.code} ${_s.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),Yi("error").forEach(e=>e(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,i;const n=jr(this,this.reportUserActivity),r=function(t){n(),this.clearInterval(e)};this.on("mousedown",function(){n(),this.clearInterval(e),e=this.setInterval(n,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===i||(t=e.screenX,i=e.screenY,n())}),this.on("mouseup",r),this.on("mouseleave",r);const s=this.getChild("controlBar");let a;!s||Nn||vn||(s.on("mouseenter",function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),s.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",n),this.on("keyup",n);this.setInterval(function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a);const e=this.options_.inactivityTimeout;e<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))},250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");e&&this.audioOnlyCache_.controlBarHeight!==e.currentHeight()&&(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),i=t&&t.currentHeight();e.forEach(e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=i,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(i),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){if("boolean"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;if(this.audioPosterMode_=e,e){if(this.audioOnlyMode()){return this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.disablePosterModeUI_()})}addTextTrack(e,t,i){if(this.tech_)return this.tech_.addTextTrack(e,t,i)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),$r(this)&&this.trigger("languagechange"))}languages(){return hn(e.prototype.options_.languages,this.languages_)}toJSON(){const e=hn(this.options_),t=e.tracks;e.tracks=[];for(let i=0;i<t.length;i++){let n=t[i];n=hn(n),n.player=void 0,e.tracks[i]=n}return e}createModal(e,t){(t=t||{}).content=e||"";const i=new Cs(this,t);return this.addChild(i),i.on("dispose",()=>{this.removeChild(i)}),i.open(),i}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let i=0;i<Qo.length;i++){const n=Qo[i];if(t<=this.breakpoints_[n]){if(e===n)return;e&&this.removeClass(Ko[e]),this.addClass(Ko[n]),this.breakpoint_=n;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Object.assign({},Zo,e),this.updateCurrentBreakpoint_()),Object.assign(this.breakpoints_)}responsive(e){if(void 0===e)return this.responsive_;return(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return Ko[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!=typeof e)return;const i=this.crossOrigin();this.reset(),this.cache_.media=hn(e);const{artist:n,artwork:r,description:s,poster:a,src:o,textTracks:l,title:u}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:da(a)}]),i&&this.crossOrigin(i),o&&this.src(o),a&&this.poster(a),Array.isArray(l)&&l.forEach(e=>this.addRemoteTextTrack(e,!1)),this.titleBar&&this.titleBar.update({title:u,description:s||n||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),e=>({kind:e.kind,label:e.label,language:e.language,src:e.src}))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:da(t.poster)}]),t}return hn(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},i=Zn(e),n=i["data-setup"];if($n(e,"vjs-fill")&&(i.fill=!0),$n(e,"vjs-fluid")&&(i.fluid=!0),null!==n)try{Object.assign(i,JSON.parse(n||"{}"))}catch(r){nn.error("data-setup",r)}if(Object.assign(t,i),e.hasChildNodes()){const i=e.childNodes;for(let e=0,n=i.length;e<n;e++){const n=i[e],r=n.nodeName.toLowerCase();"source"===r?t.sources.push(Zn(n)):"track"===r&&t.tracks.push(Zn(n))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(e=>"number"==typeof e)&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}};Jo.prototype.videoTracks=()=>{},Jo.prototype.audioTracks=()=>{},Jo.prototype.textTracks=()=>{},Jo.prototype.remoteTextTracks=()=>{},Jo.prototype.remoteTextTrackEls=()=>{},Js.names.forEach(function(e){const t=Js[e];Jo.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),Jo.prototype.crossorigin=Jo.prototype.crossOrigin,Jo.players={};const el=N.navigator;Jo.prototype.options_={techOrder:ea.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:el&&(el.languages&&el.languages[0]||el.userLanguage||el.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1},Xo.forEach(function(e){Jo.prototype[`handleTech${ss(e)}_`]=function(){return this.trigger(e)}}),ls.registerComponent("Player",Jo);const tl="plugin",il="activePlugins_",nl={},rl=e=>nl.hasOwnProperty(e),sl=e=>rl(e)?nl[e]:void 0,al=(e,t)=>{e[il]=e[il]||{},e[il][t]=!0},ol=(e,t,i)=>{const n=(i?"before":"")+"pluginsetup";e.trigger(n,t),e.trigger(n+":"+t.name,t)},ll=(e,t)=>(t.prototype.name=e,function(...i){ol(this,{name:e,plugin:t,instance:null},!0);const n=new t(...[this,...i]);return this[e]=()=>n,ol(this,n.getEventHash()),n});let ul=class e{constructor(t){if(this.constructor===e)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,this.log||(this.log=this.player.log.createLogger(this.name)),ts(this),delete this.trigger,ns(this,this.constructor.defaultState),al(t,this.name),this.dispose=this.dispose.bind(this),t.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return Rr(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[il][e]=!1,this.player=this.state=null,t[e]=ll(e,nl[e])}static isBasic(t){const i="string"==typeof t?sl(t):t;return"function"==typeof i&&!e.prototype.isPrototypeOf(i.prototype)}static registerPlugin(t,i){if("string"!=typeof t)throw new Error(`Illegal plugin name, "${t}", must be a string, was ${typeof t}.`);if(rl(t))nn.warn(`A plugin named "${t}" already exists. You may want to avoid re-registering plugins!`);else if(Jo.prototype.hasOwnProperty(t))throw new Error(`Illegal plugin name, "${t}", cannot share a name with an existing player method!`);if("function"!=typeof i)throw new Error(`Illegal plugin for "${t}", must be a function, was ${typeof i}.`);return nl[t]=i,t!==tl&&(e.isBasic(i)?Jo.prototype[t]=function(e,t){const i=function(){ol(this,{name:e,plugin:t,instance:null},!0);const i=t.apply(this,arguments);return al(this,e),ol(this,{name:e,plugin:t,instance:i}),i};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i}(t,i):Jo.prototype[t]=ll(t,i)),i}static deregisterPlugin(e){if(e===tl)throw new Error("Cannot de-register base plugin.");rl(e)&&(delete nl[e],delete Jo.prototype[e])}static getPlugins(e=Object.keys(nl)){let t;return e.forEach(e=>{const i=sl(e);i&&(t=t||{},t[e]=i)}),t}static getPluginVersion(e){const t=sl(e);return t&&t.VERSION||""}};function cl(e,t,i,n){return function(e,t){let i=!1;return function(...n){return i||nn.warn(e),i=!0,t.apply(this,n)}}(`${t} is deprecated and will be removed in ${e}.0; please use ${i} instead.`,n)}ul.getPlugin=sl,ul.BASE_PLUGIN_NAME=tl,ul.registerPlugin(tl,ul),Jo.prototype.usingPlugin=function(e){return!!this[il]&&!0===this[il][e]},Jo.prototype.hasPlugin=function(e){return!!rl(e)};const hl=e=>0===e.indexOf("#")?e.slice(1):e;function dl(e,t,i){let n=dl.getPlayer(e);if(n)return t&&nn.warn(`Player "${e}" is already initialised. Options will not be applied.`),i&&n.ready(i),n;const r="string"==typeof e?pr("#"+hl(e)):e;if(!zn(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");const s="getRootNode"in r&&r.getRootNode()instanceof N.ShadowRoot?r.getRootNode():r.ownerDocument.body;r.ownerDocument.defaultView&&s.contains(r)||nn.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(r.parentNode&&r.parentNode.hasAttribute&&r.parentNode.hasAttribute("data-vjs-player")?r.parentNode:r).cloneNode(!0)),Yi("beforesetup").forEach(e=>{const i=e(r,hn(t));un(i)&&!Array.isArray(i)?t=hn(t,i):nn.error("please return an object in beforesetup hooks")});const a=ls.getComponent("Player");return n=new a(r,t,i),Yi("setup").forEach(e=>e(n)),n}if(dl.hooks_=Xi,dl.hooks=Yi,dl.hook=function(e,t){Yi(e,t)},dl.hookOnce=function(e,t){Yi(e,[].concat(t).map(t=>{const i=(...n)=>(Qi(e,i),t(...n));return i}))},dl.removeHook=Qi,!0!==N.VIDEOJS_NO_DYNAMIC_STYLE&&jn()){let e=pr(".vjs-styles-defaults");if(!e){e=wr("vjs-styles-defaults");const t=pr("head");t&&t.insertBefore(e,t.firstChild),xr(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}Tr(1,dl),dl.VERSION=$i,dl.options=Jo.prototype.options_,dl.getPlayers=()=>Jo.players,dl.getPlayer=e=>{const t=Jo.players;let i;if("string"==typeof e){const n=hl(e),r=t[n];if(r)return r;i=pr("#"+n)}else i=e;if(zn(i)){const{player:e,playerId:n}=i;if(e||t[n])return e||t[n]}},dl.getAllPlayers=()=>Object.keys(Jo.players).map(e=>Jo.players[e]).filter(Boolean),dl.players=Jo.players,dl.getComponent=ls.getComponent,dl.registerComponent=(e,t)=>(ea.isTech(t)&&nn.warn(`The ${e} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),ls.registerComponent.call(ls,e,t)),dl.getTech=ea.getTech,dl.registerTech=ea.registerTech,dl.use=function(e,t){ta[e]=ta[e]||[],ta[e].push(t)},Object.defineProperty(dl,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(dl.middleware,"TERMINATOR",{value:na,writeable:!1,enumerable:!0}),dl.browser=Un,dl.obj=fn,dl.mergeOptions=cl(9,"videojs.mergeOptions","videojs.obj.merge",hn),dl.defineLazyProperty=cl(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",pn),dl.bind=cl(9,"videojs.bind","native Function.prototype.bind",jr),dl.registerPlugin=ul.registerPlugin,dl.deregisterPlugin=ul.deregisterPlugin,dl.plugin=(e,t)=>(nn.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),ul.registerPlugin(e,t)),dl.getPlugins=ul.getPlugins,dl.getPlugin=ul.getPlugin,dl.getPluginVersion=ul.getPluginVersion,dl.addLanguage=function(e,t){return e=(""+e).toLowerCase(),dl.options.languages=hn(dl.options.languages,{[e]:t}),dl.options.languages[e]},dl.log=nn,dl.createLogger=rn,dl.time=ys,dl.createTimeRange=cl(9,"videojs.createTimeRange","videojs.time.createTimeRanges",hs),dl.createTimeRanges=cl(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",hs),dl.formatTime=cl(9,"videojs.formatTime","videojs.time.formatTime",gs),dl.setFormatTime=cl(9,"videojs.setFormatTime","videojs.time.setFormatTime",fs),dl.resetFormatTime=cl(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",ms),dl.parseUrl=cl(9,"videojs.parseUrl","videojs.url.parseUrl",js),dl.isCrossOrigin=cl(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Hs),dl.EventTarget=Gr,dl.any=Fr,dl.on=Dr,dl.one=Nr,dl.off=Or,dl.trigger=Rr,dl.xhr=re,dl.TrackList=Ms,dl.TextTrack=$s,dl.TextTrackList=Ds,dl.AudioTrack=Xs,dl.AudioTrackList=Is,dl.VideoTrack=Ys,dl.VideoTrackList=Ls,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(e=>{dl[e]=function(){return nn.warn(`videojs.${e}() is deprecated; use videojs.dom.${e}() instead`),yr[e].apply(null,arguments)}}),dl.computedStyle=cl(9,"videojs.computedStyle","videojs.dom.computedStyle",mr),dl.dom=yr,dl.fn=Hr,dl.num=Ra,dl.str=os,dl.url=qs,dl.Error={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};class pl{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get:()=>t.enabled_(),set(e){t.enabled_(e)}}),t}}class fl extends dl.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get:()=>e.selectedIndex_}),Object.defineProperty(e,"length",{get:()=>e.levels_.length}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const i=this.levels_.length;return t=new pl(e),""+i in this||Object.defineProperty(this,i,{get(){return this.levels_[i]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let i=0,n=this.length;i<n;i++)if(this[i]===e){t=this.levels_.splice(i,1)[0],this.selectedIndex_===i?this.selectedIndex_=-1:this.selectedIndex_>i&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,i=this.length;t<i;t++){const i=this[t];if(i.id===e)return i}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}fl.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const iE in fl.prototype.allowedEvents_)fl.prototype["on"+iE]=null;var ml="4.1.0";const gl=function(e){return function(e){const t=e.qualityLevels,i=new fl,n=function(){i.dispose(),e.qualityLevels=t,e.off("dispose",n)};return e.on("dispose",n),e.qualityLevels=()=>i,e.qualityLevels.VERSION=ml,i}(this,dl.obj.merge({},e))};dl.registerPlugin("qualityLevels",gl),gl.VERSION=ml;const yl=_e,vl=(e,t)=>t&&t.responseURL&&e!==t.responseURL?t.responseURL:e,_l=e=>dl.log.debug?dl.log.debug.bind(dl,"VHS:",`${e} >`):function(){};function bl(...e){const t=dl.obj||dl;return(t.merge||t.mergeOptions).apply(t,e)}function Tl(...e){const t=dl.time||dl;return(t.createTimeRanges||t.createTimeRanges).apply(t,e)}const Sl=1/30,wl=.1,xl=function(e,t){const i=[];let n;if(e&&e.length)for(n=0;n<e.length;n++)t(e.start(n),e.end(n))&&i.push([e.start(n),e.end(n)]);return Tl(i)},Al=function(e,t){return xl(e,function(e,i){return e-wl<=t&&i+wl>=t})},El=function(e,t){return xl(e,function(e){return e-Sl>=t})},Cl=e=>{const t=[];if(!e||!e.length)return"";for(let i=0;i<e.length;i++)t.push(e.start(i)+" => "+e.end(i));return t.join(", ")},Ml=e=>{const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t},kl=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},Il=function(e,t){let i=0;if(!e||!e.length)return i;for(let n=0;n<e.length;n++){const r=e.start(n),s=e.end(n);t>s||(i+=t>r&&t<=s?s-t:s-r)}return i},Pl=(e,t)=>{if(!t.preload)return t.duration;let i=0;return(t.parts||[]).forEach(function(e){i+=e.duration}),(t.preloadHints||[]).forEach(function(t){"PART"===t.type&&(i+=e.partTargetDuration)}),i},Ll=e=>(e.segments||[]).reduce((e,t,i)=>(t.parts?t.parts.forEach(function(n,r){e.push({duration:n.duration,segmentIndex:i,partIndex:r,part:n,segment:t})}):e.push({duration:t.duration,segmentIndex:i,partIndex:null,segment:t,part:null}),e),[]),Dl=e=>{const t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},Ol=({preloadSegment:e})=>{if(!e)return;const{parts:t,preloadHints:i}=e;let n=(i||[]).reduce((e,t)=>e+("PART"===t.type?1:0),0);return n+=t&&t.length?t.length:0,n},Rl=(e,t)=>{if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;const i=Dl(t).length>0;return i&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:i&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},Nl=function(e,t,i){if(void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;const n=function(e,t){let i=0,n=t-e.mediaSequence,r=e.segments[n];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;n--;){if(r=e.segments[n],void 0!==r.end)return{result:i+r.end,precise:!0};if(i+=Pl(e,r),void 0!==r.start)return{result:i+r.start,precise:!0}}return{result:i,precise:!1}}(e,t);if(n.precise)return n.result;const r=function(e,t){let i,n=0,r=t-e.mediaSequence;for(;r<e.segments.length;r++){if(i=e.segments[r],void 0!==i.start)return{result:i.start-n,precise:!0};if(n+=Pl(e,i),void 0!==i.end)return{result:i.end-n,precise:!0}}return{result:-1,precise:!1}}(e,t);return r.precise?r.result:n.result+i},Fl=function(e,t,i){if(!e)return 0;if("number"!=typeof i&&(i=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return N.Infinity}return Nl(e,t,i)},Ul=function({defaultDuration:e,durationList:t,startIndex:i,endIndex:n}){let r=0;if(i>n&&([i,n]=[n,i]),i<0){for(let t=i;t<Math.min(0,n);t++)r+=e;i=0}for(let s=i;s<n;s++)r+=t[s].duration;return r},Bl=function(e,t,i,n){if(!e||!e.segments)return null;if(e.endList)return Fl(e);if(null===t)return null;t=t||0;let r=Nl(e,e.mediaSequence+e.segments.length,t);return i&&(r-=n="number"==typeof n?n:Rl(null,e)),Math.max(0,r)},jl=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},zl=function(e){return e.excludeUntil&&e.excludeUntil===1/0},Vl=function(e){const t=jl(e);return!e.disabled&&!t},Hl=function(e,t){return t.attributes&&t.attributes[e]},ql=(e,t)=>{if(1===e.playlists.length)return!0;const i=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(e=>!!Vl(e)&&(e.attributes.BANDWIDTH||0)<i).length},Gl=(e,t)=>!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri)))),Wl=function(e,t){const i=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{};let n=!1;for(const r in i){for(const e in i[r])if(n=t(i[r][e]),n)break;if(n)break}return!!n},$l=e=>{if(!e||!e.playlists||!e.playlists.length){return Wl(e,e=>e.playlists&&e.playlists.length||e.uri)}for(let t=0;t<e.playlists.length;t++){const i=e.playlists[t],n=i.attributes&&i.attributes.CODECS;if(n&&n.split(",").every(e=>Ue(e)))continue;if(!Wl(e,e=>Gl(i,e)))return!1}return!0};var Xl={liveEdgeDelay:Rl,duration:Fl,seekable:function(e,t,i){const n=t||0;let r=Bl(e,t,!0,i);return null===r?Tl():(r<n&&(r=n),Tl(n,r))},getMediaInfoForTime:function({playlist:e,currentTime:t,startingSegmentIndex:i,startingPartIndex:n,startTime:r,exactManifestTimings:s}){let a=t-r;const o=Ll(e);let l=0;for(let u=0;u<o.length;u++){const e=o[u];if(i===e.segmentIndex&&("number"!=typeof n||"number"!=typeof e.partIndex||n===e.partIndex)){l=u;break}}if(a<0){if(l>0)for(let t=l-1;t>=0;t--){const i=o[t];if(a+=i.duration,s){if(a<0)continue}else if(a+Sl<=0)continue;return{partIndex:i.partIndex,segmentIndex:i.segmentIndex,startTime:r-Ul({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:t})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t}}if(l<0){for(let i=l;i<0;i++)if(a-=e.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t};l=0}for(let u=l;u<o.length;u++){const t=o[u];a-=t.duration;const i=t.duration>Sl;if(!(0===a)&&!(i&&a+Sl>=0)||u===o.length-1){if(s){if(a>0)continue}else if(a-Sl>=0)continue;return{partIndex:t.partIndex,segmentIndex:t.segmentIndex,startTime:r+Ul({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:u})}}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:t}},isEnabled:Vl,isDisabled:function(e){return e.disabled},isExcluded:jl,isIncompatible:zl,playlistEnd:Bl,isAes:function(e){for(let t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},hasAttribute:Hl,estimateSegmentRequestTime:function(e,t,i,n=0){if(!Hl("BANDWIDTH",i))return NaN;return(e*i.attributes.BANDWIDTH-8*n)/t},isLowestEnabledRendition:ql,isAudioOnly:$l,playlistMatch:Gl,segmentDurationWithParts:Pl};const{log:Yl}=dl,Ql=(e,t)=>`${e}-${t}`,Kl=(e,t,i)=>`placeholder-uri-${e}-${t}-${i}`,Zl=(e,t)=>{e.mediaGroups&&["AUDIO","SUBTITLES"].forEach(i=>{if(e.mediaGroups[i])for(const n in e.mediaGroups[i])for(const r in e.mediaGroups[i][n]){const s=e.mediaGroups[i][n][r];t(s,i,n,r)}})},Jl=({playlist:e,uri:t,id:i})=>{e.id=i,e.playlistErrors_=0,t&&(e.uri=t),e.attributes=e.attributes||{}},eu=(e,t,i=Kl)=>{e.uri=t;for(let r=0;r<e.playlists.length;r++)if(!e.playlists[r].uri){const t=`placeholder-uri-${r}`;e.playlists[r].uri=t}const n=$l(e);Zl(e,(t,r,s,a)=>{if(!t.playlists||!t.playlists.length){if(n&&"AUDIO"===r&&!t.uri)for(let t=0;t<e.playlists.length;t++){const i=e.playlists[t];if(i.attributes&&i.attributes.AUDIO&&i.attributes.AUDIO===s)return}t.playlists=[ye({},t)]}t.playlists.forEach(function(t,n){const o=i(r,s,a,t),l=Ql(n,o);t.uri?t.resolvedUri=t.resolvedUri||yl(e.uri,t.uri):(t.uri=0===n?o:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t})}),(e=>{let t=e.playlists.length;for(;t--;){const i=e.playlists[t];Jl({playlist:i,id:Ql(t,i.uri)}),i.resolvedUri=yl(e.uri,i.uri),e.playlists[i.id]=i,e.playlists[i.uri]=i,i.attributes.BANDWIDTH||Yl.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}})(e),(e=>{Zl(e,t=>{t.uri&&(t.resolvedUri=yl(e.uri,t.uri))})})(e)};class tu{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(null!==this.offset_)return;if(!e.length)return;const[t]=e;void 0!==t.programDateTime&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,i=t.startDate.getTime();this.trimProcessedDateRanges_(i),this.pendingDateRanges_=e.reduce((e,t)=>(e.set(t.id,t),e),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(null===this.offset_)return[];const e={},t=[];this.pendingDateRanges_.forEach((i,n)=>{if(!this.processedDateRanges_.has(n)&&(i.startTime=i.startDate.getTime()/1e3-this.offset_,i.processDateRange=()=>this.processDateRange(i),t.push(i),i.class))if(e[i.class]){const t=e[i.class].push(i);i.classListIndex=t-1}else e[i.class]=[i],i.classListIndex=0});for(const i of t){const t=e[i.class]||[];i.endDate?i.endTime=i.endDate.getTime()/1e3-this.offset_:i.endOnNext&&t[i.classListIndex+1]?i.endTime=t[i.classListIndex+1].startTime:i.duration?i.endTime=i.startTime+i.duration:i.plannedDuration?i.endTime=i.startTime+i.plannedDuration:i.endTime=i.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((t,i)=>{t.startDate.getTime()<e&&this.processedDateRanges_.delete(i)})}}const iu=({requestType:e,request:t,error:i,parseFailure:n})=>{const r=t.status<200||t.status>299,s=t.status>=400&&t.status<=499,a={uri:t.uri,requestType:e},o=r&&!s||n;if(i&&s)a.error=ye({},i),a.errorType=dl.Error.NetworkRequestFailed;else if(t.aborted)a.errorType=dl.Error.NetworkRequestAborted;else if(t.timedout)a.erroType=dl.Error.NetworkRequestTimeout;else if(o){const e=n?dl.Error.NetworkBodyParserFailed:dl.Error.NetworkBadStatus;a.errorType=e,a.status=t.status,a.headers=t.headers}return a},nu=_l("CodecUtils"),ru=function(e){const t=e.attributes||{};if(t.CODECS)return Fe(t.CODECS)},su=(e,t)=>{const i=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&i.AUDIO&&e.mediaGroups.AUDIO[i.AUDIO]},au=function(e){const t={};return e.forEach(({mediaType:e,type:i,details:n})=>{t[e]=t[e]||[],t[e].push(Ne(`${i}${n}`))}),Object.keys(t).forEach(function(e){if(t[e].length>1)return nu(`multiple ${e} codecs found as attributes: ${t[e].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),void(t[e]=null);t[e]=t[e][0]}),t},ou=function(e){let t=0;return e.audio&&t++,e.video&&t++,t},lu=function(e,t){const i=t.attributes||{},n=au(ru(t)||[]);if(su(e,t)&&!n.audio&&!((e,t)=>{if(!su(e,t))return!0;const i=t.attributes||{},n=e.mediaGroups.AUDIO[i.AUDIO];for(const r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1})(e,t)){const t=au(function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var i=e.mediaGroups.AUDIO[t];if(!i)return null;for(var n in i){var r=i[n];if(r.default&&r.playlists)return Fe(r.playlists[0].attributes.CODECS)}return null}(e,i.AUDIO)||[]);t.audio&&(n.audio=t.audio)}return n},{EventTarget:uu}=dl,cu=(e,t)=>{if(!e)return t;const i=bl(e,t);if(e.preloadHints&&!t.preloadHints&&delete i.preloadHints,e.parts&&!t.parts)delete i.parts;else if(e.parts&&t.parts)for(let n=0;n<t.parts.length;n++)e.parts&&e.parts[n]&&(i.parts[n]=bl(e.parts[n],t.parts[n]));return!e.skipped&&t.skipped&&(i.skipped=!1),e.preload&&!t.preload&&(i.preload=!1),i},hu=(e,t)=>{!e.resolvedUri&&e.uri&&(e.resolvedUri=yl(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=yl(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=yl(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=yl(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach(e=>{e.resolvedUri||(e.resolvedUri=yl(t,e.uri))}),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach(e=>{e.resolvedUri||(e.resolvedUri=yl(t,e.uri))})},du=function(e){const t=e.segments||[],i=e.preloadSegment;if(i&&i.parts&&i.parts.length){if(i.preloadHints)for(let e=0;e<i.preloadHints.length;e++)if("MAP"===i.preloadHints[e].type)return t;i.duration=e.targetDuration,i.preload=!0,t.push(i)}return t},pu=(e,t)=>e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment,fu=(e,t,i=pu)=>{const n=bl(e,{}),r=n.playlists[t.id];if(!r)return null;if(i(r,t))return null;t.segments=du(t);const s=bl(r,t);if(s.preloadSegment&&!t.preloadSegment&&delete s.preloadSegment,r.segments){if(t.skip){t.segments=t.segments||[];for(let e=0;e<t.skip.skippedSegments;e++)t.segments.unshift({skipped:!0})}s.segments=((e,t,i)=>{const n=e.slice(),r=t.slice();i=i||0;const s=[];let a;for(let o=0;o<r.length;o++){const e=n[o+i],t=r[o];e?(a=e.map||a,s.push(cu(e,t))):(a&&!t.map&&(t.map=a),s.push(t))}return s})(r.segments,t.segments,t.mediaSequence-r.mediaSequence)}s.segments.forEach(e=>{hu(e,s.resolvedUri)});for(let a=0;a<n.playlists.length;a++)n.playlists[a].id===t.id&&(n.playlists[a]=s);return n.playlists[t.id]=s,n.playlists[t.uri]=s,Zl(e,(e,i,n,r)=>{if(e.playlists)for(let a=0;a<e.playlists.length;a++)t.id===e.playlists[a].id&&(e.playlists[a]=s)}),n},mu=(e,t)=>{const i=e.segments||[],n=i[i.length-1],r=n&&n.parts&&n.parts[n.parts.length-1],s=r&&r.duration||n&&n.duration;return t&&s?1e3*s:500*(e.partTargetDuration||e.targetDuration||10)},gu=(e,t,i)=>{if(!e)return;const n=[];return e.forEach(e=>{if(!e.attributes)return;const{BANDWIDTH:t,RESOLUTION:i,CODECS:r}=e.attributes;n.push({id:e.id,bandwidth:t,resolution:i,codecs:r})}),{type:t,isLive:i,renditions:n}};let yu=class extends uu{constructor(e,t,i={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=_l("PlaylistLoader");const{withCredentials:n=!1}=i;this.src=e,this.vhs_=t,this.withCredentials=n,this.addDateRangesToTextTrack_=i.addDateRangesToTextTrack;const r=t.options_;this.customTagParsers=r&&r.customTagParsers||[],this.customTagMappers=r&&r.customTagMappers||[],this.llhls=r&&r.llhls,this.dateRangesStorage_=new tu,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();t.length&&this.addDateRangesToTextTrack_&&this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if("HAVE_METADATA"!==this.state)return;const e=this.media();let t=yl(this.main.uri,e.uri);this.llhls&&(t=((e,t)=>{if(t.endList||!t.serverControl)return e;const i={};if(t.serverControl.canBlockReload){const{preloadSegment:e}=t;let n=t.mediaSequence+t.segments.length;if(e){const r=e.parts||[],s=Ol(t)-1;s>-1&&s!==r.length-1&&(i._HLS_part=s),(s>-1||r.length)&&n--}i._HLS_msn=n}if(t.serverControl&&t.serverControl.canSkipUntil&&(i._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(i).length){const t=new N.URL(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(e){i.hasOwnProperty(e)&&t.searchParams.set(e,i[e])}),e=t.toString()}return e})(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(e,t)=>{if(this.request)return e?this.playlistRequestError(this.request,this.media(),"HAVE_METADATA"):void this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})})}playlistRequestError(e,t,i){const{uri:n,id:r}=t;this.request=null,i&&(this.state=i),this.error={playlist:this.main.playlists[r],status:e.status,message:`HLS playlist request error at URL: ${n}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:iu({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const i=(({onwarn:e,oninfo:t,manifestString:i,customTagParsers:n=[],customTagMappers:r=[],llhls:s})=>{const a=new Ie;e&&a.on("warn",e),t&&a.on("info",t),n.forEach(e=>a.addParser(e)),r.forEach(e=>a.addTagMapper(e)),a.push(i),a.end();const o=a.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(e){o.hasOwnProperty(e)&&delete o[e]}),o.segments&&o.segments.forEach(function(e){["parts","preloadHints"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})),!o.targetDuration){let t=10;o.segments&&o.segments.length&&(t=o.segments.reduce((e,t)=>Math.max(e,t.duration),0)),e&&e({message:`manifest has no targetDuration defaulting to ${t}`}),o.targetDuration=t}const l=Dl(o);if(l.length&&!o.partTargetDuration){const t=l.reduce((e,t)=>Math.max(e,t.duration),0);e&&(e({message:`manifest has no partTargetDuration defaulting to ${t}`}),Yl.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=t}return o})({onwarn:({message:t})=>this.logger_(`m3u8-parser warn for ${e}: ${t}`),oninfo:({message:t})=>this.logger_(`m3u8-parser info for ${e}: ${t}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return i.playlists&&i.playlists.length?(this.excludeAudioOnlyVariants(i.playlists),i):i}catch(i){this.error=i,this.error.metadata={errorType:dl.Error.StreamingHlsPlaylistParserError,error:i}}}excludeAudioOnlyVariants(e){const t=e=>{const t=e.attributes||{},{width:i,height:n}=t.RESOLUTION||{};if(i&&n)return!0;const r=ru(e)||[],s=au(r);return Boolean(s.video)};e.some(t)&&e.forEach(e=>{t(e)||(e.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:i,id:n}){this.request=null,this.state="HAVE_METADATA";const r={playlistInfo:{type:"media",uri:i}};this.trigger({type:"playlistparsestart",metadata:r});const s=t||this.parseManifest_({url:i,manifestString:e});s.lastRequest=Date.now(),Jl({playlist:s,uri:i,id:n});const a=fu(this.main,s);this.targetDuration=s.partTargetDuration||s.targetDuration,this.pendingMedia_=null,a?(this.main=a,this.media_=this.main.playlists[n]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(mu(this.media(),!!a)),r.parsedPlaylist=gu(this.main.playlists,r.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:r}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),N.clearTimeout(this.mediaUpdateTimeout),N.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new tu,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(N.clearTimeout(this.finalRenditionTimeout),t){const t=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;return void(this.finalRenditionTimeout=N.setTimeout(this.media.bind(this,e,!1),t))}const i=this.state,n=!this.media_||e.id!==this.media_.id,r=this.main.playlists[e.id];if(r&&r.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),"HAVE_MAIN_MANIFEST"===i?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(mu(e,!0)),!n)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const s={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:s}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,n)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=vl(e.resolvedUri,n),t)return this.playlistRequestError(this.request,e,i);this.trigger({type:"playlistrequestcomplete",metadata:s}),this.haveMetadata({playlistString:n.responseText,url:e.uri,id:e.id}),"HAVE_MAIN_MANIFEST"===i?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const e=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;return void(this.mediaUpdateTimeout=N.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},e))}this.started?t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=N.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=N.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,i)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:i.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:i.responseText,code:2,metadata:iu({requestType:i.requestType,request:i,error:t})},"HAVE_NOTHING"===this.state&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=vl(this.src,i),this.trigger({type:"playlistparsestart",metadata:e});const n=this.parseManifest_({manifestString:i.responseText,url:this.src});e.parsedPlaylist=gu(n.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(n)})}srcUri(){return"string"==typeof this.src?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists)return this.main=e,eu(this.main,this.srcUri()),e.playlists.forEach(e=>{e.segments=du(e),e.segments.forEach(t=>{hu(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.main.playlists[0]));const t=this.srcUri()||N.location.href;this.main=((e,t)=>{const i=Ql(0,t),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:N.location.href,resolvedUri:N.location.href,playlists:[{uri:t,id:i,resolvedUri:t,attributes:{}}]};return n.playlists[i]=n.playlists[0],n.playlists[t]=n.playlists[0],n})(0,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const i=this.main,n=e.ID;let r=i.playlists.length;for(;r--;){const s=i.playlists[r];if(s.attributes["PATHWAY-ID"]===n){const a=s.resolvedUri,o=s.id;if(t){const t=this.createCloneURI_(s.resolvedUri,e),a=Ql(n,t),o=this.createCloneAttributes_(n,s.attributes),l=this.createClonePlaylist_(s,a,e,o);i.playlists[r]=l,i.playlists[a]=l,i.playlists[t]=l}else i.playlists.splice(r,1);delete i.playlists[o],delete i.playlists[a]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const i=this.main,n=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{if(i.mediaGroups[e]&&i.mediaGroups[e][n])for(const t in i.mediaGroups[e])if(t===n){for(const n in i.mediaGroups[e][t]){i.mediaGroups[e][t][n].playlists.forEach((e,t)=>{const n=i.playlists[e.id],r=n.id,s=n.resolvedUri;delete i.playlists[r],delete i.playlists[s]})}delete i.mediaGroups[e][t]}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const i=this.main,n=i.playlists.length,r=this.createCloneURI_(t.resolvedUri,e),s=Ql(e.ID,r),a=this.createCloneAttributes_(e.ID,t.attributes),o=this.createClonePlaylist_(t,s,e,a);i.playlists[n]=o,i.playlists[s]=o,i.playlists[r]=o,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,i=e["BASE-ID"],n=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{if(n.mediaGroups[r]&&!n.mediaGroups[r][t])for(const s in n.mediaGroups[r])if(s===i){n.mediaGroups[r][t]={};for(const i in n.mediaGroups[r][s]){const a=n.mediaGroups[r][s][i];n.mediaGroups[r][t][i]=ye({},a);const o=n.mediaGroups[r][t][i],l=this.createCloneURI_(a.resolvedUri,e);o.resolvedUri=l,o.uri=l,o.playlists=[],a.playlists.forEach((s,a)=>{const l=n.playlists[s.id],u=Kl(r,t,i),c=Ql(t,u);if(l&&!n.playlists[c]){const t=this.createClonePlaylist_(l,c,e),i=t.resolvedUri;n.playlists[c]=t,n.playlists[i]=t}o.playlists[a]=this.createClonePlaylist_(s,c,e)})}}})}createClonePlaylist_(e,t,i,n){const r=this.createCloneURI_(e.resolvedUri,i),s={resolvedUri:r,uri:r,id:t};return e.segments&&(s.segments=[]),n&&(s.attributes=n),bl(e,s)}createCloneURI_(e,t){const i=new URL(e);i.hostname=t["URI-REPLACEMENT"].HOST;const n=t["URI-REPLACEMENT"].PARAMS;for(const r of Object.keys(n))i.searchParams.set(r,n[r]);return i.href}createCloneAttributes_(e,t){const i={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(n=>{t[n]&&(i[n]=e)}),i}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const i in e.contentProtection){const n=e.contentProtection[i].attributes.keyId;n&&t.add(n.toLowerCase())}return t}}};const vu=function(e,t,i,n){const r="arraybuffer"===e.responseType?e.response:e.responseText;!t&&r&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=r.byteLength||r.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),i.headers&&(e.responseHeaders=i.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===i.statusCode||206===i.statusCode||0===i.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(r||e.responseText)))),n(t,e)},_u=function(){const e=function e(t,i){t=bl({timeout:45e3},t);const n=e.beforeRequest||dl.Vhs.xhr.beforeRequest,r=e._requestCallbackSet||dl.Vhs.xhr._requestCallbackSet||new Set,s=e._responseCallbackSet||dl.Vhs.xhr._responseCallbackSet;n&&"function"==typeof n&&(dl.log.warn("beforeRequest is deprecated, use onRequest instead."),r.add(n));const a=!0===dl.Vhs.xhr.original?dl.xhr:dl.Vhs.xhr,o=((e,t)=>{if(!e||!e.size)return;let i=t;return e.forEach(e=>{i=e(i)}),i})(r,t);r.delete(n);const l=a(o||t,function(e,t){return((e,t,i,n)=>{e&&e.size&&e.forEach(e=>{e(t,i,n)})})(s,l,e,t),vu(l,e,t,i)}),u=l.abort;return l.abort=function(){return l.aborted=!0,u.apply(l,arguments)},l.uri=t.uri,l.requestType=t.requestType,l.requestTime=Date.now(),l};return e.original=!0,e},bu=function(e){const t={};return e.byterange&&(t.Range=function(e){let t;const i=e.offset;return t="bigint"==typeof e.offset||"bigint"==typeof e.length?N.BigInt(e.offset)+N.BigInt(e.length)-N.BigInt(1):e.offset+e.length-1,"bytes="+i+"-"+t}(e.byterange)),t},Tu=function(e,t){return e.start(t)+"-"+e.end(t)},Su=function(e,t){const i=e.toString(16);return"00".substring(0,2-i.length)+i+(t%2?" ":"")},wu=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},xu=function(e){const t={};return Object.keys(e).forEach(i=>{const n=e[i];We(n)?t[i]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:t[i]=n}),t},Au=function(e){const t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},Eu=function(e){return e.resolvedUri},Cu=e=>{const t=Array.prototype.slice.call(e),i=16;let n,r,s="";for(let a=0;a<t.length/i;a++)n=t.slice(a*i,a*i+i).map(Su).join(""),r=t.slice(a*i,a*i+i).map(wu).join(""),s+=n+" "+r+"\n";return s};var Mu=Object.freeze({__proto__:null,createTransferableMessage:xu,initSegmentId:Au,segmentKeyId:Eu,hexDump:Cu,tagDump:({bytes:e})=>Cu(e),textRanges:e=>{let t,i="";for(t=0;t<e.length;t++)i+=Tu(e,t)+" ";return i}});const ku=({playlist:e,time:t,callback:i})=>{if(!i)throw new Error("getProgramTime: callback must be provided");if(!e||void 0===t)return i({message:"getProgramTime: playlist and time must be provided"});const n=((e,t)=>{if(!t||!t.segments||0===t.segments.length)return null;let i,n=0;for(let s=0;s<t.segments.length&&(i=t.segments[s],n=i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:n+i.duration,!(e<=n));s++);const r=t.segments[t.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>n){if(e>n+.25*r.duration)return null;i=r}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:n-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}})(t,e);if(!n)return i({message:"valid programTime was not found"});if("estimate"===n.type)return i({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const r={mediaSeconds:t},s=((e,t)=>{if(!t.dateTimeObject)return null;const i=t.videoTimingInfo.transmuxerPrependedSeconds,n=e-(t.videoTimingInfo.transmuxedPresentationStart+i);return new Date(t.dateTimeObject.getTime()+1e3*n)})(t,n.segment);return s&&(r.programDateTime=s.toISOString()),i(null,r)},Iu=({programTime:e,playlist:t,retryCount:i=2,seekTo:n,pauseAfterSeek:r=!0,tech:s,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(void 0===e||!t||!n)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!t.endList&&!s.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!(e=>{if(!e.segments||0===e.segments.length)return!1;for(let t=0;t<e.segments.length;t++)if(!e.segments[t].dateTimeObject)return!1;return!0})(t))return a({message:"programDateTime tags must be provided in the manifest "+t.resolvedUri});const o=((e,t)=>{let i;try{i=new Date(e)}catch(l){return null}if(!t||!t.segments||0===t.segments.length)return null;let n=t.segments[0];if(i<new Date(n.dateTimeObject))return null;for(let u=0;u<t.segments.length-1&&(n=t.segments[u],!(i<new Date(t.segments[u+1].dateTimeObject)));u++);const r=t.segments[t.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?(o=r.videoTimingInfo).transmuxedPresentationEnd-o.transmuxedPresentationStart-o.transmuxerPrependedSeconds:r.duration+.25*r.duration;var o;return i>new Date(s.getTime()+1e3*a)?null:(i>new Date(s)&&(n=r),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:Xl.duration(t,t.mediaSequence+t.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})})(e,t);if(!o)return a({message:`${e} was not found in the stream`});const l=o.segment,u=((e,t)=>{let i,n;try{i=new Date(e),n=new Date(t)}catch(s){}const r=i.getTime();return(n.getTime()-r)/1e3})(l.dateTimeObject,e);if("estimate"===o.type)return 0===i?a({message:`${e} is not buffered yet. Try again`}):(n(o.estimatedStart+u),void s.one("seeked",()=>{Iu({programTime:e,playlist:t,retryCount:i-1,seekTo:n,pauseAfterSeek:r,tech:s,callback:a})}));const c=l.start+u;s.one("seeked",()=>a(null,s.currentTime())),r&&s.pause(),n(c)},Pu=(e,t)=>{if(4===e.readyState)return t()},Lu=(e,t,i,n)=>{let r,s=[],a=!1;const o=function(e,t,n,r){return t.abort(),a=!0,i(e,t,n,r)},l=function(e,t){if(a)return;if(e)return e.metadata=iu({requestType:n,request:t,error:e}),o(e,t,"",s);const i=t.responseText.substring(s&&s.byteLength||0,t.responseText.length);if(s=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(t=t.filter(function(e){return e&&(e.byteLength||e.length)&&"string"!=typeof e}),t.length<=1)return $e(t[0]);var n=t.reduce(function(e,t,i){return e+(t.byteLength||t.length)},0),r=new Uint8Array(n),s=0;return t.forEach(function(e){e=$e(e),r.set(e,s),s+=e.byteLength}),r}(s,et(i,!0)),r=r||Ai(s),s.length<10||r&&s.length<r+2)return Pu(t,()=>o(e,t,"",s));const l=Gi(s);return"ts"===l&&s.length<188||!l&&s.length<376?Pu(t,()=>o(e,t,"",s)):o(null,t,l,s)},u=t({uri:e,beforeSend(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function({total:t,loaded:i}){return vu(e,null,{statusCode:e.status},l)})}},function(e,t){return vu(u,e,t,l)});return u},{EventTarget:Du}=dl,Ou=function(e,t){if(!pu(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(let i=0;i<e.segments.length;i++){const n=e.segments[i],r=t.segments[i];if(n.uri!==r.uri)return!1;if(!n.byterange&&!r.byterange)continue;const s=n.byterange,a=r.byterange;if(s&&!a||!s&&a)return!1;if(s.offset!==a.offset||s.length!==a.length)return!1}return!0},Ru=(e,t,i,n)=>`placeholder-uri-${e}-${t}-${n.attributes.NAME||i}`,Nu=(e,t,i)=>{let n=!0,r=bl(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts});for(let s=0;s<t.playlists.length;s++){const e=t.playlists[s];if(e.sidx){const t=jt(e.sidx);i&&i[t]&&i[t].sidx&&Dt(e,i[t].sidx,e.sidx.resolvedUri)}const a=fu(r,e,Ou);a&&(r=a,n=!1)}return Zl(t,(e,t,i,s)=>{if(e.playlists&&e.playlists.length){const a=e.playlists[0].id,o=fu(r,e.playlists[0],Ou);o&&(r=o,s in r.mediaGroups[t][i]||(r.mediaGroups[t][i][s]=e),r.mediaGroups[t][i][s].playlists[0]=r.playlists[a],n=!1)}}),((e,t)=>{Zl(e,(i,n,r,s)=>{t.mediaGroups[n][r]&&s in t.mediaGroups[n][r]||delete e.mediaGroups[n][r][s]})})(r,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(n=!1),n?null:r},Fu=(e,t)=>(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length,Uu=(e,t)=>{const i={};for(const n in e){const r=e[n].sidx;if(r){const e=jt(r);if(!t[e])break;const n=t[e].sidxInfo;Fu(n,r)&&(i[e]=t[e])}}return i};let Bu=class extends Du{constructor(e,t,i={},n){super(),this.isPaused_=!0,this.mainPlaylistLoader_=n||this,n||(this.isMain_=!0);const{withCredentials:r=!1}=i;if(this.vhs_=t,this.withCredentials=r,this.addMetadataToTextTrack=i.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=_l("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,i){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata}:e,i&&(this.state=i),this.trigger("error"),!0):void 0)}addSidxSegments_(e,t,i){const n=e.sidx&&jt(e.sidx);if(!e.sidx||!n||this.mainPlaylistLoader_.sidxMapping_[n])return N.clearTimeout(this.mediaRequest_),void(this.mediaRequest_=N.setTimeout(()=>i(!1),0));const r=vl(e.sidx.resolvedUri),s=(r,s)=>{if(this.requestErrored_(r,s,t))return;const a=this.mainPlaylistLoader_.sidxMapping_,{requestType:o}=s;let l;try{l=wi($e(s.response).subarray(8))}catch(u){return u.metadata=iu({requestType:o,request:s,parseFailure:!0}),void this.requestErrored_(u,s,t)}return a[n]={sidxInfo:e.sidx,sidx:l},Dt(e,l,e.sidx.resolvedUri),i(!0)};this.request=Lu(r,this.vhs_.xhr,(t,i,n,a)=>{if(t)return s(t,i);if(!n||"mp4"!==n){const t=n||"unknown";return s({status:i.status,message:`Unsupported ${t} container type for sidx segment at URL: ${r}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},i)}const{offset:o,length:l}=e.sidx.byterange;if(a.length>=l+o)return s(t,{response:a.subarray(o,o+l),status:i.status,uri:i.uri});this.request=this.vhs_.xhr({uri:r,responseType:"arraybuffer",requestType:"dash-sidx",headers:bu({byterange:e.sidx.byterange})},s)},"dash-sidx")}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},N.clearTimeout(this.minimumUpdatePeriodTimeout_),N.clearTimeout(this.mediaRequest_),N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if("string"==typeof e){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const i=!this.media_||e.id!==this.media_.id;if(i&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(i&&(this.trigger("mediachanging"),this.trigger("mediachange")));i&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,i=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,N.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),"HAVE_MAIN_MANIFEST"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(N.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)}load(e){this.isPaused_=!1,N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const e=t?t.targetDuration/2*1e3:5e3;return void(this.mediaUpdateTimeout=N.setTimeout(()=>this.load(),e))}this.started?t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()}start(){if(this.started=!0,!this.isMain_)return N.clearTimeout(this.mediaRequest_),void(this.mediaRequest_=N.setTimeout(()=>this.haveMain_(),0));this.requestMain_((e,t)=>{this.haveMain_(),this.hasPendingRequest()||this.media_||this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(i,n)=>{if(i){const{requestType:e}=n;i.metadata=iu({requestType:e,request:n,error:i})}if(this.requestErrored_(i,n))return void("HAVE_NOTHING"===this.state&&(this.started=!1));this.trigger({type:"manifestrequestcomplete",metadata:t});const r=n.responseText!==this.mainPlaylistLoader_.mainXml_;return this.mainPlaylistLoader_.mainXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?this.mainLoaded_=Date.parse(n.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=vl(this.mainPlaylistLoader_.srcUrl,n),r?(this.handleMain_(),void this.syncClientServerClock_(()=>e(n,r))):e(n,r)})}syncClientServerClock_(e){const t=yi(this.mainPlaylistLoader_.mainXml_);return null===t?(this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()):"DIRECT"===t.method?(this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:yl(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(i,n)=>{if(!this.request)return;if(i){const{requestType:t}=n;return this.error.metadata=iu({requestType:t,request:n,error:i}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let r;r="HEAD"===t.method?n.responseHeaders&&n.responseHeaders.date?Date.parse(n.responseHeaders.date):this.mainLoaded_:Date.parse(n.responseText),this.mainPlaylistLoader_.clientOffset_=r-Date.now(),e()}))}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){N.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};let i;this.trigger({type:"manifestparsestart",metadata:t});try{i=(({mainXml:e,srcUrl:t,clientOffset:i,sidxMapping:n,previousManifest:r})=>{const s=gi(e,{manifestUri:t,clientOffset:i,sidxMapping:n,previousManifest:r});return eu(s,t,Ru),s})({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(r){this.error=r,this.error.metadata={errorType:dl.Error.StreamingDashManifestParserError,error:r},this.trigger("error")}e&&(i=Nu(e,i,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=i||e;const n=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(n&&n!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=n),(!e||i&&i.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(i),i){const{duration:e,endList:n}=i,r=[];i.playlists.forEach(e=>{r.push({id:e.id,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS})});const s={duration:e,isLive:!n,renditions:r};t.parsedManifest=s,this.trigger({type:"manifestparsecomplete",metadata:t})}return Boolean(i)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(N.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!=typeof t||t<=0?t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`):this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=N.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=((e,t)=>{let i=Uu(e.playlists,t);return Zl(e,(e,n,r,s)=>{if(e.playlists&&e.playlists.length){const n=e.playlists;i=bl(i,Uu(n,t))}}),i})(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,e=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,i=!this.media_||this.media_!==t[e];if(i?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const e=()=>{this.media().endList||(this.mediaUpdateTimeout=N.setTimeout(()=>{this.trigger("mediaupdatetimeout"),e()},mu(this.media(),Boolean(i))))};e()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const e=this.mainPlaylistLoader_.main.eventStream.map(e=>({cueTime:e.start,frames:[{data:e.messageData}]}));this.addMetadataToTextTrack("EventStream",e,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const i in e.contentProtection){const n=e.contentProtection[i].attributes["cenc:default_KID"];n&&t.add(n.replace(/-/g,"").toLowerCase())}return t}}};var ju={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const zu=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},Vu=function(e){return function(){const t=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(t){const i=new BlobBuilder;return i.append(e),URL.createObjectURL(i.getBlob())}}(e),i=zu(new Worker(t));i.objURL=t;const n=i.terminate;return i.on=i.addEventListener,i.off=i.removeEventListener,i.terminate=function(){return URL.revokeObjectURL(t),n.call(this)},i}},Hu=function(e){return`var browserWorkerPolyFill = ${zu.toString()};\nbrowserWorkerPolyFill(self);\n`+e},qu=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},Gu=Hu(qu(function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var n;return!!e[t]&&(n=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(n,1),n>-1)},this.trigger=function(t){var i,n,r,s;if(i=e[t])if(2===arguments.length)for(r=i.length,n=0;n<r;++n)i[n].call(this,arguments[1]);else{for(s=[],n=arguments.length,n=1;n<arguments.length;++n)s.push(arguments[n]);for(r=i.length,n=0;n<r;++n)i[n].apply(this,s)}},this.dispose=function(){e={}}}};t.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},t.prototype.push=function(e){this.trigger("data",e)},t.prototype.flush=function(e){this.trigger("done",e)},t.prototype.partialFlush=function(e){this.trigger("partialdone",e)},t.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},t.prototype.reset=function(e){this.trigger("reset",e)};var i,n,r,s,a,o,l,u,c,h,d,p,f,m,g,y,v,_,b,T,S,w,x,A,E,C,M,k,I,P,L,D,O,R,N,F,U,B,j,z,V=t,H=Math.pow(2,32),q={getUint64:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.getBigUint64?(t=i.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:i.getUint32(0)*H+i.getUint32(4)},MAX_UINT32:H},G=q.MAX_UINT32;!function(){var e;if(w={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in w)w.hasOwnProperty(e)&&(w[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);x=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),E=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),A=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),M=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),k={video:C,audio:M},L=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),P=new Uint8Array([0,0,0,0,0,0,0,0]),D=new Uint8Array([0,0,0,0,0,0,0,0]),O=D,R=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),N=D,I=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),i=function(e){var t,i,n=[],r=0;for(t=1;t<arguments.length;t++)n.push(arguments[t]);for(t=n.length;t--;)r+=n[t].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(e,4),t=0,r=8;t<n.length;t++)i.set(n[t],r),r+=n[t].byteLength;return i},n=function(){return i(w.dinf,i(w.dref,L))},r=function(e){return i(w.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},g=function(e){return i(w.hdlr,k[e])},m=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),i(w.mdhd,t)},f=function(e){return i(w.mdia,m(e),g(e.type),o(e))},a=function(e){return i(w.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},o=function(e){return i(w.minf,"video"===e.type?i(w.vmhd,I):i(w.smhd,P),n(),v(e))},l=function(e,t){for(var n=[],r=t.length;r--;)n[r]=b(t[r]);return i.apply(null,[w.moof,a(e)].concat(n))},u=function(e){for(var t=e.length,n=[];t--;)n[t]=d(e[t]);return i.apply(null,[w.moov,h(4294967295)].concat(n).concat(c(e)))},c=function(e){for(var t=e.length,n=[];t--;)n[t]=T(e[t]);return i.apply(null,[w.mvex].concat(n))},h=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i(w.mvhd,t)},y=function(e){var t,n,r=e.samples||[],s=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)t=r[n].flags,s[n+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return i(w.sdtp,s)},v=function(e){return i(w.stbl,_(e),i(w.stts,N),i(w.stsc,O),i(w.stsz,R),i(w.stco,D))},_=function(e){return i(w.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?F(e):U(e))},F=function(e){var t,n,r=e.sps||[],s=e.pps||[],a=[],o=[];for(t=0;t<r.length;t++)a.push((65280&r[t].byteLength)>>>8),a.push(255&r[t].byteLength),a=a.concat(Array.prototype.slice.call(r[t]));for(t=0;t<s.length;t++)o.push((65280&s[t].byteLength)>>>8),o.push(255&s[t].byteLength),o=o.concat(Array.prototype.slice.call(s[t]));if(n=[w.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i(w.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([r.length],a,[s.length],o))),i(w.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];n.push(i(w.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return i.apply(null,n)},U=function(e){return i(w.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),r(e))},p=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return i(w.tkhd,t)},b=function(e){var t,n,r,s,a,o;return t=i(w.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(e.baseMediaDecodeTime/G),o=Math.floor(e.baseMediaDecodeTime%G),n=i(w.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),"audio"===e.type?(r=S(e,92),i(w.traf,t,n,r)):(s=y(e),r=S(e,s.length+92),i(w.traf,t,n,r,s))},d=function(e){return e.duration=e.duration||4294967295,i(w.trak,p(e),f(e))},T=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),i(w.trex,t)},z=function(e,t){var i=0,n=0,r=0,s=0;return e.length&&(void 0!==e[0].duration&&(i=1),void 0!==e[0].size&&(n=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(s=8)),[0,0,i|n|r|s,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},j=function(e,t){var n,r,s,a,o,l;for(t+=20+16*(a=e.samples||[]).length,s=z(a,t),(r=new Uint8Array(s.length+16*a.length)).set(s),n=s.length,l=0;l<a.length;l++)o=a[l],r[n++]=(4278190080&o.duration)>>>24,r[n++]=(16711680&o.duration)>>>16,r[n++]=(65280&o.duration)>>>8,r[n++]=255&o.duration,r[n++]=(4278190080&o.size)>>>24,r[n++]=(16711680&o.size)>>>16,r[n++]=(65280&o.size)>>>8,r[n++]=255&o.size,r[n++]=o.flags.isLeading<<2|o.flags.dependsOn,r[n++]=o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,r[n++]=61440&o.flags.degradationPriority,r[n++]=15&o.flags.degradationPriority,r[n++]=(4278190080&o.compositionTimeOffset)>>>24,r[n++]=(16711680&o.compositionTimeOffset)>>>16,r[n++]=(65280&o.compositionTimeOffset)>>>8,r[n++]=255&o.compositionTimeOffset;return i(w.trun,r)},B=function(e,t){var n,r,s,a,o,l;for(t+=20+8*(a=e.samples||[]).length,s=z(a,t),(n=new Uint8Array(s.length+8*a.length)).set(s),r=s.length,l=0;l<a.length;l++)o=a[l],n[r++]=(4278190080&o.duration)>>>24,n[r++]=(16711680&o.duration)>>>16,n[r++]=(65280&o.duration)>>>8,n[r++]=255&o.duration,n[r++]=(4278190080&o.size)>>>24,n[r++]=(16711680&o.size)>>>16,n[r++]=(65280&o.size)>>>8,n[r++]=255&o.size;return i(w.trun,n)},S=function(e,t){return"audio"===e.type?B(e,t):j(e,t)};var W,$,X,Y,Q,K,Z,J,ee={ftyp:s=function(){return i(w.ftyp,x,A,x,E)},mdat:function(e){return i(w.mdat,e)},moof:l,moov:u,initSegment:function(e){var t,i=s(),n=u(e);return(t=new Uint8Array(i.byteLength+n.byteLength)).set(i),t.set(n,i.byteLength),t}},te=function(e,t){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},ie={groupNalsIntoFrames:function(e){var t,i,n=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,n.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(i=e[t]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n),r},groupFramesIntoGops:function(e){var t,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(i=e[t]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var i,n,r,s,a,o=t||0,l=[];for(i=0;i<e.length;i++)for(s=e[i],n=0;n<s.length;n++)a=s[n],o+=(r=te(a,o)).size,l.push(r);return l},concatenateNalData:function(e){var t,i,n,r,s,a,o=0,l=e.byteLength,u=e.nalCount,c=new Uint8Array(l+4*u),h=new DataView(c.buffer);for(t=0;t<e.length;t++)for(r=e[t],i=0;i<r.length;i++)for(s=r[i],n=0;n<s.length;n++)a=s[n],h.setUint32(o,a.data.byteLength),o+=4,c.set(a.data,o),o+=a.data.byteLength;return c},generateSampleTableForFrame:function(e,t){var i,n=[];return i=te(e,t||0),n.push(i),n},concatenateNalDataForFrame:function(e){var t,i,n=0,r=e.byteLength,s=e.length,a=new Uint8Array(r+4*s),o=new DataView(a.buffer);for(t=0;t<e.length;t++)i=e[t],o.setUint32(n,i.data.byteLength),n+=4,a.set(i.data,n),n+=i.data.byteLength;return a}},ne=[33,16,5,32,164,27],re=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],se=function(e){for(var t=[];e--;)t.push(0);return t},ae=9e4;K=function(e,t){return $(Q(e,t))},Z=function(e,t){return X(Y(e),t)},J=function(e,t,i){return Y(i?e:e-t)};var oe={ONE_SECOND_IN_TS:ae,secondsToVideoTs:$=function(e){return e*ae},secondsToAudioTs:X=function(e,t){return e*t},videoTsToSeconds:Y=function(e){return e/ae},audioTsToSeconds:Q=function(e,t){return e/t},audioTsToVideoTs:K,videoTsToAudioTs:Z,metadataTsToSeconds:J},le=function(){if(!W){var e={96e3:[ne,[227,64],se(154),[56]],88200:[ne,[231],se(170),[56]],64e3:[ne,[248,192],se(240),[56]],48e3:[ne,[255,192],se(268),[55,148,128],se(54),[112]],44100:[ne,[255,192],se(268),[55,163,128],se(84),[112]],32e3:[ne,[255,192],se(268),[55,234],se(226),[112]],24e3:[ne,[255,192],se(268),[55,255,128],se(268),[111,112],se(126),[224]],16e3:[ne,[255,192],se(268),[55,255,128],se(268),[111,255],se(269),[223,108],se(195),[1,192]],12e3:[re,se(268),[3,127,248],se(268),[6,255,240],se(268),[13,255,224],se(268),[27,253,128],se(259),[56]],11025:[re,se(268),[3,127,248],se(268),[6,255,240],se(268),[13,255,224],se(268),[27,255,192],se(268),[55,175,128],se(108),[112]],8e3:[re,se(268),[3,121,16],se(47),[7]]};t=e,W=Object.keys(t).reduce(function(e,i){return e[i]=new Uint8Array(t[i].reduce(function(e,t){return e.concat(t)},[])),e},{})}var t;return W},ue=oe,ce={prefixWithSilence:function(e,t,i,n){var r,s,a,o,l,u=0,c=0,h=0;if(t.length&&(r=ue.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(ue.ONE_SECOND_IN_TS/(e.samplerate/1024)),i&&n&&(u=r-Math.max(i,n),h=(c=Math.floor(u/s))*s),!(c<1||h>ue.ONE_SECOND_IN_TS/2))){for((a=le()[e.samplerate])||(a=t[0].data),o=0;o<c;o++)l=t[0],t.splice(0,0,{data:a,dts:l.dts-s,pts:l.pts-s});return e.baseMediaDecodeTime-=Math.floor(ue.videoTsToAudioTs(h,e.samplerate)),h}},trimAdtsFramesByEarliestDts:function(e,t,i){return t.minSegmentDts>=i?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=i&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},generateSampleTable:function(e){var t,i,n=[];for(t=0;t<e.length;t++)i=e[t],n.push({size:i.data.byteLength,duration:1024});return n},concatenateFrameData:function(e){var t,i,n=0,r=new Uint8Array(function(e){var t,i=0;for(t=0;t<e.length;t++)i+=e[t].data.byteLength;return i}(e));for(t=0;t<e.length;t++)i=e[t],r.set(i.data,n),n+=i.data.byteLength;return r}},he=oe.ONE_SECOND_IN_TS,de={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var i,n=e.minSegmentDts;return t||(n-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=n,i=Math.max(0,i),"audio"===e.type&&(i*=e.samplerate/he,i=Math.floor(i)),i},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))}},pe={parseSei:function(e){for(var t=0,i={payloadType:-1,payloadSize:0},n=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)n+=255,t++;for(n+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!i.payload&&4===n){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){i.payloadType=n,i.payloadSize=r,i.payload=e.subarray(t,t+r);break}i.payload=void 0}t+=r,n=0,r=0}return i},parseUserData:function(e){return 181!==e.payload[0]||49!=(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var i,n,r,s,a=[];if(!(64&t[0]))return a;for(n=31&t[0],i=0;i<n;i++)s={type:3&t[(r=3*i)+2],pts:e},4&t[r+2]&&(s.ccData=t[r+3]<<8|t[r+4],a.push(s));return a},discardEmulationPreventionBytes:function(e){for(var t,i,n=e.byteLength,r=[],s=1;s<n-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=n-r.length,i=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),i[s]=e[a];return i},USER_DATA_REGISTERED_ITU_T_T35:4},fe=V,me=pe,ge=function(e){e=e||{},ge.prototype.init.call(this),this.parse708captions_="boolean"!=typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Ee(0,0),new Ee(0,1),new Ee(1,0),new Ee(1,1)],this.parse708captions_&&(this.cc708Stream_=new Te({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ge.prototype=new fe,ge.prototype.push=function(e){var t,i,n;if("sei_rbsp"===e.nalUnitType&&(t=me.parseSei(e.escapedRBSP)).payload&&t.payloadType===me.USER_DATA_REGISTERED_ITU_T_T35&&(i=me.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=me.parseCaptionPackets(e.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},ge.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},ge.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},ge.prototype.flush=function(){return this.flushStream("flush")},ge.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ge.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},ge.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},ge.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},ge.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},ge.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)},ge.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var ye={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},ve=function(e){return 32<=e&&e<=127||160<=e&&e<=255},_e=function(e){this.windowNum=e,this.reset()};_e.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},_e.prototype.getText=function(){return this.rows.join("\n")},_e.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},_e.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},_e.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},_e.prototype.addText=function(e){this.rows[this.rowIdx]+=e},_e.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var be=function(e,t,i){this.serviceNum=e,this.text="",this.currentWindow=new _e(-1),this.windows=[],this.stream=i,"string"==typeof t&&this.createTextDecoder(t)};be.prototype.init=function(e,t){this.startPts=e;for(var i=0;i<8;i++)this.windows[i]=new _e(i),"function"==typeof t&&(this.windows[i].beforeRowOverflow=t)},be.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},be.prototype.createTextDecoder=function(e){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var Te=function(e){e=e||{},Te.prototype.init.call(this);var t,i=this,n=e.captionServices||{},r={};Object.keys(n).forEach(e=>{t=n[e],/^SERVICE/.test(e)&&(r[e]=t.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(i.new708Packet(),i.add708Bytes(e)):(null===i.current708Packet&&i.new708Packet(),i.add708Bytes(e))}};Te.prototype=new fe,Te.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Te.prototype.add708Bytes=function(e){var t=e.ccData,i=t>>>8,n=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(i),this.current708Packet.data.push(n)},Te.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,i=null,n=null,r=0,s=t[r++];for(e.seq=s>>6,e.sizeCode=63&s;r<t.length;r++)n=31&(s=t[r++]),7===(i=s>>5)&&n>0&&(i=s=t[r++]),this.pushServiceBlock(i,r,n),n>0&&(r+=n-1)},Te.prototype.pushServiceBlock=function(e,t,i){var n,r=t,s=this.current708Packet.data,a=this.services[e];for(a||(a=this.initService(e,r));r<t+i&&r<s.length;r++)n=s[r],ve(n)?r=this.handleText(r,a):24===n?r=this.multiByteCharacter(r,a):16===n?r=this.extendedCommands(r,a):128<=n&&n<=135?r=this.setCurrentWindow(r,a):152<=n&&n<=159?r=this.defineWindow(r,a):136===n?r=this.clearWindows(r,a):140===n?r=this.deleteWindows(r,a):137===n?r=this.displayWindows(r,a):138===n?r=this.hideWindows(r,a):139===n?r=this.toggleWindows(r,a):151===n?r=this.setWindowAttributes(r,a):144===n?r=this.setPenAttributes(r,a):145===n?r=this.setPenColor(r,a):146===n?r=this.setPenLocation(r,a):143===n?a=this.reset(r,a):8===n?a.currentWindow.backspace():12===n?a.currentWindow.clearText():13===n?a.currentWindow.pendingNewLine=!0:14===n?a.currentWindow.clearText():141===n&&r++},Te.prototype.extendedCommands=function(e,t){var i=this.current708Packet.data[++e];return ve(i)&&(e=this.handleText(e,t,{isExtended:!0})),e},Te.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},Te.prototype.initService=function(e,t){var i,n,r=this;return(i="SERVICE"+e)in this.serviceEncodings&&(n=this.serviceEncodings[i]),this.services[e]=new be(e,n,r),this.services[e].init(this.getPts(t),function(t){r.flushDisplayed(t,r.services[e])}),this.services[e]},Te.prototype.handleText=function(e,t,i){var n,r,s,a,o=i&&i.isExtended,l=i&&i.isMultiByte,u=this.current708Packet.data,c=o?4096:0,h=u[e],d=u[e+1],p=t.currentWindow;if(l?(r=[h,d],e++):r=[h],t.textDecoder_&&!o)n=t.textDecoder_.decode(new Uint8Array(r));else if(l){const e=r.map(e=>("0"+(255&e).toString(16)).slice(-2)).join("");n=String.fromCharCode(parseInt(e,16))}else a=ye[s=c|h]||s,n=4096&s&&s===a?"":String.fromCharCode(a);return p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(e)),p.pendingNewLine=!1,p.addText(n),e},Te.prototype.multiByteCharacter=function(e,t){var i=this.current708Packet.data,n=i[e+1],r=i[e+2];return ve(n)&&ve(r)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},Te.prototype.setCurrentWindow=function(e,t){var i=7&this.current708Packet.data[e];return t.setCurrentWindow(i),e},Te.prototype.defineWindow=function(e,t){var i=this.current708Packet.data,n=i[e],r=7&n;t.setCurrentWindow(r);var s=t.currentWindow;return n=i[++e],s.visible=(32&n)>>5,s.rowLock=(16&n)>>4,s.columnLock=(8&n)>>3,s.priority=7&n,n=i[++e],s.relativePositioning=(128&n)>>7,s.anchorVertical=127&n,n=i[++e],s.anchorHorizontal=n,n=i[++e],s.anchorPoint=(240&n)>>4,s.rowCount=15&n,n=i[++e],s.columnCount=63&n,n=i[++e],s.windowStyle=(56&n)>>3,s.penStyle=7&n,s.virtualRowCount=s.rowCount+1,e},Te.prototype.setWindowAttributes=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.winAttr;return n=i[++e],r.fillOpacity=(192&n)>>6,r.fillRed=(48&n)>>4,r.fillGreen=(12&n)>>2,r.fillBlue=3&n,n=i[++e],r.borderType=(192&n)>>6,r.borderRed=(48&n)>>4,r.borderGreen=(12&n)>>2,r.borderBlue=3&n,n=i[++e],r.borderType+=(128&n)>>5,r.wordWrap=(64&n)>>6,r.printDirection=(48&n)>>4,r.scrollDirection=(12&n)>>2,r.justify=3&n,n=i[++e],r.effectSpeed=(240&n)>>4,r.effectDirection=(12&n)>>2,r.displayEffect=3&n,e},Te.prototype.flushDisplayed=function(e,t){for(var i=[],n=0;n<8;n++)t.windows[n].visible&&!t.windows[n].isEmpty()&&i.push(t.windows[n].getText());t.endPts=e,t.text=i.join("\n\n"),this.pushCaption(t),t.startPts=e},Te.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},Te.prototype.displayWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible=1);return e},Te.prototype.hideWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible=0);return e},Te.prototype.toggleWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible^=1);return e},Te.prototype.clearWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&t.windows[r].clearText();return e},Te.prototype.deleteWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&t.windows[r].reset();return e},Te.prototype.setPenAttributes=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penAttr;return n=i[++e],r.textTag=(240&n)>>4,r.offset=(12&n)>>2,r.penSize=3&n,n=i[++e],r.italics=(128&n)>>7,r.underline=(64&n)>>6,r.edgeType=(56&n)>>3,r.fontStyle=7&n,e},Te.prototype.setPenColor=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penColor;return n=i[++e],r.fgOpacity=(192&n)>>6,r.fgRed=(48&n)>>4,r.fgGreen=(12&n)>>2,r.fgBlue=3&n,n=i[++e],r.bgOpacity=(192&n)>>6,r.bgRed=(48&n)>>4,r.bgGreen=(12&n)>>2,r.bgBlue=3&n,n=i[++e],r.edgeRed=(48&n)>>4,r.edgeGreen=(12&n)>>2,r.edgeBlue=3&n,e},Te.prototype.setPenLocation=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,n=i[++e],r.row=15&n,n=i[++e],r.column=63&n,e},Te.prototype.reset=function(e,t){var i=this.getPts(e);return this.flushDisplayed(i,t),this.initService(t.serviceNum,e)};var Se={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},we=function(e){return null===e?"":(e=Se[e]||e,String.fromCharCode(e))},xe=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ae=function(){for(var e=[],t=15;t--;)e.push({text:"",indent:0,offset:0});return e},Ee=function(e,t){Ee.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,i,n,r,s;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),n=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Ae();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ae();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Ae()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(n,r))s=we((n=(3&n)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),s=we((n=(3&n)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14&~r||this.addFormatting(e.pts,["i"]),1&~r||this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(n,r)){const e=3&r;this.nonDisplayed_[this.row_].offset=e,this.column_+=e}else if(this.isPAC(n,r)){var a=xe.indexOf(7968&t);if("rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&a>=0&&a<=14&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),!(16&~t)){const e=(14&t)>>1;this.column_=4*e,this.nonDisplayed_[this.row_].indent+=e}this.isColorPAC(r)&&(14&~r||this.addFormatting(e.pts,["i"]))}else this.isNormalChar(n)&&(0===r&&(r=null),s=we(n),s+=we(r),this[this.mode_](e.pts,s),this.column_+=s.length)}else this.lastControlCode_=null}};Ee.prototype=new fe,Ee.prototype.flushDisplayed=function(e){const t=e=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."})},i=[];this.displayed_.forEach((e,n)=>{if(e&&e.text&&e.text.length){try{e.text=e.text.trim()}catch(r){t(n)}e.text.length&&i.push({text:e.text,line:n+1,position:10+Math.min(70,10*e.indent)+2.5*e.offset})}else null==e&&t(n)}),i.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,content:i,stream:this.name_})},Ee.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ae(),this.nonDisplayed_=Ae(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ee.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ee.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Ee.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Ee.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Ee.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Ee.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Ee.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Ee.prototype.isNormalChar=function(e){return e>=32&&e<=127},Ee.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Ae(),this.displayed_=Ae()),void 0!==t&&t!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[t-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]={text:"",indent:0,offset:0};void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Ee.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)},Ee.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Ee.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_].text;i+=t,this.nonDisplayed_[this.row_].text=i},Ee.prototype.rollUp=function(e,t){var i=this.displayed_[this.row_].text;i+=t,this.displayed_[this.row_].text=i},Ee.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.row_+1;e<15;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Ee.prototype.paintOn=function(e,t){var i=this.displayed_[this.row_].text;i+=t,this.displayed_[this.row_].text=i};var Ce={CaptionStream:ge,Cea608Stream:Ee,Cea708Stream:Te},Me={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},ke=V,Ie="shared",Pe=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>4294967296;)e+=8589934592*i;return e},Le=function(e){var t,i;Le.prototype.init.call(this),this.type_=e||Ie,this.push=function(e){"metadata"!==e.type?this.type_!==Ie&&e.type!==this.type_||(void 0===i&&(i=e.dts),e.dts=Pe(e.dts,i),e.pts=Pe(e.pts,i),t=e.dts,this.trigger("data",e)):this.trigger("data",e)},this.flush=function(){i=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Le.prototype=new ke;var De,Oe={TimestampRolloverStream:Le,handleRollover:Pe},Re=(e,t,i)=>{if(!e)return-1;for(var n=i;n<e.length;n++)if(e[n]===t)return n;return-1},Ne=3,Fe=function(e,t,i){var n,r="";for(n=t;n<i;n++)r+="%"+("00"+e[n].toString(16)).slice(-2);return r},Ue=function(e,t,i){return decodeURIComponent(Fe(e,t,i))},Be=function(e,t,i){return unescape(Fe(e,t,i))},je=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},ze={APIC:function(e){var t,i,n=1;e.data[0]===Ne&&((t=Re(e.data,0,n))<0||(e.mimeType=Be(e.data,n,t),n=t+1,e.pictureType=e.data[n],n++,(i=Re(e.data,0,n))<0||(e.description=Ue(e.data,n,i),n=i+1,"--\x3e"===e.mimeType?e.url=Be(e.data,n,e.data.length):e.pictureData=e.data.subarray(n,e.data.length))))},"T*":function(e){e.data[0]===Ne&&(e.value=Ue(e.data,1,e.data.length).replace(/\0*$/,""),e.values=e.value.split("\0"))},TXXX:function(e){var t;e.data[0]===Ne&&-1!==(t=Re(e.data,0,1))&&(e.description=Ue(e.data,1,t),e.value=Ue(e.data,t+1,e.data.length).replace(/\0*$/,""),e.data=e.value)},"W*":function(e){e.url=Be(e.data,0,e.data.length).replace(/\0.*$/,"")},WXXX:function(e){var t;e.data[0]===Ne&&-1!==(t=Re(e.data,0,1))&&(e.description=Ue(e.data,1,t),e.url=Be(e.data,t+1,e.data.length).replace(/\0.*$/,""))},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Be(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},Ve={parseId3Frames:function(e){var t,i=10,n=0,r=[];if(!(e.length<10||e[0]!=="I".charCodeAt(0)||e[1]!=="D".charCodeAt(0)||e[2]!=="3".charCodeAt(0))){n=je(e.subarray(6,10)),n+=10,64&e[5]&&(i+=4,i+=je(e.subarray(10,14)),n-=je(e.subarray(16,20)));do{if((t=je(e.subarray(i+4,i+8)))<1)break;var s={id:String.fromCharCode(e[i],e[i+1],e[i+2],e[i+3]),data:e.subarray(i+10,i+t+10)};s.key=s.id,ze[s.id]?ze[s.id](s):"T"===s.id[0]?ze["T*"](s):"W"===s.id[0]&&ze["W*"](s),r.push(s),i+=10,i+=t}while(i<n);return r}},parseSyncSafeInteger:je,frameParsers:ze},He=Me,qe=Ve;(De=function(e){var t,i={descriptor:e&&e.descriptor},n=0,r=[],s=0;if(De.prototype.init.call(this),this.dispatchType=He.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(t=0;t<i.descriptor.length;t++)this.dispatchType+=("00"+i.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,i,a,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(s=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(e),s+=e.data.byteLength,1===r.length&&(n=qe.parseSyncSafeInteger(e.data.subarray(6,10)),n+=10),!(s<n)){for(t={data:new Uint8Array(n),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<n;)t.data.set(r[0].data.subarray(0,n-l),l),l+=r[0].data.byteLength,s-=r[0].data.byteLength,r.shift();i=10,64&t.data[5]&&(i+=4,i+=qe.parseSyncSafeInteger(t.data.subarray(10,14)),n-=qe.parseSyncSafeInteger(t.data.subarray(16,20)));do{if((a=qe.parseSyncSafeInteger(t.data.subarray(i+4,i+8)))<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if((o={id:String.fromCharCode(t.data[i],t.data[i+1],t.data[i+2],t.data[i+3]),data:t.data.subarray(i+10,i+a+10)}).key=o.id,qe.frameParsers[o.id]?qe.frameParsers[o.id](o):"T"===o.id[0]?qe.frameParsers["T*"](o):"W"===o.id[0]&&qe.frameParsers["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var u=o.data,c=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;c*=4,c+=3&u[7],o.timeStamp=c,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),i+=10,i+=a}while(i<n);this.trigger("data",t)}}}).prototype=new V;var Ge,We,$e,Xe=De,Ye=V,Qe=Ce,Ke=Me,Ze=Oe.TimestampRolloverStream,Je=188;(Ge=function(){var e=new Uint8Array(Je),t=0;Ge.prototype.init.call(this),this.push=function(i){var n,r=0,s=Je;for(t?((n=new Uint8Array(i.byteLength+t)).set(e.subarray(0,t)),n.set(i,t),t=0):n=i;s<n.byteLength;)71!==n[r]||71!==n[s]?(r++,s++):(this.trigger("data",n.subarray(r,s)),r+=Je,s+=Je);r<n.byteLength&&(e.set(n.subarray(r),0),t=n.byteLength-r)},this.flush=function(){t===Je&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new Ye,(We=function(){var e,t,i,n;We.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,n){var r=0;n.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===n.type?t(e.subarray(r),n):i(e.subarray(r),n)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],n.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=n.pmtPid},i=function(e,t){var i,r;if(1&e[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<i;){var s=e[r],a=(31&e[r+1])<<8|e[r+2];s===Ke.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=a:s===Ke.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=a:s===Ke.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][a]=s),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=n.programMapTable}},this.push=function(t){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&t[1]),i.pid=31&t[1],i.pid<<=8,i.pid|=t[2],(48&t[3])>>>4>1&&(n+=t[n]+1),0===i.pid)i.type="pat",e(t.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",e(t.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,n,i]):this.processPes_(t,n,i)},this.processPes_=function(e,t,i){i.pid===this.programMapTable.video?i.streamType=Ke.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=Ke.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=e.subarray(t),this.trigger("data",i)}}).prototype=new Ye,We.STREAM_TYPES={h264:27,adts:15},($e=function(){var e,t=this,i=!1,n={data:[],size:0},r={data:[],size:0},s={data:[],size:0},a=function(e,i,n){var r,s,a=new Uint8Array(e.size),o={type:i},l=0,u=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)s=e.data[l],a.set(s.data,u),u+=s.data.byteLength;!function(e,t){var i;const n=e[0]<<16|e[1]<<8|e[2];t.data=new Uint8Array,1===n&&(t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=!!(4&e[6]),192&(i=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&i&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8]))}(a,o),r="video"===i||o.packetLength<=e.size,(n||r)&&(e.size=0,e.data.length=0),r&&t.trigger("data",o)}};$e.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case Ke.H264_STREAM_TYPE:e=n,t="video";break;case Ke.ADTS_STREAM_TYPE:e=r,t="audio";break;case Ke.METADATA_STREAM_TYPE:e=s,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&a(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var n={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),i=!0,t.trigger("data",n)}})[o.type]()},this.reset=function(){n.size=0,n.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){a(n,"video"),a(r,"audio"),a(s,"timed-metadata")},this.flush=function(){if(!i&&e){var n={type:"metadata",tracks:[]};null!==e.video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",n)}i=!1,this.flushStreams_(),this.trigger("done")}}).prototype=new Ye;var et={PAT_PID:0,MP2T_PACKET_LENGTH:Je,TransportPacketStream:Ge,TransportParseStream:We,ElementaryStream:$e,TimestampRolloverStream:Ze,CaptionStream:Qe.CaptionStream,Cea608Stream:Qe.Cea608Stream,Cea708Stream:Qe.Cea708Stream,MetadataStream:Xe};for(var tt in Ke)Ke.hasOwnProperty(tt)&&(et[tt]=Ke[tt]);var it,nt=et,rt=oe.ONE_SECOND_IN_TS,st=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(it=function(e){var t,i=0;it.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:`adts skiping bytes ${e} to ${t} in frame ${i} outside syncword`})},this.push=function(n){var r,s,a,o,l,u=0;if(e||(i=0),"audio"===n.type){var c;for(t&&t.length?(a=t,(t=new Uint8Array(a.byteLength+n.data.byteLength)).set(a),t.set(n.data,a.byteLength)):t=n.data;u+7<t.length;)if(255===t[u]&&240==(246&t[u+1])){if("number"==typeof c&&(this.skipWarn_(c,u),c=null),s=2*(1&~t[u+1]),r=(3&t[u+3])<<11|t[u+4]<<3|(224&t[u+5])>>5,l=(o=1024*(1+(3&t[u+6])))*rt/st[(60&t[u+2])>>>2],t.byteLength-u<r)break;this.trigger("data",{pts:n.pts+i*l,dts:n.dts+i*l,sampleCount:o,audioobjecttype:1+(t[u+2]>>>6&3),channelcount:(1&t[u+2])<<2|(192&t[u+3])>>>6,samplerate:st[(60&t[u+2])>>>2],samplingfrequencyindex:(60&t[u+2])>>>2,samplesize:16,data:t.subarray(u+7+s,u+r)}),i++,u+=r}else"number"!=typeof c&&(c=u),u++;"number"==typeof c&&(this.skipWarn_(c,u),c=null),t=t.subarray(u)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}}).prototype=new V;var at,ot,lt,ut=it,ct=V,ht=function(e){var t=e.byteLength,i=0,n=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+n},this.loadWord=function(){var r=e.byteLength-t,s=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");s.set(e.subarray(r,r+a)),i=new DataView(s.buffer).getUint32(0),n=8*a,t-=a},this.skipBits=function(e){var r;n>e?(i<<=e,n-=e):(e-=n,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),i<<=e,n-=e)},this.readBits=function(e){var r=Math.min(n,e),s=i>>>32-r;return(n-=r)>0?i<<=r:t>0&&this.loadWord(),(r=e-r)>0?s<<r|this.readBits(r):s},this.skipLeadingZeros=function(){var e;for(e=0;e<n;++e)if(i&2147483648>>>e)return i<<=e,n-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(ot=function(){var e,t,i=0;ot.prototype.init.call(this),this.push=function(n){var r;t?((r=new Uint8Array(t.byteLength+n.data.byteLength)).set(t),r.set(n.data,t.byteLength),t=r):t=n.data;for(var s=t.byteLength;i<s-3;i++)if(1===t[i+2]){e=i+5;break}for(;e<s;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}i+3!==e-2&&this.trigger("data",t.subarray(i+3,e-2));do{e++}while(1!==t[e]&&e<s);i=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(i+3,e-2)),i=e-2,e+=3;break;default:e+=3}t=t.subarray(i),e-=i,i=0},this.reset=function(){t=null,i=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(i+3)),t=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new ct,lt={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(at=function(){var e,t,i,n,r,s,a,o=new ot;at.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,i=e.pts,n=e.dts,o.push(e))},o.on("data",function(a){var o={trackId:t,pts:i,dts:n,data:a,nalUnitTypeCode:31&a[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(a.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(a.subarray(1)),o.config=s(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),o.on("partialdone",function(){e.trigger("partialdone")}),o.on("reset",function(){e.trigger("reset")}),o.on("endedtimeline",function(){e.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},a=function(e,t){var i,n=8,r=8;for(i=0;i<e;i++)0!==r&&(r=(n+t.readExpGolomb()+256)%256),n=0===r?n:r},r=function(e){for(var t,i,n=e.byteLength,r=[],s=1;s<n-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=n-r.length,i=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),i[s]=e[a];return i},s=function(e){var t,i,n,r,s,o,l,u,c,h,d,p,f=0,m=0,g=0,y=0,v=[1,1];if(i=(t=new ht(e)).readUnsignedByte(),r=t.readUnsignedByte(),n=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),lt[i]&&(3===(s=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(d=3!==s?8:12,p=0;p<d;p++)t.readBoolean()&&a(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),u=t.readUnsignedExpGolomb(),c=t.readUnsignedExpGolomb(),0===(h=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(f=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}v&&(v[0],v[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:16*(u+1)-2*f-2*m,height:(2-h)*(c+1)*16-2*g-2*y,sarRatio:v}}}).prototype=new ct;var dt,pt={H264Stream:at},ft=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],mt=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return i=i>=0?i:0,(16&e[t+5])>>4?i+20:i+10},gt=function(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=mt(e,t),gt(e,t))},yt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},vt=function(e,t,i){return unescape(function(e,t,i){var n,r="";for(n=t;n<i;n++)r+="%"+("00"+e[n].toString(16)).slice(-2);return r}(e,t,i))},_t={isLikelyAacData:function(e){var t=gt(e,0);return e.length>=t+2&&!(255&~e[t])&&!(240&~e[t+1])&&16==(22&e[t+1])},parseId3TagSize:mt,parseAdtsSize:function(e,t){var i=(224&e[t+5])>>5,n=e[t+4]<<3;return 6144&e[t+3]|n|i},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&!(240&~e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return ft[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,i,n;t=10,64&e[5]&&(t+=4,t+=yt(e.subarray(10,14)));do{if((i=yt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){n=e.subarray(t+10,t+i+10);for(var r=0;r<n.byteLength;r++)if(0===n[r]){if("com.apple.streaming.transportStreamTimestamp"===vt(n,0,r)){var s=n.subarray(r+1),a=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return a*=4,a+=3&s[7]}break}}t+=10,t+=i}while(t<e.byteLength);return null}},bt=_t;(dt=function(){var e=new Uint8Array,t=0;dt.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(i){var n,r,s,a,o=0,l=0;for(e.length?(a=e.length,(e=new Uint8Array(i.byteLength+a)).set(e.subarray(0,a)),e.set(i,a)):e=i;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255&~e[l]||240&~e[l+1])l++;else{if(e.length-l<7)break;if(l+(o=bt.parseAdtsSize(e,l))>e.length)break;s={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",s),l+=o}else{if(e.length-l<10)break;if(l+(o=bt.parseId3TagSize(e,l))>e.length)break;r={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",r),l+=o}n=e.length-l,e=n>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new V;var Tt,St,wt,xt,At=V,Et=ee,Ct=ie,Mt=ce,kt=de,It=nt,Pt=oe,Lt=ut,Dt=pt.H264Stream,Ot=dt,Rt=_t.isLikelyAacData,Nt=oe.ONE_SECOND_IN_TS,Ft=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Ut=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Bt=function(e,t){t.stream=e,this.trigger("log",t)},jt=function(e,t){for(var i=Object.keys(t),n=0;n<i.length;n++){var r=i[n];"headOfPipeline"!==r&&t[r].on&&t[r].on("log",Bt.bind(e,r))}},zt=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Vt=function(e,t,i,n,r,s){return{start:{dts:e,pts:e+(i-t)},end:{dts:e+(n-t),pts:e+(r-i)},prependedContentDuration:s,baseMediaDecodeTime:e}};(St=function(e,t){var i,n=[],r=0,s=0,a=1/0;i=(t=t||{}).firstSequenceNumber||0,St.prototype.init.call(this),this.push=function(t){kt.collectDtsInfo(e,t),e&&Ft.forEach(function(i){e[i]=t[i]}),n.push(t)},this.setEarliestDts=function(e){r=e},this.setVideoBaseMediaDecodeTime=function(e){a=e},this.setAudioAppendStart=function(e){s=e},this.flush=function(){var o,l,u,c,h,d,p;0!==n.length?(o=Mt.trimAdtsFramesByEarliestDts(n,e,r),e.baseMediaDecodeTime=kt.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),p=Mt.prefixWithSilence(e,o,s,a),e.samples=Mt.generateSampleTable(o),u=Et.mdat(Mt.concatenateFrameData(o)),n=[],l=Et.moof(i,[e]),c=new Uint8Array(l.byteLength+u.byteLength),i++,c.set(l),c.set(u,l.byteLength),kt.clearDtsInfo(e),h=Math.ceil(1024*Nt/e.samplerate),o.length&&(d=o.length*h,this.trigger("segmentTimingInfo",Vt(Pt.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+d,o[0].pts+d,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+d})),this.trigger("data",{track:e,boxes:c}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){kt.clearDtsInfo(e),n=[],this.trigger("reset")}}).prototype=new At,(Tt=function(e,t){var i,n,r,s=[],a=[];i=(t=t||{}).firstSequenceNumber||0,Tt.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){kt.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],Ut.forEach(function(t){e[t]=n[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),s.push(t)},this.flush=function(){for(var n,r,o,l,u,c,h,d,p=0;s.length&&"access_unit_delimiter_rbsp"!==s[0].nalUnitType;)s.shift();if(0===s.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(n=Ct.groupNalsIntoFrames(s),(o=Ct.groupFramesIntoGops(n))[0][0].keyFrame||((r=this.getGopForFusion_(s[0],e))?(p=r.duration,o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=Ct.extendFirstKeyFrame(o)),a.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");kt.clearDtsInfo(e),o=f}kt.collectDtsInfo(e,o),e.samples=Ct.generateSampleTable(o),u=Et.mdat(Ct.concatenateNalData(o)),e.baseMediaDecodeTime=kt.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),h=o[0],d=o[o.length-1],this.trigger("segmentTimingInfo",Vt(e.baseMediaDecodeTime,h.dts,h.pts,d.dts+d.duration,d.pts+d.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=Et.moof(i,[e]),c=new Uint8Array(l.byteLength+u.byteLength),i++,c.set(l),c.set(u,l.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),s=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){kt.clearDtsInfo(e),n=void 0,r=void 0},this.getGopForFusion_=function(t){var i,n,r,s,a,o=1/0;for(a=0;a<this.gopCache_.length;a++)r=(s=this.gopCache_[a]).gop,e.pps&&zt(e.pps[0],s.pps[0])&&e.sps&&zt(e.sps[0],s.sps[0])&&(r.dts<e.timelineStartInfo.dts||(i=t.dts-r.dts-r.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=s,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(e){var t,i,n,r,s,o,l,u;for(s=e.byteLength,o=e.nalCount,l=e.duration,t=i=0;t<a.length&&i<e.length&&(n=a[t],r=e[i],n.pts!==r.pts);)r.pts>n.pts?t++:(i++,s-=r.byteLength,o-=r.nalCount,l-=r.duration);return 0===i?e:i===e.length?null:((u=e.slice(i)).byteLength=s,u.duration=l,u.nalCount=o,u.pts=u[0].pts,u.dts=u[0].dts,u)},this.alignGopsAtEnd_=function(e){var t,i,n,r,s,o,l;for(t=a.length-1,i=e.length-1,s=null,o=!1;t>=0&&i>=0;){if(n=a[t],r=e[i],n.pts===r.pts){o=!0;break}n.pts>r.pts?t--:(t===a.length-1&&(s=i),i--)}if(!o&&null===s)return null;if(0===(l=o?i:s))return e;var u=e.slice(l),c=u.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return u.byteLength=c.byteLength,u.duration=c.duration,u.nalCount=c.nalCount,u.pts=u[0].pts,u.dts=u[0].dts,u},this.alignGopsWith=function(e){a=e}}).prototype=new At,(xt=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"==typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,xt.prototype.init.call(this),this.push=function(e){return e.content||e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}}).prototype=new At,xt.prototype.flush=function(e){var t,i,n,r,s=0,a={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Ut.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Ft.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?a.type=this.pendingTracks[0].type:a.type="combined",this.emittedTracks+=this.pendingTracks.length,n=Et.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(n.byteLength),a.initSegment.set(n),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],s),s+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=Pt.metadataTsToSeconds(t.startPts,o,this.keepOriginalTimestamps),t.endTime=Pt.metadataTsToSeconds(t.endPts,o,this.keepOriginalTimestamps),a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=Pt.metadataTsToSeconds(i.pts,o,this.keepOriginalTimestamps),a.metadata.push(i);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),r=0;r<a.captions.length;r++)t=a.captions[r],this.trigger("caption",t);for(r=0;r<a.metadata.length;r++)i=a.metadata[r],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},xt.prototype.setRemux=function(e){this.remuxTracks=e},(wt=function(e){var t,i,n=this,r=!0;wt.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new It.MetadataStream,r.aacStream=new Ot,r.audioTimestampRolloverStream=new It.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new It.TimestampRolloverStream("timed-metadata"),r.adtsStream=new Lt,r.coalesceStream=new xt(e,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(e){r.aacStream.setTimestamp(e.timeStamp)}),r.aacStream.on("data",function(s){"timed-metadata"!==s.type&&"audio"!==s.type||r.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new St(i,e),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!t}))}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),jt(this,r)},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new It.MetadataStream,r.packetStream=new It.TransportPacketStream,r.parseStream=new It.TransportParseStream,r.elementaryStream=new It.ElementaryStream,r.timestampRolloverStream=new It.TimestampRolloverStream,r.adtsStream=new Lt,r.h264Stream=new Dt,r.captionStream=new It.CaptionStream(e),r.coalesceStream=new xt(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(s){var a;if("metadata"===s.type){for(a=s.tracks.length;a--;)t||"video"!==s.tracks[a].type?i||"audio"!==s.tracks[a].type||((i=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime):(t=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime;t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new Tt(t,e),r.videoSegmentStream.on("log",n.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",function(t){i&&!e.keepOriginalTimestamps&&(i.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-n.baseMediaDecodeTime))}),r.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){i&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.videoSegmentStream.on("timingInfo",n.trigger.bind(n,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),i&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new St(i,e),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!t})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(e){e.dispatchType=r.metadataStream.dispatchType,n.trigger("id3Frame",e)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),jt(this,r)},this.setBaseMediaDecodeTime=function(n){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=n),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,kt.clearDtsInfo(i),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,kt.clearDtsInfo(t),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var i=this.transmuxPipeline_;e.remux=t,i&&i.coalesceStream&&i.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(i){i.stream=e,t.trigger("log",i)}},this.push=function(e){if(r){var t=Rt(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new At;var Ht,qt,Gt,Wt,$t,Xt,Yt,Qt={Transmuxer:wt},Kt=function(e){return e>>>0},Zt=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},Jt=Kt,ei=Zt,ti=function(e,t){var i,n,r,s,a,o=[];if(!t.length)return null;for(i=0;i<e.byteLength;)n=Jt(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]),r=ei(e.subarray(i+4,i+8)),s=n>1?i+n:e.byteLength,r===t[0]&&(1===t.length?o.push(e.subarray(i+8,s)):(a=ti(e.subarray(i+8,s),t.slice(1))).length&&(o=o.concat(a))),i=s;return o},ii=ti,ni=Kt,ri=q.getUint64,si=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=ri(e.subarray(4)):t.baseMediaDecodeTime=ni(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},ai=function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],s=2&n.flags[2],a=8&n.flags[2],o=16&n.flags[2],l=32&n.flags[2],u=65536&n.flags[0],c=131072&n.flags[0];return t=8,r&&(t+=4,n.baseDataOffset=i.getUint32(12),t+=4),s&&(n.sampleDescriptionIndex=i.getUint32(t),t+=4),a&&(n.defaultSampleDuration=i.getUint32(t),t+=4),o&&(n.defaultSampleSize=i.getUint32(t),t+=4),l&&(n.defaultSampleFlags=i.getUint32(t)),u&&(n.durationIsEmpty=!0),!r&&c&&(n.baseDataOffsetIsMoof=!0),n},oi=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},li=function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},n=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&i.flags[2],s=4&i.flags[2],a=1&i.flags[1],o=2&i.flags[1],l=4&i.flags[1],u=8&i.flags[1],c=n.getUint32(4),h=8;for(r&&(i.dataOffset=n.getInt32(h),h+=4),s&&c&&(t={flags:oi(e.subarray(h,h+4))},h+=4,a&&(t.duration=n.getUint32(h),h+=4),o&&(t.size=n.getUint32(h),h+=4),u&&(1===i.version?t.compositionTimeOffset=n.getInt32(h):t.compositionTimeOffset=n.getUint32(h),h+=4),i.samples.push(t),c--);c--;)t={},a&&(t.duration=n.getUint32(h),h+=4),o&&(t.size=n.getUint32(h),h+=4),l&&(t.flags=oi(e.subarray(h,h+4)),h+=4),u&&(1===i.version?t.compositionTimeOffset=n.getInt32(h):t.compositionTimeOffset=n.getUint32(h),h+=4),i.samples.push(t);return i},ui={tfdt:si,trun:li},ci={parseTfdt:ui.tfdt,parseTrun:ui.trun},hi=function(e){for(var t=0,i=String.fromCharCode(e[t]),n="";"\0"!==i;)n+=i,t++,i=String.fromCharCode(e[t]);return n+=i},di=q.getUint64,pi=function(e,t){var i="\0"!==t.scheme_id_uri,n=0===e&&fi(t.presentation_time_delta)&&i,r=1===e&&fi(t.presentation_time)&&i;return!(e>1)&&n||r},fi=function(e){return void 0!==e||null!==e},mi="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},gi=Kt,yi=function(e){return("00"+e.toString(16)).slice(-2)},vi=ii,_i=Zt,bi={parseEmsgBox:function(e){var t,i,n,r,s,a,o,l=4,u=e[0];if(0===u)l+=(t=hi(e.subarray(l))).length,l+=(i=hi(e.subarray(l))).length,n=(c=new DataView(e.buffer)).getUint32(l),l+=4,s=c.getUint32(l),l+=4,a=c.getUint32(l),l+=4,o=c.getUint32(l),l+=4;else if(1===u){var c;n=(c=new DataView(e.buffer)).getUint32(l),l+=4,r=di(e.subarray(l)),l+=8,a=c.getUint32(l),l+=4,o=c.getUint32(l),l+=4,l+=(t=hi(e.subarray(l))).length,l+=(i=hi(e.subarray(l))).length}var h={scheme_id_uri:t,value:i,timescale:n||1,presentation_time:r,presentation_time_delta:s,event_duration:a,id:o,message_data:new Uint8Array(e.subarray(l,e.byteLength))};return pi(u,h)?h:void 0},scaleTime:function(e,t,i,n){return e||0===e?e/t:n+i/t}},Ti=ai,Si=li,wi=si,xi=q.getUint64,Ai=mi,Ei=Ve.parseId3Frames;Ht=function(e){return vi(e,["moov","trak"]).reduce(function(e,t){var i,n,r,s,a;return(i=vi(t,["tkhd"])[0])?(n=i[0],s=gi(i[r=0===n?12:20]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3]),(a=vi(t,["mdia","mdhd"])[0])?(r=0===(n=a[0])?12:20,e[s]=gi(a[r]<<24|a[r+1]<<16|a[r+2]<<8|a[r+3]),e):null):null},{})},qt=function(e,t){var i=vi(t,["moof","traf"]).reduce(function(t,i){var n,r=vi(i,["tfhd"])[0],s=gi(r[4]<<24|r[5]<<16|r[6]<<8|r[7]),a=e[s]||9e4,o=vi(i,["tfdt"])[0],l=new DataView(o.buffer,o.byteOffset,o.byteLength);let u;return"bigint"==typeof(n=1===o[0]?xi(o.subarray(4,12)):l.getUint32(4))?u=n/Ai.BigInt(a):"number"!=typeof n||isNaN(n)||(u=n/a),u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),u<t&&(t=u),t},1/0);return"bigint"==typeof i||isFinite(i)?i:0},Gt=function(e,t){var i,n=vi(t,["moof","traf"]),r=0,s=0;if(n&&n.length){var a=vi(n[0],["tfhd"])[0],o=vi(n[0],["trun"])[0],l=vi(n[0],["tfdt"])[0];if(a)i=Ti(a).trackId;if(l)r=wi(l).baseMediaDecodeTime;if(o){var u=Si(o);u.samples&&u.samples.length&&(s=u.samples[0].compositionTimeOffset||0)}}var c=e[i]||9e4;"bigint"==typeof r&&(s=Ai.BigInt(s),c=Ai.BigInt(c));var h=(r+s)/c;return"bigint"==typeof h&&h<Number.MAX_SAFE_INTEGER&&(h=Number(h)),h},Wt=function(e){var t=vi(e,["moov","trak"]),i=[];return t.forEach(function(e){var t=vi(e,["mdia","hdlr"]),n=vi(e,["tkhd"]);t.forEach(function(e,t){var r,s,a=_i(e.subarray(8,12)),o=n[t];"vide"===a&&(s=0===(r=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?r.getUint32(12):r.getUint32(20),i.push(s))})}),i},$t=function(e){var t=vi(e,["moov","trak"]),i=[];return t.forEach(function(e){var t,n,r={},s=vi(e,["tkhd"])[0];s&&(n=(t=new DataView(s.buffer,s.byteOffset,s.byteLength)).getUint8(0),r.id=0===n?t.getUint32(12):t.getUint32(20));var a=vi(e,["mdia","hdlr"])[0];if(a){var o=_i(a.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=vi(e,["mdia","minf","stbl","stsd"])[0];if(l){var u=l.subarray(8);r.codec=_i(u.subarray(4,8));var c,h=vi(u,[r.codec])[0];h&&(/^[asm]vc[1-9]$/i.test(r.codec)?(c=h.subarray(78),"avcC"===_i(c.subarray(4,8))&&c.length>11?(r.codec+=".",r.codec+=yi(c[9]),r.codec+=yi(c[10]),r.codec+=yi(c[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(c=h.subarray(28),"esds"===_i(c.subarray(4,8))&&c.length>20&&0!==c[19]?(r.codec+="."+yi(c[19]),r.codec+="."+yi(c[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var d=vi(e,["mdia","mdhd"])[0];d&&(r.timescale=Xt(d)),i.push(r)}),i},Yt=function(e,t=0){return vi(e,["emsg"]).map(e=>{var i=bi.parseEmsgBox(new Uint8Array(e)),n=Ei(i.message_data);return{cueTime:bi.scaleTime(i.presentation_time,i.timescale,i.presentation_time_delta,t),duration:bi.scaleTime(i.event_duration,i.timescale),frames:n}})};var Ci={findBox:vi,parseType:_i,timescale:Ht,startTime:qt,compositionStartTime:Gt,videoTrackIds:Wt,tracks:$t,getTimescaleFromMediaHeader:Xt=function(e){var t=0===e[0]?12:20;return gi(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},getEmsgID3:Yt};const{parseTrun:Mi}=ci,{findBox:ki}=Ci;var Ii=mi,Pi={getMdatTrafPairs:function(e){var t=ki(e,["moof","traf"]),i=ki(e,["mdat"]),n=[];return i.forEach(function(e,i){var r=t[i];n.push({mdat:e,traf:r})}),n},parseSamples:function(e,t,i){var n=t,r=i.defaultSampleDuration||0,s=i.defaultSampleSize||0,a=i.trackId,o=[];return e.forEach(function(e){var t=Mi(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=s),e.trackId=a,e.dts=n,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"==typeof n?(e.pts=n+Ii.BigInt(e.compositionTimeOffset),n+=Ii.BigInt(e.duration)):(e.pts=n+e.compositionTimeOffset,n+=e.duration)}),o=o.concat(t)}),o}},Li=pe.discardEmulationPreventionBytes,Di=Ce.CaptionStream,Oi=ii,Ri=si,Ni=ai,{getMdatTrafPairs:Fi,parseSamples:Ui}=Pi,Bi=function(e,t){for(var i=e,n=0;n<t.length;n++){var r=t[n];if(i<r.size)return r;i-=r.size}return null},ji=function(e,t){var i={};return Fi(e).forEach(function(e){var n,r=e.mdat,s=e.traf,a=Oi(s,["tfhd"]),o=Ni(a[0]),l=o.trackId,u=Oi(s,["tfdt"]),c=u.length>0?Ri(u[0]).baseMediaDecodeTime:0,h=Oi(s,["trun"]);t===l&&h.length>0&&(n=function(e,t,i){var n,r,s,a,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<e.length;r+=s)if(s=o.getUint32(r),r+=4,!(s<=0))switch(31&e[r]){case 6:var u=e.subarray(r+1,r+1+s),c=Bi(r,t);if(n={nalUnitType:"sei_rbsp",size:s,data:u,escapedRBSP:Li(u),trackId:i},c)n.pts=c.pts,n.dts=c.dts,a=c;else{if(!a){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+i+". See mux.js#223."});break}n.pts=a.pts,n.dts=a.dts}l.seiNals.push(n)}return l}(r,Ui(h,c,o),l),i[l]||(i[l]={seiNals:[],logs:[]}),i[l].seiNals=i[l].seiNals.concat(n.seiNals),i[l].logs=i[l].logs.concat(n.logs))}),i},zi=function(){var e,t,i,n,r,s,a=!1;this.isInitialized=function(){return a},this.init=function(t){e=new Di,a=!0,s=!!t&&t.isPartial,e.on("data",function(e){e.startTime=e.startPts/n,e.endTime=e.endPts/n,r.captions.push(e),r.captionStreams[e.stream]=!0}),e.on("log",function(e){r.logs.push(e)})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length)&&(i!==e[0]||n!==t[i])},this.parse=function(e,s,a){var o;if(!this.isInitialized())return null;if(!s||!a)return null;if(this.isNewInit(s,a))i=s[0],n=a[i];else if(null===i||!n)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,s,a)}return o=function(e,t,i){if(null===t)return null;var n=ji(e,t)[t]||{};return{seiNals:n.seiNals,logs:n.logs,timescale:i}}(e,i,n),o&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;s?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()};const{parseTfdt:Vi}=ci,Hi=ii,{getTimescaleFromMediaHeader:qi}=Ci,{parseSamples:Gi,getMdatTrafPairs:Wi}=Pi;var $i=function(){let e=9e4;this.init=function(t){const i=Hi(t,["moov","trak","mdia","mdhd"])[0];i&&(e=qi(i))},this.parseSegment=function(t){const i=[],n=Wi(t);let r=0;return n.forEach(function(t){const n=t.mdat,s=t.traf,a=Hi(s,["tfdt"])[0],o=Hi(s,["tfhd"])[0],l=Hi(s,["trun"]);if(a){const e=Vi(a);r=e.baseMediaDecodeTime}if(l.length&&o){const t=Gi(l,r,o);let s=0;t.forEach(function(t){const r=new TextDecoder("utf-8"),a=n.slice(s,s+t.size);if(Hi(a,["vtte"])[0])return void(s+=t.size);Hi(a,["vttc"]).forEach(function(n){const s=Hi(n,["payl"])[0],a=Hi(n,["sttg"])[0],o=t.pts/e,l=(t.pts+t.duration)/e;let u,c;if(s)try{u=r.decode(s)}catch(h){}if(a)try{c=r.decode(a)}catch(h){}t.duration&&u&&i.push({cueText:u,start:o,end:l,settings:c})}),s+=t.size})}}),i}},Xi=Me,Yi=function(e){var t=31&e[1];return t<<=8,t|=e[2]},Qi=function(e){return!!(64&e[1])},Ki=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},Zi=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Ji={parseType:function(e,t){var i=Yi(e);return 0===i?"pat":i===t?"pmt":t?"pes":null},parsePat:function(e){var t=Qi(e),i=4+Ki(e);return t&&(i+=e[i]+1),(31&e[i+10])<<8|e[i+11]},parsePmt:function(e){var t={},i=Qi(e),n=4+Ki(e);if(i&&(n+=e[n]+1),1&e[n+5]){var r;r=3+((15&e[n+1])<<8|e[n+2])-4;for(var s=12+((15&e[n+10])<<8|e[n+11]);s<r;){var a=n+s;t[(31&e[a+1])<<8|e[a+2]]=e[a],s+=5+((15&e[a+3])<<8|e[a+4])}return t}},parsePayloadUnitStartIndicator:Qi,parsePesType:function(e,t){switch(t[Yi(e)]){case Xi.H264_STREAM_TYPE:return"video";case Xi.ADTS_STREAM_TYPE:return"audio";case Xi.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!Qi(e))return null;var t=4+Ki(e);if(t>=e.byteLength)return null;var i,n=null;return 192&(i=e[t+7])&&((n={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,n.pts*=4,n.pts+=(6&e[t+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,n.dts*=4,n.dts+=(6&e[t+18])>>>1)),n},videoPacketContainsKeyFrame:function(e){for(var t=4+Ki(e),i=e.subarray(t),n=0,r=0,s=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===Zi(31&i[r+3])&&(s=!0);do{n++}while(1!==i[n]&&n<i.length);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===Zi(31&i[r+3])&&(s=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===Zi(31&i[r+3])&&(s=!0),s}},en=Me,tn=Oe.handleRollover,nn={};nn.ts=Ji,nn.aac=_t;var rn=oe.ONE_SECOND_IN_TS,sn=188,an=71,on=function(e,t,i){for(var n,r,s,a,o=0,l=sn,u=!1;l<=e.byteLength;)if(e[o]!==an||e[l]!==an&&l!==e.byteLength)o++,l++;else{if(n=e.subarray(o,l),"pes"===nn.ts.parseType(n,t.pid))r=nn.ts.parsePesType(n,t.table),s=nn.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&s&&(a=nn.ts.parsePesTime(n))&&(a.type="audio",i.audio.push(a),u=!0);if(u)break;o+=sn,l+=sn}for(o=(l=e.byteLength)-sn,u=!1;o>=0;)if(e[o]!==an||e[l]!==an&&l!==e.byteLength)o--,l--;else{if(n=e.subarray(o,l),"pes"===nn.ts.parseType(n,t.pid))r=nn.ts.parsePesType(n,t.table),s=nn.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&s&&(a=nn.ts.parsePesTime(n))&&(a.type="audio",i.audio.push(a),u=!0);if(u)break;o-=sn,l-=sn}},ln=function(e,t,i){for(var n,r,s,a,o,l,u,c=0,h=sn,d=!1,p={data:[],size:0};h<e.byteLength;)if(e[c]!==an||e[h]!==an)c++,h++;else{if(n=e.subarray(c,h),"pes"===nn.ts.parseType(n,t.pid))if(r=nn.ts.parsePesType(n,t.table),s=nn.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(s&&!d&&(a=nn.ts.parsePesTime(n))&&(a.type="video",i.video.push(a),d=!0),!i.firstKeyFrame)){if(s&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)u=p.data.shift(),o.set(u,l),l+=u.byteLength;if(nn.ts.videoPacketContainsKeyFrame(o)){var f=nn.ts.parsePesTime(o);f&&(i.firstKeyFrame=f,i.firstKeyFrame.type="video")}p.size=0}p.data.push(n),p.size+=n.byteLength}if(d&&i.firstKeyFrame)break;c+=sn,h+=sn}for(c=(h=e.byteLength)-sn,d=!1;c>=0;)if(e[c]!==an||e[h]!==an)c--,h--;else{if(n=e.subarray(c,h),"pes"===nn.ts.parseType(n,t.pid))r=nn.ts.parsePesType(n,t.table),s=nn.ts.parsePayloadUnitStartIndicator(n),"video"===r&&s&&(a=nn.ts.parsePesTime(n))&&(a.type="video",i.video.push(a),d=!0);if(d)break;c-=sn,h-=sn}},un=function(e){var t={pid:null,table:null},i={};for(var n in function(e,t){for(var i,n=0,r=sn;r<e.byteLength;)if(e[n]!==an||e[r]!==an)n++,r++;else{switch(i=e.subarray(n,r),nn.ts.parseType(i,t.pid)){case"pat":t.pid=nn.ts.parsePat(i);break;case"pmt":var s=nn.ts.parsePmt(i);t.table=t.table||{},Object.keys(s).forEach(function(e){t.table[e]=s[e]})}n+=sn,r+=sn}}(e,t),t.table){if(t.table.hasOwnProperty(n))switch(t.table[n]){case en.H264_STREAM_TYPE:i.video=[],ln(e,t,i),0===i.video.length&&delete i.video;break;case en.ADTS_STREAM_TYPE:i.audio=[],on(e,t,i),0===i.audio.length&&delete i.audio}}return i},cn=function(e,t){var i;return i=nn.aac.isLikelyAacData(e)?function(e){for(var t,i=!1,n=0,r=null,s=null,a=0,o=0;e.length-o>=3;){switch(nn.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){i=!0;break}if((a=nn.aac.parseId3TagSize(e,o))>e.length){i=!0;break}null===s&&(t=e.subarray(o,o+a),s=nn.aac.parseAacTimestamp(t)),o+=a;break;case"audio":if(e.length-o<7){i=!0;break}if((a=nn.aac.parseAdtsSize(e,o))>e.length){i=!0;break}null===r&&(t=e.subarray(o,o+a),r=nn.aac.parseSampleRate(t)),n++,o+=a;break;default:o++}if(i)return null}if(null===r||null===s)return null;var l=rn/r;return{audio:[{type:"audio",dts:s,pts:s},{type:"audio",dts:s+1024*n*l,pts:s+1024*n*l}]}}(e):un(e),i&&(i.audio||i.video)?(function(e,t){if(e.audio&&e.audio.length){var i=t;(void 0===i||isNaN(i))&&(i=e.audio[0].dts),e.audio.forEach(function(e){e.dts=tn(e.dts,i),e.pts=tn(e.pts,i),e.dtsTime=e.dts/rn,e.ptsTime=e.pts/rn})}if(e.video&&e.video.length){var n=t;if((void 0===n||isNaN(n))&&(n=e.video[0].dts),e.video.forEach(function(e){e.dts=tn(e.dts,n),e.pts=tn(e.pts,n),e.dtsTime=e.dts/rn,e.ptsTime=e.pts/rn}),e.firstKeyFrame){var r=e.firstKeyFrame;r.dts=tn(r.dts,n),r.pts=tn(r.pts,n),r.dtsTime=r.dts/rn,r.ptsTime=r.pts/rn}}}(i,t),i):null};class hn{constructor(e,t){this.options=t||{},this.self=e,this.init()}init(){var e,t;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Qt.Transmuxer(this.options),e=this.self,(t=this.transmuxer).on("data",function(t){const i=t.initSegment;t.initSegment={data:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength};const n=t.data;t.data=n.buffer,e.postMessage({action:"data",segment:t,byteOffset:n.byteOffset,byteLength:n.byteLength},[t.data])}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){const i={start:{decode:oe.videoTsToSeconds(t.start.dts),presentation:oe.videoTsToSeconds(t.start.pts)},end:{decode:oe.videoTsToSeconds(t.end.dts),presentation:oe.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:oe.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(i.prependedContentDuration=oe.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:i})}),t.on("audioSegmentTimingInfo",function(t){const i={start:{decode:oe.videoTsToSeconds(t.start.dts),presentation:oe.videoTsToSeconds(t.start.pts)},end:{decode:oe.videoTsToSeconds(t.end.dts),presentation:oe.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:oe.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(i.prependedContentDuration=oe.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:i})}),t.on("id3Frame",function(t){e.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){e.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){e.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:oe.videoTsToSeconds(t.start),end:oe.videoTsToSeconds(t.end)}})}),t.on("videoTimingInfo",function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:oe.videoTsToSeconds(t.start),end:oe.videoTsToSeconds(t.end)}})}),t.on("log",function(t){e.postMessage({action:"log",log:t})})}pushMp4Captions(e){this.captionParser||(this.captionParser=new zi,this.captionParser.init());const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),i=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:i&&i.captions||[],logs:i&&i.logs||[],data:t.buffer},[t.buffer])}initMp4WebVttParser(e){this.webVttParser||(this.webVttParser=new $i);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.webVttParser.init(t)}getMp4WebVttText(e){this.webVttParser||(this.webVttParser=new $i);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),i=this.webVttParser.parseSegment(t);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:i||[],data:t.buffer},[t.buffer])}probeMp4StartTime({timescales:e,data:t}){const i=Ci.startTime(e,t);this.self.postMessage({action:"probeMp4StartTime",startTime:i,data:t},[t.buffer])}probeMp4Tracks({data:e}){const t=Ci.tracks(e);this.self.postMessage({action:"probeMp4Tracks",tracks:t,data:e},[e.buffer])}probeEmsgID3({data:e,offset:t}){const i=Ci.getEmsgID3(e,t);this.self.postMessage({action:"probeEmsgID3",id3Frames:i,emsgData:e},[e.buffer])}probeTs({data:e,baseStartTime:t}){const i="number"!=typeof t||isNaN(t)?void 0:t*oe.ONE_SECOND_IN_TS,n=cn(e,i);let r=null;n&&(r={hasVideo:n.video&&2===n.video.length||!1,hasAudio:n.audio&&2===n.audio.length||!1},r.hasVideo&&(r.videoStart=n.video[0].ptsTime),r.hasAudio&&(r.audioStart=n.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:r,data:e},[e.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(e){const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}reset(){this.transmuxer.reset()}setTimestampOffset(e){const t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(oe.secondsToVideoTs(t)))}setAudioAppendStart(e){this.transmuxer.setAudioAppendStart(Math.ceil(oe.secondsToVideoTs(e.appendStart)))}setRemux(e){this.transmuxer.setRemux(e.remux)}flush(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new hn(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new hn(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}}));var Wu=Vu(Gu);const $u=e=>{const{transmuxer:t,bytes:i,audioAppendStart:n,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:u,onVideoSegmentTimingInfo:c,onAudioSegmentTimingInfo:h,onId3:d,onCaptions:p,onDone:f,onEndedTimeline:m,onTransmuxerLog:g,isEndOfTimeline:y,segment:v,triggerSegmentEventFn:_}=e,b={buffer:[]};let T=y;if(t.onmessage=i=>{t.currentTransmux===e&&("data"===i.data.action&&((e,t,i)=>{const{type:n,initSegment:r,captions:s,captionStreams:a,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:u}=e.data.segment;t.buffer.push({captions:s,captionStreams:a,metadata:o});const c=e.data.segment.boxes||{data:e.data.segment.data},h={type:n,data:new Uint8Array(c.data,c.data.byteOffset,c.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};void 0!==l&&(h.videoFrameDtsTime=l),void 0!==u&&(h.videoFramePtsTime=u),i(h)})(i,b,a),"trackinfo"===i.data.action&&o(i.data.trackInfo),"gopInfo"===i.data.action&&((e,t)=>{t.gopInfo=e.data.gopInfo})(i,b),"audioTimingInfo"===i.data.action&&l(i.data.audioTimingInfo),"videoTimingInfo"===i.data.action&&u(i.data.videoTimingInfo),"videoSegmentTimingInfo"===i.data.action&&c(i.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===i.data.action&&h(i.data.audioSegmentTimingInfo),"id3Frame"===i.data.action&&d([i.data.id3Frame],i.data.id3Frame.dispatchType),"caption"===i.data.action&&p(i.data.caption),"endedtimeline"===i.data.action&&(T=!1,m()),"log"===i.data.action&&g(i.data.log),"transmuxed"===i.data.type&&(T||(t.onmessage=null,(({transmuxedData:e,callback:t})=>{e.buffer=[],t(e)})({transmuxedData:b,callback:f}),Xu(t))))},t.onerror=()=>{const e={message:"Received an error message from the transmuxer worker",metadata:{errorType:dl.Error.StreamingFailedToTransmuxSegment,segmentInfo:Fc({segment:v})}};f(null,e)},n&&t.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),void 0!==s&&t.postMessage({action:"setRemux",remux:s}),i.byteLength){const e=i instanceof ArrayBuffer?i:i.buffer,n=i instanceof ArrayBuffer?0:i.byteOffset;_({type:"segmenttransmuxingstart",segment:v}),t.postMessage({action:"push",data:e,byteOffset:n,byteLength:i.byteLength},[e])}y&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},Xu=e=>{e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"==typeof e.currentTransmux?e.currentTransmux():$u(e.currentTransmux))},Yu=(e,t)=>{e.postMessage({action:t}),Xu(e)},Qu=(e,t)=>{if(!t.currentTransmux)return t.currentTransmux=e,void Yu(t,e);t.transmuxQueue.push(Yu.bind(null,t,e))},Ku=e=>{if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void $u(e);e.transmuxer.transmuxQueue.push(e)};var Zu=e=>{Qu("reset",e)},Ju=e=>{const t=new Wu;t.currentTransmux=null,t.transmuxQueue=[];const i=t.terminate;return t.terminate=()=>(t.currentTransmux=null,t.transmuxQueue.length=0,i.call(t)),t.postMessage({action:"init",options:e}),t};const ec=function(e){const t=e.transmuxer,i=e.endAction||e.action,n=e.callback,r=ye({},e,{endAction:null,transmuxer:null,callback:null}),s=r=>{r.data.action===i&&(t.removeEventListener("message",s),r.data.data&&(r.data.data=new Uint8Array(r.data.data,e.byteOffset||0,e.byteLength||r.data.data.byteLength),e.data&&(e.data=r.data.data)),n(r.data))};if(t.addEventListener("message",s),e.data){const i=e.data instanceof ArrayBuffer;r.byteOffset=i?0:e.data.byteOffset,r.byteLength=e.data.byteLength;const n=[i?e.data:e.data.buffer];t.postMessage(r,n)}else t.postMessage(r)},tc=2,ic=-101,nc=-102,rc="wvtt",sc=e=>{e.forEach(e=>{e.abort()})},ac=(e,t)=>{const{requestType:i}=t,n=iu({requestType:i,request:t,error:e});return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:ic,xhr:t,metadata:n}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:nc,xhr:t,metadata:n}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:tc,xhr:t,metadata:n}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:tc,xhr:t,metadata:n}:null},oc=(e,t,i,n)=>(r,s)=>{const a=s.response,o=ac(r,s);if(o)return i(o,e);if(16!==a.byteLength)return i({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:tc,xhr:s},e);const l=new DataView(a),u=new Uint32Array([l.getUint32(0),l.getUint32(4),l.getUint32(8),l.getUint32(12)]);for(let e=0;e<t.length;e++)t[e].bytes=u;const c={uri:s.uri};return n({type:"segmentkeyloadcomplete",segment:e,keyInfo:c}),i(null,e)},lc=(e,t)=>{const i=Gi(e.map.bytes);if("mp4"!==i){const n=e.map.resolvedUri||e.map.uri,r=i||"unknown";return t({internal:!0,message:`Found unsupported ${r} container for initialization segment at URL: ${n}`,code:tc,metadata:{mediaType:r}})}ec({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:({tracks:i,data:n})=>(e.map.bytes=n,i.forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"==typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale),"text"===t.type&&((e,t)=>{t===rc&&e.transmuxer.postMessage({action:"initMp4WebVttParser",data:e.map.bytes})})(e,t.codec))}),t(null))})},uc=({segment:e,finishProcessingFn:t,responseType:i,triggerSegmentEventFn:n})=>(r,s)=>{const a=ac(r,s);if(a)return t(a,e);n({type:"segmentloaded",segment:e});const o="arraybuffer"!==i&&s.responseText?(e=>{const t=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t.buffer})(s.responseText.substring(e.lastReachedChar||0)):s.response;return e.stats=(e=>({bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}))(s),e.key?e.encryptedBytes=new Uint8Array(o):e.bytes=new Uint8Array(o),t(null,e)},cc=({segment:e,bytes:t,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})=>{const f=e.map&&e.map.tracks||{},m=Boolean(f.audio&&f.video);let g=n.bind(null,e,"audio","start");const y=n.bind(null,e,"audio","end");let v=n.bind(null,e,"video","start");const _=n.bind(null,e,"video","end");ec({action:"probeTs",transmuxer:e.transmuxer,data:t,baseStartTime:e.baseStartTime,callback:n=>{e.bytes=t=n.data;const f=n.result;f&&(i(e,{hasAudio:f.hasAudio,hasVideo:f.hasVideo,isMuxed:m}),i=null),Ku({bytes:t,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,remux:m,onData:t=>{t.type="combined"===t.type?"video":t.type,c(e,t)},onTrackInfo:t=>{i&&(m&&(t.isMuxed=!0),i(e,t))},onAudioTimingInfo:e=>{g&&void 0!==e.start&&(g(e.start),g=null),y&&void 0!==e.end&&y(e.end)},onVideoTimingInfo:e=>{v&&void 0!==e.start&&(v(e.start),v=null),_&&void 0!==e.end&&_(e.end)},onVideoSegmentTimingInfo:t=>{const i={pts:{start:t.start.presentation,end:t.end.presentation},dts:{start:t.start.decode,end:t.end.decode}};p({type:"segmenttransmuxingtiminginfoavailable",segment:e,timingInfo:i}),r(t)},onAudioSegmentTimingInfo:t=>{const i={pts:{start:t.start.pts,end:t.end.pts},dts:{start:t.start.dts,end:t.end.dts}};p({type:"segmenttransmuxingtiminginfoavailable",segment:e,timingInfo:i}),s(t)},onId3:(t,i)=>{a(e,t,i)},onCaptions:t=>{o(e,[t])},isEndOfTimeline:l,onEndedTimeline:()=>{u()},onTransmuxerLog:d,onDone:(t,i)=>{h&&(t.type="combined"===t.type?"video":t.type,p({type:"segmenttransmuxingcomplete",segment:e}),h(i,e,t))},segment:e,triggerSegmentEventFn:p})}})},hc=({segment:e,bytes:t,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})=>{let f=new Uint8Array(t);if(function(e){return Ci(e,["moof"]).length>0}(f)){e.isFmp4=!0;const{tracks:r}=e.map;if(r.text&&(!r.audio||!r.video))return c(e,{data:f,type:"text"}),void((e,t,i)=>{t===rc&&ec({action:"getMp4WebVttText",data:e.bytes,transmuxer:e.transmuxer,callback:({data:t,mp4VttCues:n})=>{e.bytes=t,i(null,e,{mp4VttCues:n})}})})(e,r.text.codec,h);const s={isFmp4:!0,hasVideo:!!r.video,hasAudio:!!r.audio};r.audio&&r.audio.codec&&"enca"!==r.audio.codec&&(s.audioCodec=r.audio.codec),r.video&&r.video.codec&&"encv"!==r.video.codec&&(s.videoCodec=r.video.codec),r.video&&r.audio&&(s.isMuxed=!0),i(e,s);const l=(t,i)=>{c(e,{data:f,type:s.hasAudio&&!s.isMuxed?"audio":"video"}),i&&i.length&&a(e,i),t&&t.length&&o(e,t),h(null,e,{})};return void ec({action:"probeMp4StartTime",timescales:e.map.timescales,data:f,transmuxer:e.transmuxer,callback:({data:i,startTime:a})=>{t=i.buffer,e.bytes=f=i,s.hasAudio&&!s.isMuxed&&n(e,"audio","start",a),s.hasVideo&&n(e,"video","start",a),ec({action:"probeEmsgID3",data:f,transmuxer:e.transmuxer,offset:a,callback:({emsgData:i,id3Frames:n})=>{t=i.buffer,e.bytes=f=i,r.video&&i.byteLength&&e.transmuxer?ec({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:e.transmuxer,data:f,timescales:e.map.timescales,trackIds:[r.video.id],callback:i=>{t=i.data.buffer,e.bytes=f=i.data,i.logs.forEach(function(e){d(bl(e,{stream:"mp4CaptionParser"}))}),l(i.captions,n)}}):l(void 0,n)}})}})}if(e.transmuxer){if(void 0===e.container&&(e.container=Gi(f)),"ts"!==e.container&&"aac"!==e.container)return i(e,{hasAudio:!1,hasVideo:!1}),void h(null,e,{});cc({segment:e,bytes:t,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})}else h(null,e,{})},dc=function({id:e,key:t,encryptedBytes:i,decryptionWorker:n,segment:r,doneFn:s},a){const o=t=>{if(t.data.source===e){n.removeEventListener("message",o);const e=t.data.decrypted;a(new Uint8Array(e.bytes,e.byteOffset,e.byteLength))}};let l;n.onerror=()=>{const e="An error occurred in the decryption worker",t=Fc({segment:r}),i={message:e,metadata:{error:new Error(e),errorType:dl.Error.StreamingFailedToDecryptSegment,segmentInfo:t,keyInfo:{uri:r.key.resolvedUri||r.map.key.resolvedUri}}};s(i,r)},n.addEventListener("message",o),l=t.bytes.slice?t.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.bytes)),n.postMessage(xu({source:e,encrypted:i,key:l,iv:t.iv}),[i.buffer,l.buffer])},pc=({activeXhrs:e,decryptionWorker:t,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})=>{let f=0,m=!1;return(g,y)=>{if(!m){if(g)return m=!0,sc(e),h(g,y);if(f+=1,f===e.length){const f=function(){if(y.encryptedBytes)return(({decryptionWorker:e,segment:t,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})=>{p({type:"segmentdecryptionstart"}),dc({id:t.requestId,key:t.key,encryptedBytes:t.encryptedBytes,decryptionWorker:e,segment:t,doneFn:h},e=>{t.bytes=e,p({type:"segmentdecryptioncomplete",segment:t}),hc({segment:t,bytes:t.bytes,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})})})({decryptionWorker:t,segment:y,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p});hc({segment:y,bytes:y.bytes,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:d,triggerSegmentEventFn:p})};if(y.endOfAllRequests=Date.now(),y.map&&y.map.encryptedBytes&&!y.map.bytes)return p({type:"segmentdecryptionstart",segment:y}),dc({decryptionWorker:t,id:y.requestId+"-init",encryptedBytes:y.map.encryptedBytes,key:y.map.key,segment:y,doneFn:h},t=>{y.map.bytes=t,p({type:"segmentdecryptioncomplete",segment:y}),lc(y,t=>{if(t)return sc(e),h(t,y);f()})});f()}}}},fc=({segment:e,progressFn:t,trackInfoFn:i,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c})=>i=>{if(!i.target.aborted)return e.stats=bl(e.stats,(e=>{const t=e.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return i.bytesReceived=e.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i})(i)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(i,e)},mc=({xhr:e,xhrOptions:t,decryptionWorker:i,segment:n,abortFn:r,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:d,endedTimelineFn:p,dataFn:f,doneFn:m,onTransmuxerLog:g,triggerSegmentEventFn:y})=>{const v=[],_=pc({activeXhrs:v,decryptionWorker:i,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:d,endedTimelineFn:p,dataFn:f,doneFn:m,onTransmuxerLog:g,triggerSegmentEventFn:y});if(n.key&&!n.key.bytes){const i=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&i.push(n.map.key);const r=bl(t,{uri:n.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),s=oc(n,i,_,y);y({type:"segmentkeyloadstart",segment:n,keyInfo:{uri:n.key.resolvedUri}});const a=e(r,s);v.push(a)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const i=bl(t,{uri:n.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),r=oc(n,[n.map.key],_,y);y({type:"segmentkeyloadstart",segment:n,keyInfo:{uri:n.map.key.resolvedUri}});const s=e(i,r);v.push(s)}const i=bl(t,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:bu(n.map),requestType:"segment-media-initialization"}),r=(({segment:e,finishProcessingFn:t,triggerSegmentEventFn:i})=>(n,r)=>{const s=ac(n,r);if(s)return t(s,e);const a=new Uint8Array(r.response);if(i({type:"segmentloaded",segment:e}),e.map.key)return e.map.encryptedBytes=a,t(null,e);e.map.bytes=a,lc(e,function(i){if(i)return i.xhr=r,i.status=r.status,t(i,e);t(null,e)})})({segment:n,finishProcessingFn:_,triggerSegmentEventFn:y});y({type:"segmentloadstart",segment:n});const s=e(i,r);v.push(s)}const b=bl(t,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:bu(n),requestType:"segment"}),T=uc({segment:n,finishProcessingFn:_,responseType:b.responseType,triggerSegmentEventFn:y});y({type:"segmentloadstart",segment:n});const S=e(b,T);S.addEventListener("progress",fc({segment:n,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:d,endedTimelineFn:p,dataFn:f})),v.push(S);const w={};return v.forEach(e=>{e.addEventListener("loadend",(({loadendState:e,abortFn:t})=>i=>{i.target.aborted&&t&&!e.calledAbortFn&&(t(),e.calledAbortFn=!0)})({loadendState:w,abortFn:r}))}),()=>sc(v)},gc=_l("PlaylistSelector"),yc=function(e){if(!e||!e.playlist)return;const t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})},vc=function(e,t){if(!e)return"";const i=N.getComputedStyle(e);return i?i[t]:""},_c=function(e,t){const i=e.slice();e.sort(function(e,n){const r=t(e,n);return 0===r?i.indexOf(e)-i.indexOf(n):r})},bc=function(e,t){let i,n;return e.attributes.BANDWIDTH&&(i=e.attributes.BANDWIDTH),i=i||N.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(n=t.attributes.BANDWIDTH),n=n||N.Number.MAX_VALUE,i-n};let Tc=function(e){const{main:t,bandwidth:i,playerWidth:n,playerHeight:r,playerObjectFit:s,limitRenditionByPlayerDimensions:a,playlistController:o}=e;if(!t)return;const l={bandwidth:i,width:n,height:r,limitRenditionByPlayerDimensions:a};let u=t.playlists;Xl.isAudioOnly(t)&&(u=o.getAudioTrackPlaylists_(),l.audioOnly=!0);let c=u.map(e=>{let t;const i=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,n=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return t=e.attributes&&e.attributes.BANDWIDTH,t=t||N.Number.MAX_VALUE,{bandwidth:t,width:i,height:n,playlist:e}});_c(c,(e,t)=>e.bandwidth-t.bandwidth),c=c.filter(e=>!Xl.isIncompatible(e.playlist));let h=c.filter(e=>Xl.isEnabled(e.playlist));h.length||(h=c.filter(e=>!Xl.isDisabled(e.playlist)));const d=h.filter(e=>e.bandwidth*ju.BANDWIDTH_VARIANCE<i);let p=d[d.length-1];const f=d.filter(e=>e.bandwidth===p.bandwidth)[0];if(!1===a){const e=f||h[0]||c[0];if(e&&e.playlist){let t="sortedPlaylistReps";return f&&(t="bandwidthBestRep"),h[0]&&(t="enabledPlaylistReps"),gc(`choosing ${yc(e)} using ${t} with options`,l),e.playlist}return gc("could not choose a playlist with options",l),null}const m=d.filter(e=>e.width&&e.height);_c(m,(e,t)=>e.width-t.width);const g=m.filter(e=>e.width===n&&e.height===r);p=g[g.length-1];const y=g.filter(e=>e.bandwidth===p.bandwidth)[0];let v,_,b,T;if(y||(v=m.filter(e=>"cover"===s?e.width>n&&e.height>r:e.width>n||e.height>r),_=v.filter(e=>e.width===v[0].width&&e.height===v[0].height),p=_[_.length-1],b=_.filter(e=>e.bandwidth===p.bandwidth)[0]),o.leastPixelDiffSelector){const e=m.map(e=>(e.pixelDiff=Math.abs(e.width-n)+Math.abs(e.height-r),e));_c(e,(e,t)=>e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff),T=e[0]}const S=T||b||y||f||h[0]||c[0];if(S&&S.playlist){let e="sortedPlaylistReps";return T?e="leastPixelDiffRep":b?e="resolutionPlusOneRep":y?e="resolutionBestRep":f?e="bandwidthBestRep":h[0]&&(e="enabledPlaylistReps"),gc(`choosing ${yc(S)} using ${e} with options`,l),S.playlist}return gc("could not choose a playlist with options",l),null};const Sc=function(){let e=this.useDevicePixelRatio&&N.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(e=this.customPixelRatio),Tc({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(vc(this.tech_.el(),"width"),10)*e,playerHeight:parseInt(vc(this.tech_.el(),"height"),10)*e,playerObjectFit:this.usePlayerObjectFit?vc(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})};function wc(e){try{return new URL(e).pathname.split("/").slice(-2).join("/")}catch(t){return""}}const xc=({inbandTextTracks:e,metadataArray:t,timestampOffset:i,videoDuration:n})=>{if(!t)return;const r=N.WebKitDataCue||N.VTTCue,s=e.metadataTrack_;if(!s)return;if(t.forEach(e=>{const t=e.cueTime+i;!("number"!=typeof t||N.isNaN(t)||t<0)&&t<1/0&&e.frames&&e.frames.length&&e.frames.forEach(e=>{const i=new r(t,t,e.value||e.url||e.data||"");i.frame=e,i.value=e,function(e){Object.defineProperties(e.frame,{id:{get:()=>(dl.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key)},value:{get:()=>(dl.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data)},privateData:{get:()=>(dl.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data)}})}(i),s.addCue(i)})}),!s.cues||!s.cues.length)return;const a=s.cues,o=[];for(let c=0;c<a.length;c++)a[c]&&o.push(a[c]);const l=o.reduce((e,t)=>{const i=e[t.startTime]||[];return i.push(t),e[t.startTime]=i,e},{}),u=Object.keys(l).sort((e,t)=>Number(e)-Number(t));u.forEach((e,t)=>{const i=l[e],r=isFinite(n)?n:e,s=Number(u[t+1])||r;i.forEach(e=>{e.endTime=s})})},Ac={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},Ec=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),Cc=(e,t,i)=>{e.metadataTrack_||(e.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,dl.browser.IS_ANY_SAFARI||(e.metadataTrack_.inBandMetadataTrackDispatchType=t))},Mc=function(e,t,i){let n,r;if(i&&i.cues)for(n=i.cues.length;n--;)r=i.cues[n],r.startTime>=e&&r.endTime<=t&&i.removeCue(r)},kc=e=>"number"==typeof e&&isFinite(e),Ic=1/60,Pc=e=>{const{startOfSegment:t,duration:i,segment:n,part:r,playlist:{mediaSequence:s,id:a,segments:o=[]},mediaIndex:l,partIndex:u,timeline:c}=e,h=o.length-1;let d="mediaIndex/partIndex increment";e.getMediaInfoForTime?d=`getMediaInfoForTime (${e.getMediaInfoForTime})`:e.isSyncRequest&&(d="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(d+=` with independent ${e.independent}`);const p="number"==typeof u,f=e.segment.uri?"segment":"pre-segment",m=p?Ol({preloadSegment:n})-1:0;return`${f} [${s+l}/${s+h}]`+(p?` part [${u}/${m}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(p?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${t}] duration [${i}] timeline [${c}] selected by [${d}] playlist [${a}]`},Lc=e=>`${e}TimingInfo`,Dc=({timelineChangeController:e,currentTimeline:t,segmentTimeline:i,loaderType:n,audioDisabled:r})=>{if(t===i)return!1;if("audio"===n){const t=e.lastTimelineChange({type:"main"});return!t||t.to!==i}if("main"===n&&r){const t=e.pendingTimelineChange({type:"audio"});return!t||t.to!==i}return!1},Oc=e=>{const t=e.pendingSegment_;if(!t)return;if(Dc({timelineChangeController:e.timelineChangeController_,currentTimeline:e.currentTimeline_,segmentTimeline:t.timeline,loaderType:e.loaderType_,audioDisabled:e.audioDisabled_})&&(e=>{if(!e)return!1;const t=e.pendingTimelineChange({type:"audio"}),i=e.pendingTimelineChange({type:"main"}),n=t&&i,r=n&&t.to!==i.to;return!(!n||-1===t.from||-1===i.from||!r)})(e.timelineChangeController_)){if((e=>{const t=e.timelineChangeController_.pendingTimelineChange({type:"audio"}),i=e.timelineChangeController_.pendingTimelineChange({type:"main"});return t&&i&&t.to<i.to})(e))return void e.timelineChangeController_.trigger("audioTimelineBehind");e.timelineChangeController_.trigger("fixBadTimelineChange")}},Rc=({segmentDuration:e,maxDuration:t})=>!!e&&Math.round(e)>t+Sl,Nc=(e,t)=>{if("hls"!==t)return null;const i=(e=>{let t=0;return["video","audio"].forEach(function(i){const n=e[`${i}TimingInfo`];if(!n)return;const{start:r,end:s}=n;let a;"bigint"==typeof r||"bigint"==typeof s?a=N.BigInt(s)-N.BigInt(r):"number"==typeof r&&"number"==typeof s&&(a=s-r),void 0!==a&&a>t&&(t=a)}),"bigint"==typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),t})({audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo});if(!i)return null;const n=e.playlist.targetDuration,r=Rc({segmentDuration:i,maxDuration:2*n}),s=Rc({segmentDuration:i,maxDuration:n}),a=`Segment with index ${e.mediaIndex} from playlist ${e.playlist.id} has a duration of ${i} when the reported duration is ${e.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||s?{severity:r?"warn":"info",message:a}:null},Fc=({type:e,segment:t})=>{if(!t)return;const i=Boolean(t.key||t.map&&t.map.ke),n=Boolean(t.map&&!t.map.bytes),r=void 0===t.startOfSegment?t.start:t.startOfSegment;return{type:e||t.type,uri:t.resolvedUri||t.uri,start:r,duration:t.duration,isEncrypted:i,isMediaInitialization:n}};let Uc=class extends dl.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=_l(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(e){e!==this.state_&&(this.logger_(`${this.state_} -> ${e}`),this.state_=e,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Oc(this)}),this.sourceUpdater_.on("codecschange",e=>{this.trigger(ye({type:"codecschange"},e))}),"main"===this.loaderType_&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Oc(this)}),"audio"===this.loaderType_&&this.timelineChangeController_.on("timelinechange",e=>{this.trigger(ye({type:"timelinechange"},e)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():Oc(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Oc(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return Ju({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if("WAITING"!==this.state)return this.pendingSegment_&&(this.pendingSegment_=null),void this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,N.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)}error(e){return void 0!==e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&Zu(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return Tl();if("main"===this.loaderType_){const{hasAudio:t,hasVideo:i,isMuxed:n}=e;if(i&&t&&!this.audioDisabled_&&!n)return this.sourceUpdater_.buffered();if(i)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const i=Au(e);let n=this.initSegments_[i];return t&&!n&&e.bytes&&(this.initSegments_[i]=n={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),n||e}segmentKey(e,t=!1){if(!e)return null;const i=Eu(e);let n=this.keyCache_[i];this.cacheEncryptionKeys_&&t&&!n&&e.bytes&&(this.keyCache_[i]=n={resolvedUri:e.resolvedUri,bytes:e.bytes});const r={resolvedUri:(n||e).resolvedUri};return n&&(r.bytes=n.bytes),r}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;if(this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const i=this.playlist_,n=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));let r=null;if(i&&(i.id?r=i.id:i.uri&&(r=i.uri)),this.logger_(`playlist update [${r} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:\ncurrentTime: ${this.currentTime_()}\nbufferedEnd: ${kl(this.buffered_())}\n`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==e.uri){if(null!==this.mediaIndex){!e.endList&&"number"==typeof e.partTargetDuration?this.resetLoader():this.resyncLoader()}return this.currentMediaInfo_=void 0,void this.trigger("playlistupdate")}const s=e.mediaSequence-i.mediaSequence;if(this.logger_(`live window shift [${s}]`),null!==this.mediaIndex)if(this.mediaIndex-=s,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const e=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!e.parts||!e.parts.length||!e.parts[this.partIndex])){const e=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=e}}n&&(n.mediaIndex-=s,n.mediaIndex<0?(n.mediaIndex=null,n.partIndex=null):(n.mediaIndex>=0&&(n.segment=e.segments[n.mediaIndex]),n.partIndex>=0&&n.segment.parts&&(n.part=n.segment.parts[n.partIndex]))),this.syncController_.saveExpiredSegmentInfo(i,e)}pause(){this.checkBufferTimeout_&&(N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return null===this.checkBufferTimeout_}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&Zu(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;"hls"===this.sourceType_&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,i=()=>{},n=!1){if(t===1/0&&(t=this.duration_()),t<=e)return void this.logger_("skipping remove because end ${end} is <= start ${start}");if(!this.sourceUpdater_||!this.getMediaInfo_())return void this.logger_("skipping remove because no source updater or starting media info");let r=1;const s=()=>{r--,0===r&&i()};!n&&this.audioDisabled_||(r++,this.sourceUpdater_.removeAudio(e,t,s)),(n||"main"===this.loaderType_)&&(this.gopBuffer_=((e,t,i,n)=>{const r=Math.ceil((t-n)*Wi.ONE_SECOND_IN_TS),s=Math.ceil((i-n)*Wi.ONE_SECOND_IN_TS),a=e.slice();let o=e.length;for(;o--&&!(e[o].pts<=s););if(-1===o)return a;let l=o+1;for(;l--&&!(e[l].pts<=r););return l=Math.max(l,0),a.splice(l,o-l+1),a})(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,s));for(const a in this.inbandTextTracks_)Mc(e,t,this.inbandTextTracks_[a]);Mc(e,t,this.segmentMetadataTrack_),s()}monitorBuffer_(){this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=N.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=N.setTimeout(this.monitorBufferTick_.bind(this),500)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:Fc({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),"number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,i=this.partIndex){if(!t||!this.mediaSource_)return!1;const n="number"==typeof e&&t.segments[e],r=e+1===t.segments.length,s=!n||!n.parts||i+1===n.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&r&&s}chooseNextRequest_(){const e=this.buffered_(),t=kl(e)||0,i=Il(e,this.currentTime_()),n=!this.hasPlayed_()&&i>=1,r=i>=this.goalBufferLength_(),s=this.playlist_.segments;if(!s.length||n||r)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const a={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(a.isSyncRequest)a.mediaIndex=function(e,t,i){t=t||[];const n=[];let r=0;for(let s=0;s<t.length;s++){const a=t[s];if(e===a.timeline&&(n.push(s),r+=a.duration,r>i))return s}return 0===n.length?0:n[n.length-1]}(this.currentTimeline_,s,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${a.mediaIndex}`);else if(null!==this.mediaIndex){const e=s[this.mediaIndex],i="number"==typeof this.partIndex?this.partIndex:-1;a.startOfSegment=e.end?e.end:t,e.parts&&e.parts[i+1]?(a.mediaIndex=this.mediaIndex,a.partIndex=i+1):a.mediaIndex=this.mediaIndex+1}else{let e,i,n;const r=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:\nFor TargetTime: ${r}.\nCurrentTime: ${this.currentTime_()}\nBufferedEnd: ${t}\nFetch At Buffer: ${this.fetchAtBuffer_}\n`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const t=this.getSyncInfoFromMediaSequenceSync_(r);if(!t){const e="No sync info found while using media sequence sync";return this.error({message:e,metadata:{errorType:dl.Error.StreamingFailedToSelectNextSegment,error:new Error(e)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${t.start} --\x3e ${t.end})`),e=t.segmentIndex,i=t.partIndex,n=t.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const t=Xl.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:r,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});e=t.segmentIndex,i=t.partIndex,n=t.startTime}a.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${r}`:`currentTime ${r}`,a.mediaIndex=e,a.startOfSegment=n,a.partIndex=i,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${a.mediaIndex} `)}const o=s[a.mediaIndex];let l=o&&"number"==typeof a.partIndex&&o.parts&&o.parts[a.partIndex];if(!o||"number"==typeof a.partIndex&&!l)return null;"number"!=typeof a.partIndex&&o.parts&&(a.partIndex=0,l=o.parts[0]);const u=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!i&&l&&!u&&!l.independent)if(0===a.partIndex){const e=s[a.mediaIndex-1],t=e.parts&&e.parts.length&&e.parts[e.parts.length-1];t&&t.independent&&(a.mediaIndex-=1,a.partIndex=e.parts.length-1,a.independent="previous segment")}else o.parts[a.partIndex-1].independent&&(a.partIndex-=1,a.independent="previous part");const c=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return a.mediaIndex>=s.length-1&&c&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,a.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(a))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const i=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!i)return null;if(!i.isAppended)return i;const n=this.mediaSequenceSync_.getSyncInfoForTime(i.end);return n?(n.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),n):null}generateSegmentInfo_(e){const{independent:t,playlist:i,mediaIndex:n,startOfSegment:r,isSyncRequest:s,partIndex:a,forceTimestampOffset:o,getMediaInfoForTime:l}=e,u=i.segments[n],c="number"==typeof a&&u.parts[a],h={requestId:"segment-loader-"+Math.random(),uri:c&&c.resolvedUri||u.resolvedUri,mediaIndex:n,partIndex:c?a:null,isSyncRequest:s,startOfSegment:r,playlist:i,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:u.timeline,duration:c&&c.duration||u.duration,segment:u,part:c,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},d=void 0!==o?o:this.isPendingTimestampOffset_;h.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:u.timeline,currentTimeline:this.currentTimeline_,startOfSegment:r,buffered:this.buffered_(),overrideCheck:d});const p=kl(this.sourceUpdater_.audioBuffered());return"number"==typeof p&&(h.audioAppendStart=p-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(h.gopsToAlignWith=((e,t,i)=>{if(null==t||!e.length)return[];const n=Math.ceil((t-i+3)*Wi.ONE_SECOND_IN_TS);let r;for(r=0;r<e.length&&!(e[r].pts>n);r++);return e.slice(r)})(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),h}timestampOffsetForSegment_(e){return(({segmentTimeline:e,currentTimeline:t,startOfSegment:i,buffered:n,overrideCheck:r})=>r||e!==t?e<t?i:n.length?n.end(n.length-1):i:null)(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),i=e.bandwidth,n=this.pendingSegment_.duration,r=Xl.estimateSegmentRequestTime(n,i,this.playlist_,e.bytesReceived),s=function(e,t,i=1){return((e.length?e.end(e.length-1):0)-t)/i}(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(r<=s)return;const a=function(e){const{main:t,currentTime:i,bandwidth:n,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:o,syncController:l}=e,u=t.playlists.filter(e=>!Xl.isIncompatible(e));let c=u.filter(Xl.isEnabled);c.length||(c=u.filter(e=>!Xl.isDisabled(e)));const h=c.filter(Xl.hasAttribute.bind(null,"BANDWIDTH")).map(e=>{const t=l.getSyncPoint(e,r,o,i)?1:2;return{playlist:e,rebufferingImpact:Xl.estimateSegmentRequestTime(s,n,e)*t-a}}),d=h.filter(e=>e.rebufferingImpact<=0);return _c(d,(e,t)=>bc(t.playlist,e.playlist)),d.length?d[0]:(_c(h,(e,t)=>e.rebufferingImpact-t.rebufferingImpact),h[0]||null)}({main:this.vhs_.playlists.main,currentTime:t,bandwidth:i,duration:this.duration_(),segmentDuration:n,timeUntilRebuffer:s,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!a)return;const o=r-s-a.rebufferingImpact;let l=.5;s<=Sl&&(l=1),!a.playlist||a.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=a.playlist.attributes.BANDWIDTH*ju.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${Pc(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:i,hasVideo:n}=t,r={segmentInfo:Fc({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:i,hasVideo:n}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:r}),this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;const i=Object.keys(e).sort(),n=Object.keys(t).sort();if(i.length!==n.length)return!1;for(let r=0;r<i.length;r++){const s=i[r];if(s!==n[r])return!1;if(e[s]!==t[s])return!1}return!0}(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():Oc(this)))}handleTimingInfo_(e,t,i,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const r=this.pendingSegment_,s=Lc(t);r[s]=r[s]||{},r[s][i]=n,this.logger_(`timinginfo: ${t} - ${i} - ${n}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Oc(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(0===t.length)return void this.logger_("SegmentLoader received no captions from a caption event");if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));const i=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),n={};t.forEach(e=>{n[e.stream]=n[e.stream]||{startTime:1/0,captions:[],endTime:0};const t=n[e.stream];t.startTime=Math.min(t.startTime,e.startTime+i),t.endTime=Math.max(t.endTime,e.endTime+i),t.captions.push(e)}),Object.keys(n).forEach(e=>{const{startTime:t,endTime:r,captions:s}=n[e],a=this.inbandTextTracks_;this.logger_(`adding cues from ${t} -> ${r} for ${e}`),function(e,t,i){if(!e[i]){t.trigger({type:"usage",name:"vhs-608"});let n=i;/^cc708_/.test(i)&&(n="SERVICE"+i.split("_")[1]);const r=t.textTracks().getTrackById(n);if(r)e[i]=r;else{let r=i,s=i,a=!1;const o=(t.options_.vhs&&t.options_.vhs.captionServices||{})[n];o&&(r=o.label,s=o.language,a=o.default),e[i]=t.addRemoteTextTrack({kind:"captions",id:n,default:a,label:r,language:s},!1).track}}}(a,this.vhs_.tech_,e),Mc(t,r,a[e]),function({inbandTextTracks:e,captionArray:t,timestampOffset:i}){if(!t)return;const n=N.WebKitDataCue||N.VTTCue;t.forEach(t=>{const r=t.stream;t.content?t.content.forEach(s=>{const a=new n(t.startTime+i,t.endTime+i,s.text);a.line=s.line,a.align="left",a.position=s.position,a.positionAlign="line-left",e[r].addCue(a)}):e[r].addCue(new n(t.startTime+i,t.endTime+i,t.text))})}({captionArray:s,inbandTextTracks:a,timestampOffset:i})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;this.pendingSegment_.hasAppendedData_?this.addMetadataToTextTrack(i,t,this.duration_()):this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,i))}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(e=>e())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(e=>e())}hasEnoughInfoToLoad_(){if("audio"!==this.loaderType_)return!0;const e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!Dc({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:i,hasVideo:n,isMuxed:r}=t;return!(n&&!e.videoTimingInfo)&&(!(i&&!this.audioDisabled_&&!r&&!e.audioTimingInfo)&&!Dc({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return Oc(this),void this.callQueue_.push(this.handleData_.bind(this,e,t));const i=this.pendingSegment_;if(this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.part||i.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),i.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),i.isFmp4=e.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4)this.trigger("fmp4"),i.timingInfo.start=i[Lc(t.type)].start;else{const e=this.getCurrentMediaInfo_(),t="main"===this.loaderType_&&e&&e.hasVideo;let n;t&&(n=i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:t,firstVideoFrameTimeForData:n,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(i,t.type),this.updateSourceBufferTimestampOffset_(i),i.isSyncRequest){this.updateTimingInfoEnd_(i),this.syncController_.saveSegmentTimingInfo({segmentInfo:i,shouldSaveTimelineMapping:"main"===this.loaderType_});const e=this.chooseNextRequest_();if(e.mediaIndex!==i.mediaIndex||e.partIndex!==i.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,t)}}updateAppendInitSegmentStatus(e,t){"main"!==this.loaderType_||"number"!=typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:i,playlist:n}){if(i){const e=Au(i);if(this.activeInitSegmentId_===e)return null;t=this.initSegmentForMap(i,!0).bytes,this.activeInitSegmentId_=e}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=n,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:i},n){const r=this.sourceUpdater_.audioBuffered(),s=this.sourceUpdater_.videoBuffered();r.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Ml(r).join(", ")),s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Ml(s).join(", "));const a=r.length?r.start(0):0,o=r.length?r.end(r.length-1):0,l=s.length?s.start(0):0,u=s.length?s.end(s.length-1):0;if(o-a<=1&&u-l<=1)return this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${i.byteLength}, audio buffer: ${Ml(r).join(", ")}, video buffer: ${Ml(s).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:i}));const c=this.currentTime_()-1;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${c}`),this.remove(0,c,()=>{this.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=N.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:i},n){n&&(22!==n.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",n),this.error({message:`${t} append of ${i.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:dl.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:i}))}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:i,data:n,bytes:r}){if(!r){const e=[n];let t=n.byteLength;i&&(e.unshift(i),t+=i.byteLength),r=(e=>{let t,i=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach(e=>{t.set(e,i),i+=e.byteLength})),t})({bytes:t,segments:e})}const s={segmentInfo:Fc({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:s}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:r},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:r}))}handleSegmentTimingInfo_(e,t,i){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const n=this.pendingSegment_.segment,r=`${e}TimingInfo`;n[r]||(n[r]={}),n[r].transmuxerPrependedSeconds=i.prependedContentDuration||0,n[r].transmuxedPresentationStart=i.start.presentation,n[r].transmuxedDecodeStart=i.start.decode,n[r].transmuxedPresentationEnd=i.end.presentation,n[r].transmuxedDecodeEnd=i.end.decode,n[r].baseMediaDecodeTime=i.baseMediaDecodeTime}appendData_(e,t){const{type:i,data:n}=t;if(!n||!n.byteLength)return;if("audio"===i&&this.audioDisabled_)return;const r=this.getInitSegmentAndUpdateState_({type:i,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:i,initSegment:r,data:n})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_())return Oc(this),void this.loadQueue_.push(()=>{const t=ye({},e,{forceTimestampOffset:!0});ye(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),i=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),n=null!==this.mediaIndex,r=e.timeline!==this.currentTimeline_&&e.timeline>0,s=i||n&&r;this.logger_(`Requesting\n${wc(e.uri)}\n${Pc(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=mc({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:s,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:t,level:i,stream:n})=>{this.logger_(`${Pc(e)} logged from transmuxer stream ${n} as a ${i}: ${t}`)},triggerSegmentEventFn:({type:e,segment:t,keyInfo:i,trackInfo:n,timingInfo:r})=>{const s={segmentInfo:Fc({segment:t})};i&&(s.keyInfo=i),n&&(s.trackInfo=n),r&&(s.timingInfo=r),this.trigger({type:e,metadata:s})}})}trimBackBuffer_(e){const t=((e,t,i)=>{let n=t-ju.BACK_BUFFER_LENGTH;e.length&&(n=Math.max(n,e.start(0)));const r=t-i;return Math.min(r,n)})(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,i=e.part,n=e.segment.key||e.segment.map&&e.segment.map.key,r=e.segment.map&&!e.segment.map.bytes,s={resolvedUri:i?i.resolvedUri:t.resolvedUri,byterange:i?i.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:n,isMediaInitialization:r},a=e.playlist.segments[e.mediaIndex-1];if(a&&a.timeline===t.timeline&&(a.videoTimingInfo?s.baseStartTime=a.videoTimingInfo.transmuxedDecodeEnd:a.audioTimingInfo&&(s.baseStartTime=a.audioTimingInfo.transmuxedDecodeEnd)),t.key){const i=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);s.key=this.segmentKey(t.key),s.key.iv=i}return t.map&&(s.map=this.initSegmentForMap(t.map)),s}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<Ic)return void this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record 0.016666666666666666`);const i={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:i}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,i){if(this.callQueue_.length)return void this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,i));if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return;if(t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===nc)return;return this.pause(),e.code===ic?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}const n=this.pendingSegment_;this.saveBandwidthRelatedStats_(n.duration,t.stats),n.endOfAllRequests=t.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=((e,t,i)=>{if(!t.length)return e;if(i)return t.slice();const n=t[0].pts;let r=0;for(;r<e.length&&!(e[r].pts>=n);r++);return e.slice(0,r).concat(t)})(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(n)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){"number"==typeof e.start&&"number"==typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:i,firstVideoFrameTimeForData:n,currentVideoTimestampOffset:r,useVideoTimingInfo:s,videoTimingInfo:a,audioTimingInfo:o}){if(void 0!==e)return e;if(!s)return o.start;const l=t.segments[i-1];return 0!==i&&l&&void 0!==l.start&&l.end===n+r?a.start:n}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),void this.trigger("error");const{hasAudio:i,hasVideo:n,isMuxed:r}=t,s="main"===this.loaderType_&&n,a=!this.audioDisabled_&&i&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!=typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);s&&e.waitingOnAppends++,a&&e.waitingOnAppends++,s&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),a&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=((e,t,i)=>"main"===e&&t&&i?i.hasAudio||i.hasVideo?t.hasVideo&&!i.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&i.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null)(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0)}updateSourceBufferTimestampOffset_(e){if(null===e.timestampOffset||"number"!=typeof e.timingInfo.start||e.changedTimestampOffset||"main"!==this.loaderType_)return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:i}){return this.useDtsForTimestampOffset_?e&&"number"==typeof e.transmuxedDecodeStart?e.transmuxedDecodeStart:t&&"number"==typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:i.start:i.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),i="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;i&&(e.timingInfo.end="number"==typeof i.end?i.end:i.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const e={segmentInfo:Fc({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:e})}if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});const t=Nc(e,this.sourceType_);if(t&&("warn"===t.severity?dl.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_))return void this.logger_(`Throwing away un-appended sync request ${Pc(e)}`);this.logger_(`Appended ${Pc(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const i=e.segment,n=e.part,r=i.end&&this.currentTime_()-i.end>3*e.playlist.targetDuration,s=n&&n.end&&this.currentTime_()-n.end>3*e.playlist.partTargetDuration;if(r||s)return this.logger_(`bad ${r?"segment":"part"} ${Pc(e)}`),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<Ic)return void this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record 0.016666666666666666`);const t=this.throughput.rate,i=Date.now()-e.endOfAllRequests+1,n=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(n-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,i=t.start,n=t.end;if(!kc(i)||!kc(n))return;Mc(i,n,this.segmentMetadataTrack_);const r=N.WebKitDataCue||N.VTTCue,s={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:i,end:n},a=new r(i,n,JSON.stringify(s));a.value=s,this.segmentMetadataTrack_.addCue(a)}};function Bc(){}const jc=function(e){return"string"!=typeof e?e:e.replace(/./,e=>e.toUpperCase())},zc=["video","audio"],Vc=(e,t)=>{const i=t[`${e}Buffer`];return i&&i.updating||t.queuePending[e]},Hc=(e,t)=>{if(0===t.queue.length)return;let i=0,n=t.queue[i];if("mediaSource"!==n.type){if("mediaSource"!==e&&t.ready()&&"closed"!==t.mediaSource.readyState&&!Vc(e,t)){if(n.type!==e){if(i=((e,t)=>{for(let i=0;i<t.length;i++){const n=t[i];if("mediaSource"===n.type)return null;if(n.type===e)return i}return null})(e,t.queue),null===i)return;n=t.queue[i]}return t.queue.splice(i,1),t.queuePending[e]=n,n.action(e,t),n.doneFn?void 0:(t.queuePending[e]=null,void Hc(e,t))}}else t.updating()||"closed"===t.mediaSource.readyState||(t.queue.shift(),n.action(t),n.doneFn&&n.doneFn(),Hc("audio",t),Hc("video",t))},qc=(e,t)=>{const i=t[`${e}Buffer`],n=jc(e);i&&(i.removeEventListener("updateend",t[`on${n}UpdateEnd_`]),i.removeEventListener("error",t[`on${n}Error_`]),t.codecs[e]=null,t[`${e}Buffer`]=null)},Gc=(e,t)=>e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t),Wc=(e,t,i)=>(n,r)=>{const s=r[`${n}Buffer`];if(Gc(r.mediaSource,s)){r.logger_(`Appending segment ${t.mediaIndex}'s ${e.length} bytes to ${n}Buffer`);try{s.appendBuffer(e)}catch(a){r.logger_(`Error with code ${a.code} `+(22===a.code?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${t.mediaIndex} to ${n}Buffer`),r.queuePending[n]=null,i(a)}}},$c=(e,t)=>(i,n)=>{const r=n[`${i}Buffer`];if(Gc(n.mediaSource,r)){n.logger_(`Removing ${e} to ${t} from ${i}Buffer`);try{r.remove(e,t)}catch(s){n.logger_(`Remove ${e} to ${t} from ${i}Buffer failed`)}}},Xc=e=>(t,i)=>{const n=i[`${t}Buffer`];Gc(i.mediaSource,n)&&(i.logger_(`Setting ${t}timestampOffset to ${e}`),n.timestampOffset=e)},Yc=e=>(t,i)=>{e()},Qc=e=>t=>{if("open"===t.mediaSource.readyState){t.logger_(`Calling mediaSource endOfStream(${e||""})`);try{t.mediaSource.endOfStream(e)}catch(i){dl.log.warn("Failed to call media source endOfStream",i)}}},Kc=e=>t=>{t.logger_(`Setting mediaSource duration to ${e}`);try{t.mediaSource.duration=e}catch(i){dl.log.warn("Failed to set media source duration",i)}},Zc=()=>(e,t)=>{if("open"!==t.mediaSource.readyState)return;const i=t[`${e}Buffer`];if(Gc(t.mediaSource,i)){t.logger_(`calling abort on ${e}Buffer`);try{i.abort()}catch(n){dl.log.warn(`Failed to abort on ${e}Buffer`,n)}}},Jc=(e,t)=>i=>{const n=jc(e),r=Be(t);i.logger_(`Adding ${e}Buffer with codec ${t} to mediaSource`);const s=i.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",i[`on${n}UpdateEnd_`]),s.addEventListener("error",i[`on${n}Error_`]),i.codecs[e]=t,i[`${e}Buffer`]=s},eh=e=>t=>{const i=t[`${e}Buffer`];if(qc(e,t),Gc(t.mediaSource,i)){t.logger_(`Removing ${e}Buffer with codec ${t.codecs[e]} from mediaSource`);try{t.mediaSource.removeSourceBuffer(i)}catch(n){dl.log.warn(`Failed to removeSourceBuffer ${e}Buffer`,n)}}},th=e=>(t,i)=>{const n=i[`${t}Buffer`],r=Be(e);if(!Gc(i.mediaSource,n))return;const s=e.substring(0,e.indexOf(".")),a=i.codecs[t];if(a.substring(0,a.indexOf("."))===s)return;const o={codecsChangeInfo:{from:a,to:e}};i.trigger({type:"codecschange",metadata:o}),i.logger_(`changing ${t}Buffer codec from ${a} to ${e}`);try{n.changeType(r),i.codecs[t]=e}catch(l){o.errorType=dl.Error.StreamingCodecsChangeError,o.error=l,l.metadata=o,i.error_=l,i.trigger("error"),dl.log.warn(`Failed to changeType on ${t}Buffer`,l)}},ih=({type:e,sourceUpdater:t,action:i,doneFn:n,name:r})=>{t.queue.push({type:e,action:i,doneFn:n,name:r}),Hc(e,t)},nh=(e,t)=>i=>{const n=function(e){if(0===e.length)return"Buffered Ranges are empty";let t="Buffered Ranges: \n";for(let i=0;i<e.length;i++){const n=e.start(i),r=e.end(i);t+=`${n} --\x3e ${r}. Duration (${r-n})\n`}return t}(t[`${e}Buffered`]());if(t.logger_(`received "updateend" event for ${e} Source Buffer: `,n),t.queuePending[e]){const i=t.queuePending[e].doneFn;t.queuePending[e]=null,i&&i(t[`${e}Error_`])}Hc(e,t)};let rh=class extends dl.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>Hc("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=_l("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=nh("video",this),this.onAudioUpdateEnd_=nh("audio",this),this.onVideoError_=e=>{this.videoError_=e},this.onAudioError_=e=>{this.audioError_=e},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){ih({type:"mediaSource",sourceUpdater:this,action:Jc(e,t),name:"addSourceBuffer"})}abort(e){ih({type:e,sourceUpdater:this,action:Zc(e),name:"abort"})}removeSourceBuffer(e){this.canRemoveSourceBuffer()?ih({type:"mediaSource",sourceUpdater:this,action:eh(e),name:"removeSourceBuffer"}):dl.log.error("removeSourceBuffer is not supported!")}canRemoveSourceBuffer(){return!dl.browser.IS_FIREFOX&&N.MediaSource&&N.MediaSource.prototype&&"function"==typeof N.MediaSource.prototype.removeSourceBuffer}static canChangeType(){return N.SourceBuffer&&N.SourceBuffer.prototype&&"function"==typeof N.SourceBuffer.prototype.changeType}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){this.canChangeType()?ih({type:e,sourceUpdater:this,action:th(t),name:"changeType"}):dl.log.error("changeType is not supported!")}addOrChangeSourceBuffers(e){if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const i=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,i);this.canChangeType()&&this.changeType(t,i)})}appendBuffer(e,t){const{segmentInfo:i,type:n,bytes:r}=e;if(this.processedAppend_=!0,"audio"===n&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_(`delayed audio append of ${r.length} until video append`);if(ih({type:n,sourceUpdater:this,action:Wc(r,i||{mediaIndex:-1},t),doneFn:t,name:"appendBuffer"}),"video"===n){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const e=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${e.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,e.forEach(e=>{this.appendBuffer.apply(this,e)})}}audioBuffered(){return Gc(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:Tl()}videoBuffered(){return Gc(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:Tl()}buffered(){const e=Gc(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=Gc(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():function(e,t){let i=null,n=null,r=0;const s=[],a=[];if(!(e&&e.length&&t&&t.length))return Tl();let o=e.length;for(;o--;)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});for(o=t.length;o--;)s.push({time:t.start(o),type:"start"}),s.push({time:t.end(o),type:"end"});for(s.sort(function(e,t){return e.time-t.time}),o=0;o<s.length;o++)"start"===s[o].type?(r++,2===r&&(i=s[o].time)):"end"===s[o].type&&(r--,1===r&&(n=s[o].time)),null!==i&&null!==n&&(a.push([i,n]),i=null,n=null);return Tl(a)}(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=Bc){ih({type:"mediaSource",sourceUpdater:this,action:Kc(e),name:"duration",doneFn:t})}endOfStream(e=null,t=Bc){"string"!=typeof e&&(e=void 0),ih({type:"mediaSource",sourceUpdater:this,action:Qc(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,i=Bc){this.audioBuffered().length&&0!==this.audioBuffered().end(0)?ih({type:"audio",sourceUpdater:this,action:$c(e,t),doneFn:i,name:"remove"}):i()}removeVideo(e,t,i=Bc){this.videoBuffered().length&&0!==this.videoBuffered().end(0)?ih({type:"video",sourceUpdater:this,action:$c(e,t),doneFn:i,name:"remove"}):i()}updating(){return!(!Vc("audio",this)&&!Vc("video",this))}audioTimestampOffset(e){return void 0!==e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(ih({type:"audio",sourceUpdater:this,action:Xc(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return void 0!==e&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(ih({type:"video",sourceUpdater:this,action:Xc(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&ih({type:"audio",sourceUpdater:this,action:Yc(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&ih({type:"video",sourceUpdater:this,action:Yc(e),name:"callback"})}dispose(){this.trigger("dispose"),zc.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>qc(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}};const sh=e=>decodeURIComponent(escape(String.fromCharCode.apply(null,e))),ah=new Uint8Array("\n\n".split("").map(e=>e.charCodeAt(0)));let oh=class extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}},lh=class extends Uc{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return Tl();const e=this.subtitlesTrack_.cues;return Tl([[e[0].startTime,e[e.length-1].startTime]])}initSegmentForMap(e,t=!1){if(!e)return null;const i=Au(e);let n=this.initSegments_[i];if(t&&!n&&e.bytes){const t=ah.byteLength+e.bytes.byteLength,r=new Uint8Array(t);r.set(e.bytes),r.set(ah,e.bytes.byteLength),this.initSegments_[i]=n={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:r}}return n||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return void 0===e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_}remove(e,t){Mc(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline)){const e=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};return this.syncController_.one("timestampoffset",e),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,i){if(!this.subtitlesTrack_)return void(this.state="READY");if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===ic&&this.handleTimeout_(),e.code===nc?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);const n=this.pendingSegment_,r=i.mp4VttCues&&i.mp4VttCues.length;r&&(n.mp4VttCues=i.mp4VttCues),this.saveBandwidthRelatedStats_(n.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const s=n.segment;if(s.map&&(s.map.bytes=t.map.bytes),n.bytes=t.bytes,"function"!=typeof N.WebVTT&&"function"==typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,i),()=>this.stopForError({message:"Error loading vtt.js"}));s.requested=!0;try{this.parseVTTCues_(n)}catch(a){return void this.stopForError({message:a.message,metadata:{errorType:dl.Error.StreamingVttParserError,error:a}})}if(r||this.updateTimeMapping_(n,this.syncController_.timelines[n.timeline],this.playlist_),n.cues.length?n.timingInfo={start:n.cues[0].startTime,end:n.cues[n.cues.length-1].endTime}:n.timingInfo={start:n.startOfSegment,end:n.startOfSegment+n.duration},n.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");n.byteLength=n.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,n.cues.forEach(e=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new N.VTTCue(e.startTime,e.endTime,e.text):e)}),function(e){const t=e.cues;if(!t)return;const i={};for(let n=t.length-1;n>=0;n--){const r=t[n],s=`${r.startTime}-${r.endTime}-${r.text}`;i[s]?e.removeCue(r):i[s]=r}}(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const i=e&&"vtt"===e.type,n=t&&"text"===t.type;i&&n&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(i=>{const n=i.start+t,r=i.end+t,s=new N.VTTCue(n,r,i.cueText);i.settings&&i.settings.split(" ").forEach(e=>{const t=e.split(":"),i=t[0],n=t[1];s[i]=isNaN(n)?n:Number(n)}),e.cues.push(s)})}parseVTTCues_(e){let t,i=!1;if("function"!=typeof N.WebVTT)throw new oh;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues)return void this.parseMp4VttCues_(e);"function"==typeof N.TextDecoder?t=new N.TextDecoder("utf8"):(t=N.WebVTT.StringDecoder(),i=!0);const n=new N.WebVTT.Parser(N,N.vttjs,t);if(n.oncue=e.cues.push.bind(e.cues),n.ontimestampmap=t=>{e.timestampmap=t},n.onparsingerror=e=>{dl.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){let t=e.segment.map.bytes;i&&(t=sh(t)),n.parse(t)}let r=e.bytes;i&&(r=sh(r)),n.parse(r),n.flush()}updateTimeMapping_(e,t,i){const n=e.segment;if(!t)return;if(!e.cues.length)return void(n.empty=!0);const{MPEGTS:r,LOCAL:s}=e.timestampmap,a=r/Wi.ONE_SECOND_IN_TS-s+t.mapping;if(e.cues.forEach(e=>{const i=e.endTime-e.startTime,n=this.handleRollover_(e.startTime+a,t.time);e.startTime=Math.max(n,0),e.endTime=Math.max(n+i,0)}),!i.syncInfo){const t=e.cues[0].startTime,r=e.cues[e.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:Math.min(t,r-n.duration)}}}handleRollover_(e,t){if(null===t)return e;let i=e*Wi.ONE_SECOND_IN_TS;const n=t*Wi.ONE_SECOND_IN_TS;let r;for(r=n<i?-8589934592:8589934592;Math.abs(i-n)>4294967296;)i+=r;return i/Wi.ONE_SECOND_IN_TS}};const uh=function(e,t){const i=e.cues;for(let n=0;n<i.length;n++){const e=i[n];if(t>=e.adStartTime&&t<=e.adEndTime)return e}return null};class ch{constructor({start:e,end:t,segmentIndex:i,partIndex:n=null,appended:r=!1}){this.start_=e,this.end_=t,this.segmentIndex_=i,this.partIndex_=n,this.appended_=r}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class hh{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class dh{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:i,segments:n}=e;if(this.isReliable_=this.isReliablePlaylist_(i,n),this.isReliable_)return this.updateStorage_(n,i,this.calculateBaseTime_(i,n,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:i}of this.storage_.values())if(i.length){for(const n of i)if(n.isInRange(e))return n}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,i){const n=new Map;let r="\n",s=i,a=t;this.start_=s,e.forEach((e,t)=>{const i=this.storage_.get(a),o=s,l=o+e.duration,u=Boolean(i&&i.segmentSyncInfo&&i.segmentSyncInfo.isAppended),c=new ch({start:o,end:l,appended:u,segmentIndex:t});e.syncInfo=c;let h=s;const d=(e.parts||[]).map((e,n)=>{const s=h,o=h+e.duration,l=Boolean(i&&i.partsSyncInfo&&i.partsSyncInfo[n]&&i.partsSyncInfo[n].isAppended),u=new ch({start:s,end:o,appended:l,segmentIndex:t,partIndex:n});return h=o,r+=`Media Sequence: ${a}.${n} | Range: ${s} --\x3e ${o} | Appended: ${l}\n`,e.syncInfo=u,u});n.set(a,new hh(c,d)),r+=`${wc(e.resolvedUri)} | Media Sequence: ${a} | Range: ${o} --\x3e ${l} | Appended: ${u}\n`,a++,s=l}),this.end_=s,this.storage_=n,this.diagnostics_=r}calculateBaseTime_(e,t,i){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const n=Math.min(...this.storage_.keys());if(e<n){const i=n-e;let r=this.storage_.get(n).segmentSyncInfo.start;for(let e=0;e<i;e++){r-=t[e].duration}return r}return i}isReliablePlaylist_(e,t){return null!=e&&Array.isArray(t)&&t.length}}class ph extends dh{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,i){if(!this.storage_.size){const t=this.parent_.getSyncInfoForMediaSequence(e);return t?t.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,i)}}const fh=[{name:"VOD",run:(e,t,i,n,r)=>{if(i!==1/0){return{time:0,segmentIndex:0,partIndex:null}}return null}},{name:"MediaSequence",run:(e,t,i,n,r,s)=>{const a=e.getMediaSequenceSync(s);if(!a)return null;if(!a.isReliable)return null;const o=a.getSyncInfoForTime(r);return o?{time:o.start,partIndex:o.partIndex,segmentIndex:o.segmentIndex}:null}},{name:"ProgramDateTime",run:(e,t,i,n,r)=>{if(!Object.keys(e.timelineToDatetimeMappings).length)return null;let s=null,a=null;const o=Ll(t);r=r||0;for(let l=0;l<o.length;l++){const i=o[t.endList||0===r?l:o.length-(l+1)],n=i.segment,u=e.timelineToDatetimeMappings[n.timeline];if(!u||!n.dateTimeObject)continue;let c=n.dateTimeObject.getTime()/1e3+u;if(n.parts&&"number"==typeof i.partIndex)for(let e=0;e<i.partIndex;e++)c+=n.parts[e].duration;const h=Math.abs(r-c);if(null!==a&&(0===h||a<h))break;a=h,s={time:c,segmentIndex:i.segmentIndex,partIndex:i.partIndex}}return s}},{name:"Segment",run:(e,t,i,n,r)=>{let s=null,a=null;r=r||0;const o=Ll(t);for(let l=0;l<o.length;l++){const e=o[t.endList||0===r?l:o.length-(l+1)],i=e.segment,u=e.part&&e.part.start||i&&i.start;if(i.timeline===n&&void 0!==u){const t=Math.abs(r-u);if(null!==a&&a<t)break;(!s||null===a||a>=t)&&(a=t,s={time:u,segmentIndex:e.segmentIndex,partIndex:e.partIndex})}}return s}},{name:"Discontinuity",run:(e,t,i,n,r)=>{let s=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length){let i=null;for(let n=0;n<t.discontinuityStarts.length;n++){const a=t.discontinuityStarts[n],o=t.discontinuitySequence+n+1,l=e.discontinuities[o];if(l){const e=Math.abs(r-l.time);if(null!==i&&i<e)break;(!s||null===i||i>=e)&&(i=e,s={time:l.time,segmentIndex:a,partIndex:null})}}}return s}},{name:"Playlist",run:(e,t,i,n,r)=>{if(t.syncInfo){return{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}}return null}}];let mh=class extends dl.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new dh,i=new ph(t),n=new ph(t);this.mediaSequenceStorage_={main:t,audio:i,vtt:n},this.logger_=_l("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,i,n,r){if(t!==1/0){return fh.find(({name:e})=>"VOD"===e).run(this,e,t)}const s=this.runStrategies_(e,t,i,n,r);if(!s.length)return null;for(const a of s){const{syncPoint:t,strategy:i}=a,{segmentIndex:r,time:s}=t;if(r<0)continue;const o=s,l=o+e.segments[r].duration;if(this.logger_(`Strategy: ${i}. Current time: ${n}. selected segment: ${r}. Time: [${o} -> ${l}]}`),n>=o&&n<l)return this.logger_("Found sync point with exact match: ",t),t}return this.selectSyncPoint_(s,{key:"time",value:n})}getExpiredTime(e,t){if(!e||!e.segments)return null;const i=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!i.length)return null;const n=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return n.segmentIndex>0&&(n.time*=-1),Math.abs(n.time+Ul({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:n.segmentIndex,endIndex:0}))}runStrategies_(e,t,i,n,r){const s=[];for(let a=0;a<fh.length;a++){const o=fh[a],l=o.run(this,e,t,i,n,r);l&&(l.strategy=o.name,s.push({strategy:o.name,syncPoint:l}))}return s}selectSyncPoint_(e,t){let i=e[0].syncPoint,n=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy;for(let s=1;s<e.length;s++){const a=Math.abs(e[s].syncPoint[t.key]-t.value);a<n&&(n=a,i=e[s].syncPoint,r=e[s].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${r}]: [time:${i.time}, segmentIndex:${i.segmentIndex}`+("number"==typeof i.partIndex?`,partIndex:${i.partIndex}`:"")+"]"),i}saveExpiredSegmentInfo(e,t){const i=t.mediaSequence-e.mediaSequence;if(i>86400)dl.log.warn(`Not saving expired segment info. Media sequence gap ${i} is too large.`);else for(let n=i-1;n>=0;n--){const i=e.segments[n];if(i&&void 0!==i.start){t.syncInfo={mediaSequence:e.mediaSequence+n,time:i.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],i=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-i}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const i=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),n=e.segment;i&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:n.start}));const r=n.dateTimeObject;n.discontinuity&&t&&r&&(this.timelineToDatetimeMappings[n.timeline]=-r.getTime()/1e3)}timestampOffsetForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].time}mappingForTimeline(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,i){const n=e.segment,r=e.part;let s,a,o=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},i&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${o.time}] [mapping: ${o.mapping}]`)),s=e.startOfSegment,a=t.end+o.mapping;else{if(!o)return!1;s=t.start+o.mapping,a=t.end+o.mapping}return r&&(r.start=s,r.end=a),(!n.start||s<n.start)&&(n.start=s),n.end=a,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,i=e.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let n=0;n<t.discontinuityStarts.length;n++){const r=t.discontinuityStarts[n],s=t.discontinuitySequence+n+1,a=r-e.mediaIndex,o=Math.abs(a);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>o){let n;n=a<0?i.start-Ul({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):i.end+Ul({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[s]={time:n,accuracy:o}}}}dispose(){this.trigger("dispose"),this.off()}},gh=class extends dl.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:i}){return"number"==typeof t&&"number"==typeof i&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:i},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:i}){if("number"==typeof t&&"number"==typeof i){this.lastTimelineChanges_[e]={type:e,from:t,to:i},delete this.pendingTimelineChanges_[e];const n={timelineChangeInfo:{from:t,to:i}};this.trigger({type:"timelinechange",metadata:n})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}};const yh=Hu(qu(function(){var e=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(i,1),i>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,n=0;n<i;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();let t=null;class i{constructor(e){let i,n,r;t||(t=function(){const e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],i=e[1],n=t[4],r=i[4];let s,a,o;const l=[],u=[];let c,h,d,p,f,m;for(s=0;s<256;s++)u[(l[s]=s<<1^283*(s>>7))^s]=s;for(a=o=0;!n[a];a^=c||1,o=u[o]||1)for(p=o^o<<1^o<<2^o<<3^o<<4,p=p>>8^255&p^99,n[a]=p,r[p]=a,d=l[h=l[c=l[a]]],m=16843009*d^65537*h^257*c^16843008*a,f=257*l[p]^16843008*p,s=0;s<4;s++)t[s][a]=f=f<<24^f>>>8,i[s][p]=m=m<<24^m>>>8;for(s=0;s<5;s++)t[s]=t[s].slice(0),i[s]=i[s].slice(0);return e}()),this._tables=[[t[0][0].slice(),t[0][1].slice(),t[0][2].slice(),t[0][3].slice(),t[0][4].slice()],[t[1][0].slice(),t[1][1].slice(),t[1][2].slice(),t[1][3].slice(),t[1][4].slice()]];const s=this._tables[0][4],a=this._tables[1],o=e.length;let l=1;if(4!==o&&6!==o&&8!==o)throw new Error("Invalid aes key size");const u=e.slice(0),c=[];for(this._key=[u,c],i=o;i<4*o+28;i++)r=u[i-1],(i%o===0||8===o&&i%o===4)&&(r=s[r>>>24]<<24^s[r>>16&255]<<16^s[r>>8&255]<<8^s[255&r],i%o===0&&(r=r<<8^r>>>24^l<<24,l=l<<1^283*(l>>7))),u[i]=u[i-o]^r;for(n=0;i;n++,i--)r=u[3&n?i:i-4],c[n]=i<=4||n<4?r:a[0][s[r>>>24]]^a[1][s[r>>16&255]]^a[2][s[r>>8&255]]^a[3][s[255&r]]}decrypt(e,t,i,n,r,s){const a=this._key[1];let o,l,u,c=e^a[0],h=n^a[1],d=i^a[2],p=t^a[3];const f=a.length/4-2;let m,g=4;const y=this._tables[1],v=y[0],_=y[1],b=y[2],T=y[3],S=y[4];for(m=0;m<f;m++)o=v[c>>>24]^_[h>>16&255]^b[d>>8&255]^T[255&p]^a[g],l=v[h>>>24]^_[d>>16&255]^b[p>>8&255]^T[255&c]^a[g+1],u=v[d>>>24]^_[p>>16&255]^b[c>>8&255]^T[255&h]^a[g+2],p=v[p>>>24]^_[c>>16&255]^b[h>>8&255]^T[255&d]^a[g+3],g+=4,c=o,h=l,d=u;for(m=0;m<4;m++)r[(3&-m)+s]=S[c>>>24]<<24^S[h>>16&255]<<16^S[d>>8&255]<<8^S[255&p]^a[g++],o=c,c=h,h=d,d=p,p=o}}class n extends e{constructor(){super(e),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const r=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24};class s{constructor(e,t,i,a){const o=s.STEP,l=new Int32Array(e.buffer),u=new Uint8Array(e.byteLength);let c=0;for(this.asyncStream_=new n,this.asyncStream_.push(this.decryptChunk_(l.subarray(c,c+o),t,i,u)),c=o;c<l.length;c+=o)i=new Uint32Array([r(l[c-4]),r(l[c-3]),r(l[c-2]),r(l[c-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(c,c+o),t,i,u));this.asyncStream_.push(function(){var e;a(null,(e=u).subarray(0,e.byteLength-e[e.byteLength-1]))})}static get STEP(){return 32e3}decryptChunk_(e,t,n,s){return function(){const a=function(e,t,n){const s=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),a=new i(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),l=new Int32Array(o.buffer);let u,c,h,d,p,f,m,g,y;for(u=n[0],c=n[1],h=n[2],d=n[3],y=0;y<s.length;y+=4)p=r(s[y]),f=r(s[y+1]),m=r(s[y+2]),g=r(s[y+3]),a.decrypt(p,f,m,g,l,y),l[y]=r(l[y]^u),l[y+1]=r(l[y+1]^c),l[y+2]=r(l[y+2]^h),l[y+3]=r(l[y+3]^d),u=p,c=f,h=m,d=g;return o}(e,t,n);s.set(a,e.byteOffset)}}}var a,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};a="undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{};var l=a.BigInt||Number;l("0x1"),l("0x100"),l("0x10000"),l("0x1000000"),l("0x100000000"),l("0x10000000000"),l("0x1000000000000"),l("0x100000000000000"),l("0x10000000000000000"),function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();const u=function(e){const t={};return Object.keys(e).forEach(i=>{const n=e[i];var r;r=n,("function"===ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer)?t[i]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:t[i]=n}),t};self.onmessage=function(e){const t=e.data,i=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),n=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),r=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new s(i,n,r,function(e,i){self.postMessage(u({source:t.source,decrypted:i}),[i.buffer])})}}));var vh=Vu(yh);const _h=e=>{let t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},bh=(e,t)=>{e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},Th=(e,t)=>{t.activePlaylistLoader=e,e.load()},Sh={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:i},excludePlaylist:n}=t,r=i.activeTrack(),s=i.activeGroup(),a=(s.filter(e=>e.default)[0]||s[0]).id,o=i.tracks[a];if(r!==o){dl.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const e in i.tracks)i.tracks[e].enabled=i.tracks[e]===o;i.onTrackChanged()}else n({error:{message:"Problem encountered loading the default audio track."}})},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:i}}=t;dl.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const n=i.activeTrack();n&&(n.mode="disabled"),i.onTrackChanged()}},wh={AUDIO:(e,t,i)=>{if(!t)return;const{tech:n,requestOptions:r,segmentLoaders:{[e]:s}}=i;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),(!n.paused()||e.endList&&"none"!==n.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),n.paused()||s.load()}),t.on("error",Sh[e](e,i))},SUBTITLES:(e,t,i)=>{const{tech:n,requestOptions:r,segmentLoaders:{[e]:s},mediaTypes:{[e]:a}}=i;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),s.track(a.activeTrack()),(!n.paused()||e.endList&&"none"!==n.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),n.paused()||s.load()}),t.on("error",Sh[e](e,i))}},xh={AUDIO:(e,t)=>{const{vhs:i,sourceType:n,segmentLoaders:{[e]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[e]:{groups:o,tracks:l,logger_:u}},mainPlaylistLoader:c}=t,h=$l(c.main);a[e]&&0!==Object.keys(a[e]).length||(a[e]={main:{default:{default:!0}}},h&&(a[e].main.default.playlists=c.main.playlists));for(const d in a[e]){o[d]||(o[d]=[]);for(const r in a[e][d]){let p,f=a[e][d][r];if(h?(u(`AUDIO group '${d}' label '${r}' is a main playlist`),f.isMainPlaylist=!0,p=null):p="vhs-json"===n&&f.playlists?new yu(f.playlists[0],i,s):f.resolvedUri?new yu(f.resolvedUri,i,s):f.playlists&&"dash"===n?new Bu(f.playlists[0],i,s,c):null,f=bl({id:r,playlistLoader:p},f),wh[e](e,f.playlistLoader,t),o[d].push(f),void 0===l[r]){const e=new dl.AudioTrack({id:r,kind:_h(f),enabled:!1,language:f.language,default:f.default,label:r});l[r]=e}}}r.on("error",Sh[e](e,t))},SUBTITLES:(e,t)=>{const{tech:i,vhs:n,sourceType:r,segmentLoaders:{[e]:s},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[e]:{groups:l,tracks:u}},mainPlaylistLoader:c}=t;for(const h in o[e]){l[h]||(l[h]=[]);for(const s in o[e][h]){if(!n.options_.useForcedSubtitles&&o[e][h][s].forced)continue;let d,p=o[e][h][s];if("hls"===r)d=new yu(p.resolvedUri,n,a);else if("dash"===r){if(!p.playlists.filter(e=>e.excludeUntil!==1/0).length)return;d=new Bu(p.playlists[0],n,a,c)}else"vhs-json"===r&&(d=new yu(p.playlists?p.playlists[0]:p.resolvedUri,n,a));if(p=bl({id:s,playlistLoader:d},p),wh[e](e,p.playlistLoader,t),l[h].push(p),void 0===u[s]){const e=i.addRemoteTextTrack({id:s,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:s},!1).track;u[s]=e}}}s.on("error",Sh[e](e,t))},"CLOSED-CAPTIONS":(e,t)=>{const{tech:i,main:{mediaGroups:n},mediaTypes:{[e]:{groups:r,tracks:s}}}=t;for(const a in n[e]){r[a]||(r[a]=[]);for(const t in n[e][a]){const o=n[e][a][t];if(!/^(?:CC|SERVICE)/.test(o.instreamId))continue;const l=i.options_.vhs&&i.options_.vhs.captionServices||{};let u={label:t,language:o.language,instreamId:o.instreamId,default:o.default&&o.autoselect};if(l[u.instreamId]&&(u=bl(u,l[u.instreamId])),void 0===u.default&&delete u.default,r[a].push(bl({id:t},o)),void 0===s[t]){const e=i.addRemoteTextTrack({id:u.instreamId,kind:"captions",default:u.default,language:u.language,label:u.label},!1).track;s[t]=e}}}}},Ah=(e,t)=>{for(let i=0;i<e.length;i++){if(Gl(t,e[i]))return!0;if(e[i].playlists&&Ah(e[i].playlists,t))return!0}return!1},Eh={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:i}}}=t;for(const e in i)if(i[e].enabled)return i[e];return null},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:i}}}=t;for(const e in i)if("showing"===i[e].mode||"hidden"===i[e].mode)return i[e];return null}},Ch=e=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{xh[t](t,e)});const{mediaTypes:t,mainPlaylistLoader:i,tech:n,vhs:r,segmentLoaders:{AUDIO:s,main:a}}=e;["AUDIO","SUBTITLES"].forEach(i=>{t[i].activeGroup=((e,t)=>i=>{const{mainPlaylistLoader:n,mediaTypes:{[e]:{groups:r}}}=t,s=n.media();if(!s)return null;let a=null;s.attributes[e]&&(a=r[s.attributes[e]]);const o=Object.keys(r);if(!a)if("AUDIO"===e&&o.length>1&&$l(t.main))for(let e=0;e<o.length;e++){const t=r[o[e]];if(Ah(t,s)){a=t;break}}else r.main?a=r.main:1===o.length&&(a=r[o[0]]);return void 0===i?a:null!==i&&a&&a.filter(e=>e.id===i.id)[0]||null})(i,e),t[i].activeTrack=Eh[i](i,e),t[i].onGroupChanged=((e,t)=>()=>{const{segmentLoaders:{[e]:i,main:n},mediaTypes:{[e]:r}}=t,s=r.activeTrack(),a=r.getActiveGroup(),o=r.activePlaylistLoader,l=r.lastGroup_;a&&l&&a.id===l.id||(r.lastGroup_=a,r.lastTrack_=s,bh(i,r),a&&!a.isMainPlaylist&&(a.playlistLoader?(i.resyncLoader(),Th(a.playlistLoader,r)):o&&n.resetEverything()))})(i,e),t[i].onGroupChanging=((e,t)=>()=>{const{segmentLoaders:{[e]:i},mediaTypes:{[e]:n}}=t;n.lastGroup_=null,i.abort(),i.pause()})(i,e),t[i].onTrackChanged=((e,t)=>()=>{const{mainPlaylistLoader:i,segmentLoaders:{[e]:n,main:r},mediaTypes:{[e]:s}}=t,a=s.activeTrack(),o=s.getActiveGroup(),l=s.activePlaylistLoader,u=s.lastTrack_;if((!u||!a||u.id!==a.id)&&(s.lastGroup_=o,s.lastTrack_=a,bh(n,s),o)){if(o.isMainPlaylist){if(!a||!u||a.id===u.id)return;const e=t.vhs.playlistController_,n=e.selectPlaylist();if(e.media()===n)return;return s.logger_(`track change. Switching main audio from ${u.id} to ${a.id}`),i.pause(),r.resetEverything(),void e.fastQualityChange_(n)}if("AUDIO"===e){if(!o.playlistLoader)return r.setAudio(!0),void r.resetEverything();n.setAudio(!0),r.setAudio(!1)}l!==o.playlistLoader?(n.track&&n.track(a),n.resetEverything(),Th(o.playlistLoader,s)):Th(o.playlistLoader,s)}})(i,e),t[i].getActiveGroup=((e,{mediaTypes:t})=>()=>{const i=t[e].activeTrack();return i?t[e].activeGroup(i):null})(i,e)});const o=t.AUDIO.activeGroup();if(o){const e=(o.filter(e=>e.default)[0]||o[0]).id;t.AUDIO.tracks[e].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged();t.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}i.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanged())}),i.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanging())});const l=()=>{t.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",l),n.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",()=>{n.audioTracks().removeEventListener("change",l),n.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const u in t.AUDIO.tracks)n.audioTracks().addTrack(t.AUDIO.tracks[u])};class Mh{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){1===e&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=yl(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(e=>[e.ID,e])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class kh extends dl.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new Mh,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=_l("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const i=t.serverUri||t.serverURL;if(!i)return this.logger_(`steering manifest URL is ${i}, cannot request steering manifest.`),void this.trigger("error");i.startsWith("data:")?this.decodeDataUriManifest_(i.substring(i.indexOf(",")+1)):(this.steeringManifest.reloadUri=yl(e,i),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering"))}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const i=e?t:this.getRequestURI(t);if(!i)return this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),void this.dispose();const n={contentSteeringInfo:{uri:i}};this.trigger({type:"contentsteeringloadstart",metadata:n}),this.request_=this.xhr_({uri:i,requestType:"content-steering-manifest"},(e,t)=>{if(e){if(410===t.status)return this.logger_(`manifest request 410 ${e}.`),this.logger_(`There will be no more content steering requests to ${i} this session.`),void this.excludedSteeringManifestURLs.add(i);if(429===t.status){const i=t.responseHeaders["retry-after"];return this.logger_(`manifest request 429 ${e}.`),this.logger_(`content steering will retry in ${i} seconds.`),void this.startTTLTimeout_(parseInt(i,10))}return this.logger_(`manifest failed to load ${e}.`),void this.startTTLTimeout_()}let r;this.trigger({type:"contentsteeringloadcomplete",metadata:n});try{r=JSON.parse(this.request_.responseText)}catch(a){const e={errorType:dl.Error.StreamingContentSteeringParserError,error:a};this.trigger({type:"error",metadata:e})}this.assignSteeringProperties_(r);const s={contentSteeringInfo:n.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:s}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new N.URL(e),i=new N.URL(this.proxyServerUrl_);return i.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(i.toString())}decodeDataUriManifest_(e){const t=JSON.parse(N.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new N.URL(e),i=this.getPathway(),n=this.getBandwidth_();if(i){const e=`_${this.manifestType_}_pathway`;t.searchParams.set(e,i)}if(n){const e=`_${this.manifestType_}_throughput`;t.searchParams.set(e,n)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version)return this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),void this.trigger("error");this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const t=(e=>{for(const t of e)if(this.availablePathways_.has(t))return t;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==t&&(this.currentPathway=t,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=e=>this.excludedSteeringManifestURLs.has(e);if(this.proxyServerUrl_){const i=this.setProxyServerUrl_(e);if(!t(i))return i}const i=this.setSteeringParams_(e);return t(i)?null:i}startTTLTimeout_(e=this.steeringManifest.ttl){const t=1e3*e;this.ttlTimeout_=N.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){N.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new Mh}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(yl(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}let Ih;const Ph=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],Lh=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]};class Dh extends dl.EventTarget{constructor(e){super(),this.fastQualityChange_=((e,t)=>{let i=null;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{e.apply(null,n)},t)}})(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:i,tech:n,bandwidth:r,externVhs:s,useCueTags:a,playlistExclusionDuration:o,enableLowInitialPlaylist:l,sourceType:u,cacheEncryptionKeys:c,bufferBasedABR:h,leastPixelDiffSelector:d,captionServices:p,experimentalUseMMS:f}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:m}=e;null==m&&(m=1/0),Ih=s,this.bufferBasedABR=Boolean(h),this.leastPixelDiffSelector=Boolean(d),this.withCredentials=i,this.tech_=n,this.vhs_=n.vhs,this.player_=e.player_,this.sourceType_=u,this.useCueTags_=a,this.playlistExclusionDuration=o,this.maxPlaylistRetries=m,this.enableLowInitialPlaylist=l,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:i,maxPlaylistRetries:m,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=(()=>{const e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Bc,activeTrack:Bc,getActiveGroup:Bc,onGroupChanged:Bc,onTrackChanged:Bc,lastTrack_:null,logger_:_l(`MediaGroups[${t}]`)}}),e})(),f&&N.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new N.ManagedMediaSource,this.usingManagedMediaSource_=!0,dl.log("Using ManagedMediaSource")):N.MediaSource&&(this.mediaSource=new N.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=Tl(),this.hasPlayed_=!1,this.syncController_=new mh(e),this.segmentMetadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new vh,this.sourceUpdater_=new rh(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new gh,this.keyStatusMap_=new Map;const g={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:p,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:r,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:c,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_="dash"===this.sourceType_?new Bu(t,this.vhs_,bl(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new yu(t,this.vhs_,bl(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new Uc(bl(g,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new Uc(bl(g,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new lh(bl(g,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((e,t)=>{function i(){n.off("vttjserror",r),e()}function r(){n.off("vttjsloaded",i),t()}n.one("vttjsloaded",i),n.one("vttjserror",r),n.addWebVttScript_()})}),e);this.contentSteeringController_=new kh(this.vhs_.xhr,()=>this.mainSegmentLoader_.bandwidth),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),Ph.forEach(e=>{this[e+"_"]=Lh.bind(this,e)}),this.logger_=_l("pc"),this.triggeredFmp4Usage=!1,"none"===this.tech_.preload()?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const y="none"===this.tech_.preload()?"play":"loadstart";this.tech_.one(y,()=>{const e=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-e,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,i){const n=this.media(),r=n&&(n.id||n.uri),s=e&&(e.id||e.uri);if(r&&r!==s){this.logger_(`switch media ${r} -> ${s} from ${t}`);const i={renditionInfo:{id:s,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:i}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,i)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],i=t?t.activeGroup():null,n=this.contentSteeringController_.getPathway();if(i&&n){const t=(i.length?i[0].playlists:i.playlists).filter(e=>e.attributes.serviceLocation===n);t.length&&this.mediaTypes_[e].activePlaylistLoader.media(t[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=N.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(N.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const i=e.mediaGroups.AUDIO,n=Object.keys(i);let r;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)r=this.mediaTypes_.AUDIO.activeTrack();else{const e=i.main||n.length&&i[n[0]];for(const t in e)if(e[t].default){r={label:t};break}}if(!r)return t;const s=[];for(const a in i)if(i[a][r.label]){const t=i[a][r.label];if(t.playlists&&t.playlists.length)s.push.apply(s,t.playlists);else if(t.uri)s.push(t);else if(e.playlists.length)for(let i=0;i<e.playlists.length;i++){const t=e.playlists[i];t.attributes&&t.attributes.AUDIO&&t.attributes.AUDIO===a&&s.push(t)}}return s.length?s:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;ql(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&"none"!==this.tech_.preload()&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),Ch({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){let t;if(this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_(),this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t))return;this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial");if(!("vhs-json"===this.sourceType_&&this.initialMedia_.segments))return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;ql(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,"dash"===this.sourceType_&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if("playlist-unchanged"===e.lastExcludeReason_)return;this.stuckAtPlaylistEnd_(e)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})});["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(e=>{this.mainPlaylistLoader_.on(e,e=>{this.player_.trigger(ye({},e))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const i=e.mediaGroups||{};let n=!0;const r=Object.keys(i.AUDIO);for(const s in i.AUDIO)for(const e in i.AUDIO[s]){i.AUDIO[s][e].uri||(n=!1)}n&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(i.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Ih.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),r.length&&Object.keys(i.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,i=this.tech_.currentTime(),n=this.bufferLowWaterLine(),r=this.bufferHighWaterLine();return function({currentPlaylist:e,buffered:t,currentTime:i,nextPlaylist:n,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:a,bufferBasedABR:o,log:l}){if(!n)return dl.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u=`allowing switch ${e&&e.id||"null"} -> ${n.id}`;if(!e)return l(`${u} as current playlist is not set`),!0;if(n.id===e.id)return!1;const c=Boolean(Al(t,i).length);if(!e.endList)return c||"number"!=typeof e.partTargetDuration?(l(`${u} as current playlist is live`),!0):(l(`not ${u} as current playlist is live llhls, but currentTime isn't in buffered.`),!1);const h=Il(t,i),d=o?ju.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:ju.MAX_BUFFER_LOW_WATER_LINE;if(a<d)return l(`${u} as duration < max low water line (${a} < ${d})`),!0;const p=n.attributes.BANDWIDTH,f=e.attributes.BANDWIDTH;if(p<f&&(!o||h<s)){let e=`${u} as next bandwidth < current bandwidth (${p} < ${f})`;return o&&(e+=` and forwardBuffer < bufferHighWaterLine (${h} < ${s})`),l(e),!0}if((!o||p>f)&&h>=r){let e=`${u} as forwardBuffer >= bufferLowWaterLine (${h} >= ${r})`;return o&&(e+=` and next bandwidth > current bandwidth (${p} > ${f})`),l(e),!0}return l(`not ${u} as no switching criteria met`),!1}({buffered:this.tech_.buffered(),currentTime:i,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:n,bufferHighWaterLine:r,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const e=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const e=this.audioSegmentLoader_.pendingSegment_;if(!e||!e.segment||!e.segment.syncInfo)return;const t=e.segment.syncInfo.end+.01;this.tech_.setCurrentTime(t)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",e=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:10}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const e=this.getCodecsOrExclude_();e&&this.sourceUpdater_.addOrChangeSourceBuffers(e)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()});["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(e=>{this.mainSegmentLoader_.on(e,e=>{this.player_.trigger(ye({},e))}),this.audioSegmentLoader_.on(e,e=>{this.player_.trigger(ye({},e))}),this.subtitleSegmentLoader_.on(e,e=>{this.player_.trigger(ye({},e))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){e&&e===this.mainPlaylistLoader_.media()?this.logger_("skipping fastQualityChange because new media is same as old"):(this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0)}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const i=t.end(0);let n=i;if(e.start){const r=e.start.timeOffset;n=r<0?Math.max(i+r,t.start(0)):Math.min(i,r)}this.trigger("firstplay"),this.tech_.setCurrentTime(n)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,e=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;const i=Ih.Playlist.playlistEnd(e,t),n=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return i-n<=wl;const s=r.end(r.length-1);return s-n<=wl&&i-s<=wl}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:i}){if(e=e||this.mainPlaylistLoader_.media(),i=i||t.playlistExclusionDuration||this.playlistExclusionDuration,!e)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));e.playlistErrors_++;const n=this.mainPlaylistLoader_.main.playlists,r=n.filter(Vl),s=1===r.length&&r[0]===e;if(1===n.length&&i!==1/0)return dl.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(s);if(s){if(this.main().contentSteering){const t=this.pathwayAttribute_(e),i=1e3*this.contentSteeringController_.steeringManifest.ttl;return this.contentSteeringController_.excludePathway(t),this.excludeThenChangePathway_(),void setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(t)},i)}let t=!1;n.forEach(i=>{if(i===e)return;const n=i.excludeUntil;void 0!==n&&n!==1/0&&(t=!0,delete i.excludeUntil)}),t&&(dl.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let a;a=e.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*i,e.excludeUntil=a,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const o=this.selectPlaylist();if(!o)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");const l=t.internal?this.logger_:dl.log.warn,u=t.message?" "+t.message:"";l(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${u} Switching to playlist ${o.id}.`),o.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),o.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const c=o.targetDuration/2*1e3||5e3,h="number"==typeof o.lastRequest&&Date.now()-o.lastRequest<=c;return this.switchMedia_(o,"exclude",s||h)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const i=[],n="all"===e;(n||"main"===e)&&i.push(this.mainPlaylistLoader_);const r=[];(n||"audio"===e)&&r.push("AUDIO"),(n||"subtitle"===e)&&(r.push("CLOSED-CAPTIONS"),r.push("SUBTITLES")),r.forEach(e=>{const t=this.mediaTypes_[e]&&this.mediaTypes_[e].activePlaylistLoader;t&&i.push(t)}),["main","audio","subtitle"].forEach(t=>{const n=this[`${t}SegmentLoader_`];!n||e!==t&&"all"!==e||i.push(n)}),i.forEach(e=>t.forEach(t=>{"function"==typeof e[t]&&e[t]()}))}setCurrentTime(e){const t=Al(this.tech_.buffered(),e);return this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media()&&this.mainPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),void this.load()):0}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Ih.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const i=e.media();if(!i)return null;const n=this.syncController_.getMediaSequenceSync(t);if(n&&n.isReliable){const e=n.start,t=n.end;if(!isFinite(e)||!isFinite(t))return null;const r=Ih.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,i);return Tl([[e,Math.max(e,t-r)]])}const r=this.syncController_.getExpiredTime(i,this.duration());if(null===r)return null;const s=Ih.Playlist.seekable(i,r,Ih.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,i));return s.length?s:null}computeFinalSeekable_(e,t){if(!t)return e;const i=e.start(0),n=e.end(0),r=t.start(0),s=t.end(0);return r>n||i>s?e:Tl([[Math.max(i,r),Math.min(n,s)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const i=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_)return;if(i&&i.length&&this.seekable_.length&&i.start(0)===this.seekable_.start(0)&&i.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${Cl(this.seekable_)}]`);const n={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:n}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){const e=this.seekable();if(!e.length)return;return void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)))}const t=this.tech_.buffered();let i=Ih.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(i=Math.max(i,t.end(t.length-1))),this.mediaSource.duration!==i&&this.sourceUpdater_.setDuration(i)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const i in t)t[i].forEach(e=>{e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),i=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!i)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const i=lu(this.main(),t),n={},r=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(n.video=i.video||e.main.videoCodec||"avc1.4d400d"),e.main.isMuxed&&(n.video+=`,${i.audio||e.main.audioCodec||Ve}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||r)&&(n.audio=i.audio||e.main.audioCodec||e.audio.audioCodec||Ve,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!n.audio&&!n.video)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});const s=(e,t)=>e?je(t,this.usingManagedMediaSource_):ze(t),a={};let o;if(["video","audio"].forEach(function(t){if(n.hasOwnProperty(t)&&!s(e[t].isFmp4,n[t])){const i=e[t].isFmp4?"browser":"muxer";a[i]=a[i]||[],a[i].push(n[t]),"audio"===t&&(o=i)}}),r&&o&&t.attributes.AUDIO){const e=t.attributes.AUDIO;this.main().playlists.forEach(i=>{(i.attributes&&i.attributes.AUDIO)===e&&i!==t&&(i.excludeUntil=1/0)}),this.logger_(`excluding audio group ${e} as ${o} does not support codec(s): "${n.audio}"`)}if(Object.keys(a).length){const e=Object.keys(a).reduce((e,t)=>(e&&(e+=", "),e+=`${t} does not support codec(s): "${a[t].join(",")}"`),"")+".";return void this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:e},playlistExclusionDuration:1/0})}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const e=[];if(["video","audio"].forEach(t=>{const i=(Fe(this.sourceUpdater_.codecs[t]||"")[0]||{}).type,r=(Fe(n[t]||"")[0]||{}).type;i&&r&&i.toLowerCase()!==r.toLowerCase()&&e.push(`"${this.sourceUpdater_.codecs[t]}" -> "${n[t]}"`)}),e.length)return void this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${e.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0})}return n}tryToCreateSourceBuffers_(){if("open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers())return;if(!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(i=>{const n=e[i];if(-1!==t.indexOf(n.id))return;t.push(n.id);const r=lu(this.main,n),s=[];!r.audio||ze(r.audio)||je(r.audio,this.usingManagedMediaSource_)||s.push(`audio codec ${r.audio}`),!r.video||ze(r.video)||je(r.video,this.usingManagedMediaSource_)||s.push(`video codec ${r.video}`),r.text&&"stpp.ttml.im1t"===r.text&&s.push(`text codec ${r.text}`),s.length&&(n.excludeUntil=1/0,this.logger_(`excluding ${n.id} for unsupported: ${s.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],i=this.main().playlists,n=au(Fe(e)),r=ou(n),s=n.video&&Fe(n.video)[0]||null,a=n.audio&&Fe(n.audio)[0]||null;Object.keys(i).forEach(e=>{const n=i[e];if(-1!==t.indexOf(n.id)||n.excludeUntil===1/0)return;t.push(n.id);const o=[],l=lu(this.mainPlaylistLoader_.main,n),u=ou(l);if(l.audio||l.video){if(u!==r&&o.push(`codec count "${u}" !== "${r}"`),!this.sourceUpdater_.canChangeType()){const e=l.video&&Fe(l.video)[0]||null,t=l.audio&&Fe(l.audio)[0]||null;e&&s&&e.type.toLowerCase()!==s.type.toLowerCase()&&o.push(`video codec "${e.type}" !== "${s.type}"`),t&&a&&t.type.toLowerCase()!==a.type.toLowerCase()&&o.push(`audio codec "${t.type}" !== "${a.type}"`)}o.length&&(n.excludeUntil=1/0,this.logger_(`excluding ${n.id}: ${o.join(" && ")}`))}})}updateAdCues_(e){let t=0;const i=this.seekable();i.length&&(t=i.start(0)),function(e,t,i=0){if(!e.segments)return;let n,r=i;for(let s=0;s<e.segments.length;s++){const i=e.segments[s];if(n||(n=uh(t,r+i.duration/2)),n){if("cueIn"in i){n.endTime=r,n.adEndTime=r,r+=i.duration,n=null;continue}if(r<n.endTime){r+=i.duration;continue}n.endTime+=i.duration}else if("cueOut"in i&&(n=new N.VTTCue(r,r+i.duration,i.cueOut),n.adStartTime=r,n.adEndTime=r+parseFloat(i.cueOut),t.addCue(n)),"cueOutCont"in i){const[e,s]=i.cueOutCont.split("/").map(parseFloat);n=new N.VTTCue(r,r+i.duration,""),n.adStartTime=r-e,n.adEndTime=n.adStartTime+s,t.addCue(n)}r+=i.duration}}(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=ju.GOAL_BUFFER_LENGTH,i=ju.GOAL_BUFFER_LENGTH_RATE,n=Math.max(t,ju.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,n)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=ju.BUFFER_LOW_WATER_LINE,i=ju.BUFFER_LOW_WATER_LINE_RATE,n=Math.max(t,ju.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,ju.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,this.bufferBasedABR?r:n)}bufferHighWaterLine(){return ju.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){Cc(this.inbandTextTracks_,"com.apple.streaming",this.tech_),(({inbandTextTracks:e,dateRanges:t})=>{const i=e.metadataTrack_;if(!i)return;const n=N.WebKitDataCue||N.VTTCue;t.forEach(e=>{for(const t of Object.keys(e)){if(Ec.has(t))continue;const r=new n(e.startTime,e.endTime,"");r.id=e.id,r.type="com.apple.quicktime.HLS",r.value={key:Ac[t],data:e[t]},"scte35Out"!==t&&"scte35In"!==t||(r.value.data=new Uint8Array(r.value.data.match(/[\da-f]{2}/gi)).buffer),i.addCue(r)}e.processDateRange()})})({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,i){const n=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();Cc(this.inbandTextTracks_,e,this.tech_),xc({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:n,videoDuration:i})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart?this.contentSteeringController_.requestSteeringManifest(!0):this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this));["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(e=>{this.contentSteeringController_.on(e,e=>{this.trigger(ye({},e))})}),"dash"===this.sourceType_&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const e=this.main();(this.contentSteeringController_.didDASHTagChange(e.uri,e.contentSteering)||(()=>{const t=this.contentSteeringController_.getAvailablePathways(),i=[];for(const n of e.playlists){const e=n.attributes.serviceLocation;if(e&&(i.push(e),!t.has(e)))return!0}return!(i.length||!t.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const t=this.main().playlists,i=new Set;let n=!1;Object.keys(t).forEach(r=>{const s=t[r],a=this.pathwayAttribute_(s),o=a&&e!==a;s.excludeUntil===1/0&&"content-steering"===s.lastExcludeReason_&&!o&&(delete s.excludeUntil,delete s.lastExcludeReason_,n=!0);const l=!s.excludeUntil&&s.excludeUntil!==1/0;!i.has(s.id)&&o&&l&&(i.add(s.id),s.excludeUntil=1/0,s.lastExcludeReason_="content-steering",this.logger_(`excluding ${s.id} for ${s.lastExcludeReason_}`))}),"DASH"===this.contentSteeringController_.manifestType_&&Object.keys(this.mediaTypes_).forEach(t=>{const i=this.mediaTypes_[t];if(i.activePlaylistLoader){const t=i.activePlaylistLoader.media_;t&&t.attributes.serviceLocation!==e&&(n=!0)}}),n&&this.changeSegmentPathway_()}handlePathwayClones_(){const e=this.main().playlists,t=this.contentSteeringController_.currentPathwayClones,i=this.contentSteeringController_.nextPathwayClones;if(t&&t.size||i&&i.size){for(const[e,n]of t.entries()){i.get(e)||(this.mainPlaylistLoader_.updateOrDeleteClone(n),this.contentSteeringController_.excludePathway(e))}for(const[n,r]of i.entries()){const i=t.get(n);if(!i){e.filter(e=>e.attributes["PATHWAY-ID"]===r["BASE-ID"]).forEach(e=>{this.mainPlaylistLoader_.addClonePathway(r,e)}),this.contentSteeringController_.addAvailablePathway(n);continue}this.equalPathwayClones_(i,r)||(this.mainPlaylistLoader_.updateOrDeleteClone(r,!0),this.contentSteeringController_.addAvailablePathway(n))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...i])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const i=e["URI-REPLACEMENT"].PARAMS,n=t["URI-REPLACEMENT"].PARAMS;for(const r in i)if(i[r]!==n[r])return!1;for(const r in n)if(i[r]!==n[r])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),"DASH"===this.contentSteeringController_.manifestType_&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(i=>{const n=this.mainPlaylistLoader_.getKeyIdSet(i);n&&n.size&&n.forEach(n=>{const r="usable",s=this.keyStatusMap_.has(n)&&this.keyStatusMap_.get(n)===r,a=i.lastExcludeReason_===t&&i.excludeUntil===1/0;s?s&&a&&(delete i.excludeUntil,delete i.lastExcludeReason_,this.logger_(`enabling playlist ${i.id} because key ID ${n} is ${r}`)):(i.excludeUntil!==1/0&&i.lastExcludeReason_!==t&&(i.excludeUntil=1/0,i.lastExcludeReason_=t,this.logger_(`excluding playlist ${i.id} because the key ID ${n} doesn't exist in the keyStatusMap or is not ${r}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(e=>{const i=e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height<720,n=e.excludeUntil===1/0&&e.lastExcludeReason_===t;i&&n&&(delete e.excludeUntil,dl.log.warn(`enabling non-HD playlist ${e.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const i=("string"==typeof e?e:(e=>{const t=new Uint8Array(e);return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")})(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${i} added to the keyStatusMap`),this.keyStatusMap_.set(i,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}let Oh=class{constructor(e,t,i){const{playlistController_:n}=e,r=n.fastQualityChange_.bind(n);if(t.attributes){const e=t.attributes.RESOLUTION;this.width=e&&e.width,this.height=e&&e.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}var s,a,o;this.codecs=lu(n.main(),t),this.playlist=t,this.id=i,this.enabled=(s=e.playlists,a=t.id,o=r,e=>{const t=s.main.playlists[a],i=zl(t),n=Vl(t);if(void 0===e)return n;e?delete t.disabled:t.disabled=!0;const r={renditionInfo:{id:a,bandwidth:t.attributes.BANDWIDTH,resolution:t.attributes.RESOLUTION,codecs:t.attributes.CODECS},cause:"fast-quality"};return e===n||i||(e?(o(t),s.trigger({type:"renditionenabled",metadata:r})):s.trigger({type:"renditiondisabled",metadata:r})),e})}};const Rh=["seeking","seeked","pause","playing","error"];let Nh=class extends dl.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=_l("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),i=()=>this.monitorCurrentTime_(),n=()=>this.techWaiting_(),r=()=>this.resetTimeUpdate_(),s=this.playlistController_,a=["main","subtitle","audio"],o={};a.forEach(e=>{o[e]={reset:()=>this.resetSegmentDownloads_(e),updateend:()=>this.checkSegmentDownloads_(e)},s[`${e}SegmentLoader_`].on("appendsdone",o[e].updateend),s[`${e}SegmentLoader_`].on("playlistupdate",o[e].reset),this.tech_.on(["seeked","seeking"],o[e].reset)});const l=e=>{["main","audio"].forEach(t=>{s[`${t}SegmentLoader_`][e]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),l("off"))},this.clearSeekingAppendCheck_=()=>l("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),l("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",n),this.tech_.on(Rh,r),this.tech_.on("canplay",i),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",n),this.tech_.off(Rh,r),this.tech_.off("canplay",i),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),a.forEach(e=>{s[`${e}SegmentLoader_`].off("appendsdone",o[e].updateend),s[`${e}SegmentLoader_`].off("playlistupdate",o[e].reset),this.tech_.off(["seeked","seeking"],o[e].reset)}),this.checkCurrentTimeTimeout_&&N.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&N.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=N.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,i=t[`${e}SegmentLoader_`],n=i.buffered_(),r=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(let i=0;i<e.length;i++)if(e.start(i)!==t.start(i)||e.end(i)!==t.end(i))return!0;return!1}(this[`${e}Buffered_`],n);if(this[`${e}Buffered_`]=n,r){const i={bufferedRanges:n};return t.trigger({type:"bufferedrangeschanged",metadata:i}),void this.resetSegmentDownloads_(e)}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:i.playlist_&&i.playlist_.id,buffered:Ml(n)}),this[`${e}StalledDownloads_`]<10||(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),"subtitle"!==e&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+wl>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(Tl([this.lastRecordedTime,e]));const t={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:t}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const e=this.seekable(),t=this.tech_.currentTime();let i;if(this.afterSeekableWindow_(e,t,this.media(),this.allowSeeksWithinUnsafeLiveWindow)){i=e.end(e.length-1)}if(this.beforeSeekableWindow_(e,t)){const t=e.start(0);i=t+(t===e.end(0)?0:wl)}if(void 0!==i)return this.logger_(`Trying to seek outside of seekable at time ${t} with seekable range ${Cl(e)}. Seeking to ${i}.`),this.tech_.setCurrentTime(i),!0;const n=this.playlistController_.sourceUpdater_,r=this.tech_.buffered(),s=n.audioBuffer?n.audioBuffered():null,a=n.videoBuffer?n.videoBuffered():null,o=this.media(),l=o.partTargetDuration?o.partTargetDuration:2*(o.targetDuration-Sl),u=[s,a];for(let h=0;h<u.length;h++){if(!u[h])continue;if(Il(u[h],t)<l)return!1}const c=El(r,t);return 0!==c.length&&(i=c.start(0)+wl,this.logger_(`Buffered region starts (${c.start(0)})  just beyond seek point (${t}). Seeking to ${i}.`),this.tech_.setCurrentTime(i),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),i=Al(t,e);return i.length&&e+3<=i.end(0)?(this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${i.start(0)} -> ${i.end(0)}]. Attempting to resume playback by seeking to the current time.`),void this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"})):void 0}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const i=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${i}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(i),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const i=this.tech_.vhs.playlistController_.sourceUpdater_,n=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:i.audioBuffered(),videoBuffered:i.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const r=El(n,t);return r.length>0&&(this.logger_(`Stopped at ${t} and seeking to ${r.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0)}afterSeekableWindow_(e,t,i,n=!1){if(!e.length)return!1;let r=e.end(e.length-1)+wl;const s=!i.endList,a="number"==typeof i.partTargetDuration;return s&&(a||n)&&(r=e.end(e.length-1)+3*i.targetDuration),t>r}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:i}){if(!e)return;let n;if(e.length&&t.length){const r=Al(e,i-3),s=Al(e,i),a=Al(t,i);a.length&&!s.length&&r.length&&(n={start:r.end(0),end:a.end(0)})}else{El(e,i).length||(n=this.gapFromVideoUnderflow_(e,i))}return!!n&&(this.logger_(`Encountered a gap in video from ${n.start} to ${n.end}. Seeking to current time ${i}`),!0)}skipTheGap_(e){const t=this.tech_.buffered(),i=this.tech_.currentTime(),n=El(t,i);if(this.resetTimeUpdate_(),0===n.length||i!==e)return;this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",n.start(0)),this.tech_.setCurrentTime(n.start(0)+Sl);const r={gapInfo:{from:i,to:n.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:r}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const i=function(e){if(e.length<2)return Tl();const t=[];for(let i=1;i<e.length;i++){const n=e.end(i-1),r=e.start(i);t.push([n,r])}return Tl(t)}(e);for(let n=0;n<i.length;n++){const e=i.start(n),r=i.end(n);if(t-e<4&&t-e>2)return{start:e,end:r}}return null}};const Fh={errorInterval:30,getSource(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},Uh=function(e,t){let i=0,n=0;const r=bl(Fh,t);e.ready(()=>{e.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){n&&e.currentTime(n)},a=function(t){null!=t&&(n=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",s),e.src(t),e.trigger({type:"usage",name:"vhs-error-reload"}),e.play())},o=function(){if(Date.now()-i<1e3*r.errorInterval)e.trigger({type:"usage",name:"vhs-error-reload-canceled"});else{if(r.getSource&&"function"==typeof r.getSource)return i=Date.now(),r.getSource.call(e,a);dl.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function(){e.off("loadedmetadata",s),e.off("error",o),e.off("dispose",l)};e.on("error",o),e.on("dispose",l),e.reloadSourceOnError=function(t){l(),Uh(e,t)}},Bh=function(e){Uh(this,e)};var jh="3.17.0";const zh={PlaylistLoader:yu,Playlist:Xl,utils:Mu,STANDARD_PLAYLIST_SELECTOR:Sc,INITIAL_PLAYLIST_SELECTOR:function(){const e=this.playlists.main.playlists.filter(Xl.isEnabled);_c(e,(e,t)=>bc(e,t));return e.filter(e=>!!lu(this.playlists.main,e).video)[0]||null},lastBandwidthSelector:Sc,movingAverageBandwidthSelector:function(e){let t=-1,i=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let n=this.useDevicePixelRatio&&N.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(n=this.customPixelRatio),t<0&&(t=this.systemBandwidth,i=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==i&&(t=e*this.systemBandwidth+(1-e)*t,i=this.systemBandwidth),Tc({main:this.playlists.main,bandwidth:t,playerWidth:parseInt(vc(this.tech_.el(),"width"),10)*n,playerHeight:parseInt(vc(this.tech_.el(),"height"),10)*n,playerObjectFit:this.usePlayerObjectFit?vc(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},comparePlaylistBandwidth:bc,comparePlaylistResolution:function(e,t){let i,n;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(i=e.attributes.RESOLUTION.width),i=i||N.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(n=t.attributes.RESOLUTION.width),n=n||N.Number.MAX_VALUE,i===n&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:i-n},xhr:_u()};Object.keys(ju).forEach(e=>{Object.defineProperty(zh,e,{get:()=>(dl.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),ju[e]),set(t){dl.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),"number"!=typeof t||t<0?dl.log.warn(`value of Vhs.${e} must be greater than or equal to 0`):ju[e]=t}})});const Vh="videojs-vhs",Hh=function(e,t){const i=t.media();let n=-1;for(let r=0;r<e.length;r++)if(e[r].id===i.id){n=r;break}e.selectedIndex_=n,e.trigger({selectedIndex:n,type:"change"})};zh.canPlaySource=function(){return dl.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const qh=({player:e,sourceKeySystems:t,audioMedia:i,mainPlaylists:n})=>{if(!e.eme.initializeMediaKeys)return Promise.resolve();const r=((e,t)=>e.reduce((e,i)=>{if(!i.contentProtection)return e;const n=t.reduce((e,t)=>{const n=i.contentProtection[t];return n&&n.pssh&&(e[t]={pssh:n.pssh}),e},{});return Object.keys(n).length&&e.push(n),e},[]))(i?n.concat([i]):n,Object.keys(t)),s=[],a=[];return r.forEach(t=>{a.push(new Promise((t,i)=>{e.tech_.one("keysessioncreated",t)})),s.push(new Promise((i,n)=>{e.eme.initializeMediaKeys({keySystems:t},e=>{e?n(e):i()})}))}),Promise.race([Promise.all(s),Promise.race(a)])},Gh=({player:e,sourceKeySystems:t,media:i,audioMedia:n})=>{const r=((e,t,i)=>{if(!e)return e;let n={};t&&t.attributes&&t.attributes.CODECS&&(n=au(Fe(t.attributes.CODECS))),i&&i.attributes&&i.attributes.CODECS&&(n.audio=i.attributes.CODECS);const r=Be(n.video),s=Be(n.audio),a={};for(const o in e)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(a[o].pssh=t.contentProtection[o].pssh),"string"==typeof e[o]&&(a[o].url=e[o]);return bl(e,a)})(t,i,n);return!!r&&(e.currentSource().keySystems=r,!(r&&!e.eme)||(dl.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},Wh=()=>{if(!N.localStorage)return null;const e=N.localStorage.getItem(Vh);if(!e)return null;try{return JSON.parse(e)}catch(t){return null}},$h=(e,t)=>{e._requestCallbackSet||(e._requestCallbackSet=new Set),e._requestCallbackSet.add(t)},Xh=(e,t)=>{e._responseCallbackSet||(e._responseCallbackSet=new Set),e._responseCallbackSet.add(t)},Yh=(e,t)=>{e._requestCallbackSet&&(e._requestCallbackSet.delete(t),e._requestCallbackSet.size||delete e._requestCallbackSet)},Qh=(e,t)=>{e._responseCallbackSet&&(e._responseCallbackSet.delete(t),e._responseCallbackSet.size||delete e._responseCallbackSet)};zh.supportsNativeHls=function(){if(!z||!z.createElement)return!1;const e=z.createElement("video");if(!dl.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),zh.supportsNativeDash=!!(z&&z.createElement&&dl.getTech("Html5").isSupported())&&/maybe|probably/i.test(z.createElement("video").canPlayType("application/dash+xml")),zh.supportsTypeNatively=e=>"hls"===e?zh.supportsNativeHls:"dash"===e&&zh.supportsNativeDash,zh.isSupported=function(){return dl.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")},zh.xhr.onRequest=function(e){$h(zh.xhr,e)},zh.xhr.onResponse=function(e){Xh(zh.xhr,e)},zh.xhr.offRequest=function(e){Yh(zh.xhr,e)},zh.xhr.offResponse=function(e){Qh(zh.xhr,e)};const Kh=dl.getComponent("Component");let Zh=class extends Kh{constructor(e,t,i){if(super(t,i.vhs),"number"==typeof i.initialBandwidth&&(this.options_.bandwidth=i.initialBandwidth),this.logger_=_l("VhsHandler"),t.options_&&t.options_.playerId){const e=dl.getPlayer(t.options_.playerId);this.player_=e}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(z,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],e=>{const t=z.fullscreenElement||z.webkitFullscreenElement||z.mozFullScreenElement||z.msFullscreenElement;t&&t.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=bl(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=void 0===this.options_.useNetworkInformationApi||this.options_.useNetworkInformationApi,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=!1!==this.options_.llhls,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,"number"!=typeof this.options_.playlistExclusionDuration&&(this.options_.playlistExclusionDuration=60),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){const e=Wh();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=ju.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===ju.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(e=>{void 0!==this.source_[e]&&(this.options_[e]=this.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;"number"==typeof t&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;var i;this.setOptions_(),this.options_.src=0===(i=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(i.substring(i.indexOf(",")+1)):i,this.options_.tech=this.tech_,this.options_.externVhs=zh,this.options_.sourceType=Ge(t),this.options_.seekTo=e=>{this.tech_.setCurrentTime(e)},this.options_.player_=this.player_,this.playlistController_=new Dh(this.options_);const n=bl({liveRangeSafeTimeDelta:wl},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new Nh(n),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const e=dl.players[this.tech_.options_.playerId];let t=this.playlistController_.error;"object"!=typeof t||t.code?"string"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)});const r=this.options_.bufferBasedABR?zh.movingAverageBandwidthSelector(.55):zh.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=zh.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(e){this.playlistController_.selectPlaylist=e.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(e){this.playlistController_.mainSegmentLoader_.throughput.rate=e,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let e=this.playlistController_.mainSegmentLoader_.bandwidth;const t=N.navigator.connection||N.navigator.mozConnection||N.navigator.webkitConnection,i=1e7;if(this.options_.useNetworkInformationApi&&t){const n=1e3*t.downlink*1e3;e=n>=i&&e>=i?Math.max(e,n):n}return e},set(e){this.playlistController_.mainSegmentLoader_.bandwidth=e,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const e=1/(this.bandwidth||1);let t;t=this.throughput>0?1/this.throughput:0;return Math.floor(1/(e+t))},set(){dl.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>Ml(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>Ml(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&(e=>{if(!N.localStorage)return!1;let t=Wh();t=t?bl(t,e):e;try{N.localStorage.setItem(Vh,JSON.stringify(t))}catch(i){return!1}})({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{var e;(e=this).representations=()=>{const t=e.playlistController_.main(),i=$l(t)?e.playlistController_.getAudioTrackPlaylists_():t.playlists;return i?i.filter(e=>!zl(e)).map((t,i)=>new Oh(e,t,t.id)):[]}}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=N.URL.createObjectURL(this.playlistController_.mediaSource),(dl.browser.IS_ANY_SAFARI||dl.browser.IS_IOS)&&this.options_.overrideNative&&"hls"===this.options_.sourceType&&"function"==typeof this.tech_.addSourceElement?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),qh({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(e=>{this.logger_("error while creating EME key session",e),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=Gh({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on("keystatuschange",e=>{this.playlistController_.updatePlaylistByKeyStatus(e.keyId,e.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),t?this.createKeySessions_():this.playlistController_.sourceUpdater_.initializedEme()}setupQualityLevels_(){const e=dl.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{var e,t;e=this.qualityLevels_,(t=this).representations().forEach(t=>{e.addQualityLevel(t)}),Hh(e,t.playlists)}),this.playlists.on("mediachange",()=>{Hh(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":jh,"mux.js":"7.1.0","mpd-parser":"1.3.1","m3u8-parser":"7.2.0","aes-decrypter":"4.0.2"}}version(){return this.constructor.version()}canChangeType(){return rh.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&N.URL.revokeObjectURL&&(N.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return ku({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,i=!0,n=2){return Iu({programTime:e,playlist:this.playlistController_.media(),retryCount:n,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{$h(this.xhr,e)},this.xhr.onResponse=e=>{Xh(this.xhr,e)},this.xhr.offRequest=e=>{Yh(this.xhr,e)},this.xhr.offResponse=e=>{Qh(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(e=>{this.playlistController_.on(e,e=>{this.player_.trigger(ye({},e))})}),["gapjumped","playedrangeschanged"].forEach(e=>{this.playbackWatcher_.on(e,e=>{this.player_.trigger(ye({},e))})})}};const Jh={name:"videojs-http-streaming",VERSION:jh,canHandleSource(e,t={}){const i=bl(dl.options,t);return!(!i.vhs.experimentalUseMMS&&!je("avc1.4d400d,mp4a.40.2",!1))&&Jh.canPlayType(e.type,i)},handleSource(e,t,i={}){const n=bl(dl.options,i);return t.vhs=new Zh(e,t,n),t.vhs.xhr=_u(),t.vhs.setupXhrHooks_(),t.vhs.src(e.src,e.type),t.vhs},canPlayType(e,t){const i=Ge(e);if(!i)return"";const n=Jh.getOverrideNative(t);return!zh.supportsTypeNatively(i)||n?"maybe":""},getOverrideNative(e={}){const{vhs:t={}}=e,i=!(dl.browser.IS_ANY_SAFARI||dl.browser.IS_IOS),{overrideNative:n=i}=t;return n}};je("avc1.4d400d,mp4a.40.2",!0)&&dl.getTech("Html5").registerSourceHandler(Jh,0),dl.VhsHandler=Zh,dl.VhsSourceHandler=Jh,dl.Vhs=zh,dl.use||dl.registerComponent("Vhs",zh),dl.options.vhs=dl.options.vhs||{},dl.getPlugin&&dl.getPlugin("reloadSourceOnError")||dl.registerPlugin("reloadSourceOnError",Bh);var ed=Object.defineProperty,td=(e,t,i)=>((e,t,i)=>t in e?ed(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let id=null,nd=null;class rd extends p.Component{constructor(e){super(e),td(this,"handlePlaylistPropsChange",()=>{this.player&&this.isPlayerReady&&this.updatePlaylistFromProps()}),td(this,"updatePlaylistFromProps",async()=>{var e,t,i,n,r,s;if(!this.player||!this.isPlayerReady||"function"!=typeof this.player.playlist)return;const a=this.props.playlist||[];if(0===a.length)return this.player.playlist([]),void(null==(e=this.notify)||e.call(this,"status:media",{message:"Playlist cleared",type:"info"}));try{null==(t=this.notify)||t.call(this,"status:media",{message:`Updating Video.js playlist: ${a.length} items`,type:"log"});const e=this.filterForVideojs(a);this.player.playlist(e),-1===this.player.playlist.currentItem()&&this.player.playlist.currentItem(0),null==(i=this.notify)||i.call(this,"status:media",{message:"Video.js playlist updated successfully",type:"success"}),this._triggerRender()}catch(o){null==(n=this.notify)||n.call(this,"status:media",{message:"Failed to update Video.js playlist",type:"error",error:o.message}),null==(s=(r=this.props).onError)||s.call(r,o)}}),td(this,"_hasValidPlaylist",()=>{const e=this.props.playlist;return e&&e.length>0}),td(this,"_triggerRender",()=>{this.setState(e=>({renderTrigger:e.renderTrigger+1}))}),td(this,"_isPlaylistMode",()=>this.player&&"function"==typeof this.player.playlist&&this.player.playlist().length>0),td(this,"initPlaylistPlugin",async()=>{var e,t,i,n;if(this.player&&!this.isDestroyed)try{null==(e=this.notify)||e.call(this,"status:media",{message:"Loading Video.js playlist plugin...",type:"log"});const n=await(async()=>{if(!nd)try{return nd=await Promise.resolve().then(()=>tE),nd}catch(e){return null}return nd})();if(!n)return void(null==(t=this.notify)||t.call(this,"status:media",{message:"Playlist plugin not available, skipping",type:"info"}));if("function"!=typeof this.player.playlist&&n.default&&dl.registerPlugin("playlist",n.default),"function"!=typeof this.player.playlist)throw new Error("Playlist plugin failed to register");this.player.on("playlistchange",this.handlePlaylistChange),this.player.on("playlistitem",this.handlePlaylistItem),null==(i=this.notify)||i.call(this,"status:media",{message:"Video.js playlist plugin loaded successfully",type:"success"})}catch(r){throw null==(n=this.notify)||n.call(this,"status:media",{message:"Playlist plugin initialization failed",type:"error",error:r.message}),r}}),td(this,"filterForVideojs",e=>e.map(e=>{const{funscript:t,...i}=e;return i})),td(this,"handlePlaylistChange",()=>{var e;null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js playlist changed",type:"log"}),this._triggerRender(),this.updatePlaylistButtons()}),td(this,"handlePlaylistItem",()=>{setTimeout(()=>{var e,t,i;const n=this.player.playlist.currentItem();null==(e=this.notify)||e.call(this,"status:media",{message:`Video.js switched to item ${n}`,type:"log"}),null==(i=(t=this.props).onPlaylistItemChange)||i.call(t,n),setTimeout(()=>{const e=this.getCurrentPlaylistItem();e&&e.poster&&this.player.poster(e.poster)},100),this.updatePlaylistButtons()},0)}),td(this,"getCurrentPlaylistItem",()=>{if(!this._isPlaylistMode())return null;const e=this.player.playlist.currentItem(),t=this.player.playlist();return e>=0&&e<t.length?t[e]:null}),td(this,"goToPlaylistItem",e=>{var t,i,n;if(!this._isPlaylistMode())return!1;try{const n=this.player.playlist();return e<0||e>=n.length?(null==(t=this.notify)||t.call(this,"status:media",{message:`Invalid playlist index: ${e}`,type:"error"}),!1):(this.player.playlist.currentItem(e),null==(i=this.notify)||i.call(this,"status:media",{message:`Navigated to playlist item ${e}`,type:"log"}),setTimeout(()=>{var t;const i=this.player.playlist.currentItem();i!==e&&(null==(t=this.notify)||t.call(this,"status:media",{message:`Navigation mismatch: requested ${e}, got ${i}`,type:"error"}))},10),!0)}catch(r){return null==(n=this.notify)||n.call(this,"status:media",{message:`Failed to navigate to playlist item ${e}`,type:"error",error:r.message}),!1}}),td(this,"handleNext",()=>{var e;this._isPlaylistMode()&&(this.player.playlist.next(),null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js playlist: next item",type:"log"}))}),td(this,"handlePrevious",()=>{var e;this._isPlaylistMode()&&(this.player.playlist.previous(),null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js playlist: previous item",type:"log"}))}),td(this,"getPlaylistInfo",()=>{if(!this._isPlaylistMode())return{hasPlaylist:!1,currentIndex:-1,totalItems:0};const e=this.player.playlist.currentItem(),t=this.player.playlist().length;return{hasPlaylist:!0,currentIndex:e,totalItems:t,canNext:e<t-1,canPrevious:e>0}}),td(this,"registerPlaylistComponents",()=>{var e;const t=dl.getComponent("Button");dl.registerComponent("PreviousButton",class extends t{constructor(e,t){super(e,t),this.controlText("Previous item")}handleClick(){this.player().playlist&&this.player().playlist.previous()}createEl(){const e=super.createEl("button",{className:"vjs-previous-button vjs-control vjs-button"});return e.innerHTML='<span aria-hidden="true"></span>',e.title="Previous item",e}}),dl.registerComponent("NextButton",class extends t{constructor(e,t){super(e,t),this.controlText("Next item")}handleClick(){this.player().playlist&&this.player().playlist.next()}createEl(){const e=super.createEl("button",{className:"vjs-next-button vjs-control vjs-button"});return e.innerHTML='<span aria-hidden="true"></span>',e.title="Next item",e}}),null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js playlist control buttons registered",type:"log"})}),td(this,"updatePlaylistButtons",()=>{if(!this.player)return;const e=this.player.getChild("controlBar");if(!e)return;const t=e.getChild("PreviousButton"),i=e.getChild("NextButton"),n=this.getPlaylistInfo();t&&(t.el().disabled=!n.canPrevious,t.el().style.opacity=n.canPrevious?"1":"0.3"),i&&(i.el().disabled=!n.canNext,i.el().style.opacity=n.canNext?"1":"0.3")}),td(this,"initPlayer",async()=>{var e,t,i,n,r,s;if(!(this.isDestroyed||this.isInitialized||this.isInitializing))if(null==(e=this.videoRef)?void 0:e.current){this.isInitializing=!0,null==(i=this.notify)||i.call(this,"status:media",{message:"Initializing Video.js player...",type:"processing"});try{const e=this.videoRef.current;this.registerPlaylistComponents();const t={controls:!0,responsive:!0,fluid:!0,playsinline:!0,preload:"metadata",techOrder:["html5"],html5:{vhs:{overrideNative:!1}},controlBar:{children:["playToggle","currentTimeDisplay","timeDivider","durationDisplay","progressControl","PreviousButton","NextButton","volumePanel","fullscreenToggle"]}};if(this.player=dl(e,t),!this.player)throw new Error("Failed to create Video.js player instance");this.player.ready(()=>{var e;this.isDestroyed||(this.isPlayerReady=!0,this.isInitialized=!0,this.isInitializing=!1,null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js player ready",type:"success"}),this.initPlugins().then(()=>{var e;this.setupCallbacks(),null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js player initialization complete",type:"success"}),this._triggerRender()}).catch(e=>{var t,i,n;null==(t=this.notify)||t.call(this,"status:media",{message:"Plugin initialization failed",type:"error",error:e.message}),null==(n=(i=this.props).onError)||n.call(i,e)}))})}catch(a){null==(n=this.notify)||n.call(this,"status:media",{message:"Failed to initialize Video.js player",type:"error",error:a.message}),this.isInitializing=!1,null==(s=(r=this.props).onError)||s.call(r,a)}}else null==(t=this.notify)||t.call(this,"status:media",{message:"Video element not available for initialization",type:"error"})}),td(this,"initPlugins",async()=>{var e,t,i,n,r,s,a;if(!this.isDestroyed&&this.player)try{null==(e=this.notify)||e.call(this,"status:media",{message:"Loading Video.js plugins...",type:"processing"});const[a,o]=await Promise.allSettled([this.initVRPlugin(),this.initPlaylistPlugin()]);"rejected"===a.status&&(null==(i=this.notify)||i.call(this,"status:media",{message:"VR plugin initialization failed",type:"log",error:null==(t=a.reason)?void 0:t.message})),"rejected"===o.status&&(null==(r=this.notify)||r.call(this,"status:media",{message:"Playlist plugin initialization failed",type:"error",error:null==(n=o.reason)?void 0:n.message})),this._hasValidPlaylist()&&await this.updatePlaylistFromProps(),null==(s=this.notify)||s.call(this,"status:media",{message:"Video.js plugins loaded",type:"success"})}catch(o){throw null==(a=this.notify)||a.call(this,"status:media",{message:"Plugin initialization error",type:"error",error:o.message}),o}}),td(this,"initVRPlugin",async()=>{var e,t,i,n;if(this.player&&!this.isDestroyed)try{null==(e=this.notify)||e.call(this,"status:media",{message:"Loading Video.js VR plugin...",type:"log"});const n=await(async()=>{if(!id)try{return id=await Promise.resolve().then(()=>qA),await Promise.resolve().then(()=>GA),id}catch(e){return null}return id})();if(!n)return void(null==(t=this.notify)||t.call(this,"status:media",{message:"VR plugin not available",type:"info"}));if("function"==typeof this.player.vr)return void this.configureVRPlugin();if(!dl.getPlugin("vr")&&n.default){const e=function(e={}){return new n.default(this,e)};dl.registerPlugin("vr",e)}this.configureVRPlugin(),null==(i=this.notify)||i.call(this,"status:media",{message:"VR plugin loaded successfully",type:"success"})}catch(r){null==(n=this.notify)||n.call(this,"status:media",{message:"VR plugin initialization failed",type:"log",error:r.message})}}),td(this,"configureVRPlugin",()=>{var e,t;if(this.player&&!this.isDestroyed)try{this.player.mediainfo||(this.player.mediainfo={}),this.player.vr({projection:"AUTO",debug:!1,forceCardboard:!1}),null==(e=this.notify)||e.call(this,"status:media",{message:"VR plugin configured",type:"log"})}catch(i){null==(t=this.notify)||t.call(this,"status:media",{message:"VR configuration failed",type:"log",error:i.message})}}),td(this,"setupCallbacks",()=>{this.player&&(this.player.on("error",e=>{var t,i,n;null==(t=this.notify)||t.call(this,"status:media",{message:"Video.js player error occurred",type:"error",error:(null==e?void 0:e.message)||"Unknown Video.js error"}),null==(n=(i=this.props).onError)||n.call(i,e)}),this.player.on("play",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:`Playback started at ${n.toFixed(1)}s`,type:"log"}),this.updatePlaylistButtons(),null==(i=(t=this.props).onPlay)||i.call(t,{currentTime:n})}),this.player.on("pause",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:`Playback paused at ${n.toFixed(1)}s`,type:"log"}),null==(i=(t=this.props).onPause)||i.call(t,{currentTime:n})}),this.player.on("ended",()=>{var e,t,i;null==(e=this.notify)||e.call(this,"status:media",{message:"Media playback ended",type:"info"}),null==(i=(t=this.props).onEnded)||i.call(t,{currentTime:0})}),this.player.on("seeking",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:`Seeking to ${n.toFixed(1)}s`,type:"log"}),null==(i=(t=this.props).onSeeking)||i.call(t,{currentTime:n})}),this.player.on("seeked",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:`Seeked to ${n.toFixed(1)}s`,type:"log"}),null==(i=(t=this.props).onSeeked)||i.call(t,{currentTime:n})}),this.player.on("timeupdate",()=>{var e,t;const i=this.player.currentTime()||0;null==(t=(e=this.props).onTimeUpdate)||t.call(e,{currentTime:i})}),this.player.on("durationchange",()=>{var e,t,i;const n=this.player.duration()||0;null==(e=this.notify)||e.call(this,"status:media",{message:`Duration changed: ${n.toFixed(1)}s`,type:"log"}),null==(i=(t=this.props).onDurationChange)||i.call(t,{duration:n})}),this.player.on("loadstart",()=>{var e,t,i;null==(e=this.notify)||e.call(this,"status:media",{message:"Media loading started",type:"log"}),null==(i=(t=this.props).onLoadStart)||i.call(t,{})}),this.player.on("loadeddata",()=>{var e,t,i;const n=this.player.duration()||0;null==(e=this.notify)||e.call(this,"status:media",{message:"Media data loaded",type:"log"}),null==(i=(t=this.props).onLoadedData)||i.call(t,{duration:n})}),this.player.on("loadedmetadata",()=>{var e,t,i;const n=this.player.duration()||0;null==(e=this.notify)||e.call(this,"status:media",{message:`Media loaded: ${n.toFixed(1)}s duration`,type:"success"}),this.updatePlaylistButtons(),this._triggerRender(),null==(i=(t=this.props).onLoadedMetadata)||i.call(t,{duration:n,type:this._isPlaylistMode()?"playlist":"media"})}),this.player.on("canplay",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:"Media ready to play",type:"log"}),null==(i=(t=this.props).onCanPlay)||i.call(t,{currentTime:n})}),this.player.on("canplaythrough",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:"Media can play through",type:"log"}),null==(i=(t=this.props).onCanPlayThrough)||i.call(t,{currentTime:n})}),this.player.on("waiting",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:"Media buffering...",type:"log"}),null==(i=(t=this.props).onWaiting)||i.call(t,{currentTime:n})}),this.player.on("stalled",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:"Media connection stalled",type:"warning"}),null==(i=(t=this.props).onStalled)||i.call(t,{currentTime:n})}),this.player.on("suspend",()=>{var e,t,i;const n=this.player.currentTime()||0;null==(e=this.notify)||e.call(this,"status:media",{message:"Media loading suspended",type:"log"}),null==(i=(t=this.props).onSuspend)||i.call(t,{currentTime:n})}),this.player.on("volumechange",()=>{var e,t,i;const n=this.player.volume(),r=this.player.muted();null==(e=this.notify)||e.call(this,"status:media",{message:"Volume: "+(r?"muted":Math.round(100*n)+"%"),type:"log"}),null==(i=(t=this.props).onVolumeChange)||i.call(t,{volume:n,muted:r})}),this.player.on("error",e=>{var t,i,n;null==(t=this.notify)||t.call(this,"status:media",{message:"Video.js player error occurred",type:"error",error:(null==e?void 0:e.message)||"Unknown Video.js error"}),null==(n=(i=this.props).onError)||n.call(i,e)}),this.player.on("resize",()=>{var e,t,i;const n={width:this.player.currentWidth(),height:this.player.currentHeight()};null==(e=this.notify)||e.call(this,"status:media",{message:`Player resized: ${n.width}x${n.height}`,type:"log"}),null==(i=(t=this.props).onResize)||i.call(t,n)}),this.player.playlist&&this.player.on("playlistitem",e=>{var t,i,n;const r=this.player.playlist.currentItem(),s=this.player.playlist().length;null==(t=this.notify)||t.call(this,"status:media",{message:`Playlist item changed: ${r+1}/${s}`,type:"info"}),this.updatePlaylistButtons(),this._triggerRender(),null==(n=(i=this.props).onPlaylistItemChange)||n.call(i,{index:r,total:s,item:this.player.playlist()[r]})}))}),td(this,"cleanup",()=>{var e,t;if(this.isDestroyed=!0,this.isInitialized=!1,this.isInitializing=!1,this.player)try{this.player.paused()||this.player.pause(),"function"==typeof this.player.dispose&&this.player.dispose(),null==(e=this.notify)||e.call(this,"status:media",{message:"Video.js player disposed",type:"log"})}catch(i){null==(t=this.notify)||t.call(this,"status:media",{message:"Error during player cleanup",type:"error",error:i.message})}finally{this.player=null,this.isPlayerReady=!1,this.initRetries=0,this.setState({renderTrigger:0})}}),td(this,"play",()=>{var e;return null==(e=this.player)?void 0:e.play()}),td(this,"pause",()=>{var e;return null==(e=this.player)?void 0:e.pause()}),td(this,"stop",()=>{var e,t;null==(e=this.player)||e.pause(),null==(t=this.player)||t.currentTime(0)}),td(this,"seek",e=>{var t;return null==(t=this.player)?void 0:t.currentTime(e)}),td(this,"getTime",()=>{var e;return(null==(e=this.player)?void 0:e.currentTime())||0}),td(this,"getDuration",()=>{var e;return(null==(e=this.player)?void 0:e.duration())||0}),td(this,"isPlaying",()=>!!this.player&&!this.player.paused()),td(this,"nextItem",()=>this.handleNext()),td(this,"previousItem",()=>this.handlePrevious()),td(this,"goToItem",e=>this.goToPlaylistItem(e)),td(this,"getCurrentItem",()=>this.getCurrentPlaylistItem()),td(this,"getPlaylist",()=>this._isPlaylistMode()?this.player.playlist():[]),td(this,"getState",()=>({currentTime:this.getTime(),duration:this.getDuration(),isPlaying:this.isPlaying(),mediaType:this._isPlaylistMode()?"playlist":"media",playlistInfo:this.getPlaylistInfo()})),this.videoRef=f.createRef(),this.player=null,this.isPlayerReady=!1,this.initRetries=0,this.maxRetries=3,this.state={renderTrigger:0},this.isInitialized=!1,this.isInitializing=!1,this.isDestroyed=!1,this.notify=e.notify}componentDidMount(){this.isDestroyed=!1,this.isInitialized=!1,this.isInitializing=!1;!this._hasValidPlaylist()||this.isInitialized||this.isInitializing||setTimeout(()=>{this.isDestroyed||this.initPlayer()},50)}componentDidUpdate(e){if(this.isDestroyed)return;if(e.playlist===this.props.playlist)return;this.handlePlaylistPropsChange();!this._hasValidPlaylist()||this.isInitialized||this.isInitializing||setTimeout(()=>{this.isDestroyed||this.initPlayer()},50)}componentWillUnmount(){this.cleanup()}render(){const e=this._hasValidPlaylist();return O.jsx("div",{className:"fp-media-player",children:e?O.jsx("video",{ref:this.videoRef,className:"video-js vjs-default-skin fp-media-player-video",playsInline:!0,"data-setup":"{}"}):O.jsx("div",{className:"fp-media-player-placeholder",children:" No media loaded"})})}}var sd,ad,od={},ld={},ud={},cd={exports:{}};function hd(){return sd||(sd=1,function(e){var t=Object.prototype.hasOwnProperty,i="~";function n(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,n,s,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new r(n,s||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),o.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,a=new Array(s);r<s;r++)a[r]=n[r].fn;return a},o.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,r,s,a){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,s),!0;case 6:return c.fn.call(c.context,t,n,r,s,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,r);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,n,r){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||a(this,s);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}(cd)),cd.exports}function dd(){if(ad)return ud;ad=1,Object.defineProperty(ud,"__esModule",{value:!0}),ud.ButtplugLogger=ud.LogMessage=ud.ButtplugLogLevel=void 0;const e=hd();var t,i;(i=t||(ud.ButtplugLogLevel=t={}))[i.Off=0]="Off",i[i.Error=1]="Error",i[i.Warn=2]="Warn",i[i.Info=3]="Info",i[i.Debug=4]="Debug",i[i.Trace=5]="Trace";class n{constructor(e,t){const i=new Date,n=i.getHours(),r=i.getMinutes(),s=i.getSeconds();this.timestamp=`${n}:${r}:${s}`,this.logMessage=e,this.logLevel=t}get Message(){return this.logMessage}get LogLevel(){return this.logLevel}get Timestamp(){return this.timestamp}get FormattedMessage(){return`${t[this.logLevel]} : ${this.timestamp} : ${this.logMessage}`}}ud.LogMessage=n;class r extends e.EventEmitter{static get Logger(){return void 0===r.sLogger&&(r.sLogger=new r),this.sLogger}constructor(){super(),this.maximumConsoleLogLevel=t.Off,this.maximumEventLogLevel=t.Off}get MaximumConsoleLogLevel(){return this.maximumConsoleLogLevel}set MaximumConsoleLogLevel(e){this.maximumConsoleLogLevel=e}get MaximumEventLogLevel(){return this.maximumEventLogLevel}set MaximumEventLogLevel(e){this.maximumEventLogLevel=e}Error(e){this.AddLogMessage(e,t.Error)}Warn(e){this.AddLogMessage(e,t.Warn)}Info(e){this.AddLogMessage(e,t.Info)}Debug(e){this.AddLogMessage(e,t.Debug)}Trace(e){this.AddLogMessage(e,t.Trace)}AddLogMessage(e,t){if(t>this.maximumEventLogLevel&&t>this.maximumConsoleLogLevel)return;const i=new n(e,t);this.maximumConsoleLogLevel,t<=this.maximumEventLogLevel&&this.emit("log",i)}}return ud.ButtplugLogger=r,r.sLogger=void 0,ud}var pd,fd,md={},gd={};(fd=pd||(pd={}))[fd.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",fd[fd.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",fd[fd.CLASS_TO_CLASS=2]="CLASS_TO_CLASS";var yd=new(function(){function e(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return e.prototype.addTypeMetadata=function(e){this._typeMetadatas.has(e.target)||this._typeMetadatas.set(e.target,new Map),this._typeMetadatas.get(e.target).set(e.propertyName,e)},e.prototype.addTransformMetadata=function(e){this._transformMetadatas.has(e.target)||this._transformMetadatas.set(e.target,new Map),this._transformMetadatas.get(e.target).has(e.propertyName)||this._transformMetadatas.get(e.target).set(e.propertyName,[]),this._transformMetadatas.get(e.target).get(e.propertyName).push(e)},e.prototype.addExposeMetadata=function(e){this._exposeMetadatas.has(e.target)||this._exposeMetadatas.set(e.target,new Map),this._exposeMetadatas.get(e.target).set(e.propertyName,e)},e.prototype.addExcludeMetadata=function(e){this._excludeMetadatas.has(e.target)||this._excludeMetadatas.set(e.target,new Map),this._excludeMetadatas.get(e.target).set(e.propertyName,e)},e.prototype.findTransformMetadatas=function(e,t,i){return this.findMetadatas(this._transformMetadatas,e,t).filter(function(e){return!e.options||(!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?i===pd.CLASS_TO_CLASS||i===pd.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||i===pd.CLASS_TO_PLAIN))})},e.prototype.findExcludeMetadata=function(e,t){return this.findMetadata(this._excludeMetadatas,e,t)},e.prototype.findExposeMetadata=function(e,t){return this.findMetadata(this._exposeMetadatas,e,t)},e.prototype.findExposeMetadataByCustomName=function(e,t){return this.getExposedMetadatas(e).find(function(e){return e.options&&e.options.name===t})},e.prototype.findTypeMetadata=function(e,t){return this.findMetadata(this._typeMetadatas,e,t)},e.prototype.getStrategy=function(e){var t=this._excludeMetadatas.get(e),i=t&&t.get(void 0),n=this._exposeMetadatas.get(e),r=n&&n.get(void 0);return i&&r||!i&&!r?"none":i?"excludeAll":"exposeAll"},e.prototype.getExposedMetadatas=function(e){return this.getMetadata(this._exposeMetadatas,e)},e.prototype.getExcludedMetadatas=function(e){return this.getMetadata(this._excludeMetadatas,e)},e.prototype.getExposedProperties=function(e,t){return this.getExposedMetadatas(e).filter(function(e){return!e.options||(!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?t===pd.CLASS_TO_CLASS||t===pd.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||t===pd.CLASS_TO_PLAIN))}).map(function(e){return e.propertyName})},e.prototype.getExcludedProperties=function(e,t){return this.getExcludedMetadatas(e).filter(function(e){return!e.options||(!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?t===pd.CLASS_TO_CLASS||t===pd.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||t===pd.CLASS_TO_PLAIN))}).map(function(e){return e.propertyName})},e.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},e.prototype.getMetadata=function(e,t){var i,n=e.get(t);n&&(i=Array.from(n.values()).filter(function(e){return void 0!==e.propertyName}));for(var r=[],s=0,a=this.getAncestors(t);s<a.length;s++){var o=a[s],l=e.get(o);if(l){var u=Array.from(l.values()).filter(function(e){return void 0!==e.propertyName});r.push.apply(r,u)}}return r.concat(i||[])},e.prototype.findMetadata=function(e,t,i){var n=e.get(t);if(n){var r=n.get(i);if(r)return r}for(var s=0,a=this.getAncestors(t);s<a.length;s++){var o=a[s],l=e.get(o);if(l){var u=l.get(i);if(u)return u}}},e.prototype.findMetadatas=function(e,t,i){var n,r=e.get(t);r&&(n=r.get(i));for(var s=[],a=0,o=this.getAncestors(t);a<o.length;a++){var l=o[a],u=e.get(l);u&&u.has(i)&&s.push.apply(s,u.get(i))}return s.slice().reverse().concat((n||[]).slice().reverse())},e.prototype.getAncestors=function(e){if(!e)return[];if(!this._ancestorsMap.has(e)){for(var t=[],i=Object.getPrototypeOf(e.prototype.constructor);void 0!==i.prototype;i=Object.getPrototypeOf(i.prototype.constructor))t.push(i);this._ancestorsMap.set(e,t)}return this._ancestorsMap.get(e)},e}());var vd=function(e,t,i){if(i||2===arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))};var _d=function(){function e(e,t){this.transformationType=e,this.options=t,this.recursionStack=new Set}return e.prototype.transform=function(e,t,i,n,r,s){var a,o=this;if(void 0===s&&(s=0),Array.isArray(t)||t instanceof Set){var l=n&&this.transformationType===pd.PLAIN_TO_CLASS?function(e){var t=new e;return t instanceof Set||"push"in t?t:[]}(n):[];return t.forEach(function(t,n){var r=e?e[n]:void 0;if(o.options.enableCircularCheck&&o.isCircular(t))o.transformationType===pd.CLASS_TO_CLASS&&(l instanceof Set?l.add(t):l.push(t));else{var a=void 0;if("function"!=typeof i&&i&&i.options&&i.options.discriminator&&i.options.discriminator.property&&i.options.discriminator.subTypes){if(o.transformationType===pd.PLAIN_TO_CLASS){a=i.options.discriminator.subTypes.find(function(e){return e.name===t[i.options.discriminator.property]});var u={newObject:l,object:t,property:void 0},c=i.typeFunction(u);a=void 0===a?c:a.value,i.options.keepDiscriminatorProperty||delete t[i.options.discriminator.property]}o.transformationType===pd.CLASS_TO_CLASS&&(a=t.constructor),o.transformationType===pd.CLASS_TO_PLAIN&&(t[i.options.discriminator.property]=i.options.discriminator.subTypes.find(function(e){return e.value===t.constructor}).name)}else a=i;var h=o.transform(r,t,a,void 0,t instanceof Map,s+1);l instanceof Set?l.add(h):l.push(h)}}),l}if(i!==String||r){if(i!==Number||r){if(i!==Boolean||r){if((i===Date||t instanceof Date)&&!r)return t instanceof Date?new Date(t.valueOf()):null==t?t:new Date(t);if(("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(i===Buffer||t instanceof Buffer)&&!r)return null==t?t:Buffer.from(t);if(null===(a=t)||"object"!=typeof a||"function"!=typeof a.then||r){if(r||null===t||"object"!=typeof t||"function"!=typeof t.then){if("object"==typeof t&&null!==t){i||t.constructor===Object||(Array.isArray(t)||t.constructor!==Array)&&(i=t.constructor),!i&&e&&(i=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(t);var u=this.getKeys(i,t,r),c=e||{};e||this.transformationType!==pd.PLAIN_TO_CLASS&&this.transformationType!==pd.CLASS_TO_CLASS||(c=r?new Map:i?new i:{});for(var h=function(n){if("__proto__"===n||"constructor"===n)return"continue";var a=n,o=n,l=n;if(!d.options.ignoreDecorators&&i)if(d.transformationType===pd.PLAIN_TO_CLASS)(u=yd.findExposeMetadataByCustomName(i,n))&&(l=u.propertyName,o=u.propertyName);else if(d.transformationType===pd.CLASS_TO_PLAIN||d.transformationType===pd.CLASS_TO_CLASS){var u;(u=yd.findExposeMetadata(i,n))&&u.options&&u.options.name&&(o=u.options.name)}var h=void 0;h=d.transformationType===pd.PLAIN_TO_CLASS?t[a]:t instanceof Map?t.get(a):t[a]instanceof Function?t[a]():t[a];var p=void 0,f=h instanceof Map;if(i&&r)p=i;else if(i){var m=yd.findTypeMetadata(i,l);if(m){var g={newObject:c,object:t,property:l},y=m.typeFunction?m.typeFunction(g):m.reflectedType;m.options&&m.options.discriminator&&m.options.discriminator.property&&m.options.discriminator.subTypes?t[a]instanceof Array?p=m:(d.transformationType===pd.PLAIN_TO_CLASS&&(p=void 0===(p=m.options.discriminator.subTypes.find(function(e){if(h&&h instanceof Object&&m.options.discriminator.property in h)return e.name===h[m.options.discriminator.property]}))?y:p.value,m.options.keepDiscriminatorProperty||h&&h instanceof Object&&m.options.discriminator.property in h&&delete h[m.options.discriminator.property]),d.transformationType===pd.CLASS_TO_CLASS&&(p=h.constructor),d.transformationType===pd.CLASS_TO_PLAIN&&h&&(h[m.options.discriminator.property]=m.options.discriminator.subTypes.find(function(e){return e.value===h.constructor}).name)):p=y,f=f||m.reflectedType===Map}else if(d.options.targetMaps)d.options.targetMaps.filter(function(e){return e.target===i&&!!e.properties[l]}).forEach(function(e){return p=e.properties[l]});else if(d.options.enableImplicitConversion&&d.transformationType===pd.PLAIN_TO_CLASS){var v=Reflect.getMetadata("design:type",i.prototype,l);v&&(p=v)}}var _=Array.isArray(t[a])?d.getReflectedType(i,l):void 0,b=e?e[a]:void 0;if(c.constructor.prototype){var T=Object.getOwnPropertyDescriptor(c.constructor.prototype,o);if((d.transformationType===pd.PLAIN_TO_CLASS||d.transformationType===pd.CLASS_TO_CLASS)&&(T&&!T.set||c[o]instanceof Function))return"continue"}if(d.options.enableCircularCheck&&d.isCircular(h)){if(d.transformationType===pd.CLASS_TO_CLASS){w=h;(void 0!==(w=d.applyCustomTransformations(w,i,n,t,d.transformationType))||d.options.exposeUnsetFields)&&(c instanceof Map?c.set(o,w):c[o]=w)}}else{var S=d.transformationType===pd.PLAIN_TO_CLASS?o:n,w=void 0;d.transformationType===pd.CLASS_TO_PLAIN?(w=t[S],w=d.applyCustomTransformations(w,i,S,t,d.transformationType),w=t[S]===w?h:w,w=d.transform(b,w,p,_,f,s+1)):void 0===h&&d.options.exposeDefaultValues?w=c[o]:(w=d.transform(b,h,p,_,f,s+1),w=d.applyCustomTransformations(w,i,S,t,d.transformationType)),(void 0!==w||d.options.exposeUnsetFields)&&(c instanceof Map?c.set(o,w):c[o]=w)}},d=this,p=0,f=u;p<f.length;p++){h(f[p])}return this.options.enableCircularCheck&&this.recursionStack.delete(t),c}return t}return t}return new Promise(function(e,n){t.then(function(t){return e(o.transform(void 0,t,i,void 0,void 0,s+1))},n)})}return null==t?t:Boolean(t)}return null==t?t:Number(t)}return null==t?t:String(t)},e.prototype.applyCustomTransformations=function(e,t,i,n,r){var s=this,a=yd.findTransformMetadatas(t,i,this.transformationType);return void 0!==this.options.version&&(a=a.filter(function(e){return!e.options||s.checkVersion(e.options.since,e.options.until)})),(a=this.options.groups&&this.options.groups.length?a.filter(function(e){return!e.options||s.checkGroups(e.options.groups)}):a.filter(function(e){return!e.options||!e.options.groups||!e.options.groups.length})).forEach(function(t){e=t.transformFn({value:e,key:i,obj:n,type:r,options:s.options})}),e},e.prototype.isCircular=function(e){return this.recursionStack.has(e)},e.prototype.getReflectedType=function(e,t){if(e){var i=yd.findTypeMetadata(e,t);return i?i.reflectedType:void 0}},e.prototype.getKeys=function(e,t,i){var n=this,r=yd.getStrategy(e);"none"===r&&(r=this.options.strategy||"exposeAll");var s=[];if(("exposeAll"===r||i)&&(s=t instanceof Map?Array.from(t.keys()):Object.keys(t)),i)return s;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&e){var a=yd.getExposedProperties(e,this.transformationType),o=yd.getExcludedProperties(e,this.transformationType);s=vd(vd([],a,!0),o,!0)}if(!this.options.ignoreDecorators&&e){a=yd.getExposedProperties(e,this.transformationType);this.transformationType===pd.PLAIN_TO_CLASS&&(a=a.map(function(t){var i=yd.findExposeMetadata(e,t);return i&&i.options&&i.options.name?i.options.name:t})),s=this.options.excludeExtraneousValues?a:s.concat(a);var l=yd.getExcludedProperties(e,this.transformationType);l.length>0&&(s=s.filter(function(e){return!l.includes(e)})),void 0!==this.options.version&&(s=s.filter(function(t){var i=yd.findExposeMetadata(e,t);return!i||!i.options||n.checkVersion(i.options.since,i.options.until)})),s=this.options.groups&&this.options.groups.length?s.filter(function(t){var i=yd.findExposeMetadata(e,t);return!i||!i.options||n.checkGroups(i.options.groups)}):s.filter(function(t){var i=yd.findExposeMetadata(e,t);return!(i&&i.options&&i.options.groups&&i.options.groups.length)})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(s=s.filter(function(e){return n.options.excludePrefixes.every(function(t){return e.substr(0,t.length)!==t})})),s=s.filter(function(e,t,i){return i.indexOf(e)===t})},e.prototype.checkVersion=function(e,t){var i=!0;return i&&e&&(i=this.options.version>=e),i&&t&&(i=this.options.version<t),i},e.prototype.checkGroups=function(e){return!e||this.options.groups.some(function(t){return e.includes(t)})},e}(),bd={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},Td=function(){return Td=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Td.apply(this,arguments)},Sd=function(){function e(){}return e.prototype.instanceToPlain=function(e,t){return new _d(pd.CLASS_TO_PLAIN,Td(Td({},bd),t)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToPlainFromExist=function(e,t,i){return new _d(pd.CLASS_TO_PLAIN,Td(Td({},bd),i)).transform(t,e,void 0,void 0,void 0,void 0)},e.prototype.plainToInstance=function(e,t,i){return new _d(pd.PLAIN_TO_CLASS,Td(Td({},bd),i)).transform(void 0,t,e,void 0,void 0,void 0)},e.prototype.plainToClassFromExist=function(e,t,i){return new _d(pd.PLAIN_TO_CLASS,Td(Td({},bd),i)).transform(e,t,void 0,void 0,void 0,void 0)},e.prototype.instanceToInstance=function(e,t){return new _d(pd.CLASS_TO_CLASS,Td(Td({},bd),t)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToClassFromExist=function(e,t,i){return new _d(pd.CLASS_TO_CLASS,Td(Td({},bd),i)).transform(t,e,void 0,void 0,void 0,void 0)},e.prototype.serialize=function(e,t){return JSON.stringify(this.instanceToPlain(e,t))},e.prototype.deserialize=function(e,t,i){var n=JSON.parse(t);return this.plainToInstance(e,n,i)},e.prototype.deserializeArray=function(e,t,i){var n=JSON.parse(t);return this.plainToInstance(e,n,i)},e}();var wd=new Sd;const xd=Object.freeze(Object.defineProperty({__proto__:null,ClassTransformer:Sd,Exclude:function(e){return void 0===e&&(e={}),function(t,i){yd.addExcludeMetadata({target:t instanceof Function?t:t.constructor,propertyName:i,options:e})}},Expose:function(e){return void 0===e&&(e={}),function(t,i){yd.addExposeMetadata({target:t instanceof Function?t:t.constructor,propertyName:i,options:e})}},Transform:function(e,t){return void 0===t&&(t={}),function(i,n){yd.addTransformMetadata({target:i.constructor,propertyName:n,transformFn:e,options:t})}},TransformInstanceToInstance:function(e){return function(t,i,n){var r=new Sd,s=n.value;n.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=s.apply(this,t);return!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then?n.then(function(t){return r.instanceToInstance(t,e)}):r.instanceToInstance(n,e)}}},TransformInstanceToPlain:function(e){return function(t,i,n){var r=new Sd,s=n.value;n.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=s.apply(this,t);return!!n&&("object"==typeof n||"function"==typeof n)&&"function"==typeof n.then?n.then(function(t){return r.instanceToPlain(t,e)}):r.instanceToPlain(n,e)}}},TransformPlainToInstance:function(e,t){return function(i,n,r){var s=new Sd,a=r.value;r.value=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var r=a.apply(this,i);return!!r&&("object"==typeof r||"function"==typeof r)&&"function"==typeof r.then?r.then(function(i){return s.plainToInstance(e,i,t)}):s.plainToInstance(e,r,t)}}},get TransformationType(){return pd},Type:function(e,t){return void 0===t&&(t={}),function(i,n){var r=Reflect.getMetadata("design:type",i,n);yd.addTypeMetadata({target:i.constructor,propertyName:n,reflectedType:r,typeFunction:e,options:t})}},classToClassFromExist:function(e,t,i){return wd.classToClassFromExist(e,t,i)},classToPlain:function(e,t){return wd.instanceToPlain(e,t)},classToPlainFromExist:function(e,t,i){return wd.classToPlainFromExist(e,t,i)},deserialize:function(e,t,i){return wd.deserialize(e,t,i)},deserializeArray:function(e,t,i){return wd.deserializeArray(e,t,i)},instanceToInstance:function(e,t){return wd.instanceToInstance(e,t)},instanceToPlain:function(e,t){return wd.instanceToPlain(e,t)},plainToClass:function(e,t,i){return wd.plainToInstance(e,t,i)},plainToClassFromExist:function(e,t,i){return wd.plainToClassFromExist(e,t,i)},plainToInstance:function(e,t,i){return wd.plainToInstance(e,t,i)},serialize:function(e,t){return wd.serialize(e,t)}},Symbol.toStringTag,{value:"Module"})),Ad=a(xd);var Ed,Cd,Md={};function kd(){return Ed||(Ed=1,t=e||(e={}),function(){var e="object"==typeof globalThis?globalThis:"object"==typeof r?r:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(e){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(e){}}(),i=n(t);function n(e,t){return function(i,n){Object.defineProperty(e,i,{configurable:!0,writable:!0,value:n}),t&&t(i,n)}}void 0!==e.Reflect&&(i=n(e.Reflect,i)),function(e,t){var i=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,o={__proto__:[]}instanceof Array,l=!a&&!o,u={create:a?function(){return he(Object.create(null))}:o?function(){return he({__proto__:null})}:function(){return he({})},has:l?function(e,t){return i.call(e,t)}:function(e,t){return t in e},get:l?function(e,t){return i.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),h="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:le(),d="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:ue(),p="function"==typeof WeakMap?WeakMap:ce(),f=n?Symbol.for("@reflect-metadata:registry"):void 0,m=re(),g=se(m);function y(e,t,i,n){if(F(i)){if(!W(e))throw new TypeError;if(!X(t))throw new TypeError;return C(e,t)}if(!W(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(n)&&!F(n)&&!U(n))throw new TypeError;return U(n)&&(n=void 0),M(e,t,i=G(i),n)}function v(e,t){function i(i,n){if(!j(i))throw new TypeError;if(!F(n)&&!Y(n))throw new TypeError;D(e,t,i,n)}return i}function _(e,t,i,n){if(!j(i))throw new TypeError;return F(n)||(n=G(n)),D(e,t,i,n)}function b(e,t,i){if(!j(t))throw new TypeError;return F(i)||(i=G(i)),k(e,t,i)}function T(e,t,i){if(!j(t))throw new TypeError;return F(i)||(i=G(i)),I(e,t,i)}function S(e,t,i){if(!j(t))throw new TypeError;return F(i)||(i=G(i)),P(e,t,i)}function w(e,t,i){if(!j(t))throw new TypeError;return F(i)||(i=G(i)),L(e,t,i)}function x(e,t){if(!j(e))throw new TypeError;return F(t)||(t=G(t)),O(e,t)}function A(e,t){if(!j(e))throw new TypeError;return F(t)||(t=G(t)),R(e,t)}function E(e,t,i){if(!j(t))throw new TypeError;if(F(i)||(i=G(i)),!j(t))throw new TypeError;F(i)||(i=G(i));var n=oe(t,i,!1);return!F(n)&&n.OrdinaryDeleteMetadata(e,t,i)}function C(e,t){for(var i=e.length-1;i>=0;--i){var n=(0,e[i])(t);if(!F(n)&&!U(n)){if(!X(n))throw new TypeError;t=n}}return t}function M(e,t,i,n){for(var r=e.length-1;r>=0;--r){var s=(0,e[r])(t,i,n);if(!F(s)&&!U(s)){if(!j(s))throw new TypeError;n=s}}return n}function k(e,t,i){if(I(e,t,i))return!0;var n=ie(t);return!U(n)&&k(e,n,i)}function I(e,t,i){var n=oe(t,i,!1);return!F(n)&&H(n.OrdinaryHasOwnMetadata(e,t,i))}function P(e,t,i){if(I(e,t,i))return L(e,t,i);var n=ie(t);return U(n)?void 0:P(e,n,i)}function L(e,t,i){var n=oe(t,i,!1);if(!F(n))return n.OrdinaryGetOwnMetadata(e,t,i)}function D(e,t,i,n){oe(i,n,!0).OrdinaryDefineOwnMetadata(e,t,i,n)}function O(e,t){var i=R(e,t),n=ie(e);if(null===n)return i;var r=O(n,t);if(r.length<=0)return i;if(i.length<=0)return r;for(var s=new d,a=[],o=0,l=i;o<l.length;o++){var u=l[o];s.has(u)||(s.add(u),a.push(u))}for(var c=0,h=r;c<h.length;c++)u=h[c],s.has(u)||(s.add(u),a.push(u));return a}function R(e,t){var i=oe(e,t,!1);return i?i.OrdinaryOwnMetadataKeys(e,t):[]}function N(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function F(e){return void 0===e}function U(e){return null===e}function B(e){return"symbol"==typeof e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function z(e,t){switch(N(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var i="string",n=K(e,r);if(void 0!==n){var s=n.call(e,i);if(j(s))throw new TypeError;return s}return V(e)}function V(e,t){var i,n,r=e.toString;if($(r)&&!j(n=r.call(e)))return n;if($(i=e.valueOf)&&!j(n=i.call(e)))return n;throw new TypeError}function H(e){return!!e}function q(e){return""+e}function G(e){var t=z(e);return B(t)?t:q(t)}function W(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function $(e){return"function"==typeof e}function X(e){return"function"==typeof e}function Y(e){switch(N(e)){case 3:case 4:return!0;default:return!1}}function Q(e,t){return e===t||e!=e&&t!=t}function K(e,t){var i=e[t];if(null!=i){if(!$(i))throw new TypeError;return i}}function Z(e){var t=K(e,s);if(!$(t))throw new TypeError;var i=t.call(e);if(!j(i))throw new TypeError;return i}function J(e){return e.value}function ee(e){var t=e.next();return!t.done&&t}function te(e){var t=e.return;t&&t.call(e)}function ie(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var i=e.prototype,n=i&&Object.getPrototypeOf(i);if(null==n||n===Object.prototype)return t;var r=n.constructor;return"function"!=typeof r||r===e?t:r}function ne(){var e,i,n,r;F(f)||void 0===t.Reflect||f in t.Reflect||"function"!=typeof t.Reflect.defineMetadata||(e=ae(t.Reflect));var s=new p,a={registerProvider:o,getProvider:u,setProvider:m};return a;function o(t){if(!Object.isExtensible(a))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===t:break;case F(i):i=t;break;case i===t:break;case F(n):n=t;break;case n===t:break;default:void 0===r&&(r=new d),r.add(t)}}function l(t,s){if(!F(i)){if(i.isProviderFor(t,s))return i;if(!F(n)){if(n.isProviderFor(t,s))return i;if(!F(r))for(var a=Z(r);;){var o=ee(a);if(!o)return;var l=J(o);if(l.isProviderFor(t,s))return te(a),l}}}if(!F(e)&&e.isProviderFor(t,s))return e}function u(e,t){var i,n=s.get(e);return F(n)||(i=n.get(t)),F(i)?(F(i=l(e,t))||(F(n)&&(n=new h,s.set(e,n)),n.set(t,i)),i):i}function c(e){if(F(e))throw new TypeError;return i===e||n===e||!F(r)&&r.has(e)}function m(e,t,i){if(!c(i))throw new Error("Metadata provider not registered.");var n=u(e,t);if(n!==i){if(!F(n))return!1;var r=s.get(e);F(r)&&(r=new h,s.set(e,r)),r.set(t,i)}return!0}}function re(){var e;return!F(f)&&j(t.Reflect)&&Object.isExtensible(t.Reflect)&&(e=t.Reflect[f]),F(e)&&(e=ne()),!F(f)&&j(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function se(e){var t=new p,i={isProviderFor:function(e,i){var n=t.get(e);return!F(n)&&n.has(i)},OrdinaryDefineOwnMetadata:a,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:l};return m.registerProvider(i),i;function n(n,r,s){var a=t.get(n),o=!1;if(F(a)){if(!s)return;a=new h,t.set(n,a),o=!0}var l=a.get(r);if(F(l)){if(!s)return;if(l=new h,a.set(r,l),!e.setProvider(n,r,i))throw a.delete(r),o&&t.delete(n),new Error("Wrong provider for target.")}return l}function r(e,t,i){var r=n(t,i,!1);return!F(r)&&H(r.has(e))}function s(e,t,i){var r=n(t,i,!1);if(!F(r))return r.get(e)}function a(e,t,i,r){n(i,r,!0).set(e,t)}function o(e,t){var i=[],r=n(e,t,!1);if(F(r))return i;for(var s=Z(r.keys()),a=0;;){var o=ee(s);if(!o)return i.length=a,i;var l=J(o);try{i[a]=l}catch(u){try{te(s)}finally{throw u}}a++}}function l(e,i,r){var s=n(i,r,!1);if(F(s))return!1;if(!s.delete(e))return!1;if(0===s.size){var a=t.get(i);F(a)||(a.delete(r),0===a.size&&t.delete(a))}return!0}}function ae(e){var t=e.defineMetadata,i=e.hasOwnMetadata,n=e.getOwnMetadata,r=e.getOwnMetadataKeys,s=e.deleteMetadata,a=new p;return{isProviderFor:function(e,t){var i=a.get(e);return!(F(i)||!i.has(t))||!!r(e,t).length&&(F(i)&&(i=new d,a.set(e,i)),i.add(t),!0)},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:n,OrdinaryOwnMetadataKeys:r,OrdinaryDeleteMetadata:s}}function oe(e,t,i){var n=m.getProvider(e,t);if(!F(n))return n;if(i){if(m.setProvider(e,t,g))return g;throw new Error("Illegal state.")}}function le(){var e={},t=[],i=function(){function e(e,t,i){this._index=0,this._keys=e,this._values=t,this._selector=i}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var i=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var i=this._find(e,!0);return this._values[i]=t,this},t.prototype.delete=function(t){var i=this._find(t,!1);if(i>=0){for(var n=this._keys.length,r=i+1;r<n;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,Q(t,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new i(this._keys,this._values,n)},t.prototype.values=function(){return new i(this._keys,this._values,r)},t.prototype.entries=function(){return new i(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){if(!Q(this._cacheKey,e)){this._cacheIndex=-1;for(var i=0;i<this._keys.length;i++)if(Q(this._keys[i],e)){this._cacheIndex=i;break}}return this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function r(e,t){return t}function a(e,t){return[e,t]}}function ue(){return function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.keys()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}()}function ce(){var e=16,t=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=s(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=s(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return s(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=s(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var e;do{e="@@WeakMap@@"+l()}while(u.has(t,e));return t[e]=!0,e}function s(e,t){if(!i.call(e,n)){if(!t)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function a(e,t){for(var i=0;i<t;++i)e[i]=255*Math.random()|0;return e}function o(e){if("function"==typeof Uint8Array){var t=new Uint8Array(e);return"undefined"!=typeof crypto?crypto.getRandomValues(t):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(t):a(t,e),t}return a(new Array(e),e)}function l(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var i="",n=0;n<e;++n){var r=t[n];4!==n&&6!==n&&8!==n||(i+="-"),r<16&&(i+="0"),i+=r.toString(16).toLowerCase()}return i}}function he(e){return e.__=void 0,delete e.__,e}e("decorate",y),e("metadata",v),e("defineMetadata",_),e("hasMetadata",b),e("hasOwnMetadata",T),e("getMetadata",S),e("getOwnMetadata",w),e("getMetadataKeys",x),e("getOwnMetadataKeys",A),e("deleteMetadata",E)}(i,e),void 0===e.Reflect&&(e.Reflect=t)}()),Md;var e,t}function Id(){return Cd||(Cd=1,function(e){var t=gd&&gd.__decorate||function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},i=gd&&gd.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(e,"__esModule",{value:!0}),e.RawReading=e.RawUnsubscribeCmd=e.RawSubscribeCmd=e.RawWriteCmd=e.RawReadCmd=e.SensorReading=e.SensorReadCmd=e.LinearCmd=e.VectorSubcommand=e.RotateCmd=e.RotateSubcommand=e.ScalarCmd=e.ScalarSubcommand=e.GenericMessageSubcommand=e.StopAllDevices=e.StopDeviceCmd=e.ServerInfo=e.RequestServerInfo=e.ScanningFinished=e.StopScanning=e.StartScanning=e.RequestDeviceList=e.DeviceRemoved=e.DeviceAdded=e.DeviceList=e.DeviceInfo=e.Error=e.ErrorClass=e.Ping=e.Ok=e.ButtplugSystemMessage=e.ButtplugDeviceMessage=e.ButtplugMessage=e.SensorDeviceMessageAttributes=e.RawDeviceMessageAttributes=e.GenericDeviceMessageAttributes=e.SensorType=e.ActuatorType=e.MessageAttributes=e.MESSAGE_SPEC_VERSION=e.MAX_ID=e.DEFAULT_MESSAGE_ID=e.SYSTEM_MESSAGE_ID=void 0;const n=Ad;kd(),e.SYSTEM_MESSAGE_ID=0,e.DEFAULT_MESSAGE_ID=1,e.MAX_ID=4294967295,e.MESSAGE_SPEC_VERSION=3;class r{constructor(e){Object.assign(this,e)}update(){var e,t,i,n,r;null===(e=this.ScalarCmd)||void 0===e||e.forEach((e,t)=>e.Index=t),null===(t=this.RotateCmd)||void 0===t||t.forEach((e,t)=>e.Index=t),null===(i=this.LinearCmd)||void 0===i||i.forEach((e,t)=>e.Index=t),null===(n=this.SensorReadCmd)||void 0===n||n.forEach((e,t)=>e.Index=t),null===(r=this.SensorSubscribeCmd)||void 0===r||r.forEach((e,t)=>e.Index=t)}}var s,a,o,l,u,c;e.MessageAttributes=r,(a=s||(e.ActuatorType=s={})).Unknown="Unknown",a.Vibrate="Vibrate",a.Rotate="Rotate",a.Oscillate="Oscillate",a.Constrict="Constrict",a.Inflate="Inflate",a.Position="Position",(l=o||(e.SensorType=o={})).Unknown="Unknown",l.Battery="Battery",l.RSSI="RSSI",l.Button="Button",l.Pressure="Pressure";e.GenericDeviceMessageAttributes=class{constructor(e){this.Index=0,Object.assign(this,e)}};e.RawDeviceMessageAttributes=class{constructor(e){this.Endpoints=e}};e.SensorDeviceMessageAttributes=class{constructor(e){this.Index=0,Object.assign(this,e)}};class h{constructor(e){this.Id=e}get Type(){return this.constructor}toJSON(){return JSON.stringify(this.toProtocolFormat())}toProtocolFormat(){const e={};return e[this.constructor.Name]=(0,n.instanceToPlain)(this),e}update(){}}e.ButtplugMessage=h;class d extends h{constructor(e,t){super(t),this.DeviceIndex=e,this.Id=t}}e.ButtplugDeviceMessage=d;class p extends h{constructor(t=e.SYSTEM_MESSAGE_ID){super(t),this.Id=t}}e.ButtplugSystemMessage=p;class f extends p{constructor(t=e.DEFAULT_MESSAGE_ID){super(t),this.Id=t}}e.Ok=f,f.Name="Ok";class m extends h{constructor(t=e.DEFAULT_MESSAGE_ID){super(t),this.Id=t}}e.Ping=m,m.Name="Ping",(c=u||(e.ErrorClass=u={}))[c.ERROR_UNKNOWN=0]="ERROR_UNKNOWN",c[c.ERROR_INIT=1]="ERROR_INIT",c[c.ERROR_PING=2]="ERROR_PING",c[c.ERROR_MSG=3]="ERROR_MSG",c[c.ERROR_DEVICE=4]="ERROR_DEVICE";class g extends h{constructor(t,i=u.ERROR_UNKNOWN,n=e.DEFAULT_MESSAGE_ID){super(n),this.ErrorMessage=t,this.ErrorCode=i,this.Id=n}get Schemversion(){return 0}}e.Error=g,g.Name="Error";class y{constructor(e){Object.assign(this,e)}}e.DeviceInfo=y,t([(0,n.Type)(()=>r),i("design:type",r)],y.prototype,"DeviceMessages",void 0);class v extends h{constructor(t,i=e.DEFAULT_MESSAGE_ID){super(i),this.Devices=t,this.Id=i}update(){for(const e of this.Devices)e.DeviceMessages.update()}}e.DeviceList=v,v.Name="DeviceList",t([(0,n.Type)(()=>y),i("design:type",Array)],v.prototype,"Devices",void 0);class _ extends p{constructor(e){super(),Object.assign(this,e)}update(){this.DeviceMessages.update()}}e.DeviceAdded=_,_.Name="DeviceAdded",t([(0,n.Type)(()=>r),i("design:type",r)],_.prototype,"DeviceMessages",void 0);class b extends p{constructor(e){super(),this.DeviceIndex=e}}e.DeviceRemoved=b,b.Name="DeviceRemoved";class T extends h{constructor(t=e.DEFAULT_MESSAGE_ID){super(t),this.Id=t}}e.RequestDeviceList=T,T.Name="RequestDeviceList";class S extends h{constructor(t=e.DEFAULT_MESSAGE_ID){super(t),this.Id=t}}e.StartScanning=S,S.Name="StartScanning";class w extends h{constructor(t=e.DEFAULT_MESSAGE_ID){super(t),this.Id=t}}e.StopScanning=w,w.Name="StopScanning";class x extends p{constructor(){super()}}e.ScanningFinished=x,x.Name="ScanningFinished";class A extends h{constructor(t,i=0,n=e.DEFAULT_MESSAGE_ID){super(n),this.ClientName=t,this.MessageVersion=i,this.Id=n}}e.RequestServerInfo=A,A.Name="RequestServerInfo";class E extends p{constructor(t,i,n,r=e.DEFAULT_MESSAGE_ID){super(),this.MessageVersion=t,this.MaxPingTime=i,this.ServerName=n,this.Id=r}}e.ServerInfo=E,E.Name="ServerInfo";class C extends d{constructor(t=-1,i=e.DEFAULT_MESSAGE_ID){super(t,i),this.DeviceIndex=t,this.Id=i}}e.StopDeviceCmd=C,C.Name="StopDeviceCmd";class M extends h{constructor(t=e.DEFAULT_MESSAGE_ID){super(t),this.Id=t}}e.StopAllDevices=M,M.Name="StopAllDevices";class k{constructor(e){this.Index=e}}e.GenericMessageSubcommand=k;e.ScalarSubcommand=class extends k{constructor(e,t,i){super(e),this.Scalar=t,this.ActuatorType=i}};class I extends d{constructor(t,i=-1,n=e.DEFAULT_MESSAGE_ID){super(i,n),this.Scalars=t,this.DeviceIndex=i,this.Id=n}}e.ScalarCmd=I,I.Name="ScalarCmd";class P extends k{constructor(e,t,i){super(e),this.Speed=t,this.Clockwise=i}}e.RotateSubcommand=P;class L extends d{static Create(e,t){const i=new Array;let n=0;for(const[r,s]of t)i.push(new P(n,r,s)),++n;return new L(i,e)}constructor(t,i=-1,n=e.DEFAULT_MESSAGE_ID){super(i,n),this.Rotations=t,this.DeviceIndex=i,this.Id=n}}e.RotateCmd=L,L.Name="RotateCmd";class D extends k{constructor(e,t,i){super(e),this.Position=t,this.Duration=i}}e.VectorSubcommand=D;class O extends d{static Create(e,t){const i=new Array;let n=0;for(const r of t)i.push(new D(n,r[0],r[1])),++n;return new O(i,e)}constructor(t,i=-1,n=e.DEFAULT_MESSAGE_ID){super(i,n),this.Vectors=t,this.DeviceIndex=i,this.Id=n}}e.LinearCmd=O,O.Name="LinearCmd";class R extends d{constructor(t,i,n,r=e.DEFAULT_MESSAGE_ID){super(t,r),this.DeviceIndex=t,this.SensorIndex=i,this.SensorType=n,this.Id=r}}e.SensorReadCmd=R,R.Name="SensorReadCmd";class N extends d{constructor(t,i,n,r,s=e.DEFAULT_MESSAGE_ID){super(t,s),this.DeviceIndex=t,this.SensorIndex=i,this.SensorType=n,this.Data=r,this.Id=s}}e.SensorReading=N,N.Name="SensorReading";class F extends d{constructor(t,i,n,r,s=e.DEFAULT_MESSAGE_ID){super(t,s),this.DeviceIndex=t,this.Endpoint=i,this.ExpectedLength=n,this.Timeout=r,this.Id=s}}e.RawReadCmd=F,F.Name="RawReadCmd";class U extends d{constructor(t,i,n,r,s=e.DEFAULT_MESSAGE_ID){super(t,s),this.DeviceIndex=t,this.Endpoint=i,this.Data=n,this.WriteWithResponse=r,this.Id=s}}e.RawWriteCmd=U,U.Name="RawWriteCmd";class B extends d{constructor(t,i,n=e.DEFAULT_MESSAGE_ID){super(t,n),this.DeviceIndex=t,this.Endpoint=i,this.Id=n}}e.RawSubscribeCmd=B,B.Name="RawSubscribeCmd";class j extends d{constructor(t,i,n=e.DEFAULT_MESSAGE_ID){super(t,n),this.DeviceIndex=t,this.Endpoint=i,this.Id=n}}e.RawUnsubscribeCmd=j,j.Name="RawUnsubscribeCmd";class z extends d{constructor(t,i,n,r=e.DEFAULT_MESSAGE_ID){super(t,r),this.DeviceIndex=t,this.Endpoint=i,this.Data=n,this.Id=r}}e.RawReading=z,z.Name="RawReading"}(gd)),gd}var Pd,Ld={};function Dd(){if(Pd)return Ld;Pd=1;var e=Ld&&Ld.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=Ld&&Ld.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=Ld&&Ld.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n};Object.defineProperty(Ld,"__esModule",{value:!0}),Ld.ButtplugUnknownError=Ld.ButtplugPingError=Ld.ButtplugMessageError=Ld.ButtplugDeviceError=Ld.ButtplugInitError=Ld.ButtplugError=void 0;const n=i(Id());class r extends Error{get ErrorClass(){return this.errorClass}get InnerError(){return this.innerError}get Id(){return this.messageId}get ErrorMessage(){return new n.Error(this.message,this.ErrorClass,this.Id)}static LogAndError(e,t,i,r=n.SYSTEM_MESSAGE_ID){return t.Error(i),new e(i,r)}static FromError(e){switch(e.ErrorCode){case n.ErrorClass.ERROR_DEVICE:return new a(e.ErrorMessage,e.Id);case n.ErrorClass.ERROR_INIT:return new s(e.ErrorMessage,e.Id);case n.ErrorClass.ERROR_UNKNOWN:return new u(e.ErrorMessage,e.Id);case n.ErrorClass.ERROR_PING:return new l(e.ErrorMessage,e.Id);case n.ErrorClass.ERROR_MSG:return new o(e.ErrorMessage,e.Id);default:throw new Error(`Message type ${e.ErrorCode} not handled`)}}constructor(e,t,i=n.SYSTEM_MESSAGE_ID,r){super(e),this.errorClass=n.ErrorClass.ERROR_UNKNOWN,this.errorClass=t,this.innerError=r,this.messageId=i}}Ld.ButtplugError=r;class s extends r{constructor(e,t=n.SYSTEM_MESSAGE_ID){super(e,n.ErrorClass.ERROR_INIT,t)}}Ld.ButtplugInitError=s;class a extends r{constructor(e,t=n.SYSTEM_MESSAGE_ID){super(e,n.ErrorClass.ERROR_DEVICE,t)}}Ld.ButtplugDeviceError=a;class o extends r{constructor(e,t=n.SYSTEM_MESSAGE_ID){super(e,n.ErrorClass.ERROR_MSG,t)}}Ld.ButtplugMessageError=o;class l extends r{constructor(e,t=n.SYSTEM_MESSAGE_ID){super(e,n.ErrorClass.ERROR_PING,t)}}Ld.ButtplugPingError=l;class u extends r{constructor(e,t=n.SYSTEM_MESSAGE_ID){super(e,n.ErrorClass.ERROR_UNKNOWN,t)}}return Ld.ButtplugUnknownError=u,Ld}var Od,Rd,Nd={};function Fd(){if(Od)return Nd;Od=1;var e=Nd&&Nd.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=Nd&&Nd.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=Nd&&Nd.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n};Object.defineProperty(Nd,"__esModule",{value:!0}),Nd.fromJSON=Nd.getMessageClassFromMessage=void 0;const n=Ad,r=i(Id());function s(e){for(const t of Object.values(r))if("function"==typeof t&&"Name"in t&&t.Name===e)return t;return null}return Nd.getMessageClassFromMessage=function(e){return s(Object.getPrototypeOf(e).constructor.Name)},Nd.fromJSON=function(e){const t=JSON.parse(e),i=[];for(const r of Array.from(t)){const e=Object.getOwnPropertyNames(r)[0],t=s(e);if(t){const s=(0,n.plainToInstance)(t,r[e]);s.update(),i.push(s)}}return i},Nd}function Ud(){if(Rd)return md;Rd=1;var e=md&&md.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=md&&md.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=md&&md.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n},n=md&&md.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(md,"__esModule",{value:!0}),md.ButtplugClientDevice=void 0;const r=i(Id()),s=Dd(),a=hd(),o=Fd();let l=class e extends a.EventEmitter{get name(){return this._deviceInfo.DeviceName}get displayName(){return this._deviceInfo.DeviceDisplayName}get index(){return this._deviceInfo.DeviceIndex}get messageTimingGap(){return this._deviceInfo.DeviceMessageTimingGap}get messageAttributes(){return this._deviceInfo.DeviceMessages}static fromMsg(t,i){return new e(t,i)}constructor(e,t){super(),this._deviceInfo=e,this._sendClosure=t,this.allowedMsgs=new Map,e.DeviceMessages.update()}send(e){return n(this,void 0,void 0,function*(){return yield this._sendClosure(this,e)})}sendExpectOk(e){return n(this,void 0,void 0,function*(){const t=yield this.send(e);switch((0,o.getMessageClassFromMessage)(t)){case r.Ok:return;case r.Error:throw s.ButtplugError.FromError(t);default:throw new s.ButtplugMessageError(`Message type ${t.constructor} not handled by SendMsgExpectOk`)}})}scalar(e){return n(this,void 0,void 0,function*(){Array.isArray(e)?yield this.sendExpectOk(new r.ScalarCmd(e,this.index)):yield this.sendExpectOk(new r.ScalarCmd([e],this.index))})}scalarCommandBuilder(e,t){var i;return n(this,void 0,void 0,function*(){const n=null===(i=this.messageAttributes.ScalarCmd)||void 0===i?void 0:i.filter(e=>e.ActuatorType===t);if(!n||0===n.length)throw new s.ButtplugDeviceError(`Device ${this.name} has no ${t} capabilities`);const a=[];if("number"==typeof e)n.forEach(i=>a.push(new r.ScalarSubcommand(i.Index,e,t)));else{if(!Array.isArray(e))throw new s.ButtplugDeviceError(`${t} can only take numbers or arrays of numbers.`);if(e.length>n.length)throw new s.ButtplugDeviceError(`${e.length} commands send to a device with ${n.length} vibrators`);n.forEach((i,n)=>{a.push(new r.ScalarSubcommand(i.Index,e[n],t))})}yield this.scalar(a)})}get vibrateAttributes(){var e,t;return null!==(t=null===(e=this.messageAttributes.ScalarCmd)||void 0===e?void 0:e.filter(e=>e.ActuatorType===r.ActuatorType.Vibrate))&&void 0!==t?t:[]}vibrate(e){return n(this,void 0,void 0,function*(){yield this.scalarCommandBuilder(e,r.ActuatorType.Vibrate)})}get oscillateAttributes(){var e,t;return null!==(t=null===(e=this.messageAttributes.ScalarCmd)||void 0===e?void 0:e.filter(e=>e.ActuatorType===r.ActuatorType.Oscillate))&&void 0!==t?t:[]}oscillate(e){return n(this,void 0,void 0,function*(){yield this.scalarCommandBuilder(e,r.ActuatorType.Oscillate)})}get rotateAttributes(){var e;return null!==(e=this.messageAttributes.RotateCmd)&&void 0!==e?e:[]}rotate(e,t){return n(this,void 0,void 0,function*(){const i=this.messageAttributes.RotateCmd;if(!i||0===i.length)throw new s.ButtplugDeviceError(`Device ${this.name} has no Rotate capabilities`);let n;if("number"==typeof e)n=r.RotateCmd.Create(this.index,new Array(i.length).fill([e,t]));else{if(!Array.isArray(e))throw new s.ButtplugDeviceError("SendRotateCmd can only take a number and boolean, or an array of number/boolean tuples");n=r.RotateCmd.Create(this.index,e)}yield this.sendExpectOk(n)})}get linearAttributes(){var e;return null!==(e=this.messageAttributes.LinearCmd)&&void 0!==e?e:[]}linear(e,t){return n(this,void 0,void 0,function*(){const i=this.messageAttributes.LinearCmd;if(!i||0===i.length)throw new s.ButtplugDeviceError(`Device ${this.name} has no Linear capabilities`);let n;if("number"==typeof e)n=r.LinearCmd.Create(this.index,new Array(i.length).fill([e,t]));else{if(!Array.isArray(e))throw new s.ButtplugDeviceError("SendLinearCmd can only take a number and number, or an array of number/number tuples");n=r.LinearCmd.Create(this.index,e)}yield this.sendExpectOk(n)})}sensorRead(e,t){return n(this,void 0,void 0,function*(){const i=yield this.send(new r.SensorReadCmd(this.index,e,t));switch((0,o.getMessageClassFromMessage)(i)){case r.SensorReading:return i.Data;case r.Error:throw s.ButtplugError.FromError(i);default:throw new s.ButtplugMessageError(`Message type ${i.constructor} not handled by sensorRead`)}})}get hasBattery(){var e;const t=null===(e=this.messageAttributes.SensorReadCmd)||void 0===e?void 0:e.filter(e=>e.SensorType===r.SensorType.Battery);return void 0!==t&&t.length>0}battery(){var e;return n(this,void 0,void 0,function*(){if(!this.hasBattery)throw new s.ButtplugDeviceError(`Device ${this.name} has no Battery capabilities`);const t=null===(e=this.messageAttributes.SensorReadCmd)||void 0===e?void 0:e.filter(e=>e.SensorType===r.SensorType.Battery);return(yield this.sensorRead(t[0].Index,r.SensorType.Battery))[0]/100})}get hasRssi(){var e;const t=null===(e=this.messageAttributes.SensorReadCmd)||void 0===e?void 0:e.filter(e=>e.SensorType===r.SensorType.RSSI);return void 0!==t&&0===t.length}rssi(){var e;return n(this,void 0,void 0,function*(){if(!this.hasRssi)throw new s.ButtplugDeviceError(`Device ${this.name} has no RSSI capabilities`);const t=null===(e=this.messageAttributes.SensorReadCmd)||void 0===e?void 0:e.filter(e=>e.SensorType===r.SensorType.RSSI);return(yield this.sensorRead(t[0].Index,r.SensorType.RSSI))[0]})}rawRead(e,t,i){return n(this,void 0,void 0,function*(){if(!this.messageAttributes.RawReadCmd)throw new s.ButtplugDeviceError(`Device ${this.name} has no raw read capabilities`);if(-1===this.messageAttributes.RawReadCmd.Endpoints.indexOf(e))throw new s.ButtplugDeviceError(`Device ${this.name} has no raw readable endpoint ${e}`);const n=yield this.send(new r.RawReadCmd(this.index,e,t,i));switch((0,o.getMessageClassFromMessage)(n)){case r.RawReading:return new Uint8Array(n.Data);case r.Error:throw s.ButtplugError.FromError(n);default:throw new s.ButtplugMessageError(`Message type ${n.constructor} not handled by rawRead`)}})}rawWrite(e,t,i){return n(this,void 0,void 0,function*(){if(!this.messageAttributes.RawWriteCmd)throw new s.ButtplugDeviceError(`Device ${this.name} has no raw write capabilities`);if(-1===this.messageAttributes.RawWriteCmd.Endpoints.indexOf(e))throw new s.ButtplugDeviceError(`Device ${this.name} has no raw writable endpoint ${e}`);yield this.sendExpectOk(new r.RawWriteCmd(this.index,e,t,i))})}rawSubscribe(e){return n(this,void 0,void 0,function*(){if(!this.messageAttributes.RawSubscribeCmd)throw new s.ButtplugDeviceError(`Device ${this.name} has no raw subscribe capabilities`);if(-1===this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(e))throw new s.ButtplugDeviceError(`Device ${this.name} has no raw subscribable endpoint ${e}`);yield this.sendExpectOk(new r.RawSubscribeCmd(this.index,e))})}rawUnsubscribe(e){return n(this,void 0,void 0,function*(){if(!this.messageAttributes.RawSubscribeCmd)throw new s.ButtplugDeviceError(`Device ${this.name} has no raw unsubscribe capabilities`);if(-1===this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(e))throw new s.ButtplugDeviceError(`Device ${this.name} has no raw unsubscribable endpoint ${e}`);yield this.sendExpectOk(new r.RawUnsubscribeCmd(this.index,e))})}stop(){return n(this,void 0,void 0,function*(){yield this.sendExpectOk(new r.StopDeviceCmd(this.index))})}emitDisconnected(){this.emit("deviceremoved")}};return md.ButtplugClientDevice=l,md}var Bd,jd={};function zd(){if(Bd)return jd;Bd=1;var e=jd&&jd.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=jd&&jd.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=jd&&jd.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n};Object.defineProperty(jd,"__esModule",{value:!0}),jd.ButtplugMessageSorter=void 0;const n=i(Id()),r=Dd();return jd.ButtplugMessageSorter=class{constructor(e){this._useCounter=e,this._counter=1,this._waitingMsgs=new Map}PrepareOutgoingMessage(e){let t,i;this._useCounter&&(e.Id=this._counter,this._counter+=1);const n=new Promise((e,n)=>{t=e,i=n});return this._waitingMsgs.set(e.Id,[t,i]),n}ParseIncomingMessages(e){const t=[];for(const i of e){if(i.Id!==n.SYSTEM_MESSAGE_ID&&this._waitingMsgs.has(i.Id)){const[e,t]=this._waitingMsgs.get(i.Id);if(i.Type===n.Error){t(r.ButtplugError.FromError(i));continue}e(i);continue}t.push(i)}return t}},jd}var Vd,Hd,qd={};function Gd(){if(Vd)return qd;Vd=1;var e=qd&&qd.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=qd&&qd.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=qd&&qd.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n};Object.defineProperty(qd,"__esModule",{value:!0}),qd.ButtplugClientConnectorException=void 0;const n=Dd(),r=i(Id());let s=class extends n.ButtplugError{constructor(e){super(e,r.ErrorClass.ERROR_UNKNOWN)}};return qd.ButtplugClientConnectorException=s,qd}function Wd(){if(Hd)return ld;Hd=1;var e=ld&&ld.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),t=ld&&ld.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=ld&&ld.__importStar||function(i){if(i&&i.__esModule)return i;var n={};if(null!=i)for(var r in i)"default"!==r&&Object.prototype.hasOwnProperty.call(i,r)&&e(n,i,r);return t(n,i),n},n=ld&&ld.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(ld,"__esModule",{value:!0}),ld.ButtplugClient=void 0;const r=dd(),s=hd(),a=Ud(),o=zd(),l=i(Id()),u=Dd(),c=Gd(),h=Fd();class d extends s.EventEmitter{constructor(e="Generic Buttplug Client"){super(),this._pingTimer=null,this._connector=null,this._devices=new Map,this._logger=r.ButtplugLogger.Logger,this._isScanning=!1,this._sorter=new o.ButtplugMessageSorter(!0),this.connect=e=>n(this,void 0,void 0,function*(){this._logger.Info(`ButtplugClient: Connecting using ${e.constructor.name}`),yield e.connect(),this._connector=e,this._connector.addListener("message",this.parseMessages),this._connector.addListener("disconnect",this.disconnectHandler),yield this.initializeConnection()}),this.disconnect=()=>n(this,void 0,void 0,function*(){this._logger.Debug("ButtplugClient: Disconnect called"),this.checkConnector(),yield this.shutdownConnection(),yield this._connector.disconnect()}),this.startScanning=()=>n(this,void 0,void 0,function*(){this._logger.Debug("ButtplugClient: StartScanning called"),this._isScanning=!0,yield this.sendMsgExpectOk(new l.StartScanning)}),this.stopScanning=()=>n(this,void 0,void 0,function*(){this._logger.Debug("ButtplugClient: StopScanning called"),this._isScanning=!1,yield this.sendMsgExpectOk(new l.StopScanning)}),this.stopAllDevices=()=>n(this,void 0,void 0,function*(){this._logger.Debug("ButtplugClient: StopAllDevices"),yield this.sendMsgExpectOk(new l.StopAllDevices)}),this.disconnectHandler=()=>{this._logger.Info("ButtplugClient: Disconnect event receieved."),this.emit("disconnect")},this.parseMessages=e=>{const t=this._sorter.ParseIncomingMessages(e);for(const i of t)switch((0,h.getMessageClassFromMessage)(i)){case l.DeviceAdded:{const e=i,t=a.ButtplugClientDevice.fromMsg(e,this.sendDeviceMessageClosure);this._devices.set(e.DeviceIndex,t),this.emit("deviceadded",t);break}case l.DeviceRemoved:{const e=i;if(this._devices.has(e.DeviceIndex)){const t=this._devices.get(e.DeviceIndex);null==t||t.emitDisconnected(),this._devices.delete(e.DeviceIndex),this.emit("deviceremoved",t)}break}case l.ScanningFinished:this._isScanning=!1,this.emit("scanningfinished",i)}},this.initializeConnection=()=>n(this,void 0,void 0,function*(){this.checkConnector();const e=yield this.sendMessage(new l.RequestServerInfo(this._clientName,l.MESSAGE_SPEC_VERSION));switch((0,h.getMessageClassFromMessage)(e)){case l.ServerInfo:{const t=e;if(this._logger.Info(`ButtplugClient: Connected to Server ${t.ServerName}`),t.MaxPingTime,t.MessageVersion<l.MESSAGE_SPEC_VERSION)throw yield this._connector.disconnect(),u.ButtplugError.LogAndError(u.ButtplugInitError,this._logger,`Server protocol version ${t.MessageVersion} is older than client protocol version ${l.MESSAGE_SPEC_VERSION}. Please update server.`);return yield this.requestDeviceList(),!0}case l.Error:{yield this._connector.disconnect();const t=e;throw u.ButtplugError.LogAndError(u.ButtplugInitError,this._logger,`Cannot connect to server. ${t.ErrorMessage}`)}}return!1}),this.requestDeviceList=()=>n(this,void 0,void 0,function*(){this.checkConnector(),this._logger.Debug("ButtplugClient: ReceiveDeviceList called");(yield this.sendMessage(new l.RequestDeviceList)).Devices.forEach(e=>{if(this._devices.has(e.DeviceIndex))this._logger.Debug(`ButtplugClient: Device already added: ${e}`);else{const t=a.ButtplugClientDevice.fromMsg(e,this.sendDeviceMessageClosure);this._logger.Debug(`ButtplugClient: Adding Device: ${t}`),this._devices.set(e.DeviceIndex,t),this.emit("deviceadded",t)}})}),this.shutdownConnection=()=>n(this,void 0,void 0,function*(){yield this.stopAllDevices(),null!==this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null)}),this.sendMsgExpectOk=e=>n(this,void 0,void 0,function*(){const t=yield this.sendMessage(e);switch((0,h.getMessageClassFromMessage)(t)){case l.Ok:return;case l.Error:throw u.ButtplugError.FromError(t);default:throw u.ButtplugError.LogAndError(u.ButtplugMessageError,this._logger,`Message type ${(0,h.getMessageClassFromMessage)(t).constructor} not handled by SendMsgExpectOk`)}}),this.sendDeviceMessageClosure=(e,t)=>n(this,void 0,void 0,function*(){return yield this.sendDeviceMessage(e,t)}),this._clientName=e,this._logger.Debug(`ButtplugClient: Client ${e} created.`)}get connected(){return null!==this._connector&&this._connector.Connected}get devices(){this.checkConnector();const e=[];return this._devices.forEach(t=>{e.push(t)}),e}get isScanning(){return this._isScanning}sendDeviceMessage(e,t){return n(this,void 0,void 0,function*(){this.checkConnector();if(void 0===this._devices.get(e.index))throw u.ButtplugError.LogAndError(u.ButtplugDeviceError,this._logger,`Device ${e.index} not available.`);return t.DeviceIndex=e.index,yield this.sendMessage(t)})}sendMessage(e){return n(this,void 0,void 0,function*(){this.checkConnector();const t=this._sorter.PrepareOutgoingMessage(e);return yield this._connector.send(e),yield t})}checkConnector(){if(!this.connected)throw new c.ButtplugClientConnectorException("ButtplugClient not connected")}}return ld.ButtplugClient=d,ld}var $d,Xd,Yd={},Qd={};function Kd(){if($d)return Qd;$d=1;var e=Qd&&Qd.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function o(e){try{l(n.throw(e))}catch(t){s(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};Object.defineProperty(Qd,"__esModule",{value:!0}),Qd.ButtplugBrowserWebsocketConnector=void 0;const t=hd(),i=Fd();let n=class extends t.EventEmitter{constructor(t){super(),this._url=t,this._websocketConstructor=null,this.connect=()=>e(this,void 0,void 0,function*(){var t;const i=new(null!==(t=this._websocketConstructor)&&void 0!==t?t:WebSocket)(this._url);let n,r;const s=new Promise((e,t)=>{n=e,r=t}),a=()=>r();return i.addEventListener("open",()=>e(this,void 0,void 0,function*(){this._ws=i;try{yield this.initialize(),this._ws.addEventListener("message",e=>{this.parseIncomingMessage(e)}),this._ws.removeEventListener("close",a),this._ws.addEventListener("close",this.disconnect),n()}catch(e){r()}})),i.addEventListener("close",a),s}),this.disconnect=()=>e(this,void 0,void 0,function*(){this.Connected&&(this._ws.close(),this._ws=void 0,this.emit("disconnect"))}),this.initialize=()=>e(this,void 0,void 0,function*(){return Promise.resolve()})}get Connected(){return void 0!==this._ws}sendMessage(e){if(!this.Connected)throw new Error("ButtplugBrowserWebsocketConnector not connected");this._ws.send("["+e.toJSON()+"]")}parseIncomingMessage(e){if("string"==typeof e.data){const t=(0,i.fromJSON)(e.data);this.emit("message",t)}else e.data,Blob}onReaderLoad(e){const t=(0,i.fromJSON)(e.target.result);this.emit("message",t)}};return Qd.ButtplugBrowserWebsocketConnector=n,Qd}function Zd(){if(Xd)return Yd;Xd=1,Object.defineProperty(Yd,"__esModule",{value:!0}),Yd.ButtplugBrowserWebsocketClientConnector=void 0;const e=Kd();let t=class extends e.ButtplugBrowserWebsocketConnector{constructor(){super(...arguments),this.send=e=>{if(!this.Connected)throw new Error("ButtplugClient not connected");this.sendMessage(e)}}};return Yd.ButtplugBrowserWebsocketClientConnector=t,Yd}var Jd,ep,tp,ip={};function np(){if(tp)return ip;tp=1,Object.defineProperty(ip,"__esModule",{value:!0}),ip.ButtplugNodeWebsocketClientConnector=void 0;const e=Zd(),t=ep?Jd:(ep=1,Jd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")});let i=class extends e.ButtplugBrowserWebsocketClientConnector{constructor(){super(...arguments),this._websocketConstructor=t.WebSocket}};return ip.ButtplugNodeWebsocketClientConnector=i,ip}var rp,sp,ap={};var op,lp,up,cp=(sp||(sp=1,op=od,lp=od&&od.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),up=od&&od.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||lp(t,e,i)},Object.defineProperty(op,"__esModule",{value:!0}),up(Wd(),op),up(Ud(),op),up(Zd(),op),up(np(),op),up(Gd(),op),up(zd(),op),up((rp||(rp=1,Object.defineProperty(ap,"__esModule",{value:!0})),ap),op),up(Id(),op),up(Fd(),op),up(dd(),op),up(Dd(),op)),od);const hp="scalar",dp="polar",pp={LINEAR:"linear",VIBRATE:"vibrate",OSCILLATE:"oscillate",ROTATE:"rotate"},fp={[pp.LINEAR]:hp,[pp.VIBRATE]:hp,[pp.OSCILLATE]:hp,[pp.ROTATE]:dp};class mp{constructor(e=null){var t;this.index=-1,this.name="Virtual Device",this.notify=e,this.messageTimingGap=0,this.actuatorConfig=[],this.messageAttributes={},this.setConfig("default"),this.commandCounts={total:0,byActuator:new Map,lastCommand:null,lastCommandTime:null},null==(t=this.notify)||t.call(this,"status:virtual",{message:"Virtual Device initialized with default config",type:"success"})}setConfig(e){var t,i,n;let r=[];if("string"==typeof e)r=this._getPresetConfig(e);else{if(!Array.isArray(e))return null==(t=this.notify)||t.call(this,"status:virtual",{message:"Invalid config type. Use preset name or array",type:"error"}),!1;r=this._validateCustomConfig(e)}const s=[...this.actuatorConfig];return this.actuatorConfig=r,this._rebuildMessageAttributes(),this._resetCommandCounts(),null==(i=this.notify)||i.call(this,"status:virtual",{message:`Config changed from ${s.length} to ${r.length} actuators`,type:"success"}),null==(n=this.notify)||n.call(this,"buttplug:device",{device:this,configChanged:!0,oldConfig:s,newConfig:[...r]}),!0}_getPresetConfig(e){var t,i;const n={default:[{capability:pp.LINEAR,name:"Main Stroke"},{capability:pp.VIBRATE,name:"Vibration"},{capability:pp.OSCILLATE,name:"Oscillation"},{capability:pp.ROTATE,name:"Rotation"}],simple:[{capability:pp.LINEAR,name:"Stroke"},{capability:pp.VIBRATE,name:"Buzz"}],stroker:[{capability:pp.LINEAR,name:"Main Stroke"}],"multi-vibe":[{capability:pp.VIBRATE,name:"Vibe 1"},{capability:pp.VIBRATE,name:"Vibe 2"},{capability:pp.VIBRATE,name:"Vibe 3"}],"full-featured":[{capability:pp.LINEAR,name:"Main Stroke"},{capability:pp.LINEAR,name:"Secondary"},{capability:pp.VIBRATE,name:"Tip Vibe"},{capability:pp.VIBRATE,name:"Base Vibe"},{capability:pp.ROTATE,name:"Twist"},{capability:pp.OSCILLATE,name:"Swing"}],rotator:[{capability:pp.ROTATE,name:"Main Rotation"},{capability:pp.VIBRATE,name:"Secondary Vibe"}]};return n[e]?(null==(i=this.notify)||i.call(this,"status:virtual",{message:`Applied preset: ${e}`,type:"log"}),n[e]):(null==(t=this.notify)||t.call(this,"status:virtual",{message:`Unknown preset '${e}', using 'default'`,type:"info"}),n.default)}_validateCustomConfig(e){const t=Object.values(pp);return e.map((e,i)=>{var n;return e.capability&&t.includes(e.capability)?{capability:e.capability,name:e.name||`${e.capability} ${i}`,stepCount:e.stepCount||20,featureDescriptor:e.featureDescriptor||`Virtual ${e.capability}`}:(null==(n=this.notify)||n.call(this,"status:virtual",{message:`Invalid capability for actuator ${i}, using linear`,type:"error"}),{capability:pp.LINEAR,name:`Actuator ${i}`})})}_rebuildMessageAttributes(){var e;this.messageAttributes={};const t=[],i=[],n=[];this.actuatorConfig.forEach((e,r)=>{const s={Index:r,StepCount:e.stepCount||20,FeatureDescriptor:e.featureDescriptor||e.name};switch(e.capability){case pp.VIBRATE:t.push({...s,ActuatorType:"Vibrate"});break;case pp.OSCILLATE:t.push({...s,ActuatorType:"Oscillate"});break;case pp.LINEAR:i.push(s);break;case pp.ROTATE:n.push(s)}}),t.length>0&&(this.messageAttributes.ScalarCmd=t),i.length>0&&(this.messageAttributes.LinearCmd=i),n.length>0&&(this.messageAttributes.RotateCmd=n),this.messageAttributes.StopDeviceCmd={},null==(e=this.notify)||e.call(this,"status:virtual",{message:`MessageAttributes rebuilt: ${Object.keys(this.messageAttributes).join(", ")}`,type:"log"})}async vibrate(e){return this._countCommand("ScalarCmd","Vibrate",e),Promise.resolve()}async oscillate(e){return this._countCommand("ScalarCmd","Oscillate",e),Promise.resolve()}async linear(e){return this._countCommand("LinearCmd",null,e),Promise.resolve()}async rotate(e){return this._countCommand("RotateCmd",null,e),Promise.resolve()}async stop(){return this._countCommand("StopDeviceCmd"),Promise.resolve()}getAllowedMessages(){return Object.keys(this.messageAttributes)}_countCommand(e,t=null,i=null){this.commandCounts.total++,this.commandCounts.lastCommand=e,this.commandCounts.lastCommandTime=Date.now();this._getAffectedActuators(e,t,i).forEach(e=>{this.commandCounts.byActuator.has(e)||this.commandCounts.byActuator.set(e,0),this.commandCounts.byActuator.set(e,this.commandCounts.byActuator.get(e)+1)})}_getAffectedActuators(e,t,i){const n=[];return"StopDeviceCmd"===e?this.actuatorConfig.map((e,t)=>t):(this.actuatorConfig.forEach((i,r)=>{let s=!1;"ScalarCmd"===e&&t?s="Vibrate"===t&&i.capability===pp.VIBRATE||"Oscillate"===t&&i.capability===pp.OSCILLATE:"LinearCmd"===e?s=i.capability===pp.LINEAR:"RotateCmd"===e&&(s=i.capability===pp.ROTATE),s&&n.push(r)}),n)}_resetCommandCounts(){var e;this.commandCounts={total:0,byActuator:new Map,lastCommand:null,lastCommandTime:null},null==(e=this.notify)||e.call(this,"status:virtual",{message:"Command counts reset",type:"log"})}getConfig(){return{actuatorCount:this.actuatorConfig.length,actuators:this.actuatorConfig.map((e,t)=>({index:t,capability:e.capability,name:e.name})),presets:this.getAvailablePresets()}}getAvailablePresets(){return["default","simple","stroker","multi-vibe","full-featured","rotator"]}addActuator(e,t=null){var i,n;const r={capability:e,name:t||`${e} ${this.actuatorConfig.length}`,stepCount:20,featureDescriptor:`Virtual ${e}`};return this.actuatorConfig.push(r),this._rebuildMessageAttributes(),null==(i=this.notify)||i.call(this,"status:virtual",{message:`Added ${e} actuator`,type:"success"}),null==(n=this.notify)||n.call(this,"buttplug:device",{device:this,actuatorAdded:!0,newActuator:r}),!0}removeActuator(e){var t,i,n;if(e<0||e>=this.actuatorConfig.length)return null==(t=this.notify)||t.call(this,"status:virtual",{message:`Invalid actuator index ${e}`,type:"error"}),!1;const r=this.actuatorConfig.splice(e,1)[0];return this._rebuildMessageAttributes(),this._resetCommandCounts(),null==(i=this.notify)||i.call(this,"status:virtual",{message:`Removed actuator ${e} (${r.capability})`,type:"success"}),null==(n=this.notify)||n.call(this,"buttplug:device",{device:this,actuatorRemoved:!0,removedActuator:r}),!0}getCommandStats(){const e={};return this.commandCounts.byActuator.forEach((t,i)=>{const n=this.actuatorConfig[i];e[i]={count:t,capability:(null==n?void 0:n.capability)||"unknown",name:(null==n?void 0:n.name)||`Actuator ${i}`}}),{total:this.commandCounts.total,byActuator:e,lastCommand:this.commandCounts.lastCommand,lastCommandTime:this.commandCounts.lastCommandTime,actuatorCount:this.actuatorConfig.length}}resetCommandStats(){var e;this._resetCommandCounts(),null==(e=this.notify)||e.call(this,"status:virtual",{message:"Command stats reset",type:"info"})}getDebugInfo(){var e;const t={config:this.getConfig(),stats:this.getCommandStats(),messageAttributes:this.messageAttributes,name:this.name,index:this.index};return null==(e=this.notify)||e.call(this,"status:virtual",{message:"Debug info requested",type:"log"}),t}}class gp{constructor(e,t,i={},n=null){var r;this.index=e,this.type=fp[t],this.capability=t,this.notify=n,this.settings={enabled:!0,scale:1,invert:!1,timeOffset:0,range:[0,1],...i.settings},this.assignedChannel=null,this.previousMappedChannel=null,this.metadata={name:`Actuator ${e}`,featureDescriptor:"",stepCount:20,...i.metadata},null==(r=this.notify)||r.call(this,"status:actuator",{message:`Actuator ${e} (${t}) initialized`,type:"log"})}plug(e){var t,i,n;const r=e.plug(this);return r?(this.previousMappedChannel=e.name,null==(t=this.notify)||t.call(this,"status:actuator",{message:`Actuator ${this.index} plugged to channel "${e.name}"`,type:"success"}),null==(i=this.notify)||i.call(this,"actuator:plugged",{actuatorIndex:this.index,channelName:e.name,channel:{name:e.name,type:e.type,duration:e.duration},actuator:{index:this.index,type:this.type,capability:this.capability}})):null==(n=this.notify)||n.call(this,"status:actuator",{message:`Failed to plug actuator ${this.index} to channel "${e.name}" (incompatible)`,type:"error"}),r}unplug(){var e,t,i;if(this.assignedChannel){const i=this.assignedChannel.name;this.previousMappedChannel||(this.previousMappedChannel=i),this.assignedChannel.unplug(this),null==(e=this.notify)||e.call(this,"status:actuator",{message:`Actuator ${this.index} unplugged from channel "${i}"`,type:"info"}),null==(t=this.notify)||t.call(this,"actuator:unplugged",{actuatorIndex:this.index,channelName:i,actuator:{index:this.index,type:this.type,capability:this.capability}})}else null==(i=this.notify)||i.call(this,"status:actuator",{message:`Actuator ${this.index} was not plugged to any channel`,type:"info"})}forgetPreviousMapping(){var e,t;const i=this.previousMappedChannel;this.previousMappedChannel=null,null==(e=this.notify)||e.call(this,"status:actuator",{message:`Actuator ${this.index} forgot previous mapping to "${i}"`,type:"info"}),null==(t=this.notify)||t.call(this,"actuator:mappingForgotten",{actuatorIndex:this.index,forgottenChannelName:i,actuator:{index:this.index,type:this.type,capability:this.capability}})}canPlugTo(e){var t;const i=this.settings.enabled&&this.type===e.type;return i||null==(t=this.notify)||t.call(this,"status:actuator",{message:`Actuator ${this.index} incompatible with channel "${e.name}" (${this.type} vs ${e.type})`,type:"log"}),i}getAssignedChannelName(){return this.assignedChannel?this.assignedChannel.name:null}getPreviousMappedChannelName(){return this.previousMappedChannel}hasPreviousMapping(){return null!==this.previousMappedChannel}isPlugged(){return null!==this.assignedChannel}updateSettings(e){var t,i;const n={...this.settings};this.settings={...this.settings,...e};const r=Object.keys(e);null==(t=this.notify)||t.call(this,"status:actuator",{message:`Actuator ${this.index} settings updated: ${r.join(", ")}`,type:"log"}),null==(i=this.notify)||i.call(this,"actuator:settingsChanged",{actuatorIndex:this.index,oldSettings:n,newSettings:{...this.settings},changes:r,actuator:{index:this.index,type:this.type,capability:this.capability,channelName:this.getAssignedChannelName()}})}resetSettings(){var e,t;const i={...this.settings};this.settings={enabled:!0,scale:1,invert:!1,timeOffset:0,range:[0,1]},null==(e=this.notify)||e.call(this,"status:actuator",{message:`Actuator ${this.index} settings reset to defaults`,type:"info"}),null==(t=this.notify)||t.call(this,"actuator:settingsReset",{actuatorIndex:this.index,oldSettings:i,newSettings:{...this.settings},actuator:{index:this.index,type:this.type,capability:this.capability,channelName:this.getAssignedChannelName()}})}isCompatibleWith(e){return this.type===e.type}canProcess(e){var t,i;return this.settings.enabled?this.assignedChannel&&this.assignedChannel!==e?(null==(i=this.notify)||i.call(this,"status:actuator",{message:`Actuator ${this.index} cannot process: assigned to different channel`,type:"log"}),!1):this.isCompatibleWith(e):(null==(t=this.notify)||t.call(this,"status:actuator",{message:`Actuator ${this.index} cannot process: disabled`,type:"log"}),!1)}processValue(e,t=1){if(!this.settings.enabled||null==e)return 0;let i=e;this.settings.invert&&(i=this.type===dp?-i:1-i),i*=this.settings.scale,i*=t;const[n,r]=this.settings.range;if(this.type===dp){const e=Math.abs(i),t=Math.max(0,Math.min(1,e));i=Math.sign(i)*t}else i=Math.max(0,Math.min(1,i));return i}generateCommand(e,t={}){if(!this.settings.enabled||0===e)return{capability:this.capability,value:0,options:{}};const i={capability:this.capability,value:e,options:{}};switch(this.capability){case pp.LINEAR:i.options.duration=t.duration||100;break;case pp.ROTATE:i.value=Math.abs(e),i.options.clockwise=e>=0}return i}process(e,t=1,i={}){const n=this.processValue(e,t);return this.generateCommand(n,i)}toConfig(){return{index:this.index,type:this.type,capability:this.capability,settings:{...this.settings},assignedChannelName:this.getAssignedChannelName(),previousMappedChannel:this.previousMappedChannel,metadata:{...this.metadata}}}fromConfig(e){var t,i;e.settings&&(this.settings,this.settings={...this.settings,...e.settings},null==(t=this.notify)||t.call(this,"status:actuator",{message:`Actuator ${this.index} loaded settings from config`,type:"log"})),e.metadata&&(this.metadata={...this.metadata,...e.metadata}),e.previousMappedChannel&&(this.previousMappedChannel=e.previousMappedChannel,null==(i=this.notify)||i.call(this,"status:actuator",{message:`Actuator ${this.index} restored previous mapping to "${e.previousMappedChannel}"`,type:"log"}))}getDebugInfo(){return{index:this.index,type:this.type,capability:this.capability,settings:{...this.settings},assignedChannel:this.assignedChannel?{name:this.assignedChannel.name,type:this.assignedChannel.type,duration:this.assignedChannel.duration}:null,previousMappedChannel:this.previousMappedChannel,isPlugged:this.isPlugged(),hasPreviousMapping:this.hasPreviousMapping(),metadata:{...this.metadata}}}toString(){const e=this.getAssignedChannelName()||"unassigned",t=this.settings.enabled?"enabled":"disabled",i=this.isPlugged()?"plugged":"unplugged",n=this.previousMappedChannel?` (prev: ${this.previousMappedChannel})`:"";return`Actuator[${this.index}](${this.capability}, ${this.type}, ${t}, ${i} to ${e}${n})`}}class yp{constructor(e){i(this,"_sendScalarCommand",async(e,t,i=null)=>{var n;if(!this.selectedDevice)throw new Error("No device selected");const r=e===cp.ActuatorType.Vibrate?pp.VIBRATE:pp.OSCILLATE;if(null===this._resolveActuatorIndex(r,i))throw new Error(`No ${e} actuator available`);try{const i=Math.max(0,Math.min(1,t));return e===cp.ActuatorType.Vibrate?await this.selectedDevice.vibrate(i):e===cp.ActuatorType.Oscillate&&await this.selectedDevice.oscillate(i),!0}catch(s){return null==(n=this.notify)||n.call(this,"status:buttplug",{message:`${e} command failed: ${s.message}`,type:"log"}),!1}}),i(this,"_resolveActuatorIndex",(e,t)=>{if(null!=t){const i=this.getActuator(t);return i&&i.capability===e?t:null}const i=this.getActuatorsByCapability(e);return i.length>0?i[0].index:null}),i(this,"_resetDevice",()=>{this.selectedDevice=this.virtualDevice,this._initActuators(),this._notifyDeviceChanged(this.virtualDevice)}),i(this,"_resetConnectionState",()=>{var e;this.isConnected=!1,this.isScanning=!1,this.devices.clear(),this.devices.set(-1,this.virtualDevice),this.throttleMap.clear(),this._resetDevice(),null==(e=this.notify)||e.call(this,"buttplug:connection",{connected:!1})}),i(this,"_onDeviceAdded",e=>{var t,i;this.devices.set(e.index,e),null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Device connected: ${e.name}`,type:"success"}),null==(i=this.notify)||i.call(this,"buttplug:device",{device:void 0})}),i(this,"_onDeviceRemoved",e=>{var t,i,n;this.devices.delete(e.index),(null==(t=this.selectedDevice)?void 0:t.index)===e.index&&this.selectDevice(-1),null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Device disconnected: ${e.name}`,type:"info"}),null==(n=this.notify)||n.call(this,"buttplug:device",{device:void 0})}),i(this,"_onDisconnect",()=>{var e;null==(e=this.notify)||e.call(this,"status:buttplug",{message:"Lost connection to Intiface Central",type:"error"}),this._resetConnectionState()}),this.notify=e,this.client=null,this.connector=null,this.initialized=!1,this.intifaceUrl="ws://localhost:12345",this.devices=new Map,this.isConnected=!1,this.isScanning=!1,this.virtualDevice=new mp(this.notify),this.devices.set(-1,this.virtualDevice),this.selectedDevice=this.virtualDevice,this.actuators=[],this._initActuators(),this.globalScale=1,this.globalOffset=0,this.throttleMap=new Map,this.minCommandInterval=16}async init(){var e,t,i,n;if(this.initialized)return!0;try{return null==(e=this.notify)||e.call(this,"status:buttplug",{message:"Initializing ButtPlug client...",type:"processing"}),this.client=new cp.ButtplugClient("FunPlayer"),this.connector=new cp.ButtplugBrowserWebsocketClientConnector(this.intifaceUrl),this.client.addListener("deviceadded",this._onDeviceAdded),this.client.addListener("deviceremoved",this._onDeviceRemoved),this.client.addListener("disconnect",this._onDisconnect),this.initialized=!0,null==(t=this.notify)||t.call(this,"status:buttplug",{message:"ButtPlug client initialized successfully",type:"log"}),!0}catch(r){return null==(i=this.notify)||i.call(this,"status:buttplug",{message:"Failed to initialize ButtPlug client",type:"error",error:r.message||String(r)}),null==(n=this.notify)||n.call(this,"buttplug:error",{message:"Initialization failed",error:r.message||String(r)}),!1}}async connect(e=null){var t,i,n,r,s,a;if(this.isConnected)return!0;const o=e||this.intifaceUrl;if(!this.initialized){if(!(await this.init()))return!1}this.connector._url!==o&&(this.connector=new cp.ButtplugBrowserWebsocketClientConnector(o));try{null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Connecting to ${o}...`,type:"processing"}),await this.client.connect(this.connector),this.isConnected=!0,e&&e!==this.intifaceUrl&&this.setIntifaceUrl(e);const s=this.client.devices;return s.forEach(e=>{this.devices.set(e.index,e)}),null==(i=this.notify)||i.call(this,"status:buttplug",{message:"Connected to Intiface Central",type:"success"}),null==(n=this.notify)||n.call(this,"status:buttplug",{message:`Found ${s.length} existing devices (+ Virtual)`,type:"log"}),null==(r=this.notify)||r.call(this,"buttplug:connection",{connected:!0}),!0}catch(l){return null==(s=this.notify)||s.call(this,"status:buttplug",{message:"Failed to connect to Intiface Central",type:"error",error:l.message||String(l)}),null==(a=this.notify)||a.call(this,"buttplug:error",{message:"Connection failed",error:l.message||String(l)}),!1}}async scan(e=5e3){var t,i,n,r;if(!this.isConnected||this.isScanning)return[];try{this.isScanning=!0;const r=new Set(this.devices.keys());null==(t=this.notify)||t.call(this,"status:buttplug",{message:"Scanning for devices...",type:"processing"}),await this.client.startScanning(),await new Promise(t=>setTimeout(t,e)),await this.client.stopScanning();this.client.devices.forEach(e=>{this.devices.set(e.index,e)});const s=Array.from(this.devices.values()).filter(e=>!r.has(e.index));return s.length>0?null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Found ${s.length} new device(s)`,type:"success"}):null==(n=this.notify)||n.call(this,"status:buttplug",{message:"No new devices found",type:"info"}),s}catch(s){return null==(r=this.notify)||r.call(this,"status:buttplug",{message:"Device scan failed",type:"error",error:s.message||String(s)}),[]}finally{this.isScanning=!1}}async disconnect(){var e,t;if(this.isConnected){try{this.client&&await this.client.disconnect(),null==(e=this.notify)||e.call(this,"status:buttplug",{message:"Disconnected from Intiface Central",type:"info"})}catch(i){null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Disconnect error: ${i.message}`,type:"log"})}this._resetConnectionState()}}selectDevice(e){var t,i,n;if(null==e)return this.selectDevice(-1);const r=this.devices.get(e);if(!r)return null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Device ${e} not found`,type:"error"}),!1;this.selectedDevice=r,this._initActuators();const s=-1===e?"Virtual Device":r.name;return null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Selected: ${s}`,type:"success"}),null==(n=this.notify)||n.call(this,"buttplug:device",{device:r}),!0}_initActuators(){var e;this.actuators.forEach(e=>e.unplug()),this.actuators=[],this.selectedDevice&&(this.actuators=this._buildActuators(this.selectedDevice),null==(e=this.notify)||e.call(this,"status:buttplug",{message:`Built ${this.actuators.length} actuators for ${this.selectedDevice.name}`,type:"log"}))}_buildActuators(e){var t,i,n;const r=e.messageAttributes,s=[];return null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Building actuators for device: ${e.name}`,type:"log"}),null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Device messageAttributes: ${JSON.stringify(r)}`,type:"log"}),r.ScalarCmd&&r.ScalarCmd.forEach(t=>{var i,n,r,a,o;let l;if(null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Processing ScalarCmd attr: ${JSON.stringify(t)}`,type:"log"}),t.ActuatorType===cp.ActuatorType.Vibrate?(null==(n=this.notify)||n.call(this,"status:buttplug",{message:"Matched Vibrate actuator",type:"log"}),l=pp.VIBRATE):t.ActuatorType===cp.ActuatorType.Oscillate?(null==(r=this.notify)||r.call(this,"status:buttplug",{message:"Matched Oscillate actuator",type:"log"}),l=pp.OSCILLATE):null==(a=this.notify)||a.call(this,"status:buttplug",{message:`No match for ActuatorType: ${t.ActuatorType}`,type:"log"}),l){null==(o=this.notify)||o.call(this,"status:buttplug",{message:`Creating actuator with capability: ${l}`,type:"log"});const i=new gp(t.Index,l,{metadata:{name:`${e.name} #${t.Index}`,featureDescriptor:t.FeatureDescriptor||"",stepCount:t.StepCount||20}},this.notify);s.push(i)}}),r.LinearCmd&&r.LinearCmd.forEach(t=>{var i;null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Processing LinearCmd attr: ${JSON.stringify(t)}`,type:"log"});const n=new gp(t.Index,pp.LINEAR,{metadata:{name:`${e.name} #${t.Index}`,featureDescriptor:t.FeatureDescriptor||"",stepCount:t.StepCount||20}},this.notify);s.push(n)}),r.RotateCmd&&r.RotateCmd.forEach(t=>{var i;null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Processing RotateCmd attr: ${JSON.stringify(t)}`,type:"log"});const n=new gp(t.Index,pp.ROTATE,{metadata:{name:`${e.name} #${t.Index}`,featureDescriptor:t.FeatureDescriptor||"",stepCount:t.StepCount||20}},this.notify);s.push(n)}),s.sort((e,t)=>e.index-t.index),null==(n=this.notify)||n.call(this,"status:buttplug",{message:`Final actuators array: ${s.length} actuators`,type:"log"}),s}getActuators(){return[...this.actuators]}getActuator(e){return this.actuators.find(t=>t.index===e)||null}getActuatorsByCapability(e){return this.actuators.filter(t=>t.capability===e)}setActuatorSettings(e,t){var i;const n=this.getActuator(e);return!!n&&(n.updateSettings(t),null==(i=this.notify)||i.call(this,"buttplug:actuatorOptions",{actuatorIndex:e,options:n.settings}),!0)}getActuatorSettings(e){const t=this.getActuator(e);return t?{...t.settings}:null}plugChannelToActuator(e,t){var i;const n=this.getActuator(t);if(!n)return!1;const r=e.plug(n);return r&&(null==(i=this.notify)||i.call(this,"buttplug:mapping",{channel:e.name,actuatorIndex:t})),r}unplugChannelFromActuator(e,t){var i;const n=this.getActuator(t);return!!n&&(e.unplug(n),null==(i=this.notify)||i.call(this,"buttplug:mapping",{channel:e.name,actuatorIndex:null}),!0)}unplugAllChannels(){var e;this.actuators.forEach(e=>e.unplug()),null==(e=this.notify)||e.call(this,"buttplug:mapping",{channel:null,actuatorIndex:null})}setGlobalScale(e){var t;const i="number"==typeof e?Math.max(0,Math.min(5,e)):1;this.globalScale!==i&&(this.globalScale=i,null==(t=this.notify)||t.call(this,"buttplug:globalScale",{scale:i}))}getGlobalScale(){return this.globalScale}setGlobalOffset(e){var t;const i="number"==typeof e?e:0;this.globalOffset!==i&&(this.globalOffset=i,null==(t=this.notify)||t.call(this,"buttplug:globalOffset",{offset:i}))}getGlobalOffset(){return this.globalOffset}getTimeWithOffsets(e){const t=new Map;for(const i of this.actuators)if(i.isPlugged()&&i.settings.enabled){const n=i.assignedChannel,r=e+this.globalOffset+i.settings.timeOffset;t.set(n.name,r)}return t}async processChannels(e){if(!this.selectedDevice)return new Map;const t=new Map;for(const i of this.actuators)if(i.isPlugged()&&i.settings.enabled){const n=e[i.assignedChannel.name];if(null!=n){const e=i.process(n,this.globalScale);await this.sendThrottled(i.capability,e.value,i.index,e.options),t.set(i.index,{value:e.value,type:i.capability})}}return t}async vibrate(e,t=null){return this._sendScalarCommand(cp.ActuatorType.Vibrate,e,t)}async oscillate(e,t=null){return this._sendScalarCommand(cp.ActuatorType.Oscillate,e,t)}async linear(e,t=100,i=null){var n;if(!this.selectedDevice)throw new Error("No device selected");if(null===this._resolveActuatorIndex(pp.LINEAR,i))throw new Error("No linear actuator available");try{const i=Math.max(0,Math.min(1,e)),n=Math.max(1,Math.min(2e4,t));return await this.selectedDevice.linear([[i,n]]),!0}catch(r){return null==(n=this.notify)||n.call(this,"status:buttplug",{message:`Linear command failed: ${r.message}`,type:"log"}),!1}}async rotate(e,t=null){var i;if(!this.selectedDevice)throw new Error("No device selected");if(null===this._resolveActuatorIndex(pp.ROTATE,t))throw new Error("No rotate actuator available");try{const t=Math.abs(e),i=e>=0;return await this.selectedDevice.rotate([[t,i]]),!0}catch(n){return null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Rotate command failed: ${n.message}`,type:"log"}),!1}}async sendThrottled(e,t,i,n={}){var r;const s=Date.now(),a=`${e}-${i}`;if(s-(this.throttleMap.get(a)||0)<this.minCommandInterval&&!n.force)return!0;this.throttleMap.set(a,s);try{switch(e){case pp.VIBRATE:return await this.vibrate(t,i);case pp.OSCILLATE:return await this.oscillate(t,i);case pp.LINEAR:return await this.linear(t,n.duration||100,i);case pp.ROTATE:return await this.rotate(t,i);default:return null==(r=this.notify)||r.call(this,"status:buttplug",{message:`Unknown capability: ${e}`,type:"log"}),!1}}catch(o){return!1}}async stopAll(){var e,t;if(this.isConnected&&this.client)try{await this.client.stopAllDevices(),null==(e=this.notify)||e.call(this,"status:buttplug",{message:"All devices stopped",type:"log"})}catch(i){null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Stop all failed: ${i.message}`,type:"log"})}}getDevices(){return Array.from(this.devices.values())}getSelected(){return this.selectedDevice}getDeviceInfo(){return this.selectedDevice?{deviceName:this.selectedDevice.name,deviceIndex:this.selectedDevice.index,actuatorCount:this.actuators.length,actuators:this.actuators.map(e=>({index:e.index,type:e.type,capability:e.capability,enabled:e.settings.enabled,assignedChannel:e.getAssignedChannelName(),metadata:e.metadata})),messageTimingGap:this.selectedDevice.messageTimingGap||0}:null}getStatus(){return{isConnected:this.isConnected,isScanning:this.isScanning,deviceCount:this.devices.size,selectedDevice:this.selectedDevice?{index:this.selectedDevice.index,name:this.selectedDevice.name}:null,actuatorCount:this.actuators.length,globalScale:this.globalScale,globalOffset:this.globalOffset,config:{intifaceUrl:this.intifaceUrl}}}setIntifaceUrl(e){var t,i;const n=this._validateAndCleanUrl(e);if(this.intifaceUrl!==n){const e=this.isConnected,r=this.intifaceUrl;this.intifaceUrl=n,this.connector&&this.connector._url!==n&&(this.connector=new cp.ButtplugBrowserWebsocketClientConnector(n)),null==(t=this.notify)||t.call(this,"status:buttplug",{message:`URL changed: ${r}  ${n}`,type:"log"}),null==(i=this.notify)||i.call(this,"buttplug:config",{key:"intifaceUrl",data:{oldUrl:r,newUrl:n,wasConnected:e}})}}getIntifaceUrl(){return this.intifaceUrl}_validateAndCleanUrl(e){var t;if(!e||"string"!=typeof e)return"ws://localhost:12345";let i=e.trim();i.startsWith("ws://")||i.startsWith("wss://")||(i="ws://"+i);try{const e=new URL(i);e.port||(e.port="12345",i=e.toString())}catch(n){return null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Invalid WebSocket URL, using default: ${e}`,type:"log"}),"ws://localhost:12345"}return i}async cleanup(){var e,t,i,n;if(this.isConnected&&this.client)try{await this.client.stopAllDevices()}catch(r){null==(e=this.notify)||e.call(this,"status:buttplug",{message:`Stop all devices failed during cleanup: ${r.message}`,type:"log"})}if(this.isConnected&&this.client)try{await this.client.disconnect()}catch(r){null==(t=this.notify)||t.call(this,"status:buttplug",{message:`Disconnect failed during cleanup: ${r.message}`,type:"log"})}if(this.client){try{this.client.removeAllListeners()}catch(r){null==(i=this.notify)||i.call(this,"status:buttplug",{message:`Remove listeners failed during cleanup: ${r.message}`,type:"log"})}this.client=null}this.connector=null,this.throttleMap.clear(),this.actuators.forEach(e=>e.unplug()),this.actuators=[],this.initialized=!1,this.isConnected=!1,this.isScanning=!1,this.devices.clear(),this.devices.set(-1,this.virtualDevice),this._resetDevice(),null==(n=this.notify)||n.call(this,"status:buttplug",{message:"ButtPlug cleanup completed",type:"log"})}}class vp{constructor(e,t,i={},n={},r=null){var s,a;if(!e||"string"!=typeof e)throw new Error("Channel name must be a non-empty string");if(this.name=e,this.metadata=n,this.notify=r,this.fieldConfig={timeField:"at",valueField:"pos",directionField:null,durationField:null,...i},!this.fieldConfig.timeField||!this.fieldConfig.valueField)throw new Error(`Channel "${e}": timeField and valueField must be specified`);this.interpolationCache={leftIndex:0,rightIndex:1,lastTime:-1},this.seekThreshold=1e3,this.connectedActuators=new Map,null==(s=this.notify)||s.call(this,"status:channel",{message:`Creating channel "${e}"...`,type:"log"}),this.actions=this._processActions(t),this.likelyCapability=this._determineLikelyCapability(),this.type=this._determineType(),this.duration=this._calculateDuration(),this.valueRange=this._calculateValueRange(),null==(a=this.notify)||a.call(this,"status:channel",{message:`Channel "${e}" created: ${this.type} type, likely_capability: ${this.likelyCapability}, ${this.actions.length} actions, ${this.duration.toFixed(2)}s`,type:"success"})}_determineLikelyCapability(){var e,t;if(this.metadata.capability)return null==(e=this.notify)||e.call(this,"status:channel",{message:`Channel "${this.name}": Using explicit capability from metadata: ${this.metadata.capability}`,type:"log"}),this.metadata.capability;const i=this._heuristicCapabilityAnalysis(),n=this._validateCapabilityWithContext(i);return null==(t=this.notify)||t.call(this,"status:channel",{message:`Channel "${this.name}": Likely capability determined as "${n}" (from heuristic: "${i}")`,type:"log"}),n}_heuristicCapabilityAnalysis(){var e;const t=this.name.toLowerCase(),i=[{capability:pp.ROTATE,regex:/^(rot|rotat|twist|spin|turn|roll|angle|pitch|yaw)$/i},{capability:pp.LINEAR,regex:/^(pos|position|stroke|linear|up|down|vertical|y)$/i},{capability:pp.OSCILLATE,regex:/^(osc|oscill|swing|wave|sway)$/i},{capability:pp.VIBRATE,regex:/^(vib|vibr|vibrat|buzz|rumble|shake)$/i},{capability:pp.VIBRATE,regex:/^(squeeze|constrict|pressure|grip|clamp)$/i},{capability:pp.VIBRATE,regex:/^(suck|suction|vacuum|pump)$/i}];for(const{capability:n,regex:r}of i)if(r.test(t))return null==(e=this.notify)||e.call(this,"status:channel",{message:`Channel "${this.name}": Pattern match for ${n}`,type:"log"}),n;return this._inferCapabilityFromFieldConfig()}_inferCapabilityFromFieldConfig(){var e,t,i,n,r;if(this.fieldConfig.directionField)return null==(e=this.notify)||e.call(this,"status:channel",{message:`Channel "${this.name}": Direction field detected, suggesting rotate`,type:"log"}),pp.ROTATE;if(this.fieldConfig.durationField)return null==(t=this.notify)||t.call(this,"status:channel",{message:`Channel "${this.name}": Duration field detected, suggesting linear`,type:"log"}),pp.LINEAR;const s=this.fieldConfig.valueField.toLowerCase();return s.includes("speed")||s.includes("spd")?(null==(i=this.notify)||i.call(this,"status:channel",{message:`Channel "${this.name}": Speed field detected, suggesting rotate`,type:"log"}),pp.ROTATE):s.includes("pos")||s.includes("position")?(null==(n=this.notify)||n.call(this,"status:channel",{message:`Channel "${this.name}": Position field detected, suggesting linear`,type:"log"}),pp.LINEAR):(null==(r=this.notify)||r.call(this,"status:channel",{message:`Channel "${this.name}": No clear indicators, defaulting to linear`,type:"log"}),pp.LINEAR)}_validateCapabilityWithContext(e){var t,i;const n=this.actions.some(e=>e.value<0),r=!!this.fieldConfig.directionField;return e!==pp.ROTATE||r||n?e===pp.LINEAR&&r?(null==(i=this.notify)||i.call(this,"status:channel",{message:`Channel "${this.name}": Linear detected but has direction field, upgrading to rotate`,type:"log"}),pp.ROTATE):e:(null==(t=this.notify)||t.call(this,"status:channel",{message:`Channel "${this.name}": Rotate detected but no rotation data, downgrading to linear`,type:"warning"}),pp.LINEAR)}plug(e){var t,i,n;return this.canPlugTo(e)?(e.assignedChannel&&e.assignedChannel!==this&&e.assignedChannel.unplug(e),this.connectedActuators.set(e.index,e),e.assignedChannel=this,e.previousMappedChannel=this.name,null==(i=this.notify)||i.call(this,"status:channel",{message:`Channel "${this.name}" plugged to actuator ${e.index} (${e.capability})`,type:"success"}),null==(n=this.notify)||n.call(this,"channel:plugged",{channelName:this.name,actuatorIndex:e.index,actuator:{index:e.index,type:e.type,capability:e.capability},connectedCount:this.connectedActuators.size}),!0):(null==(t=this.notify)||t.call(this,"status:channel",{message:`Cannot plug actuator ${e.index} to channel "${this.name}" (incompatible: ${e.type} vs ${this.type})`,type:"error"}),!1)}unplug(e){var t,i,n;this.connectedActuators.get(e.index)===e?(this.connectedActuators.delete(e.index),e.assignedChannel===this&&(e.assignedChannel=null),null==(t=this.notify)||t.call(this,"status:channel",{message:`Channel "${this.name}" unplugged from actuator ${e.index}`,type:"info"}),null==(i=this.notify)||i.call(this,"channel:unplugged",{channelName:this.name,actuatorIndex:e.index,actuator:{index:e.index,type:e.type,capability:e.capability},connectedCount:this.connectedActuators.size})):null==(n=this.notify)||n.call(this,"status:channel",{message:`Actuator ${e.index} was not connected to channel "${this.name}"`,type:"warning"})}unplugAll(){Array.from(this.connectedActuators.values()).forEach(e=>this.unplug(e))}canPlugTo(e){return e.settings.enabled&&this.type===e.type}getConnectedActuators(){return Array.from(this.connectedActuators.values())}getLikelyCapability(){return this.likelyCapability}getMetadata(){return{...this.metadata}}hasActions(){return this.actions.length>0}getActionCount(){return this.actions.length}_processActions(e){var t,i,n,r,s,a,o;if(!Array.isArray(e)||0===e.length)return null==(t=this.notify)||t.call(this,"status:channel",{message:`Channel "${this.name}": No actions provided`,type:"error"}),[];null==(i=this.notify)||i.call(this,"status:channel",{message:`Channel "${this.name}": Processing ${e.length} raw actions...`,type:"log"});const{timeField:l,valueField:u,directionField:c}=this.fieldConfig,h=[];for(const[f,m]of e.entries()){const e=m[l];let t=m[u];if(c&&void 0!==m[c]){const e=m[c],i=Math.abs(t);if(t<0&&(null==(n=this.notify)||n.call(this,"status:channel",{message:`Channel "${this.name}": Negative value with direction field, applying Math.abs()`,type:"warning"})),"boolean"==typeof e)t=e?i:-i;else if("string"==typeof e){t=["cw","clockwise","right","positive","+","true","1"].includes(e.toLowerCase())?i:-i}else"number"==typeof e?t=e>=0?i:-i:(null==(r=this.notify)||r.call(this,"status:channel",{message:`Channel "${this.name}": Invalid direction "${e}", using absolute value`,type:"warning"}),t=i)}if("number"==typeof e&&"number"==typeof t){const i={...m};delete i[l],delete i[u],c&&delete i[c],h.push({time:e,value:t,metadata:i})}else null==(s=this.notify)||s.call(this,"status:channel",{message:`Channel "${this.name}": Invalid action at index ${f} (time: ${typeof e}, value: ${typeof t})`,type:"log"})}if(0===h.length)throw null==(a=this.notify)||a.call(this,"status:channel",{message:`Channel "${this.name}": No valid actions found. Check "${l}" and "${u}" fields`,type:"error"}),new Error(`Channel "${this.name}": No valid actions. Check "${l}" and "${u}" fields.`);h.sort((e,t)=>e.time-t.time);const d=Math.max(...h.map(e=>Math.abs(e.value))),p=d>0?1/d:1;return null==(o=this.notify)||o.call(this,"status:channel",{message:`Channel "${this.name}": ${h.length} valid actions, normalization factor: ${p.toFixed(3)}`,type:"log"}),h.map(({time:e,value:t,metadata:i})=>({time:e,value:t*p,metadata:i}))}_determineType(){var e,t;if(0===this.actions.length)return hp;if(this.fieldConfig.directionField)return null==(e=this.notify)||e.call(this,"status:channel",{message:`Channel "${this.name}": Type determined as POLAR (has direction field)`,type:"log"}),dp;const i=this.actions.some(e=>e.value<0),n=i?dp:hp;return null==(t=this.notify)||t.call(this,"status:channel",{message:`Channel "${this.name}": Type determined as ${n} (${i?"has negative values":"all positive values"})`,type:"log"}),n}_calculateDuration(){var e;const t=this.actions.length>0?this.actions[this.actions.length-1].time/1e3:0;return null==(e=this.notify)||e.call(this,"status:channel",{message:`Channel "${this.name}": Duration calculated as ${t.toFixed(2)}s`,type:"log"}),t}_calculateValueRange(){var e;if(0===this.actions.length)return[0,0];const t=this.actions.map(e=>e.value),i=[Math.min(...t),Math.max(...t)];return null==(e=this.notify)||e.call(this,"status:channel",{message:`Channel "${this.name}": Value range: [${i[0].toFixed(3)}, ${i[1].toFixed(3)}]`,type:"log"}),i}interpolateAt(e){var t,i;if(0===this.actions.length)return 0;const n=1e3*e;if(n<=this.actions[0].time)return 0;if(n>=this.actions[this.actions.length-1].time)return 0;const{leftIndex:r,rightIndex:s,lastTime:a}=this.interpolationCache;(Math.abs(n-a)>this.seekThreshold||n<(null==(t=this.actions[r])?void 0:t.time)||n>(null==(i=this.actions[s])?void 0:i.time))&&this._updateInterpolationCache(n);const o=this.actions[this.interpolationCache.leftIndex],l=this.actions[this.interpolationCache.rightIndex],u=(n-o.time)/(l.time-o.time),c=o.value+u*(l.value-o.value);return this.interpolationCache.lastTime=n,c}_updateInterpolationCache(e){let t=0,i=this.actions.length-1;for(;i-t>1;){const n=Math.floor((t+i)/2);this.actions[n].time<=e?t=n:i=n}this.interpolationCache.leftIndex=t,this.interpolationCache.rightIndex=i}getDebugInfo(){const e={name:this.name,type:this.type,likelyCapability:this.likelyCapability,duration:this.duration,actionCount:this.actions.length,valueRange:this.valueRange,fieldConfig:{...this.fieldConfig},metadata:{...this.metadata},connectedActuators:Object.fromEntries(Array.from(this.connectedActuators.entries()).map(([e,t])=>[e,{index:t.index,type:t.type,enabled:t.settings.enabled}])),sampleActions:this.actions.slice(0,3).map(e=>({...e,metadata:e.metadata?e.metadata:void 0})),cache:{...this.interpolationCache}};return e}toString(){const e=`${this.fieldConfig.valueField}${this.fieldConfig.directionField?"+"+this.fieldConfig.directionField:""}`,t=this.connectedActuators.size;return`Channel[${this.name}](${this.type}/${this.likelyCapability}, ${e}, ${this.actions.length} actions, ${this.duration.toFixed(2)}s, ${t} actuators)`}}class _p{constructor(e){this.notify=e,this.data=null,this.channels=[],this.duration=0,this.customFieldConfig=null}async loadFromSource(e){var t,i;try{let i;return null==(t=this.notify)||t.call(this,"status:funscript",{message:"Loading funscript from source...",type:"processing"}),i="string"==typeof e?e.startsWith("http")||e.startsWith("/")?await this._fetchWithCorsProxy(e):JSON.parse(e):e,this.load(i)}catch(n){throw null==(i=this.notify)||i.call(this,"status:funscript",{message:"Failed to load funscript from source",type:"error",error:n.message}),n}}load(e){var t,i,n,r,s,a;try{return null==(t=this.notify)||t.call(this,"status:funscript",{message:"Processing funscript data...",type:"processing"}),this.data="string"==typeof e?JSON.parse(e):e,this._extractChannels(),this._calculateDuration(),null==(i=this.notify)||i.call(this,"status:funscript",{message:`Loaded ${this.channels.length} channels, ${this.duration.toFixed(2)}s`,type:"success"}),null==(n=this.notify)||n.call(this,"status:funscript",{message:`Channel extraction complete: ${this.channels.map(e=>e.name).join(", ")}`,type:"log"}),null==(r=this.notify)||r.call(this,"funscript:load",{data:this.data,channels:this.channels.map(e=>e.name),channelInstances:this.channels,duration:this.duration}),null==(s=this.notify)||s.call(this,"funscript:channels",{channels:this.channels.map(e=>e.name),channelInstances:this.channels,total:this.channels.length}),!0}catch(o){return null==(a=this.notify)||a.call(this,"status:funscript",{message:"Failed to process funscript",type:"error",error:o.message}),this._reset(),!1}}loadWithCustomFieldConfig(e,t=null){return this.customFieldConfig=t,this.load(e)}async loadFromPlaylistItem(e){var t,i,n,r;if(!e)return this.reset(),!0;try{return null==(t=this.notify)||t.call(this,"status:funscript",{message:`Loading funscript for item: ${e.name||"Untitled"}`,type:"processing"}),e.funscript?("object"==typeof e.funscript?this.load(e.funscript):await this.loadFromSource(e.funscript),null==(i=this.notify)||i.call(this,"status:funscript",{message:`Funscript loaded for: ${e.name||"Untitled"}`,type:"success"})):(this.reset(),null==(n=this.notify)||n.call(this,"status:funscript",{message:"No funscript for current item",type:"info"})),!0}catch(s){return null==(r=this.notify)||r.call(this,"status:funscript",{message:`Failed to load funscript from playlist item: ${s.message}`,type:"error"}),this.reset(),!1}}async _fetchWithCorsProxy(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}catch(t){try{const t=`https://corsproxy.io/?${encodeURIComponent(e)}`,i=await fetch(t);if(!i.ok)throw new Error(`HTTP ${i.status}`);return await i.json()}catch(i){throw new Error(`Failed to fetch funscript. Direct: ${t.message}, Proxy: ${i.message}`)}}}hasFunscript(){return this.channels.length>0}reset(){var e,t;this._reset(),null==(e=this.notify)||e.call(this,"status:funscript",{message:"Funscript manager reset",type:"info"}),null==(t=this.notify)||t.call(this,"funscript:reset",{})}_reset(){this.channels.forEach(e=>e.unplugAll()),this.data=null,this.channels=[],this.duration=0,this.customFieldConfig=null}getChannels(){return[...this.channels]}getChannelNames(){return this.channels.map(e=>e.name)}getChannel(e){return this.channels.find(t=>t.name===e)||null}hasChannel(e){return null!==this.getChannel(e)}getChannelsByType(e){return this.channels.filter(t=>t.type===e)}getDuration(){return this.duration}interpolateAll(e){const t={};for(const[i,n]of Object.entries(e)){const e=this.getChannel(i);if(e){const r=e.interpolateAt(n);null!=r&&(t[i]=r)}}return t}autoMapChannels(e){var t,i,n,r,s;if(0===this.channels.length)return null==(t=this.notify)||t.call(this,"status:funscript",{message:"No channels available for auto-mapping",type:"info"}),{suggestions:[],mapped:0,total:0,mode:"no channels"};if(!e||0===e.length)return null==(i=this.notify)||i.call(this,"status:funscript",{message:"No actuators available for auto-mapping",type:"info"}),{suggestions:[],mapped:0,total:this.channels.length,mode:"no actuators"};null==(n=this.notify)||n.call(this,"status:funscript",{message:`Starting auto-mapping for ${this.channels.length} channels with ${e.length} actuators...`,type:"processing"});const a=[];let o=0;for(const u of this.channels){const t=this._findBestActuatorMatch(u,e);t?(a.push({channelName:u.name,actuatorIndex:t.index,confidence:"high",reason:`${u.likelyCapability} match`}),o++):null==(r=this.notify)||r.call(this,"status:funscript",{message:`No compatible actuator found for channel "${u.name}" (${u.type}, likely: ${u.likelyCapability})`,type:"warning"})}const l=o===this.channels.length?"complete":o>0?"partial":"none";return null==(s=this.notify)||s.call(this,"status:funscript",{message:`Auto-mapping complete: ${o}/${this.channels.length} channels mapped`,type:o>0?"success":"warning"}),{suggestions:a,mapped:o,total:this.channels.length,mode:l}}_findBestActuatorMatch(e,t){var i,n,r,s;const a=t.filter(t=>t.settings.enabled&&e.canPlugTo(t));if(0===a.length)return null==(i=this.notify)||i.call(this,"status:funscript",{message:`No compatible actuators for channel "${e.name}" (${e.type})`,type:"log"}),null;const o=a.find(t=>t.capability===e.likelyCapability);if(o)return null==(n=this.notify)||n.call(this,"status:funscript",{message:`Perfect match: ${e.name}  ${o.capability} (likely_capability match)`,type:"log"}),o;const l=["linear","vibrate","oscillate","rotate"];for(const c of l){const t=a.find(e=>e.capability===c);if(t)return null==(r=this.notify)||r.call(this,"status:funscript",{message:`Fallback mapping: ${e.name}  ${c} (priority order)`,type:"log"}),t}const u=a[0]||null;return u&&(null==(s=this.notify)||s.call(this,"status:funscript",{message:`Last resort mapping: ${e.name}  ${u.capability} (first available)`,type:"log"})),u}_extractChannels(){var e,t,i,n,r,s,a;this.channels=[],null==(e=this.notify)||e.call(this,"status:funscript",{message:"Extracting channels from funscript data...",type:"processing"});const o=this._extractMetadata();if(null==(t=this.data.actions)?void 0:t.length){const e=this._createChannelFromActions("pos",this.data.actions,o);e&&(this.channels.push(e),null==(i=this.notify)||i.call(this,"status:funscript",{message:`Found main channel: ${e.name} (${this.data.actions.length} actions)`,type:"log"}))}if(this._extractMultiAxisChannels(o),this.data.tracks){null==(n=this.notify)||n.call(this,"status:funscript",{message:`Processing ${Object.keys(this.data.tracks).length} nested tracks...`,type:"log"});for(const[e,t]of Object.entries(this.data.tracks))if(null==(r=t.actions)?void 0:r.length){const i={...o,...t.metadata},n=this._createChannelFromActions(e,t.actions,i);n&&(this.channels.push(n),null==(s=this.notify)||s.call(this,"status:funscript",{message:`Found track channel: ${n.name} (${t.actions.length} actions)`,type:"log"}))}}if(0===this.channels.length)throw new Error("No valid channels found in funscript data");null==(a=this.notify)||a.call(this,"status:funscript",{message:`Channel extraction complete: ${this.channels.length} channels created`,type:"success"})}_extractMultiAxisChannels(e){var t,i;null==(t=this.notify)||t.call(this,"status:funscript",{message:"Scanning for multi-axis channels...",type:"log"});let n=0;for(const[r,s]of Object.entries(this.data))if(this._isActionArray(s)){if("actions"===r)continue;const t=this._createChannelFromActions(r,s,e);t&&(this.channels.push(t),n++)}n>0&&(null==(i=this.notify)||i.call(this,"status:funscript",{message:`Found ${n} multi-axis channels`,type:"log"}))}_isActionArray(e){return Array.isArray(e)&&e.length>0&&e.every(e=>"object"==typeof e&&null!==e&&(void 0!==e.at||void 0!==e.t||void 0!==e.time))}_createChannelFromActions(e,t,i={}){var n,r,s,a;try{if(null==(n=this.notify)||n.call(this,"status:funscript",{message:`Creating channel from field: ${e} (${t.length} actions)`,type:"log"}),this.customFieldConfig&&this.customFieldConfig[e]){const n=this.customFieldConfig[e],s={timeField:n.timeField||"at",valueField:n.valueField||"pos",directionField:n.directionField||null,durationField:n.durationField||null};return null==(r=this.notify)||r.call(this,"status:funscript",{message:`Using user-defined config for ${e}`,type:"success"}),new vp(e,t,s,{...i,originalField:e},this.notify)}const a=this._buildBasicFieldConfig(e,t,i),o=new vp(e,t,a,{...i,originalField:e},this.notify);return null==(s=this.notify)||s.call(this,"status:funscript",{message:`Channel created: ${o.name} (${o.type}, likely: ${o.likelyCapability}, ${o.actions.length} actions)`,type:"log"}),o}catch(o){return null==(a=this.notify)||a.call(this,"status:funscript",{message:`Failed to create channel "${e}": ${o.message}`,type:"error"}),null}}_buildBasicFieldConfig(e,t,i){var n;if(0===t.length)return{timeField:"at",valueField:"pos"};const r=t[0],s=Object.keys(r),a=this._detectTimeField(s),o=this._detectValueField(s,e),l=this._detectDirectionField(s),u=this._detectDurationField(s);return null==(n=this.notify)||n.call(this,"status:funscript",{message:`Field detection for ${e}: time=${a}, value=${o}, direction=${l||"none"}, duration=${u||"none"}`,type:"log"}),{timeField:a,valueField:o,directionField:l,durationField:u}}_detectTimeField(e){const t=["at","t","time","timestamp"];for(const i of t)if(e.includes(i))return i;return"at"}_detectValueField(e,t){if(e.includes(t.toLowerCase()))return t.toLowerCase();const i=["pos","position","value","val","v","speed","spd","s","scalar","intensity","i"];for(const n of i)if(e.includes(n))return n;return"pos"}_detectDirectionField(e){const t=["clockwise","cw","direction","dir","ccw","counterclockwise"];for(const i of t)if(e.includes(i))return i;return null}_detectDurationField(e){const t=["duration","dur","d"];for(const i of t)if(e.includes(i))return i;return null}_extractMetadata(){return this.data?{metadata:this.data.metadata||{},channels:this.data.channels||{},mapping:this.data.mapping||{},...this.data.metadata}:{}}_calculateDuration(){this.duration=Math.max(...this.channels.map(e=>e.duration),0)}getChannelSuggestions(){return this.channels.map(e=>({name:e.name,type:e.type,likelyCapability:e.likelyCapability,actionCount:e.getActionCount(),duration:e.duration}))}getDebugInfo(){return{loaded:this.hasFunscript(),channelCount:this.channels.length,duration:this.duration,channels:this.channels.map(e=>({name:e.name,type:e.type,likelyCapability:e.likelyCapability,actionCount:e.getActionCount(),connectedActuators:e.getConnectedActuators().length})),customFieldConfig:this.customFieldConfig,dataKeys:this.data?Object.keys(this.data):[]}}getChannelMetadata(e){const t=this.getChannel(e);return t?t.getMetadata():{}}hasNegativeValues(e){const t=this.getChannel(e);return!!t&&t.type===dp}getDetectedFields(){var e,t;if(!this.data)return{};const i={};(null==(e=this.data.actions)?void 0:e.length)>0&&(i.pos=this._analyzeFieldsInActions(this.data.actions));for(const[n,r]of Object.entries(this.data))this._isActionArray(r)&&"actions"!==n&&(i[n]=this._analyzeFieldsInActions(r));if(this.data.tracks)for(const[n,r]of Object.entries(this.data.tracks))(null==(t=r.actions)?void 0:t.length)&&(i[n]=this._analyzeFieldsInActions(r.actions));return i}_analyzeFieldsInActions(e){if(!e||0===e.length)return{availableTimeFields:["at"],availableValueFields:["pos"],availableDirectionFields:[],availableDurationFields:[],otherFields:[],sampleAction:null};const t=e[0],i=Object.keys(t);return{availableTimeFields:i.filter(e=>{const t=e.toLowerCase();return["at","t","time","timestamp","ms"].includes(t)}),availableValueFields:i.filter(e=>{const t=e.toLowerCase();return["pos","p","position","scalar","speed","spd","s","val","v","value","intensity","i"].includes(t)}),availableDirectionFields:i.filter(e=>{const t=e.toLowerCase();return["clockwise","cw","direction","dir","ccw","counterclockwise"].includes(t)}),availableDurationFields:i.filter(e=>{const t=e.toLowerCase();return["duration","dur","d","delay","ms","millis","time"].includes(t)}),otherFields:i.filter(e=>{const t=e.toLowerCase();return!["at","t","time","timestamp","ms","pos","p","position","scalar","speed","spd","s","val","v","value","intensity","i","clockwise","cw","direction","dir","ccw","counterclockwise","duration","dur","d","delay","millis"].includes(t)}),sampleAction:t}}}class bp{static detectMimeType(e){if(e.startsWith("data:")){const t=e.match(/data:([^;]+)/);return t?t[1]:"video/mp4"}return{mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",mov:"video/quicktime",avi:"video/x-msvideo",mkv:"video/x-matroska",m4v:"video/mp4",ogv:"video/ogg",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",m4a:"audio/mp4",aac:"audio/aac",flac:"audio/flac",oga:"audio/ogg",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",ism:"application/vnd.ms-sstr+xml",json:"application/json",funscript:"application/json"}[new URL(e,window.location.href).pathname.toLowerCase().split(".").pop()]||"video/mp4"}static generateSilentAudio(e){const t=44100,i=Math.floor(e*t),n=new ArrayBuffer(44+2*i),r=new DataView(n),s=(e,t)=>{for(let i=0;i<t.length;i++)r.setUint8(e+i,t.charCodeAt(i))};s(0,"RIFF"),r.setUint32(4,36+2*i,!0),s(8,"WAVE"),s(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,t,!0),r.setUint32(28,88200,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),s(36,"data"),r.setUint32(40,2*i,!0);for(let o=0;o<i;o++)r.setInt16(44+2*o,0,!0);const a=new Blob([n],{type:"audio/wav"});return URL.createObjectURL(a)}static generateSVGPoster(e,t){let i="";if(e.sources&&e.sources.length>0){const t=e.sources[0],n=t.src.toLowerCase(),r=(t.type||"").toLowerCase();r.startsWith("audio/")||[".mp3",".wav",".ogg",".m4a",".aac"].some(e=>n.includes(e))?i="":(r.startsWith("video/")||[".mp4",".webm",".mov",".avi",".mkv"].some(e=>n.includes(e)))&&(i="")}else e.funscript?i="":e.duration&&(i="");return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`<svg width="48" height="32" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="32" fill="#374151" rx="4"/><text x="24" y="20" text-anchor="middle" fill="white" font-size="16" font-family="system-ui">${i}</text></svg>`)}`}static extractFunscriptDuration(e){try{let t=e;if("string"==typeof e){if(e.startsWith("http")||e.startsWith("/"))return 0;t=JSON.parse(e)}if(!t||"object"!=typeof t)return 0;if(t.duration&&"number"==typeof t.duration)return t.duration;let i=0;if(t.actions&&Array.isArray(t.actions)&&t.actions.length>0){const e=t.actions[t.actions.length-1];e&&"number"==typeof e.at&&(i=Math.max(i,e.at))}for(const[e,n]of Object.entries(t))if(Array.isArray(n)&&n.length>0){const e=n[n.length-1];e&&"number"==typeof e.at?i=Math.max(i,e.at):e&&"number"==typeof e.t?i=Math.max(i,e.t):e&&"number"==typeof e.time&&(i=Math.max(i,e.time))}return i>0?i/1e3+1:0}catch(t){return 0}}static async generatePosterFromVideo(e,t=10,i=480){return new Promise((n,r)=>{const s=document.createElement("video"),a=document.createElement("canvas"),o=a.getContext("2d");s.crossOrigin="anonymous",s.muted=!0,s.style.display="none",document.body.appendChild(s);const l=()=>{s.parentNode&&s.parentNode.removeChild(s)};s.onloadedmetadata=()=>{const e=s.videoWidth/s.videoHeight;s.videoWidth>i?(a.width=i,a.height=i/e):(a.width=s.videoWidth,a.height=s.videoHeight),s.currentTime=Math.min(t,s.duration-1)},s.onseeked=()=>{try{o.drawImage(s,0,0,a.width,a.height);const e=a.toDataURL("image/jpeg",.8);if(e&&e.length>1e3){Math.round(.75*e.length/1024);l(),n(e)}else l(),r(new Error("Failed to generate valid poster"))}catch(e){l(),r(e)}},s.onerror=()=>{l(),r(new Error("Video loading failed"))},s.src=e,s.load()})}static isSupportedMediaFile(e){const t=e.toLowerCase().split(".").pop();return["mp4","webm","mov","avi","mkv","ogv","m4v","mp3","wav","ogg","m4a","aac","flac"].includes(t)}static isFunscriptFile(e){const t=e.toLowerCase().split(".").pop();return["funscript","json"].includes(t)}static extractFilename(e){if(e.startsWith("data:"))return"uploaded_file";try{return new URL(e,window.location.href).pathname.split("/").pop().split(".")[0]||"unnamed"}catch{return"unnamed"}}static deepComparePlaylist(e,t){if(e===t)return!0;if(!e||!t)return e===t;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!bp.deepComparePlaylistItem(e[i],t[i]))return!1;return!0}static deepComparePlaylistItem(e,t){if(e===t)return!0;if(!e||!t)return e===t;const i=new Set(["_id","_generatedPoster","poster"]),n=Object.keys(e).filter(e=>!i.has(e)),r=Object.keys(t).filter(e=>!i.has(e));if(n.length!==r.length)return!1;for(const s of n){if(!r.includes(s))return!1;const i=e[s],n=t[s];if("object"==typeof i&&"object"==typeof n)if(Array.isArray(i)&&Array.isArray(n)){if(!bp.deepCompareArray(i,n))return!1}else{if(Array.isArray(i)||Array.isArray(n))return!1;if(!bp.deepCompareObject(i,n))return!1}else if(i!==n)return!1}return!0}static deepCompareArray(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const n=e[i],r=t[i];if("object"==typeof n&&"object"==typeof r)if(Array.isArray(n)&&Array.isArray(r)){if(!bp.deepCompareArray(n,r))return!1}else{if(Array.isArray(n)||Array.isArray(r))return!1;if(!bp.deepCompareObject(n,r))return!1}else if(n!==r)return!1}return!0}static deepCompareObject(e,t){if(!e||!t)return e===t;const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(const r of i){if(!n.includes(r))return!1;const i=e[r],s=t[r];if("object"==typeof i&&"object"==typeof s)if(Array.isArray(i)&&Array.isArray(s)){if(!bp.deepCompareArray(i,s))return!1}else{if(Array.isArray(i)||Array.isArray(s))return!1;if(!bp.deepCompareObject(i,s))return!1}else if(i!==s)return!1}return!0}}class Tp{constructor(e){i(this,"loadPlaylist",async e=>{var t,i,n,r,s,a,o;if(!e||0===e.length)return this._resetPlaylist(),null==(t=this.notify)||t.call(this,"status:playlist",{message:"No playlist to load",type:"info"}),null==(i=this.notify)||i.call(this,"playlist:loaded",{items:[],originalPlaylist:[],totalItems:0}),[];try{if(bp.deepComparePlaylist(this.originalPlaylist,e))return null==(n=this.notify)||n.call(this,"status:playlist",{message:"Playlist content identical, keeping current state",type:"log"}),this.items;null==(r=this.notify)||r.call(this,"status:playlist",{message:`Playlist content changed, processing ${e.length} items...`,type:"processing"}),this.originalPlaylist=[...e];const t=await this.processPlaylist(e);return this.items=t,this.currentIndex=t.length>0?0:-1,null==(s=this.notify)||s.call(this,"status:playlist",{message:`Playlist loaded: ${t.length} items processed`,type:"success"}),null==(a=this.notify)||a.call(this,"playlist:loaded",{items:this.items,originalPlaylist:this.originalPlaylist,totalItems:this.items.length}),this.items}catch(l){throw null==(o=this.notify)||o.call(this,"status:playlist",{message:"Playlist loading failed",type:"error",error:l.message}),l}}),i(this,"processPlaylist",async e=>{var t,i,n,r,s,a;null==(t=this.notify)||t.call(this,"status:playlist",{message:"Starting playlist processing pipeline...",type:"log"});const o=this.filterValidItems(e);null==(i=this.notify)||i.call(this,"status:playlist",{message:`Filtered to ${o.length} valid items`,type:"log"});const l=this.markItemTypes(o);null==(n=this.notify)||n.call(this,"status:playlist",{message:"Item types marked",type:"log"});const u=this.addFallbackPosters(l);null==(r=this.notify)||r.call(this,"status:playlist",{message:"Fallback posters generated",type:"log"});const c=this.processNoMediaItems(u);null==(s=this.notify)||s.call(this,"status:playlist",{message:"Silent audio generated for haptic-only items",type:"log"});const h=this.normalizeSources(c);return null==(a=this.notify)||a.call(this,"status:playlist",{message:"Source normalization complete",type:"log"}),h}),i(this,"filterValidItems",e=>{var t,i;null==(t=this.notify)||t.call(this,"status:playlist",{message:`Filtering ${e.length} items for validity...`,type:"log"});const n=e.filter((e,t)=>{var i,n;return!!(e.sources&&e.sources.length>0)||(!!e.funscript||(!e.duration||e.sources||e.funscript?(null==(n=this.notify)||n.call(this,"status:playlist",{message:`Filtered out empty item ${t+1}`,type:"log"}),!1):(null==(i=this.notify)||i.call(this,"status:playlist",{message:`Filtered out timeline-only item ${t+1}`,type:"log"}),!1)))}),r=e.length-n.length;return r>0&&(null==(i=this.notify)||i.call(this,"status:playlist",{message:`Filtered out ${r} invalid items`,type:"info"})),n}),i(this,"markItemTypes",e=>{var t;return null==(t=this.notify)||t.call(this,"status:playlist",{message:"Analyzing item types...",type:"log"}),e.map((e,t)=>{var i;let n="unknown";if(e.sources&&e.sources.length>0){const t=e.sources[0],i=(t.type||bp.detectMimeType(t.src)).toLowerCase();n=i.startsWith("video/")?e.funscript?"video_haptic":"video":i.startsWith("audio/")?e.funscript?"audio_haptic":"audio":"media"}else e.funscript&&(n="haptic");return null==(i=this.notify)||i.call(this,"status:playlist",{message:`Item ${t+1}: ${n}`,type:"log"}),{...e,item_type:n}})}),i(this,"processNoMediaItems",e=>{var t,i;null==(t=this.notify)||t.call(this,"status:playlist",{message:"Processing haptic-only items...",type:"log"});let n=0;const r=e.map((e,t)=>{var i,r,s;if(e.sources&&e.sources.length>0)return e;if(e.funscript)try{const r=bp.extractFunscriptDuration(e.funscript);if(r>0){const s=bp.generateSilentAudio(r);return n++,null==(i=this.notify)||i.call(this,"status:playlist",{message:`Generated ${r.toFixed(1)}s silent audio for item ${t+1}`,type:"log"}),{...e,sources:[{src:s,type:"audio/wav"}]}}}catch(a){null==(r=this.notify)||r.call(this,"status:playlist",{message:`Failed to process funscript for item ${t+1}: ${a.message}`,type:"error"})}return null==(s=this.notify)||s.call(this,"status:playlist",{message:`Unexpected item without sources or funscript at index ${t}`,type:"log"}),e});return n>0&&(null==(i=this.notify)||i.call(this,"status:playlist",{message:`Generated silent audio for ${n} haptic-only items`,type:"info"})),r}),i(this,"normalizeSources",e=>{var t;return null==(t=this.notify)||t.call(this,"status:playlist",{message:"Normalizing source MIME types...",type:"log"}),e.map(e=>{if(!e.sources||0===e.sources.length)return e;const t=e.sources.map(e=>({...e,type:e.type||bp.detectMimeType(e.src)}));return{...e,sources:t}})}),i(this,"addFallbackPosters",e=>{var t,i;null==(t=this.notify)||t.call(this,"status:playlist",{message:"Generating fallback posters...",type:"log"});let n=0;const r=e.map((e,t)=>e.poster?e:(n++,{...e,poster:bp.generateSVGPoster(e,t),_generatedPoster:!0}));return n>0&&(null==(i=this.notify)||i.call(this,"status:playlist",{message:`Generated ${n} SVG fallback posters`,type:"log"})),r}),i(this,"next",()=>{var e,t;if(0===this.items.length)return null==(e=this.notify)||e.call(this,"status:playlist",{message:"Cannot go next: empty playlist",type:"info"}),!1;const i=this.currentIndex+1;return i>=this.items.length?(null==(t=this.notify)||t.call(this,"status:playlist",{message:"Cannot go next: end of playlist reached",type:"info"}),!1):this.goTo(i)}),i(this,"previous",()=>{var e,t;if(0===this.items.length)return null==(e=this.notify)||e.call(this,"status:playlist",{message:"Cannot go previous: empty playlist",type:"info"}),!1;const i=this.currentIndex-1;return i<0?(null==(t=this.notify)||t.call(this,"status:playlist",{message:"Cannot go previous: beginning of playlist reached",type:"info"}),!1):this.goTo(i)}),i(this,"goTo",e=>{var t,i,n,r;if(0===this.items.length)return null==(t=this.notify)||t.call(this,"status:playlist",{message:"Cannot navigate: empty playlist",type:"error"}),!1;if(e<0||e>=this.items.length)return null==(i=this.notify)||i.call(this,"status:playlist",{message:`Cannot navigate to index ${e}: out of bounds`,type:"error"}),!1;const s=this.currentIndex;this.currentIndex=e;const a=this.items[e],o=(null==a?void 0:a.name)||`Item ${e+1}`;return null==(n=this.notify)||n.call(this,"status:playlist",{message:`Playing: ${o} (${e+1}/${this.items.length})`,type:"success"}),null==(r=this.notify)||r.call(this,"playlist:itemChanged",{index:e,item:a?{...a}:null,previousIndex:s,hasNext:this.canNext(),hasPrevious:this.canPrevious()}),!0}),i(this,"canNext",()=>this.items.length>0&&this.currentIndex<this.items.length-1),i(this,"canPrevious",()=>this.items.length>0&&this.currentIndex>0),i(this,"getCurrentIndex",()=>this.currentIndex),i(this,"getCurrentItem",()=>this.currentIndex>=0&&this.currentIndex<this.items.length?this.items[this.currentIndex]:null),i(this,"getOriginalPlaylist",()=>[...this.originalPlaylist]),i(this,"getPlaylistInfo",()=>({currentIndex:this.currentIndex,totalItems:this.items.length,hasPlaylist:this.items.length>0,canNext:this.canNext(),canPrevious:this.canPrevious(),isPlaying:this.isPlaying,currentTime:this.currentTime,duration:this.duration})),i(this,"updatePlaybackState",(e,t=null,i=null)=>{var n,r;let s=!1;this.isPlaying!==e&&(this.isPlaying=e,s=!0),null!==t&&this.currentTime!==t&&(this.currentTime=t,s=!0),null!==i&&this.duration!==i&&(this.duration=i,s=!0),s&&(null==(n=this.notify)||n.call(this,"status:playlist",{message:`Playback state: ${e?"playing":"paused"} ${null==t?void 0:t.toFixed(1)}s/${null==i?void 0:i.toFixed(1)}s`,type:"log"}),null==(r=this.notify)||r.call(this,"playlist:playbackChanged",{isPlaying:this.isPlaying,currentTime:this.currentTime,duration:this.duration,currentIndex:this.currentIndex,currentItem:this.getCurrentItem(),playlistInfo:this.getPlaylistInfo()}))}),i(this,"updateCurrentItemDuration",e=>{var t,i;const n=this.getCurrentItem();if(!n)return!1;const r=n.duration;return n.duration=e,null==(t=this.notify)||t.call(this,"status:playlist",{message:`Duration corrected: ${(null==r?void 0:r.toFixed(1))||"unknown"}s  ${e.toFixed(1)}s`,type:"log"}),null==(i=this.notify)||i.call(this,"playlist:itemUpdated",{index:this.currentIndex,item:{...n},change:{field:"duration",oldValue:r,newValue:e}}),!0}),i(this,"_resetPlaylist",()=>{this.currentIndex=-1,this.items=[],this.originalPlaylist=[],this.isPlaying=!1,this.currentTime=0,this.duration=0}),i(this,"reset",()=>{var e;this._resetPlaylist(),null==(e=this.notify)||e.call(this,"status:playlist",{message:"Playlist manager reset",type:"info"})}),i(this,"cleanup",()=>{var e;this._resetPlaylist(),null==(e=this.notify)||e.call(this,"status:playlist",{message:"Playlist manager cleanup completed",type:"log"})}),i(this,"getStats",()=>({totalItems:this.items.length,currentIndex:this.currentIndex,isPlaying:this.isPlaying,hasGeneratedPosters:this.items.filter(e=>e._generatedPoster).length,processingComplete:!0})),i(this,"getDebugInfo",()=>{var e;const t=this.getStats();return null==(e=this.notify)||e.call(this,"status:playlist",{message:`Debug info requested: ${t.totalItems} items, index ${t.currentIndex}, ${t.hasGeneratedPosters} generated posters`,type:"log"}),{state:{currentIndex:this.currentIndex,totalItems:this.items.length,isPlaying:this.isPlaying,currentTime:this.currentTime,duration:this.duration},currentItem:this.getCurrentItem(),navigation:{canNext:this.canNext(),canPrevious:this.canPrevious()},stats:t}}),this.notify=e,this.currentIndex=-1,this.items=[],this.originalPlaylist=[],this.isPlaying=!1,this.currentTime=0,this.duration=0}}class Sp{constructor(e){this.notify=e,this.enableConsoleLogging=!1,this.maxDebugLogs=1e3,this.sessionStart=performance.now(),this.debugLogs=[],this.statusEmojis={log:"",info:"",success:"",warning:"",error:"",processing:"",device:"",funscript:"",playlist:"",media:""}}createMessage(e,t={}){return{timestamp:(new Date).toISOString(),relativeTime:((performance.now()-this.sessionStart)/1e3).toFixed(3),source:this._extractSource(e),type:t.type||"log",message:t.message||"",error:t.error||null,event:e,id:this._generateMessageId()}}formatMessage(e,t=!1){return`${this.statusEmojis[e.type]||""} ${t?`[${e.relativeTime.padStart(8)}s] `:""}${`[${e.source.padEnd(13)}]`} ${`[${({log:"LOG",info:"INFO",success:"SUCCESS",warning:"WARNING",error:"ERROR",processing:"PROCESSING"}[e.type]||e.type.toUpperCase()).padEnd(13)}]`} ${e.message}${e.error?` (ERROR: ${e.error})`:""}`}addInitialSessionMessage(){this.notify("status:core",{message:"FunPlayerCore session started",type:"info"})}log(e,t={}){var i;const n=this.createMessage(e,t);return this._addMessage(n),this.enableConsoleLogging&&this._outputToConsole(n),null==(i=this.notify)||i.call(this,"logging:new-message",{messageObj:n}),n}getLogs(){return[...this.debugLogs]}getFormattedLogs(){return this.debugLogs.map(e=>this.formatMessage(e,!0)).join("\n")}getFilteredLogs(e={}){return this.debugLogs.filter(t=>(!e.source||t.source===e.source)&&((!e.type||t.type===e.type)&&(!(e.since&&new Date(t.timestamp)<e.since)&&!(e.until&&new Date(t.timestamp)>e.until))))}clear(){this.debugLogs=[],this.sessionStart=performance.now(),this.addInitialSessionMessage(),this.notify("status:logging",{message:"Logs cleared",type:"info"})}generateExportContent(){return`FunPlayer Debug Log\nGenerated: ${(new Date).toISOString()}\nTotal entries: ${this.debugLogs.length}\nSession duration: ${((performance.now()-this.sessionStart)/1e3).toFixed(1)}s\nConsole logging: ${this.enableConsoleLogging?"enabled":"disabled"}\n\n${"=".repeat(80)}\n\n`+this.debugLogs.map(e=>this.formatMessage(e,!0)).join("\n")}setConsoleLogging(e){var t;this.enableConsoleLogging=e,null==(t=this.notify)||t.call(this,"status:config",{message:"Console logging "+(e?"enabled":"disabled"),type:"info"})}getConsoleLogging(){return this.enableConsoleLogging}setMaxLogs(e){var t;this.maxDebugLogs=Math.max(100,e),this._rotateLogsIfNeeded(),null==(t=this.notify)||t.call(this,"logging:config",{message:`Max logs set to ${this.maxDebugLogs}`,type:"info"})}getMaxLogs(){return this.maxDebugLogs}_addMessage(e){this.debugLogs.push(e),this._rotateLogsIfNeeded()}_rotateLogsIfNeeded(){this.debugLogs.length>this.maxDebugLogs&&(this.debugLogs=this.debugLogs.slice(-this.maxDebugLogs))}_extractSource(e){return e.split(":")[1]||e.split(":")[0]||"unknown"}_generateMessageId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}_outputToConsole(e){this.formatMessage(e);e.type}}class wp{constructor(){i(this,"notify",(e,t)=>{this.listeners.forEach(i=>{try{i(e,t)}catch(n){this.enableConsoleLogging}})}),i(this,"handleEvent",(e,t)=>{e.startsWith("status:")?this._handleStatusEvent(e,t):e.startsWith("buttplug:")?this._handleButtplugEvent(e,t):e.startsWith("channel:")?this._handleChannelEvent(e,t):e.startsWith("actuator:")?this._handleActuatorEvent(e,t):e.startsWith("funscript:")?this._handleFunscriptEvent(e,t):e.startsWith("playlist:")?this._handlePlaylistEvent(e,t):e.startsWith("media:")?this._handleMediaEvent(e,t):e.startsWith("core:")?this._handleCoreEvent(e,t):e.startsWith("logging:")?this._handleLoggingEvent(e,t):this.enableConsoleLogging}),i(this,"_handleStatusEvent",(e,t)=>{const i=this.logging.log(e,t);switch(i.type){case"log":break;case"error":this.setError(i);break;default:this.setStatus(i)}}),i(this,"_handleCoreEvent",(e,t)=>{switch(e){case"core:autoConnect":t.success?this.setStatus({source:"core",message:`Auto-connected to ${t.device.name} (${t.mapResult.mapped}/${t.mapResult.total} channels mapped)`,type:"success"}):this.setError({source:"core",message:"Auto-connect failed",type:"error",error:t.error});break;case"core:autoMap":this.setStatus({source:"core",message:`Auto-mapped ${t.result.mapped} new channels`,type:"success"})}}),i(this,"_handleButtplugEvent",(e,t)=>{switch(e){case"buttplug:connection":this.setStatus({source:"buttplug",message:t.connected?"Connected to Intiface":"Disconnected from Intiface",type:t.connected?"success":"info"});break;case"buttplug:device":this.setStatus({source:"buttplug",message:t.device?`Device selected: ${t.device.name}`:"No device selected",type:t.device?"success":"info"}),t.device&&setTimeout(()=>{this.autoMapChannels()},100);break;case"buttplug:error":this.setError({source:"buttplug",message:"Device error",type:"error",error:t.error})}}),i(this,"_handleFunscriptEvent",(e,t)=>{if("funscript:load"===e)setTimeout(()=>{this.autoMapChannels()},100)}),i(this,"_handlePlaylistEvent",(e,t)=>{var i;switch(e){case"playlist:loaded":if(this.isReady=!1,t.items&&t.items.length>0){const e=t.items[0];null==(i=this.notify)||i.call(this,"status:core",{message:`Preloading funscript for first item: ${e.name||"Untitled"}`,type:"log"}),this.funscript.loadFromPlaylistItem(e).then(()=>{var t;null==(t=this.notify)||t.call(this,"status:core",{message:`First item ready: ${e.name||"Untitled"}`,type:"success"}),this.setReady(!0)}).catch(e=>{var t;null==(t=this.notify)||t.call(this,"status:core",{message:"Failed to preload funscript for first item",type:"error",error:e.message}),this.setReady(!0)})}else this.setReady(!0);break;case"playlist:itemChanged":this.isReady=!1,this.buttplug.stopAll().catch(e=>{}),t.item?this.funscript.loadFromPlaylistItem(t.item).then(()=>{this.setReady(!0)}).catch(e=>{this.setReady(!0)}):this.setReady(!0)}}),i(this,"_handleActuatorEvent",(e,t)=>{}),i(this,"_handleChannelEvent",(e,t)=>{}),i(this,"_handleLoggingEvent",(e,t)=>{}),i(this,"_handleMediaEvent",(e,t)=>{}),i(this,"setStatus",e=>{const t=`[${e.source.charAt(0).toUpperCase()+e.source.slice(1)}] ${e.message}`;this.status=t,this.error=null,this.notify("core:status",{status:t,error:null,messageObj:e})}),i(this,"setError",e=>{const t=`[${e.source.charAt(0).toUpperCase()+e.source.slice(1)}] ${e.message}`;this.error=t,this.status="error",this.isReady=!1,e.error,this.notify("core:status",{status:"error",error:t,messageObj:e})}),i(this,"setReady",e=>{this.isReady=e,this.notify("core:ready",{isReady:e})}),this.enableConsoleLogging=!1,this.debugLogs=[],this.maxDebugLogs=1e3,this.sessionStart=performance.now(),this._buttplug=null,this._funscript=null,this._playlist=null,this._logging=null,this.status="idle",this.error=null,this.isReady=!1,this.listeners=new Set,this.addListener(this.handleEvent),this.logging.addInitialSessionMessage()}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}get buttplug(){return this._buttplug||(this._buttplug=new yp(this.notify)),this._buttplug}get funscript(){return this._funscript||(this._funscript=new _p(this.notify)),this._funscript}get playlist(){return this._playlist||(this._playlist=new Tp(this.notify)),this._playlist}get logging(){return this._logging||(this._logging=new Sp(this.notify)),this._logging}plugChannel(e,t){const i=this.funscript.getChannel(e),n=this.buttplug.getActuator(t);return!(!i||!n)&&i.plug(n)}unplugChannel(e,t){const i=this.funscript.getChannel(e),n=this.buttplug.getActuator(t);return!(!i||!n)&&(i.unplug(n),!0)}unplugAllChannels(){this.funscript.getChannels().forEach(e=>{e.unplugAll()})}async autoConnect(e=3e3){try{if(!(await this.buttplug.connect()))throw new Error("Failed to connect to Intiface Central");const e=this.buttplug.getDevices().filter(e=>e.index>=0);if(0===e.length)throw new Error("No physical device found");if(!this.buttplug.selectDevice(e[0].index))throw new Error("Failed to select device");const t=this.autoMapChannels();return this.notify("core:autoConnect",{success:!0,device:e[0],mapResult:t,deviceInfo:this.buttplug.getDeviceInfo()}),this.notify("status:core",{message:`AutoConnect successful: ${e[0].name}`,type:"success"}),{success:!0,device:e[0],mapResult:t}}catch(t){return this.notify("core:autoConnect",{success:!1,error:t.message}),this.notify("status:core",{message:"AutoConnect failed",type:"error",error:t.message}),{success:!1,error:t.message}}}async processHapticFrame(e,t={}){if(0===this.funscript.getChannels().length)return new Map;const i=this.buttplug.getTimeWithOffsets(e),n=Object.fromEntries(i.entries()),r=this.funscript.interpolateAll(n);return await this.buttplug.processChannels(r)}autoMapChannels(){const e=this.buttplug.getActuators(),t=this.funscript.getChannels();if(0===e.length)return this.notify("status:core",{message:"No actuators available for auto-mapping",type:"info"}),{mapped:0,total:0,skippedIncompatible:0,strategy:"no_actuators"};if(0===t.length)return this.notify("status:core",{message:"No channels available for auto-mapping",type:"info"}),{mapped:0,total:e.length,skippedIncompatible:0,strategy:"no_channels"};this.notify("status:core",{message:` Starting intelligent autoMap: ${e.length} actuators  ${t.length} channels`,type:"processing"}),this._savePreviousMappings(e);const i={mappedActuators:new Set,assignedChannels:new Map,unmappedChannels:new Set(t.map(e=>e.name)),statistics:{priorityByName:0,priorityByCapability:0,priorityByType:0,fallbackMultiAssignment:0,incompatible:0}};this._phase1PriorityMapping(e,t,i),this._phase2FallbackMapping(e,t,i);const n=this._buildAutoMapResult(i,e.length);return this.notify("core:autoMap",{result:n,deviceInfo:this.buttplug.getDeviceInfo(),strategy:"intelligent_persistent"}),n}_savePreviousMappings(e){let t=0;for(const i of e)if(i.isPlugged()){const e=i.getAssignedChannelName();this.notify("status:core",{message:` Saving mapping: Actuator ${i.index} was connected to "${e}"`,type:"log"}),t++}t>0&&this.notify("status:core",{message:` Saved ${t} previous mappings for intelligent autoMap`,type:"info"})}_phase1PriorityMapping(e,t,i){this.notify("status:core",{message:" Phase 1: Priority mapping (name  capability  type)",type:"log"});for(const n of e)n.settings.enabled?this._tryMapByPreviousName(n,t,i)||this._tryMapByCapability(n,t,i,!1)||this._tryMapByType(n,t,i,!1):this.notify("status:core",{message:` Skipping disabled actuator ${n.index}`,type:"log"})}_phase2FallbackMapping(e,t,i){this.notify("status:core",{message:" Phase 2: Fallback multi-assignment on already mapped channels",type:"log"});for(const n of e)n.settings.enabled&&!i.mappedActuators.has(n.index)&&(this._tryMapByCapability(n,t,i,!0)||this._tryMapByType(n,t,i,!0)||(i.statistics.incompatible++,this.notify("status:core",{message:` No mapping found for actuator ${n.index} (${n.capability}/${n.type})`,type:"warning"})))}_tryMapByPreviousName(e,t,i){const n=e.getPreviousMappedChannelName();if(!n)return!1;const r=t.find(e=>e.name===n);if(!r)return this.notify("status:core",{message:` Previous channel "${n}" not found in new funscript for actuator ${e.index}`,type:"log"}),!1;if(!e.canPlugTo(r))return this.notify("status:core",{message:` Previous channel "${n}" incompatible with actuator ${e.index} (${e.type} vs ${r.type})`,type:"log"}),!1;return!!r.plug(e)&&(this._recordSuccessfulMapping(e,r,i,"previous_name"),i.statistics.priorityByName++,this.notify("status:core",{message:` [PRIORITY NAME] Actuator ${e.index}  "${r.name}" (restored previous mapping)`,type:"success"}),!0)}_tryMapByCapability(e,t,i,n){const r=t.filter(t=>{if(!e.canPlugTo(t))return!1;if(t.likelyCapability!==e.capability)return!1;const r=i.assignedChannels.has(t.name);return n||!r});if(0===r.length)return!1;const s=r[0];if(s.plug(e)){const t=n?"MULTI-CAPABILITY":"CAPABILITY";return this._recordSuccessfulMapping(e,s,i,"capability"),n?i.statistics.fallbackMultiAssignment++:i.statistics.priorityByCapability++,this.notify("status:core",{message:` [${t}] Actuator ${e.index}  "${s.name}" (${e.capability} match)`,type:"success"}),!0}return!1}_tryMapByType(e,t,i,n){const r=t.filter(t=>{if(!e.canPlugTo(t))return!1;const r=i.assignedChannels.has(t.name);return n||!r});if(0===r.length)return!1;const s=r[0];if(s.plug(e)){const t=n?"MULTI-TYPE":"TYPE";return this._recordSuccessfulMapping(e,s,i,"type"),n?i.statistics.fallbackMultiAssignment++:i.statistics.priorityByType++,this.notify("status:core",{message:` [${t}] Actuator ${e.index}  "${s.name}" (${e.type} type match)`,type:"success"}),!0}return!1}_recordSuccessfulMapping(e,t,i,n){i.mappedActuators.add(e.index),i.assignedChannels.has(t.name)||(i.assignedChannels.set(t.name,[]),i.unmappedChannels.delete(t.name)),i.assignedChannels.get(t.name).push({actuatorIndex:e.index,reason:n})}_buildAutoMapResult(e,t){const i=e.mappedActuators.size,n=Array.from(e.assignedChannels.entries()).filter(([e,t])=>t.length>1).length;this.notify("status:core",{message:` AutoMap completed: ${i}/${t} actuators mapped`+(n>0?`, ${n} channels multi-assigned`:""),type:i>0?"success":"warning"});const r=e.statistics;return r.priorityByName>0&&this.notify("status:core",{message:` Priority mappings: ${r.priorityByName} by name, ${r.priorityByCapability} by capability, ${r.priorityByType} by type`,type:"log"}),r.fallbackMultiAssignment>0&&this.notify("status:core",{message:` Fallback multi-assignments: ${r.fallbackMultiAssignment}`,type:"log"}),r.incompatible>0&&this.notify("status:core",{message:` Incompatible actuators: ${r.incompatible}`,type:"log"}),{mapped:i,total:t,skippedIncompatible:r.incompatible,strategy:"intelligent_persistent",statistics:{...r,multiAssignedChannels:n,unmappedChannels:e.unmappedChannels.size},details:{assignedChannels:Object.fromEntries(e.assignedChannels.entries()),unmappedChannels:Array.from(e.unmappedChannels)}}}clearAllPreviousMappings(){const e=this.buttplug.getActuators();let t=0;for(const i of e)i.hasPreviousMapping()&&(i.forgetPreviousMapping(),t++);return this.notify("status:core",{message:` Cleared ${t} previous mappings`,type:"info"}),{cleared:t,total:e.length}}getPreviousMappingsDiagnostic(){const e=this.buttplug.getActuators(),t=this.funscript.getChannelNames(),i=e.map(e=>{const i=e.getPreviousMappedChannelName(),n=e.getAssignedChannelName(),r=!!i&&t.includes(i),s=!!r&&e.canPlugTo(this.funscript.getChannel(i));return{actuatorIndex:e.index,capability:e.capability,type:e.type,currentChannel:n,previousChannel:i,isAvailable:r,isCompatible:s,canRestore:r&&s}}),n={total:e.length,withPreviousMapping:i.filter(e=>e.previousChannel).length,canRestore:i.filter(e=>e.canRestore).length,lost:i.filter(e=>e.previousChannel&&!e.isAvailable).length,incompatible:i.filter(e=>e.previousChannel&&e.isAvailable&&!e.isCompatible).length};return{diagnostics:i,stats:n}}getCompatibilityDiagnostic(){const e=this.funscript.getChannels(),t=this.buttplug.getActuators();if(0===e.length)return{channels:[],actuators:[],issues:["No funscript loaded"]};const i=e.map(e=>{const i=t.filter(t=>e.canPlugTo(t)).map(e=>e.index);return{channel:e.name,type:e.type,valueRange:e.valueRange,compatibleActuators:i,isOrphaned:0===i.length,connectedActuators:Array.from(e.connectedActuators.keys())}}),n=t.map(t=>{const i=e.filter(e=>e.canPlugTo(t)).map(e=>e.name);return{index:t.index,type:t.type,capability:t.capability,compatibleChannels:i,isUnused:0===i.length,assignedChannel:t.getAssignedChannelName()}}),r=[],s=i.filter(e=>e.isOrphaned),a=n.filter(e=>e.isUnused);return s.length>0&&r.push(`${s.length} channel(s) have no compatible actuators`),a.length>0&&r.push(`${a.length} actuator(s) have no compatible channels`),{channels:i,actuators:n,issues:r}}getStatus(){var e;return{status:this.status,error:this.error,isReady:this.isReady,buttplug:this.buttplug.getStatus(),funscript:(null==(e=this.funscript)?void 0:e.getDebugInfo())||{loaded:!1},playlist:this.playlist.getStats()}}async cleanup(){this._buttplug&&(await this._buttplug.cleanup(),this._buttplug=null),this._playlist&&(this._playlist.cleanup(),this._playlist=null),this._funscript&&(this._funscript.reset(),this._funscript=null),this.status="idle",this.error=null,this.isReady=!1,this.listeners.clear(),this.logging.enableConsoleLogging,this._logging&&(this._logging.cleanup(),this._logging=null)}}i(wp,"instance",null);var xp=Object.defineProperty,Ap=(e,t,i)=>((e,t,i)=>t in e?xp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Ep extends p.Component{constructor(e){super(e),Ap(this,"handleEvent",(e,t)=>{["playlist:loaded","playlist:itemChanged"].includes(e)&&(this._triggerRender(),this.core.notify("component:resize",{source:"PlaylistComponent",reason:"playlist:loaded"===e?"playlist-loaded":"item-changed"}))}),Ap(this,"_triggerRender",()=>{this.setState(e=>({renderTrigger:e.renderTrigger+1}))}),Ap(this,"handleItemClick",e=>{this.core.playlist.goTo(e)}),Ap(this,"getItemTitle",(e,t)=>{if(e.name)return e.name;if(e.title)return e.title;if(e.sources&&e.sources.length>0){const i=e.sources[0];if(i.src.startsWith("data:")){const e=i.src.match(/data:([^;]+)/);return`Uploaded ${(e?e[1]:"unknown").split("/")[0]}`}return i.src.split("/").pop().split(".")[0]||`Item ${t+1}`}if(e.funscript&&"string"==typeof e.funscript){if(e.funscript.startsWith("data:"))return"Uploaded funscript";return e.funscript.split("/").pop().split(".")[0]||`Haptic ${t+1}`}return`Item ${t+1}`}),Ap(this,"getItemInfo",e=>{const t=[];switch(e.item_type){case"video":case"video_haptic":t.push("VIDEO");break;case"audio":case"audio_haptic":t.push("AUDIO");break;case"haptic":t.push("HAPTIC")}if(e.duration){const i=Math.floor(e.duration/60),n=Math.floor(e.duration%60);t.push(`${i}:${n.toString().padStart(2,"0")}`)}return["video_haptic","audio_haptic","haptic"].includes(e.item_type)&&t.push(""),t.join("  ")}),this.core=e.core,this.state={renderTrigger:0},this.coreListener=null}componentDidMount(){this.coreListener=this.core.addListener(this.handleEvent)}componentDidUpdate(e){if(e.visible!==this.props.visible){const e=this.props.visible?"shown":"hidden";this.core.notify("component:resize",{source:"PlaylistComponent",reason:`visibility-${e}`})}}componentWillUnmount(){this.coreListener&&(this.coreListener(),this.coreListener=null)}render(){const{visible:e=!0}=this.props;if(!e)return null;const t=this.core.playlist.items,i=this.core.playlist.getCurrentIndex();return t.length<=1?null:O.jsxs("div",{className:"fp-playlist",children:[O.jsx("div",{className:"fp-playlist-header",children:O.jsxs("span",{className:"fp-playlist-title",children:["Playlist (",t.length,")"]})}),O.jsx("div",{className:"fp-playlist-items",children:t.map((e,t)=>O.jsxs("div",{className:"fp-playlist-item "+(t===i?"fp-playlist-item-active":""),onClick:()=>this.handleItemClick(t),title:e.description||this.getItemTitle(e,t),children:[O.jsx("div",{className:"fp-playlist-item-thumbnail",children:O.jsx("img",{className:"fp-playlist-item-image",src:e.poster,alt:this.getItemTitle(e,t),onError:e=>{e.target.style.display="none",e.target.parentElement.innerHTML=""}})}),O.jsxs("div",{className:"fp-playlist-item-content",children:[O.jsx("div",{className:"fp-playlist-item-title",children:this.getItemTitle(e,t)}),O.jsx("div",{className:"fp-playlist-item-info",children:this.getItemInfo(e)})]})]},t))})]})}}var Cp=Object.defineProperty,Mp=(e,t,i)=>((e,t,i)=>t in e?Cp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class kp extends p.Component{constructor(e){super(e),Mp(this,"handleEvent",(e,t)=>{["buttplug:connection","buttplug:device","funscript:load","funscript:channels","core:autoConnect"].some(t=>e.startsWith(t.split(":")[0]))&&("core:autoConnect"===e&&this.setState({isAutoConnecting:!1}),this.setState(e=>({renderTrigger:e.renderTrigger+1})))}),Mp(this,"handleAutoConnect",async()=>{this.setState({isAutoConnecting:!0});try{await this.core.autoConnect()}catch(e){}finally{this.setState({isAutoConnecting:!1})}}),Mp(this,"handleDisconnect",async()=>{try{await this.core.buttplug.disconnect()}catch(e){}}),Mp(this,"handleRescan",async()=>{this.setState({isRescanActive:!0});try{await this.core.buttplug.scan()}catch(e){}finally{this.setState({isRescanActive:!1})}}),Mp(this,"handleDeviceChange",e=>{try{const t="-1"===e?-1:parseInt(e);this.core.buttplug.selectDevice(t)}catch(t){}}),this.core=e.core,this.state={isAutoConnecting:!1,isRescanActive:!1,renderTrigger:0},this.coreListener=null}componentDidMount(){this.coreListener=this.core.addListener(this.handleEvent)}componentWillUnmount(){this.coreListener&&(this.coreListener(),this.coreListener=null)}render(){var e;const{onToggleSettings:t,isSettingsExpanded:i}=this.props,{isAutoConnecting:n,isRescanActive:r}=this.state,s=this.core.buttplug.getStatus(),a=this.core.funscript.getChannelNames(),o=this.core.buttplug.getDevices(),l=this.core.buttplug.getSelected(),u=(null==s?void 0:s.isConnected)||!1;return O.jsxs("div",{className:"fp-buttplug-settings",children:[O.jsxs("div",{className:"fp-buttplug-settings-status",children:[O.jsx("span",{className:"fp-buttplug-settings-connection-dot",children:u?"":""}),O.jsx("span",{className:"fp-buttplug-settings-device-name",children:(null==l?void 0:l.name)||"Unknown device"}),0===a.length&&O.jsx("span",{className:"fp-buttplug-settings-no-haptic-hint",children:"No haptic"})]}),O.jsxs("div",{className:"fp-buttplug-settings-actions",children:[u?O.jsxs(O.Fragment,{children:[O.jsx("button",{className:"fp-buttplug-settings-disconnect-btn",onClick:this.handleDisconnect,children:" Disconnect"}),O.jsx("button",{className:"fp-buttplug-settings-rescan-btn",onClick:this.handleRescan,disabled:r,title:"Scan for new devices",children:r?"":""})]}):O.jsx("button",{className:"fp-buttplug-settings-connect-btn",onClick:this.handleAutoConnect,disabled:n||0===a.length,title:0===a.length?"Load funscript first":"Connect to Intiface Central",children:n?O.jsx(O.Fragment,{children:" Connecting..."}):O.jsx(O.Fragment,{children:" Connect"})}),O.jsx("select",{className:"fp-buttplug-settings-device-select",value:null!=(e=null==l?void 0:l.index)?e:-1,onChange:e=>this.handleDeviceChange(e.target.value),disabled:0===a.length,title:0===a.length?"Load funscript first":"Select haptic device",children:o.map(e=>O.jsxs("option",{value:e.index,children:[e.name," ",-1===e.index?"(Virtual)":""]},e.index))}),O.jsx("button",{className:"fp-buttplug-settings-toggle",onClick:t,title:i?"Hide haptic settings":"Show haptic settings",children:i?"":""})]})]})}}var Ip=Object.defineProperty,Pp=(e,t,i)=>((e,t,i)=>t in e?Ip(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Lp extends p.Component{constructor(e){super(e),Pp(this,"handleEvent",(e,t)=>{const{actuator:i}=this.props;if(!i)return;if("actuator:settingsChanged"===e||"actuator:settingsReset"===e||"actuator:plugged"===e||"actuator:unplugged"===e)return void(t.actuatorIndex===i.index&&this._triggerRender());if("channel:plugged"===e||"channel:unplugged"===e)return void(t.actuatorIndex===i.index&&this._triggerRender());["funscript:load","funscript:channels","buttplug:device"].includes(e)&&this._triggerRender()}),Pp(this,"_triggerRender",()=>{this.setState(e=>({renderTrigger:e.renderTrigger+1}))}),Pp(this,"handleToggleExpanded",()=>{this.setState({isExpanded:!this.state.isExpanded},()=>{var e;this.core.notify("component:resize",{source:"ActuatorSettingsComponent",reason:`actuator-${null==(e=this.props.actuator)?void 0:e.index}-${this.state.isExpanded?"expanded":"collapsed"}`})})}),Pp(this,"handleGlobalScaleChange",e=>{this.core.buttplug.setGlobalScale(e)}),Pp(this,"handleActuatorSettingChange",(e,t)=>{const{actuator:i}=this.props;i&&i.updateSettings({[e]:t})}),Pp(this,"handleChannelMapping",e=>{const{actuator:t}=this.props;if(t)if(""===e||null===e)t.unplug();else{const i=this.core.funscript.getChannel(e);i&&i.plug(t)}}),this.core=e.core,this.state={isExpanded:!1,renderTrigger:0},this.coreListener=null}componentDidMount(){this.coreListener=this.core.addListener(this.handleEvent)}componentWillUnmount(){this.coreListener&&(this.coreListener(),this.coreListener=null)}render(){return O.jsxs("div",{className:"fp-actuator-settings",children:[this.renderCompactLine(),this.renderExpandedSettings()]})}renderCompactLine(){const{actuator:e}=this.props,{isExpanded:t}=this.state;if(!e)return O.jsx("div",{className:"fp-actuator-settings-error",children:"No actuator provided"});const i=this.core.funscript.getChannels(),n=i.filter(t=>t.canPlugTo(e)),r=e.assignedChannel;let s=null;if(e.settings.enabled)if(0===i.length)s="Load funscript first";else if(0===n.length){const t="rotate"===e.capability,n=i.some(e=>"polar"===e.type);s=n&&!t?"Funscript has bipolar channels (needs rotate actuator)":!n&&t?"Funscript has only unipolar channels (rotate not needed)":"No compatible channels in current funscript"}return O.jsxs("div",{className:"fp-actuator-settings-header",children:[O.jsxs("span",{className:"fp-actuator-settings-badge "+(e.settings.enabled?"":"fp-actuator-settings-badge-disabled"),children:["#",e.index," (",e.capability,")",!e.settings.enabled&&O.jsx("span",{className:"fp-actuator-settings-warning",title:s,children:""})]}),O.jsx("label",{className:"fp-actuator-settings-enable-toggle",children:O.jsx("input",{className:"fp-actuator-settings-enable-checkbox",type:"checkbox",checked:e.settings.enabled,onChange:e=>this.handleActuatorSettingChange("enabled",e.target.checked),title:e.settings.enabled?"Enable/disable this actuator":s})}),O.jsxs("select",{className:"fp-actuator-settings-channel-select",value:(null==r?void 0:r.name)||"",onChange:e=>this.handleChannelMapping(e.target.value),disabled:!e.settings.enabled,title:e.settings.enabled?"Assign compatible channel to this actuator":s,children:[O.jsx("option",{value:"",children:"None"}),n.map(e=>{const t="polar"===e.type?" ()":"";return O.jsxs("option",{value:e.name,children:[e.name,t]},e.name)})]}),O.jsx("button",{className:"fp-actuator-settings-expand-toggle",onClick:this.handleToggleExpanded,children:t?"":""})]})}renderExpandedSettings(){if(!this.state.isExpanded)return null;const{actuator:e}=this.props;if(!e)return null;const t=this.core.funscript.getChannels(),i=t.filter(t=>t.canPlugTo(e));return O.jsxs("div",{className:"fp-actuator-settings-expanded",children:[!e.settings.enabled&&0===t.length&&O.jsx("div",{className:"fp-actuator-settings-warning-message",children:" Load a funscript first"}),e.settings.enabled&&i.length>0&&O.jsxs("div",{className:"fp-actuator-settings-compatibility-info",children:["Compatible with ",i.length," channel(s): ",i.map(e=>e.name).join(", ")]}),O.jsxs("div",{className:"fp-actuator-settings-controls",children:[O.jsxs("div",{className:"fp-actuator-settings-scale-control",children:[O.jsxs("label",{className:"fp-actuator-settings-scale-label",children:["Scale: ",(100*(e.settings.scale||1)).toFixed(0),"%"]}),O.jsx("input",{className:"fp-actuator-settings-scale-range",type:"range",min:"0",max:"2",step:"0.01",value:e.settings.scale||1,onChange:e=>this.handleActuatorSettingChange("scale",parseFloat(e.target.value)),disabled:!e.settings.enabled})]}),O.jsxs("div",{className:"fp-actuator-settings-offset-control",children:[O.jsxs("label",{className:"fp-actuator-settings-offset-label",children:["Time Offset: ",(1e3*(e.settings.timeOffset||0)).toFixed(0),"ms"]}),O.jsx("input",{className:"fp-actuator-settings-offset-range",type:"range",min:"-0.5",max:"0.5",step:"0.001",value:e.settings.timeOffset||0,onChange:e=>this.handleActuatorSettingChange("timeOffset",parseFloat(e.target.value)),disabled:!e.settings.enabled})]})]}),O.jsxs("label",{className:"fp-actuator-settings-invert-toggle",children:[O.jsx("input",{className:"fp-actuator-settings-invert-checkbox",type:"checkbox",checked:e.settings.invert||!1,onChange:e=>this.handleActuatorSettingChange("invert",e.target.checked),disabled:!e.settings.enabled}),O.jsx("span",{className:"fp-actuator-settings-invert-label",children:"Invert Values"})]})]})}}var Dp=Object.defineProperty,Op=(e,t,i)=>((e,t,i)=>t in e?Dp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Rp extends p.Component{constructor(e){super(e),Op(this,"handleEvent",(e,t)=>{["funscript:load","funscript:reset"].includes(e)&&("funscript:load"===e&&this.setState({pendingConfig:{}}),"funscript:reset"===e&&this.setState({isExpanded:!1}),this._triggerRender())}),Op(this,"_triggerRender",()=>{this.setState(e=>({renderTrigger:e.renderTrigger+1}))}),Op(this,"handleToggleExpanded",()=>{this.setState({isExpanded:!this.state.isExpanded},()=>{this.core.notify("component:resize",{source:"ChannelSettingsComponent",reason:"config-"+(this.state.isExpanded?"expanded":"collapsed")})})}),Op(this,"handleFieldChange",(e,t,i)=>{this.setState(n=>({pendingConfig:{...n.pendingConfig,[e]:{...n.pendingConfig[e],[t]:"none"===i?null:i}}}))}),Op(this,"handleValidate",()=>{try{const e=this.core.funscript.data;e&&(this.core.funscript.loadWithCustomFieldConfig(e,pendingConfig),this.setState({pendingConfig:{},isExpanded:!1}))}catch(e){}}),Op(this,"getCurrentConfig",(e,t)=>{const{pendingConfig:i}=this.state,n=this.core.funscript.getChannel(e);if(i[e]&&void 0!==i[e][t])return i[e][t]||"none";if(n&&n.fieldConfig)return n.fieldConfig[t]||"none";return{timeField:"at",valueField:"pos",directionField:"none",durationField:"none"}[t]||"none"}),Op(this,"getAvailableFields",(e,t)=>e[{timeField:"availableTimeFields",valueField:"availableValueFields",directionField:"availableDirectionFields",durationField:"availableDurationFields"}[t]]||[]),Op(this,"hasPendingChanges",()=>Object.keys(this.state.pendingConfig).length>0),Op(this,"renderExpandedSettings",()=>{if(!this.state.isExpanded)return null;const e=this.core.funscript.getDetectedFields(),t=Object.keys(e);return 0===t.length?O.jsx("div",{className:"fp-channel-settings-empty",children:"No channels detected. Load a funscript first."}):O.jsxs("div",{className:"fp-channel-settings-expanded",children:[t.map(t=>this.renderChannelConfig(t,e[t])),O.jsxs("div",{className:"fp-channel-settings-actions",children:[O.jsx("button",{className:"fp-channel-settings-validate-btn",onClick:this.handleValidate,disabled:!this.hasPendingChanges(),children:" Validate Changes"}),this.hasPendingChanges()&&O.jsx("button",{className:"fp-channel-settings-cancel-btn",onClick:()=>this.setState({pendingConfig:{}}),children:"Cancel"})]})]})}),Op(this,"renderChannelConfig",(e,t)=>O.jsxs("div",{className:"fp-channel-settings-channel",children:[O.jsx("span",{className:"fp-channel-settings-channel-name",children:e}),[{key:"timeField",label:"Time"},{key:"valueField",label:"Value"},{key:"directionField",label:"Direction"},{key:"durationField",label:"Duration"}].map(({key:i,label:n})=>{const r=this.getAvailableFields(t,i),s=this.getCurrentConfig(e,i);return O.jsxs("div",{className:"fp-channel-settings-field",children:[O.jsxs("label",{className:"fp-channel-settings-field-label",children:[n,":"]}),O.jsxs("select",{className:"fp-channel-settings-field-select",value:s,onChange:t=>this.handleFieldChange(e,i,t.target.value),children:[O.jsx("option",{value:"none",children:"none"}),r.map(e=>O.jsx("option",{value:e,children:e},e))]})]},i)})]})),this.core=e.core,this.state={isExpanded:!1,renderTrigger:0,pendingConfig:{}},this.coreListener=null}componentDidMount(){this.coreListener=this.core.addListener(this.handleEvent)}componentWillUnmount(){this.coreListener&&(this.coreListener(),this.coreListener=null)}render(){const{isExpanded:e}=this.state;if(!this.core.funscript.hasFunscript())return null;const t=this.core.funscript.getDetectedFields(),i=Object.keys(t).length;return O.jsxs("div",{className:"fp-channel-settings",children:[O.jsxs("div",{className:"fp-channel-settings-header",children:[O.jsxs("span",{className:"fp-channel-settings-title",children:["Configure Action Channels (",i,")"]}),O.jsx("button",{className:"fp-channel-settings-toggle",onClick:this.handleToggleExpanded,children:e?"":""})]}),this.renderExpandedSettings()]})}}var Np=Object.defineProperty,Fp=(e,t,i)=>((e,t,i)=>t in e?Np(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Up extends p.Component{constructor(e){super(e),Fp(this,"handleEvent",(e,t)=>{(["buttplug:device","funscript:load","funscript:channels","buttplug:connection"].includes(e)||["buttplug:globalScale","buttplug:globalOffset","core:autoConnect","core:autoMap"].includes(e))&&this._triggerRender()}),Fp(this,"_triggerRender",()=>{this.setState(e=>({renderTrigger:e.renderTrigger+1}))}),Fp(this,"handleToggleExpanded",()=>{this.setState({isExpanded:!this.state.isExpanded},()=>{this.core.notify("component:resize",{source:"HapticSettingsComponent",reason:"main-settings-"+(this.state.isExpanded?"expanded":"collapsed")})})}),Fp(this,"handleAutoMap",()=>{this.core.autoMapChannels()}),Fp(this,"handleUpdateRateChange",e=>{var t,i;null==(i=(t=this.props).onUpdateRateChange)||i.call(t,e)}),Fp(this,"handleGlobalScaleChange",e=>{this.core.buttplug.setGlobalScale(e)}),Fp(this,"handleGlobalOffsetChange",e=>{this.core.buttplug.setGlobalOffset(e)}),Fp(this,"handleIntifaceUrlChange",e=>{this.core.buttplug.setIntifaceUrl(e)}),this.core=e.core,this.state={isExpanded:!1,renderTrigger:0},this.coreListener=null}componentDidMount(){this.coreListener=this.core.addListener(this.handleEvent)}componentWillUnmount(){this.coreListener&&(this.coreListener(),this.coreListener=null)}render(){const{isExpanded:e}=this.state;return O.jsxs("div",{className:"fp-haptic-settings",children:[O.jsx(kp,{core:this.core,onToggleSettings:this.handleToggleExpanded,isSettingsExpanded:e}),this.renderExpandedSettings()]})}renderExpandedSettings(){var e,t,i;if(!this.state.isExpanded)return null;const n=this.core.funscript.getChannelNames(),r=this.core.buttplug.getActuators(),s=(null==(t=(e=this.props).onGetUpdateRate)?void 0:t.call(e))||60,a=this.core.buttplug.getGlobalOffset(),o=this.core.buttplug.getGlobalScale(),l=this.core.buttplug.getIntifaceUrl(),u=(null==(i=this.core.buttplug.getStatus())?void 0:i.isConnected)||!1;return O.jsxs("div",{className:"fp-haptic-settings-expanded",children:[O.jsxs("div",{className:"fp-haptic-settings-connection-section",children:[O.jsx("h6",{className:"fp-haptic-settings-section-title",children:" Connection"}),O.jsxs("div",{className:"fp-haptic-settings-connection-controls",children:[O.jsxs("div",{className:"fp-haptic-settings-url-control",children:[O.jsx("label",{className:"fp-haptic-settings-url-label",children:"Intiface WebSocket URL"}),O.jsxs("div",{className:"fp-haptic-settings-url-input-group",children:[O.jsx("input",{className:"fp-haptic-settings-url-input",type:"text",value:l,onChange:e=>this.handleIntifaceUrlChange(e.target.value),placeholder:"ws://localhost:12345",title:"WebSocket URL for Intiface Central connection"}),O.jsx("button",{className:"fp-haptic-settings-url-reset-btn",onClick:()=>this.handleIntifaceUrlChange("ws://localhost:12345"),title:"Reset to default",children:""})]}),O.jsx("span",{className:"fp-haptic-settings-url-status",children:u?` Connected to ${l}`:" Not connected"})]}),O.jsxs("div",{className:"fp-haptic-settings-rate-control",children:[O.jsx("label",{className:"fp-haptic-settings-rate-label",children:"Update Rate"}),O.jsxs("select",{className:"fp-haptic-settings-rate-select",value:s,onChange:e=>this.handleUpdateRateChange(parseInt(e.target.value)),title:"Haptic command frequency (higher = smoother but more CPU)",children:[O.jsx("option",{value:10,children:"10 Hz"}),O.jsx("option",{value:30,children:"30 Hz"}),O.jsx("option",{value:60,children:"60 Hz"}),O.jsx("option",{value:90,children:"90 Hz"}),O.jsx("option",{value:120,children:"120 Hz"})]}),O.jsxs("span",{className:"fp-haptic-settings-rate-info",children:[(1e3/s).toFixed(1),"ms interval"]})]})]})]}),O.jsx("div",{className:"fp-haptic-settings-divider"}),O.jsxs("div",{className:"fp-haptic-settings-master-section",children:[O.jsx("h6",{className:"fp-haptic-settings-section-title",children:" Master"}),O.jsxs("div",{className:"fp-haptic-settings-master-controls",children:[O.jsxs("div",{className:"fp-haptic-settings-scale-control",children:[O.jsxs("label",{className:"fp-haptic-settings-scale-label",children:["Global Scale: ",(100*(o||1)).toFixed(0),"%"]}),O.jsxs("div",{className:"fp-haptic-settings-scale-input-group",children:[O.jsx("input",{className:"fp-haptic-settings-scale-range",type:"range",min:"0",max:"2",step:"0.01",value:o||1,onChange:e=>this.handleGlobalScaleChange(parseFloat(e.target.value)),title:"Master intensity control for all actuators"}),O.jsx("input",{className:"fp-haptic-settings-scale-number",type:"number",value:o||1,onChange:e=>this.handleGlobalScaleChange(parseFloat(e.target.value)||1),step:"0.01",min:"0",max:"2"})]})]}),O.jsxs("div",{className:"fp-haptic-settings-offset-control",children:[O.jsxs("label",{className:"fp-haptic-settings-offset-label",children:["Global Offset: ",(1e3*(a||0)).toFixed(0),"ms"]}),O.jsxs("div",{className:"fp-haptic-settings-offset-input-group",children:[O.jsx("input",{className:"fp-haptic-settings-offset-range",type:"range",value:a||0,onChange:e=>this.handleGlobalOffsetChange(parseFloat(e.target.value)),min:"-1",max:"1",step:"0.01",title:"Global timing offset for all actuators"}),O.jsx("input",{className:"fp-haptic-settings-offset-number",type:"number",value:a||0,onChange:e=>this.handleGlobalOffsetChange(parseFloat(e.target.value)||0),step:"0.01",min:"-1",max:"1"})]})]})]})]}),n.length>0&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"fp-haptic-settings-divider"}),O.jsx("div",{className:"fp-haptic-settings-channels-header",children:O.jsx("h6",{className:"fp-haptic-settings-section-title",children:" Channels"})}),O.jsx(Rp,{core:this.core})]}),n.length>0&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"fp-haptic-settings-divider"}),O.jsxs("div",{className:"fp-haptic-settings-actuators-section",children:[O.jsxs("div",{className:"fp-haptic-settings-actuators-header",children:[O.jsx("h6",{className:"fp-haptic-settings-section-title",children:" Actuators"}),O.jsxs("button",{className:"fp-haptic-settings-automap-btn",onClick:this.handleAutoMap,children:["Auto Map All (",r.length,")"]})]}),O.jsx("div",{className:"fp-haptic-settings-actuators-list",children:r.map(e=>O.jsx(Lp,{core:this.core,actuator:e},e.index))})]})]})]})}}var Bp=Object.defineProperty,jp=(e,t,i)=>((e,t,i)=>t in e?Bp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class zp extends p.Component{constructor(e){super(e),jp(this,"initCanvas",()=>{const e=this.canvasRef.current;if(!e)return;this.ctx=e.getContext("2d");const t=e.getBoundingClientRect(),i=window.devicePixelRatio||1;e.width=t.width*i,e.height=t.height*i,this.ctx.scale(i,i),e.style.width=t.width+"px",e.style.height=t.height+"px"}),jp(this,"gaussian",(e,t,i)=>1/(i*Math.sqrt(2*Math.PI))*Math.exp(-Math.pow(e-t,2)/(2*Math.pow(i,2)))),jp(this,"calculateSigma",e=>{const{sigmaMin:t,sigmaMax:i}=this.config;return i-e*(i-t)}),jp(this,"getActuatorPosition",(e,t)=>t<=1?.5:(e+1)/(t+1)),jp(this,"getCurrentActuatorData",()=>{var e,t;return(null==(t=(e=this.props).getCurrentActuatorData)?void 0:t.call(e))||new Map}),jp(this,"getConfiguredActuatorCount",()=>{const e=this.getCurrentActuatorData();return Math.max(1,e.size)}),jp(this,"calculateNormalizationFactor",e=>{if(this.normalizationCache.has(e))return this.normalizationCache.get(e);const{resolution:t,sigmaMin:i}=this.config;let n=0;for(let s=0;s<=t;s++){const r=s/t;let a=0;for(let t=0;t<e;t++){const n=this.getActuatorPosition(t,e);a+=this.gaussian(r,n,i)}n=Math.max(n,a)}const r=n>0?1/n:1;return this.normalizationCache.set(e,r),r}),jp(this,"getActiveActuators",e=>Array.from(e.entries())),jp(this,"rebuildColorCache",()=>{const{resolution:e,rainbowRotation:t}=this.config;this.colorCache.rainbowColors=Array.from({length:e+1},(t,i)=>this.getColorAt(i/e)),this.colorCache.actuatorColors=new Map;for(let i=1;i<=8;i++)for(let e=0;e<i;e++){const t=this.getActuatorPosition(e,i),n=this.getColorAt(t);this.colorCache.actuatorColors.set(`${i}-${e}`,n)}this.colorCache.lastRotation=t,this.colorCache.lastResolution=e}),jp(this,"ensureColorCache",e=>{const{resolution:t,rainbowRotation:i}=this.config;this.colorCache.lastRotation===i&&this.colorCache.lastResolution===t&&this.colorCache.lastNActive===e||(this.rebuildColorCache(),this.colorCache.lastNActive=e)}),jp(this,"getCachedRainbowColor",e=>this.colorCache.rainbowColors[e]),jp(this,"getCachedActuatorColor",(e,t,i=1)=>{const n=this.colorCache.actuatorColors.get(`${e}-${t}`);return n?[Math.round(n[0]*i),Math.round(n[1]*i),Math.round(n[2]*i)]:[255,255,255]}),jp(this,"hsvToRgb",(e,t,i)=>{const n=i*t,r=n*(1-Math.abs(e/60%2-1)),s=i-n;let a,o,l;return[a,o,l]=e>=0&&e<60?[n,r,0]:e>=60&&e<120?[r,n,0]:e>=120&&e<180?[0,n,r]:e>=180&&e<240?[0,r,n]:e>=240&&e<300?[r,0,n]:[n,0,r],[Math.round(255*(a+s)),Math.round(255*(o+s)),Math.round(255*(l+s))]}),jp(this,"getColorAt",e=>{const t=(e+this.config.rainbowRotation)%1*360;return this.hsvToRgb(t,1,1)}),jp(this,"getActuatorColor",(e,t=1)=>{const i=this.getColorAt(e);return[Math.round(i[0]*t),Math.round(i[1]*t),Math.round(i[2]*t)]}),jp(this,"getRainbowBackgroundColor",e=>this.getColorAt(e)),jp(this,"calculatePoints",(e,t,i)=>{const n=this.getConfiguredActuatorCount(),r=e.length,{resolution:s,heightScale:a}=this.config,o=this.calculateNormalizationFactor(n);this.ensureColorCache(r);const l=[];for(let u=0;u<=s;u++){const n=u/s;let c=0,h=[0,0,0];e.forEach(([e,t],i)=>{const s=this.getActuatorPosition(i,r),a=Math.abs(t.value),o=this.calculateSigma(a),l=this.gaussian(n,s,o)*a;if(l>.001){const e=this.getCachedActuatorColor(r,i,a),t=this.getCachedRainbowColor(u),n=this.config.rainbowIntensity,s=[e[0]*(1-n)+t[0]*n,e[1]*(1-n)+t[1]*n,e[2]*(1-n)+t[2]*n];h[0]+=s[0]*l,h[1]+=s[1]*l,h[2]+=s[2]*l,c+=l}}),c>0&&(h=h.map(e=>Math.round(e/c))),l.push({x:n*t,y:i-c*o*a*i,intensity:c*o,color:h})}return l}),jp(this,"renderGradientFill",(e,t,i)=>{if(e.length<2)return;this.ctx.beginPath(),this.ctx.moveTo(0,i),e.forEach((t,i)=>{if(0===i)this.ctx.lineTo(t.x,t.y);else{const n=e[i-1],r=(n.x+t.x)/2;this.ctx.quadraticCurveTo(n.x,n.y,r,(n.y+t.y)/2)}}),this.ctx.lineTo(t,i),this.ctx.closePath();const n=this.ctx.createLinearGradient(0,0,t,0);e.forEach((t,i)=>{const r=i/(e.length-1),[s,a,o]=t.color,l=Math.min(1,.8*t.intensity);n.addColorStop(r,`rgba(${s}, ${a}, ${o}, ${l})`)}),this.ctx.fillStyle=n,this.ctx.fill(),this.ctx.shadowColor="rgba(255, 255, 255, 0.2)",this.ctx.shadowBlur=8,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.shadowBlur=0}),jp(this,"renderCurrentFrame",()=>{const e=this.getCurrentActuatorData(),t=this.getActiveActuators(e);if(0===t.length)return;const i=this.canvasRef.current;if(!i)return;const n=i.clientWidth,r=i.clientHeight,s=this.calculatePoints(t,n,r);this.renderGradientFill(s,n,r)}),jp(this,"startAnimation",()=>{const e=()=>{this.canvasRef.current&&(this.renderFrame(),this.animationId=requestAnimationFrame(e))};this.animationId=requestAnimationFrame(e)}),jp(this,"renderFrame",()=>{if(!this.ctx)return;const e=this.canvasRef.current;e&&(this.ctx.clearRect(0,0,e.clientWidth,e.clientHeight),this.renderCurrentFrame())}),jp(this,"toggleConfig",()=>{const e=!this.state.showConfig;this.setState({showConfig:e},()=>{this.core.notify("component:resize",{source:"HapticVisualizerComponent",reason:"config-panel-"+(e?"expanded":"collapsed")})})}),jp(this,"updateConfig",(e,t)=>{this.config[e]=t,"sigmaMin"!==e&&"sigmaMax"!==e||this.normalizationCache.clear(),this.forceUpdate()}),this.core=e.core,this.state={isPlaying:!1,showConfig:!1},this.canvasRef=f.createRef(),this.ctx=null,this.animationId=null,this.config={resolution:300,heightScale:.95,sigmaMin:.07,sigmaMax:.15,rainbowIntensity:.25,rainbowRotation:0},this.normalizationCache=new Map,this.colorCache={rainbowColors:null,actuatorColors:null,lastRotation:-1,lastResolution:-1,lastNActive:-1}}componentDidMount(){this.initCanvas(),this.startAnimation()}componentDidUpdate(e){const t=this.props.isPlaying||!1;t!==this.state.isPlaying&&this.setState({isPlaying:t}),e.visible!==this.props.visible&&this.core.notify("component:resize",{source:"HapticVisualizerComponent",reason:"visibility-"+(this.props.visible?"shown":"hidden")})}componentWillUnmount(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}render(){const{visible:e=!0}=this.props;return e?O.jsxs("div",{className:"fp-haptic-visualizer",children:[O.jsxs("div",{className:"fp-haptic-visualizer-canvas-area",children:[O.jsx("canvas",{ref:this.canvasRef,className:"fp-haptic-visualizer-canvas"}),O.jsx("button",{className:"fp-haptic-visualizer-config-btn",onClick:this.toggleConfig,title:"Visualizer settings",children:""})]}),this.state.showConfig&&O.jsxs("div",{className:"fp-haptic-visualizer-config",children:[O.jsxs("div",{className:"fp-haptic-visualizer-config-row",children:[O.jsxs("label",{className:"fp-haptic-visualizer-config-label",children:["Resolution: ",this.config.resolution]}),O.jsx("input",{className:"fp-haptic-visualizer-config-range",type:"range",min:"50",max:"500",step:"25",value:this.config.resolution,onChange:e=>this.updateConfig("resolution",parseInt(e.target.value))})]}),O.jsxs("div",{className:"fp-haptic-visualizer-config-row",children:[O.jsxs("label",{className:"fp-haptic-visualizer-config-label",children:["Height: ",(100*this.config.heightScale).toFixed(0),"%"]}),O.jsx("input",{className:"fp-haptic-visualizer-config-range",type:"range",min:"0.1",max:"1.0",step:"0.05",value:this.config.heightScale,onChange:e=>this.updateConfig("heightScale",parseFloat(e.target.value))})]}),O.jsxs("div",{className:"fp-haptic-visualizer-config-row",children:[O.jsxs("label",{className:"fp-haptic-visualizer-config-label",children:["Sigma Min: ",this.config.sigmaMin.toFixed(2)]}),O.jsx("input",{className:"fp-haptic-visualizer-config-range",type:"range",min:"0.01",max:"0.2",step:"0.01",value:this.config.sigmaMin,onChange:e=>this.updateConfig("sigmaMin",parseFloat(e.target.value))})]}),O.jsxs("div",{className:"fp-haptic-visualizer-config-row",children:[O.jsxs("label",{className:"fp-haptic-visualizer-config-label",children:["Sigma Max: ",this.config.sigmaMax.toFixed(2)]}),O.jsx("input",{className:"fp-haptic-visualizer-config-range",type:"range",min:"0.05",max:"0.3",step:"0.01",value:this.config.sigmaMax,onChange:e=>this.updateConfig("sigmaMax",parseFloat(e.target.value))})]}),O.jsxs("div",{className:"fp-haptic-visualizer-config-row",children:[O.jsxs("label",{className:"fp-haptic-visualizer-config-label",children:["Rainbow: ",(100*this.config.rainbowIntensity).toFixed(0),"%"]}),O.jsx("input",{className:"fp-haptic-visualizer-config-range",type:"range",min:"0.0",max:"1",step:"0.05",value:this.config.rainbowIntensity,onChange:e=>this.updateConfig("rainbowIntensity",parseFloat(e.target.value))})]}),O.jsxs("div",{className:"fp-haptic-visualizer-config-row",children:[O.jsxs("label",{className:"fp-haptic-visualizer-config-label",children:["Hue: ",(360*this.config.rainbowRotation).toFixed(0),""]}),O.jsx("input",{className:"fp-haptic-visualizer-config-range",type:"range",min:"0.0",max:"1.0",step:"0.02",value:this.config.rainbowRotation,onChange:e=>this.updateConfig("rainbowRotation",parseFloat(e.target.value))})]})]})]}):null}}var Vp=Object.defineProperty,Hp=(e,t,i)=>((e,t,i)=>t in e?Vp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class qp extends p.Component{constructor(e){super(e),Hp(this,"setupResizeObserver",()=>{this.textareaRef.current&&window.ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.core.notify("component:resize",{source:"LoggingComponent",reason:"textarea-content-changed"})},0)}),this.resizeObserver.observe(this.textareaRef.current))}),Hp(this,"handleEvent",(e,t)=>{e.startsWith("status:")&&this.updateTextarea()}),Hp(this,"updateTextarea",()=>{this.textareaRef.current&&(this.textareaRef.current.value=this.core.logging.getFormattedLogs(),this.state.autoScroll&&(this.textareaRef.current.scrollTop=this.textareaRef.current.scrollHeight))}),Hp(this,"handleClear",()=>{this.core.logging.clear()}),Hp(this,"handleDownload",()=>{var e,t;const i=this.core.generateExportContent(),n=`funplayer-debug-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)}.log`,r=new Blob([i],{type:"text/plain"}),s=URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),null==(t=(e=this.core).notify)||t.call(e,"status:logging",{message:`Debug logs downloaded: ${n}`,type:"success"})}),Hp(this,"handleCopy",async()=>{var e,t,i,n;try{const i=this.core.generateExportContent();await navigator.clipboard.writeText(i),null==(t=(e=this.core).notify)||t.call(e,"status:logging",{message:"Debug logs copied to clipboard",type:"success"})}catch(r){this.textareaRef.current&&(this.textareaRef.current.select(),null==(n=(i=this.core).notify)||n.call(i,"status:logging",{message:"Logs selected, press Ctrl+C to copy",type:"info"}))}}),Hp(this,"handleToggleAutoScroll",()=>{this.setState(e=>({autoScroll:!e.autoScroll}))}),this.core=e.core,this.state={autoScroll:!0},this.textareaRef=f.createRef(),this.coreListener=null,this.resizeObserver=null}componentDidMount(){this.coreListener=this.core.addListener(this.handleEvent),this.updateTextarea(),this.setupResizeObserver()}componentWillUnmount(){this.coreListener&&(this.coreListener(),this.coreListener=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}render(){const{visible:e=!0}=this.props;if(!e)return null;const{autoScroll:t}=this.state,i=this.core.logging.getLogs().length;return O.jsxs("div",{className:"fp-logging",children:[O.jsxs("div",{className:"fp-logging-header",children:[O.jsxs("div",{className:"fp-logging-title",children:[O.jsx("span",{className:"fp-logging-icon",children:""}),O.jsx("span",{className:"fp-logging-label",children:"Debug Logs"}),O.jsx("span",{className:"fp-logging-count",children:i})]}),O.jsxs("div",{className:"fp-logging-actions",children:[O.jsx("button",{className:"fp-logging-clear-btn",onClick:this.handleClear,title:"Clear logs",children:""}),O.jsx("button",{className:"fp-logging-download-btn",onClick:this.handleDownload,title:"Download logs",children:""}),O.jsx("button",{className:"fp-logging-copy-btn",onClick:this.handleCopy,title:"Copy to clipboard",children:""}),O.jsx("button",{className:"fp-logging-autoscroll-btn "+(t?"fp-logging-autoscroll-btn-active":""),onClick:this.handleToggleAutoScroll,title:"Toggle auto-scroll",children:t?"":""})]})]}),O.jsx("textarea",{ref:this.textareaRef,className:"fp-logging-textarea",readOnly:!0,placeholder:"Debug logs will appear here..."})]})}}class Gp extends p.Component{render(){const{isPlaying:e,updateRate:t,showVisualizer:i,showDebug:n,onToggleVisualizer:r,onToggleDebug:s}=this.props;return O.jsxs("div",{className:"fp-status-bar",children:[O.jsxs("span",{className:"fp-status-bar-status",children:[e?"":"",t,"Hz"]}),O.jsxs("div",{className:"fp-status-bar-controls",children:[O.jsx("button",{className:"fp-status-bar-visualizer-btn",onClick:r,title:i?"Hide Visualizer":"Show Visualizer",children:i?"":""}),O.jsx("button",{className:"fp-status-bar-debug-btn",onClick:s,title:n?"Hide Debug":"Show Debug",children:n?"":""})]})]})}}const Wp={primaryColor:"--fp-primary-color",backgroundColor:"--fp-background-color",secondaryBackgroundColor:"--fp-secondary-background-color",textColor:"--fp-text-color",borderColor:"--fp-border-color",fontFamily:"--fp-font-family",baseRadius:"--fp-base-radius",spacing:"--fp-spacing"},$p={"--fp-primary-color":"#FF4B4B","--fp-background-color":"#FFFFFF","--fp-secondary-background-color":"#F0F2F6","--fp-text-color":"#262730","--fp-border-color":"#E6EBF5","--fp-font-family":'"Source Sans Pro", sans-serif',"--fp-base-radius":"0.5rem","--fp-spacing":"0.5rem","--fp-hover-color":"rgba(255, 75, 75, 0.1)","--fp-focus-color":"rgba(255, 75, 75, 0.25)","--fp-disabled-color":"rgba(38, 39, 48, 0.3)"},Xp={"--fp-background-color":"#0E1117","--fp-secondary-background-color":"#262730","--fp-text-color":"#FAFAFA","--fp-border-color":"#464954"};function Yp(e){return Wp[e]||`--fp-${e.replace(/([A-Z])/g,"-$1").toLowerCase()}`}function Qp(e,t){if(!e||"string"!=typeof e)return null;if(3===(e=e.replace("#","")).length&&(e=e.split("").map(e=>e+e).join("")),6!==e.length)return null;const i=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return isNaN(i)||isNaN(n)||isNaN(r)?null:`rgba(${i}, ${n}, ${r}, ${t})`}function Kp(e){const t=[],i=[];return Object.entries(e).forEach(([e,n])=>{const r=Yp(e);if(r&&"base"!==e&&(t.push(`${r}: ${n};`),"primaryColor"===e)){const e=Qp(n,.1),t=Qp(n,.25);e&&i.push(`--fp-hover-color: ${e};`),t&&i.push(`--fp-focus-color: ${t};`)}}),{cssVars:t.join("\n      "),derivedVars:i.join("\n      ")}}function Zp(){return`\n    /* Surcharges automatiques pour le mode sombre */\n    ${Object.entries(Xp).map(([e,t])=>`${e}: ${t};`).join("\n      ")}\n  `}function Jp(e){if(!e||"object"!=typeof e)return!1;const t=Object.keys(Wp).concat(["base"]);return Object.keys(e).some(e=>t.includes(e))}const ef={CSS_VAR_MAPPINGS:Wp,DEFAULT_THEME_VALUES:$p,DARK_THEME_OVERRIDES:Xp,convertToCssVar:Yp,hexToRgba:Qp,buildThemeCSS:Kp,getDarkThemeCSS:Zp,applyThemeToElement:function(e,t,i={}){if(!e||!t)return!1;const{setDataTheme:n=!0}=i;try{return Object.entries(e).forEach(([e,i])=>{if("base"!==e){const n=Yp(e);if(t.style.setProperty(n,i),"primaryColor"===e){const e=Qp(i,.1),n=Qp(i,.25);e&&t.style.setProperty("--fp-hover-color",e),n&&t.style.setProperty("--fp-focus-color",n)}}}),n&&e.base&&t.setAttribute("data-theme",e.base),!0}catch(r){return!1}},buildShadowDOMThemeCSS:function(e,t=".funplayer-shadow-container"){const i=Kp(e),n="dark"===e.base?Zp():"";return`\n    /* ============================================================================\n      THEME STYLES - Variables prfixes "fp-" (pas de conflit avec site hte)\n      ============================================================================ */\n    \n    ${t} {\n      /* Variables CSS avec prfixe fp- */\n      ${i.cssVars}\n      ${i.derivedVars}\n      \n      /* Application directe des variables prfixes */\n      background: var(--fp-background-color, #FFFFFF);\n      color: var(--fp-text-color, #262730);\n      border-radius: var(--fp-base-radius, 0.5rem);\n      \n      /* Variables par dfaut */\n      ${Object.entries($p).map(([e,t])=>`${e}: ${t};`).join("\n      ")}\n      \n      /* Mode sombre */\n      ${n}\n    }\n    \n    /* Application sur les composants FunPlayer */\n    .fp-btn {\n      border-color: var(--fp-border-color, #E6EBF5);\n      color: var(--fp-text-color, #262730);\n    }\n    \n    .fp-btn:hover {\n      background: var(--fp-hover-color, rgba(255, 75, 75, 0.1));\n      border-color: var(--fp-primary-color, #FF4B4B);\n    }\n    \n    .fp-section {\n      background: var(--fp-secondary-background-color, #F0F2F6);\n      color: var(--fp-text-color, #262730);\n    }\n  `},isValidTheme:Jp,sanitizeTheme:function(e){if(!Jp(e))return{};const t={},i=Object.keys(Wp).concat(["base"]);return Object.entries(e).forEach(([e,n])=>{i.includes(e)&&null!=n&&(t[e]=n)}),t}};var tf=Object.defineProperty,nf=(e,t,i)=>((e,t,i)=>t in e?tf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class rf extends p.Component{constructor(e){super(e),nf(this,"initializeComponent",()=>{var e,t,i,n,r,s;try{null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Initializing FunPlayer component...",type:"processing"}),this.coreListener=this.core.addListener(this.handleEvent),this.props.playlist&&this.handlePlaylistUpdate(),null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:"FunPlayer component initialized",type:"success"})}catch(a){null==(s=(r=this.core).notify)||s.call(r,"status:funplayer",{message:"FunPlayer initialization failed",type:"error",error:a.message})}}),nf(this,"handlePlaylistUpdate",async()=>{var e,t;const{playlist:i}=this.props;null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:`Synchronizing playlist: ${(null==i?void 0:i.length)||0} items`,type:"log"}),await this.core.playlist.loadPlaylist(i)}),nf(this,"applyTheme",()=>{var e,t,i,n;const{theme:r}=this.props;if(!r)return;const s=this.containerRef.current;if(!s)return;ef.applyThemeToElement(r,s)?null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Theme applied successfully with fp- prefixed variables",type:"log"}):null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:"Failed to apply theme",type:"error"})}),nf(this,"handleEvent",(e,t)=>{var i,n;switch(e){case"media:play":this.handleMediaPlayEvent(t);break;case"media:pause":this.handleMediaPauseEvent(t);break;case"media:ended":this.handleMediaEndedEvent(t);break;case"media:seeking":this.handleMediaSeekingEvent(t);break;case"media:seeked":this.handleMediaSeekedEvent(t);break;case"media:timeupdate":this.handleMediaTimeUpdateEvent(t);break;case"media:durationchange":this.handleMediaDurationChangeEvent(t);break;case"media:loadstart":this.handleMediaLoadStartEvent(t);break;case"media:loadeddata":this.handleMediaLoadedDataEvent(t);break;case"media:loadedmetadata":this.handleMediaLoadedMetadataEvent(t);break;case"media:canplay":this.handleMediaCanPlayEvent(t);break;case"media:canplaythrough":this.handleMediaCanPlayThroughEvent(t);break;case"media:waiting":this.handleMediaWaitingEvent(t);break;case"media:stalled":this.handleMediaStalledEvent(t);break;case"media:suspend":this.handleMediaSuspendEvent(t);break;case"media:volumechange":this.handleMediaVolumeChangeEvent(t);break;case"media:error":this.handleMediaErrorEvent(t);break;case"media:playlistitemchange":this.handleMediaPlaylistItemChangeEvent(t);break;case"media:resize":this.handleMediaResizeEvent(t);break;case"buttplug:device":!1!==t.connected?this.handleDeviceConnect(t):this.handleDeviceDisconnect(t),this._triggerRender();break;case"buttplug:connection":if(!1===t.connected&&t.reason){const e={device:{name:"All devices"},reason:t.reason};this.handleDeviceDisconnect(e)}this._triggerRender();break;case"haptic:started":this.handleHapticStart(t);break;case"haptic:stopped":this.handleHapticStop(t);break;case"core:ready":this.core.notify("status:funplayer",{message:"Core systems ready",type:"success"}),this._triggerRender();break;case"playlist:playbackChanged":this.setState({isPlaying:t.isPlaying});break;case"playlist:itemChanged":if(this.mediaPlayerRef.current&&t.index>=0){const e=this.mediaPlayerRef.current.getPlaylistInfo().currentIndex;e!==t.index&&(null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:`Syncing MediaPlayer: ${e}  ${t.index}`,type:"log"}),this.mediaPlayerRef.current.goToPlaylistItem(t.index))}break;case"funscript:load":case"funscript:channels":this._triggerRender();break;case"component:resize":this.handleResize(t)}}),nf(this,"_triggerRender",()=>{this.setState(e=>({renderTrigger:e.renderTrigger+1}))}),nf(this,"handleResize",e=>{var t,i,n,r,s,a;const o=this.containerRef.current;if(!o)return;const l={width:o.offsetWidth,height:o.scrollHeight};if(e&&"object"==typeof e){const n=e.source||"unknown",r=e.reason?` (${e.reason})`:"";null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Resize from ${n}${r}: ${l.width}${l.height}px`,type:"log"})}else null==(r=(n=this.core).notify)||r.call(n,"status:funplayer",{message:`Resize (legacy call): ${l.width}${l.height}px`,type:"log"});null==(a=(s=this.props).onResize)||a.call(s,l)}),nf(this,"handleDeviceConnect",e=>{var t,i,n,r,s;null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:`Device connected: ${(null==(t=e.device)?void 0:t.name)||"Unknown"}`,type:"log"}),null==(s=(r=this.props).onDeviceConnect)||s.call(r,e)}),nf(this,"handleDeviceDisconnect",e=>{var t,i,n,r,s;null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:`Device disconnected: ${(null==(t=e.device)?void 0:t.name)||"Unknown"}`,type:"log"}),null==(s=(r=this.props).onDeviceDisconnect)||s.call(r,e)}),nf(this,"handleHapticStart",e=>{var t,i,n,r;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Haptic playback started: ${e.channels} channels at ${e.updateRate}Hz`,type:"log"}),null==(r=(n=this.props).onHapticStart)||r.call(n,e)}),nf(this,"handleHapticStop",e=>{var t,i,n,r;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Haptic playback stopped: ${e.reason}`,type:"log"}),null==(r=(n=this.props).onHapticStop)||r.call(n,e)}),nf(this,"handleMediaPlay",e=>{var t,i;this.core.notify("media:play",e),null==(i=(t=this.props).onPlay)||i.call(t,e)}),nf(this,"handleMediaPause",e=>{var t,i;this.core.notify("media:pause",e),null==(i=(t=this.props).onPause)||i.call(t,e)}),nf(this,"handleMediaEnded",e=>{var t,i;this.core.notify("media:ended",e),null==(i=(t=this.props).onEnded)||i.call(t,e)}),nf(this,"handleMediaSeeking",e=>{var t,i;this.core.notify("media:seeking",e),null==(i=(t=this.props).onSeeking)||i.call(t,e)}),nf(this,"handleMediaSeeked",e=>{var t,i;this.core.notify("media:seeked",e),null==(i=(t=this.props).onSeeked)||i.call(t,e)}),nf(this,"handleMediaTimeUpdate",e=>{var t,i;this.core.notify("media:timeupdate",e),null==(i=(t=this.props).onTimeUpdate)||i.call(t,e)}),nf(this,"handleMediaDurationChange",e=>{var t,i;this.core.notify("media:durationchange",e),null==(i=(t=this.props).onDurationChange)||i.call(t,e)}),nf(this,"handleMediaLoadStart",e=>{var t,i;this.core.notify("media:loadstart",e),null==(i=(t=this.props).onLoadStart)||i.call(t,e)}),nf(this,"handleMediaLoadedData",e=>{var t,i;this.core.notify("media:loadeddata",e),null==(i=(t=this.props).onLoadedData)||i.call(t,e)}),nf(this,"handleMediaLoadedMetadata",e=>{var t,i;this.core.notify("media:loadedmetadata",e),null==(i=(t=this.props).onLoadedMetadata)||i.call(t,e)}),nf(this,"handleMediaCanPlay",e=>{var t,i;this.core.notify("media:canplay",e),null==(i=(t=this.props).onCanPlay)||i.call(t,e)}),nf(this,"handleMediaCanPlayThrough",e=>{var t,i;this.core.notify("media:canplaythrough",e),null==(i=(t=this.props).onCanPlayThrough)||i.call(t,e)}),nf(this,"handleMediaWaiting",e=>{var t,i;this.core.notify("media:waiting",e),null==(i=(t=this.props).onWaiting)||i.call(t,e)}),nf(this,"handleMediaStalled",e=>{var t,i;this.core.notify("media:stalled",e),null==(i=(t=this.props).onStalled)||i.call(t,e)}),nf(this,"handleMediaSuspend",e=>{var t,i;this.core.notify("media:suspend",e),null==(i=(t=this.props).onSuspend)||i.call(t,e)}),nf(this,"handleMediaVolumeChange",e=>{var t,i;this.core.notify("media:volumechange",e),null==(i=(t=this.props).onVolumeChange)||i.call(t,e)}),nf(this,"handleMediaError",e=>{var t,i;this.core.notify("media:error",e),null==(i=(t=this.props).onError)||i.call(t,e)}),nf(this,"handleMediaPlaylistItemChange",e=>{var t,i;this.core.notify("media:playlistitemchange",e),null==(i=(t=this.props).onPlaylistItemChange)||i.call(t,e)}),nf(this,"handleMediaResize",e=>{this.core.notify("media:resize",e)}),nf(this,"handleMediaPlayEvent",({currentTime:e})=>{var t,i,n;this.hapticTime=e||0,this.lastMediaTime=this.hapticTime,this.lastSyncTime=performance.now();const r=(null==(t=this.mediaPlayerRef.current)?void 0:t.getDuration())||0;this.core.playlist.updatePlaybackState(!0,e,r),this.core.funscript.hasFunscript()&&(this.startHapticLoop(),null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:`Haptic playback started at ${e.toFixed(1)}s`,type:"log"}))}),nf(this,"handleMediaPauseEvent",async({currentTime:e})=>{var t,i,n,r,s;if(this.core.funscript.hasFunscript()){this.stopHapticLoop();try{await this.core.buttplug.stopAll(),null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Haptic devices stopped",type:"log"})}catch(o){null==(r=(n=this.core).notify)||r.call(n,"status:funplayer",{message:"Failed to stop haptic devices",type:"log",error:o.message})}}const a=(null==(s=this.mediaPlayerRef.current)?void 0:s.getDuration())||0;this.core.playlist.updatePlaybackState(!1,e,a),this.setState({currentActuatorData:new Map})}),nf(this,"handleMediaEndedEvent",async({currentTime:e})=>{var t,i,n,r;if(this.core.funscript.hasFunscript()){this.stopHapticLoop();try{await this.core.buttplug.stopAll(),null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Haptic playback ended",type:"log"})}catch(s){null==(r=(n=this.core).notify)||r.call(n,"status:funplayer",{message:"Failed to stop haptic devices on end",type:"log",error:s.message})}}this.core.playlist.updatePlaybackState(!1,0,0),this.hapticTime=0,this.lastMediaTime=0,this.setState({currentActuatorData:new Map})}),nf(this,"handleMediaSeekingEvent",({currentTime:e})=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Seeking to ${e.toFixed(1)}s`,type:"log"})}),nf(this,"handleMediaSeekedEvent",({currentTime:e})=>{var t,i;this.core.funscript.hasFunscript()&&this.hapticIntervalId&&(this.hapticTime=e,this.lastMediaTime=e,this.lastSyncTime=performance.now(),null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Seeked to ${e.toFixed(1)}s`,type:"log"}))}),nf(this,"handleMediaTimeUpdateEvent",({currentTime:e})=>{var t,i,n,r;if(this.isHapticAborted)return;if(!this.core.funscript.hasFunscript()||!this.hapticIntervalId)return;const s=performance.now(),a=(s-this.lastSyncTime)/1e3,o=e-this.lastMediaTime;if(a>1&&Math.abs(o)<.01&&!this.isBuffering)return null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Player stall detected (1s+ frozen), starting timeout",type:"error"}),void this._startBuffering("stall_detection",e);const l=Math.abs(e-this.hapticTime);(l>.05||a>1)&&(this.hapticTime=e,this.lastMediaTime=e,this.lastSyncTime=s,l>.1&&(null==(r=(n=this.core).notify)||r.call(n,"status:funplayer",{message:`Haptic drift detected: ${(1e3*l).toFixed(1)}ms, resyncing`,type:"log"})))}),nf(this,"handleMediaDurationChangeEvent",({duration:e})=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Duration changed: ${e.toFixed(1)}s`,type:"log"})}),nf(this,"handleMediaLoadStartEvent",e=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Media loading started",type:"log"})}),nf(this,"handleMediaLoadedDataEvent",({duration:e})=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Media data loaded: ${e.toFixed(1)}s`,type:"log"})}),nf(this,"handleMediaLoadedMetadataEvent",e=>{var t,i,n,r,s;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Media loaded: ${e.duration.toFixed(1)}s`,type:"log"});const a=this.core.playlist.getCurrentItem();a&&Math.abs((a.duration||0)-e.duration)>1&&(null==(s=(r=this.core).notify)||s.call(r,"status:funplayer",{message:`Duration corrected: ${(null==(n=a.duration)?void 0:n.toFixed(1))||"unknown"}s  ${e.duration.toFixed(1)}s`,type:"log"}),this.core.playlist.updateCurrentItemDuration(e.duration)),this.handleResize()}),nf(this,"handleMediaCanPlayEvent",({currentTime:e})=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Media can play",type:"log"}),this.isBuffering&&this._endBuffering("canplay",e)}),nf(this,"handleMediaCanPlayThroughEvent",({currentTime:e})=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Media can play through",type:"log"})}),nf(this,"handleMediaWaitingEvent",({currentTime:e})=>{this.isBuffering&&"waiting"===this.bufferingSource||(this.stallTimeoutId&&(clearTimeout(this.stallTimeoutId),this.stallTimeoutId=null),this._startBuffering("waiting",e))}),nf(this,"handleMediaStalledEvent",({currentTime:e})=>{this.handleMediaWaitingEvent({currentTime:e})}),nf(this,"handleMediaSuspendEvent",({currentTime:e})=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Media loading suspended",type:"log"})}),nf(this,"handleMediaVolumeChangeEvent",({volume:e,muted:t})=>{var i,n;null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:"Volume: "+(t?"muted":Math.round(100*e)+"%"),type:"log"})}),nf(this,"handleMediaErrorEvent",e=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:"Media loading failed",type:"error",error:e.message}),this.core.setError("Media loading failed",e)}),nf(this,"handleMediaPlaylistItemChangeEvent",e=>{var t,i,n,r;if(null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`MediaPlayer switched to item ${e}`,type:"log"}),e>=0){e!==this.core.playlist.getCurrentIndex()&&(null==(r=(n=this.core).notify)||r.call(n,"status:funplayer",{message:`Syncing core playlist to Video.js index ${e}`,type:"log"}),this.core.playlist.goTo(e))}}),nf(this,"handleMediaResizeEvent",e=>{this.core.notify("component:resize",{source:"MediaPlayer",reason:"video-js-resize",dimensions:e})}),nf(this,"_startBuffering",(e,t)=>{var i,n,r,s,a,o;if(!this.isBuffering||"waiting"!==this.bufferingSource){if(this.isBuffering=!0,this.bufferingSource=e,this.bufferingStartTime=performance.now(),this.hapticIntervalId){this.stopHapticLoop();try{this.core.buttplug.stopAll(),null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:`Buffering suspended (${e})`,type:"log"})}catch(l){null==(s=(r=this.core).notify)||s.call(r,"status:funplayer",{message:"Failed to stop haptic devices",type:"log",error:l.message})}}this.setState({currentActuatorData:new Map}),"stall_detection"===e&&(this.stallTimeoutId=setTimeout(()=>{this._abortHapticPlayback()},this.stallTimeout),null==(o=(a=this.core).notify)||o.call(a,"status:funplayer",{message:`Player stall timeout started (${this.stallTimeout}ms)`,type:"error"}))}}),nf(this,"_endBuffering",(e,t)=>{var i,n,r,s;if(!this.isBuffering)return;const a=performance.now()-this.bufferingStartTime,o="stall_detection"===this.bufferingSource;this.stallTimeoutId&&(clearTimeout(this.stallTimeoutId),this.stallTimeoutId=null),this.isBuffering=!1,this.bufferingSource=null,this.isHapticAborted&&"canplay"===e&&(this.isHapticAborted=!1,null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:"Player recovered, haptic playback re-enabled",type:"success"}));const l=this.mediaPlayerRef.current;if(l&&l.isPlaying()&&this.core.funscript.hasFunscript()&&!this.isHapticAborted){this.hapticTime=t||l.getTime(),this.lastMediaTime=this.hapticTime,this.lastSyncTime=performance.now(),this.startHapticLoop();const i=o?" (stall recovered)":"";null==(s=(r=this.core).notify)||s.call(r,"status:funplayer",{message:`Buffering ended via ${e} (${a.toFixed(0)}ms)${i}, haptic resumed`,type:"success"})}}),nf(this,"_abortHapticPlayback",()=>{var e,t,i,n,r,s;const a=performance.now()-this.bufferingStartTime;this.stallTimeoutId&&(clearTimeout(this.stallTimeoutId),this.stallTimeoutId=null),this.isHapticAborted=!0,this.isBuffering=!1,this.bufferingSource=null,this.stopHapticLoop();try{this.core.buttplug.stopAll()}catch(l){}const o=this.mediaPlayerRef.current;if(o)try{o.pause(),null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Sent pause command to unresponsive player",type:"log"})}catch(l){null==(n=(i=this.core).notify)||n.call(i,"status:funplayer",{message:"Failed to send pause to player",type:"log",error:l.message})}this.setState({currentActuatorData:new Map}),null==(s=(r=this.core).notify)||s.call(r,"status:funplayer",{message:`Media playing aborted due to unresponsive player (${a.toFixed(0)}ms stall)`,type:"error"})}),nf(this,"processHapticFrame",async e=>{const t=this.mediaPlayerRef.current;if(!t)return;if(this.isHapticAborted||this.isBuffering)return;this.hapticTime+=e;const i=this.hapticTime,n=this.getMediaRefreshRate(t),r=this.calculateLinearDuration(e,n),s=await this.core.processHapticFrame(i,{duration:1e3*r});this.setState({currentActuatorData:s})}),nf(this,"startHapticLoop",()=>{var e,t;if(this.hapticIntervalId)return;this.expectedHapticTime=performance.now();const i=1e3/this.state.updateRate;null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:`Starting haptic loop at ${this.state.updateRate}Hz`,type:"log"});const n={channels:this.core.funscript.getChannels().length,updateRate:this.state.updateRate,reason:"media_play"};this.core.notify("haptic:started",n);const r=()=>{var e,t;try{const e=performance.now(),t=e-this.expectedHapticTime,n=i/1e3;this.processHapticFrame(n),this.expectedHapticTime+=i;const s=Math.max(0,i-t),a=1e3/this.state.updateRate;a!==i?(this.expectedHapticTime=e+a,this.hapticIntervalId=setTimeout(()=>this.restartWithNewRate(),a)):this.hapticIntervalId=setTimeout(r,s)}catch(n){null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Haptic loop error",type:"error",error:n.message}),this.hapticIntervalId=setTimeout(r,i)}};this.hapticIntervalId=setTimeout(r,i)}),nf(this,"stopHapticLoop",()=>{var e,t;if(this.hapticIntervalId){clearTimeout(this.hapticIntervalId),this.hapticIntervalId=null,null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Haptic loop stopped",type:"log"});const i={reason:"media_pause"};this.core.notify("haptic:stopped",i)}this.expectedHapticTime=0,this.lastSyncTime=0}),nf(this,"restartWithNewRate",()=>{var e,t;null!==this.hapticIntervalId&&(null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:`Restarting haptic loop with new rate: ${this.state.updateRate}Hz`,type:"log"}),this.stopHapticLoop(),this.startHapticLoop())}),nf(this,"getCurrentActuatorData",()=>this.state.currentActuatorData),nf(this,"getMediaRefreshRate",e=>{switch(e.getState().mediaType){case"playlist":const t=e.getCurrentItem();if(!t||!t.sources||0===t.sources.length)return this.state.updateRate;return(t.sources[0].type||"").startsWith("audio/")?this.state.updateRate:30;case"media":return 30;default:return this.state.updateRate}}),nf(this,"calculateLinearDuration",(e,t)=>{const i=1/t,n=1.2*Math.max(e,i);return Math.max(.01,Math.min(.1,n))}),nf(this,"getUpdateRate",()=>this.state.updateRate),nf(this,"handleUpdateRateChange",e=>{var t,i;null==(i=(t=this.core).notify)||i.call(t,"status:funplayer",{message:`Update rate changed: ${this.state.updateRate}Hz  ${e}Hz`,type:"log"}),this.setState({updateRate:e})}),nf(this,"handleToggleVisualizer",()=>{var e,t;const i=!this.state.showVisualizer;null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Visualizer "+(i?"shown":"hidden"),type:"log"}),this.setState({showVisualizer:i},()=>{this.handleResize()})}),nf(this,"handleToggleDebug",()=>{var e,t;const i=!this.state.showDebug;null==(t=(e=this.core).notify)||t.call(e,"status:funplayer",{message:"Debug panel "+(i?"shown":"hidden"),type:"log"}),this.setState({showDebug:i},()=>{this.handleResize()})}),this.core=new wp,this.state={updateRate:60,isPlaying:!1,currentActuatorData:new Map,showVisualizer:!0,showDebug:!1,renderTrigger:0},this.containerRef=f.createRef(),this.mediaPlayerRef=f.createRef(),this.hapticIntervalId=null,this.expectedHapticTime=0,this.hapticTime=0,this.lastMediaTime=0,this.lastSyncTime=0,this.isBuffering=!1,this.bufferingStartTime=0,this.bufferingSource=null,this.stallTimeoutId=null,this.stallTimeout=5e3,this.isHapticAborted=!1,this.coreListener=null}componentDidMount(){this.applyTheme(),this.initializeComponent()}componentDidUpdate(e){e.theme!==this.props.theme&&this.applyTheme(),e.playlist!==this.props.playlist&&this.handlePlaylistUpdate()}componentWillUnmount(){this.stopHapticLoop(),this.stallTimeoutId&&(clearTimeout(this.stallTimeoutId),this.stallTimeoutId=null),this.coreListener&&this.coreListener()}render(){const{showVisualizer:e,showDebug:t}=this.state,i=this.core.playlist.items;return O.jsxs("div",{className:"fp-funplayer",ref:this.containerRef,children:[O.jsx(Up,{core:this.core,onUpdateRateChange:this.handleUpdateRateChange,onGetUpdateRate:this.getUpdateRate}),O.jsx(rd,{ref:this.mediaPlayerRef,playlist:i,notify:this.core.notify,onPlay:this.handleMediaPlay,onPause:this.handleMediaPause,onEnded:this.handleMediaEnded,onSeeking:this.handleMediaSeeking,onSeeked:this.handleMediaSeeked,onTimeUpdate:this.handleMediaTimeUpdate,onDurationChange:this.handleMediaDurationChange,onLoadStart:this.handleMediaLoadStart,onLoadedData:this.handleMediaLoadedData,onLoadedMetadata:this.handleMediaLoadedMetadata,onCanPlay:this.handleMediaCanPlay,onCanPlayThrough:this.handleMediaCanPlayThrough,onWaiting:this.handleMediaWaiting,onStalled:this.handleMediaStalled,onSuspend:this.handleMediaSuspend,onVolumeChange:this.handleMediaVolumeChange,onError:this.handleMediaError,onResize:this.handleResize}),O.jsx(zp,{core:this.core,visible:e,isPlaying:this.state.isPlaying,getCurrentActuatorData:this.getCurrentActuatorData}),O.jsx(qp,{core:this.core,visible:t}),O.jsx(Gp,{core:this.core,isPlaying:this.state.isPlaying,updateRate:this.state.updateRate,showVisualizer:e,showDebug:t,onToggleVisualizer:this.handleToggleVisualizer,onToggleDebug:this.handleToggleDebug}),O.jsx(Ep,{core:this.core,visible:i.length>1})]})}}const sf=Object.freeze(Object.defineProperty({__proto__:null,default:rf},Symbol.toStringTag,{value:"Module"})),af={PLAY:"play",PAUSE:"pause",ENDED:"ended",SEEKING:"seeking",SEEKED:"seeked",TIME_UPDATE:"timeupdate",DURATION_CHANGE:"durationchange",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",WAITING:"waiting",STALLED:"stalled",SUSPEND:"suspend",VOLUME_CHANGE:"volumechange",ERROR:"error",RESIZE:"resize"},of={PLAYLIST_ITEM_CHANGE:"playlistitemchange",DEVICE_CONNECT:"deviceconnect",DEVICE_DISCONNECT:"devicedisconnect",HAPTIC_START:"hapticstart",HAPTIC_STOP:"hapticstop"},lf={play:"onPlay",pause:"onPause",ended:"onEnded",seeking:"onSeeking",seeked:"onSeeked",timeupdate:"onTimeUpdate",durationchange:"onDurationChange",loadstart:"onLoadStart",loadeddata:"onLoadedData",loadedmetadata:"onLoadedMetadata",canplay:"onCanPlay",canplaythrough:"onCanPlayThrough",waiting:"onWaiting",stalled:"onStalled",suspend:"onSuspend",volumechange:"onVolumeChange",error:"onError",resize:"onResize",playlistitemchange:"onPlaylistItemChange",deviceconnect:"onDeviceConnect",devicedisconnect:"onDeviceDisconnect",hapticstart:"onHapticStart",hapticstop:"onHapticStop"};function uf(e){return lf[e]?lf[e]:`on${e.split(/[-_]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("")}`}const cf={...Object.fromEntries(Object.values(af).map(e=>[e,uf(e)])),...Object.fromEntries(Object.values(of).map(e=>[e,uf(e)]))},hf=[...Object.values(af),...Object.values(of)];function df(){const e={videoJsEvents:{},funPlayerEvents:{},usage:{}};return Object.entries(af).forEach(([t,i])=>{const n=cf[i];e.videoJsEvents[i]={callback:n,domEvent:`funplayer-${i}`,description:pf(i),dataStructure:ff(i)}}),Object.entries(of).forEach(([t,i])=>{const n=cf[i];e.funPlayerEvents[i]={callback:n,domEvent:`funplayer-${i}`,description:pf(i),dataStructure:ff(i)}}),e.usage={htmlAttributes:'<funplayer onplay="handlePlay" ontimeupdate="handleTimeUpdate" onresize="handleResize"></funplayer>',directCallbacks:"player.onPlay = (data) => console.log(data); player.onTimeUpdate = (data) => updateProgress(data);",domEvents:"player.addEventListener('funplayer-play', (e) => console.log(e.detail)); player.addEventListener('funplayer-timeupdate', (e) => updateUI(e.detail));",dynamicCreation:"FunPlayer.create('#container', { onPlay: handlePlay, onTimeUpdate: handleTimeUpdate, onResize: handleResize })"},e}function pf(e){return{play:"Fired when playback starts",pause:"Fired when playback is paused",ended:"Fired when playback reaches the end",seeking:"Fired when seeking starts",seeked:"Fired when seeking completes",timeupdate:"Fired periodically during playback (usually 15-250ms intervals)",durationchange:"Fired when media duration changes",loadstart:"Fired when loading starts",loadeddata:"Fired when media data is loaded",loadedmetadata:"Fired when metadata is loaded (duration, dimensions, etc.)",canplay:"Fired when enough data is available to start playback",canplaythrough:"Fired when entire media can play without buffering",waiting:"Fired when playback stops due to buffering",stalled:"Fired when download has stopped unexpectedly",suspend:"Fired when loading is intentionally suspended",volumechange:"Fired when volume or muted state changes",error:"Fired when an error occurs during loading or playback",resize:"Fired when player dimensions change",playlistitemchange:"Fired when playlist advances to next/previous item",deviceconnect:"Fired when a haptic device connects",devicedisconnect:"Fired when a haptic device disconnects",hapticstart:"Fired when haptic playback begins",hapticstop:"Fired when haptic playback stops"}[e]||"Event fired during media interaction"}function ff(e){return{play:"{ currentTime: number, duration: number }",pause:"{ currentTime: number, duration: number }",timeupdate:"{ currentTime: number, duration: number }",seeking:"{ currentTime: number, seekingTo: number }",seeked:"{ currentTime: number, duration: number }",durationchange:"{ duration: number }",loadedmetadata:"{ duration: number, videoWidth?: number, videoHeight?: number }",canplay:"{ currentTime: number, duration: number }",canplaythrough:"{ currentTime: number, duration: number }",waiting:"{ currentTime: number, reason: string }",volumechange:"{ volume: number, muted: boolean }",resize:"{ width: number, height: number }",error:"{ message: string, code: number, error?: Error }",deviceconnect:"{ device: object, name: string }",devicedisconnect:"{ device: object, name: string }",hapticstart:"{ channels: number, updateRate: number }",hapticstop:"{ reason: string }",ended:"{ currentTime: 0 }",loadstart:"{ }",stalled:"{ currentTime: number }",suspend:"{ currentTime: number }"}[e]||"{ }"}hf.length;class mf extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.reactRoot=null,this.stylesInjected=!1,this.initializationPromise=null,this.styleObserver=null,this.lastProcessedStylesCount=0}connectedCallback(){this.initializationPromise||(this.initializationPromise=this.initializeAsync())}disconnectedCallback(){this.cleanup()}attributeChangedCallback(e,t,i){if(t!==i){if("theme"===e&&this.reactRoot)try{const e=JSON.parse(i||"{}");this.applyThemeToShadowDOM(e)}catch(n){}this.reactRoot&&this.updateReactComponent()}}static get observedAttributes(){return["playlist","theme"]}async initializeAsync(){try{await this.injectStylesAsync(),this.initializeReact()}catch(e){this.showErrorFallback(e)}}applyThemeToShadowDOM(e){if(!e||!this.shadowRoot)return;const t=ef.sanitizeTheme(e);if(!ef.isValidTheme(t))return;let i=this.shadowRoot.getElementById("funplayer-theme-styles");i||(i=document.createElement("style"),i.id="funplayer-theme-styles",this.shadowRoot.appendChild(i)),i.textContent=ef.buildShadowDOMThemeCSS(t,".funplayer-shadow-container")}initializeReact(){try{const e=document.createElement("div");e.className="funplayer-shadow-container",this.shadowRoot.appendChild(e),this.reactRoot=C.createRoot(e),this.updateReactComponent()}catch(e){throw e}}updateReactComponent(){if(this.reactRoot)try{const e=this.buildReactProps();this.reactRoot.render(f.createElement(rf,e))}catch(e){this.showErrorFallback(e)}}buildReactProps(){const e={};try{const t=this.getAttribute("playlist");t&&(e.playlist=JSON.parse(t))}catch(i){e.playlist=[]}try{const t=this.getAttribute("theme");if(t){const i=JSON.parse(t);e.theme=i,this.applyThemeToShadowDOM(i)}}catch(i){}const t=function(e){const t={};return hf.forEach(n=>{const r=cf[n];t[r]=t=>{e.dispatchEvent(new CustomEvent(`funplayer-${n}`,{detail:t,bubbles:!0,cancelable:!0}));const s=e[r];if("function"==typeof s)try{s(t)}catch(i){}const a=e.getAttribute(r.toLowerCase());if(a&&"function"==typeof window[a])try{window[a](t)}catch(i){}}}),t}(this);return Object.assign(e,t),e.onResize=e=>{e&&e.height&&(this.style.height=`${e.height}px`),this.dispatchEvent(new CustomEvent("funplayer-resize",{detail:e||{width:0,height:0},bubbles:!0}))},e}async injectStylesAsync(){if(!this.stylesInjected)try{const e=this.extractAllExistingStyles(),t=document.createElement("style");t.id="funplayer-injected-styles",t.textContent=`\n        /* ============================================================================\n           TOUS LES STYLES DU DOM PRINCIPAL (approche exhaustive)\n           ============================================================================ */\n        \n        ${e}\n        \n        /* ============================================================================\n           WEB COMPONENT HOST STYLES ADDITIONNELS -  Variables prfixes fp-\n           ============================================================================ */\n        \n        :host {\n          display: block;\n          width: 100%;\n          height: auto;\n          min-height: 200px;\n          transition: height 0.2s ease;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n        }\n        \n        .funplayer-shadow-container {\n          width: 100%;\n          min-height: 100%;\n          display: flex;\n          flex-direction: column;\n          \n          /*  MODIFI: Variables par dfaut avec prfixe fp- (vite conflits site hte) */\n          ${Object.entries(ef.DEFAULT_THEME_VALUES).map(([e,t])=>`${e}: ${t};`).join("\n          ")}\n          \n          /* Application des variables prfixes */\n          background: var(--fp-background-color);\n          color: var(--fp-text-color);\n          border-radius: var(--fp-base-radius);\n        }\n      `,this.shadowRoot.appendChild(t),this.stylesInjected=!0,this.observeStyleChanges()}catch(e){this.injectFallbackStylesOnly()}}extractAllExistingStyles(){let e="";try{return document.querySelectorAll("style").forEach((t,i)=>{t.textContent&&(e+=`\n/* <style> tag ${i+1} */\n${t.textContent}\n`)}),Array.from(document.styleSheets).forEach((t,i)=>{try{const n=Array.from(t.cssRules||t.rules||[]).map(e=>e.cssText).join("\n");n&&(e+=`\n/* Stylesheet ${i+1} */\n${n}\n`)}catch(n){}}),e}catch(t){return""}}observeStyleChanges(){if(!this.styleObserver)try{this.styleObserver=new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{("STYLE"===e.tagName||"LINK"===e.tagName&&"stylesheet"===e.rel)&&(t=!0)})}),t&&this.updateStylesFromChanges()}),this.styleObserver.observe(document.head,{childList:!0,subtree:!0})}catch(e){}}updateStylesFromChanges(){const e=this.shadowRoot.getElementById("funplayer-injected-styles");if(!e)return;const t=this.extractAllExistingStyles();e.textContent=`\n      /* ============================================================================\n         TOUS LES STYLES DU DOM PRINCIPAL (mis  jour)\n         ============================================================================ */\n      \n      ${t}\n      \n      /* ============================================================================\n         WEB COMPONENT HOST STYLES ADDITIONNELS - Variables prfixes fp-\n         ============================================================================ */\n      \n      :host {\n        display: block;\n        width: 100%;\n        height: auto;\n        min-height: 200px;\n        transition: height 0.2s ease;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      }\n      \n      .funplayer-shadow-container {\n        width: 100%;\n        min-height: 100%;\n        display: flex;\n        flex-direction: column;\n        \n        /* Variables par dfaut avec prfixe fp- */\n        ${Object.entries(ef.DEFAULT_THEME_VALUES).map(([e,t])=>`${e}: ${t};`).join("\n        ")}\n        \n        /* Application des variables prfixes */\n        background: var(--fp-background-color);\n        color: var(--fp-text-color);\n        border-radius: var(--fp-base-radius);\n      }\n    `}injectFallbackStylesOnly(){if(this.stylesInjected)return;const e=document.createElement("style");e.textContent=`\n      :host {\n        display: block;\n        width: 100%;\n        height: auto;\n        min-height: 200px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      }\n      \n      .funplayer-shadow-container {\n        width: 100%;\n        min-height: 200px;\n        display: flex;\n        flex-direction: column;\n        padding: 1rem;\n        \n        /*  Variables fallback avec prfixe fp- */\n        ${Object.entries(ef.DEFAULT_THEME_VALUES).map(([e,t])=>`${e}: ${t};`).join("\n        ")}\n        \n        background: var(--fp-background-color);\n        color: var(--fp-text-color);\n      }\n    `,this.shadowRoot.appendChild(e),this.stylesInjected=!0}showErrorFallback(e){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n      <style>\n        .error-fallback {\n          padding: 20px;\n          background: #fed7d7;\n          color: #742a2a;\n          border-radius: 8px;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n        }\n        .error-fallback h3 { margin-top: 0; }\n        .error-fallback details { margin: 10px 0; }\n        .error-fallback pre { \n          background: #2d3748; \n          color: #e2e8f0; \n          padding: 10px; \n          border-radius: 4px; \n          overflow: auto;\n          font-size: 12px;\n        }\n      </style>\n      <div class="error-fallback">\n        <h3> FunPlayer Error</h3>\n        <p>Failed to load the media player component.</p>\n        <details>\n          <summary>Error details</summary>\n          <pre>${e.message}\n\n${e.stack||""}</pre>\n        </details>\n        <p style="margin-top: 15px; font-size: 12px; color: #666;">\n          Check browser console for more details.\n        </p>\n      </div>\n    `)}cleanup(){try{this.styleObserver&&(this.styleObserver.disconnect(),this.styleObserver=null),this.reactRoot&&(this.reactRoot.unmount(),this.reactRoot=null),this.stylesInjected=!1,this.initializationPromise=null}catch(e){}}}function gf(){return!window.customElements.get("fun-player")&&(window.customElements.define("fun-player",mf),!0)}function yf(e,t={}){let i;if("string"==typeof e){if(i=document.querySelector(e),!i)throw new Error(`Container not found: ${e}`)}else{if(!(e instanceof HTMLElement))throw new Error("Container must be a CSS selector string or HTMLElement");i=e}const n=document.createElement("fun-player");return t.playlist&&n.setAttribute("playlist",JSON.stringify(t.playlist)),t.theme&&n.setAttribute("theme",JSON.stringify(t.theme)),Object.keys(t).forEach(e=>{if("function"==typeof t[e]&&e.startsWith("on")){const i=e.slice(2).toLowerCase();n.addEventListener(`funplayer-${i}`,t[e])}}),i.appendChild(n),n}window.customElements,window.ResizeObserver||(window.ResizeObserver=class{observe(){}unobserve(){}disconnect(){}}),window.FunPlayer={version:"1.0.0",mode:"embed",WebComponent:mf,register:gf,getSupportedEvents:()=>hf,getEventDocumentation:df,create:(e,t={})=>yf(e,t),React:{Component:null,createElement:f.createElement,version:f.version}},gf(),Promise.resolve().then(()=>sf).then(({default:e})=>{window.FunPlayer.React.Component=e}).catch(e=>{}),window.addEventListener("error",e=>{e.error&&e.error.message&&e.error.message.includes("FunPlayer")});const vf=window.FunPlayer;"undefined"!=typeof module&&module.exports&&(module.exports=window.FunPlayer);var _f,bf={exports:{}},Tf={exports:{}};var Sf=(_f||(_f=1,function(e,t){function i(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return a[e];var i,s=String(e);return(i=n[s.toLowerCase()])?i:(i=r[s.toLowerCase()])||(1===s.length?s.charCodeAt(0):void 0)}i.isEventKey=function(e,t){if(e&&"object"==typeof e){var i=e.which||e.keyCode||e.charCode;if(null==i)return!1;if("string"==typeof t){var s;if(s=n[t.toLowerCase()])return s===i;if(s=r[t.toLowerCase()])return s===i}else if("number"==typeof t)return t===i;return!1}};var n=(t=e.exports=i).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=t.aliases={windows:91,"":16,"":18,"":17,"":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(s=97;s<123;s++)n[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)n[s-48]=s;for(s=1;s<13;s++)n["f"+s]=s+111;for(s=0;s<10;s++)n["numpad "+s]=s+96;var a=t.names=t.title={};for(s in n)a[n[s]]=s;for(var o in r)n[o]=r[o]}(Tf,Tf.exports)),Tf.exports);const wf=s(Sf);function xf(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Af(e,t){return(Af=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Ef(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Af(e,t)}var Cf,Mf;const kf=s(Mf?Cf:(Mf=1,Cf=function(e,t){var i,n=null;try{i=JSON.parse(e,t)}catch(r){n=r}return[n,i]}));var If,Pf,Lf,Df={exports:{}};var Of=function(){if(Lf)return Df.exports;Lf=1;var e=R(),t=ee(),i=te();s.httpHandler=function(){if(Pf)return If;Pf=1;var e=R();return If=function(t,i){return void 0===i&&(i=!1),function(n,r,s){if(n)t(n);else if(r.statusCode>=400&&r.statusCode<=599){var a=s;if(i)if(e.TextDecoder){var o=(void 0===(l=r.headers&&r.headers["content-type"])&&(l=""),l.toLowerCase().split(";").reduce(function(e,t){var i=t.split("="),n=i[0],r=i[1];return"charset"===n.trim()?r.trim():e},"utf-8"));try{a=new TextDecoder(o).decode(s)}catch(u){}}else a=String.fromCharCode.apply(null,new Uint8Array(s));t({cause:a})}else t(null,s);var l}}}();var n=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var i=e.indexOf(":"),n=e.slice(0,i).trim().toLowerCase(),r=e.slice(i+1).trim();void 0===t[n]?t[n]=r:Array.isArray(t[n])?t[n].push(r):t[n]=[t[n],r]}),t):t};function r(e,n,r){var s=e;return i(n)?(r=n,"string"==typeof e&&(s={uri:e})):s=t({},n,{uri:e}),s.callback=r,s}function s(e,t,i){return a(t=r(e,t,i))}function a(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,i=function(i,n,r){t||(t=!0,e.callback(i,n,r))};function r(){var e=void 0;if(e=c.response?c.response:c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(i){}return null}(c),y)try{e=JSON.parse(e)}catch(t){}return e}function a(e){return clearTimeout(h),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,i(e,v)}function o(){if(!u){var t;clearTimeout(h),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var s=v,a=null;return 0!==t?(s={body:r(),statusCode:t,method:p,headers:{},url:d,rawRequest:c},c.getAllResponseHeaders&&(s.headers=n(c.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),i(a,s,s.body)}}var l,u,c=e.xhr||null;c||(c=e.cors||e.useXDR?new s.XDomainRequest:new s.XMLHttpRequest);var h,d=c.url=e.uri||e.url,p=c.method=e.method||"GET",f=e.body||e.data,m=c.headers=e.headers||{},g=!!e.sync,y=!1,v={body:void 0,headers:{},statusCode:0,method:p,url:d,rawRequest:c};if("json"in e&&!1!==e.json&&(y=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(o,0)},c.onload=o,c.onerror=a,c.onprogress=function(){},c.onabort=function(){u=!0},c.ontimeout=a,c.open(p,d,!g,e.username,e.password),g||(c.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(h=setTimeout(function(){if(!u){u=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}},e.timeout)),c.setRequestHeader)for(l in m)m.hasOwnProperty(l)&&c.setRequestHeader(l,m[l]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(f||null),c}return Df.exports=s,Df.exports.default=s,s.XMLHttpRequest=e.XMLHttpRequest||function(){},s.XDomainRequest="withCredentials"in new s.XMLHttpRequest?s.XMLHttpRequest:e.XDomainRequest,function(e,t){for(var i=0;i<e.length;i++)t(e[i])}(["get","put","post","patch","head","delete"],function(e){s["delete"===e?"del":e]=function(t,i,n){return(i=r(t,i,n)).method=e.toUpperCase(),a(i)}}),Df.exports}();const Rf=s(Of);function Nf(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Nf=function(){return!!e})()}function Ff(e,t,i){if(Nf())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var r=new(e.bind.apply(e,n));return i&&Af(r,i.prototype),r}var Uf,Bf,jf,zf,Vf,Hf,qf={exports:{}};const Gf=s((Uf||(Uf=1,Bf=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,jf=/^(?=([^\/?#]*))\1([^]*)$/,zf=/(?:\/|^)\.(?=\/)/g,Vf=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,qf.exports=Hf={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=Hf.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=Hf.normalizePath(n.path),Hf.buildURLFromParts(n)}var r=Hf.parseURL(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=Hf.normalizePath(r.path),Hf.buildURLFromParts(r)):t;var s=Hf.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var a=jf.exec(s.path);s.netLoc=a[1],s.path=a[2]}s.netLoc&&!s.path&&(s.path="/");var o={scheme:s.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=s.netLoc,"/"!==r.path[0]))if(r.path){var l=s.path,u=l.substring(0,l.lastIndexOf("/")+1)+r.path;o.path=Hf.normalizePath(u)}else o.path=s.path,r.params||(o.params=s.params,r.query||(o.query=s.query));return null===o.path&&(o.path=i.alwaysNormalize?Hf.normalizePath(r.path):r.path),Hf.buildURLFromParts(o)},parseURL:function(e){var t=Bf.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(zf,"");e.length!==(e=e.replace(Vf,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}}),qf.exports));var Wf="http://example.com",$f=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=N.location&&N.location.href||"");var i="function"==typeof N.URL,n=/^\/\//.test(e),r=!N.location&&!/\/\//i.test(e);if(i?e=new N.URL(e,N.location||Wf):/\/\//i.test(e)||(e=Gf.buildAbsoluteURL(N.location&&N.location.href||"",e)),i){var s=new URL(t,e);return r?s.href.slice(18):n?s.href.slice(s.protocol.length):s.href}return Gf.buildAbsoluteURL(e,t)},Xf=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(i,1),i>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,n=0;n<i;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();function Yf(e){for(var t,i=(t=e,N.atob?N.atob(t):Buffer.from(t,"base64").toString("binary")),n=new Uint8Array(i.length),r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return n}var Qf=function(e){function t(){var t;return(t=e.call(this)||this).buffer="",t}return Ef(t,e),t.prototype.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(Xf),Kf=String.fromCharCode(9),Zf=function(e){var t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),i={};return t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),i},Jf=function(e){for(var t,i=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},r=i.length;r--;)""!==i[r]&&((t=/([^=]*)=(.*)/.exec(i[r]).slice(1))[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),n[t[0]]=t[1]);return n},em=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}Ef(t,e);var i=t.prototype;return i.push=function(e){var t,i,n=this;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce(function(t,i){var n=i(e);return n===e?t:t.concat([n])},[e]).forEach(function(e){for(var r=0;r<n.customParsers.length;r++)if(n.customParsers[r].call(n,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))n.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return i={type:"tag",tagType:"inf"},t[1]&&(i.duration=parseFloat(t[1])),t[2]&&(i.title=t[2]),void n.trigger("data",i);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"targetduration"},t[1]&&(i.duration=parseInt(t[1],10)),void n.trigger("data",i);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return i={type:"tag",tagType:"version"},t[1]&&(i.version=parseInt(t[1],10)),void n.trigger("data",i);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return i={type:"tag",tagType:"media-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void n.trigger("data",i);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return i={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void n.trigger("data",i);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return i={type:"tag",tagType:"playlist-type"},t[1]&&(i.playlistType=t[1]),void n.trigger("data",i);if(t=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(e))return i=ye(Zf(t[1]),{type:"tag",tagType:"byterange"}),void n.trigger("data",i);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return i={type:"tag",tagType:"allow-cache"},t[1]&&(i.allowed=!/NO/.test(t[1])),void n.trigger("data",i);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(i={type:"tag",tagType:"map"},t[1]){var s=Jf(t[1]);s.URI&&(i.uri=s.URI),s.BYTERANGE&&(i.byterange=Zf(s.BYTERANGE))}n.trigger("data",i)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(i={type:"tag",tagType:"stream-inf"},t[1]){if(i.attributes=Jf(t[1]),i.attributes.RESOLUTION){var a=i.attributes.RESOLUTION.split("x"),o={};a[0]&&(o.width=parseInt(a[0],10)),a[1]&&(o.height=parseInt(a[1],10)),i.attributes.RESOLUTION=o}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}n.trigger("data",i)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return i={type:"tag",tagType:"media"},t[1]&&(i.attributes=Jf(t[1])),void n.trigger("data",i);if(t=/^#EXT-X-ENDLIST/.exec(e))n.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))n.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return i={type:"tag",tagType:"program-date-time"},t[1]&&(i.dateTimeString=t[1],i.dateTimeObject=new Date(t[1])),void n.trigger("data",i);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return i={type:"tag",tagType:"key"},t[1]&&(i.attributes=Jf(t[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void n.trigger("data",i);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return i={type:"tag",tagType:"start"},t[1]&&(i.attributes=Jf(t[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void n.trigger("data",i);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-out-cont"},t[1]?i.data=t[1]:i.data="",void n.trigger("data",i);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-out"},t[1]?i.data=t[1]:i.data="",void n.trigger("data",i);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return i={type:"tag",tagType:"cue-in"},t[1]?i.data=t[1]:i.data="",void n.trigger("data",i);if((t=/^#EXT-X-SKIP:(.*)$/.exec(e))&&t[1])return(i={type:"tag",tagType:"skip"}).attributes=Jf(t[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split(Kf)),void n.trigger("data",i);if((t=/^#EXT-X-PART:(.*)$/.exec(e))&&t[1])return(i={type:"tag",tagType:"part"}).attributes=Jf(t[1]),["DURATION"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),["INDEPENDENT","GAP"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/.test(i.attributes[e]))}),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=Zf(i.attributes.BYTERANGE)),void n.trigger("data",i);if((t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e))&&t[1])return(i={type:"tag",tagType:"server-control"}).attributes=Jf(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/.test(i.attributes[e]))}),void n.trigger("data",i);if((t=/^#EXT-X-PART-INF:(.*)$/.exec(e))&&t[1])return(i={type:"tag",tagType:"part-inf"}).attributes=Jf(t[1]),["PART-TARGET"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))}),void n.trigger("data",i);if((t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e))&&t[1])return(i={type:"tag",tagType:"preload-hint"}).attributes=Jf(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(e){if(i.attributes.hasOwnProperty(e)){i.attributes[e]=parseInt(i.attributes[e],10);var t="BYTERANGE-LENGTH"===e?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[t]=i.attributes[e],delete i.attributes[e]}}),void n.trigger("data",i);if((t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e))&&t[1])return(i={type:"tag",tagType:"rendition-report"}).attributes=Jf(t[1]),["LAST-MSN","LAST-PART"].forEach(function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseInt(i.attributes[e],10))}),void n.trigger("data",i);n.trigger("data",{type:"tag",data:e.slice(4)})}}}else n.trigger("data",{type:"comment",text:e.slice(1)})}):this.trigger("data",{type:"uri",uri:e}))},i.addParser=function(e){var t=this,i=e.expression,n=e.customType,r=e.dataParser,s=e.segment;"function"!=typeof r&&(r=function(e){return e}),this.customParsers.push(function(e){if(i.exec(e))return t.trigger("data",{type:"custom",data:r(e),customType:n,segment:s}),!0})},i.addTagMapper=function(e){var t=e.expression,i=e.map;this.tagMappers.push(function(e){return t.test(e)?i(e):e})},t}(Xf),tm=function(e){var t={};return Object.keys(e).forEach(function(i){var n;t[(n=i,n.toLowerCase().replace(/-(\w)/g,function(e){return e[1].toUpperCase()}))]=e[i]}),t},im=function(e){var t=e.serverControl,i=e.targetDuration,n=e.partTargetDuration;if(t){var r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=i&&3*i,l=n&&2*n;i&&!t.hasOwnProperty(s)&&(t[s]=o,this.trigger("info",{message:r+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&t[s]<o&&(this.trigger("warn",{message:r+" clamping HOLD-BACK ("+t[s]+") to targetDuration * 3 ("+o+")"}),t[s]=o),n&&!t.hasOwnProperty(a)&&(t[a]=3*n,this.trigger("info",{message:r+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+t[a]+")."})),n&&t[a]<l&&(this.trigger("warn",{message:r+" clamping PART-HOLD-BACK ("+t[a]+") to partTargetDuration * 2 ("+l+")."}),t[a]=l)}},nm=function(e){function t(){var t;(t=e.call(this)||this).lineStream=new Qf,t.parseStream=new em,t.lineStream.pipe(t.parseStream);var i,n,r=xf(t),s=[],a={},o=!1,l=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c=0;t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var h=0,d=0;return t.on("end",function(){a.uri||!a.parts&&!a.preloadHints||(!a.map&&i&&(a.map=i),!a.key&&n&&(a.key=n),a.timeline||"number"!=typeof c||(a.timeline=c),t.manifest.preloadSegment=a)}),t.parseStream.on("data",function(e){var t,p;({tag:function(){({version:function(){e.version&&(this.manifest.version=e.version)},"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(a.byterange=t,t.length=e.length,"offset"in e||(e.offset=h)),"offset"in e&&(a.byterange=t,t.offset=e.offset),h=t.offset+t.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(a.duration=e.duration),0===e.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=s},key:function(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("com.apple.streamingkeydelivery"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:e.attributes});if("com.microsoft.playready"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:e.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:Yf(e.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),n={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(n.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else n=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,c=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){i={},e.uri&&(i.uri=e.uri),e.byterange&&(i.byterange=e.byterange),n&&(i.key=n)},"stream-inf":function(){this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||u,e.attributes?(a.attributes||(a.attributes={}),ye(a.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var i=this.manifest.mediaGroups[e.attributes.TYPE];i[e.attributes["GROUP-ID"]]=i[e.attributes["GROUP-ID"]]||{},t=i[e.attributes["GROUP-ID"]],(p={default:/yes/i.test(e.attributes.DEFAULT)}).default?p.autoselect=!0:p.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(p.language=e.attributes.LANGUAGE),e.attributes.URI&&(p.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(p.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(p.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(p.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=p}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){c+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),a.dateTimeString=e.dateTimeString,a.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):(this.manifest.targetDuration=e.duration,im.call(this,this.manifest))},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=e.data},"cue-out-cont":function(){a.cueOutCont=e.data},"cue-in":function(){a.cueIn=e.data},skip:function(){this.manifest.skip=tm(e.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",e.attributes,["SKIPPED-SEGMENTS"])},part:function(){var t=this;o=!0;var i=this.manifest.segments.length,n=tm(e.attributes);a.parts=a.parts||[],a.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=d),d=n.byterange.offset+n.byterange.length);var r=a.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+r+" for segment #"+i,e.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(e,i){e.hasOwnProperty("lastPart")||t.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+i+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var t=this.manifest.serverControl=tm(e.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),im.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var t=this.manifest.segments.length,i=tm(e.attributes),n=i.type&&"PART"===i.type;a.preloadHints=a.preloadHints||[],a.preloadHints.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=n?d:0,n&&(d=i.byterange.offset+i.byterange.length)));var r=a.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+r+" for segment #"+t,e.attributes,["TYPE","URI"]),i.type)for(var s=0;s<a.preloadHints.length-1;s++){var o=a.preloadHints[s];o.type&&(o.type===i.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+r+" for segment #"+t+" has the same TYPE "+i.type+" as preload hint #"+s}))}},"rendition-report":function(){var t=tm(e.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);var i=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];o&&n.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+i,e.attributes,n)},"part-inf":function(){this.manifest.partInf=tm(e.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",e.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),im.call(this,this.manifest)}}[e.tagType]||l).call(r)},uri:function(){a.uri=e.uri,s.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),n&&(a.key=n),a.timeline=c,i&&(a.map=i),d=0,a={}},comment:function(){},custom:function(){e.segment?(a.custom=a.custom||{},a.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(r)}),t}Ef(t,e);var i=t.prototype;return i.warnOnMissingAttributes_=function(e,t,i){var n=[];i.forEach(function(e){t.hasOwnProperty(e)||n.push(e)}),n.length&&this.trigger("warn",{message:e+" lacks required attribute(s): "+n.join(", ")})},i.push=function(e){this.lineStream.push(e)},i.end=function(){this.lineStream.push("\n"),this.trigger("end")},i.addParser=function(e){this.parseStream.addParser(e)},i.addTagMapper=function(e){this.parseStream.addTagMapper(e)},t}(Xf),rm={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},sm=["video","audio","text"],am=["Video","Audio","Text"],om=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,i){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(i).toString(16)).slice(-2)}):e},lm=function(e){void 0===e&&(e="");var t=e.split(","),i=[];return t.forEach(function(e){var t;e=e.trim(),sm.forEach(function(n){var r=rm[n].exec(e.toLowerCase());if(r&&!(r.length<=1)){t=n;var s=e.substring(0,r[1].length),a=e.replace(s,"");i.push({type:s,details:a,mediaType:n})}}),t||i.push({type:e,details:"",mediaType:"unknown"})}),i},um=function(e){return void 0===e&&(e=""),rm.audio.test(e.trim().toLowerCase())},cm=function(e){if(e&&"string"==typeof e){var t,i=e.toLowerCase().split(",").map(function(e){return om(e.trim())}),n="video";1===i.length&&um(i[0])?n="audio":1===i.length&&(void 0===(t=i[0])&&(t=""),rm.text.test(t.trim().toLowerCase()))&&(n="application");var r="mp4";return i.every(function(e){return rm.mp4.test(e)})?r="mp4":i.every(function(e){return rm.webm.test(e)})?r="webm":i.every(function(e){return rm.ogg.test(e)})&&(r="ogg"),n+"/"+r+';codecs="'+e+'"'}},hm=function(e){return void 0===e&&(e=""),N.MediaSource&&N.MediaSource.isTypeSupported&&N.MediaSource.isTypeSupported(cm(e))||!1},dm=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every(function(e){e=e.trim();for(var t=0;t<am.length;t++){if(rm["muxer"+am[t]].test(e))return!0}return!1})},pm="mp4a.40.2",fm=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,mm=/^application\/dash\+xml/i,gm=function(e){return fm.test(e)?"hls":mm.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null},ym=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},vm=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||ym(e)||e instanceof ArrayBuffer||(e="number"!=typeof e||"number"==typeof e&&e!=e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},_m=N.BigInt||Number,bm=[_m("0x1"),_m("0x100"),_m("0x10000"),_m("0x1000000"),_m("0x100000000"),_m("0x10000000000"),_m("0x1000000000000"),_m("0x100000000000000"),_m("0x10000000000000000")];!function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();var Tm,Sm,wm,xm,Am=function(e,t){var i=void 0===t?{}:t,n=i.signed,r=void 0!==n&&n,s=i.le,a=void 0!==s&&s;e=vm(e);var o=a?"reduce":"reduceRight",l=(e[o]?e[o]:Array.prototype[o]).call(e,function(t,i,n){var r=a?n:Math.abs(n+1-e.length);return t+_m(i)*bm[r]},_m(0));if(r){var u=bm[e.length]/_m(2)-_m(1);(l=_m(l))>u&&(l-=u,l-=u,l-=_m(2))}return Number(l)},Em=function(e,t){var i={}.le,n=void 0!==i&&i;("bigint"!=typeof e&&"number"!=typeof e||"number"==typeof e&&e!=e)&&(e=0),e=_m(e);for(var r,s=(r=e,Math.ceil(function(e){return e.toString(2).length}(r)/8)),a=new Uint8Array(new ArrayBuffer(s)),o=0;o<s;o++){var l=n?o:Math.abs(o+1-a.length);a[l]=Number(e/bm[o]&_m(255)),e<0&&(a[l]=Math.abs(~a[l]),a[l]-=0===o?1:2)}return a},Cm=function(e,t){if("string"!=typeof e&&e&&"function"==typeof e.toString&&(e=e.toString()),"string"!=typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i},Mm=function(e,t,i){var n=void 0===i?{}:i,r=n.offset,s=void 0===r?0:r,a=n.mask,o=void 0===a?[]:a;e=vm(e);var l=(t=vm(t)).every?t.every:Array.prototype.every;return t.length&&e.length-s>=t.length&&l.call(t,function(t,i){return t===(o[i]?o[i]&e[s+i]:e[s+i])})},km=function(e){return!!e&&"object"==typeof e},Im=function e(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.reduce(function(t,i){return"object"!=typeof i||Object.keys(i).forEach(function(n){Array.isArray(t[n])&&Array.isArray(i[n])?t[n]=t[n].concat(i[n]):km(t[n])&&km(i[n])?t[n]=e(t[n],i[n]):t[n]=i[n]}),t},{})},Pm=function(e){return Object.keys(e).map(function(t){return e[t]})},Lm=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},Dm=function(e){if(!e.length)return[];for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t},Om=function(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return i;return-1},Rm="INVALID_NUMBER_OF_PERIOD",Nm="DASH_EMPTY_MANIFEST",Fm="DASH_INVALID_XML",Um="NO_BASE_URL",Bm="SEGMENT_TIME_UNSPECIFIED",jm="UNSUPPORTED_UTC_TIMING_SCHEME",zm=function(e){var t=e.baseUrl,i=void 0===t?"":t,n=e.source,r=void 0===n?"":n,s=e.range,a=void 0===s?"":s,o=e.indexRange,l=void 0===o?"":o,u={uri:r,resolvedUri:$f(i||"",r)};if(a||l){var c,h=(a||l).split("-"),d=N.BigInt?N.BigInt(h[0]):parseInt(h[0],10),p=N.BigInt?N.BigInt(h[1]):parseInt(h[1],10);d<Number.MAX_SAFE_INTEGER&&"bigint"==typeof d&&(d=Number(d)),p<Number.MAX_SAFE_INTEGER&&"bigint"==typeof p&&(p=Number(p)),"bigint"==typeof(c="bigint"==typeof p||"bigint"==typeof d?N.BigInt(p)-N.BigInt(d)+N.BigInt(1):p-d+1)&&c<Number.MAX_SAFE_INTEGER&&(c=Number(c)),u.byterange={length:c,offset:d}}return u},Vm=function(e){return e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e},Hm={static:function(e){var t=e.duration,i=e.timescale,n=void 0===i?1:i,r=e.sourceDuration,s=e.periodDuration,a=Vm(e.endNumber),o=t/n;return"number"==typeof a?{start:0,end:a}:"number"==typeof s?{start:0,end:s/o}:{start:0,end:r/o}},dynamic:function(e){var t=e.NOW,i=e.clientOffset,n=e.availabilityStartTime,r=e.timescale,s=void 0===r?1:r,a=e.duration,o=e.periodStart,l=void 0===o?0:o,u=e.minimumUpdatePeriod,c=void 0===u?0:u,h=e.timeShiftBufferDepth,d=void 0===h?1/0:h,p=Vm(e.endNumber),f=(t+i)/1e3,m=n+l,g=f+c-m,y=Math.ceil(g*s/a),v=Math.floor((f-m-d)*s/a),_=Math.floor((f-m)*s/a);return{start:Math.max(0,v),end:"number"==typeof p?p:Math.min(y,_)}}},qm=function(e){var t=e.type,i=e.duration,n=e.timescale,r=void 0===n?1:n,s=e.periodDuration,a=e.sourceDuration,o=Hm[t](e),l=function(e,t){for(var i=[],n=e;n<t;n++)i.push(n);return i}(o.start,o.end).map(function(e){return function(t){var i=e.duration,n=e.timescale,r=void 0===n?1:n,s=e.periodStart,a=e.startNumber;return{number:(void 0===a?1:a)+t,duration:i/r,timeline:s,time:t*i}}}(e));if("static"===t){var u=l.length-1,c="number"==typeof s?s:a;l[u].duration=c-i/r*u}return l},Gm=function(e){var t=e.baseUrl,i=e.initialization,n=void 0===i?{}:i,r=e.sourceDuration,s=e.indexRange,a=void 0===s?"":s,o=e.periodStart,l=e.presentationTime,u=e.number,c=void 0===u?0:u,h=e.duration;if(!t)throw new Error(Um);var d=zm({baseUrl:t,source:n.sourceURL,range:n.range}),p=zm({baseUrl:t,source:t,indexRange:a});if(p.map=d,h){var f=qm(e);f.length&&(p.duration=f[0].duration,p.timeline=f[0].timeline)}else r&&(p.duration=r,p.timeline=o);return p.presentationTime=l||o,p.number=c,[p]},Wm=function(e,t,i){var n,r=e.sidx.map?e.sidx.map:null,s=e.sidx.duration,a=e.timeline||0,o=e.sidx.byterange,l=o.offset+o.length,u=t.timescale,c=t.references.filter(function(e){return 1!==e.referenceType}),h=[],d=e.endList?"static":"dynamic",p=e.sidx.timeline,f=p,m=e.mediaSequence||0;n="bigint"==typeof t.firstOffset?N.BigInt(l)+t.firstOffset:l+t.firstOffset;for(var g=0;g<c.length;g++){var y=t.references[g],v=y.referencedSize,_=y.subsegmentDuration,b=void 0;b="bigint"==typeof n?n+N.BigInt(v)-N.BigInt(1):n+v-1;var T=Gm({baseUrl:i,timescale:u,timeline:a,periodStart:p,presentationTime:f,number:m,duration:_,sourceDuration:s,indexRange:n+"-"+b,type:d})[0];r&&(T.map=r),h.push(T),n+="bigint"==typeof n?N.BigInt(v):v,f+=_/u,m++}return e.segments=h,e},$m=["AUDIO","SUBTITLES"],Xm=1/60,Ym=function(e){return(t=e,i=function(e){return e.timeline},Pm(t.reduce(function(e,t){return t.forEach(function(t){e[i(t)]=t}),e},{}))).sort(function(e,t){return e.timeline>t.timeline?1:-1});var t,i},Qm=function(e){var t,i,n=[];return t=e,i=function(e,t,i,r){n=n.concat(e.playlists||[])},$m.forEach(function(e){for(var n in t.mediaGroups[e])for(var r in t.mediaGroups[e][n]){var s=t.mediaGroups[e][n][r];i(s,e,n,r)}}),n},Km=function(e){var t=e.playlist,i=e.mediaSequence;t.mediaSequence=i,t.segments.forEach(function(e,i){e.number=t.mediaSequence+i})},Zm=function(e){var t=e.oldManifest,i=e.newManifest,n=t.playlists.concat(Qm(t)),r=i.playlists.concat(Qm(i));return i.timelineStarts=Ym([t.timelineStarts,i.timelineStarts]),function(e){var t=e.oldPlaylists,i=e.newPlaylists,n=e.timelineStarts;i.forEach(function(e){e.discontinuitySequence=Om(n,function(t){return t.timeline===e.timeline});var i=function(e,t){for(var i=0;i<e.length;i++)if(e[i].attributes.NAME===t)return e[i];return null}(t,e.attributes.NAME);if(i&&!e.sidx){var r=e.segments[0],s=Om(i.segments,function(e){return Math.abs(e.presentationTime-r.presentationTime)<Xm});if(-1===s)return Km({playlist:e,mediaSequence:i.mediaSequence+i.segments.length}),e.segments[0].discontinuity=!0,e.discontinuityStarts.unshift(0),void((!i.segments.length&&e.timeline>i.timeline||i.segments.length&&e.timeline>i.segments[i.segments.length-1].timeline)&&e.discontinuitySequence--);i.segments[s].discontinuity&&!r.discontinuity&&(r.discontinuity=!0,e.discontinuityStarts.unshift(0),e.discontinuitySequence--),Km({playlist:e,mediaSequence:i.segments[s].number})}})}({oldPlaylists:n,newPlaylists:r,timelineStarts:i.timelineStarts}),i},Jm=function(e){return e&&e.uri+"-"+(t=e.byterange,i="bigint"==typeof t.offset||"bigint"==typeof t.length?N.BigInt(t.offset)+N.BigInt(t.length)-N.BigInt(1):t.offset+t.length-1,t.offset+"-"+i);var t,i},eg=function(e){return Pm(e.reduce(function(e,t){var i=t.attributes.id+(t.attributes.lang||"");if(e[i]){var n;if(t.segments)t.segments[0]&&(t.segments[0].discontinuity=!0),(n=e[i].segments).push.apply(n,t.segments);t.attributes.contentProtection&&(e[i].attributes.contentProtection=t.attributes.contentProtection)}else e[i]=t,e[i].attributes.timelineStarts=[];return e[i].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e},{})).map(function(e){var t,i;return e.discontinuityStarts=(t=e.segments||[],i="discontinuity",t.reduce(function(e,t,n){return t[i]&&e.push(n),e},[])),e})},tg=function(e,t){var i=Jm(e.sidx),n=i&&t[i]&&t[i].sidx;return n&&Wm(e,n,e.sidx.resolvedUri),e},ig=function(e,t){if(void 0===t&&(t={}),!Object.keys(t).length)return e;for(var i in e)e[i]=tg(e[i],t);return e},ng=function(e){var t,i=e.attributes,n=e.segments,r=e.sidx,s=e.discontinuityStarts,a={attributes:(t={NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===i.type,timeline:i.periodStart,resolvedUri:"",targetDuration:i.duration,discontinuityStarts:s,timelineStarts:i.timelineStarts,segments:n};return i.frameRate&&(a.attributes["FRAME-RATE"]=i.frameRate),i.contentProtection&&(a.contentProtection=i.contentProtection),r&&(a.sidx=r),a},rg=function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video/webm"===t.mimeType||"video"===t.contentType},sg=function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio/webm"===t.mimeType||"audio"===t.contentType},ag=function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType},og=function(e){return e?Object.keys(e).reduce(function(t,i){var n=e[i];return t.concat(n.playlists)},[]):[]},lg=function(e){var t,i=e.dashPlaylists,n=e.locations,r=e.sidxMapping,s=void 0===r?{}:r,a=e.previousManifest;if(!i.length)return{};var o=i[0].attributes,l=o.sourceDuration,u=o.type,c=o.suggestedPresentationDelay,h=o.minimumUpdatePeriod,d=eg(i.filter(rg)).map(ng),p=eg(i.filter(sg)),f=eg(i.filter(ag)),m=i.map(function(e){return e.attributes.captionServices}).filter(Boolean),g={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(t={AUDIO:{},VIDEO:{}},t["CLOSED-CAPTIONS"]={},t.SUBTITLES={},t),uri:"",duration:l,playlists:ig(d,s)};h>=0&&(g.minimumUpdatePeriod=1e3*h),n&&(g.locations=n),"dynamic"===u&&(g.suggestedPresentationDelay=c);var y,v,_=0===g.playlists.length,b=p.length?function(e,t,i){var n;void 0===t&&(t={}),void 0===i&&(i=!1);var r=e.reduce(function(e,r){var s=r.attributes.role&&r.attributes.role.value||"",a=r.attributes.lang||"",o=r.attributes.label||"main";if(a&&!r.attributes.label){var l=s?" ("+s+")":"";o=""+r.attributes.lang+l}e[o]||(e[o]={language:a,autoselect:!0,default:"main"===s,playlists:[],uri:""});var u=tg(function(e,t){var i,n=e.attributes,r=e.segments,s=e.sidx,a=e.mediaSequence,o=e.discontinuitySequence,l=e.discontinuityStarts,u={attributes:(i={NAME:n.id,BANDWIDTH:n.bandwidth,CODECS:n.codecs},i["PROGRAM-ID"]=1,i),uri:"",endList:"static"===n.type,timeline:n.periodStart,resolvedUri:"",targetDuration:n.duration,discontinuitySequence:o,discontinuityStarts:l,timelineStarts:n.timelineStarts,mediaSequence:a,segments:r};return n.contentProtection&&(u.contentProtection=n.contentProtection),s&&(u.sidx=s),t&&(u.attributes.AUDIO="audio",u.attributes.SUBTITLES="subs"),u}(r,i),t);return e[o].playlists.push(u),void 0===n&&"main"===s&&((n=r).default=!0),e},{});return n||(r[Object.keys(r)[0]].default=!0),r}(p,s,_):null,T=f.length?function(e,t){return void 0===t&&(t={}),e.reduce(function(e,i){var n=i.attributes.lang||"text";return e[n]||(e[n]={language:n,default:!1,autoselect:!1,playlists:[],uri:""}),e[n].playlists.push(tg(function(e){var t,i=e.attributes,n=e.segments,r=e.mediaSequence,s=e.discontinuityStarts,a=e.discontinuitySequence;void 0===n&&(n=[{uri:i.baseUrl,timeline:i.periodStart,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration);var o=((t={NAME:i.id,BANDWIDTH:i.bandwidth})["PROGRAM-ID"]=1,t);return i.codecs&&(o.CODECS=i.codecs),{attributes:o,uri:"",endList:"static"===i.type,timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,timelineStarts:i.timelineStarts,discontinuityStarts:s,discontinuitySequence:a,mediaSequence:r,segments:n}}(i),t)),e},{})}(f,s):null,S=d.concat(og(b),og(T)),w=S.map(function(e){return e.timelineStarts});return g.timelineStarts=Ym(w),y=S,v=g.timelineStarts,y.forEach(function(e){e.mediaSequence=0,e.discontinuitySequence=Om(v,function(t){return t.timeline===e.timeline}),e.segments&&e.segments.forEach(function(e,t){e.number=t})}),b&&(g.mediaGroups.AUDIO.audio=b),T&&(g.mediaGroups.SUBTITLES.subs=T),m.length&&(g.mediaGroups["CLOSED-CAPTIONS"].cc=m.reduce(function(e,t){return t?(t.forEach(function(t){var i=t.channel,n=t.language;e[n]={autoselect:!1,default:!1,instreamId:i,language:n},t.hasOwnProperty("aspectRatio")&&(e[n].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[n].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[n]["3D"]=t["3D"])}),e):e},{})),a?Zm({oldManifest:a,newManifest:g}):g},ug=function(e,t,i){var n=e.NOW,r=e.clientOffset,s=e.availabilityStartTime,a=e.timescale,o=void 0===a?1:a,l=e.periodStart,u=void 0===l?0:l,c=e.minimumUpdatePeriod,h=(n+r)/1e3+(void 0===c?0:c)-(s+u);return Math.ceil((h*o-t)/i)},cg=function(e,t){for(var i=e.type,n=e.minimumUpdatePeriod,r=void 0===n?0:n,s=e.media,a=void 0===s?"":s,o=e.sourceDuration,l=e.timescale,u=void 0===l?1:l,c=e.startNumber,h=void 0===c?1:c,d=e.periodStart,p=[],f=-1,m=0;m<t.length;m++){var g=t[m],y=g.d,v=g.r||0,_=g.t||0;f<0&&(f=_),_&&_>f&&(f=_);var b=void 0;if(v<0){var T=m+1;b=T===t.length?"dynamic"===i&&r>0&&a.indexOf("$Number$")>0?ug(e,f,y):(o*u-f)/y:(t[T].t-f)/y}else b=v+1;for(var S=h+p.length+b,w=h+p.length;w<S;)p.push({number:w,duration:y/u,time:f,timeline:d}),f+=y,w++}return p},hg=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,dg=function(e,t){return e.replace(hg,function(e){return function(t,i,n,r){if("$$"===t)return"$";if(void 0===e[i])return t;var s=""+e[i];return"RepresentationID"===i?s:(r=n?parseInt(r,10):1,s.length>=r?s:""+new Array(r-s.length+1).join("0")+s)}}(t))},pg=function(e,t){var i={RepresentationID:e.id,Bandwidth:e.bandwidth||0},n=e.initialization,r=void 0===n?{sourceURL:"",range:""}:n,s=zm({baseUrl:e.baseUrl,source:dg(r.sourceURL,i),range:r.range}),a=function(e,t){return e.duration||t?e.duration?qm(e):cg(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}]}(e,t);return a.map(function(t){i.Number=t.number,i.Time=t.time;var n=dg(e.media||"",i),r=e.timescale||1,a=e.presentationTimeOffset||0,o=e.periodStart+(t.time-a)/r;return{uri:n,timeline:t.timeline,duration:t.duration,resolvedUri:$f(e.baseUrl||"",n),map:s,number:t.number,presentationTime:o}})},fg=function(e,t){var i=e.duration,n=e.segmentUrls,r=void 0===n?[]:n,s=e.periodStart;if(!i&&!t||i&&t)throw new Error(Bm);var a,o=r.map(function(t){return function(e,t){var i=e.baseUrl,n=e.initialization,r=void 0===n?{}:n,s=zm({baseUrl:i,source:r.sourceURL,range:r.range}),a=zm({baseUrl:i,source:t.media,range:t.mediaRange});return a.map=s,a}(e,t)});return i&&(a=qm(e)),t&&(a=cg(e,t)),a.map(function(t,i){if(o[i]){var n=o[i],r=e.timescale||1,a=e.presentationTimeOffset||0;return n.timeline=t.timeline,n.duration=t.duration,n.number=t.number,n.presentationTime=s+(t.time-a)/r,n}}).filter(function(e){return e})},mg=function(e){var t,i,n=e.attributes,r=e.segmentInfo;r.template?(i=pg,t=Im(n,r.template)):r.base?(i=Gm,t=Im(n,r.base)):r.list&&(i=fg,t=Im(n,r.list));var s={attributes:n};if(!i)return s;var a=i(t,r.segmentTimeline);if(t.duration){var o=t,l=o.duration,u=o.timescale,c=void 0===u?1:u;t.duration=l/c}else a.length?t.duration=a.reduce(function(e,t){return Math.max(e,Math.ceil(t.duration))},0):t.duration=0;return s.attributes=t,s.segments=a,r.base&&t.indexRange&&(s.sidx=a[0],s.segments=[]),s},gg=function(e,t){return Dm(e.childNodes).filter(function(e){return e.tagName===t})},yg=function(e){return e.textContent.trim()},vg=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;var i=t.slice(1),n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5];return 31536e3*parseFloat(n||0)+2592e3*parseFloat(r||0)+86400*parseFloat(s||0)+3600*parseFloat(a||0)+60*parseFloat(o||0)+parseFloat(l||0)},_g={mediaPresentationDuration:function(e){return vg(e)},availabilityStartTime:function(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:function(e){return vg(e)},suggestedPresentationDelay:function(e){return vg(e)},type:function(e){return e},timeShiftBufferDepth:function(e){return vg(e)},start:function(e){return vg(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},frameRate:function(e){return function(e){return parseFloat(e.split("/").reduce(function(e,t){return e/t}))}(e)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},presentationTimeOffset:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?vg(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},bg=function(e){return e&&e.attributes?Dm(e.attributes).reduce(function(e,t){var i=_g[t.name]||_g.DEFAULT;return e[t.name]=i(t.value),e},{}):{}},Tg={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Sg=function(e,t){return t.length?Lm(e.map(function(e){return t.map(function(t){return $f(e,yg(t))})})):e},wg=function(e){var t=gg(e,"SegmentTemplate")[0],i=gg(e,"SegmentList")[0],n=i&&gg(i,"SegmentURL").map(function(e){return Im({tag:"SegmentURL"},bg(e))}),r=gg(e,"SegmentBase")[0],s=i||t,a=s&&gg(s,"SegmentTimeline")[0],o=i||r||t,l=o&&gg(o,"Initialization")[0],u=t&&bg(t);u&&l?u.initialization=l&&bg(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});var c={template:u,segmentTimeline:a&&gg(a,"S").map(function(e){return bg(e)}),list:i&&Im(bg(i),{segmentUrls:n,initialization:bg(l)}),base:r&&Im(bg(r),{initialization:bg(l)})};return Object.keys(c).forEach(function(e){c[e]||delete c[e]}),c},xg=function(e,t,i){return function(n){var r,s=bg(n),a=Sg(t,gg(n,"BaseURL")),o=gg(n,"Role")[0],l={role:bg(o)},u=Im(e,s,l),c=gg(n,"Accessibility")[0],h="urn:scte:dash:cc:cea-608:2015"===(r=bg(c)).schemeIdUri?("string"!=typeof r.value?[]:r.value.split(";")).map(function(e){var t,i;if(i=e,/^CC\d=/.test(e)){var n=e.split("=");t=n[0],i=n[1]}else/^CC\d$/.test(e)&&(t=e);return{channel:t,language:i}}):"urn:scte:dash:cc:cea-708:2015"===r.schemeIdUri?("string"!=typeof r.value?[]:r.value.split(";")).map(function(e){var t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){var i=e.split("="),n=i[0],r=i[1],s=void 0===r?"":r;t.channel=n,t.language=e,s.split(",").forEach(function(e){var i=e.split(":"),n=i[0],r=i[1];"lang"===n?t.language=r:"er"===n?t.easyReader=Number(r):"war"===n?t.aspectRatio=Number(r):"3D"===n&&(t["3D"]=Number(r))})}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t}):void 0;h&&(u=Im(u,{captionServices:h}));var d=gg(n,"Label")[0];if(d&&d.childNodes.length){var p=d.childNodes[0].nodeValue.trim();u=Im(u,{label:p})}var f=gg(n,"ContentProtection").reduce(function(e,t){var i=bg(t);i.schemeIdUri&&(i.schemeIdUri=i.schemeIdUri.toLowerCase());var n=Tg[i.schemeIdUri];if(n){e[n]={attributes:i};var r=gg(t,"cenc:pssh")[0];if(r){var s=yg(r);e[n].pssh=s&&Yf(s)}}return e},{});Object.keys(f).length&&(u=Im(u,{contentProtection:f}));var m=wg(n),g=gg(n,"Representation"),y=Im(i,m);return Lm(g.map(function(e,t,i){return function(n){var r=gg(n,"BaseURL"),s=Sg(t,r),a=Im(e,bg(n)),o=wg(n);return s.map(function(e){return{segmentInfo:Im(i,o),attributes:Im(a,{baseUrl:e})}})}}(u,a,y)))}},Ag=function(e,t){return function(i,n){var r=Sg(t,gg(i.node,"BaseURL")),s=Im(e,{periodStart:i.attributes.start});"number"==typeof i.attributes.duration&&(s.periodDuration=i.attributes.duration);var a=gg(i.node,"AdaptationSet"),o=wg(i.node);return Lm(a.map(xg(s,r,o)))}},Eg=function(e){if(""===e)throw new Error(Nm);var t,i,n=new gt.DOMParser;try{i=(t=n.parseFromString(e,"application/xml"))&&"MPD"===t.documentElement.tagName?t.documentElement:null}catch(r){}if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(Fm);return i},Cg=function(e,t){void 0===t&&(t={});var i=function(e,t){void 0===t&&(t={});var i=t,n=i.manifestUri,r=void 0===n?"":n,s=i.NOW,a=void 0===s?Date.now():s,o=i.clientOffset,l=void 0===o?0:o,u=gg(e,"Period");if(!u.length)throw new Error(Rm);var c=gg(e,"Location"),h=bg(e),d=Sg([r],gg(e,"BaseURL"));h.type=h.type||"static",h.sourceDuration=h.mediaPresentationDuration||0,h.NOW=a,h.clientOffset=l,c.length&&(h.locations=c.map(yg));var p=[];return u.forEach(function(e,t){var i=bg(e),n=p[t-1];i.start=function(e){var t=e.attributes,i=e.priorPeriodAttributes,n=e.mpdType;return"number"==typeof t.start?t.start:i&&"number"==typeof i.start&&"number"==typeof i.duration?i.start+i.duration:i||"static"!==n?null:0}({attributes:i,priorPeriodAttributes:n?n.attributes:null,mpdType:h.type}),p.push({node:e,attributes:i})}),{locations:h.locations,representationInfo:Lm(p.map(Ag(h,d)))}}(Eg(e),t),n=i.representationInfo.map(mg);return lg({dashPlaylists:n,locations:i.locations,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest})},Mg=function(e){return function(e){var t=gg(e,"UTCTiming")[0];if(!t)return null;var i=bg(t);switch(i.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":i.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":i.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":i.method="DIRECT",i.value=Date.parse(i.value);break;default:throw new Error(jm)}return i}(Eg(e))};var kg=function(){if(xm)return wm;xm=1;var e=function(){if(Sm)return Tm;Sm=1;var e=Math.pow(2,32);return Tm={getUint64:function(t){var i,n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getBigUint64?(i=n.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(i):i:n.getUint32(0)*e+n.getUint32(4)},MAX_UINT32:e}}().getUint64;return wm=function(t){var i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8)},r=12;0===n.version?(n.earliestPresentationTime=i.getUint32(r),n.firstOffset=i.getUint32(r+4),r+=8):(n.earliestPresentationTime=e(t.subarray(r)),n.firstOffset=e(t.subarray(r+8)),r+=16),r+=2;var s=i.getUint16(r);for(r+=2;s>0;r+=12,s--)n.references.push({referenceType:(128&t[r])>>>7,referencedSize:2147483647&i.getUint32(r),subsegmentDuration:i.getUint32(r+4),startsWithSap:!!(128&t[r+8]),sapType:(112&t[r+8])>>>4,sapDeltaTime:268435455&i.getUint32(r+8)});return n}}();const Ig=s(kg);var Pg=vm([73,68,51]),Lg=function e(t,i){return void 0===i&&(i=0),(t=vm(t)).length-i<10||!Mm(t,Pg,{offset:i})?i:(i+=function(e,t){void 0===t&&(t=0);var i=(e=vm(e))[t+5],n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&i)>>4?n+20:n+10}(t,i),e(t,i))},Dg=function(e){return"string"==typeof e?Cm(e):e},Og=function e(t,i,n){void 0===n&&(n=!1),i=function(e){return Array.isArray(e)?e.map(function(e){return Dg(e)}):[Dg(e)]}(i),t=vm(t);var r=[];if(!i.length)return r;for(var s=0;s<t.length;){var a=(t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3])>>>0,o=t.subarray(s+4,s+8);if(0===a)break;var l=s+a;if(l>t.length){if(n)break;l=t.length}var u=t.subarray(s+8,l);Mm(o,i[0])&&(1===i.length?r.push(u):r.push.apply(r,e(u,i.slice(1),n))),s=l}return r},Rg={EBML:vm([26,69,223,163]),DocType:vm([66,130]),Segment:vm([24,83,128,103]),SegmentInfo:vm([21,73,169,102]),Tracks:vm([22,84,174,107]),Track:vm([174]),TrackNumber:vm([215]),DefaultDuration:vm([35,227,131]),TrackEntry:vm([174]),TrackType:vm([131]),FlagDefault:vm([136]),CodecID:vm([134]),CodecPrivate:vm([99,162]),VideoTrack:vm([224]),AudioTrack:vm([225]),Cluster:vm([31,67,182,117]),Timestamp:vm([231]),TimestampScale:vm([42,215,177]),BlockGroup:vm([160]),BlockDuration:vm([155]),Block:vm([161]),SimpleBlock:vm([163])},Ng=[128,64,32,16,8,4,2,1],Fg=function(e,t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var r=function(e){for(var t=1,i=0;i<Ng.length&&!(e&Ng[i]);i++)t++;return t}(e[t]),s=e.subarray(t,t+r);return i&&((s=Array.prototype.slice.call(e,t,t+r))[0]^=Ng[r-1]),{length:r,value:Am(s,{signed:n}),bytes:s}},Ug=function e(t){return"string"==typeof t?t.match(/.{1,2}/g).map(function(t){return e(t)}):"number"==typeof t?Em(t):t},Bg=function e(t,i,n){if(n>=i.length)return i.length;var r=Fg(i,n,!1);if(Mm(t.bytes,r.bytes))return n;var s=Fg(i,n+r.length);return e(t,i,n+s.length+s.value+r.length)},jg=function e(t,i){i=function(e){return Array.isArray(e)?e.map(function(e){return Ug(e)}):[Ug(e)]}(i),t=vm(t);var n=[];if(!i.length)return n;for(var r=0;r<t.length;){var s=Fg(t,r,!1),a=Fg(t,r+s.length),o=r+s.length+a.length;127===a.value&&(a.value=Bg(s,t,o),a.value!==t.length&&(a.value-=o));var l=o+a.value>t.length?t.length:o+a.value,u=t.subarray(o,l);Mm(i[0],s.bytes)&&(1===i.length?n.push(u):n=n.concat(e(u,i.slice(1)))),r+=s.length+a.length+u.length}return n},zg=vm([0,0,0,1]),Vg=vm([0,0,1]),Hg=vm([0,0,3]),qg=function(e){for(var t=[],i=1;i<e.length-2;)Mm(e.subarray(i,i+3),Hg)&&(t.push(i+2),i++),i++;if(0===t.length)return e;var n=e.length-t.length,r=new Uint8Array(n),s=0;for(i=0;i<n;s++,i++)s===t[0]&&(s++,t.shift()),r[i]=e[s];return r},Gg=function(e,t,i,n){e=vm(e),i=[].concat(i);for(var r,s=0,a=0;s<e.length&&(a<n||r);){var o=void 0;if(Mm(e.subarray(s),zg)?o=4:Mm(e.subarray(s),Vg)&&(o=3),o){if(a++,r)return qg(e.subarray(r,s));var l=void 0;"h264"===t?l=31&e[s+o]:"h265"===t&&(l=e[s+o]>>1&63),-1!==i.indexOf(l)&&(r=s+o),s+=o+("h264"===t?1:2)}else s++}return e.subarray(0,0)},Wg={webm:vm([119,101,98,109]),matroska:vm([109,97,116,114,111,115,107,97]),flac:vm([102,76,97,67]),ogg:vm([79,103,103,83]),ac3:vm([11,119]),riff:vm([82,73,70,70]),avi:vm([65,86,73]),wav:vm([87,65,86,69]),"3gp":vm([102,116,121,112,51,103]),mp4:vm([102,116,121,112]),fmp4:vm([115,116,121,112]),mov:vm([102,116,121,112,113,116]),moov:vm([109,111,111,118]),moof:vm([109,111,111,102])},$g={aac:function(e){var t=Lg(e);return Mm(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Lg(e);return Mm(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=jg(e,[Rg.EBML,Rg.DocType])[0];return Mm(t,Wg.webm)},mkv:function(e){var t=jg(e,[Rg.EBML,Rg.DocType])[0];return Mm(t,Wg.matroska)},mp4:function(e){return!$g["3gp"](e)&&!$g.mov(e)&&(!(!Mm(e,Wg.mp4,{offset:4})&&!Mm(e,Wg.fmp4,{offset:4}))||(!(!Mm(e,Wg.moof,{offset:4})&&!Mm(e,Wg.moov,{offset:4}))||void 0))},mov:function(e){return Mm(e,Wg.mov,{offset:4})},"3gp":function(e){return Mm(e,Wg["3gp"],{offset:4})},ac3:function(e){var t=Lg(e);return Mm(e,Wg.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];for(var t=0;t+188<e.length&&t<188;){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=Lg(e);return Mm(e,Wg.flac,{offset:t})},ogg:function(e){return Mm(e,Wg.ogg)},avi:function(e){return Mm(e,Wg.riff)&&Mm(e,Wg.avi,{offset:8})},wav:function(e){return Mm(e,Wg.riff)&&Mm(e,Wg.wav,{offset:8})},h264:function(e){return function(e,t,i){return Gg(e,"h264",t,i)}(e,7,3).length},h265:function(e){return function(e,t,i){return Gg(e,"h265",t,i)}(e,[32,33],3).length}},Xg=Object.keys($g).filter(function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e}).concat(["ts","h264","h265"]);Xg.forEach(function(e){var t=$g[e];$g[e]=function(e){return t(vm(e))}});var Yg,Qg,Kg=$g,Zg=function(e){e=vm(e);for(var t=0;t<Xg.length;t++){var i=Xg[t];if(Kg[i](e))return i}return""};var Jg=function(){if(Qg)return Yg;Qg=1;var e,t,i,n,r,s,a,o=9e4;return r=function(t,i){return e(n(t,i))},s=function(e,n){return t(i(e),n)},a=function(e,t,n){return i(n?e:e-t)},Yg={ONE_SECOND_IN_TS:o,secondsToVideoTs:e=function(e){return e*o},secondsToAudioTs:t=function(e,t){return e*t},videoTsToSeconds:i=function(e){return e/o},audioTsToSeconds:n=function(e,t){return e/t},audioTsToVideoTs:r,videoTsToAudioTs:s,metadataTsToSeconds:a}}();function ey(e){return(ey=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ty(e){var t="function"==typeof Map?new Map:void 0;return ty=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Ff(e,arguments,ey(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Af(i,e)},ty(e)}for(var iy,ny="7.21.7",ry={},sy=function(e,t){return ry[e]=ry[e]||[],t&&(ry[e]=ry[e].concat(t)),ry[e]},ay=function(e,t){var i=sy(e).indexOf(t);return!(i<=-1)&&(ry[e]=ry[e].slice(),ry[e].splice(i,1),!0)},oy={prefixed:!0},ly=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],uy=ly[0],cy=0;cy<ly.length;cy++)if(ly[cy][1]in z){iy=ly[cy];break}if(iy){for(var hy=0;hy<iy.length;hy++)oy[uy[hy]]=iy[hy];oy.prefixed=iy[0]!==uy[0]}var dy=[];var py=function e(t){var i,n="info",r=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i("log",n,t)};return i=function(e,t){return function(i,n,r){var s=t.levels[n],a=new RegExp("^("+s+")$");if("log"!==i&&r.unshift(i.toUpperCase()+":"),r.unshift(e+":"),dy){dy.push([].concat(r));var o=dy.length-1e3;dy.splice(0,o>0?o:0)}if(N.console){var l=N.console[i];l||"debug"!==i||(l=N.console.info||N.console.log),l&&s&&a.test(i)&&l[Array.isArray(r)?"apply":"call"](N.console,r)}}}(t,r),r.createLogger=function(i){return e(t+": "+i)},r.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},r.level=function(e){if("string"==typeof e){if(!r.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');n=e}return n},(r.history=function(){return dy?[].concat(dy):[]}).filter=function(e){return(dy||[]).filter(function(t){return new RegExp(".*"+e+".*").test(t[0])})},r.history.clear=function(){dy&&(dy.length=0)},r.history.disable=function(){null!==dy&&(dy.length=0,dy=null)},r.history.enable=function(){null===dy&&(dy=[])},r.error=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i("error",n,t)},r.warn=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i("warn",n,t)},r.debug=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i("debug",n,t)},r}("VIDEOJS"),fy=py.createLogger,my=Object.prototype.toString,gy=function(e){return _y(e)?Object.keys(e):[]};function yy(e,t){gy(e).forEach(function(i){return t(e[i],i)})}function vy(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return Object.assign?ye.apply(void 0,[e].concat(i)):(i.forEach(function(t){t&&yy(t,function(t,i){e[i]=t})}),e)}function _y(e){return!!e&&"object"==typeof e}function by(e){return _y(e)&&"[object Object]"===my.call(e)&&e.constructor===Object}function Ty(e,t){if(!e||!t)return"";if("function"==typeof N.getComputedStyle){var i;try{i=N.getComputedStyle(e)}catch(n){return""}return i?i.getPropertyValue(t)||i[t]:""}return""}var Sy,wy,xy,Ay=N.navigator&&N.navigator.userAgent||"",Ey=/AppleWebKit\/([\d.]+)/i.exec(Ay),Cy=Ey?parseFloat(Ey.pop()):null,My=/iPod/i.test(Ay),ky=(Sy=Ay.match(/OS (\d+)_/i))&&Sy[1]?Sy[1]:null,Iy=/Android/i.test(Ay),Py=function(){var e=Ay.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);return t&&i?parseFloat(e[1]+"."+e[2]):t||null}(),Ly=Iy&&Py<5&&Cy<537,Dy=/Firefox/i.test(Ay),Oy=/Edg/i.test(Ay),Ry=!Oy&&(/Chrome/i.test(Ay)||/CriOS/i.test(Ay)),Ny=function(){var e=Ay.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),Fy=(wy=/MSIE\s(\d+)\.\d/.exec(Ay),!(xy=wy&&parseFloat(wy[1]))&&/Trident\/7.0/i.test(Ay)&&/rv:11.0/.test(Ay)&&(xy=11),xy),Uy=/Safari/i.test(Ay)&&!Ry&&!Iy&&!Oy,By=/Windows/i.test(Ay),jy=Boolean(Xy()&&("ontouchstart"in N||N.navigator.maxTouchPoints||N.DocumentTouch&&N.document instanceof N.DocumentTouch)),zy=/iPad/i.test(Ay)||Uy&&jy&&!/iPhone/i.test(Ay),Vy=/iPhone/i.test(Ay)&&!zy,Hy=Vy||zy||My,qy=(Uy||Hy)&&!Ry,Gy=Object.freeze({__proto__:null,IS_IPOD:My,IOS_VERSION:ky,IS_ANDROID:Iy,ANDROID_VERSION:Py,IS_NATIVE_ANDROID:Ly,IS_FIREFOX:Dy,IS_EDGE:Oy,IS_CHROME:Ry,CHROME_VERSION:Ny,IE_VERSION:Fy,IS_SAFARI:Uy,IS_WINDOWS:By,TOUCH_ENABLED:jy,IS_IPAD:zy,IS_IPHONE:Vy,IS_IOS:Hy,IS_ANY_SAFARI:qy});function Wy(e){return"string"==typeof e&&Boolean(e.trim())}function $y(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Xy(){return z===N.document}function Yy(e){return _y(e)&&1===e.nodeType}function Qy(){try{return N.parent!==N.self}catch(e){return!0}}function Ky(e){return function(t,i){if(!Wy(t))return z[e](null);Wy(i)&&(i=z.querySelector(i));var n=Yy(i)?i:z;return n[e]&&n[e](t)}}function Zy(e,t,i,n){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===i&&(i={});var r=z.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){var i=t[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?(py.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+e+" to "+i+"."),r.setAttribute(e,i)):"textContent"===e?Jy(r,i):r[e]===i&&"tabIndex"!==e||(r[e]=i)}),Object.getOwnPropertyNames(i).forEach(function(e){r.setAttribute(e,i[e])}),n&&vv(r,n),r}function Jy(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function ev(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function tv(e,t){return $y(t),e.classList?e.classList.contains(t):(i=t,new RegExp("(^|\\s)"+i+"($|\\s)")).test(e.className);var i}function iv(e,t){return e.classList?e.classList.add(t):tv(e,t)||(e.className=(e.className+" "+t).trim()),e}function nv(e,t){return e?(e.classList?e.classList.remove(t):($y(t),e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")),e):(py.warn("removeClass was called with an element that doesn't exist"),null)}function rv(e,t,i){var n=tv(e,t);if("function"==typeof i&&(i=i(e,t)),"boolean"!=typeof i&&(i=!n),i!==n)return i?iv(e,t):nv(e,t),e}function sv(e,t){Object.getOwnPropertyNames(t).forEach(function(i){var n=t[i];null==n||!1===n?e.removeAttribute(i):e.setAttribute(i,!0===n?"":n)})}function av(e){var t={};if(e&&e.attributes&&e.attributes.length>0)for(var i=e.attributes,n=i.length-1;n>=0;n--){var r=i[n].name,s=i[n].value;"boolean"!=typeof e[r]&&-1===",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+r+",")||(s=null!==s),t[r]=s}return t}function ov(e,t){return e.getAttribute(t)}function lv(e,t,i){e.setAttribute(t,i)}function uv(e,t){e.removeAttribute(t)}function cv(){z.body.focus(),z.onselectstart=function(){return!1}}function hv(){z.onselectstart=function(){return!0}}function dv(e){if(e&&e.getBoundingClientRect&&e.parentNode){var t=e.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(function(e){void 0!==t[e]&&(i[e]=t[e])}),i.height||(i.height=parseFloat(Ty(e,"height"))),i.width||(i.width=parseFloat(Ty(e,"width"))),i}}function pv(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};for(var t=e.offsetWidth,i=e.offsetHeight,n=0,r=0;e.offsetParent&&e!==z[oy.fullscreenElement];)n+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:n,top:r,width:t,height:i}}function fv(e,t){var i={x:0,y:0};if(Hy)for(var n=e;n&&"html"!==n.nodeName.toLowerCase();){var r=Ty(n,"transform");if(/^matrix/.test(r)){var s=r.slice(7,-1).split(/,\s/).map(Number);i.x+=s[4],i.y+=s[5]}else if(/^matrix3d/.test(r)){var a=r.slice(9,-1).split(/,\s/).map(Number);i.x+=a[12],i.y+=a[13]}n=n.parentNode}var o={},l=pv(t.target),u=pv(e),c=u.width,h=u.height,d=t.offsetY-(u.top-l.top),p=t.offsetX-(u.left-l.left);return t.changedTouches&&(p=t.changedTouches[0].pageX-u.left,d=t.changedTouches[0].pageY+u.top,Hy&&(p-=i.x,d-=i.y)),o.y=1-Math.max(0,Math.min(1,d/h)),o.x=Math.max(0,Math.min(1,p/c)),o}function mv(e){return _y(e)&&3===e.nodeType}function gv(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function yv(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return"function"==typeof e&&(e=e()),Yy(e)||mv(e)?e:"string"==typeof e&&/\S/.test(e)?z.createTextNode(e):void 0}).filter(function(e){return e})}function vv(e,t){return yv(t).forEach(function(t){return e.appendChild(t)}),e}function _v(e,t){return vv(gv(e),t)}function bv(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons))}var Tv,Sv=Ky("querySelector"),wv=Ky("querySelectorAll"),xv=Object.freeze({__proto__:null,isReal:Xy,isEl:Yy,isInFrame:Qy,createEl:Zy,textContent:Jy,prependTo:ev,hasClass:tv,addClass:iv,removeClass:nv,toggleClass:rv,setAttributes:sv,getAttributes:av,getAttribute:ov,setAttribute:lv,removeAttribute:uv,blockTextSelection:cv,unblockTextSelection:hv,getBoundingClientRect:dv,findPosition:pv,getPointerPosition:fv,isTextNode:mv,emptyEl:gv,normalizeContent:yv,appendContent:vv,insertContent:_v,isSingleLeftClick:bv,$:Sv,$$:wv}),Av=!1,Ev=function(){if(!1!==Tv.options.autoSetup){var e=Array.prototype.slice.call(z.getElementsByTagName("video")),t=Array.prototype.slice.call(z.getElementsByTagName("audio")),i=Array.prototype.slice.call(z.getElementsByTagName("video-js")),n=e.concat(t,i);if(n&&n.length>0)for(var r=0,s=n.length;r<s;r++){var a=n[r];if(!a||!a.getAttribute){Cv(1);break}void 0===a.player&&null!==a.getAttribute("data-setup")&&Tv(a)}else Av||Cv(1)}};function Cv(e,t){Xy()&&(t&&(Tv=t),N.setTimeout(Ev,e))}function Mv(){Av=!0,N.removeEventListener("load",Mv)}Xy()&&("complete"===z.readyState?Mv():N.addEventListener("load",Mv));var kv,Iv=function(e){var t=z.createElement("style");return t.className=e,t},Pv=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t},Lv=3;function Dv(){return Lv++}N.WeakMap||(kv=function(){function e(){this.vdata="vdata"+Math.floor(N.performance&&N.performance.now()||Date.now()),this.data={}}var t=e.prototype;return t.set=function(e,t){var i=e[this.vdata]||Dv();return e[this.vdata]||(e[this.vdata]=i),this.data[i]=t,this},t.get=function(e){var t=e[this.vdata];if(t)return this.data[t];py("We have no data for this element",e)},t.has=function(e){return e[this.vdata]in this.data},t.delete=function(e){var t=e[this.vdata];t&&(delete this.data[t],delete e[this.vdata])},e}());var Ov,Rv=N.WeakMap?new WeakMap:new kv;function Nv(e,t){if(Rv.has(e)){var i=Rv.get(e);0===i.handlers[t].length&&(delete i.handlers[t],e.removeEventListener?e.removeEventListener(t,i.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&Rv.delete(e)}}function Fv(e,t,i,n){i.forEach(function(i){e(t,i,n)})}function Uv(e){if(e.fixed_)return e;function t(){return!0}function i(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){var n=e||N.event;for(var r in e={},n)"layerX"!==r&&"layerY"!==r&&"keyLocation"!==r&&"webkitMovementX"!==r&&"webkitMovementY"!==r&&"path"!==r&&("returnValue"===r&&n.preventDefault||(e[r]=n[r]));if(e.target||(e.target=e.srcElement||z),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){n.preventDefault&&n.preventDefault(),e.returnValue=!1,n.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),e.cancelBubble=!0,n.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=i,e.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=i,null!==e.clientX&&void 0!==e.clientX){var s=z.documentElement,a=z.body;e.pageX=e.clientX+(s&&s.scrollLeft||a&&a.scrollLeft||0)-(s&&s.clientLeft||a&&a.clientLeft||0),e.pageY=e.clientY+(s&&s.scrollTop||a&&a.scrollTop||0)-(s&&s.clientTop||a&&a.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}var Bv=["touchstart","touchmove"];function jv(e,t,i){if(Array.isArray(t))return Fv(jv,e,t,i);Rv.has(e)||Rv.set(e,{});var n=Rv.get(e);if(n.handlers||(n.handlers={}),n.handlers[t]||(n.handlers[t]=[]),i.guid||(i.guid=Dv()),n.handlers[t].push(i),n.dispatcher||(n.disabled=!1,n.dispatcher=function(t,i){if(!n.disabled){t=Uv(t);var r=n.handlers[t.type];if(r)for(var s=r.slice(0),a=0,o=s.length;a<o&&!t.isImmediatePropagationStopped();a++)try{s[a].call(e,t,i)}catch(l){py.error(l)}}}),1===n.handlers[t].length)if(e.addEventListener){var r=!1;(function(){if("boolean"!=typeof Ov){Ov=!1;try{var e=Object.defineProperty({},"passive",{get:function(){Ov=!0}});N.addEventListener("test",null,e),N.removeEventListener("test",null,e)}catch(t){}}return Ov})()&&Bv.indexOf(t)>-1&&(r={passive:!0}),e.addEventListener(t,n.dispatcher,r)}else e.attachEvent&&e.attachEvent("on"+t,n.dispatcher)}function zv(e,t,i){if(Rv.has(e)){var n=Rv.get(e);if(n.handlers){if(Array.isArray(t))return Fv(zv,e,t,i);var r=function(e,t){n.handlers[t]=[],Nv(e,t)};if(void 0!==t){var s=n.handlers[t];if(s)if(i){if(i.guid)for(var a=0;a<s.length;a++)s[a].guid===i.guid&&s.splice(a--,1);Nv(e,t)}else r(e,t)}else for(var o in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},o)&&r(e,o)}}}function Vv(e,t,i){var n=Rv.has(e)?Rv.get(e):{},r=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=Uv(t),n.dispatcher&&n.dispatcher.call(e,t,i),r&&!t.isPropagationStopped()&&!0===t.bubbles)Vv.call(null,r,t,i);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){Rv.has(t.target)||Rv.set(t.target,{});var s=Rv.get(t.target);t.target[t.type]&&(s.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),s.disabled=!1)}return!t.defaultPrevented}function Hv(e,t,i){if(Array.isArray(t))return Fv(Hv,e,t,i);var n=function n(){zv(e,t,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||Dv(),jv(e,t,n)}function qv(e,t,i){var n=function n(){zv(e,t,n),i.apply(this,arguments)};n.guid=i.guid=i.guid||Dv(),jv(e,t,n)}var Gv,Wv=Object.freeze({__proto__:null,fixEvent:Uv,on:jv,off:zv,trigger:Vv,one:Hv,any:qv}),$v=30,Xv=function(e,t,i){t.guid||(t.guid=Dv());var n=t.bind(e);return n.guid=i?i+"_"+t.guid:t.guid,n},Yv=function(e,t){var i=N.performance.now();return function(){var n=N.performance.now();n-i>=t&&(e.apply(void 0,arguments),i=n)}},Qv=function(){};Qv.prototype.allowedEvents_={},Qv.prototype.on=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},jv(this,e,t),this.addEventListener=i},Qv.prototype.addEventListener=Qv.prototype.on,Qv.prototype.off=function(e,t){zv(this,e,t)},Qv.prototype.removeEventListener=Qv.prototype.off,Qv.prototype.one=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},Hv(this,e,t),this.addEventListener=i},Qv.prototype.any=function(e,t){var i=this.addEventListener;this.addEventListener=function(){},qv(this,e,t),this.addEventListener=i},Qv.prototype.trigger=function(e){var t=e.type||e;"string"==typeof e&&(e={type:t}),e=Uv(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Vv(this,e)},Qv.prototype.dispatchEvent=Qv.prototype.trigger,Qv.prototype.queueTrigger=function(e){var t=this;Gv||(Gv=new Map);var i=e.type||e,n=Gv.get(this);n||(n=new Map,Gv.set(this,n));var r=n.get(i);n.delete(i),N.clearTimeout(r);var s=N.setTimeout(function(){n.delete(i),0===n.size&&(n=null,Gv.delete(t)),t.trigger(e)},0);n.set(i,s)};var Kv=function(e){return"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e},Zv=function(e){return e instanceof Qv||!!e.eventBusEl_&&["on","one","off","trigger"].every(function(t){return"function"==typeof e[t]})},Jv=function(e){return"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length},e_=function(e,t,i){if(!e||!e.nodeName&&!Zv(e))throw new Error("Invalid target for "+Kv(t)+"#"+i+"; must be a DOM node or evented object.")},t_=function(e,t,i){if(!Jv(e))throw new Error("Invalid event type for "+Kv(t)+"#"+i+"; must be a non-empty string or array.")},i_=function(e,t,i){if("function"!=typeof e)throw new Error("Invalid listener for "+Kv(t)+"#"+i+"; must be a function.")},n_=function(e,t,i){var n,r,s,a=t.length<3||t[0]===e||t[0]===e.eventBusEl_;return a?(n=e.eventBusEl_,t.length>=3&&t.shift(),r=t[0],s=t[1]):(n=t[0],r=t[1],s=t[2]),e_(n,e,i),t_(r,e,i),i_(s,e,i),{isTargetingSelf:a,target:n,type:r,listener:s=Xv(e,s)}},r_=function(e,t,i,n){e_(e,e,t),e.nodeName?Wv[t](e,i,n):e[t](i,n)},s_={on:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=n_(this,i,"on"),s=r.isTargetingSelf,a=r.target,o=r.type,l=r.listener;if(r_(a,"on",o,l),!s){var u=function(){return e.off(a,o,l)};u.guid=l.guid;var c=function(){return e.off("dispose",u)};c.guid=l.guid,r_(this,"on","dispose",u),r_(a,"on","dispose",c)}},one:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=n_(this,i,"one"),s=r.isTargetingSelf,a=r.target,o=r.type,l=r.listener;if(s)r_(a,"one",o,l);else{var u=function t(){e.off(a,o,t);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];l.apply(null,n)};u.guid=l.guid,r_(a,"one",o,u)}},any:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=n_(this,i,"any"),s=r.isTargetingSelf,a=r.target,o=r.type,l=r.listener;if(s)r_(a,"any",o,l);else{var u=function t(){e.off(a,o,t);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];l.apply(null,n)};u.guid=l.guid,r_(a,"any",o,u)}},off:function(e,t,i){if(!e||Jv(e))zv(this.eventBusEl_,e,t);else{var n=e,r=t;e_(n,this,"off"),t_(r,this,"off"),i_(i,this,"off"),i=Xv(this,i),this.off("dispose",i),n.nodeName?(zv(n,r,i),zv(n,"dispose",i)):Zv(n)&&(n.off(r,i),n.off("dispose",i))}},trigger:function(e,t){e_(this.eventBusEl_,this,"trigger");var i=e&&"string"!=typeof e?e.type:e;if(!Jv(i)){var n="Invalid event type for "+Kv(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(!e)throw new Error(n);(this.log||py).error(n)}return Vv(this.eventBusEl_,e,t)}};function a_(e,t){void 0===t&&(t={});var i=t.eventBusKey;if(i){if(!e[i].nodeName)throw new Error('The eventBusKey "'+i+'" does not refer to an element.');e.eventBusEl_=e[i]}else e.eventBusEl_=Zy("span",{className:"vjs-event-bus"});return vy(e,s_),e.eventedCallbacks&&e.eventedCallbacks.forEach(function(e){e()}),e.on("dispose",function(){e.off(),[e,e.el_,e.eventBusEl_].forEach(function(e){e&&Rv.has(e)&&Rv.delete(e)}),N.setTimeout(function(){e.eventBusEl_=null},0)}),e}var o_={state:{},setState:function(e){var t,i=this;return"function"==typeof e&&(e=e()),yy(e,function(e,n){i.state[n]!==e&&((t=t||{})[n]={from:i.state[n],to:e}),i.state[n]=e}),t&&Zv(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function l_(e,t){return vy(e,o_),e.state=vy({},e.state,t),"function"==typeof e.handleStateChanged&&Zv(e)&&e.on("statechanged",e.handleStateChanged),e}var u_=function(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toLowerCase()})},c_=function(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toUpperCase()})};function h_(){for(var e={},t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.forEach(function(t){t&&yy(t,function(t,i){by(t)?(by(e[i])||(e[i]={}),e[i]=h_(e[i],t)):e[i]=t})}),e}var d_=function(){function e(){this.map_={}}var t=e.prototype;return t.has=function(e){return e in this.map_},t.delete=function(e){var t=this.has(e);return delete this.map_[e],t},t.set=function(e,t){return this.map_[e]=t,this},t.forEach=function(e,t){for(var i in this.map_)e.call(t,this.map_[i],i,this)},e}(),p_=N.Map?N.Map:d_,f_=function(){function e(){this.set_={}}var t=e.prototype;return t.has=function(e){return e in this.set_},t.delete=function(e){var t=this.has(e);return delete this.set_[e],t},t.add=function(e){return this.set_[e]=1,this},t.forEach=function(e,t){for(var i in this.set_)e.call(t,i,i,this)},e}(),m_=N.Set?N.Set:f_,g_=function(){function e(e,t,i){var n=this;if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=h_({},this.options_),t=this.options_=h_(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){var r=e&&e.id&&e.id()||"no_player";this.id_=r+"_component_"+Dv()}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(function(e){return n.addClass(e)}),!1!==t.evented&&(a_(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),l_(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new m_,this.setIntervalIds_=new m_,this.rafIds_=new m_,this.namedRafs_=new p_,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(i),!1!==t.reportTouchActivity&&this.enableTouchActivity()}var t=e.prototype;return t.dispose=function(e){if(void 0===e&&(e={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},t.isDisposed=function(){return Boolean(this.isDisposed_)},t.player=function(){return this.player_},t.options=function(e){return e?(this.options_=h_(this.options_,e),this.options_):this.options_},t.el=function(){return this.el_},t.createEl=function(e,t,i){return Zy(e,t,i)},t.localize=function(e,t,i){void 0===i&&(i=e);var n=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),s=r&&r[n],a=n&&n.split("-")[0],o=r&&r[a],l=i;return s&&s[e]?l=s[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,i){var n=t[i-1],r=n;return void 0===n&&(r=e),r})),l},t.handleLanguagechange=function(){},t.contentEl=function(){return this.contentEl_||this.el_},t.id=function(){return this.id_},t.name=function(){return this.name_},t.children=function(){return this.children_},t.getChildById=function(e){return this.childIndex_[e]},t.getChild=function(e){if(e)return this.childNameIndex_[e]},t.getDescendant=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t=t.reduce(function(e,t){return e.concat(t)},[]);for(var n=this,r=0;r<t.length;r++)if(!(n=n.getChild(t[r]))||!n.getChild)return;return n},t.addChild=function(t,i,n){var r,s;if(void 0===i&&(i={}),void 0===n&&(n=this.children_.length),"string"==typeof t){s=c_(t);var a=i.componentClass||s;i.name=s;var o=e.getComponent(a);if(!o)throw new Error("Component "+a+" does not exist");if("function"!=typeof o)return null;r=new o(this.player_||this,i)}else r=t;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),(s=s||r.name&&c_(r.name()))&&(this.childNameIndex_[s]=r,this.childNameIndex_[u_(s)]=r),"function"==typeof r.el&&r.el()){var l=null;this.children_[n+1]&&(this.children_[n+1].el_?l=this.children_[n+1].el_:Yy(this.children_[n+1])&&(l=this.children_[n+1])),this.contentEl().insertBefore(r.el(),l)}return r},t.removeChild=function(e){if("string"==typeof e&&(e=this.getChild(e)),e&&this.children_){for(var t=!1,i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(t){e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[c_(e.name())]=null,this.childNameIndex_[u_(e.name())]=null;var n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}}},t.initChildren=function(){var t=this,i=this.options_.children;if(i){var n,r=this.options_,s=e.getComponent("Tech");(n=Array.isArray(i)?i:Object.keys(i)).concat(Object.keys(this.options_).filter(function(e){return!n.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(function(e){var n,r;return"string"==typeof e?r=i[n=e]||t.options_[n]||{}:(n=e.name,r=e),{name:n,opts:r}}).filter(function(t){var i=e.getComponent(t.opts.componentClass||c_(t.name));return i&&!s.isTech(i)}).forEach(function(e){var i=e.name,n=e.opts;if(void 0!==r[i]&&(n=r[i]),!1!==n){!0===n&&(n={}),n.playerOptions=t.options_.playerOptions;var s=t.addChild(i,n);s&&(t[i]=s)}})}},t.buildCSSClass=function(){return""},t.ready=function(e,t){if(void 0===t&&(t=!1),e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))},t.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},t.$=function(e,t){return Sv(e,t||this.contentEl())},t.$$=function(e,t){return wv(e,t||this.contentEl())},t.hasClass=function(e){return tv(this.el_,e)},t.addClass=function(e){iv(this.el_,e)},t.removeClass=function(e){nv(this.el_,e)},t.toggleClass=function(e,t){rv(this.el_,e,t)},t.show=function(){this.removeClass("vjs-hidden")},t.hide=function(){this.addClass("vjs-hidden")},t.lockShowing=function(){this.addClass("vjs-lock-showing")},t.unlockShowing=function(){this.removeClass("vjs-lock-showing")},t.getAttribute=function(e){return ov(this.el_,e)},t.setAttribute=function(e,t){lv(this.el_,e,t)},t.removeAttribute=function(e){uv(this.el_,e)},t.width=function(e,t){return this.dimension("width",e,t)},t.height=function(e,t){return this.dimension("height",e,t)},t.dimensions=function(e,t){this.width(e,!0),this.height(t)},t.dimension=function(e,t,i){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(i||this.trigger("componentresize"));if(!this.el_)return 0;var n=this.el_.style[e],r=n.indexOf("px");return-1!==r?parseInt(n.slice(0,r),10):parseInt(this.el_["offset"+c_(e)],10)},t.currentDimension=function(e){var t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=Ty(this.el_,e),0===(t=parseFloat(t))||isNaN(t)){var i="offset"+c_(e);t=this.el_[i]}return t},t.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},t.currentWidth=function(){return this.currentDimension("width")},t.currentHeight=function(){return this.currentDimension("height")},t.focus=function(){this.el_.focus()},t.blur=function(){this.el_.blur()},t.handleKeyDown=function(e){this.player_&&(wf.isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))},t.handleKeyPress=function(e){this.handleKeyDown(e)},t.emitTapEvents=function(){var e,t=0,i=null;this.on("touchstart",function(n){1===n.touches.length&&(i={pageX:n.touches[0].pageX,pageY:n.touches[0].pageY},t=N.performance.now(),e=!0)}),this.on("touchmove",function(t){if(t.touches.length>1)e=!1;else if(i){var n=t.touches[0].pageX-i.pageX,r=t.touches[0].pageY-i.pageY;Math.sqrt(n*n+r*r)>10&&(e=!1)}});var n=function(){e=!1};this.on("touchleave",n),this.on("touchcancel",n),this.on("touchend",function(n){(i=null,!0===e)&&(N.performance.now()-t<200&&(n.preventDefault(),this.trigger("tap")))})},t.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e,t=Xv(this.player(),this.player().reportUserActivity);this.on("touchstart",function(){t(),this.clearInterval(e),e=this.setInterval(t,250)});var i=function(i){t(),this.clearInterval(e)};this.on("touchmove",t),this.on("touchend",i),this.on("touchcancel",i)}},t.setTimeout=function(e,t){var i,n=this;return e=Xv(this,e),this.clearTimersOnDispose_(),i=N.setTimeout(function(){n.setTimeoutIds_.has(i)&&n.setTimeoutIds_.delete(i),e()},t),this.setTimeoutIds_.add(i),i},t.clearTimeout=function(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),N.clearTimeout(e)),e},t.setInterval=function(e,t){e=Xv(this,e),this.clearTimersOnDispose_();var i=N.setInterval(e,t);return this.setIntervalIds_.add(i),i},t.clearInterval=function(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),N.clearInterval(e)),e},t.requestAnimationFrame=function(e){var t,i=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),e=Xv(this,e),t=N.requestAnimationFrame(function(){i.rafIds_.has(t)&&i.rafIds_.delete(t),e()}),this.rafIds_.add(t),t):this.setTimeout(e,1e3/60)},t.requestNamedAnimationFrame=function(e,t){var i=this;if(!this.namedRafs_.has(e)){this.clearTimersOnDispose_(),t=Xv(this,t);var n=this.requestAnimationFrame(function(){t(),i.namedRafs_.has(e)&&i.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}},t.cancelNamedAnimationFrame=function(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))},t.cancelAnimationFrame=function(e){return this.supportsRaf_?(this.rafIds_.has(e)&&(this.rafIds_.delete(e),N.cancelAnimationFrame(e)),e):this.clearTimeout(e)},t.clearTimersOnDispose_=function(){var e=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(t){var i=t[0],n=t[1];e[i].forEach(function(t,i){return e[n](i)})}),e.clearingTimersOnDispose_=!1}))},e.registerComponent=function(t,i){if("string"!=typeof t||!t)throw new Error('Illegal component name, "'+t+'"; must be a non-empty string.');var n,r=e.getComponent("Tech"),s=r&&r.isTech(i),a=e===i||e.prototype.isPrototypeOf(i.prototype);if(s||!a)throw n=s?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error('Illegal component, "'+t+'"; '+n+".");t=c_(t),e.components_||(e.components_={});var o=e.getComponent("Player");if("Player"===t&&o&&o.players){var l=o.players,u=Object.keys(l);if(l&&u.length>0&&u.map(function(e){return l[e]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return e.components_[t]=i,e.components_[u_(t)]=i,i},e.getComponent=function(t){if(t&&e.components_)return e.components_[t]},e}();function y_(e,t,i,n){return function(e,t,i){if("number"!=typeof t||t<0||t>i)throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is non-numeric or out of bounds (0-"+i+").")}(e,n,i.length-1),i[n][t]}function v_(e){var t;return t=void 0===e||0===e.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:y_.bind(null,"start",0,e),end:y_.bind(null,"end",1,e)},N.Symbol&&N.Symbol.iterator&&(t[N.Symbol.iterator]=function(){return(e||[]).values()}),t}function __(e,t){return Array.isArray(e)?v_(e):void 0===e||void 0===t?v_():v_([[e,t]])}function b_(e,t){var i,n,r=0;if(!t)return 0;e&&e.length||(e=__(0,0));for(var s=0;s<e.length;s++)i=e.start(s),(n=e.end(s))>t&&(n=t),r+=n-i;return r/t}function T_(e){if(e instanceof T_)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:_y(e)&&("number"==typeof e.code&&(this.code=e.code),vy(this,e)),this.message||(this.message=T_.defaultMessages[this.code]||"")}g_.prototype.supportsRaf_="function"==typeof N.requestAnimationFrame&&"function"==typeof N.cancelAnimationFrame,g_.registerComponent("Component",g_),T_.prototype.code=0,T_.prototype.message="",T_.prototype.status=null,T_.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],T_.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var S_=0;S_<T_.errorTypes.length;S_++)T_[T_.errorTypes[S_]]=S_,T_.prototype[T_.errorTypes[S_]]=S_;function w_(e){return null!=e&&"function"==typeof e.then}function x_(e){w_(e)&&e.then(null,function(e){})}var A_=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(t,i,n){return e[i]&&(t[i]=e[i]),t},{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})},E_=function(e){var t=e.$$("track"),i=Array.prototype.map.call(t,function(e){return e.track});return Array.prototype.map.call(t,function(e){var t=A_(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===i.indexOf(e)}).map(A_))},C_=function(e,t){return e.forEach(function(e){var i=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(function(e){return i.addCue(e)})}),t.textTracks()},M_="vjs-modal-dialog",k_=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).handleKeyDown_=function(e){return n.handleKeyDown(e)},n.close_=function(e){return n.close(e)},n.opened_=n.hasBeenOpened_=n.hasBeenFilled_=!1,n.closeable(!n.options_.uncloseable),n.content(n.options_.content),n.contentEl_=Zy("div",{className:M_+"-content"},{role:"document"}),n.descEl_=Zy("p",{className:M_+"-description vjs-control-text",id:n.el().getAttribute("aria-describedby")}),Jy(n.descEl_,n.description()),n.el_.appendChild(n.descEl_),n.el_.appendChild(n.contentEl_),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},i.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,e.prototype.dispose.call(this)},i.buildCSSClass=function(){return M_+" vjs-hidden "+e.prototype.buildCSSClass.call(this)},i.label=function(){return this.localize(this.options_.label||"Modal Window")},i.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},i.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},i.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},i.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},i.closeable=function(e){if("boolean"==typeof e){var t=this.closeable_=!!e,i=this.getChild("closeButton");if(t&&!i){var n=this.contentEl_;this.contentEl_=this.el_,i=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=n,this.on(i,"close",this.close_)}!t&&i&&(this.off(i,"close",this.close_),this.removeChild(i),i.dispose())}return this.closeable_},i.fill=function(){this.fillWith(this.content())},i.fillWith=function(e){var t=this.contentEl(),i=t.parentNode,n=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,i.removeChild(t),this.empty(),_v(t,e),this.trigger("modalfill"),n?i.insertBefore(t,n):i.appendChild(t);var r=this.getChild("closeButton");r&&i.appendChild(r.el_)},i.empty=function(){this.trigger("beforemodalempty"),gv(this.contentEl()),this.trigger("modalempty")},i.content=function(e){return void 0!==e&&(this.content_=e),this.content_},i.conditionalFocus_=function(){var e=z.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())},i.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},i.handleKeyDown=function(e){if(e.stopPropagation(),wf.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(wf.isEventKey(e,"Tab")){for(var t,i=this.focusableEls_(),n=this.el_.querySelector(":focus"),r=0;r<i.length;r++)if(n===i[r]){t=r;break}z.activeElement===this.el_&&(t=0),e.shiftKey&&0===t?(i[i.length-1].focus(),e.preventDefault()):e.shiftKey||t!==i.length-1||(i[0].focus(),e.preventDefault())}},i.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,function(e){return(e instanceof N.HTMLAnchorElement||e instanceof N.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof N.HTMLInputElement||e instanceof N.HTMLSelectElement||e instanceof N.HTMLTextAreaElement||e instanceof N.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof N.HTMLIFrameElement||e instanceof N.HTMLObjectElement||e instanceof N.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")})},t}(g_);k_.prototype.options_={pauseOnOpen:!0,temporary:!0},g_.registerComponent("ModalDialog",k_);var I_=function(e){function t(t){var i;void 0===t&&(t=[]),(i=e.call(this)||this).tracks_=[],Object.defineProperty(xf(i),"length",{get:function(){return this.tracks_.length}});for(var n=0;n<t.length;n++)i.addTrack(t[n]);return i}Ef(t,e);var i=t.prototype;return i.addTrack=function(e){var t=this,i=this.tracks_.length;""+i in this||Object.defineProperty(this,i,{get:function(){return this.tracks_[i]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=function(){t.trigger({track:e,type:"labelchange",target:t})},Zv(e)&&e.addEventListener("labelchange",e.labelchange_)},i.removeTrack=function(e){for(var t,i=0,n=this.length;i<n;i++)if(this[i]===e){(t=this[i]).off&&t.off(),this.tracks_.splice(i,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})},i.getTrackById=function(e){for(var t=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===e){t=r;break}}return t},t}(Qv);for(var P_ in I_.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},I_.prototype.allowedEvents_)I_.prototype["on"+P_]=null;var L_=function(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].enabled=!1)},D_=function(e){function t(t){var i;void 0===t&&(t=[]);for(var n=t.length-1;n>=0;n--)if(t[n].enabled){L_(t,t[n]);break}return(i=e.call(this,t)||this).changing_=!1,i}Ef(t,e);var i=t.prototype;return i.addTrack=function(t){var i=this;t.enabled&&L_(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.enabledChange_=function(){i.changing_||(i.changing_=!0,L_(i,t),i.changing_=!1,i.trigger("change"))},t.addEventListener("enabledchange",t.enabledChange_))},i.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.enabledChange_&&(t.removeEventListener("enabledchange",t.enabledChange_),t.enabledChange_=null)},t}(I_),O_=function(e,t){for(var i=0;i<e.length;i++)Object.keys(e[i]).length&&t.id!==e[i].id&&(e[i].selected=!1)},R_=function(e){function t(t){var i;void 0===t&&(t=[]);for(var n=t.length-1;n>=0;n--)if(t[n].selected){O_(t,t[n]);break}return(i=e.call(this,t)||this).changing_=!1,Object.defineProperty(xf(i),"selectedIndex",{get:function(){for(var e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set:function(){}}),i}Ef(t,e);var i=t.prototype;return i.addTrack=function(t){var i=this;t.selected&&O_(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.selectedChange_=function(){i.changing_||(i.changing_=!0,O_(i,t),i.changing_=!1,i.trigger("change"))},t.addEventListener("selectedchange",t.selectedChange_))},i.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.selectedChange_&&(t.removeEventListener("selectedchange",t.selectedChange_),t.selectedChange_=null)},t}(I_),N_=function(e){function t(){return e.apply(this,arguments)||this}Ef(t,e);var i=t.prototype;return i.addTrack=function(t){var i=this;e.prototype.addTrack.call(this,t),this.queueChange_||(this.queueChange_=function(){return i.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return i.trigger("selectedlanguagechange")}),t.addEventListener("modechange",this.queueChange_);-1===["metadata","chapters"].indexOf(t.kind)&&t.addEventListener("modechange",this.triggerSelectedlanguagechange_)},i.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&(this.queueChange_&&t.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&t.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},t}(I_),F_=function(){function e(e){void 0===e&&(e=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var t=0,i=e.length;t<i;t++)this.addTrackElement_(e[t])}var t=e.prototype;return t.addTrackElement_=function(e){var t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)},t.getTrackElementByTrack_=function(e){for(var t,i=0,n=this.trackElements_.length;i<n;i++)if(e===this.trackElements_[i].track){t=this.trackElements_[i];break}return t},t.removeTrackElement_=function(e){for(var t=0,i=this.trackElements_.length;t<i;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}},e}(),U_=function(){function e(t){e.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var t=e.prototype;return t.setCues_=function(e){var t=this.length||0,i=0,n=e.length;this.cues_=e,this.length_=e.length;var r=function(e){""+e in this||Object.defineProperty(this,""+e,{get:function(){return this.cues_[e]}})};if(t<n)for(i=t;i<n;i++)r.call(this,i)},t.getCueById=function(e){for(var t=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===e){t=r;break}}return t},e}(),B_={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},j_={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},z_={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},V_={disabled:"disabled",hidden:"hidden",showing:"showing"},H_=function(e){function t(t){var i;void 0===t&&(t={}),i=e.call(this)||this;var n={id:t.id||"vjs_track_"+Dv(),kind:t.kind||"",language:t.language||""},r=t.label||"",s=function(e){Object.defineProperty(xf(i),e,{get:function(){return n[e]},set:function(){}})};for(var a in n)s(a);return Object.defineProperty(xf(i),"label",{get:function(){return r},set:function(e){e!==r&&(r=e,this.trigger("labelchange"))}}),i}return Ef(t,e),t}(Qv),q_=function(e){var t=["protocol","hostname","port","pathname","search","hash","host"],i=z.createElement("a");i.href=e;for(var n={},r=0;r<t.length;r++)n[t[r]]=i[t[r]];return"http:"===n.protocol&&(n.host=n.host.replace(/:80$/,"")),"https:"===n.protocol&&(n.host=n.host.replace(/:443$/,"")),n.protocol||(n.protocol=N.location.protocol),n.host||(n.host=N.location.host),n},G_=function(e){if(!e.match(/^https?:\/\//)){var t=z.createElement("a");t.href=e,e=t.href}return e},W_=function(e){if("string"==typeof e){var t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(e);if(t)return t.pop().toLowerCase()}return""},$_=function(e,t){void 0===t&&(t=N.location);var i=q_(e);return(":"===i.protocol?t.protocol:i.protocol)+i.host!==t.protocol+t.host},X_=Object.freeze({__proto__:null,parseUrl:q_,getAbsoluteURL:G_,getFileExtension:W_,isCrossOrigin:$_}),Y_=function(e,t){var i=new N.WebVTT.Parser(N,N.vttjs,N.WebVTT.StringDecoder()),n=[];i.oncue=function(e){t.addCue(e)},i.onparsingerror=function(e){n.push(e)},i.onflush=function(){t.trigger({type:"loadeddata",target:t})},i.parse(e),n.length>0&&(N.console&&N.console.groupCollapsed&&N.console.groupCollapsed("Text Track parsing errors for "+t.src),n.forEach(function(e){return py.error(e)}),N.console&&N.console.groupEnd&&N.console.groupEnd()),i.flush()},Q_=function(e,t){var i={uri:e},n=$_(e);n&&(i.cors=n);var r="use-credentials"===t.tech_.crossOrigin();r&&(i.withCredentials=r),Rf(i,Xv(this,function(e,i,n){if(e)return py.error(e,i);t.loaded_=!0,"function"!=typeof N.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],function(e){if("vttjserror"!==e.type)return Y_(n,t);py.error("vttjs failed to load, stopping trying to process "+t.src)}):Y_(n,t)}))},K_=function(e){function t(t){var i;if(void 0===t&&(t={}),!t.tech)throw new Error("A tech was not provided.");var n=h_(t,{kind:z_[t.kind]||"subtitles",language:t.language||t.srclang||""}),r=V_[n.mode]||"disabled",s=n.default;"metadata"!==n.kind&&"chapters"!==n.kind||(r="hidden"),(i=e.call(this,n)||this).tech_=n.tech,i.cues_=[],i.activeCues_=[],i.preload_=!1!==i.tech_.preloadTextTracks;var a=new U_(i.cues_),o=new U_(i.activeCues_),l=!1;i.timeupdateHandler=Xv(xf(i),function(e){void 0===e&&(e={}),this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,l&&(this.trigger("cuechange"),l=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))});return i.tech_.one("dispose",function(){i.stopTracking()}),"disabled"!==r&&i.startTracking(),Object.defineProperties(xf(i),{default:{get:function(){return s},set:function(){}},mode:{get:function(){return r},set:function(e){V_[e]&&r!==e&&(r=e,this.preload_||"disabled"===r||0!==this.cues.length||Q_(this.src,this),this.stopTracking(),"disabled"!==r&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?a:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return o;for(var e=this.tech_.currentTime(),t=[],i=0,n=this.cues.length;i<n;i++){var r=this.cues[i];(r.startTime<=e&&r.endTime>=e||r.startTime===r.endTime&&r.startTime<=e&&r.startTime+.5>=e)&&t.push(r)}if(l=!1,t.length!==this.activeCues_.length)l=!0;else for(var s=0;s<t.length;s++)-1===this.activeCues_.indexOf(t[s])&&(l=!0);return this.activeCues_=t,o.setCues_(this.activeCues_),o},set:function(){}}}),n.src?(i.src=n.src,i.preload_||(i.loaded_=!0),(i.preload_||"subtitles"!==n.kind&&"captions"!==n.kind)&&Q_(i.src,xf(i))):i.loaded_=!0,i}Ef(t,e);var i=t.prototype;return i.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},i.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},i.addCue=function(e){var t=e;if(!("getCueAsHTML"in t)){for(var i in t=new N.vttjs.VTTCue(e.startTime,e.endTime,e.text),e)i in t||(t[i]=e[i]);t.id=e.id,t.originalCue_=e}for(var n=this.tech_.textTracks(),r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)},i.removeCue=function(e){for(var t=this.cues_.length;t--;){var i=this.cues_[t];if(i===e||i.originalCue_&&i.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},t}(H_);K_.prototype.allowedEvents_={cuechange:"cuechange"};var Z_=function(e){function t(t){var i;void 0===t&&(t={});var n=h_(t,{kind:j_[t.kind]||""});i=e.call(this,n)||this;var r=!1;return Object.defineProperty(xf(i),"enabled",{get:function(){return r},set:function(e){"boolean"==typeof e&&e!==r&&(r=e,this.trigger("enabledchange"))}}),n.enabled&&(i.enabled=n.enabled),i.loaded_=!0,i}return Ef(t,e),t}(H_),J_=function(e){function t(t){var i;void 0===t&&(t={});var n=h_(t,{kind:B_[t.kind]||""});i=e.call(this,n)||this;var r=!1;return Object.defineProperty(xf(i),"selected",{get:function(){return r},set:function(e){"boolean"==typeof e&&e!==r&&(r=e,this.trigger("selectedchange"))}}),n.selected&&(i.selected=n.selected),i}return Ef(t,e),t}(H_),eb=function(e){function t(t){var i,n;void 0===t&&(t={}),i=e.call(this)||this;var r=new K_(t);return i.kind=r.kind,i.src=r.src,i.srclang=r.language,i.label=r.label,i.default=r.default,Object.defineProperties(xf(i),{readyState:{get:function(){return n}},track:{get:function(){return r}}}),n=0,r.addEventListener("loadeddata",function(){n=2,i.trigger({type:"load",target:xf(i)})}),i}return Ef(t,e),t}(Qv);eb.prototype.allowedEvents_={load:"load"},eb.NONE=0,eb.LOADING=1,eb.LOADED=2,eb.ERROR=3;var tb={audio:{ListClass:D_,TrackClass:Z_,capitalName:"Audio"},video:{ListClass:R_,TrackClass:J_,capitalName:"Video"},text:{ListClass:N_,TrackClass:K_,capitalName:"Text"}};Object.keys(tb).forEach(function(e){tb[e].getterName=e+"Tracks",tb[e].privateName=e+"Tracks_"});var ib={remoteText:{ListClass:N_,TrackClass:K_,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:F_,TrackClass:eb,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},nb=ye({},tb,ib);ib.names=Object.keys(ib),tb.names=Object.keys(tb),nb.names=[].concat(ib.names).concat(tb.names);var rb=function(e){function t(t,i){var n;return void 0===t&&(t={}),void 0===i&&(i=function(){}),t.reportTouchActivity=!1,(n=e.call(this,null,t,i)||this).onDurationChange_=function(e){return n.onDurationChange(e)},n.trackProgress_=function(e){return n.trackProgress(e)},n.trackCurrentTime_=function(e){return n.trackCurrentTime(e)},n.stopTrackingCurrentTime_=function(e){return n.stopTrackingCurrentTime(e)},n.disposeSourceHandler_=function(e){return n.disposeSourceHandler(e)},n.queuedHanders_=new Set,n.hasStarted_=!1,n.on("playing",function(){this.hasStarted_=!0}),n.on("loadstart",function(){this.hasStarted_=!1}),nb.names.forEach(function(e){var i=nb[e];t&&t[i.getterName]&&(n[i.privateName]=t[i.getterName])}),n.featuresProgressEvents||n.manualProgressOn(),n.featuresTimeupdateEvents||n.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(e){!1===t["native"+e+"Tracks"]&&(n["featuresNative"+e+"Tracks"]=!1)}),!1===t.nativeCaptions||!1===t.nativeTextTracks?n.featuresNativeTextTracks=!1:!0!==t.nativeCaptions&&!0!==t.nativeTextTracks||(n.featuresNativeTextTracks=!0),n.featuresNativeTextTracks||n.emulateTextTracks(),n.preloadTextTracks=!1!==t.preloadTextTracks,n.autoRemoteTextTracks_=new nb.text.ListClass,n.initTrackListeners(),t.nativeControlsForTouch||n.emitTapEvents(),n.constructor&&(n.name_=n.constructor.name||"Unknown Tech"),n}Ef(t,e);var i=t.prototype;return i.triggerSourceset=function(e){var t=this;this.isReady_||this.one("ready",function(){return t.setTimeout(function(){return t.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},i.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},i.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},i.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Xv(this,function(){var e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)},i.onDurationChange=function(e){this.duration_=this.duration()},i.buffered=function(){return __(0,0)},i.bufferedPercent=function(){return b_(this.buffered(),this.duration_)},i.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},i.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},i.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},i.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},i.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},i.dispose=function(){this.clearTracks(tb.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),e.prototype.dispose.call(this)},i.clearTracks=function(e){var t=this;(e=[].concat(e)).forEach(function(e){for(var i=t[e+"Tracks"]()||[],n=i.length;n--;){var r=i[n];"text"===e&&t.removeRemoteTextTrack(r),i.removeTrack(r)}})},i.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;){var i=e[t];this.removeRemoteTextTrack(i)}},i.reset=function(){},i.crossOrigin=function(){},i.setCrossOrigin=function(){},i.error=function(e){return void 0!==e&&(this.error_=new T_(e),this.trigger("error")),this.error_},i.played=function(){return this.hasStarted_?__(0,0):__()},i.play=function(){},i.setScrubbing=function(){},i.scrubbing=function(){},i.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},i.initTrackListeners=function(){var e=this;tb.names.forEach(function(t){var i=tb[t],n=function(){e.trigger(t+"trackchange")},r=e[i.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),e.on("dispose",function(){r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)})})},i.addWebVttScript_=function(){var e=this;if(!N.WebVTT)if(z.body.contains(this.el())){if(!this.options_["vtt.js"]&&by(ge)&&Object.keys(ge).length>0)return void this.trigger("vttjsloaded");var t=z.createElement("script");t.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",t.onload=function(){e.trigger("vttjsloaded")},t.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){t.onload=null,t.onerror=null}),N.WebVTT=!0,this.el().parentNode.appendChild(t)}else this.ready(this.addWebVttScript_)},i.emulateTextTracks=function(){var e=this,t=this.textTracks(),i=this.remoteTextTracks(),n=function(e){return t.addTrack(e.track)},r=function(e){return t.removeTrack(e.track)};i.on("addtrack",n),i.on("removetrack",r),this.addWebVttScript_();var s=function(){return e.trigger("texttrackchange")},a=function(){s();for(var e=0;e<t.length;e++){var i=t[e];i.removeEventListener("cuechange",s),"showing"===i.mode&&i.addEventListener("cuechange",s)}};a(),t.addEventListener("change",a),t.addEventListener("addtrack",a),t.addEventListener("removetrack",a),this.on("dispose",function(){i.off("addtrack",n),i.off("removetrack",r),t.removeEventListener("change",a),t.removeEventListener("addtrack",a),t.removeEventListener("removetrack",a);for(var e=0;e<t.length;e++){t[e].removeEventListener("cuechange",s)}})},i.addTextTrack=function(e,t,i){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,i,n,r){void 0===r&&(r={});var s=e.textTracks();r.kind=t,i&&(r.label=i),n&&(r.language=n),r.tech=e;var a=new nb.text.TrackClass(r);return s.addTrack(a),a}(this,e,t,i)},i.createRemoteTextTrack=function(e){var t=h_(e,{tech:this});return new ib.remoteTextEl.TrackClass(t)},i.addRemoteTextTrack=function(e,t){var i=this;void 0===e&&(e={});var n=this.createRemoteTextTrack(e);return!0!==t&&!1!==t&&(py.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),t=!0),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!0!==t&&this.ready(function(){return i.autoRemoteTextTracks_.addTrack(n.track)}),n},i.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},i.getVideoPlaybackQuality=function(){return{}},i.requestPictureInPicture=function(){var e=this.options_.Promise||N.Promise;if(e)return e.reject()},i.disablePictureInPicture=function(){return!0},i.setDisablePictureInPicture=function(){},i.requestVideoFrameCallback=function(e){var t=this,i=Dv();return!this.isReady_||this.paused()?(this.queuedHanders_.add(i),this.one("playing",function(){t.queuedHanders_.has(i)&&(t.queuedHanders_.delete(i),e())})):this.requestNamedAnimationFrame(i,e),i},i.cancelVideoFrameCallback=function(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)},i.setPoster=function(){},i.playsinline=function(){},i.setPlaysinline=function(){},i.overrideNativeAudioTracks=function(){},i.overrideNativeVideoTracks=function(){},i.canPlayType=function(){return""},t.canPlayType=function(){return""},t.canPlaySource=function(e,i){return t.canPlayType(e.type)},t.isTech=function(e){return e.prototype instanceof t||e instanceof t||e===t},t.registerTech=function(e,i){if(t.techs_||(t.techs_={}),!t.isTech(i))throw new Error("Tech "+e+" must be a Tech");if(!t.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!t.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=c_(e),t.techs_[e]=i,t.techs_[u_(e)]=i,"Tech"!==e&&t.defaultTechOrder_.push(e),i},t.getTech=function(e){if(e)return t.techs_&&t.techs_[e]?t.techs_[e]:(e=c_(e),N&&N.videojs&&N.videojs[e]?(py.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),N.videojs[e]):void 0)},t}(g_);nb.names.forEach(function(e){var t=nb[e];rb.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),rb.prototype.featuresVolumeControl=!0,rb.prototype.featuresMuteControl=!0,rb.prototype.featuresFullscreenResize=!1,rb.prototype.featuresPlaybackRate=!1,rb.prototype.featuresProgressEvents=!1,rb.prototype.featuresSourceset=!1,rb.prototype.featuresTimeupdateEvents=!1,rb.prototype.featuresNativeTextTracks=!1,rb.prototype.featuresVideoFrameCallback=!1,rb.withSourceHandlers=function(e){e.registerSourceHandler=function(t,i){var n=e.sourceHandlers;n||(n=e.sourceHandlers=[]),void 0===i&&(i=n.length),n.splice(i,0,t)},e.canPlayType=function(t){for(var i,n=e.sourceHandlers||[],r=0;r<n.length;r++)if(i=n[r].canPlayType(t))return i;return""},e.selectSourceHandler=function(t,i){for(var n=e.sourceHandlers||[],r=0;r<n.length;r++)if(n[r].canHandleSource(t,i))return n[r];return null},e.canPlaySource=function(t,i){var n=e.selectSourceHandler(t,i);return n?n.canHandleSource(t,i):""};["seekable","seeking","duration"].forEach(function(e){var t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){var i=e.selectSourceHandler(t,this.options_);i||(e.nativeSourceHandler?i=e.nativeSourceHandler:py.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),i!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=i.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},g_.registerComponent("Tech",rb),rb.registerTech("Tech",rb),rb.defaultTechOrder_=[];var sb={},ab={},ob={};function lb(e,t,i){e.setTimeout(function(){return fb(t,sb[t.type],i,e)},1)}function ub(e,t,i,n){void 0===n&&(n=null);var r="call"+c_(i),s=e.reduce(pb(r),n),a=s===ob,o=a?null:t[i](s);return function(e,t,i,n){for(var r=e.length-1;r>=0;r--){var s=e[r];s[t]&&s[t](n,i)}}(e,i,o,a),o}var cb={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},hb={setCurrentTime:1,setMuted:1,setVolume:1},db={play:1,pause:1};function pb(e){return function(t,i){return t===ob?ob:i[e]?i[e](t):t}}function fb(e,t,i,n,r,s){void 0===e&&(e={}),void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===s&&(s=!1);var a=t,o=a[0],l=a.slice(1);if("string"==typeof o)fb(e,sb[o],i,n,r,s);else if(o){var u=function(e,t){var i=ab[e.id()],n=null;if(null==i)return n=t(e),ab[e.id()]=[[t,n]],n;for(var r=0;r<i.length;r++){var s=i[r],a=s[0],o=s[1];a===t&&(n=o)}return null===n&&(n=t(e),i.push([t,n])),n}(n,o);if(!u.setSource)return r.push(u),fb(e,l,i,n,r,s);u.setSource(vy({},e),function(t,a){if(t)return fb(e,l,i,n,r,s);r.push(u),fb(a,e.type===a.type?l:sb[a.type],i,n,r,s)})}else l.length?fb(e,l,i,n,r,s):s?i(e,r):fb(e,sb["*"],i,n,r,!0)}var mb={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},gb=function(e){void 0===e&&(e="");var t=W_(e);return mb[t.toLowerCase()]||""},yb=function e(t){if(Array.isArray(t)){var i=[];t.forEach(function(t){t=e(t),Array.isArray(t)?i=i.concat(t):_y(t)&&i.push(t)}),t=i}else t="string"==typeof t&&t.trim()?[vb({src:t})]:_y(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[vb(t)]:[];return t};function vb(e){if(!e.type){var t=gb(e.src);t&&(e.type=t)}return e}var _b=function(e){function t(t,i,n){var r,s=h_({createEl:!1},i);if(r=e.call(this,t,s,n)||this,i.playerOptions.sources&&0!==i.playerOptions.sources.length)t.src(i.playerOptions.sources);else for(var a=0,o=i.playerOptions.techOrder;a<o.length;a++){var l=c_(o[a]),u=rb.getTech(l);if(l||(u=g_.getComponent(l)),u&&u.isSupported()){t.loadTech_(l);break}}return r}return Ef(t,e),t}(g_);g_.registerComponent("MediaLoader",_b);var bb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).options_.controlText&&n.controlText(n.options_.controlText),n.handleMouseOver_=function(e){return n.handleMouseOver(e)},n.handleMouseOut_=function(e){return n.handleMouseOut(e)},n.handleClick_=function(e){return n.handleClick(e)},n.handleKeyDown_=function(e){return n.handleKeyDown(e)},n.emitTapEvents(),n.enable(),n}Ef(t,e);var i=t.prototype;return i.createEl=function(e,t,i){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===i&&(i={}),t=vy({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&py.error("Creating a ClickableComponent with an HTML element of "+e+" is not supported; use a Button instead."),i=vy({role:"button"},i),this.tabIndex_=t.tabIndex;var n=Zy(e,t,i);return n.appendChild(Zy("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(n),n},i.dispose=function(){this.controlTextEl_=null,e.prototype.dispose.call(this)},i.createControlTextEl=function(e){return this.controlTextEl_=Zy("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},i.controlText=function(e,t){if(void 0===t&&(t=this.el()),void 0===e)return this.controlText_||"Need Text";var i=this.localize(e);this.controlText_=e,Jy(this.controlTextEl_,i),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",i)},i.buildCSSClass=function(){return"vjs-control vjs-button "+e.prototype.buildCSSClass.call(this)},i.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},i.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},i.handleLanguagechange=function(){this.controlText(this.controlText_)},i.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},i.handleKeyDown=function(t){wf.isEventKey(t,"Space")||wf.isEventKey(t,"Enter")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(g_);g_.registerComponent("ClickableComponent",bb);var Tb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update(),n.update_=function(e){return n.update(e)},t.on("posterchange",n.update_),n}Ef(t,e);var i=t.prototype;return i.dispose=function(){this.player().off("posterchange",this.update_),e.prototype.dispose.call(this)},i.createEl=function(){return Zy("div",{className:"vjs-poster",tabIndex:-1})},i.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},i.setSrc=function(e){var t="";e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t},i.handleClick=function(e){if(this.player_.controls()){var t=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;!this.player_.tech(!0)||(Fy||Oy)&&t||this.player_.tech(!0).focus(),this.player_.paused()?x_(this.player_.play()):this.player_.pause()}},t}(bb);g_.registerComponent("PosterImage",Tb);var Sb="#222",wb={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function xb(e,t){var i;if(4===e.length)i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");i=e.slice(1)}return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+t+")"}function Ab(e,t,i){try{e.style[t]=i}catch(n){return}}var Eb=function(e){function t(t,i,n){var r;r=e.call(this,t,i,n)||this;var s=function(e){return r.updateDisplay(e)};return t.on("loadstart",function(e){return r.toggleDisplay(e)}),t.on("texttrackchange",s),t.on("loadedmetadata",function(e){return r.preselectTrack(e)}),t.ready(Xv(xf(r),function(){if(t.tech_&&t.tech_.featuresNativeTextTracks)this.hide();else{t.on("fullscreenchange",s),t.on("playerresize",s),N.addEventListener("orientationchange",s),t.on("dispose",function(){return N.removeEventListener("orientationchange",s)});for(var e=this.options_.playerOptions.tracks||[],i=0;i<e.length;i++)this.player_.addRemoteTextTrack(e[i],!0);this.preselectTrack()}})),r}Ef(t,e);var i=t.prototype;return i.preselectTrack=function(){for(var e,t,i,n={captions:1,subtitles:1},r=this.player_.textTracks(),s=this.player_.cache_.selectedLanguage,a=0;a<r.length;a++){var o=r[a];s&&s.enabled&&s.language&&s.language===o.language&&o.kind in n?o.kind===s.kind?i=o:i||(i=o):s&&!s.enabled?(i=null,e=null,t=null):o.default&&("descriptions"!==o.kind||e?o.kind in n&&!t&&(t=o):e=o)}i?i.mode="showing":t?t.mode="showing":e&&(e.mode="showing")},i.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},i.clearDisplay=function(){"function"==typeof N.WebVTT&&N.WebVTT.processCues(N,[],this.el_)},i.updateDisplay=function(){var e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){for(var i=[],n=0;n<e.length;++n){var r=e[n];"showing"===r.mode&&i.push(r)}this.updateForTrack(i)}else{for(var s=null,a=null,o=e.length;o--;){var l=e[o];"showing"===l.mode&&("descriptions"===l.kind?s=l:a=l)}a?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(a)):s&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(s))}},i.updateDisplayState=function(e){for(var t=this.player_.textTrackSettings.getValues(),i=e.activeCues,n=i.length;n--;){var r=i[n];if(r){var s=r.displayState;if(t.color&&(s.firstChild.style.color=t.color),t.textOpacity&&Ab(s.firstChild,"color",xb(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(s.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Ab(s.firstChild,"backgroundColor",xb(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Ab(s,"backgroundColor",xb(t.windowColor,t.windowOpacity)):s.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?s.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px "+Sb:"raised"===t.edgeStyle?s.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px "+Sb:"depressed"===t.edgeStyle?s.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px "+Sb:"uniform"===t.edgeStyle&&(s.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px "+Sb)),t.fontPercent&&1!==t.fontPercent){var a=N.parseFloat(s.style.fontSize);s.style.fontSize=a*t.fontPercent+"px",s.style.height="auto",s.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?s.firstChild.style.fontVariant="small-caps":s.firstChild.style.fontFamily=wb[t.fontFamily])}}},i.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),"function"==typeof N.WebVTT&&!e.every(function(e){return!e.activeCues})){for(var t=[],i=0;i<e.length;++i)for(var n=e[i],r=0;r<n.activeCues.length;++r)t.push(n.activeCues[r]);N.WebVTT.processCues(N,t,this.el_);for(var s=0;s<e.length;++s){for(var a=e[s],o=0;o<a.activeCues.length;++o){var l=a.activeCues[o].displayState;iv(l,"vjs-text-track-cue"),iv(l,"vjs-text-track-cue-"+(a.language?a.language:s)),a.language&&lv(l,"lang",a.language)}this.player_.textTrackSettings&&this.updateDisplayState(a)}}},t}(g_);g_.registerComponent("TextTrackDisplay",Eb);var Cb=function(e){function t(){return e.apply(this,arguments)||this}return Ef(t,e),t.prototype.createEl=function(){var t=this.player_.isAudio(),i=this.localize(t?"Audio Player":"Video Player"),n=Zy("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[i])}),r=e.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r},t}(g_);g_.registerComponent("LoadingSpinner",Cb);var Mb=function(e){function t(){return e.apply(this,arguments)||this}Ef(t,e);var i=t.prototype;return i.createEl=function(e,t,i){void 0===t&&(t={}),void 0===i&&(i={});var n=Zy("button",t=vy({className:this.buildCSSClass()},t),i=vy({type:"button"},i));return n.appendChild(Zy("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(n),n},i.addChild=function(e,t){void 0===t&&(t={});var i=this.constructor.name;return py.warn("Adding an actionable (user controllable) child to a Button ("+i+") is not supported; use a ClickableComponent instead."),g_.prototype.addChild.call(this,e,t)},i.enable=function(){e.prototype.enable.call(this),this.el_.removeAttribute("disabled")},i.disable=function(){e.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},i.handleKeyDown=function(t){wf.isEventKey(t,"Space")||wf.isEventKey(t,"Enter")?t.stopPropagation():e.prototype.handleKeyDown.call(this,t)},t}(bb);g_.registerComponent("Button",Mb);var kb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).mouseused_=!1,n.on("mousedown",function(e){return n.handleMouseDown(e)}),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-big-play-button"},i.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var i=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;return x_(t),void(!this.player_.tech(!0)||(Fy||Oy)&&i||this.player_.tech(!0).focus())}var n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(r){var s=function(){return r.focus()};w_(t)?t.then(s,function(){}):this.setTimeout(s,1)}else this.player_.tech(!0).focus()},i.handleKeyDown=function(t){this.mouseused_=!1,e.prototype.handleKeyDown.call(this,t)},i.handleMouseDown=function(e){this.mouseused_=!0},t}(Mb);kb.prototype.controlText_="Play Video",g_.registerComponent("BigPlayButton",kb);var Ib=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).controlText(i&&i.controlText||n.localize("Close")),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-close-button "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},i.handleKeyDown=function(t){wf.isEventKey(t,"Esc")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(Mb);g_.registerComponent("CloseButton",Ib);var Pb=function(e){function t(t,i){var n;return void 0===i&&(i={}),n=e.call(this,t,i)||this,i.replay=void 0===i.replay||i.replay,n.on(t,"play",function(e){return n.handlePlay(e)}),n.on(t,"pause",function(e){return n.handlePause(e)}),i.replay&&n.on(t,"ended",function(e){return n.handleEnded(e)}),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(e){this.player_.paused()?x_(this.player_.play()):this.player_.pause()},i.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},i.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},i.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},i.handleEnded=function(e){var t=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(e){return t.handleSeeked(e)})},t}(Mb);Pb.prototype.controlText_="Play",g_.registerComponent("PlayToggle",Pb);var Lb=function(e,t){e=e<0?0:e;var i=Math.floor(e%60),n=Math.floor(e/60%60),r=Math.floor(e/3600),s=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=n=i="-"),(r=r>0||a>0?r+":":"")+(n=((r||s>=10)&&n<10?"0"+n:n)+":")+(i=i<10?"0"+i:i)},Db=Lb;function Ob(e,t){return void 0===t&&(t=e),Db(e,t)}var Rb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,["timeupdate","ended"],function(e){return n.updateContent(e)}),n.updateTextNode_(),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){var t=this.buildCSSClass(),i=e.prototype.createEl.call(this,"div",{className:t+" vjs-time-control vjs-control"}),n=Zy("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+""},{role:"presentation"});return i.appendChild(n),this.contentEl_=Zy("span",{className:t+"-display"},{"aria-live":"off",role:"presentation"}),i.appendChild(this.contentEl_),i},i.dispose=function(){this.contentEl_=null,this.textNode_=null,e.prototype.dispose.call(this)},i.updateTextNode_=function(e){var t=this;void 0===e&&(e=0),e=Ob(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(t.contentEl_){var e=t.textNode_;e&&t.contentEl_.firstChild!==e&&(e=null,py.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),t.textNode_=z.createTextNode(t.formattedTime_),t.textNode_&&(e?t.contentEl_.replaceChild(t.textNode_,e):t.contentEl_.appendChild(t.textNode_))}}))},i.updateContent=function(e){},t}(g_);Rb.prototype.labelText_="Time",Rb.prototype.controlText_="Time",g_.registerComponent("TimeDisplay",Rb);var Nb=function(e){function t(){return e.apply(this,arguments)||this}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-current-time"},i.updateContent=function(e){var t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)},t}(Rb);Nb.prototype.labelText_="Current Time",Nb.prototype.controlText_="Current Time",g_.registerComponent("CurrentTimeDisplay",Nb);var Fb=function(e){function t(t,i){var n,r=function(e){return n.updateContent(e)};return(n=e.call(this,t,i)||this).on(t,"durationchange",r),n.on(t,"loadstart",r),n.on(t,"loadedmetadata",r),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-duration"},i.updateContent=function(e){var t=this.player_.duration();this.updateTextNode_(t)},t}(Rb);Fb.prototype.labelText_="Duration",Fb.prototype.controlText_="Duration",g_.registerComponent("DurationDisplay",Fb);var Ub=function(e){function t(){return e.apply(this,arguments)||this}return Ef(t,e),t.prototype.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),i=e.prototype.createEl.call(this,"div"),n=e.prototype.createEl.call(this,"span",{textContent:"/"});return i.appendChild(n),t.appendChild(i),t},t}(g_);g_.registerComponent("TimeDivider",Ub);var Bb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,"durationchange",function(e){return n.updateContent(e)}),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-remaining-time"},i.createEl=function(){var t=e.prototype.createEl.call(this);return!1!==this.options_.displayNegative&&t.insertBefore(Zy("span",{},{"aria-hidden":!0},"-"),this.contentEl_),t},i.updateContent=function(e){var t;"number"==typeof this.player_.duration()&&(t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t))},t}(Rb);Bb.prototype.labelText_="Remaining Time",Bb.prototype.controlText_="Remaining Time",g_.registerComponent("RemainingTimeDisplay",Bb);var jb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).updateShowing(),n.on(n.player(),"durationchange",function(e){return n.updateShowing(e)}),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Zy("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Zy("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+""})),this.contentEl_.appendChild(z.createTextNode(this.localize("LIVE"))),t.appendChild(this.contentEl_),t},i.dispose=function(){this.contentEl_=null,e.prototype.dispose.call(this)},i.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},t}(g_);g_.registerComponent("LiveDisplay",jb);var zb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).updateLiveEdgeStatus(),n.player_.liveTracker&&(n.updateLiveEdgeStatusHandler_=function(e){return n.updateLiveEdgeStatus(e)},n.on(n.player_.liveTracker,"liveedgechange",n.updateLiveEdgeStatusHandler_)),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Zy("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),t.appendChild(this.textEl_),t},i.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},i.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},i.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,e.prototype.dispose.call(this)},t}(Mb);zb.prototype.controlText_="Seek to live, currently playing live",g_.registerComponent("SeekToLive",zb);var Vb=function(e,t,i){return e=Number(e),Math.min(i,Math.max(t,isNaN(e)?t:e))},Hb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).handleMouseDown_=function(e){return n.handleMouseDown(e)},n.handleMouseUp_=function(e){return n.handleMouseUp(e)},n.handleKeyDown_=function(e){return n.handleKeyDown(e)},n.handleClick_=function(e){return n.handleClick(e)},n.handleMouseMove_=function(e){return n.handleMouseMove(e)},n.update_=function(e){return n.update(e)},n.bar=n.getChild(n.options_.barName),n.vertical(!!n.options_.vertical),n.enable(),n}Ef(t,e);var i=t.prototype;return i.enabled=function(){return this.enabled_},i.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},i.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},i.createEl=function(t,i,n){return void 0===i&&(i={}),void 0===n&&(n={}),i.className=i.className+" vjs-slider",i=vy({tabIndex:0},i),n=vy({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},n),e.prototype.createEl.call(this,t,i,n)},i.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||Ry||e.preventDefault(),cv(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)},i.handleMouseMove=function(e){},i.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;hv(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.update()},i.update=function(){var e=this;if(this.el_&&this.bar){var t=this.getProgress();return t===this.progress_||(this.progress_=t,this.requestNamedAnimationFrame("Slider#update",function(){var i=e.vertical()?"height":"width";e.bar.el().style[i]=(100*t).toFixed(2)+"%"})),t}},i.getProgress=function(){return Number(Vb(this.getPercent(),0,1).toFixed(4))},i.calculateDistance=function(e){var t=fv(this.el_,e);return this.vertical()?t.y:t.x},i.handleKeyDown=function(t){wf.isEventKey(t,"Left")||wf.isEventKey(t,"Down")?(t.preventDefault(),t.stopPropagation(),this.stepBack()):wf.isEventKey(t,"Right")||wf.isEventKey(t,"Up")?(t.preventDefault(),t.stopPropagation(),this.stepForward()):e.prototype.handleKeyDown.call(this,t)},i.handleClick=function(e){e.stopPropagation(),e.preventDefault()},i.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},t}(g_);g_.registerComponent("Slider",Hb);var qb=function(e,t){return Vb(e/t*100,0,100).toFixed(2)+"%"},Gb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).partEls_=[],n.on(t,"progress",function(e){return n.update(e)}),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),i=Zy("span",{className:"vjs-control-text"}),n=Zy("span",{textContent:this.localize("Loaded")}),r=z.createTextNode(": ");return this.percentageEl_=Zy("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),t.appendChild(i),i.appendChild(n),i.appendChild(r),i.appendChild(this.percentageEl_),t},i.dispose=function(){this.partEls_=null,this.percentageEl_=null,e.prototype.dispose.call(this)},i.update=function(e){var t=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var e=t.player_.liveTracker,i=t.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():t.player_.duration(),r=t.player_.bufferedEnd(),s=t.partEls_,a=qb(r,n);t.percent_!==a&&(t.el_.style.width=a,Jy(t.percentageEl_,a),t.percent_=a);for(var o=0;o<i.length;o++){var l=i.start(o),u=i.end(o),c=s[o];c||(c=t.el_.appendChild(Zy()),s[o]=c),c.dataset.start===l&&c.dataset.end===u||(c.dataset.start=l,c.dataset.end=u,c.style.left=qb(l,r),c.style.width=qb(u-l,r))}for(var h=s.length;h>i.length;h--)t.el_.removeChild(s[h-1]);s.length=i.length})},t}(g_);g_.registerComponent("LoadProgressBar",Gb);var Wb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update=Yv(Xv(xf(n),n.update),$v),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},i.update=function(e,t,i){var n=pv(this.el_),r=dv(this.player_.el()),s=e.width*t;if(r&&n){var a=e.left-r.left+s,o=e.width-s+(r.right-e.right),l=n.width/2;a<l?l+=l-a:o<l&&(l=o),l<0?l=0:l>n.width&&(l=n.width),l=Math.round(l),this.el_.style.right="-"+l+"px",this.write(i)}},i.write=function(e){Jy(this.el_,e)},i.updateTime=function(e,t,i,n){var r=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var s,a=r.player_.duration();if(r.player_.liveTracker&&r.player_.liveTracker.isLive()){var o=r.player_.liveTracker.liveWindow(),l=o-t*o;s=(l<1?"":"-")+Ob(l,o)}else s=Ob(i,a);r.update(e,t,s),n&&n()})},t}(g_);g_.registerComponent("TimeTooltip",Wb);var $b=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update=Yv(Xv(xf(n),n.update),$v),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},i.update=function(e,t){var i=this.getChild("timeTooltip");if(i){var n=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();i.updateTime(e,t,n)}},t}(g_);$b.prototype.options_={children:[]},Hy||Iy||$b.prototype.options_.children.push("timeTooltip"),g_.registerComponent("PlayProgressBar",$b);var Xb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update=Yv(Xv(xf(n),n.update),$v),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},i.update=function(e,t){var i=this,n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,function(){i.el_.style.left=e.width*t+"px"})},t}(g_);Xb.prototype.options_={children:["timeTooltip"]},g_.registerComponent("MouseTimeDisplay",Xb);var Yb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).setEventHandlers_(),n}Ef(t,e);var i=t.prototype;return i.setEventHandlers_=function(){var e=this;this.update_=Xv(this,this.update),this.update=Yv(this.update_,$v),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(t){return e.enableInterval_(t)},this.disableIntervalHandler_=function(t){return e.disableInterval_(t)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in z&&"visibilityState"in z&&this.on(z,"visibilitychange",this.toggleVisibility_)},i.toggleVisibility_=function(e){"hidden"===z.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())},i.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,$v))},i.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},i.update=function(t){var i=this;if("hidden"!==z.visibilityState){var n=e.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var e=i.player_.ended()?i.player_.duration():i.getCurrentTime_(),t=i.player_.liveTracker,r=i.player_.duration();t&&t.isLive()&&(r=i.player_.liveTracker.liveCurrentTime()),i.percent_!==n&&(i.el_.setAttribute("aria-valuenow",(100*n).toFixed(2)),i.percent_=n),i.currentTime_===e&&i.duration_===r||(i.el_.setAttribute("aria-valuetext",i.localize("progress bar timing: currentTime={1} duration={2}",[Ob(e,r),Ob(r,r)],"{1} of {2}")),i.currentTime_=e,i.duration_=r),i.bar&&i.bar.update(dv(i.el()),i.getProgress())}),n}},i.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},i.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},i.getPercent=function(){var e,t=this.getCurrentTime_(),i=this.player_.liveTracker;return i&&i.isLive()?(e=(t-i.seekableStart())/i.liveWindow(),i.atLiveEdge()&&(e=1)):e=t/this.player_.duration(),e},i.handleMouseDown=function(t){bv(t)&&(t.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),e.prototype.handleMouseDown.call(this,t))},i.handleMouseMove=function(e,t){if(void 0===t&&(t=!1),bv(e)){var i;t||this.player_.scrubbing()||this.player_.scrubbing(!0);var n=this.calculateDistance(e),r=this.player_.liveTracker;if(r&&r.isLive()){if(n>=.99)return void r.seekToLiveEdge();var s=r.seekableStart(),a=r.liveCurrentTime();if((i=s+n*r.liveWindow())>=a&&(i=a),i<=s&&(i=s+.1),i===1/0)return}else(i=n*this.player_.duration())===this.player_.duration()&&(i-=.1);this.userSeek_(i)}},i.enable=function(){e.prototype.enable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.show()},i.disable=function(){e.prototype.disable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.hide()},i.handleMouseUp=function(t){e.prototype.handleMouseUp.call(this,t),t&&t.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?x_(this.player_.play()):this.update_()},i.stepForward=function(){this.userSeek_(this.player_.currentTime()+5)},i.stepBack=function(){this.userSeek_(this.player_.currentTime()-5)},i.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},i.handleKeyDown=function(t){var i=this.player_.liveTracker;if(wf.isEventKey(t,"Space")||wf.isEventKey(t,"Enter"))t.preventDefault(),t.stopPropagation(),this.handleAction(t);else if(wf.isEventKey(t,"Home"))t.preventDefault(),t.stopPropagation(),this.userSeek_(0);else if(wf.isEventKey(t,"End"))t.preventDefault(),t.stopPropagation(),i&&i.isLive()?this.userSeek_(i.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(wf(t))){t.preventDefault(),t.stopPropagation();var n=10*(wf.codes[wf(t)]-wf.codes[0])/100;i&&i.isLive()?this.userSeek_(i.seekableStart()+i.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else wf.isEventKey(t,"PgDn")?(t.preventDefault(),t.stopPropagation(),this.userSeek_(this.player_.currentTime()-60)):wf.isEventKey(t,"PgUp")?(t.preventDefault(),t.stopPropagation(),this.userSeek_(this.player_.currentTime()+60)):e.prototype.handleKeyDown.call(this,t)},i.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in z&&"visibilityState"in z&&this.off(z,"visibilitychange",this.toggleVisibility_),e.prototype.dispose.call(this)},t}(Hb);Yb.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},Hy||Iy||Yb.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),g_.registerComponent("SeekBar",Yb);var Qb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).handleMouseMove=Yv(Xv(xf(n),n.handleMouseMove),$v),n.throttledHandleMouseSeek=Yv(Xv(xf(n),n.handleMouseSeek),$v),n.handleMouseUpHandler_=function(e){return n.handleMouseUp(e)},n.handleMouseDownHandler_=function(e){return n.handleMouseDown(e)},n.enable(),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},i.handleMouseMove=function(e){var t=this.getChild("seekBar");if(t){var i=t.getChild("playProgressBar"),n=t.getChild("mouseTimeDisplay");if(i||n){var r=t.el(),s=pv(r),a=fv(r,e).x;a=Vb(a,0,1),n&&n.update(s,a),i&&i.update(s,t.getProgress())}}},i.handleMouseSeek=function(e){var t=this.getChild("seekBar");t&&t.handleMouseMove(e)},i.enabled=function(){return this.enabled_},i.disable=function(){if(this.children().forEach(function(e){return e.disable&&e.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&x_(this.player_.play())}},i.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},i.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)},i.handleMouseDown=function(e){var t=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseUp=function(e){var t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},t}(g_);Qb.prototype.options_={children:["seekBar"]},g_.registerComponent("ProgressControl",Qb);var Kb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,["enterpictureinpicture","leavepictureinpicture"],function(e){return n.handlePictureInPictureChange(e)}),n.on(t,["disablepictureinpicturechanged","loadedmetadata"],function(e){return n.handlePictureInPictureEnabledChange(e)}),n.on(t,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){"audio"===t.currentType().substring(0,5)||t.audioPosterMode()||t.audioOnlyMode()?(t.isInPictureInPicture()&&t.exitPictureInPicture(),n.hide()):n.show()}),n.disable(),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-picture-in-picture-control "+e.prototype.buildCSSClass.call(this)},i.handlePictureInPictureEnabledChange=function(){z.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},i.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},i.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},t}(Mb);Kb.prototype.controlText_="Picture-in-Picture",g_.registerComponent("PictureInPictureToggle",Kb);var Zb=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,"fullscreenchange",function(e){return n.handleFullscreenChange(e)}),!1===z[t.fsApi_.fullscreenEnabled]&&n.disable(),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-fullscreen-control "+e.prototype.buildCSSClass.call(this)},i.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},i.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},t}(Mb);Zb.prototype.controlText_="Fullscreen",g_.registerComponent("FullscreenToggle",Zb);var Jb=function(e){function t(){return e.apply(this,arguments)||this}return Ef(t,e),t.prototype.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return t.appendChild(e.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),t},t}(g_);g_.registerComponent("VolumeLevel",Jb);var eT=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update=Yv(Xv(xf(n),n.update),$v),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},i.update=function(e,t,i,n){if(!i){var r=dv(this.el_),s=dv(this.player_.el()),a=e.width*t;if(!s||!r)return;var o=e.left-s.left+a,l=e.width-a+(s.right-e.right),u=r.width/2;o<u?u+=u-o:l<u&&(u=l),u<0?u=0:u>r.width&&(u=r.width),this.el_.style.right="-"+u+"px"}this.write(n+"%")},i.write=function(e){Jy(this.el_,e)},i.updateVolume=function(e,t,i,n,r){var s=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){s.update(e,t,i,n.toFixed(0)),r&&r()})},t}(g_);g_.registerComponent("VolumeLevelTooltip",eT);var tT=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).update=Yv(Xv(xf(n),n.update),$v),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},i.update=function(e,t,i){var n=this,r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,i,r,function(){i?n.el_.style.bottom=e.height*t+"px":n.el_.style.left=e.width*t+"px"})},t}(g_);tT.prototype.options_={children:["volumeLevelTooltip"]},g_.registerComponent("MouseVolumeLevelDisplay",tT);var iT=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on("slideractive",function(e){return n.updateLastVolume_(e)}),n.on(t,"volumechange",function(e){return n.updateARIAAttributes(e)}),t.ready(function(){return n.updateARIAAttributes()}),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},i.handleMouseDown=function(t){bv(t)&&e.prototype.handleMouseDown.call(this,t)},i.handleMouseMove=function(e){var t=this.getChild("mouseVolumeLevelDisplay");if(t){var i=this.el(),n=dv(i),r=this.vertical(),s=fv(i,e);s=r?s.y:s.x,s=Vb(s,0,1),t.update(n,s,r)}bv(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},i.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},i.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},i.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},i.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},i.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")},i.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},i.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one("sliderinactive",function(){0===e.player_.volume()&&e.player_.lastVolume_(t)})},t}(Hb);iT.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},Hy||Iy||iT.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),iT.prototype.playerEvent="volumechange",g_.registerComponent("VolumeBar",iT);var nT=function(e){function t(t,i){var n;return void 0===i&&(i={}),i.vertical=i.vertical||!1,(void 0===i.volumeBar||by(i.volumeBar))&&(i.volumeBar=i.volumeBar||{},i.volumeBar.vertical=i.vertical),function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(xf(n=e.call(this,t,i)||this),t),n.throttledHandleMouseMove=Yv(Xv(xf(n),n.handleMouseMove),$v),n.handleMouseUpHandler_=function(e){return n.handleMouseUp(e)},n.on("mousedown",function(e){return n.handleMouseDown(e)}),n.on("touchstart",function(e){return n.handleMouseDown(e)}),n.on("mousemove",function(e){return n.handleMouseMove(e)}),n.on(n.volumeBar,["focus","slideractive"],function(){n.volumeBar.addClass("vjs-slider-active"),n.addClass("vjs-slider-active"),n.trigger("slideractive")}),n.on(n.volumeBar,["blur","sliderinactive"],function(){n.volumeBar.removeClass("vjs-slider-active"),n.removeClass("vjs-slider-active"),n.trigger("sliderinactive")}),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){var t="vjs-volume-horizontal";return this.options_.vertical&&(t="vjs-volume-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+t})},i.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},t}(g_);nT.prototype.options_={children:["volumeBar"]},g_.registerComponent("VolumeControl",nT);var rT=function(e){function t(t,i){var n;return function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})}(xf(n=e.call(this,t,i)||this),t),n.on(t,["loadstart","volumechange"],function(e){return n.update(e)}),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-mute-control "+e.prototype.buildCSSClass.call(this)},i.handleClick=function(e){var t=this.player_.volume(),i=this.player_.lastVolume_();if(0===t){var n=i<.1?.1:i;this.player_.volume(n),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},i.update=function(e){this.updateIcon_(),this.updateControlText_()},i.updateIcon_=function(){var e=this.player_.volume(),t=3;Hy&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var i=0;i<4;i++)nv(this.el_,"vjs-vol-"+i);iv(this.el_,"vjs-vol-"+t)},i.updateControlText_=function(){var e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)},t}(Mb);rT.prototype.controlText_="Mute",g_.registerComponent("MuteToggle",rT);var sT=function(e){function t(t,i){var n;return void 0===i&&(i={}),void 0!==i.inline?i.inline=i.inline:i.inline=!0,(void 0===i.volumeControl||by(i.volumeControl))&&(i.volumeControl=i.volumeControl||{},i.volumeControl.vertical=!i.inline),(n=e.call(this,t,i)||this).handleKeyPressHandler_=function(e){return n.handleKeyPress(e)},n.on(t,["loadstart"],function(e){return n.volumePanelState_(e)}),n.on(n.muteToggle,"keyup",function(e){return n.handleKeyPress(e)}),n.on(n.volumeControl,"keyup",function(e){return n.handleVolumeControlKeyUp(e)}),n.on("keydown",function(e){return n.handleKeyPress(e)}),n.on("mouseover",function(e){return n.handleMouseOver(e)}),n.on("mouseout",function(e){return n.handleMouseOut(e)}),n.on(n.volumeControl,["slideractive"],n.sliderActive_),n.on(n.volumeControl,["sliderinactive"],n.sliderInactive_),n}Ef(t,e);var i=t.prototype;return i.sliderActive_=function(){this.addClass("vjs-slider-active")},i.sliderInactive_=function(){this.removeClass("vjs-slider-active")},i.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},i.createEl=function(){var t="vjs-volume-panel-horizontal";return this.options_.inline||(t="vjs-volume-panel-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+t})},i.dispose=function(){this.handleMouseOut(),e.prototype.dispose.call(this)},i.handleVolumeControlKeyUp=function(e){wf.isEventKey(e,"Esc")&&this.muteToggle.focus()},i.handleMouseOver=function(e){this.addClass("vjs-hover"),jv(z,"keyup",this.handleKeyPressHandler_)},i.handleMouseOut=function(e){this.removeClass("vjs-hover"),zv(z,"keyup",this.handleKeyPressHandler_)},i.handleKeyPress=function(e){wf.isEventKey(e,"Esc")&&this.handleMouseOut()},t}(g_);sT.prototype.options_={children:["muteToggle","volumeControl"]},g_.registerComponent("VolumePanel",sT);var aT=function(e){function t(t,i){var n;return n=e.call(this,t,i)||this,i&&(n.menuButton_=i.menuButton),n.focusedChild_=-1,n.on("keydown",function(e){return n.handleKeyDown(e)}),n.boundHandleBlur_=function(e){return n.handleBlur(e)},n.boundHandleTapClick_=function(e){return n.handleTapClick(e)},n}Ef(t,e);var i=t.prototype;return i.addEventListenerForItem=function(e){e instanceof g_&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},i.removeEventListenerForItem=function(e){e instanceof g_&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},i.removeChild=function(t){"string"==typeof t&&(t=this.getChild(t)),this.removeEventListenerForItem(t),e.prototype.removeChild.call(this,t)},i.addItem=function(e){var t=this.addChild(e);t&&this.addEventListenerForItem(t)},i.createEl=function(){var t=this.options_.contentElType||"ul";this.contentEl_=Zy(t,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var i=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return i.appendChild(this.contentEl_),jv(i,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),i},i.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,e.prototype.dispose.call(this)},i.handleBlur=function(e){var t=e.relatedTarget||z.activeElement;if(!this.children().some(function(e){return e.el()===t})){var i=this.menuButton_;i&&i.buttonPressed_&&t!==i.el().firstChild&&i.unpressButton()}},i.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var t=this.children();if(!Array.isArray(t))return;var i=t.filter(function(t){return t.el()===e.target})[0];if(!i)return;"CaptionSettingsMenuItem"!==i.name()&&this.menuButton_.focus()}},i.handleKeyDown=function(e){wf.isEventKey(e,"Left")||wf.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(wf.isEventKey(e,"Right")||wf.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},i.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},i.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},i.focus=function(e){void 0===e&&(e=0);var t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())},t}(g_);g_.registerComponent("Menu",aT);var oT=function(e){function t(t,i){var n;void 0===i&&(i={}),(n=e.call(this,t,i)||this).menuButton_=new Mb(t,i),n.menuButton_.controlText(n.controlText_),n.menuButton_.el_.setAttribute("aria-haspopup","true");var r=Mb.prototype.buildCSSClass();n.menuButton_.el_.className=n.buildCSSClass()+" "+r,n.menuButton_.removeClass("vjs-control"),n.addChild(n.menuButton_),n.update(),n.enabled_=!0;var s=function(e){return n.handleClick(e)};return n.handleMenuKeyUp_=function(e){return n.handleMenuKeyUp(e)},n.on(n.menuButton_,"tap",s),n.on(n.menuButton_,"click",s),n.on(n.menuButton_,"keydown",function(e){return n.handleKeyDown(e)}),n.on(n.menuButton_,"mouseenter",function(){n.addClass("vjs-hover"),n.menu.show(),jv(z,"keyup",n.handleMenuKeyUp_)}),n.on("mouseleave",function(e){return n.handleMouseLeave(e)}),n.on("keydown",function(e){return n.handleSubmenuKeyDown(e)}),n}Ef(t,e);var i=t.prototype;return i.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},i.createMenu=function(){var e=new aT(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var t=Zy("li",{className:"vjs-menu-title",textContent:c_(this.options_.title),tabIndex:-1}),i=new g_(this.player_,{el:t});e.addItem(i)}if(this.items=this.createItems(),this.items)for(var n=0;n<this.items.length;n++)e.addItem(this.items[n]);return e},i.createItems=function(){},i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},i.buildWrapperCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+Mb.prototype.buildCSSClass()+" "+e.prototype.buildCSSClass.call(this)},i.buildCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+e.prototype.buildCSSClass.call(this)},i.controlText=function(e,t){return void 0===t&&(t=this.menuButton_.el()),this.menuButton_.controlText(e,t)},i.dispose=function(){this.handleMouseLeave(),e.prototype.dispose.call(this)},i.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},i.handleMouseLeave=function(e){this.removeClass("vjs-hover"),zv(z,"keyup",this.handleMenuKeyUp_)},i.focus=function(){this.menuButton_.focus()},i.blur=function(){this.menuButton_.blur()},i.handleKeyDown=function(e){wf.isEventKey(e,"Esc")||wf.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),wf.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(wf.isEventKey(e,"Up")||wf.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},i.handleMenuKeyUp=function(e){(wf.isEventKey(e,"Esc")||wf.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")},i.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},i.handleSubmenuKeyDown=function(e){(wf.isEventKey(e,"Esc")||wf.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),wf.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},i.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),Hy&&Qy())return;this.menu.focus()}},i.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},i.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},i.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},t}(g_);g_.registerComponent("MenuButton",oT);var lT=function(e){function t(t,i){var n,r=i.tracks;if((n=e.call(this,t,i)||this).items.length<=1&&n.hide(),!r)return xf(n);var s=Xv(xf(n),n.update);return r.addEventListener("removetrack",s),r.addEventListener("addtrack",s),r.addEventListener("labelchange",s),n.player_.on("ready",s),n.player_.on("dispose",function(){r.removeEventListener("removetrack",s),r.removeEventListener("addtrack",s),r.removeEventListener("labelchange",s)}),n}return Ef(t,e),t}(oT);g_.registerComponent("TrackButton",lT);var uT=["Tab","Esc","Up","Down","Right","Left"],cT=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).selectable=i.selectable,n.isSelected_=i.selected||!1,n.multiSelectable=i.multiSelectable,n.selected(n.isSelected_),n.selectable?n.multiSelectable?n.el_.setAttribute("role","menuitemcheckbox"):n.el_.setAttribute("role","menuitemradio"):n.el_.setAttribute("role","menuitem"),n}Ef(t,e);var i=t.prototype;return i.createEl=function(t,i,n){this.nonIconControl=!0;var r=e.prototype.createEl.call(this,"li",vy({className:"vjs-menu-item",tabIndex:-1},i),n);return r.replaceChild(Zy("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),r.querySelector(".vjs-icon-placeholder")),r},i.handleKeyDown=function(t){uT.some(function(e){return wf.isEventKey(t,e)})||e.prototype.handleKeyDown.call(this,t)},i.handleClick=function(e){this.selected(!0)},i.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},t}(bb);g_.registerComponent("MenuItem",cT);var hT=function(e){function t(t,i){var n,r=i.track,s=t.textTracks();i.label=r.label||r.language||"Unknown",i.selected="showing"===r.mode,(n=e.call(this,t,i)||this).track=r,n.kinds=(i.kinds||[i.kind||n.track.kind]).filter(Boolean);var a,o=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleTracksChange.apply(xf(n),t)},l=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleSelectedLanguageChange.apply(xf(n),t)};(t.on(["loadstart","texttrackchange"],o),s.addEventListener("change",o),s.addEventListener("selectedlanguagechange",l),n.on("dispose",function(){t.off(["loadstart","texttrackchange"],o),s.removeEventListener("change",o),s.removeEventListener("selectedlanguagechange",l)}),void 0===s.onchange)&&n.on(["tap","click"],function(){if("object"!=typeof N.Event)try{a=new N.Event("change")}catch(e){}a||(a=z.createEvent("Event")).initEvent("change",!0,!0),s.dispatchEvent(a)});return n.handleTracksChange(),n}Ef(t,e);var i=t.prototype;return i.handleClick=function(t){var i=this.track,n=this.player_.textTracks();if(e.prototype.handleClick.call(this,t),n)for(var r=0;r<n.length;r++){var s=n[r];-1!==this.kinds.indexOf(s.kind)&&(s===i?"showing"!==s.mode&&(s.mode="showing"):"disabled"!==s.mode&&(s.mode="disabled"))}},i.handleTracksChange=function(e){var t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)},i.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},i.dispose=function(){this.track=null,e.prototype.dispose.call(this)},t}(cT);g_.registerComponent("TextTrackMenuItem",hT);var dT=function(e){function t(t,i){return i.track={player:t,kind:i.kind,kinds:i.kinds,default:!1,mode:"disabled"},i.kinds||(i.kinds=[i.kind]),i.label?i.track.label=i.label:i.track.label=i.kinds.join(" and ")+" off",i.selectable=!0,i.multiSelectable=!1,e.call(this,t,i)||this}Ef(t,e);var i=t.prototype;return i.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!0,n=0,r=t.length;n<r;n++){var s=t[n];if(this.options_.kinds.indexOf(s.kind)>-1&&"showing"===s.mode){i=!1;break}}i!==this.isSelected_&&this.selected(i)},i.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),i=!0,n=0,r=t.length;n<r;n++){var s=t[n];if(["captions","descriptions","subtitles"].indexOf(s.kind)>-1&&"showing"===s.mode){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})},t}(hT);g_.registerComponent("OffTextTrackMenuItem",dT);var pT=function(e){function t(t,i){return void 0===i&&(i={}),i.tracks=t.textTracks(),e.call(this,t,i)||this}return Ef(t,e),t.prototype.createItems=function(e,t){var i;void 0===e&&(e=[]),void 0===t&&(t=hT),this.label_&&(i=this.label_+" off"),e.push(new dT(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;var n=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var r=0;r<n.length;r++){var s=n[r];if(this.kinds_.indexOf(s.kind)>-1){var a=new t(this.player_,{track:s,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});a.addClass("vjs-"+s.kind+"-menu-item"),e.push(a)}}return e},t}(lT);g_.registerComponent("TextTrackButton",pT);var fT=function(e){function t(t,i){var n,r=i.track,s=i.cue,a=t.currentTime();return i.selectable=!0,i.multiSelectable=!1,i.label=s.text,i.selected=s.startTime<=a&&a<s.endTime,(n=e.call(this,t,i)||this).track=r,n.cue=s,n}return Ef(t,e),t.prototype.handleClick=function(t){e.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},t}(cT);g_.registerComponent("ChaptersTrackMenuItem",fT);var mT=function(e){function t(t,i,n){var r;return(r=e.call(this,t,i,n)||this).selectCurrentItem_=function(){r.items.forEach(function(e){e.selected(r.track_.activeCues[0]===e.cue)})},r}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildWrapperCSSClass.call(this)},i.update=function(t){if(!t||!t.track||"chapters"===t.track.kind){var i=this.findChaptersTrack();i!==this.track_?(this.setTrack(i),e.prototype.update.call(this)):(!this.items||i&&i.cues&&i.cues.length!==this.items.length)&&e.prototype.update.call(this)}},i.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var i=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);i&&i.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},i.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;t>=0;t--){var i=e[t];if(i.kind===this.kind_)return i}},i.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(c_(this.kind_))},i.createMenu=function(){return this.options_.title=this.getMenuCaption(),e.prototype.createMenu.call(this)},i.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var i=0,n=t.length;i<n;i++){var r=t[i],s=new fT(this.player_,{track:this.track_,cue:r});e.push(s)}return e},t}(pT);mT.prototype.kind_="chapters",mT.prototype.controlText_="Chapters",g_.registerComponent("ChaptersButton",mT);var gT=function(e){function t(t,i,n){var r;r=e.call(this,t,i,n)||this;var s=t.textTracks(),a=Xv(xf(r),r.handleTracksChange);return s.addEventListener("change",a),r.on("dispose",function(){s.removeEventListener("change",a)}),r}Ef(t,e);var i=t.prototype;return i.handleTracksChange=function(e){for(var t=this.player().textTracks(),i=!1,n=0,r=t.length;n<r;n++){var s=t[n];if(s.kind!==this.kind_&&"showing"===s.mode){i=!0;break}}i?this.disable():this.enable()},i.buildCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(pT);gT.prototype.kind_="descriptions",gT.prototype.controlText_="Descriptions",g_.registerComponent("DescriptionsButton",gT);var yT=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(pT);yT.prototype.kind_="subtitles",yT.prototype.controlText_="Subtitles",g_.registerComponent("SubtitlesButton",yT);var vT=function(e){function t(t,i){var n;return i.track={player:t,kind:i.kind,label:i.kind+" settings",selectable:!1,default:!1,mode:"disabled"},i.selectable=!1,i.name="CaptionSettingsMenuItem",(n=e.call(this,t,i)||this).addClass("vjs-texttrack-settings"),n.controlText(", opens "+i.kind+" settings dialog"),n}return Ef(t,e),t.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},t}(hT);g_.registerComponent("CaptionSettingsMenuItem",vT);var _T=function(e){function t(t,i,n){return e.call(this,t,i,n)||this}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-captions-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-captions-button "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new vT(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),e.prototype.createItems.call(this,t)},t}(pT);_T.prototype.kind_="captions",_T.prototype.controlText_="Captions",g_.registerComponent("CaptionsButton",_T);var bT=function(e){function t(){return e.apply(this,arguments)||this}return Ef(t,e),t.prototype.createEl=function(t,i,n){var r=e.prototype.createEl.call(this,t,i,n),s=r.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(s.appendChild(Zy("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(Zy("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),r},t}(hT);g_.registerComponent("SubsCapsMenuItem",bT);var TT=function(e){function t(t,i){var n;return void 0===i&&(i={}),(n=e.call(this,t,i)||this).label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(n.player_.language_)>-1&&(n.label_="captions"),n.menuButton_.controlText(c_(n.label_)),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new vT(this.player_,{kind:this.label_})),this.hideThreshold_+=1),t=e.prototype.createItems.call(this,t,bT)},t}(pT);TT.prototype.kinds_=["captions","subtitles"],TT.prototype.controlText_="Subtitles",g_.registerComponent("SubsCapsButton",TT);var ST=function(e){function t(t,i){var n,r=i.track,s=t.audioTracks();i.label=r.label||r.language||"Unknown",i.selected=r.enabled,(n=e.call(this,t,i)||this).track=r,n.addClass("vjs-"+r.kind+"-menu-item");var a=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.handleTracksChange.apply(xf(n),t)};return s.addEventListener("change",a),n.on("dispose",function(){s.removeEventListener("change",a)}),n}Ef(t,e);var i=t.prototype;return i.createEl=function(t,i,n){var r=e.prototype.createEl.call(this,t,i,n),s=r.querySelector(".vjs-menu-item-text");return"main-desc"===this.options_.track.kind&&(s.appendChild(Zy("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(Zy("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),r},i.handleClick=function(t){if(e.prototype.handleClick.call(this,t),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var i=this.player_.audioTracks(),n=0;n<i.length;n++){var r=i[n];r!==this.track&&(r.enabled=r===this.track)}},i.handleTracksChange=function(e){this.selected(this.track.enabled)},t}(cT);g_.registerComponent("AudioTrackMenuItem",ST);var wT=function(e){function t(t,i){return void 0===i&&(i={}),i.tracks=t.audioTracks(),e.call(this,t,i)||this}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-audio-button "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-audio-button "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var t=this.player_.audioTracks(),i=0;i<t.length;i++){var n=t[i];e.push(new ST(this.player_,{track:n,selectable:!0,multiSelectable:!1}))}return e},t}(lT);wT.prototype.controlText_="Audio Track",g_.registerComponent("AudioTrackButton",wT);var xT=function(e){function t(t,i){var n,r=i.rate,s=parseFloat(r,10);return i.label=r,i.selected=s===t.playbackRate(),i.selectable=!0,i.multiSelectable=!1,(n=e.call(this,t,i)||this).label=r,n.rate=s,n.on(t,"ratechange",function(e){return n.update(e)}),n}Ef(t,e);var i=t.prototype;return i.handleClick=function(t){e.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},i.update=function(e){this.selected(this.player().playbackRate()===this.rate)},t}(cT);xT.prototype.contentElType="button",g_.registerComponent("PlaybackRateMenuItem",xT);var AT=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).menuButton_.el_.setAttribute("aria-describedby",n.labelElId_),n.updateVisibility(),n.updateLabel(),n.on(t,"loadstart",function(e){return n.updateVisibility(e)}),n.on(t,"ratechange",function(e){return n.updateLabel(e)}),n.on(t,"playbackrateschange",function(e){return n.handlePlaybackRateschange(e)}),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){var t=e.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Zy("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),t.appendChild(this.labelEl_),t},i.dispose=function(){this.labelEl_=null,e.prototype.dispose.call(this)},i.buildCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){for(var e=this.playbackRates(),t=[],i=e.length-1;i>=0;i--)t.push(new xT(this.player(),{rate:e[i]+"x"}));return t},i.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},i.handleClick=function(e){var t=this.player().playbackRate(),i=this.playbackRates(),n=(i.indexOf(t)+1)%i.length;this.player().playbackRate(i[n])},i.handlePlaybackRateschange=function(e){this.update()},i.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},i.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},i.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},i.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},t}(oT);AT.prototype.controlText_="Playback Rate",g_.registerComponent("PlaybackRateMenuButton",AT);var ET=function(e){function t(){return e.apply(this,arguments)||this}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-spacer "+e.prototype.buildCSSClass.call(this)},i.createEl=function(t,i,n){return void 0===t&&(t="div"),void 0===i&&(i={}),void 0===n&&(n={}),i.className||(i.className=this.buildCSSClass()),e.prototype.createEl.call(this,t,i,n)},t}(g_);g_.registerComponent("Spacer",ET);var CT=function(e){function t(){return e.apply(this,arguments)||this}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)},i.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:""})},t}(ET);g_.registerComponent("CustomControlSpacer",CT);var MT=function(e){function t(){return e.apply(this,arguments)||this}return Ef(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},t}(g_);MT.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in z&&MT.prototype.options_.children.splice(MT.prototype.options_.children.length-1,0,"pictureInPictureToggle"),g_.registerComponent("ControlBar",MT);var kT=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).on(t,"error",function(e){return n.open(e)}),n}Ef(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-error-display "+e.prototype.buildCSSClass.call(this)},i.content=function(){var e=this.player().error();return e?this.localize(e.message):""},t}(k_);kT.prototype.options_=ye({},k_.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),g_.registerComponent("ErrorDisplay",kT);var IT="vjs-text-track-settings",PT=["#000","Black"],LT=["#00F","Blue"],DT=["#0FF","Cyan"],OT=["#0F0","Green"],RT=["#F0F","Magenta"],NT=["#F00","Red"],FT=["#FFF","White"],UT=["#FF0","Yellow"],BT=["1","Opaque"],jT=["0.5","Semi-Transparent"],zT=["0","Transparent"],VT={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[PT,FT,NT,OT,LT,UT,RT,DT]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[BT,jT,zT]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[FT,PT,NT,OT,LT,UT,RT,DT]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(e){return"1.00"===e?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[BT,jT]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[zT,jT,BT]}};function HT(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}VT.windowColor.options=VT.backgroundColor.options;var qT=function(e){function t(t,i){var n;return i.temporary=!1,(n=e.call(this,t,i)||this).updateDisplay=n.updateDisplay.bind(xf(n)),n.fill(),n.hasBeenOpened_=n.hasBeenFilled_=!0,n.endDialog=Zy("p",{className:"vjs-control-text",textContent:n.localize("End of dialog window.")}),n.el().appendChild(n.endDialog),n.setDefaults(),void 0===i.persistTextTrackSettings&&(n.options_.persistTextTrackSettings=n.options_.playerOptions.persistTextTrackSettings),n.on(n.$(".vjs-done-button"),"click",function(){n.saveSettings(),n.close()}),n.on(n.$(".vjs-default-button"),"click",function(){n.setDefaults(),n.updateDisplay()}),yy(VT,function(e){n.on(n.$(e.selector),"change",n.updateDisplay)}),n.options_.persistTextTrackSettings&&n.restoreSettings(),n}Ef(t,e);var i=t.prototype;return i.dispose=function(){this.endDialog=null,e.prototype.dispose.call(this)},i.createElSelect_=function(e,t,i){var n=this;void 0===t&&(t=""),void 0===i&&(i="label");var r=VT[e],s=r.id.replace("%s",this.id_),a=[t,s].join(" ").trim();return["<"+i+' id="'+s+'" class="'+("label"===i?"vjs-label":"")+'">',this.localize(r.label),"</"+i+">",'<select aria-labelledby="'+a+'">'].concat(r.options.map(function(e){var t=s+"-"+e[1].replace(/\W+/g,"");return['<option id="'+t+'" value="'+e[0]+'" ','aria-labelledby="'+a+" "+t+'">',n.localize(e[1]),"</option>"].join("")})).concat("</select>").join("")},i.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},i.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},i.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},i.createElColors_=function(){return Zy("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},i.createElFont_=function(){return Zy("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},i.createElControls_=function(){var e=this.localize("restore all settings to the default values");return Zy("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},i.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},i.label=function(){return this.localize("Caption Settings Dialog")},i.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},i.buildCSSClass=function(){return e.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},i.getValues=function(){var e,t,i,n=this;return t=function(e,t,i){var r,s,a=(r=n.$(t.selector),s=t.parser,HT(r.options[r.options.selectedIndex].value,s));return void 0!==a&&(e[i]=a),e},void 0===(i={})&&(i=0),gy(e=VT).reduce(function(i,n){return t(i,e[n],n)},i)},i.setValues=function(e){var t=this;yy(VT,function(i,n){!function(e,t,i){if(t)for(var n=0;n<e.options.length;n++)if(HT(e.options[n].value,i)===t){e.selectedIndex=n;break}}(t.$(i.selector),e[n],i.parser)})},i.setDefaults=function(){var e=this;yy(VT,function(t){var i=t.hasOwnProperty("default")?t.default:0;e.$(t.selector).selectedIndex=i})},i.restoreSettings=function(){var e;try{e=JSON.parse(N.localStorage.getItem(IT))}catch(t){py.warn(t)}e&&this.setValues(e)},i.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?N.localStorage.setItem(IT,JSON.stringify(e)):N.localStorage.removeItem(IT)}catch(t){py.warn(t)}}},i.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},i.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,t=e&&e.subsCapsButton,i=e&&e.captionsButton;t?t.focus():i&&i.focus()},t}(k_);g_.registerComponent("TextTrackSettings",qT);var GT=function(e){function t(t,i){var n,r=i.ResizeObserver||N.ResizeObserver;null===i.ResizeObserver&&(r=!1);var s=h_({createEl:!r,reportTouchActivity:!1},i);return(n=e.call(this,t,s)||this).ResizeObserver=i.ResizeObserver||N.ResizeObserver,n.loadListener_=null,n.resizeObserver_=null,n.debouncedHandler_=function(e,t,i,n){var r;void 0===n&&(n=N);var s=function(){var i=this,s=arguments,a=function(){r=null,a=null,e.apply(i,s)};n.clearTimeout(r),r=n.setTimeout(a,t)};return s.cancel=function(){n.clearTimeout(r),r=null},s}(function(){n.resizeHandler()},100,0,xf(n)),r?(n.resizeObserver_=new n.ResizeObserver(n.debouncedHandler_),n.resizeObserver_.observe(t.el())):(n.loadListener_=function(){if(n.el_&&n.el_.contentWindow){var e=n.debouncedHandler_,t=n.unloadListener_=function(){zv(this,"resize",e),zv(this,"unload",t),t=null};jv(n.el_.contentWindow,"unload",t),jv(n.el_.contentWindow,"resize",e)}},n.one("load",n.loadListener_)),n}Ef(t,e);var i=t.prototype;return i.createEl=function(){return e.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},i.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")},i.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,e.prototype.dispose.call(this)},t}(g_);g_.registerComponent("ResizeManager",GT);var WT={trackingThreshold:20,liveTolerance:15},$T=function(e){function t(t,i){var n,r=h_(WT,i,{createEl:!1});return(n=e.call(this,t,r)||this).handleVisibilityChange_=function(e){return n.handleVisibilityChange(e)},n.trackLiveHandler_=function(){return n.trackLive_()},n.handlePlay_=function(e){return n.handlePlay(e)},n.handleFirstTimeupdate_=function(e){return n.handleFirstTimeupdate(e)},n.handleSeeked_=function(e){return n.handleSeeked(e)},n.seekToLiveEdge_=function(e){return n.seekToLiveEdge(e)},n.reset_(),n.on(n.player_,"durationchange",function(e){return n.handleDurationchange(e)}),n.on(n.player_,"canplay",function(){return n.toggleTracking()}),Fy&&"hidden"in z&&"visibilityState"in z&&n.on(z,"visibilitychange",n.handleVisibilityChange_),n}Ef(t,e);var i=t.prototype;return i.handleVisibilityChange=function(){this.player_.duration()===1/0&&(z.hidden?this.stopTracking():this.startTracking())},i.trackLive_=function(){var e=this.player_.seekable();if(e&&e.length){var t=Number(N.performance.now().toFixed(4)),i=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+i;var n=this.liveCurrentTime(),r=this.player_.currentTime(),s=this.player_.paused()||this.seekedBehindLive_||Math.abs(n-r)>this.options_.liveTolerance;this.timeupdateSeen_&&n!==1/0||(s=!1),s!==this.behindLiveEdge_&&(this.behindLiveEdge_=s,this.trigger("liveedgechange"))}},i.handleDurationchange=function(){this.toggleTracking()},i.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},i.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,$v),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},i.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},i.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()},i.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},i.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},i.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},i.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},i.seekableEnd=function(){for(var e=this.player_.seekable(),t=[],i=e?e.length:0;i--;)t.push(e.end(i));return t.length?t.sort()[t.length-1]:1/0},i.seekableStart=function(){for(var e=this.player_.seekable(),t=[],i=e?e.length:0;i--;)t.push(e.start(i));return t.length?t.sort()[0]:0},i.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},i.isLive=function(){return this.isTracking()},i.atLiveEdge=function(){return!this.behindLiveEdge()},i.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},i.pastSeekEnd=function(){var e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},i.behindLiveEdge=function(){return this.behindLiveEdge_},i.isTracking=function(){return"number"==typeof this.trackingInterval_},i.seekToLiveEdge=function(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},i.dispose=function(){this.off(z,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),e.prototype.dispose.call(this)},t}(g_);g_.registerComponent("LiveTracker",$T);var XT,YT=function(e){var t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;var i=e.$$("source"),n=[],r="";if(!i.length)return!1;for(var s=0;s<i.length;s++){var a=i[s].src;a&&-1===n.indexOf(a)&&n.push(a)}return!!n.length&&(1===n.length&&(r=n[0]),e.triggerSourceset(r),!0)},QT=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(e){var t=z.createElement(this.nodeName.toLowerCase());t.innerHTML=e;for(var i=z.createDocumentFragment();t.childNodes.length;)i.appendChild(t.childNodes[0]);return this.innerText="",N.Element.prototype.appendChild.call(this,i),this.innerHTML}}),KT=function(e,t){for(var i={},n=0;n<e.length&&!((i=Object.getOwnPropertyDescriptor(e[n],t))&&i.set&&i.get);n++);return i.enumerable=!0,i.configurable=!0,i},ZT=function(e){var t=e.el();if(!t.resetSourceWatch_){var i={},n=function(e){return KT([e.el(),N.HTMLMediaElement.prototype,N.Element.prototype,QT],"innerHTML")}(e),r=function(i){return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];var a=i.apply(t,r);return YT(e),a}};["append","appendChild","insertAdjacentHTML"].forEach(function(e){t[e]&&(i[e]=t[e],t[e]=r(i[e]))}),Object.defineProperty(t,"innerHTML",h_(n,{set:r(n.set)})),t.resetSourceWatch_=function(){t.resetSourceWatch_=null,Object.keys(i).forEach(function(e){t[e]=i[e]}),Object.defineProperty(t,"innerHTML",n)},e.one("sourceset",t.resetSourceWatch_)}},JT=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?G_(N.Element.prototype.getAttribute.call(this,"src")):""},set:function(e){return N.Element.prototype.setAttribute.call(this,"src",e),e}}),eS=function(e){if(e.featuresSourceset){var t=e.el();if(!t.resetSourceset_){var i=function(e){return KT([e.el(),N.HTMLMediaElement.prototype,JT],"src")}(e),n=t.setAttribute,r=t.load;Object.defineProperty(t,"src",h_(i,{set:function(n){var r=i.set.call(t,n);return e.triggerSourceset(t.src),r}})),t.setAttribute=function(i,r){var s=n.call(t,i,r);return/src/i.test(i)&&e.triggerSourceset(t.src),s},t.load=function(){var i=r.call(t);return YT(e)||(e.triggerSourceset(""),ZT(e)),i},t.currentSrc?e.triggerSourceset(t.currentSrc):YT(e)||ZT(e),t.resetSourceset_=function(){t.resetSourceset_=null,t.load=r,t.setAttribute=n,Object.defineProperty(t,"src",i),t.resetSourceWatch_&&t.resetSourceWatch_()}}}},tS=function(e,t,i,n){void 0===n&&(n=!0);var r=function(i){return Object.defineProperty(e,t,{value:i,enumerable:!0,writable:!0})},s={configurable:!0,enumerable:!0,get:function(){var e=i();return r(e),e}};return n&&(s.set=r),Object.defineProperty(e,t,s)},iS=function(e){function t(t,i){var n;n=e.call(this,t,i)||this;var r=t.source,s=!1;if(n.featuresVideoFrameCallback=n.featuresVideoFrameCallback&&"VIDEO"===n.el_.tagName,r&&(n.el_.currentSrc!==r.src||t.tag&&3===t.tag.initNetworkState_)?n.setSource(r):n.handleLateInit_(n.el_),t.enableSourceset&&n.setupSourcesetHandling_(),n.isScrubbing_=!1,n.el_.hasChildNodes()){for(var a=n.el_.childNodes,o=a.length,l=[];o--;){var u=a[o];"track"===u.nodeName.toLowerCase()&&(n.featuresNativeTextTracks?(n.remoteTextTrackEls().addTrackElement_(u),n.remoteTextTracks().addTrack(u.track),n.textTracks().addTrack(u.track),s||n.el_.hasAttribute("crossorigin")||!$_(u.src)||(s=!0)):l.push(u))}for(var c=0;c<l.length;c++)n.el_.removeChild(l[c])}return n.proxyNativeTracks_(),n.featuresNativeTextTracks&&s&&py.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),n.restoreMetadataTracksInIOSNativePlayer_(),(jy||Vy||Ly)&&!0===t.nativeControlsForTouch&&n.setControls(!0),n.proxyWebkitFullscreen_(),n.triggerReady(),n}Ef(t,e);var i=t.prototype;return i.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),t.disposeMediaElement(this.el_),this.options_=null,e.prototype.dispose.call(this)},i.setupSourcesetHandling_=function(){eS(this)},i.restoreMetadataTracksInIOSNativePlayer_=function(){var e,t=this.textTracks(),i=function(){e=[];for(var i=0;i<t.length;i++){var n=t[i];"metadata"===n.kind&&e.push({track:n,storedMode:n.mode})}};i(),t.addEventListener("change",i),this.on("dispose",function(){return t.removeEventListener("change",i)});var n=function i(){for(var n=0;n<e.length;n++){var r=e[n];"disabled"===r.track.mode&&r.track.mode!==r.storedMode&&(r.track.mode=r.storedMode)}t.removeEventListener("change",i)};this.on("webkitbeginfullscreen",function(){t.removeEventListener("change",i),t.removeEventListener("change",n),t.addEventListener("change",n)}),this.on("webkitendfullscreen",function(){t.removeEventListener("change",i),t.addEventListener("change",i),t.removeEventListener("change",n)})},i.overrideNative_=function(e,t){var i=this;if(t===this["featuresNative"+e+"Tracks"]){var n=e.toLowerCase();this[n+"TracksListeners_"]&&Object.keys(this[n+"TracksListeners_"]).forEach(function(e){i.el()[n+"Tracks"].removeEventListener(e,i[n+"TracksListeners_"][e])}),this["featuresNative"+e+"Tracks"]=!t,this[n+"TracksListeners_"]=null,this.proxyNativeTracksForType_(n)}},i.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},i.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},i.proxyNativeTracksForType_=function(e){var t=this,i=tb[e],n=this.el()[i.getterName],r=this[i.getterName]();if(this["featuresNative"+i.capitalName+"Tracks"]&&n&&n.addEventListener){var s={change:function(i){var n={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(n),"text"===e&&t[ib.remoteText.getterName]().trigger(n)},addtrack:function(e){r.addTrack(e.track)},removetrack:function(e){r.removeTrack(e.track)}},a=function(){for(var e=[],t=0;t<r.length;t++){for(var i=!1,s=0;s<n.length;s++)if(n[s]===r[t]){i=!0;break}i||e.push(r[t])}for(;e.length;)r.removeTrack(e.shift())};this[i.getterName+"Listeners_"]=s,Object.keys(s).forEach(function(e){var i=s[e];n.addEventListener(e,i),t.on("dispose",function(t){return n.removeEventListener(e,i)})}),this.on("loadstart",a),this.on("dispose",function(e){return t.off("loadstart",a)})}},i.proxyNativeTracks_=function(){var e=this;tb.names.forEach(function(t){e.proxyNativeTracksForType_(t)})},i.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var i=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(i,e),t.disposeMediaElement(e),e=i}else{e=z.createElement("video");var n=h_({},this.options_.tag&&av(this.options_.tag));jy&&!0===this.options_.nativeControlsForTouch||delete n.controls,sv(e,vy(n,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&lv(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var r=["loop","muted","playsinline","autoplay"],s=0;s<r.length;s++){var a=r[s],o=this.options_[a];void 0!==o&&(o?lv(e,a,a):uv(e,a),e[a]=o)}return e},i.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,i=function(){t=!0};this.on("loadstart",i);var n=function(){t||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready(function(){this.off("loadstart",i),this.off("loadedmetadata",n),t||this.trigger("loadstart")})}var r=["loadstart"];r.push("loadedmetadata"),e.readyState>=2&&r.push("loadeddata"),e.readyState>=3&&r.push("canplay"),e.readyState>=4&&r.push("canplaythrough"),this.ready(function(){r.forEach(function(e){this.trigger(e)},this)})}},i.setScrubbing=function(e){this.isScrubbing_=e},i.scrubbing=function(){return this.isScrubbing_},i.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&qy?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){py(t,"Video is not ready. (Video.js)")}},i.duration=function(){var e=this;if(this.el_.duration===1/0&&Iy&&Ry&&0===this.el_.currentTime){return this.on("timeupdate",function t(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",t))}),NaN}return this.el_.duration||NaN},i.width=function(){return this.el_.offsetWidth},i.height=function(){return this.el_.offsetHeight},i.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var t=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},i=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",i),this.on("dispose",function(){e.off("webkitbeginfullscreen",i),e.off("webkitendfullscreen",t)})}},i.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var e=N.navigator&&N.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},i.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)x_(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},i.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},i.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},i.requestVideoFrameCallback=function(t){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(t):e.prototype.requestVideoFrameCallback.call(this,t)},i.cancelVideoFrameCallback=function(t){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(t):e.prototype.cancelVideoFrameCallback.call(this,t)},i.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},i.reset=function(){t.resetMediaElement(this.el_)},i.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},i.setControls=function(e){this.el_.controls=!!e},i.addTextTrack=function(t,i,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(t,i,n):e.prototype.addTextTrack.call(this,t,i,n)},i.createRemoteTextTrack=function(t){if(!this.featuresNativeTextTracks)return e.prototype.createRemoteTextTrack.call(this,t);var i=z.createElement("track");return t.kind&&(i.kind=t.kind),t.label&&(i.label=t.label),(t.language||t.srclang)&&(i.srclang=t.language||t.srclang),t.default&&(i.default=t.default),t.id&&(i.id=t.id),t.src&&(i.src=t.src),i},i.addRemoteTextTrack=function(t,i){var n=e.prototype.addRemoteTextTrack.call(this,t,i);return this.featuresNativeTextTracks&&this.el().appendChild(n),n},i.removeRemoteTextTrack=function(t){if(e.prototype.removeRemoteTextTrack.call(this,t),this.featuresNativeTextTracks)for(var i=this.$$("track"),n=i.length;n--;)t!==i[n]&&t!==i[n].track||this.el().removeChild(i[n])},i.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),N.performance&&"function"==typeof N.performance.now?e.creationTime=N.performance.now():N.performance&&N.performance.timing&&"number"==typeof N.performance.timing.navigationStart&&(e.creationTime=N.Date.now()-N.performance.timing.navigationStart),e},t}(rb);tS(iS,"TEST_VID",function(){if(Xy()){var e=z.createElement("video"),t=z.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e}}),iS.isSupported=function(){try{iS.TEST_VID.volume=.5}catch(e){return!1}return!(!iS.TEST_VID||!iS.TEST_VID.canPlayType)},iS.canPlayType=function(e){return iS.TEST_VID.canPlayType(e)},iS.canPlaySource=function(e,t){return iS.canPlayType(e.type)},iS.canControlVolume=function(){try{var e=iS.TEST_VID.volume;iS.TEST_VID.volume=e/2+.1;var t=e!==iS.TEST_VID.volume;return t&&Hy?(N.setTimeout(function(){iS&&iS.prototype&&(iS.prototype.featuresVolumeControl=e!==iS.TEST_VID.volume)}),!1):t}catch(i){return!1}},iS.canMuteVolume=function(){try{var e=iS.TEST_VID.muted;return iS.TEST_VID.muted=!e,iS.TEST_VID.muted?lv(iS.TEST_VID,"muted","muted"):uv(iS.TEST_VID,"muted"),e!==iS.TEST_VID.muted}catch(t){return!1}},iS.canControlPlaybackRate=function(){if(Iy&&Ry&&Ny<58)return!1;try{var e=iS.TEST_VID.playbackRate;return iS.TEST_VID.playbackRate=e/2+.1,e!==iS.TEST_VID.playbackRate}catch(t){return!1}},iS.canOverrideAttributes=function(){try{var e=function(){};Object.defineProperty(z.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(z.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(z.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(z.createElement("audio"),"innerHTML",{get:e,set:e})}catch(t){return!1}return!0},iS.supportsNativeTextTracks=function(){return qy||Hy&&Ry},iS.supportsNativeVideoTracks=function(){return!(!iS.TEST_VID||!iS.TEST_VID.videoTracks)},iS.supportsNativeAudioTracks=function(){return!(!iS.TEST_VID||!iS.TEST_VID.audioTracks)},iS.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(e){var t=e[0],i=e[1];tS(iS.prototype,t,function(){return iS[i]()},!0)}),iS.prototype.featuresVolumeControl=iS.canControlVolume(),iS.prototype.movingMediaElementInDOM=!Hy,iS.prototype.featuresFullscreenResize=!0,iS.prototype.featuresProgressEvents=!0,iS.prototype.featuresTimeupdateEvents=!0,iS.prototype.featuresVideoFrameCallback=!(!iS.TEST_VID||!iS.TEST_VID.requestVideoFrameCallback),iS.patchCanPlayType=function(){Py>=4&&!Dy&&!Ry&&(XT=iS.TEST_VID&&iS.TEST_VID.constructor.prototype.canPlayType,iS.TEST_VID.constructor.prototype.canPlayType=function(e){return e&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(e)?"maybe":XT.call(this,e)})},iS.unpatchCanPlayType=function(){var e=iS.TEST_VID.constructor.prototype.canPlayType;return XT&&(iS.TEST_VID.constructor.prototype.canPlayType=XT),e},iS.patchCanPlayType(),iS.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},iS.resetMediaElement=function(e){if(e){for(var t=e.querySelectorAll("source"),i=t.length;i--;)e.removeChild(t[i]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){iS.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){iS.prototype["set"+c_(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(e){iS.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){iS.prototype["set"+c_(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){iS.prototype[e]=function(){return this.el_[e]()}}),rb.withSourceHandlers(iS),iS.nativeSourceHandler={},iS.nativeSourceHandler.canPlayType=function(e){try{return iS.TEST_VID.canPlayType(e)}catch(t){return""}},iS.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return iS.nativeSourceHandler.canPlayType(e.type);if(e.src){var i=W_(e.src);return iS.nativeSourceHandler.canPlayType("video/"+i)}return""},iS.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},iS.nativeSourceHandler.dispose=function(){},iS.registerSourceHandler(iS.nativeSourceHandler),rb.registerTech("Html5",iS);var nS=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],rS={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},sS=["tiny","xsmall","small","medium","large","xlarge","huge"],aS={};sS.forEach(function(e){var t="x"===e.charAt(0)?"x-"+e.substring(1):e;aS[e]="vjs-layout-"+t});var oS={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},lS=function(e){function t(i,n,r){var s;if(i.id=i.id||n.id||"vjs_video_"+Dv(),(n=vy(t.getTagSettings(i),n)).initChildren=!1,n.createEl=!1,n.evented=!1,n.reportTouchActivity=!1,!n.language)if("function"==typeof i.closest){var a=i.closest("[lang]");a&&a.getAttribute&&(n.language=a.getAttribute("lang"))}else for(var o=i;o&&1===o.nodeType;){if(av(o).hasOwnProperty("lang")){n.language=o.getAttribute("lang");break}o=o.parentNode}if((s=e.call(this,null,n,r)||this).boundDocumentFullscreenChange_=function(e){return s.documentFullscreenChange_(e)},s.boundFullWindowOnEscKey_=function(e){return s.fullWindowOnEscKey(e)},s.boundUpdateStyleEl_=function(e){return s.updateStyleEl_(e)},s.boundApplyInitTime_=function(e){return s.applyInitTime_(e)},s.boundUpdateCurrentBreakpoint_=function(e){return s.updateCurrentBreakpoint_(e)},s.boundHandleTechClick_=function(e){return s.handleTechClick_(e)},s.boundHandleTechDoubleClick_=function(e){return s.handleTechDoubleClick_(e)},s.boundHandleTechTouchStart_=function(e){return s.handleTechTouchStart_(e)},s.boundHandleTechTouchMove_=function(e){return s.handleTechTouchMove_(e)},s.boundHandleTechTouchEnd_=function(e){return s.handleTechTouchEnd_(e)},s.boundHandleTechTap_=function(e){return s.handleTechTap_(e)},s.isFullscreen_=!1,s.log=fy(s.id_),s.fsApi_=oy,s.isPosterFromTech_=!1,s.queuedCallbacks_=[],s.isReady_=!1,s.hasStarted_=!1,s.userActive_=!1,s.debugEnabled_=!1,s.audioOnlyMode_=!1,s.audioPosterMode_=!1,s.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!s.options_||!s.options_.techOrder||!s.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(s.tag=i,s.tagAttributes=i&&av(i),s.language(s.options_.language),n.languages){var l={};Object.getOwnPropertyNames(n.languages).forEach(function(e){l[e.toLowerCase()]=n.languages[e]}),s.languages_=l}else s.languages_=t.prototype.options_.languages;s.resetCache_(),s.poster_=n.poster||"",s.controls_=!!n.controls,i.controls=!1,i.removeAttribute("controls"),s.changingSrc_=!1,s.playCallbacks_=[],s.playTerminatedQueue_=[],i.hasAttribute("autoplay")?s.autoplay(!0):s.autoplay(s.options_.autoplay),n.plugins&&Object.keys(n.plugins).forEach(function(e){if("function"!=typeof s[e])throw new Error('plugin "'+e+'" does not exist')}),s.scrubbing_=!1,s.el_=s.createEl(),a_(xf(s),{eventBusKey:"el_"}),s.fsApi_.requestFullscreen&&(jv(z,s.fsApi_.fullscreenchange,s.boundDocumentFullscreenChange_),s.on(s.fsApi_.fullscreenchange,s.boundDocumentFullscreenChange_)),s.fluid_&&s.on(["playerreset","resize"],s.boundUpdateStyleEl_);var u=h_(s.options_);n.plugins&&Object.keys(n.plugins).forEach(function(e){s[e](n.plugins[e])}),n.debug&&s.debug(!0),s.options_.playerOptions=u,s.middleware_=[],s.playbackRates(n.playbackRates),s.initChildren(),s.isAudio("audio"===i.nodeName.toLowerCase()),s.controls()?s.addClass("vjs-controls-enabled"):s.addClass("vjs-controls-disabled"),s.el_.setAttribute("role","region"),s.isAudio()?s.el_.setAttribute("aria-label",s.localize("Audio Player")):s.el_.setAttribute("aria-label",s.localize("Video Player")),s.isAudio()&&s.addClass("vjs-audio"),s.flexNotSupported_()&&s.addClass("vjs-no-flex"),jy&&s.addClass("vjs-touch-enabled"),Hy||s.addClass("vjs-workinghover"),t.players[s.id_]=xf(s);var c=ny.split(".")[0];return s.addClass("vjs-v"+c),s.userActive(!0),s.reportUserActivity(),s.one("play",function(e){return s.listenForUserActivity_(e)}),s.on("stageclick",function(e){return s.handleStageClick_(e)}),s.on("keydown",function(e){return s.handleKeyDown(e)}),s.on("languagechange",function(e){return s.handleLanguagechange(e)}),s.breakpoints(s.options_.breakpoints),s.responsive(s.options_.responsive),s.on("ready",function(){s.audioPosterMode(s.options_.audioPosterMode),s.audioOnlyMode(s.options_.audioOnlyMode)}),s}Ef(t,e);var i=t.prototype;return i.dispose=function(){var i=this;this.trigger("dispose"),this.off("dispose"),zv(z,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),zv(z,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),t.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),ab[this.id()]=null,nb.names.forEach(function(e){var t=nb[e],n=i[t.getterName]();n&&n.off&&n.off()}),e.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},i.createEl=function(){var t,i=this.tag,n=this.playerElIngest_=i.parentNode&&i.parentNode.hasAttribute&&i.parentNode.hasAttribute("data-vjs-player"),r="video-js"===this.tag.tagName.toLowerCase();n?t=this.el_=i.parentNode:r||(t=this.el_=e.prototype.createEl.call(this,"div"));var s=av(i);if(r){for(t=this.el_=i,i=this.tag=z.createElement("video");t.children.length;)i.appendChild(t.firstChild);tv(t,"video-js")||iv(t,"video-js"),t.appendChild(i),n=this.playerElIngest_=t,Object.keys(t).forEach(function(e){try{i[e]=t[e]}catch(n){}})}if(i.setAttribute("tabindex","-1"),s.tabindex="-1",(Fy||Ry&&By)&&(i.setAttribute("role","application"),s.role="application"),i.removeAttribute("width"),i.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(e){r&&"class"===e||t.setAttribute(e,s[e]),r&&i.setAttribute(e,s[e])}),i.playerId=i.id,i.id+="_html5_api",i.className="vjs-tech",i.player=t.player=this,this.addClass("vjs-paused"),!0!==N.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=Iv("vjs-styles-dimensions");var a=Sv(".vjs-styles-defaults"),o=Sv("head");o.insertBefore(this.styleEl_,a?a.nextSibling:o.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var l=i.getElementsByTagName("a"),u=0;u<l.length;u++){var c=l.item(u);iv(c,"vjs-hidden"),c.setAttribute("hidden","hidden")}return i.initNetworkState_=i.networkState,i.parentNode&&!n&&i.parentNode.insertBefore(t,i),ev(i,t),this.children_.unshift(i),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t},i.crossOrigin=function(e){if(!e)return this.techGet_("crossOrigin");"anonymous"===e||"use-credentials"===e?this.techCall_("setCrossOrigin",e):py.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+e+'"')},i.width=function(e){return this.dimension("width",e)},i.height=function(e){return this.dimension("height",e)},i.dimension=function(e,t){var i=e+"_";if(void 0===t)return this[i]||0;if(""===t||"auto"===t)return this[i]=void 0,void this.updateStyleEl_();var n=parseFloat(t);isNaN(n)?py.error('Improper value "'+t+'" supplied for for '+e):(this[i]=n,this.updateStyleEl_())},i.fluid=function(e){var t,i,n=this;if(void 0===e)return!!this.fluid_;this.fluid_=!!e,Zv(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),i=function(){n.on(["playerreset","resize"],n.boundUpdateStyleEl_)},Zv(t=this)?i():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(i))):this.removeClass("vjs-fluid"),this.updateStyleEl_()},i.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},i.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},i.updateStyleEl_=function(){if(!0!==N.VIDEOJS_NO_DYNAMIC_STYLE){var e,t,i,n=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),r=n[1]/n[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/r:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*r,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),Pv(this.styleEl_,"\n      ."+i+" {\n        width: "+e+"px;\n        height: "+t+"px;\n      }\n\n      ."+i+".vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: "+100*r+"%;\n      }\n    ")}else{var s="number"==typeof this.width_?this.width_:this.options_.width,a="number"==typeof this.height_?this.height_:this.options_.height,o=this.tech_&&this.tech_.el();o&&(s>=0&&(o.width=s),a>=0&&(o.height=a))}},i.loadTech_=function(e,t){var i=this;this.tech_&&this.unloadTech_();var n=c_(e),r=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(rb.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;var s=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(s=!1);var a={source:t,autoplay:s,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+r+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};nb.names.forEach(function(e){var t=nb[e];a[t.getterName]=i[t.privateName]}),vy(a,this.options_[n]),vy(a,this.options_[r]),vy(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);var o=rb.getTech(e);if(!o)throw new Error("No Tech named '"+n+"' exists! '"+n+"' should be registered using videojs.registerTech()'");this.tech_=new o(a),this.tech_.ready(Xv(this,this.handleTechReady_),!0),C_(this.textTracksJson_||[],this.tech_),nS.forEach(function(e){i.on(i.tech_,e,function(t){return i["handleTech"+c_(e)+"_"](t)})}),Object.keys(rS).forEach(function(e){i.on(i.tech_,e,function(t){0===i.tech_.playbackRate()&&i.tech_.seeking()?i.queuedCallbacks_.push({callback:i["handleTech"+rS[e]+"_"].bind(i),event:t}):i["handleTech"+rS[e]+"_"](t)})}),this.on(this.tech_,"loadstart",function(e){return i.handleTechLoadStart_(e)}),this.on(this.tech_,"sourceset",function(e){return i.handleTechSourceset_(e)}),this.on(this.tech_,"waiting",function(e){return i.handleTechWaiting_(e)}),this.on(this.tech_,"ended",function(e){return i.handleTechEnded_(e)}),this.on(this.tech_,"seeking",function(e){return i.handleTechSeeking_(e)}),this.on(this.tech_,"play",function(e){return i.handleTechPlay_(e)}),this.on(this.tech_,"firstplay",function(e){return i.handleTechFirstPlay_(e)}),this.on(this.tech_,"pause",function(e){return i.handleTechPause_(e)}),this.on(this.tech_,"durationchange",function(e){return i.handleTechDurationChange_(e)}),this.on(this.tech_,"fullscreenchange",function(e,t){return i.handleTechFullscreenChange_(e,t)}),this.on(this.tech_,"fullscreenerror",function(e,t){return i.handleTechFullscreenError_(e,t)}),this.on(this.tech_,"enterpictureinpicture",function(e){return i.handleTechEnterPictureInPicture_(e)}),this.on(this.tech_,"leavepictureinpicture",function(e){return i.handleTechLeavePictureInPicture_(e)}),this.on(this.tech_,"error",function(e){return i.handleTechError_(e)}),this.on(this.tech_,"posterchange",function(e){return i.handleTechPosterChange_(e)}),this.on(this.tech_,"textdata",function(e){return i.handleTechTextData_(e)}),this.on(this.tech_,"ratechange",function(e){return i.handleTechRateChange_(e)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||ev(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},i.unloadTech_=function(){var e=this;nb.names.forEach(function(t){var i=nb[t];e[i.privateName]=e[i.getterName]()}),this.textTracksJson_=E_(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},i.tech=function(e){return void 0===e&&py.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},i.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},i.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},i.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},i.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())},i.manualAutoplay_=function(e){var t=this;if(this.tech_&&"string"==typeof e){var i,n=function(){var e=t.muted();t.muted(!0);var i=function(){t.muted(e)};t.playTerminatedQueue_.push(i);var n=t.play();if(w_(n))return n.catch(function(e){throw i(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(e||""))})};if("any"!==e||this.muted()?i="muted"!==e||this.muted()?this.play():n():w_(i=this.play())&&(i=i.catch(n)),w_(i))return i.then(function(){t.trigger({type:"autoplay-success",autoplay:e})}).catch(function(){t.trigger({type:"autoplay-failure",autoplay:e})})}},i.updateSourceCaches_=function(e){void 0===e&&(e="");var t=e,i="";"string"!=typeof t&&(t=e.src,i=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!i&&(i=function(e,t){if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;var i=e.cache_.sources.filter(function(e){return e.src===t});if(i.length)return i[0].type;for(var n=e.$$("source"),r=0;r<n.length;r++){var s=n[r];if(s.type&&s.src&&s.src===t)return s.type}return gb(t)}(this,t)),this.cache_.source=h_({},e,{src:t,type:i});for(var n=this.cache_.sources.filter(function(e){return e.src&&e.src===t}),r=[],s=this.$$("source"),a=[],o=0;o<s.length;o++){var l=av(s[o]);r.push(l),l.src&&l.src===t&&a.push(l.src)}a.length&&!n.length?this.cache_.sources=r:n.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t},i.handleTechSourceset_=function(e){var t=this;if(!this.changingSrc_){var i=function(e){return t.updateSourceCaches_(e)},n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(i=function(){}),i(r),e.src||this.tech_.any(["sourceset","loadstart"],function(e){if("sourceset"!==e.type){var i=t.techGet("currentSrc");t.lastSource_.tech=i,t.updateSourceCaches_(i)}})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},i.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},i.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},i.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},i.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var t=this.currentTime();this.on("timeupdate",function i(){t!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",i))})},i.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},i.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},i.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},i.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},i.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},i.handleTechFirstPlay_=function(){this.options_.starttime&&(py.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},i.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},i.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},i.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},i.handleTechClick_=function(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?x_(this.play()):this.pause()))},i.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(t){return t.contains(e.target)})||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},i.handleTechTap_=function(){this.userActive(!this.userActive())},i.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},i.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},i.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},i.handleStageClick_=function(){this.reportUserActivity()},i.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},i.documentFullscreenChange_=function(e){var t=e.target.player;if(!t||t===this){var i=this.el(),n=z[this.fsApi_.fullscreenElement]===i;!n&&i.matches?n=i.matches(":"+this.fsApi_.fullscreen):!n&&i.msMatchesSelector&&(n=i.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(n)}},i.handleTechFullscreenChange_=function(e,t){var i=this;t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){i.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))},i.handleTechFullscreenError_=function(e,t){this.trigger("fullscreenerror",t)},i.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},i.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},i.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},i.handleTechError_=function(){var e=this.tech_.error();this.error(e)},i.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},i.getCache=function(){return this.cache_},i.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},i.techCall_=function(e,t){this.ready(function(){if(e in hb)return function(e,t,i,n){return t[i](e.reduce(pb(i),n))}(this.middleware_,this.tech_,e,t);if(e in db)return ub(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(i){throw py(i),i}},!0)},i.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in cb)return function(e,t,i){return e.reduceRight(pb(i),t[i]())}(this.middleware_,this.tech_,e);if(e in db)return ub(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw py("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t;if("TypeError"===t.name)throw py("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t;throw py(t),t}}},i.play=function(){var e=this,t=this.options_.Promise||N.Promise;return t?new t(function(t){e.play_(t)}):this.play_()},i.play_=function(e){var t=this;void 0===e&&(e=x_),this.playCallbacks_.push(e);var i=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(qy||Hy);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!i)return this.waitToPlay_=function(e){t.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!i&&n&&this.load());var r=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),null===r?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(r)},i.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})},i.runPlayCallbacks_=function(e){var t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})},i.pause=function(){this.techCall_("pause")},i.paused=function(){return!1!==this.techGet_("paused")},i.played=function(){return this.techGet_("played")||__(0,0)},i.scrubbing=function(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},i.currentTime=function(e){return void 0!==e?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},i.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},i.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))},i.remainingTime=function(){return this.duration()-this.currentTime()},i.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},i.buffered=function(){var e=this.techGet_("buffered");return e&&e.length||(e=__(0,0)),e},i.bufferedPercent=function(){return b_(this.buffered(),this.duration())},i.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),i=e.end(e.length-1);return i>t&&(i=t),i},i.volume=function(e){var t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)},i.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},i.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},i.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},i.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},i.isFullscreen=function(e){if(void 0!==e){var t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_},i.requestFullscreen=function(e){var t=this.options_.Promise||N.Promise;if(t){var i=this;return new t(function(t,n){function r(){i.off("fullscreenerror",a),i.off("fullscreenchange",s)}function s(){r(),t()}function a(e,t){r(),n(t)}i.one("fullscreenchange",s),i.one("fullscreenerror",a);var o=i.requestFullscreenHelper_(e);o&&(o.then(r,r),o.then(t,n))})}return this.requestFullscreenHelper_()},i.requestFullscreenHelper_=function(e){var t,i=this;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){var n=this.el_[this.fsApi_.requestFullscreen](t);return n&&n.then(function(){return i.isFullscreen(!0)},function(){return i.isFullscreen(!1)}),n}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},i.exitFullscreen=function(){var e=this.options_.Promise||N.Promise;if(e){var t=this;return new e(function(e,i){function n(){t.off("fullscreenerror",s),t.off("fullscreenchange",r)}function r(){n(),e()}function s(e,t){n(),i(t)}t.one("fullscreenchange",r),t.one("fullscreenerror",s);var a=t.exitFullscreenHelper_();a&&(a.then(n,n),a.then(e,i))})}return this.exitFullscreenHelper_()},i.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var t=z[this.fsApi_.exitFullscreen]();return t&&x_(t.then(function(){return e.isFullscreen(!1)})),t}this.tech_.supportsFullScreen()&&!0==!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},i.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=z.documentElement.style.overflow,jv(z,"keydown",this.boundFullWindowOnEscKey_),z.documentElement.style.overflow="hidden",iv(z.body,"vjs-full-window"),this.trigger("enterFullWindow")},i.fullWindowOnEscKey=function(e){wf.isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},i.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,zv(z,"keydown",this.boundFullWindowOnEscKey_),z.documentElement.style.overflow=this.docOrigOverflow,nv(z.body,"vjs-full-window"),this.trigger("exitFullWindow")},i.disablePictureInPicture=function(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")},i.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},i.requestPictureInPicture=function(){if("pictureInPictureEnabled"in z&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},i.exitPictureInPicture=function(){if("pictureInPictureEnabled"in z)return z.exitPictureInPicture()},i.handleKeyDown=function(e){var t=this.options_.userActions;if(t&&t.hotkeys){(function(e){var t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;if("input"===t)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type);return-1!==["textarea"].indexOf(t)})(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}},i.handleHotkeys=function(e){var t=this.options_.userActions?this.options_.userActions.hotkeys:{},i=t.fullscreenKey,n=void 0===i?function(e){return wf.isEventKey(e,"f")}:i,r=t.muteKey,s=void 0===r?function(e){return wf.isEventKey(e,"m")}:r,a=t.playPauseKey,o=void 0===a?function(e){return wf.isEventKey(e,"k")||wf.isEventKey(e,"Space")}:a;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();var l=g_.getComponent("FullscreenToggle");!1!==z[this.fsApi_.fullscreenEnabled]&&l.prototype.handleClick.call(this,e)}else if(s.call(this,e)){e.preventDefault(),e.stopPropagation(),g_.getComponent("MuteToggle").prototype.handleClick.call(this,e)}else if(o.call(this,e)){e.preventDefault(),e.stopPropagation(),g_.getComponent("PlayToggle").prototype.handleClick.call(this,e)}},i.canPlayType=function(e){for(var t,i=0,n=this.options_.techOrder;i<n.length;i++){var r=n[i],s=rb.getTech(r);if(s||(s=g_.getComponent(r)),s){if(s.isSupported()&&(t=s.canPlayType(e)))return t}else py.error('The "'+r+'" tech is undefined. Skipped browser support check for that tech.')}return""},i.selectSource=function(e){var t,i,n=this,r=this.options_.techOrder.map(function(e){return[e,rb.getTech(e)]}).filter(function(e){var t=e[0],i=e[1];return i?i.isSupported():(py.error('The "'+t+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),s=function(e,t,i){var n;return e.some(function(e){return t.some(function(t){if(n=i(e,t))return!0})}),n},a=function(e,t){var i=e[0];if(e[1].canPlaySource(t,n.options_[i.toLowerCase()]))return{source:t,tech:i}};return t=this.options_.sourceOrder?s(e,r,(i=a,function(e,t){return i(t,e)})):s(r,e,a),t||!1},i.handleSrc_=function(e,t){var i=this;if(void 0===e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var n=yb(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),lb(this,n[0],function(e,r){var s,a;if(i.middleware_=r,t||(i.cache_.sources=n),i.updateSourceCaches_(e),i.src_(e))return n.length>1?i.handleSrc_(n.slice(1)):(i.changingSrc_=!1,i.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void i.triggerReady());s=r,a=i.tech_,s.forEach(function(e){return e.setTech&&e.setTech(a)})}),this.options_.retryOnError&&n.length>1){var r=function(){i.error(null),i.handleSrc_(n.slice(1),!0)},s=function(){i.off("error",r)};this.one("error",r),this.one("playing",s),this.resetRetryOnError_=function(){i.off("error",r),i.off("playing",s)}}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)},i.src=function(e){return this.handleSrc_(e,!1)},i.src_=function(e){var t,i,n=this,r=this.selectSource([e]);return!r||(t=r.tech,i=this.techName_,c_(t)!==c_(i)?(this.changingSrc_=!0,this.loadTech_(r.tech,r.source),this.tech_.ready(function(){n.changingSrc_=!1}),!1):(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1))},i.load=function(){this.techCall_("load")},i.reset=function(){var e=this,t=this.options_.Promise||N.Promise;this.paused()||!t?this.doReset_():x_(this.play().then(function(){return e.doReset_()}))},i.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Zv(this)&&this.trigger("playerreset")},i.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},i.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar||{},t=e.durationDisplay,i=e.remainingTimeDisplay;t&&t.updateContent(),i&&i.updateContent()},i.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},i.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},i.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},i.currentSource=function(){return this.cache_.source||{}},i.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},i.currentType=function(){return this.currentSource()&&this.currentSource().type||""},i.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},i.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)},i.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},i.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},i.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},i.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},i.controls=function(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},i.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},i.error=function(e){var t=this;if(void 0===e)return this.error_||null;if(sy("beforeerror").forEach(function(i){var n=i(t,e);_y(n)&&!Array.isArray(n)||"string"==typeof n||"number"==typeof n||null===n?e=n:t.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){var i=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],i),void this.one("loadstart",function(){this.off(["click","touchstart"],i)})}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new T_(e),this.addClass("vjs-error"),py.error("(CODE:"+this.error_.code+" "+T_.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),sy("error").forEach(function(e){return e(t,t.error_)})},i.reportUserActivity=function(e){this.userActivity_=!0},i.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},i.listenForUserActivity_=function(){var e,t,i,n=Xv(this,this.reportUserActivity),r=function(t){n(),this.clearInterval(e)};this.on("mousedown",function(){n(),this.clearInterval(e),e=this.setInterval(n,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===i||(t=e.screenX,i=e.screenY,n())}),this.on("mouseup",r),this.on("mouseleave",r);var s,a=this.getChild("controlBar");!a||Hy||Iy||(a.on("mouseenter",function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),a.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",n),this.on("keyup",n),this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(s);var e=this.options_.inactivityTimeout;e<=0||(s=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))}},250)},i.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},i.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},i.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},i.enableAudioOnlyUI_=function(){var e=this;this.addClass("vjs-audio-only-mode");var t=this.children(),i=this.getChild("ControlBar"),n=i&&i.currentHeight();t.forEach(function(t){t!==i&&t.el_&&!t.hasClass("vjs-hidden")&&(t.hide(),e.audioOnlyCache_.hiddenChildren.push(t))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(n),this.trigger("audioonlymodechange")},i.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(e){return e.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},i.audioOnlyMode=function(e){var t=this;if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=e;var i=this.options_.Promise||N.Promise;if(i){if(e){var n=[];return this.isInPictureInPicture()&&n.push(this.exitPictureInPicture()),this.isFullscreen()&&n.push(this.exitFullscreen()),this.audioPosterMode()&&n.push(this.audioPosterMode(!1)),i.all(n).then(function(){return t.enableAudioOnlyUI_()})}return i.resolve().then(function(){return t.disableAudioOnlyUI_()})}e?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},i.enablePosterModeUI_=function(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},i.disablePosterModeUI_=function(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},i.audioPosterMode=function(e){var t=this;if("boolean"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=e;var i=this.options_.Promise||N.Promise;return i?e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(function(){t.enablePosterModeUI_()}):i.resolve().then(function(){t.enablePosterModeUI_()}):i.resolve().then(function(){t.disablePosterModeUI_()}):e?(this.audioOnlyMode()&&this.audioOnlyMode(!1),void this.enablePosterModeUI_()):void this.disablePosterModeUI_()},i.addTextTrack=function(e,t,i){if(this.tech_)return this.tech_.addTextTrack(e,t,i)},i.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},i.removeRemoteTextTrack=function(e){void 0===e&&(e={});var t=e.track;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)},i.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},i.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},i.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},i.language=function(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Zv(this)&&this.trigger("languagechange"))},i.languages=function(){return h_(t.prototype.options_.languages,this.languages_)},i.toJSON=function(){var e=h_(this.options_),t=e.tracks;e.tracks=[];for(var i=0;i<t.length;i++){var n=t[i];(n=h_(n)).player=void 0,e.tracks[i]=n}return e},i.createModal=function(e,t){var i=this;(t=t||{}).content=e||"";var n=new k_(this,t);return this.addChild(n),n.on("dispose",function(){i.removeChild(n)}),n.open(),n},i.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),t=this.currentWidth(),i=0;i<sS.length;i++){var n=sS[i];if(t<=this.breakpoints_[n]){if(e===n)return;e&&this.removeClass(aS[e]),this.addClass(aS[n]),this.breakpoint_=n;break}}},i.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},i.breakpoints=function(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=vy({},oS,e),this.updateCurrentBreakpoint_()),vy(this.breakpoints_)},i.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},i.currentBreakpoint=function(){return this.breakpoint_},i.currentBreakpointClass=function(){return aS[this.breakpoint_]||""},i.loadMedia=function(e,t){var i=this;if(e&&"object"==typeof e){this.reset(),this.cache_.media=h_(e);var n=this.cache_.media,r=n.artwork,s=n.poster,a=n.src,o=n.textTracks;!r&&s&&(this.cache_.media.artwork=[{src:s,type:gb(s)}]),a&&this.src(a),s&&this.poster(s),Array.isArray(o)&&o.forEach(function(e){return i.addRemoteTextTrack(e,!1)}),this.ready(t)}},i.getMedia=function(){if(!this.cache_.media){var e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(e){return{kind:e.kind,label:e.label,language:e.language,src:e.src}})};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:gb(t.poster)}]),t}return h_(this.cache_.media)},t.getTagSettings=function(e){var t={sources:[],tracks:[]},i=av(e),n=i["data-setup"];if(tv(e,"vjs-fill")&&(i.fill=!0),tv(e,"vjs-fluid")&&(i.fluid=!0),null!==n){var r=kf(n||"{}"),s=r[0],a=r[1];s&&py.error(s),vy(i,a)}if(vy(t,i),e.hasChildNodes())for(var o=e.childNodes,l=0,u=o.length;l<u;l++){var c=o[l],h=c.nodeName.toLowerCase();"source"===h?t.sources.push(av(c)):"track"===h&&t.tracks.push(av(c))}return t},i.flexNotSupported_=function(){var e=z.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},i.debug=function(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},i.playbackRates=function(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(function(e){return"number"==typeof e})&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))},t}(g_);nb.names.forEach(function(e){var t=nb[e];lS.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),lS.prototype.crossorigin=lS.prototype.crossOrigin,lS.players={};var uS=N.navigator;lS.prototype.options_={techOrder:rb.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:uS&&(uS.languages&&uS.languages[0]||uS.userLanguage||uS.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(e){lS.prototype[e]=function(){return this.techGet_(e)}}),nS.forEach(function(e){lS.prototype["handleTech"+c_(e)+"_"]=function(){return this.trigger(e)}}),g_.registerComponent("Player",lS);var cS="plugin",hS="activePlugins_",dS={},pS=function(e){return dS.hasOwnProperty(e)},fS=function(e){return pS(e)?dS[e]:void 0},mS=function(e,t){e[hS]=e[hS]||{},e[hS][t]=!0},gS=function(e,t,i){var n=(i?"before":"")+"pluginsetup";e.trigger(n,t),e.trigger(n+":"+t.name,t)},yS=function(e,t){return t.prototype.name=e,function(){gS(this,{name:e,plugin:t,instance:null},!0);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];var s=Ff(t,[this].concat(n));return this[e]=function(){return s},gS(this,s.getEventHash()),s}},vS=function(){function e(t){if(this.constructor===e)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,this.log||(this.log=this.player.log.createLogger(this.name)),a_(this),delete this.trigger,l_(this,this.constructor.defaultState),mS(t,this.name),this.dispose=this.dispose.bind(this),t.on("dispose",this.dispose)}var t=e.prototype;return t.version=function(){return this.constructor.VERSION},t.getEventHash=function(e){return void 0===e&&(e={}),e.name=this.name,e.plugin=this.constructor,e.instance=this,e},t.trigger=function(e,t){return void 0===t&&(t={}),Vv(this.eventBusEl_,e,this.getEventHash(t))},t.handleStateChanged=function(e){},t.dispose=function(){var e=this.name,t=this.player;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[hS][e]=!1,this.player=this.state=null,t[e]=yS(e,dS[e])},e.isBasic=function(t){var i="string"==typeof t?fS(t):t;return"function"==typeof i&&!e.prototype.isPrototypeOf(i.prototype)},e.registerPlugin=function(t,i){if("string"!=typeof t)throw new Error('Illegal plugin name, "'+t+'", must be a string, was '+typeof t+".");if(pS(t))py.warn('A plugin named "'+t+'" already exists. You may want to avoid re-registering plugins!');else if(lS.prototype.hasOwnProperty(t))throw new Error('Illegal plugin name, "'+t+'", cannot share a name with an existing player method!');if("function"!=typeof i)throw new Error('Illegal plugin for "'+t+'", must be a function, was '+typeof i+".");return dS[t]=i,t!==cS&&(e.isBasic(i)?lS.prototype[t]=function(e,t){var i=function(){gS(this,{name:e,plugin:t,instance:null},!0);var i=t.apply(this,arguments);return mS(this,e),gS(this,{name:e,plugin:t,instance:i}),i};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i}(t,i):lS.prototype[t]=yS(t,i)),i},e.deregisterPlugin=function(e){if(e===cS)throw new Error("Cannot de-register base plugin.");pS(e)&&(delete dS[e],delete lS.prototype[e])},e.getPlugins=function(e){var t;return void 0===e&&(e=Object.keys(dS)),e.forEach(function(e){var i=fS(e);i&&((t=t||{})[e]=i)}),t},e.getPluginVersion=function(e){var t=fS(e);return t&&t.VERSION||""},e}();vS.getPlugin=fS,vS.BASE_PLUGIN_NAME=cS,vS.registerPlugin(cS,vS),lS.prototype.usingPlugin=function(e){return!!this[hS]&&!0===this[hS][e]},lS.prototype.hasPlugin=function(e){return!!pS(e)};var _S=!1,bS=function(e){return 0===e.indexOf("#")?e.slice(1):e};function TS(e,t,i){var n=TS.getPlayer(e);if(n)return t&&py.warn('Player "'+e+'" is already initialised. Options will not be applied.'),i&&n.ready(i),n;var r="string"==typeof e?Sv("#"+bS(e)):e;if(!Yy(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");r.ownerDocument.defaultView&&r.ownerDocument.body.contains(r)||py.warn("The element supplied is not included in the DOM"),!0===(t=t||{}).restoreEl&&(t.restoreEl=(r.parentNode&&r.parentNode.hasAttribute("data-vjs-player")?r.parentNode:r).cloneNode(!0)),sy("beforesetup").forEach(function(e){var i=e(r,h_(t));_y(i)&&!Array.isArray(i)?t=h_(t,i):py.error("please return an object in beforesetup hooks")});var s=g_.getComponent("Player");return n=new s(r,t,i),sy("setup").forEach(function(e){return e(n)}),n}if(TS.hooks_=ry,TS.hooks=sy,TS.hook=function(e,t){sy(e,t)},TS.hookOnce=function(e,t){sy(e,[].concat(t).map(function(t){return function i(){return ay(e,i),t.apply(void 0,arguments)}}))},TS.removeHook=ay,!0!==N.VIDEOJS_NO_DYNAMIC_STYLE&&Xy()){var SS=Sv(".vjs-styles-defaults");if(!SS){SS=Iv("vjs-styles-defaults");var wS=Sv("head");wS&&wS.insertBefore(SS,wS.firstChild),Pv(SS,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}Cv(1,TS),TS.VERSION=ny,TS.options=lS.prototype.options_,TS.getPlayers=function(){return lS.players},TS.getPlayer=function(e){var t,i=lS.players;if("string"==typeof e){var n=bS(e),r=i[n];if(r)return r;t=Sv("#"+n)}else t=e;if(Yy(t)){var s=t,a=s.player,o=s.playerId;if(a||i[o])return a||i[o]}},TS.getAllPlayers=function(){return Object.keys(lS.players).map(function(e){return lS.players[e]}).filter(Boolean)},TS.players=lS.players,TS.getComponent=g_.getComponent,TS.registerComponent=function(e,t){rb.isTech(t)&&py.warn("The "+e+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),g_.registerComponent.call(g_,e,t)},TS.getTech=rb.getTech,TS.registerTech=rb.registerTech,TS.use=function(e,t){sb[e]=sb[e]||[],sb[e].push(t)},Object.defineProperty(TS,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(TS.middleware,"TERMINATOR",{value:ob,writeable:!1,enumerable:!0}),TS.browser=Gy,TS.TOUCH_ENABLED=jy,TS.extend=function(e,t){void 0===t&&(t={}),_S||(py.warn("videojs.extend is deprecated as of Video.js 7.22.0 and will be removed in Video.js 8.0.0"),_S=!0);var i=function(){e.apply(this,arguments)},n={};for(var r in"object"==typeof t?(t.constructor!==Object.prototype.constructor&&(i=t.constructor),n=t):"function"==typeof t&&(i=t),function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Af(e,t)}(i,e),e&&(i.super_=e),n)n.hasOwnProperty(r)&&(i.prototype[r]=n[r]);return i},TS.mergeOptions=h_,TS.bind=Xv,TS.registerPlugin=vS.registerPlugin,TS.deregisterPlugin=vS.deregisterPlugin,TS.plugin=function(e,t){return py.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),vS.registerPlugin(e,t)},TS.getPlugins=vS.getPlugins,TS.getPlugin=vS.getPlugin,TS.getPluginVersion=vS.getPluginVersion,TS.addLanguage=function(e,t){var i;return e=(""+e).toLowerCase(),TS.options.languages=h_(TS.options.languages,((i={})[e]=t,i)),TS.options.languages[e]},TS.log=py,TS.createLogger=fy,TS.createTimeRange=TS.createTimeRanges=__,TS.formatTime=Ob,TS.setFormatTime=function(e){Db=e},TS.resetFormatTime=function(){Db=Lb},TS.parseUrl=q_,TS.isCrossOrigin=$_,TS.EventTarget=Qv,TS.on=jv,TS.one=Hv,TS.off=zv,TS.trigger=Vv,TS.xhr=Rf,TS.TextTrack=K_,TS.AudioTrack=Z_,TS.VideoTrack=J_,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(e){TS[e]=function(){return py.warn("videojs."+e+"() is deprecated; use videojs.dom."+e+"() instead"),xv[e].apply(null,arguments)}}),TS.computedStyle=Ty,TS.dom=xv,TS.url=X_,TS.defineLazyProperty=tS,TS.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"});var xS=$f,AS=function(e,t,i){return e&&i&&i.responseURL&&t!==i.responseURL?i.responseURL:t},ES=function(e){return TS.log.debug?TS.log.debug.bind(TS,"VHS:",e+" >"):function(){}},CS=1/30,MS=.1,kS=function(e,t){var i,n=[];if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return TS.createTimeRanges(n)},IS=function(e,t){return kS(e,function(e,i){return e-MS<=t&&i+MS>=t})},PS=function(e,t){return kS(e,function(e){return e-CS>=t})},LS=function(e){var t=[];if(!e||!e.length)return"";for(var i=0;i<e.length;i++)t.push(e.start(i)+" => "+e.end(i));return t.join(", ")},DS=function(e){for(var t=[],i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t},OS=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},RS=function(e,t){var i=0;if(!e||!e.length)return i;for(var n=0;n<e.length;n++){var r=e.start(n),s=e.end(n);t>s||(i+=t>r&&t<=s?s-t:s-r)}return i},NS=TS.createTimeRange,FS=function(e,t){if(!t.preload)return t.duration;var i=0;return(t.parts||[]).forEach(function(e){i+=e.duration}),(t.preloadHints||[]).forEach(function(t){"PART"===t.type&&(i+=e.partTargetDuration)}),i},US=function(e){return(e.segments||[]).reduce(function(e,t,i){return t.parts?t.parts.forEach(function(n,r){e.push({duration:n.duration,segmentIndex:i,partIndex:r,part:n,segment:t})}):e.push({duration:t.duration,segmentIndex:i,partIndex:null,segment:t,part:null}),e},[])},BS=function(e){var t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},jS=function(e){var t=e.preloadSegment;if(t){var i=t.parts,n=(t.preloadHints||[]).reduce(function(e,t){return e+("PART"===t.type?1:0)},0);return n+=i&&i.length?i.length:0}},zS=function(e,t){if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;var i=BS(t).length>0;return i&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:i&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},VS=function(e,t,i){if(void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;var n=function(e,t){var i=0,n=t-e.mediaSequence,r=e.segments[n];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;n--;){if(void 0!==(r=e.segments[n]).end)return{result:i+r.end,precise:!0};if(i+=FS(e,r),void 0!==r.start)return{result:i+r.start,precise:!0}}return{result:i,precise:!1}}(e,t);if(n.precise)return n.result;var r=function(e,t){for(var i,n=0,r=t-e.mediaSequence;r<e.segments.length;r++){if(void 0!==(i=e.segments[r]).start)return{result:i.start-n,precise:!0};if(n+=FS(e,i),void 0!==i.end)return{result:i.end-n,precise:!0}}return{result:-1,precise:!1}}(e,t);return r.precise?r.result:n.result+i},HS=function(e,t,i){if(!e)return 0;if("number"!=typeof i&&(i=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return N.Infinity}return VS(e,t,i)},qS=function(e){var t=e.defaultDuration,i=e.durationList,n=e.startIndex,r=e.endIndex,s=0;if(n>r){var a=[r,n];n=a[0],r=a[1]}if(n<0){for(var o=n;o<Math.min(0,r);o++)s+=t;n=0}for(var l=n;l<r;l++)s+=i[l].duration;return s},GS=function(e,t,i,n){if(!e||!e.segments)return null;if(e.endList)return HS(e);if(null===t)return null;t=t||0;var r=VS(e,e.mediaSequence+e.segments.length,t);return i&&(r-=n="number"==typeof n?n:zS(null,e)),Math.max(0,r)},WS=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},$S=function(e){return e.excludeUntil&&e.excludeUntil===1/0},XS=function(e){var t=WS(e);return!e.disabled&&!t},YS=function(e,t){return t.attributes&&t.attributes[e]},QS=function(e,t){if(1===e.playlists.length)return!0;var i=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(function(e){return!!XS(e)&&(e.attributes.BANDWIDTH||0)<i}).length},KS=function(e,t){return!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri))))},ZS=function(e,t){var i=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{},n=!1;for(var r in i){for(var s in i[r])if(n=t(i[r][s]))break;if(n)break}return!!n},JS=function(e){if(!e||!e.playlists||!e.playlists.length)return ZS(e,function(e){return e.playlists&&e.playlists.length||e.uri});for(var t=function(t){var i=e.playlists[t],n=i.attributes&&i.attributes.CODECS;return n&&n.split(",").every(function(e){return um(e)})||ZS(e,function(e){return KS(i,e)})?"continue":{v:!1}},i=0;i<e.playlists.length;i++){var n=t(i);if("continue"!==n&&"object"==typeof n)return n.v}return!0},ew={liveEdgeDelay:zS,duration:HS,seekable:function(e,t,i){var n=t||0,r=GS(e,t,!0,i);return null===r?NS():NS(n,r)},getMediaInfoForTime:function(e){for(var t=e.playlist,i=e.currentTime,n=e.startingSegmentIndex,r=e.startingPartIndex,s=e.startTime,a=e.experimentalExactManifestTimings,o=i-s,l=US(t),u=0,c=0;c<l.length;c++){var h=l[c];if(n===h.segmentIndex&&("number"!=typeof r||"number"!=typeof h.partIndex||r===h.partIndex)){u=c;break}}if(o<0){if(u>0)for(var d=u-1;d>=0;d--){var p=l[d];if(o+=p.duration,a){if(o<0)continue}else if(o+CS<=0)continue;return{partIndex:p.partIndex,segmentIndex:p.segmentIndex,startTime:s-qS({defaultDuration:t.targetDuration,durationList:l,startIndex:u,endIndex:d})}}return{partIndex:l[0]&&l[0].partIndex||null,segmentIndex:l[0]&&l[0].segmentIndex||0,startTime:i}}if(u<0){for(var f=u;f<0;f++)if((o-=t.targetDuration)<0)return{partIndex:l[0]&&l[0].partIndex||null,segmentIndex:l[0]&&l[0].segmentIndex||0,startTime:i};u=0}for(var m=u;m<l.length;m++){var g=l[m];if(o-=g.duration,a){if(o>0)continue}else if(o-CS>=0)continue;return{partIndex:g.partIndex,segmentIndex:g.segmentIndex,startTime:s+qS({defaultDuration:t.targetDuration,durationList:l,startIndex:u,endIndex:m})}}return{segmentIndex:l[l.length-1].segmentIndex,partIndex:l[l.length-1].partIndex,startTime:i}},isEnabled:XS,isDisabled:function(e){return e.disabled},isBlacklisted:WS,isIncompatible:$S,playlistEnd:GS,isAes:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},hasAttribute:YS,estimateSegmentRequestTime:function(e,t,i,n){return void 0===n&&(n=0),YS("BANDWIDTH",i)?(e*i.attributes.BANDWIDTH-8*n)/t:NaN},isLowestEnabledRendition:QS,isAudioOnly:JS,playlistMatch:KS,segmentDurationWithParts:FS},tw=TS.log,iw=function(e,t){return e+"-"+t},nw=function(e,t,i){return"placeholder-uri-"+e+"-"+t+"-"+i},rw=function(e,t){e.mediaGroups&&["AUDIO","SUBTITLES"].forEach(function(i){if(e.mediaGroups[i])for(var n in e.mediaGroups[i])for(var r in e.mediaGroups[i][n]){var s=e.mediaGroups[i][n][r];t(s,i,n,r)}})},sw=function(e){var t=e.playlist,i=e.uri,n=e.id;t.id=n,t.playlistErrors_=0,i&&(t.uri=i),t.attributes=t.attributes||{}},aw=function(e,t,i){void 0===i&&(i=nw),e.uri=t;for(var n=0;n<e.playlists.length;n++)if(!e.playlists[n].uri){var r="placeholder-uri-"+n;e.playlists[n].uri=r}var s=JS(e);rw(e,function(t,n,r,a){if(!t.playlists||!t.playlists.length){if(s&&"AUDIO"===n&&!t.uri)for(var o=0;o<e.playlists.length;o++){var l=e.playlists[o];if(l.attributes&&l.attributes.AUDIO&&l.attributes.AUDIO===r)return}t.playlists=[ye({},t)]}t.playlists.forEach(function(t,s){var o=i(n,r,a,t),l=iw(s,o);t.uri?t.resolvedUri=t.resolvedUri||xS(e.uri,t.uri):(t.uri=0===s?o:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t})}),function(e){for(var t=e.playlists.length;t--;){var i=e.playlists[t];sw({playlist:i,id:iw(t,i.uri)}),i.resolvedUri=xS(e.uri,i.uri),e.playlists[i.id]=i,e.playlists[i.uri]=i,i.attributes.BANDWIDTH||tw.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}}(e),function(e){rw(e,function(t){t.uri&&(t.resolvedUri=xS(e.uri,t.uri))})}(e)},ow=TS.mergeOptions,lw=TS.EventTarget,uw=function(e,t){if(!e)return t;var i=ow(e,t);if(e.preloadHints&&!t.preloadHints&&delete i.preloadHints,e.parts&&!t.parts)delete i.parts;else if(e.parts&&t.parts)for(var n=0;n<t.parts.length;n++)e.parts&&e.parts[n]&&(i.parts[n]=ow(e.parts[n],t.parts[n]));return!e.skipped&&t.skipped&&(i.skipped=!1),e.preload&&!t.preload&&(i.preload=!1),i},cw=function(e,t){!e.resolvedUri&&e.uri&&(e.resolvedUri=xS(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=xS(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=xS(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=xS(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach(function(e){e.resolvedUri||(e.resolvedUri=xS(t,e.uri))}),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach(function(e){e.resolvedUri||(e.resolvedUri=xS(t,e.uri))})},hw=function(e){var t=e.segments||[],i=e.preloadSegment;if(i&&i.parts&&i.parts.length){if(i.preloadHints)for(var n=0;n<i.preloadHints.length;n++)if("MAP"===i.preloadHints[n].type)return t;i.duration=e.targetDuration,i.preload=!0,t.push(i)}return t},dw=function(e,t){return e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment},pw=function(e,t,i){void 0===i&&(i=dw);var n=ow(e,{}),r=n.playlists[t.id];if(!r)return null;if(i(r,t))return null;t.segments=hw(t);var s=ow(r,t);if(s.preloadSegment&&!t.preloadSegment&&delete s.preloadSegment,r.segments){if(t.skip){t.segments=t.segments||[];for(var a=0;a<t.skip.skippedSegments;a++)t.segments.unshift({skipped:!0})}s.segments=function(e,t,i){var n=e.slice(),r=t.slice();i=i||0;for(var s,a=[],o=0;o<r.length;o++){var l=n[o+i],u=r[o];l?(s=l.map||s,a.push(uw(l,u))):(s&&!u.map&&(u.map=s),a.push(u))}return a}(r.segments,t.segments,t.mediaSequence-r.mediaSequence)}s.segments.forEach(function(e){cw(e,s.resolvedUri)});for(var o=0;o<n.playlists.length;o++)n.playlists[o].id===t.id&&(n.playlists[o]=s);return n.playlists[t.id]=s,n.playlists[t.uri]=s,rw(e,function(e,i,n,r){if(e.playlists)for(var a=0;a<e.playlists.length;a++)t.id===e.playlists[a].id&&(e.playlists[a]=s)}),n},fw=function(e,t){var i=e.segments||[],n=i[i.length-1],r=n&&n.parts&&n.parts[n.parts.length-1],s=r&&r.duration||n&&n.duration;return t&&s?1e3*s:500*(e.partTargetDuration||e.targetDuration||10)},mw=function(e){function t(t,i,n){var r;if(void 0===n&&(n={}),r=e.call(this)||this,!t)throw new Error("A non-empty playlist URL or object is required");r.logger_=ES("PlaylistLoader");var s=n,a=s.withCredentials,o=void 0!==a&&a,l=s.handleManifestRedirects,u=void 0!==l&&l;r.src=t,r.vhs_=i,r.withCredentials=o,r.handleManifestRedirects=u;var c=i.options_;return r.customTagParsers=c&&c.customTagParsers||[],r.customTagMappers=c&&c.customTagMappers||[],r.experimentalLLHLS=c&&c.experimentalLLHLS||!1,TS.browser.IE_VERSION&&(r.experimentalLLHLS=!1),r.state="HAVE_NOTHING",r.handleMediaupdatetimeout_=r.handleMediaupdatetimeout_.bind(xf(r)),r.on("mediaupdatetimeout",r.handleMediaupdatetimeout_),r}Ef(t,e);var i=t.prototype;return i.handleMediaupdatetimeout_=function(){var e=this;if("HAVE_METADATA"===this.state){var t=this.media(),i=xS(this.master.uri,t.uri);this.experimentalLLHLS&&(i=function(e,t){if(t.endList||!t.serverControl)return e;var i={};if(t.serverControl.canBlockReload){var n=t.preloadSegment,r=t.mediaSequence+t.segments.length;if(n){var s=n.parts||[],a=jS(t)-1;a>-1&&a!==s.length-1&&(i._HLS_part=a),(a>-1||s.length)&&r--}i._HLS_msn=r}if(t.serverControl&&t.serverControl.canSkipUntil&&(i._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(i).length){var o=new N.URL(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(e){i.hasOwnProperty(e)&&o.searchParams.set(e,i[e])}),e=o.toString()}return e}(i,t)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:i,withCredentials:this.withCredentials},function(t,i){if(e.request)return t?e.playlistRequestError(e.request,e.media(),"HAVE_METADATA"):void e.haveMetadata({playlistString:e.request.responseText,url:e.media().uri,id:e.media().id})})}},i.playlistRequestError=function(e,t,i){var n=t.uri,r=t.id;this.request=null,i&&(this.state=i),this.error={playlist:this.master.playlists[r],status:e.status,message:"HLS playlist request error at URL: "+n+".",responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")},i.parseManifest_=function(e){var t=this,i=e.url;return function(e){var t=e.onwarn,i=e.oninfo,n=e.manifestString,r=e.customTagParsers,s=void 0===r?[]:r,a=e.customTagMappers,o=void 0===a?[]:a,l=e.experimentalLLHLS,u=new nm;t&&u.on("warn",t),i&&u.on("info",i),s.forEach(function(e){return u.addParser(e)}),o.forEach(function(e){return u.addTagMapper(e)}),u.push(n),u.end();var c=u.manifest;if(l||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(e){c.hasOwnProperty(e)&&delete c[e]}),c.segments&&c.segments.forEach(function(e){["parts","preloadHints"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})),!c.targetDuration){var h=10;c.segments&&c.segments.length&&(h=c.segments.reduce(function(e,t){return Math.max(e,t.duration)},0)),t&&t("manifest has no targetDuration defaulting to "+h),c.targetDuration=h}var d=BS(c);if(d.length&&!c.partTargetDuration){var p=d.reduce(function(e,t){return Math.max(e,t.duration)},0);t&&(t("manifest has no partTargetDuration defaulting to "+p),tw.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),c.partTargetDuration=p}return c}({onwarn:function(e){var n=e.message;return t.logger_("m3u8-parser warn for "+i+": "+n)},oninfo:function(e){var n=e.message;return t.logger_("m3u8-parser info for "+i+": "+n)},manifestString:e.manifestString,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,experimentalLLHLS:this.experimentalLLHLS})},i.haveMetadata=function(e){var t=e.playlistString,i=e.playlistObject,n=e.url,r=e.id;this.request=null,this.state="HAVE_METADATA";var s=i||this.parseManifest_({url:n,manifestString:t});s.lastRequest=Date.now(),sw({playlist:s,uri:n,id:r});var a=pw(this.master,s);this.targetDuration=s.partTargetDuration||s.targetDuration,this.pendingMedia_=null,a?(this.master=a,this.media_=this.master.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(fw(this.media(),!!a)),this.trigger("loadedplaylist")},i.dispose=function(){this.trigger("dispose"),this.stopRequest(),N.clearTimeout(this.mediaUpdateTimeout),N.clearTimeout(this.finalRenditionTimeout),this.off()},i.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},i.media=function(e,t){var i=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}if(N.clearTimeout(this.finalRenditionTimeout),t){var n=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=N.setTimeout(this.media.bind(this,e,!1),n)}else{var r=this.state,s=!this.media_||e.id!==this.media_.id,a=this.master.playlists[e.id];if(a&&a.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(s&&(this.trigger("mediachanging"),"HAVE_MASTER"===r?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(fw(e,!0)),s){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},function(t,n){if(i.request){if(e.lastRequest=Date.now(),e.resolvedUri=AS(i.handleManifestRedirects,e.resolvedUri,n),t)return i.playlistRequestError(i.request,e,r);i.haveMetadata({playlistString:n.responseText,url:e.uri,id:e.id}),"HAVE_MASTER"===r?i.trigger("loadedmetadata"):i.trigger("mediachange")}})}}},i.pause=function(){this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")},i.load=function(e){var t=this;this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);var i=this.media();if(e){var n=i?(i.partTargetDuration||i.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=N.setTimeout(function(){t.mediaUpdateTimeout=null,t.load()},n)}else this.started?i&&!i.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()},i.updateMediaUpdateTimeout_=function(e){var t=this;this.mediaUpdateTimeout&&(N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=N.setTimeout(function(){t.mediaUpdateTimeout=null,t.trigger("mediaupdatetimeout"),t.updateMediaUpdateTimeout_(e)},e))},i.start=function(){var e=this;if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=N.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(function(){e.setupInitialPlaylist(e.src)},0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},function(t,i){if(e.request){if(e.request=null,t)return e.error={status:i.status,message:"HLS playlist request error at URL: "+e.src+".",responseText:i.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.src=AS(e.handleManifestRedirects,e.src,i);var n=e.parseManifest_({manifestString:i.responseText,url:e.src});e.setupInitialPlaylist(n)}})},i.srcUri=function(){return"string"==typeof this.src?this.src:this.src.uri},i.setupInitialPlaylist=function(e){if(this.state="HAVE_MASTER",e.playlists)return this.master=e,aw(this.master,this.srcUri()),e.playlists.forEach(function(e){e.segments=hw(e),e.segments.forEach(function(t){cw(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.master.playlists[0]));var t=this.srcUri()||N.location.href;this.master=function(e,t){var i=iw(0,t),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:N.location.href,resolvedUri:N.location.href,playlists:[{uri:t,id:i,resolvedUri:t,attributes:{}}]};return n.playlists[i]=n.playlists[0],n.playlists[t]=n.playlists[0],n}(0,t),this.haveMetadata({playlistObject:e,url:t,id:this.master.playlists[0].id}),this.trigger("loadedmetadata")},t}(lw),gw=TS.xhr,yw=TS.mergeOptions,vw=function(e,t,i,n){var r="arraybuffer"===e.responseType?e.response:e.responseText;!t&&r&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=r.byteLength||r.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),i.headers&&(e.responseHeaders=i.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===i.statusCode||206===i.statusCode||0===i.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(r||e.responseText)))),n(t,e)},_w=function(){var e=function e(t,i){t=yw({timeout:45e3},t);var n=e.beforeRequest||TS.Vhs.xhr.beforeRequest;if(n&&"function"==typeof n){var r=n(t);r&&(t=r)}var s=(!0===TS.Vhs.xhr.original?gw:TS.Vhs.xhr)(t,function(e,t){return vw(s,e,t,i)}),a=s.abort;return s.abort=function(){return s.aborted=!0,a.apply(s,arguments)},s.uri=t.uri,s.requestTime=Date.now(),s};return e.original=!0,e},bw=function(e){var t,i={};return e.byterange&&(i.Range="bytes="+(t=e.byterange).offset+"-"+("bigint"==typeof t.offset||"bigint"==typeof t.length?N.BigInt(t.offset)+N.BigInt(t.length)-N.BigInt(1):t.offset+t.length-1)),i},Tw=function(e,t){return e.start(t)+"-"+e.end(t)},Sw=function(e,t){var i=e.toString(16);return"00".substring(0,2-i.length)+i+(t%2?" ":"")},ww=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},xw=function(e){var t={};return Object.keys(e).forEach(function(i){var n=e[i];ym(n)?t[i]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:t[i]=n}),t},Aw=function(e){var t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},Ew=function(e){return e.resolvedUri},Cw=function(e){for(var t=Array.prototype.slice.call(e),i=16,n="",r=0;r<t.length/i;r++)n+=t.slice(r*i,r*i+i).map(Sw).join("")+" "+t.slice(r*i,r*i+i).map(ww).join("")+"\n";return n},Mw=Object.freeze({__proto__:null,createTransferableMessage:xw,initSegmentId:Aw,segmentKeyId:Ew,hexDump:Cw,tagDump:function(e){var t=e.bytes;return Cw(t)},textRanges:function(e){var t,i="";for(t=0;t<e.length;t++)i+=Tw(e,t)+" ";return i}}),kw=function(e){var t=e.playlist,i=e.time,n=void 0===i?void 0:i,r=e.callback;if(!r)throw new Error("getProgramTime: callback must be provided");if(!t||void 0===n)return r({message:"getProgramTime: playlist and time must be provided"});var s=function(e,t){if(!t||!t.segments||0===t.segments.length)return null;for(var i,n=0,r=0;r<t.segments.length&&!(e<=(n=(i=t.segments[r]).videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:n+i.duration));r++);var s=t.segments[t.segments.length-1];if(s.videoTimingInfo&&s.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>n){if(e>n+.25*s.duration)return null;i=s}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:n-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}}(n,t);if(!s)return r({message:"valid programTime was not found"});if("estimate"===s.type)return r({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:s.estimatedStart});var a={mediaSeconds:n},o=function(e,t){if(!t.dateTimeObject)return null;var i=t.videoTimingInfo.transmuxerPrependedSeconds,n=e-(t.videoTimingInfo.transmuxedPresentationStart+i);return new Date(t.dateTimeObject.getTime()+1e3*n)}(n,s.segment);return o&&(a.programDateTime=o.toISOString()),r(null,a)},Iw=function e(t){var i=t.programTime,n=t.playlist,r=t.retryCount,s=void 0===r?2:r,a=t.seekTo,o=t.pauseAfterSeek,l=void 0===o||o,u=t.tech,c=t.callback;if(!c)throw new Error("seekToProgramTime: callback must be provided");if(void 0===i||!n||!a)return c({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!n.endList&&!u.hasStarted_)return c({message:"player must be playing a live stream to start buffering"});if(!function(e){if(!e.segments||0===e.segments.length)return!1;for(var t=0;t<e.segments.length;t++)if(!e.segments[t].dateTimeObject)return!1;return!0}(n))return c({message:"programDateTime tags must be provided in the manifest "+n.resolvedUri});var h=function(e,t){var i;try{i=new Date(e)}catch(u){return null}if(!t||!t.segments||0===t.segments.length)return null;var n=t.segments[0];if(i<n.dateTimeObject)return null;for(var r=0;r<t.segments.length-1&&(n=t.segments[r],!(i<t.segments[r+1].dateTimeObject));r++);var s,a=t.segments[t.segments.length-1],o=a.dateTimeObject,l=a.videoTimingInfo?(s=a.videoTimingInfo).transmuxedPresentationEnd-s.transmuxedPresentationStart-s.transmuxerPrependedSeconds:a.duration+.25*a.duration;return i>new Date(o.getTime()+1e3*l)?null:(i>o&&(n=a),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:ew.duration(t,t.mediaSequence+t.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})}(i,n);if(!h)return c({message:i+" was not found in the stream"});var d=h.segment,p=function(e,t){var i,n;try{i=new Date(e),n=new Date(t)}catch(s){}var r=i.getTime();return(n.getTime()-r)/1e3}(d.dateTimeObject,i);if("estimate"===h.type)return 0===s?c({message:i+" is not buffered yet. Try again"}):(a(h.estimatedStart+p),void u.one("seeked",function(){e({programTime:i,playlist:n,retryCount:s-1,seekTo:a,pauseAfterSeek:l,tech:u,callback:c})}));var f=d.start+p;u.one("seeked",function(){return c(null,u.currentTime())}),l&&u.pause(),a(f)},Pw=function(e,t){if(4===e.readyState)return t()},Lw=function(e,t,i){var n,r=[],s=!1,a=function(e,t,n,r){return t.abort(),s=!0,i(e,t,n,r)},o=function(e,t){if(!s){if(e)return a(e,t,"",r);var i=t.responseText.substring(r&&r.byteLength||0,t.responseText.length);if(r=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(t=t.filter(function(e){return e&&(e.byteLength||e.length)&&"string"!=typeof e}),t.length<=1)return vm(t[0]);var n=t.reduce(function(e,t,i){return e+(t.byteLength||t.length)},0),r=new Uint8Array(n),s=0;return t.forEach(function(e){e=vm(e),r.set(e,s),s+=e.byteLength}),r}(r,Cm(i,!0)),n=n||Lg(r),r.length<10||n&&r.length<n+2)return Pw(t,function(){return a(e,t,"",r)});var o=Zg(r);return"ts"===o&&r.length<188||!o&&r.length<376?Pw(t,function(){return a(e,t,"",r)}):a(null,t,o,r)}},l=t({uri:e,beforeSend:function(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function(t){return t.total,t.loaded,vw(e,null,{statusCode:e.status},o)})}},function(e,t){return vw(l,e,t,o)});return l},Dw=TS.EventTarget,Ow=TS.mergeOptions,Rw=function(e,t){if(!dw(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(var i=0;i<e.segments.length;i++){var n=e.segments[i],r=t.segments[i];if(n.uri!==r.uri)return!1;if(n.byterange||r.byterange){var s=n.byterange,a=r.byterange;if(s&&!a||!s&&a)return!1;if(s.offset!==a.offset||s.length!==a.length)return!1}}return!0},Nw=function(e,t,i,n){return"placeholder-uri-"+e+"-"+t+"-"+(n.attributes.NAME||i)},Fw=function(e,t,i){for(var n=!0,r=Ow(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts}),s=0;s<t.playlists.length;s++){var a=t.playlists[s];if(a.sidx){var o=Jm(a.sidx);i&&i[o]&&i[o].sidx&&Wm(a,i[o].sidx,a.sidx.resolvedUri)}var l=pw(r,a,Rw);l&&(r=l,n=!1)}return rw(t,function(e,t,i,s){if(e.playlists&&e.playlists.length){var a=e.playlists[0].id,o=pw(r,e.playlists[0],Rw);o&&(s in(r=o).mediaGroups[t][i]||(r.mediaGroups[t][i][s]=e),r.mediaGroups[t][i][s].playlists[0]=r.playlists[a],n=!1)}}),function(e,t){rw(e,function(i,n,r,s){s in t.mediaGroups[n][r]||delete e.mediaGroups[n][r][s]})}(r,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(n=!1),n?null:r},Uw=function(e,t){return(Boolean(!e.map&&!t.map)||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length))&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length},Bw=function(e,t){var i={};for(var n in e){var r=e[n].sidx;if(r){var s=Jm(r);if(!t[s])break;var a=t[s].sidxInfo;Uw(a,r)&&(i[s]=t[s])}}return i},jw=function(e){function t(t,i,n,r){var s;void 0===n&&(n={}),(s=e.call(this)||this).masterPlaylistLoader_=r||xf(s),r||(s.isMaster_=!0);var a=n,o=a.withCredentials,l=void 0!==o&&o,u=a.handleManifestRedirects,c=void 0!==u&&u;if(s.vhs_=i,s.withCredentials=l,s.handleManifestRedirects=c,!t)throw new Error("A non-empty playlist URL or object is required");return s.on("minimumUpdatePeriod",function(){s.refreshXml_()}),s.on("mediaupdatetimeout",function(){s.refreshMedia_(s.media().id)}),s.state="HAVE_NOTHING",s.loadedPlaylists_={},s.logger_=ES("DashPlaylistLoader"),s.isMaster_?(s.masterPlaylistLoader_.srcUrl=t,s.masterPlaylistLoader_.sidxMapping_={}):s.childPlaylist_=t,s}Ef(t,e);var i=t.prototype;return i.requestErrored_=function(e,t,i){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2}:e,i&&(this.state=i),this.trigger("error"),!0):void 0)},i.addSidxSegments_=function(e,t,i){var n=this,r=e.sidx&&Jm(e.sidx);if(e.sidx&&r&&!this.masterPlaylistLoader_.sidxMapping_[r]){var s=AS(this.handleManifestRedirects,e.sidx.resolvedUri),a=function(s,a){if(!n.requestErrored_(s,a,t)){var o,l=n.masterPlaylistLoader_.sidxMapping_;try{o=Ig(vm(a.response).subarray(8))}catch(u){return void n.requestErrored_(u,a,t)}return l[r]={sidxInfo:e.sidx,sidx:o},Wm(e,o,e.sidx.resolvedUri),i(!0)}};this.request=Lw(s,this.vhs_.xhr,function(t,i,r,o){if(t)return a(t,i);if(!r||"mp4"!==r)return a({status:i.status,message:"Unsupported "+(r||"unknown")+" container type for sidx segment at URL: "+s,response:"",playlist:e,internal:!0,blacklistDuration:1/0,code:2},i);var l=e.sidx.byterange,u=l.offset,c=l.length;if(o.length>=c+u)return a(t,{response:o.subarray(u,u+c),status:i.status,uri:i.uri});n.request=n.vhs_.xhr({uri:s,responseType:"arraybuffer",headers:bw({byterange:e.sidx.byterange})},a)})}else this.mediaRequest_=N.setTimeout(function(){return i(!1)},0)},i.dispose=function(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},N.clearTimeout(this.minimumUpdatePeriodTimeout_),N.clearTimeout(this.mediaRequest_),N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.off()},i.hasPendingRequest=function(){return this.request||this.mediaRequest_},i.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},i.media=function(e){var t=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var i=this.state;if("string"==typeof e){if(!this.masterPlaylistLoader_.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.masterPlaylistLoader_.master.playlists[e]}var n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,i,function(n){t.haveMetadata({startingState:i,playlist:e})}))},i.haveMetadata=function(e){var t=e.startingState,i=e.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[i.id]=i,this.mediaRequest_=null,this.refreshMedia_(i.id),"HAVE_MASTER"===t?this.trigger("loadedmetadata"):this.trigger("mediachange")},i.pause=function(){this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMaster_&&(N.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_),this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)},i.load=function(e){var t=this;N.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;var i=this.media();if(e){var n=i?i.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=N.setTimeout(function(){return t.load()},n)}else this.started?i&&!i.endList?(this.isMaster_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()},i.start=function(){var e=this;this.started=!0,this.isMaster_?this.requestMaster_(function(t,i){e.haveMaster_(),e.hasPendingRequest()||e.media_||e.media(e.masterPlaylistLoader_.master.playlists[0])}):this.mediaRequest_=N.setTimeout(function(){return e.haveMaster_()},0)},i.requestMaster_=function(e){var t=this;this.request=this.vhs_.xhr({uri:this.masterPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},function(i,n){if(!t.requestErrored_(i,n)){var r=n.responseText!==t.masterPlaylistLoader_.masterXml_;return t.masterPlaylistLoader_.masterXml_=n.responseText,n.responseHeaders&&n.responseHeaders.date?t.masterLoaded_=Date.parse(n.responseHeaders.date):t.masterLoaded_=Date.now(),t.masterPlaylistLoader_.srcUrl=AS(t.handleManifestRedirects,t.masterPlaylistLoader_.srcUrl,n),r?(t.handleMaster_(),void t.syncClientServerClock_(function(){return e(n,r)})):e(n,r)}"HAVE_NOTHING"===t.state&&(t.started=!1)})},i.syncClientServerClock_=function(e){var t=this,i=Mg(this.masterPlaylistLoader_.masterXml_);return null===i?(this.masterPlaylistLoader_.clientOffset_=this.masterLoaded_-Date.now(),e()):"DIRECT"===i.method?(this.masterPlaylistLoader_.clientOffset_=i.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:xS(this.masterPlaylistLoader_.srcUrl,i.value),method:i.method,withCredentials:this.withCredentials},function(n,r){if(t.request){if(n)return t.masterPlaylistLoader_.clientOffset_=t.masterLoaded_-Date.now(),e();var s;s="HEAD"===i.method?r.responseHeaders&&r.responseHeaders.date?Date.parse(r.responseHeaders.date):t.masterLoaded_:Date.parse(r.responseText),t.masterPlaylistLoader_.clientOffset_=s-Date.now(),e()}}))},i.haveMaster_=function(){this.state="HAVE_MASTER",this.isMaster_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)},i.handleMaster_=function(){this.mediaRequest_=null;var e,t,i,n,r,s,a,o=this.masterPlaylistLoader_.master,l=(e={masterXml:this.masterPlaylistLoader_.masterXml_,srcUrl:this.masterPlaylistLoader_.srcUrl,clientOffset:this.masterPlaylistLoader_.clientOffset_,sidxMapping:this.masterPlaylistLoader_.sidxMapping_,previousManifest:o},t=e.masterXml,i=e.srcUrl,n=e.clientOffset,r=e.sidxMapping,s=e.previousManifest,a=Cg(t,{manifestUri:i,clientOffset:n,sidxMapping:r,previousManifest:s}),aw(a,i,Nw),a);o&&(l=Fw(o,l,this.masterPlaylistLoader_.sidxMapping_)),this.masterPlaylistLoader_.master=l||o;var u=this.masterPlaylistLoader_.master.locations&&this.masterPlaylistLoader_.master.locations[0];return u&&u!==this.masterPlaylistLoader_.srcUrl&&(this.masterPlaylistLoader_.srcUrl=u),(!o||l&&l.minimumUpdatePeriod!==o.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),Boolean(l)},i.updateMinimumUpdatePeriodTimeout_=function(){var e=this.masterPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(N.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);var t=e.master&&e.master.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!=typeof t||t<=0?t<0&&this.logger_("found invalid minimumUpdatePeriod of "+t+", not setting a timeout"):this.createMUPTimeout_(t)},i.createMUPTimeout_=function(e){var t=this.masterPlaylistLoader_;t.minimumUpdatePeriodTimeout_=N.setTimeout(function(){t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)},i.refreshXml_=function(){var e=this;this.requestMaster_(function(t,i){var n,r,s;i&&(e.media_&&(e.media_=e.masterPlaylistLoader_.master.playlists[e.media_.id]),e.masterPlaylistLoader_.sidxMapping_=(n=e.masterPlaylistLoader_.master,r=e.masterPlaylistLoader_.sidxMapping_,s=Bw(n.playlists,r),rw(n,function(e,t,i,n){if(e.playlists&&e.playlists.length){var a=e.playlists;s=Ow(s,Bw(a,r))}}),s),e.addSidxSegments_(e.media(),e.state,function(t){e.refreshMedia_(e.media().id)}))})},i.refreshMedia_=function(e){var t=this;if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMaster_&&this.handleMaster_();var i=this.masterPlaylistLoader_.master.playlists,n=!this.media_||this.media_!==i[e];if(n?this.media_=i[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){!function e(){t.media().endList||(t.mediaUpdateTimeout=N.setTimeout(function(){t.trigger("mediaupdatetimeout"),e()},fw(t.media(),Boolean(n))))}()}this.trigger("loadedplaylist")},t}(Dw),zw={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30},Vw=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},Hw=function(e){return function(){var t=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(i){var t=new BlobBuilder;return t.append(e),URL.createObjectURL(t.getBlob())}}(e),i=Vw(new Worker(t));i.objURL=t;var n=i.terminate;return i.on=i.addEventListener,i.off=i.removeEventListener,i.terminate=function(){return URL.revokeObjectURL(t),n.call(this)},i}},qw=function(e){return"var browserWorkerPolyFill = "+Vw.toString()+";\nbrowserWorkerPolyFill(self);\n"+e},Gw=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},Ww=qw(Gw(function(){var e=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var n;return!!e[t]&&(n=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(n,1),n>-1)},this.trigger=function(t){var i,n,r,s;if(i=e[t])if(2===arguments.length)for(r=i.length,n=0;n<r;++n)i[n].call(this,arguments[1]);else{for(s=[],n=arguments.length,n=1;n<arguments.length;++n)s.push(arguments[n]);for(r=i.length,n=0;n<r;++n)i[n].apply(this,s)}},this.dispose=function(){e={}}}};e.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},e.prototype.push=function(e){this.trigger("data",e)},e.prototype.flush=function(e){this.trigger("done",e)},e.prototype.partialFlush=function(e){this.trigger("partialdone",e)},e.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},e.prototype.reset=function(e){this.trigger("reset",e)};var t,i,n,r,s,a,o,l,u,c,h,d,p,f,m,g,y,v,_,b,T,S,w,x,A,E,C,M,k,I,P,L,D,O,R,N,F,U,B,j,z=e,V=Math.pow(2,32),H={getUint64:function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.getBigUint64?(t=i.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(t):t:i.getUint32(0)*V+i.getUint32(4)},MAX_UINT32:V},q=H.MAX_UINT32;!function(){var e;if(S={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in S)S.hasOwnProperty(e)&&(S[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);w=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),A=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),x=new Uint8Array([0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),M={video:E,audio:C},P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]),L=new Uint8Array([0,0,0,0,0,0,0,0]),D=L,O=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R=L,k=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),t=function(e){var t,i,n=[],r=0;for(t=1;t<arguments.length;t++)n.push(arguments[t]);for(t=n.length;t--;)r+=n[t].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(e,4),t=0,r=8;t<n.length;t++)i.set(n[t],r),r+=n[t].byteLength;return i},i=function(){return t(S.dinf,t(S.dref,P))},n=function(e){return t(S.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},m=function(e){return t(S.hdlr,M[e])},f=function(e){var i=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(i[12]=e.samplerate>>>24&255,i[13]=e.samplerate>>>16&255,i[14]=e.samplerate>>>8&255,i[15]=255&e.samplerate),t(S.mdhd,i)},p=function(e){return t(S.mdia,f(e),m(e.type),a(e))},s=function(e){return t(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},a=function(e){return t(S.minf,"video"===e.type?t(S.vmhd,k):t(S.smhd,I),i(),y(e))},o=function(e,i){for(var n=[],r=i.length;r--;)n[r]=_(i[r]);return t.apply(null,[S.moof,s(e)].concat(n))},l=function(e){for(var i=e.length,n=[];i--;)n[i]=h(e[i]);return t.apply(null,[S.moov,c(4294967295)].concat(n).concat(u(e)))},u=function(e){for(var i=e.length,n=[];i--;)n[i]=b(e[i]);return t.apply(null,[S.mvex].concat(n))},c=function(e){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t(S.mvhd,i)},g=function(e){var i,n,r=e.samples||[],s=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)i=r[n].flags,s[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t(S.sdtp,s)},y=function(e){return t(S.stbl,v(e),t(S.stts,R),t(S.stsc,D),t(S.stsz,O),t(S.stco,L))},v=function(e){return t(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?N(e):F(e))},N=function(e){var i,n,r=e.sps||[],s=e.pps||[],a=[],o=[];for(i=0;i<r.length;i++)a.push((65280&r[i].byteLength)>>>8),a.push(255&r[i].byteLength),a=a.concat(Array.prototype.slice.call(r[i]));for(i=0;i<s.length;i++)o.push((65280&s[i].byteLength)>>>8),o.push(255&s[i].byteLength),o=o.concat(Array.prototype.slice.call(s[i]));if(n=[S.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t(S.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([r.length],a,[s.length],o))),t(S.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];n.push(t(S.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return t.apply(null,n)},F=function(e){return t(S.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),n(e))},d=function(e){var i=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return t(S.tkhd,i)},_=function(e){var i,n,r,s,a,o;return i=t(S.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(e.baseMediaDecodeTime/q),o=Math.floor(e.baseMediaDecodeTime%q),n=t(S.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),"audio"===e.type?(r=T(e,92),t(S.traf,i,n,r)):(s=g(e),r=T(e,s.length+92),t(S.traf,i,n,r,s))},h=function(e){return e.duration=e.duration||4294967295,t(S.trak,d(e),p(e))},b=function(e){var i=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(i[i.length-1]=0),t(S.trex,i)},j=function(e,t){var i=0,n=0,r=0,s=0;return e.length&&(void 0!==e[0].duration&&(i=1),void 0!==e[0].size&&(n=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(s=8)),[0,0,i|n|r|s,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},B=function(e,i){var n,r,s,a,o,l;for(i+=20+16*(a=e.samples||[]).length,s=j(a,i),(r=new Uint8Array(s.length+16*a.length)).set(s),n=s.length,l=0;l<a.length;l++)o=a[l],r[n++]=(4278190080&o.duration)>>>24,r[n++]=(16711680&o.duration)>>>16,r[n++]=(65280&o.duration)>>>8,r[n++]=255&o.duration,r[n++]=(4278190080&o.size)>>>24,r[n++]=(16711680&o.size)>>>16,r[n++]=(65280&o.size)>>>8,r[n++]=255&o.size,r[n++]=o.flags.isLeading<<2|o.flags.dependsOn,r[n++]=o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,r[n++]=61440&o.flags.degradationPriority,r[n++]=15&o.flags.degradationPriority,r[n++]=(4278190080&o.compositionTimeOffset)>>>24,r[n++]=(16711680&o.compositionTimeOffset)>>>16,r[n++]=(65280&o.compositionTimeOffset)>>>8,r[n++]=255&o.compositionTimeOffset;return t(S.trun,r)},U=function(e,i){var n,r,s,a,o,l;for(i+=20+8*(a=e.samples||[]).length,s=j(a,i),(n=new Uint8Array(s.length+8*a.length)).set(s),r=s.length,l=0;l<a.length;l++)o=a[l],n[r++]=(4278190080&o.duration)>>>24,n[r++]=(16711680&o.duration)>>>16,n[r++]=(65280&o.duration)>>>8,n[r++]=255&o.duration,n[r++]=(4278190080&o.size)>>>24,n[r++]=(16711680&o.size)>>>16,n[r++]=(65280&o.size)>>>8,n[r++]=255&o.size;return t(S.trun,n)},T=function(e,t){return"audio"===e.type?U(e,t):B(e,t)};r=function(){return t(S.ftyp,w,x,w,A)};var G,W,$,X,Y,Q,K,Z,J=function(e){return t(S.mdat,e)},ee=o,te=function(e){var t,i=r(),n=l(e);return(t=new Uint8Array(i.byteLength+n.byteLength)).set(i),t.set(n,i.byteLength),t},ie=function(e,t){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},ne=function(e){var t,i,n=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,n.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(i=e[t]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n),r},re=function(e){var t,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(i=e[t]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},se=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},ae=function(e,t){var i,n,r,s,a,o=t||0,l=[];for(i=0;i<e.length;i++)for(s=e[i],n=0;n<s.length;n++)a=s[n],o+=(r=ie(a,o)).size,l.push(r);return l},oe=function(e){var t,i,n,r,s,a,o=0,l=e.byteLength,u=e.nalCount,c=new Uint8Array(l+4*u),h=new DataView(c.buffer);for(t=0;t<e.length;t++)for(r=e[t],i=0;i<r.length;i++)for(s=r[i],n=0;n<s.length;n++)a=s[n],h.setUint32(o,a.data.byteLength),o+=4,c.set(a.data,o),o+=a.data.byteLength;return c},le=[33,16,5,32,164,27],ue=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ce=function(e){for(var t=[];e--;)t.push(0);return t},he=function(){if(!G){var e={96e3:[le,[227,64],ce(154),[56]],88200:[le,[231],ce(170),[56]],64e3:[le,[248,192],ce(240),[56]],48e3:[le,[255,192],ce(268),[55,148,128],ce(54),[112]],44100:[le,[255,192],ce(268),[55,163,128],ce(84),[112]],32e3:[le,[255,192],ce(268),[55,234],ce(226),[112]],24e3:[le,[255,192],ce(268),[55,255,128],ce(268),[111,112],ce(126),[224]],16e3:[le,[255,192],ce(268),[55,255,128],ce(268),[111,255],ce(269),[223,108],ce(195),[1,192]],12e3:[ue,ce(268),[3,127,248],ce(268),[6,255,240],ce(268),[13,255,224],ce(268),[27,253,128],ce(259),[56]],11025:[ue,ce(268),[3,127,248],ce(268),[6,255,240],ce(268),[13,255,224],ce(268),[27,255,192],ce(268),[55,175,128],ce(108),[112]],8e3:[ue,ce(268),[3,121,16],ce(47),[7]]};t=e,G=Object.keys(t).reduce(function(e,i){return e[i]=new Uint8Array(t[i].reduce(function(e,t){return e.concat(t)},[])),e},{})}var t;return G},de=9e4;Q=function(e,t){return W(Y(e,t))},K=function(e,t){return $(X(e),t)},Z=function(e,t,i){return X(i?e:e-t)};var pe=de,fe=W=function(e){return e*de},me=($=function(e,t){return e*t},X=function(e){return e/de}),ge=(Y=function(e,t){return e/t},Q),ye=K,ve=Z,_e=function(e,t,i,n){var r,s,a,o,l,u=0,c=0,h=0;if(t.length&&(r=ge(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(pe/(e.samplerate/1024)),i&&n&&(u=r-Math.max(i,n),h=(c=Math.floor(u/s))*s),!(c<1||h>pe/2))){for((a=he()[e.samplerate])||(a=t[0].data),o=0;o<c;o++)l=t[0],t.splice(0,0,{data:a,dts:l.dts-s,pts:l.pts-s});return e.baseMediaDecodeTime-=Math.floor(ye(h,e.samplerate)),h}},be=function(e,t,i){return t.minSegmentDts>=i?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=i&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},Te=function(e){var t,i,n=[];for(t=0;t<e.length;t++)i=e[t],n.push({size:i.data.byteLength,duration:1024});return n},Se=function(e){var t,i,n=0,r=new Uint8Array(function(e){var t,i=0;for(t=0;t<e.length;t++)i+=e[t].data.byteLength;return i}(e));for(t=0;t<e.length;t++)i=e[t],r.set(i.data,n),n+=i.data.byteLength;return r},we=pe,xe=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},Ae=function(e,t){var i,n=e.minSegmentDts;return t||(n-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=n,i=Math.max(0,i),"audio"===e.type&&(i*=e.samplerate/we,i=Math.floor(i)),i},Ee=function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},Ce=function(e){for(var t=0,i={payloadType:-1,payloadSize:0},n=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)n+=255,t++;for(n+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!i.payload&&4===n){if("GA94"===String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6])){i.payloadType=n,i.payloadSize=r,i.payload=e.subarray(t,t+r);break}i.payload=void 0}t+=r,n=0,r=0}return i},Me=function(e){return 181!==e.payload[0]||49!=(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},ke=function(e,t){var i,n,r,s,a=[];if(!(64&t[0]))return a;for(n=31&t[0],i=0;i<n;i++)s={type:3&t[(r=3*i)+2],pts:e},4&t[r+2]&&(s.ccData=t[r+3]<<8|t[r+4],a.push(s));return a},Ie=function(e){for(var t,i,n=e.byteLength,r=[],s=1;s<n-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=n-r.length,i=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),i[s]=e[a];return i},Pe=4,Le=function e(t){t=t||{},e.prototype.init.call(this),this.parse708captions_="boolean"!=typeof t.parse708captions||t.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Ve(0,0),new Ve(0,1),new Ve(1,0),new Ve(1,1)],this.parse708captions_&&(this.cc708Stream_=new Fe({captionServices:t.captionServices})),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};(Le.prototype=new z).push=function(e){var t,i,n;if("sei_rbsp"===e.nalUnitType&&(t=Ce(e.escapedRBSP)).payload&&t.payloadType===Pe&&(i=Me(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=ke(e.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},Le.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},Le.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},Le.prototype.flush=function(){return this.flushStream("flush")},Le.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Le.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},Le.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},Le.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},Le.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},Le.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)},Le.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var De={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Oe=function(e){return 32<=e&&e<=127||160<=e&&e<=255},Re=function(e){this.windowNum=e,this.reset()};Re.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Re.prototype.getText=function(){return this.rows.join("\n")},Re.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Re.prototype.newLine=function(e){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Re.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},Re.prototype.addText=function(e){this.rows[this.rowIdx]+=e},Re.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var Ne=function(e,t,i){this.serviceNum=e,this.text="",this.currentWindow=new Re(-1),this.windows=[],this.stream=i,"string"==typeof t&&this.createTextDecoder(t)};Ne.prototype.init=function(e,t){this.startPts=e;for(var i=0;i<8;i++)this.windows[i]=new Re(i),"function"==typeof t&&(this.windows[i].beforeRowOverflow=t)},Ne.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},Ne.prototype.createTextDecoder=function(e){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var Fe=function e(t){t=t||{},e.prototype.init.call(this);var i,n=this,r=t.captionServices||{},s={};Object.keys(r).forEach(function(e){i=r[e],/^SERVICE/.test(e)&&(s[e]=i.encoding)}),this.serviceEncodings=s,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(n.new708Packet(),n.add708Bytes(e)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(e))}};Fe.prototype=new z,Fe.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Fe.prototype.add708Bytes=function(e){var t=e.ccData,i=t>>>8,n=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(i),this.current708Packet.data.push(n)},Fe.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,i=null,n=null,r=0,s=t[r++];for(e.seq=s>>6,e.sizeCode=63&s;r<t.length;r++)n=31&(s=t[r++]),7===(i=s>>5)&&n>0&&(i=s=t[r++]),this.pushServiceBlock(i,r,n),n>0&&(r+=n-1)},Fe.prototype.pushServiceBlock=function(e,t,i){var n,r=t,s=this.current708Packet.data,a=this.services[e];for(a||(a=this.initService(e,r));r<t+i&&r<s.length;r++)n=s[r],Oe(n)?r=this.handleText(r,a):24===n?r=this.multiByteCharacter(r,a):16===n?r=this.extendedCommands(r,a):128<=n&&n<=135?r=this.setCurrentWindow(r,a):152<=n&&n<=159?r=this.defineWindow(r,a):136===n?r=this.clearWindows(r,a):140===n?r=this.deleteWindows(r,a):137===n?r=this.displayWindows(r,a):138===n?r=this.hideWindows(r,a):139===n?r=this.toggleWindows(r,a):151===n?r=this.setWindowAttributes(r,a):144===n?r=this.setPenAttributes(r,a):145===n?r=this.setPenColor(r,a):146===n?r=this.setPenLocation(r,a):143===n?a=this.reset(r,a):8===n?a.currentWindow.backspace():12===n?a.currentWindow.clearText():13===n?a.currentWindow.pendingNewLine=!0:14===n?a.currentWindow.clearText():141===n&&r++},Fe.prototype.extendedCommands=function(e,t){var i=this.current708Packet.data[++e];return Oe(i)&&(e=this.handleText(e,t,{isExtended:!0})),e},Fe.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},Fe.prototype.initService=function(e,t){var i,n,r=this;return(i="SERVICE"+e)in this.serviceEncodings&&(n=this.serviceEncodings[i]),this.services[e]=new Ne(e,n,r),this.services[e].init(this.getPts(t),function(t){r.flushDisplayed(t,r.services[e])}),this.services[e]},Fe.prototype.handleText=function(e,t,i){var n,r,s,a,o=i&&i.isExtended,l=i&&i.isMultiByte,u=this.current708Packet.data,c=o?4096:0,h=u[e],d=u[e+1],p=t.currentWindow;return t.textDecoder_&&!o?(l?(r=[h,d],e++):r=[h],n=t.textDecoder_.decode(new Uint8Array(r))):(a=De[s=c|h]||s,n=4096&s&&s===a?"":String.fromCharCode(a)),p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(e)),p.pendingNewLine=!1,p.addText(n),e},Fe.prototype.multiByteCharacter=function(e,t){var i=this.current708Packet.data,n=i[e+1],r=i[e+2];return Oe(n)&&Oe(r)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},Fe.prototype.setCurrentWindow=function(e,t){var i=7&this.current708Packet.data[e];return t.setCurrentWindow(i),e},Fe.prototype.defineWindow=function(e,t){var i=this.current708Packet.data,n=i[e],r=7&n;t.setCurrentWindow(r);var s=t.currentWindow;return n=i[++e],s.visible=(32&n)>>5,s.rowLock=(16&n)>>4,s.columnLock=(8&n)>>3,s.priority=7&n,n=i[++e],s.relativePositioning=(128&n)>>7,s.anchorVertical=127&n,n=i[++e],s.anchorHorizontal=n,n=i[++e],s.anchorPoint=(240&n)>>4,s.rowCount=15&n,n=i[++e],s.columnCount=63&n,n=i[++e],s.windowStyle=(56&n)>>3,s.penStyle=7&n,s.virtualRowCount=s.rowCount+1,e},Fe.prototype.setWindowAttributes=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.winAttr;return n=i[++e],r.fillOpacity=(192&n)>>6,r.fillRed=(48&n)>>4,r.fillGreen=(12&n)>>2,r.fillBlue=3&n,n=i[++e],r.borderType=(192&n)>>6,r.borderRed=(48&n)>>4,r.borderGreen=(12&n)>>2,r.borderBlue=3&n,n=i[++e],r.borderType+=(128&n)>>5,r.wordWrap=(64&n)>>6,r.printDirection=(48&n)>>4,r.scrollDirection=(12&n)>>2,r.justify=3&n,n=i[++e],r.effectSpeed=(240&n)>>4,r.effectDirection=(12&n)>>2,r.displayEffect=3&n,e},Fe.prototype.flushDisplayed=function(e,t){for(var i=[],n=0;n<8;n++)t.windows[n].visible&&!t.windows[n].isEmpty()&&i.push(t.windows[n].getText());t.endPts=e,t.text=i.join("\n\n"),this.pushCaption(t),t.startPts=e},Fe.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},Fe.prototype.displayWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible=1);return e},Fe.prototype.hideWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible=0);return e},Fe.prototype.toggleWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&(t.windows[r].visible^=1);return e},Fe.prototype.clearWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&t.windows[r].clearText();return e},Fe.prototype.deleteWindows=function(e,t){var i=this.current708Packet.data[++e],n=this.getPts(e);this.flushDisplayed(n,t);for(var r=0;r<8;r++)i&1<<r&&t.windows[r].reset();return e},Fe.prototype.setPenAttributes=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penAttr;return n=i[++e],r.textTag=(240&n)>>4,r.offset=(12&n)>>2,r.penSize=3&n,n=i[++e],r.italics=(128&n)>>7,r.underline=(64&n)>>6,r.edgeType=(56&n)>>3,r.fontStyle=7&n,e},Fe.prototype.setPenColor=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penColor;return n=i[++e],r.fgOpacity=(192&n)>>6,r.fgRed=(48&n)>>4,r.fgGreen=(12&n)>>2,r.fgBlue=3&n,n=i[++e],r.bgOpacity=(192&n)>>6,r.bgRed=(48&n)>>4,r.bgGreen=(12&n)>>2,r.bgBlue=3&n,n=i[++e],r.edgeRed=(48&n)>>4,r.edgeGreen=(12&n)>>2,r.edgeBlue=3&n,e},Fe.prototype.setPenLocation=function(e,t){var i=this.current708Packet.data,n=i[e],r=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,n=i[++e],r.row=15&n,n=i[++e],r.column=63&n,e},Fe.prototype.reset=function(e,t){var i=this.getPts(e);return this.flushDisplayed(i,t),this.initService(t.serviceNum,e)};var Ue={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Be=function(e){return null===e?"":(e=Ue[e]||e,String.fromCharCode(e))},je=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],ze=function(){for(var e=[],t=15;t--;)e.push("");return e},Ve=function e(t,i){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,i,n,r,s;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),n=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=ze();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=ze();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=ze()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(n,r))s=Be((n=(3&n)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),s=Be((n=(3&n)<<8)|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14&~r||this.addFormatting(e.pts,["i"]),1&~r||this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(n,r))this.column_+=3&r;else if(this.isPAC(n,r)){var a=je.indexOf(7968&t);"rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16&~t||(this.column_=4*((14&t)>>1)),this.isColorPAC(r)&&(14&~r||this.addFormatting(e.pts,["i"]))}else this.isNormalChar(n)&&(0===r&&(r=null),s=Be(n),s+=Be(r),this[this.mode_](e.pts,s),this.column_+=s.length)}else this.lastControlCode_=null}};Ve.prototype=new z,Ve.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e,t){try{return e.trim()}catch(i){return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+t+"."}),""}},this).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},Ve.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=ze(),this.nonDisplayed_=ze(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ve.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ve.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Ve.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Ve.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Ve.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Ve.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Ve.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Ve.prototype.isNormalChar=function(e){return e>=32&&e<=127},Ve.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=ze(),this.displayed_=ze()),void 0!==t&&t!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[t-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Ve.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)},Ve.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Ve.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_];i+=t,this.nonDisplayed_[this.row_]=i},Ve.prototype.rollUp=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i},Ve.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},Ve.prototype.paintOn=function(e,t){var i=this.displayed_[this.row_];i+=t,this.displayed_[this.row_]=i};var He={CaptionStream:Le,Cea608Stream:Ve,Cea708Stream:Fe},qe={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ge="shared",We=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>4294967296;)e+=8589934592*i;return e},$e=function e(t){var i,n;e.prototype.init.call(this),this.type_=t||Ge,this.push=function(e){this.type_!==Ge&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=We(e.dts,n),e.pts=We(e.pts,n),i=e.dts,this.trigger("data",e))},this.flush=function(){n=i,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,i=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};$e.prototype=new z;var Xe,Ye=$e,Qe=We,Ke=function(e,t,i){var n,r="";for(n=t;n<i;n++)r+="%"+("00"+e[n].toString(16)).slice(-2);return r},Ze=function(e,t,i){return decodeURIComponent(Ke(e,t,i))},Je=function(e,t,i){return unescape(Ke(e,t,i))},et=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},tt={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=Ze(e.data,1,t),e.value=Ze(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=Ze(e.data,1,t),e.url=Ze(e.data,t+1,e.data.length);break}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Je(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}};(Xe=function(e){var t,i={descriptor:e&&e.descriptor},n=0,r=[],s=0;if(Xe.prototype.init.call(this),this.dispatchType=qe.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(t=0;t<i.descriptor.length;t++)this.dispatchType+=("00"+i.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,i,a,o,l;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(s=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(e),s+=e.data.byteLength,1===r.length&&(n=et(e.data.subarray(6,10)),n+=10),!(s<n)){for(t={data:new Uint8Array(n),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<n;)t.data.set(r[0].data.subarray(0,n-l),l),l+=r[0].data.byteLength,s-=r[0].data.byteLength,r.shift();i=10,64&t.data[5]&&(i+=4,i+=et(t.data.subarray(10,14)),n-=et(t.data.subarray(16,20)));do{if((a=et(t.data.subarray(i+4,i+8)))<1)return void this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});if((o={id:String.fromCharCode(t.data[i],t.data[i+1],t.data[i+2],t.data[i+3]),data:t.data.subarray(i+10,i+a+10)}).key=o.id,tt[o.id]&&(tt[o.id](o),"com.apple.streaming.transportStreamTimestamp"===o.owner)){var u=o.data,c=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;c*=4,c+=3&u[7],o.timeStamp=c,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),i+=10,i+=a}while(i<n);this.trigger("data",t)}}}).prototype=new z;var it,nt,rt,st=Xe,at=Ye,ot=188;(it=function(){var e=new Uint8Array(ot),t=0;it.prototype.init.call(this),this.push=function(i){var n,r=0,s=ot;for(t?((n=new Uint8Array(i.byteLength+t)).set(e.subarray(0,t)),n.set(i,t),t=0):n=i;s<n.byteLength;)71!==n[r]||71!==n[s]?(r++,s++):(this.trigger("data",n.subarray(r,s)),r+=ot,s+=ot);r<n.byteLength&&(e.set(n.subarray(r),0),t=n.byteLength-r)},this.flush=function(){t===ot&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}}).prototype=new z,nt=function(){var e,t,i,n;nt.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,n){var r=0;n.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===n.type?t(e.subarray(r),n):i(e.subarray(r),n)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],n.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=n.pmtPid},i=function(e,t){var i,r;if(1&e[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<i;){var s=e[r],a=(31&e[r+1])<<8|e[r+2];s===qe.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=a:s===qe.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=a:s===qe.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][a]=s),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=n.programMapTable}},this.push=function(t){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&t[1]),i.pid=31&t[1],i.pid<<=8,i.pid|=t[2],(48&t[3])>>>4>1&&(n+=t[n]+1),0===i.pid)i.type="pat",e(t.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",e(t.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,n,i]):this.processPes_(t,n,i)},this.processPes_=function(e,t,i){i.pid===this.programMapTable.video?i.streamType=qe.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=qe.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=e.subarray(t),this.trigger("data",i)}},nt.prototype=new z,nt.STREAM_TYPES={h264:27,adts:15},(rt=function(){var e,t=this,i=!1,n={data:[],size:0},r={data:[],size:0},s={data:[],size:0},a=function(e,i,n){var r,s,a=new Uint8Array(e.size),o={type:i},l=0,u=0;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)s=e.data[l],a.set(s.data,u),u+=s.data.byteLength;var c,h,d,p;h=o,p=(c=a)[0]<<16|c[1]<<8|c[2],h.data=new Uint8Array,1===p&&(h.packetLength=6+(c[4]<<8|c[5]),h.dataAlignmentIndicator=!!(4&c[6]),192&(d=c[7])&&(h.pts=(14&c[9])<<27|(255&c[10])<<20|(254&c[11])<<12|(255&c[12])<<5|(254&c[13])>>>3,h.pts*=4,h.pts+=(6&c[13])>>>1,h.dts=h.pts,64&d&&(h.dts=(14&c[14])<<27|(255&c[15])<<20|(254&c[16])<<12|(255&c[17])<<5|(254&c[18])>>>3,h.dts*=4,h.dts+=(6&c[18])>>>1)),h.data=c.subarray(9+c[8])),r="video"===i||o.packetLength<=e.size,(n||r)&&(e.size=0,e.data.length=0),r&&t.trigger("data",o)}};rt.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,t;switch(o.streamType){case qe.H264_STREAM_TYPE:e=n,t="video";break;case qe.ADTS_STREAM_TYPE:e=r,t="audio";break;case qe.METADATA_STREAM_TYPE:e=s,t="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&a(e,t,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var n={type:"metadata",tracks:[]};null!==(e=o.programMapTable).video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),i=!0,t.trigger("data",n)}})[o.type]()},this.reset=function(){n.size=0,n.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){a(n,"video"),a(r,"audio"),a(s,"timed-metadata")},this.flush=function(){if(!i&&e){var n={type:"metadata",tracks:[]};null!==e.video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",n)}i=!1,this.flushStreams_(),this.trigger("done")}}).prototype=new z;var lt={PAT_PID:0,MP2T_PACKET_LENGTH:ot,TransportPacketStream:it,TransportParseStream:nt,ElementaryStream:rt,TimestampRolloverStream:at,CaptionStream:He.CaptionStream,Cea608Stream:He.Cea608Stream,Cea708Stream:He.Cea708Stream,MetadataStream:st};for(var ut in qe)qe.hasOwnProperty(ut)&&(lt[ut]=qe[ut]);var ct,ht=lt,dt=pe,pt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(ct=function(e){var t,i=0;ct.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:"adts skiping bytes "+e+" to "+t+" in frame "+i+" outside syncword"})},this.push=function(n){var r,s,a,o,l,u=0;if(e||(i=0),"audio"===n.type){var c;for(t&&t.length?(a=t,(t=new Uint8Array(a.byteLength+n.data.byteLength)).set(a),t.set(n.data,a.byteLength)):t=n.data;u+7<t.length;)if(255===t[u]&&240==(246&t[u+1])){if("number"==typeof c&&(this.skipWarn_(c,u),c=null),s=2*(1&~t[u+1]),r=(3&t[u+3])<<11|t[u+4]<<3|(224&t[u+5])>>5,l=(o=1024*(1+(3&t[u+6])))*dt/pt[(60&t[u+2])>>>2],t.byteLength-u<r)break;this.trigger("data",{pts:n.pts+i*l,dts:n.dts+i*l,sampleCount:o,audioobjecttype:1+(t[u+2]>>>6&3),channelcount:(1&t[u+2])<<2|(192&t[u+3])>>>6,samplerate:pt[(60&t[u+2])>>>2],samplingfrequencyindex:(60&t[u+2])>>>2,samplesize:16,data:t.subarray(u+7+s,u+r)}),i++,u+=r}else"number"!=typeof c&&(c=u),u++;"number"==typeof c&&(this.skipWarn_(c,u),c=null),t=t.subarray(u)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}}).prototype=new z;var ft,mt,gt,yt=ct,vt=function(e){var t=e.byteLength,i=0,n=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+n},this.loadWord=function(){var r=e.byteLength-t,s=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");s.set(e.subarray(r,r+a)),i=new DataView(s.buffer).getUint32(0),n=8*a,t-=a},this.skipBits=function(e){var r;n>e?(i<<=e,n-=e):(e-=n,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),i<<=e,n-=e)},this.readBits=function(e){var r=Math.min(n,e),s=i>>>32-r;return(n-=r)>0?i<<=r:t>0&&this.loadWord(),(r=e-r)>0?s<<r|this.readBits(r):s},this.skipLeadingZeros=function(){var e;for(e=0;e<n;++e)if(i&2147483648>>>e)return i<<=e,n-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(mt=function(){var e,t,i=0;mt.prototype.init.call(this),this.push=function(n){var r;t?((r=new Uint8Array(t.byteLength+n.data.byteLength)).set(t),r.set(n.data,t.byteLength),t=r):t=n.data;for(var s=t.byteLength;i<s-3;i++)if(1===t[i+2]){e=i+5;break}for(;e<s;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}i+3!==e-2&&this.trigger("data",t.subarray(i+3,e-2));do{e++}while(1!==t[e]&&e<s);i=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(i+3,e-2)),i=e-2,e+=3;break;default:e+=3}t=t.subarray(i),e-=i,i=0},this.reset=function(){t=null,i=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(i+3)),t=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new z,gt={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(ft=function(){var e,t,i,n,r,s,a,o=new mt;ft.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,i=e.pts,n=e.dts,o.push(e))},o.on("data",function(a){var o={trackId:t,pts:i,dts:n,data:a,nalUnitTypeCode:31&a[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(a.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(a.subarray(1)),o.config=s(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),o.on("partialdone",function(){e.trigger("partialdone")}),o.on("reset",function(){e.trigger("reset")}),o.on("endedtimeline",function(){e.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},a=function(e,t){var i,n=8,r=8;for(i=0;i<e;i++)0!==r&&(r=(n+t.readExpGolomb()+256)%256),n=0===r?n:r},r=function(e){for(var t,i,n=e.byteLength,r=[],s=1;s<n-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=n-r.length,i=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),i[s]=e[a];return i},s=function(e){var t,i,n,r,s,o,l,u,c,h,d,p,f=0,m=0,g=0,y=0,v=[1,1];if(i=(t=new vt(e)).readUnsignedByte(),r=t.readUnsignedByte(),n=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),gt[i]&&(3===(s=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(d=3!==s?8:12,p=0;p<d;p++)t.readBoolean()&&a(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(o=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),u=t.readUnsignedExpGolomb(),c=t.readUnsignedExpGolomb(),0===(h=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(f=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}v&&(v[0],v[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:16*(u+1)-2*f-2*m,height:(2-h)*(c+1)*16-2*g-2*y,sarRatio:v}}}).prototype=new z;var _t,bt={H264Stream:ft},Tt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],St=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return i=i>=0?i:0,(16&e[t+5])>>4?i+20:i+10},wt=function e(t,i){return t.length-i<10||t[i]!=="I".charCodeAt(0)||t[i+1]!=="D".charCodeAt(0)||t[i+2]!=="3".charCodeAt(0)?i:e(t,i+=St(t,i))},xt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},At=function(e,t,i){return unescape(function(e,t,i){var n,r="";for(n=t;n<i;n++)r+="%"+("00"+e[n].toString(16)).slice(-2);return r}(e,t,i))},Et={isLikelyAacData:function(e){var t=wt(e,0);return e.length>=t+2&&!(255&~e[t])&&!(240&~e[t+1])&&16==(22&e[t+1])},parseId3TagSize:St,parseAdtsSize:function(e,t){var i=(224&e[t+5])>>5,n=e[t+4]<<3;return 6144&e[t+3]|n|i},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&!(240&~e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return Tt[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,i,n;t=10,64&e[5]&&(t+=4,t+=xt(e.subarray(10,14)));do{if((i=xt(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){n=e.subarray(t+10,t+i+10);for(var r=0;r<n.byteLength;r++)if(0===n[r]){if("com.apple.streaming.transportStreamTimestamp"===At(n,0,r)){var s=n.subarray(r+1),a=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return a*=4,a+=3&s[7]}break}}t+=10,t+=i}while(t<e.byteLength);return null}};(_t=function(){var e=new Uint8Array,t=0;_t.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(i){var n,r,s,a,o=0,l=0;for(e.length?(a=e.length,(e=new Uint8Array(i.byteLength+a)).set(e.subarray(0,a)),e.set(i,a)):e=i;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255&~e[l]||240&~e[l+1])l++;else{if(e.length-l<7)break;if(l+(o=Et.parseAdtsSize(e,l))>e.length)break;s={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",s),l+=o}else{if(e.length-l<10)break;if(l+(o=Et.parseId3TagSize(e,l))>e.length)break;r={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",r),l+=o}n=e.length-l,e=n>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new z;var Ct,Mt,kt,It,Pt=_t,Lt=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Dt=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Ot=bt.H264Stream,Rt=Et.isLikelyAacData,Nt=pe,Ft=function(e,t){t.stream=e,this.trigger("log",t)},Ut=function(e,t){for(var i=Object.keys(t),n=0;n<i.length;n++){var r=i[n];"headOfPipeline"!==r&&t[r].on&&t[r].on("log",Ft.bind(e,r))}},Bt=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},jt=function(e,t,i,n,r,s){return{start:{dts:e,pts:e+(i-t)},end:{dts:e+(n-t),pts:e+(r-i)},prependedContentDuration:s,baseMediaDecodeTime:e}};(Mt=function(e,t){var i,n=[],r=0,s=0,a=1/0;i=(t=t||{}).firstSequenceNumber||0,Mt.prototype.init.call(this),this.push=function(t){Ee(e,t),e&&Lt.forEach(function(i){e[i]=t[i]}),n.push(t)},this.setEarliestDts=function(e){r=e},this.setVideoBaseMediaDecodeTime=function(e){a=e},this.setAudioAppendStart=function(e){s=e},this.flush=function(){var o,l,u,c,h,d,p;0!==n.length?(o=be(n,e,r),e.baseMediaDecodeTime=Ae(e,t.keepOriginalTimestamps),p=_e(e,o,s,a),e.samples=Te(o),u=J(Se(o)),n=[],l=ee(i,[e]),c=new Uint8Array(l.byteLength+u.byteLength),i++,c.set(l),c.set(u,l.byteLength),xe(e),h=Math.ceil(1024*Nt/e.samplerate),o.length&&(d=o.length*h,this.trigger("segmentTimingInfo",jt(ge(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+d,o[0].pts+d,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+d})),this.trigger("data",{track:e,boxes:c}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){xe(e),n=[],this.trigger("reset")}}).prototype=new z,(Ct=function(e,t){var i,n,r,s=[],a=[];i=(t=t||{}).firstSequenceNumber||0,Ct.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){Ee(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],Dt.forEach(function(t){e[t]=n[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),s.push(t)},this.flush=function(){for(var n,r,o,l,u,c,h,d,p=0;s.length&&"access_unit_delimiter_rbsp"!==s[0].nalUnitType;)s.shift();if(0===s.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(n=ne(s),(o=re(n))[0][0].keyFrame||((r=this.getGopForFusion_(s[0],e))?(p=r.duration,o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=se(o)),a.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");xe(e),o=f}Ee(e,o),e.samples=ae(o),u=J(oe(o)),e.baseMediaDecodeTime=Ae(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),h=o[0],d=o[o.length-1],this.trigger("segmentTimingInfo",jt(e.baseMediaDecodeTime,h.dts,h.pts,d.dts+d.duration,d.pts+d.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=ee(i,[e]),c=new Uint8Array(l.byteLength+u.byteLength),i++,c.set(l),c.set(u,l.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),s=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){xe(e),n=void 0,r=void 0},this.getGopForFusion_=function(t){var i,n,r,s,a,o=1/0;for(a=0;a<this.gopCache_.length;a++)r=(s=this.gopCache_[a]).gop,e.pps&&Bt(e.pps[0],s.pps[0])&&e.sps&&Bt(e.sps[0],s.sps[0])&&(r.dts<e.timelineStartInfo.dts||(i=t.dts-r.dts-r.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=s,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(e){var t,i,n,r,s,o,l,u;for(s=e.byteLength,o=e.nalCount,l=e.duration,t=i=0;t<a.length&&i<e.length&&(n=a[t],r=e[i],n.pts!==r.pts);)r.pts>n.pts?t++:(i++,s-=r.byteLength,o-=r.nalCount,l-=r.duration);return 0===i?e:i===e.length?null:((u=e.slice(i)).byteLength=s,u.duration=l,u.nalCount=o,u.pts=u[0].pts,u.dts=u[0].dts,u)},this.alignGopsAtEnd_=function(e){var t,i,n,r,s,o,l;for(t=a.length-1,i=e.length-1,s=null,o=!1;t>=0&&i>=0;){if(n=a[t],r=e[i],n.pts===r.pts){o=!0;break}n.pts>r.pts?t--:(t===a.length-1&&(s=i),i--)}if(!o&&null===s)return null;if(0===(l=o?i:s))return e;var u=e.slice(l),c=u.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return u.byteLength=c.byteLength,u.duration=c.duration,u.nalCount=c.nalCount,u.pts=u[0].pts,u.dts=u[0].dts,u},this.alignGopsWith=function(e){a=e}}).prototype=new z,(It=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==(e=e||{}).remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"==typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,It.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}}).prototype=new z,It.prototype.flush=function(e){var t,i,n,r,s=0,a={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Dt.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Lt.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?a.type=this.pendingTracks[0].type:a.type="combined",this.emittedTracks+=this.pendingTracks.length,n=te(this.pendingTracks),a.initSegment=new Uint8Array(n.byteLength),a.initSegment.set(n),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],s),s+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=ve(t.startPts,o,this.keepOriginalTimestamps),t.endTime=ve(t.endPts,o,this.keepOriginalTimestamps),a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=ve(i.pts,o,this.keepOriginalTimestamps),a.metadata.push(i);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),r=0;r<a.captions.length;r++)t=a.captions[r],this.trigger("caption",t);for(r=0;r<a.metadata.length;r++)i=a.metadata[r],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},It.prototype.setRemux=function(e){this.remuxTracks=e},(kt=function(e){var t,i,n=this,r=!0;kt.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new ht.MetadataStream,r.aacStream=new Pt,r.audioTimestampRolloverStream=new ht.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new ht.TimestampRolloverStream("timed-metadata"),r.adtsStream=new yt,r.coalesceStream=new It(e,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(e){r.aacStream.setTimestamp(e.timeStamp)}),r.aacStream.on("data",function(s){"timed-metadata"!==s.type&&"audio"!==s.type||r.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new Mt(i,e),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!t}))}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Ut(this,r)},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new ht.MetadataStream,r.packetStream=new ht.TransportPacketStream,r.parseStream=new ht.TransportParseStream,r.elementaryStream=new ht.ElementaryStream,r.timestampRolloverStream=new ht.TimestampRolloverStream,r.adtsStream=new yt,r.h264Stream=new Ot,r.captionStream=new ht.CaptionStream(e),r.coalesceStream=new It(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(s){var a;if("metadata"===s.type){for(a=s.tracks.length;a--;)t||"video"!==s.tracks[a].type?i||"audio"!==s.tracks[a].type||((i=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime):(t=s.tracks[a]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime;t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new Ct(t,e),r.videoSegmentStream.on("log",n.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",function(t){i&&!e.keepOriginalTimestamps&&(i.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-n.baseMediaDecodeTime))}),r.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){i&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.videoSegmentStream.on("timingInfo",n.trigger.bind(n,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),i&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new Mt(i,e),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!t})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(e){e.dispatchType=r.metadataStream.dispatchType,n.trigger("id3Frame",e)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Ut(this,r)},this.setBaseMediaDecodeTime=function(n){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=n),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,xe(i),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,xe(t),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var i=this.transmuxPipeline_;e.remux=t,i&&i.coalesceStream&&i.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(i){i.stream=e,t.trigger("log",i)}},this.push=function(e){if(r){var t=Rt(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new z;var zt,Vt,Ht,qt={Transmuxer:kt},Gt=function(e){return e>>>0},Wt=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},$t=Gt,Xt=function e(t,i){var n,r,s,a,o,l=[];if(!i.length)return null;for(n=0;n<t.byteLength;)r=$t(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3]),s=Wt(t.subarray(n+4,n+8)),a=r>1?n+r:t.byteLength,s===i[0]&&(1===i.length?l.push(t.subarray(n+8,a)):(o=e(t.subarray(n+8,a),i.slice(1))).length&&(l=l.concat(o))),n=a;return l},Yt=Gt,Qt=H.getUint64,Kt=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=Qt(e.subarray(4)):t.baseMediaDecodeTime=Yt(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},Zt=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},Jt=function(e){var t,i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},n=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&i.flags[2],s=4&i.flags[2],a=1&i.flags[1],o=2&i.flags[1],l=4&i.flags[1],u=8&i.flags[1],c=n.getUint32(4),h=8;for(r&&(i.dataOffset=n.getInt32(h),h+=4),s&&c&&(t={flags:Zt(e.subarray(h,h+4))},h+=4,a&&(t.duration=n.getUint32(h),h+=4),o&&(t.size=n.getUint32(h),h+=4),u&&(1===i.version?t.compositionTimeOffset=n.getInt32(h):t.compositionTimeOffset=n.getUint32(h),h+=4),i.samples.push(t),c--);c--;)t={},a&&(t.duration=n.getUint32(h),h+=4),o&&(t.size=n.getUint32(h),h+=4),l&&(t.flags=Zt(e.subarray(h,h+4)),h+=4),u&&(1===i.version?t.compositionTimeOffset=n.getInt32(h):t.compositionTimeOffset=n.getUint32(h),h+=4),i.samples.push(t);return i},ei=function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],s=2&n.flags[2],a=8&n.flags[2],o=16&n.flags[2],l=32&n.flags[2],u=65536&n.flags[0],c=131072&n.flags[0];return t=8,r&&(t+=4,n.baseDataOffset=i.getUint32(12),t+=4),s&&(n.sampleDescriptionIndex=i.getUint32(t),t+=4),a&&(n.defaultSampleDuration=i.getUint32(t),t+=4),o&&(n.defaultSampleSize=i.getUint32(t),t+=4),l&&(n.defaultSampleFlags=i.getUint32(t)),u&&(n.durationIsEmpty=!0),!r&&c&&(n.baseDataOffsetIsMoof=!0),n},ti="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ii="undefined"!=typeof window?window:void 0!==ti?ti:"undefined"!=typeof self?self:{},ni=Ie,ri=He.CaptionStream,si=function(e,t){for(var i=e,n=0;n<t.length;n++){var r=t[n];if(i<r.size)return r;i-=r.size}return null},ai=function(e,t){var i=Xt(e,["moof","traf"]),n=Xt(e,["mdat"]),r={},s=[];return n.forEach(function(e,t){var n=i[t];s.push({mdat:e,traf:n})}),s.forEach(function(e){var i,n,s=e.mdat,a=e.traf,o=Xt(a,["tfhd"]),l=ei(o[0]),u=l.trackId,c=Xt(a,["tfdt"]),h=c.length>0?Kt(c[0]).baseMediaDecodeTime:0,d=Xt(a,["trun"]);t===u&&d.length>0&&(i=function(e,t,i){var n=t,r=i.defaultSampleDuration||0,s=i.defaultSampleSize||0,a=i.trackId,o=[];return e.forEach(function(e){var t=Jt(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=s),e.trackId=a,e.dts=n,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"==typeof n?(e.pts=n+ii.BigInt(e.compositionTimeOffset),n+=ii.BigInt(e.duration)):(e.pts=n+e.compositionTimeOffset,n+=e.duration)}),o=o.concat(t)}),o}(d,h,l),n=function(e,t,i){var n,r,s,a,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<e.length;r+=s)if(s=o.getUint32(r),r+=4,!(s<=0))switch(31&e[r]){case 6:var u=e.subarray(r+1,r+1+s),c=si(r,t);if(n={nalUnitType:"sei_rbsp",size:s,data:u,escapedRBSP:ni(u),trackId:i},c)n.pts=c.pts,n.dts=c.dts,a=c;else{if(!a){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+i+". See mux.js#223."});break}n.pts=a.pts,n.dts=a.dts}l.seiNals.push(n)}return l}(s,i,u),r[u]||(r[u]={seiNals:[],logs:[]}),r[u].seiNals=r[u].seiNals.concat(n.seiNals),r[u].logs=r[u].logs.concat(n.logs))}),r},oi=function(){var e,t,i,n,r,s,a=!1;this.isInitialized=function(){return a},this.init=function(t){e=new ri,a=!0,s=!!t&&t.isPartial,e.on("data",function(e){e.startTime=e.startPts/n,e.endTime=e.endPts/n,r.captions.push(e),r.captionStreams[e.stream]=!0}),e.on("log",function(e){r.logs.push(e)})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length)&&(i!==e[0]||n!==t[i])},this.parse=function(e,s,a){var o;if(!this.isInitialized())return null;if(!s||!a)return null;if(this.isNewInit(s,a))i=s[0],n=a[i];else if(null===i||!n)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,s,a)}return o=function(e,t,i){if(null===t)return null;var n=ai(e,t)[t]||{};return{seiNals:n.seiNals,logs:n.logs,timescale:i}}(e,i,n),o&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;s?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},li=Gt,ui=function(e){return("00"+e.toString(16)).slice(-2)},ci=H.getUint64;zt=function(e,t){var i=Xt(t,["moof","traf"]).reduce(function(t,i){var n,r,s=Xt(i,["tfhd"])[0],a=li(s[4]<<24|s[5]<<16|s[6]<<8|s[7]),o=e[a]||9e4,l=Xt(i,["tfdt"])[0],u=new DataView(l.buffer,l.byteOffset,l.byteLength);return"bigint"==typeof(n=1===l[0]?ci(l.subarray(4,12)):u.getUint32(4))?r=n/ii.BigInt(o):"number"!=typeof n||isNaN(n)||(r=n/o),r<Number.MAX_SAFE_INTEGER&&(r=Number(r)),r<t&&(t=r),t},1/0);return"bigint"==typeof i||isFinite(i)?i:0},Vt=function(e){var t=Xt(e,["moov","trak"]),i=[];return t.forEach(function(e){var t,n,r={},s=Xt(e,["tkhd"])[0];s&&(n=(t=new DataView(s.buffer,s.byteOffset,s.byteLength)).getUint8(0),r.id=0===n?t.getUint32(12):t.getUint32(20));var a=Xt(e,["mdia","hdlr"])[0];if(a){var o=Wt(a.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=Xt(e,["mdia","minf","stbl","stsd"])[0];if(l){var u=l.subarray(8);r.codec=Wt(u.subarray(4,8));var c,h=Xt(u,[r.codec])[0];h&&(/^[asm]vc[1-9]$/i.test(r.codec)?(c=h.subarray(78),"avcC"===Wt(c.subarray(4,8))&&c.length>11?(r.codec+=".",r.codec+=ui(c[9]),r.codec+=ui(c[10]),r.codec+=ui(c[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(c=h.subarray(28),"esds"===Wt(c.subarray(4,8))&&c.length>20&&0!==c[19]?(r.codec+="."+ui(c[19]),r.codec+="."+ui(c[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var d=Xt(e,["mdia","mdhd"])[0];d&&(r.timescale=Ht(d)),i.push(r)}),i};var hi=zt,di=Vt,pi=(Ht=function(e){var t=0===e[0]?12:20;return li(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])},function(e){var t=31&e[1];return t<<=8,t|=e[2]}),fi=function(e){return!!(64&e[1])},mi=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},gi=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},yi={parseType:function(e,t){var i=pi(e);return 0===i?"pat":i===t?"pmt":t?"pes":null},parsePat:function(e){var t=fi(e),i=4+mi(e);return t&&(i+=e[i]+1),(31&e[i+10])<<8|e[i+11]},parsePmt:function(e){var t={},i=fi(e),n=4+mi(e);if(i&&(n+=e[n]+1),1&e[n+5]){var r;r=3+((15&e[n+1])<<8|e[n+2])-4;for(var s=12+((15&e[n+10])<<8|e[n+11]);s<r;){var a=n+s;t[(31&e[a+1])<<8|e[a+2]]=e[a],s+=5+((15&e[a+3])<<8|e[a+4])}return t}},parsePayloadUnitStartIndicator:fi,parsePesType:function(e,t){switch(t[pi(e)]){case qe.H264_STREAM_TYPE:return"video";case qe.ADTS_STREAM_TYPE:return"audio";case qe.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!fi(e))return null;var t=4+mi(e);if(t>=e.byteLength)return null;var i,n=null;return 192&(i=e[t+7])&&((n={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,n.pts*=4,n.pts+=(6&e[t+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,n.dts*=4,n.dts+=(6&e[t+18])>>>1)),n},videoPacketContainsKeyFrame:function(e){for(var t=4+mi(e),i=e.subarray(t),n=0,r=0,s=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===gi(31&i[r+3])&&(s=!0);do{n++}while(1!==i[n]&&n<i.length);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===gi(31&i[r+3])&&(s=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===gi(31&i[r+3])&&(s=!0),s}},vi=Qe,_i={};_i.ts=yi,_i.aac=Et;var bi=pe,Ti=188,Si=71,wi=function(e,t,i){for(var n,r,s,a,o=0,l=Ti,u=!1;l<=e.byteLength;)if(e[o]!==Si||e[l]!==Si&&l!==e.byteLength)o++,l++;else{if(n=e.subarray(o,l),"pes"===_i.ts.parseType(n,t.pid))r=_i.ts.parsePesType(n,t.table),s=_i.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&s&&(a=_i.ts.parsePesTime(n))&&(a.type="audio",i.audio.push(a),u=!0);if(u)break;o+=Ti,l+=Ti}for(o=(l=e.byteLength)-Ti,u=!1;o>=0;)if(e[o]!==Si||e[l]!==Si&&l!==e.byteLength)o--,l--;else{if(n=e.subarray(o,l),"pes"===_i.ts.parseType(n,t.pid))r=_i.ts.parsePesType(n,t.table),s=_i.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&s&&(a=_i.ts.parsePesTime(n))&&(a.type="audio",i.audio.push(a),u=!0);if(u)break;o-=Ti,l-=Ti}},xi=function(e,t,i){for(var n,r,s,a,o,l,u,c=0,h=Ti,d=!1,p={data:[],size:0};h<e.byteLength;)if(e[c]!==Si||e[h]!==Si)c++,h++;else{if(n=e.subarray(c,h),"pes"===_i.ts.parseType(n,t.pid))if(r=_i.ts.parsePesType(n,t.table),s=_i.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(s&&!d&&(a=_i.ts.parsePesTime(n))&&(a.type="video",i.video.push(a),d=!0),!i.firstKeyFrame)){if(s&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)u=p.data.shift(),o.set(u,l),l+=u.byteLength;if(_i.ts.videoPacketContainsKeyFrame(o)){var f=_i.ts.parsePesTime(o);f&&(i.firstKeyFrame=f,i.firstKeyFrame.type="video")}p.size=0}p.data.push(n),p.size+=n.byteLength}if(d&&i.firstKeyFrame)break;c+=Ti,h+=Ti}for(c=(h=e.byteLength)-Ti,d=!1;c>=0;)if(e[c]!==Si||e[h]!==Si)c--,h--;else{if(n=e.subarray(c,h),"pes"===_i.ts.parseType(n,t.pid))r=_i.ts.parsePesType(n,t.table),s=_i.ts.parsePayloadUnitStartIndicator(n),"video"===r&&s&&(a=_i.ts.parsePesTime(n))&&(a.type="video",i.video.push(a),d=!0);if(d)break;c-=Ti,h-=Ti}},Ai=function(e){var t={pid:null,table:null},i={};for(var n in function(e,t){for(var i,n=0,r=Ti;r<e.byteLength;)if(e[n]!==Si||e[r]!==Si)n++,r++;else{switch(i=e.subarray(n,r),_i.ts.parseType(i,t.pid)){case"pat":t.pid=_i.ts.parsePat(i);break;case"pmt":var s=_i.ts.parsePmt(i);t.table=t.table||{},Object.keys(s).forEach(function(e){t.table[e]=s[e]})}n+=Ti,r+=Ti}}(e,t),t.table){if(t.table.hasOwnProperty(n))switch(t.table[n]){case qe.H264_STREAM_TYPE:i.video=[],xi(e,t,i),0===i.video.length&&delete i.video;break;case qe.ADTS_STREAM_TYPE:i.audio=[],wi(e,t,i),0===i.audio.length&&delete i.audio}}return i},Ei=function(e,t){var i;return i=_i.aac.isLikelyAacData(e)?function(e){for(var t,i=!1,n=0,r=null,s=null,a=0,o=0;e.length-o>=3;){switch(_i.aac.parseType(e,o)){case"timed-metadata":if(e.length-o<10){i=!0;break}if((a=_i.aac.parseId3TagSize(e,o))>e.length){i=!0;break}null===s&&(t=e.subarray(o,o+a),s=_i.aac.parseAacTimestamp(t)),o+=a;break;case"audio":if(e.length-o<7){i=!0;break}if((a=_i.aac.parseAdtsSize(e,o))>e.length){i=!0;break}null===r&&(t=e.subarray(o,o+a),r=_i.aac.parseSampleRate(t)),n++,o+=a;break;default:o++}if(i)return null}if(null===r||null===s)return null;var l=bi/r;return{audio:[{type:"audio",dts:s,pts:s},{type:"audio",dts:s+1024*n*l,pts:s+1024*n*l}]}}(e):Ai(e),i&&(i.audio||i.video)?(function(e,t){if(e.audio&&e.audio.length){var i=t;(void 0===i||isNaN(i))&&(i=e.audio[0].dts),e.audio.forEach(function(e){e.dts=vi(e.dts,i),e.pts=vi(e.pts,i),e.dtsTime=e.dts/bi,e.ptsTime=e.pts/bi})}if(e.video&&e.video.length){var n=t;if((void 0===n||isNaN(n))&&(n=e.video[0].dts),e.video.forEach(function(e){e.dts=vi(e.dts,n),e.pts=vi(e.pts,n),e.dtsTime=e.dts/bi,e.ptsTime=e.pts/bi}),e.firstKeyFrame){var r=e.firstKeyFrame;r.dts=vi(r.dts,n),r.pts=vi(r.pts,n),r.dtsTime=r.dts/bi,r.ptsTime=r.pts/bi}}}(i,t),i):null},Ci=function(){function e(e,t){this.options=t||{},this.self=e,this.init()}var t=e.prototype;return t.init=function(){var e,t;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new qt.Transmuxer(this.options),e=this.self,(t=this.transmuxer).on("data",function(t){var i=t.initSegment;t.initSegment={data:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength};var n=t.data;t.data=n.buffer,e.postMessage({action:"data",segment:t,byteOffset:n.byteOffset,byteLength:n.byteLength},[t.data])}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){var i={start:{decode:me(t.start.dts),presentation:me(t.start.pts)},end:{decode:me(t.end.dts),presentation:me(t.end.pts)},baseMediaDecodeTime:me(t.baseMediaDecodeTime)};t.prependedContentDuration&&(i.prependedContentDuration=me(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:i})}),t.on("audioSegmentTimingInfo",function(t){var i={start:{decode:me(t.start.dts),presentation:me(t.start.pts)},end:{decode:me(t.end.dts),presentation:me(t.end.pts)},baseMediaDecodeTime:me(t.baseMediaDecodeTime)};t.prependedContentDuration&&(i.prependedContentDuration=me(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:i})}),t.on("id3Frame",function(t){e.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){e.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){e.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:me(t.start),end:me(t.end)}})}),t.on("videoTimingInfo",function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:me(t.start),end:me(t.end)}})}),t.on("log",function(t){e.postMessage({action:"log",log:t})})},t.pushMp4Captions=function(e){this.captionParser||(this.captionParser=new oi,this.captionParser.init());var t=new Uint8Array(e.data,e.byteOffset,e.byteLength),i=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:i&&i.captions||[],logs:i&&i.logs||[],data:t.buffer},[t.buffer])},t.probeMp4StartTime=function(e){var t=e.timescales,i=e.data,n=hi(t,i);this.self.postMessage({action:"probeMp4StartTime",startTime:n,data:i},[i.buffer])},t.probeMp4Tracks=function(e){var t=e.data,i=di(t);this.self.postMessage({action:"probeMp4Tracks",tracks:i,data:t},[t.buffer])},t.probeTs=function(e){var t=e.data,i=e.baseStartTime,n="number"!=typeof i||isNaN(i)?void 0:i*pe,r=Ei(t,n),s=null;r&&((s={hasVideo:r.video&&2===r.video.length||!1,hasAudio:r.audio&&2===r.audio.length||!1}).hasVideo&&(s.videoStart=r.video[0].ptsTime),s.hasAudio&&(s.audioStart=r.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:s,data:t},[t.buffer])},t.clearAllMp4Captions=function(){this.captionParser&&this.captionParser.clearAllCaptions()},t.clearParsedMp4Captions=function(){this.captionParser&&this.captionParser.clearParsedCaptions()},t.push=function(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)},t.reset=function(){this.transmuxer.reset()},t.setTimestampOffset=function(e){var t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(fe(t)))},t.setAudioAppendStart=function(e){this.transmuxer.setAudioAppendStart(Math.ceil(fe(e.appendStart)))},t.setRemux=function(e){this.transmuxer.setRemux(e.remux)},t.flush=function(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})},t.endTimeline=function(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})},t.alignGopsWith=function(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())},e}();self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new Ci(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new Ci(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}})),$w=Hw(Ww),Xw=function(e){var t=e.transmuxer,i=e.bytes,n=e.audioAppendStart,r=e.gopsToAlignWith,s=e.remux,a=e.onData,o=e.onTrackInfo,l=e.onAudioTimingInfo,u=e.onVideoTimingInfo,c=e.onVideoSegmentTimingInfo,h=e.onAudioSegmentTimingInfo,d=e.onId3,p=e.onCaptions,f=e.onDone,m=e.onEndedTimeline,g=e.onTransmuxerLog,y=e.isEndOfTimeline,v={buffer:[]},_=y;if(t.onmessage=function(i){t.currentTransmux===e&&("data"===i.data.action&&function(e,t,i){var n=e.data.segment,r=n.type,s=n.initSegment,a=n.captions,o=n.captionStreams,l=n.metadata,u=n.videoFrameDtsTime,c=n.videoFramePtsTime;t.buffer.push({captions:a,captionStreams:o,metadata:l});var h=e.data.segment.boxes||{data:e.data.segment.data},d={type:r,data:new Uint8Array(h.data,h.data.byteOffset,h.data.byteLength),initSegment:new Uint8Array(s.data,s.byteOffset,s.byteLength)};void 0!==u&&(d.videoFrameDtsTime=u),void 0!==c&&(d.videoFramePtsTime=c),i(d)}(i,v,a),"trackinfo"===i.data.action&&o(i.data.trackInfo),"gopInfo"===i.data.action&&function(e,t){t.gopInfo=e.data.gopInfo}(i,v),"audioTimingInfo"===i.data.action&&l(i.data.audioTimingInfo),"videoTimingInfo"===i.data.action&&u(i.data.videoTimingInfo),"videoSegmentTimingInfo"===i.data.action&&c(i.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===i.data.action&&h(i.data.audioSegmentTimingInfo),"id3Frame"===i.data.action&&d([i.data.id3Frame],i.data.id3Frame.dispatchType),"caption"===i.data.action&&p(i.data.caption),"endedtimeline"===i.data.action&&(_=!1,m()),"log"===i.data.action&&g(i.data.log),"transmuxed"===i.data.type&&(_||(t.onmessage=null,function(e){var t=e.transmuxedData,i=e.callback;t.buffer=[],i(t)}({transmuxedData:v,callback:f}),Yw(t))))},n&&t.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),void 0!==s&&t.postMessage({action:"setRemux",remux:s}),i.byteLength){var b=i instanceof ArrayBuffer?i:i.buffer,T=i instanceof ArrayBuffer?0:i.byteOffset;t.postMessage({action:"push",data:b,byteOffset:T,byteLength:i.byteLength},[b])}y&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},Yw=function(e){e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"==typeof e.currentTransmux?e.currentTransmux():Xw(e.currentTransmux))},Qw=function(e,t){e.postMessage({action:t}),Yw(e)},Kw=function(e,t){if(!t.currentTransmux)return t.currentTransmux=e,void Qw(t,e);t.transmuxQueue.push(Qw.bind(null,t,e))},Zw=function(e){if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void Xw(e);e.transmuxer.transmuxQueue.push(e)},Jw=function(e){Kw("reset",e)},ex=function(e){var t=new $w;t.currentTransmux=null,t.transmuxQueue=[];var i=t.terminate;return t.terminate=function(){return t.currentTransmux=null,t.transmuxQueue.length=0,i.call(t)},t.postMessage({action:"init",options:e}),t},tx=function(e){var t=e.transmuxer,i=e.endAction||e.action,n=e.callback,r=ye({},e,{endAction:null,transmuxer:null,callback:null});if(t.addEventListener("message",function r(s){s.data.action===i&&(t.removeEventListener("message",r),s.data.data&&(s.data.data=new Uint8Array(s.data.data,e.byteOffset||0,e.byteLength||s.data.data.byteLength),e.data&&(e.data=s.data.data)),n(s.data))}),e.data){var s=e.data instanceof ArrayBuffer;r.byteOffset=s?0:e.data.byteOffset,r.byteLength=e.data.byteLength;var a=[s?e.data:e.data.buffer];t.postMessage(r,a)}else t.postMessage(r)},ix=2,nx=-101,rx=-102,sx=function(e){e.forEach(function(e){e.abort()})},ax=function(e,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:nx,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:rx,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:ix,xhr:t}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:ix,xhr:t}:null},ox=function(e,t,i){return function(n,r){var s=r.response,a=ax(n,r);if(a)return i(a,e);if(16!==s.byteLength)return i({status:r.status,message:"Invalid HLS key at URL: "+r.uri,code:ix,xhr:r},e);for(var o=new DataView(s),l=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]),u=0;u<t.length;u++)t[u].bytes=l;return i(null,e)}},lx=function(e,t){var i=Zg(e.map.bytes);if("mp4"!==i){var n=e.map.resolvedUri||e.map.uri;return t({internal:!0,message:"Found unsupported "+(i||"unknown")+" container for initialization segment at URL: "+n,code:ix})}tx({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:function(i){var n=i.tracks,r=i.data;return e.map.bytes=r,n.forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"==typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale))}),t(null)}})},ux=function(e){var t=e.segment,i=e.finishProcessingFn,n=e.responseType;return function(e,r){var s=ax(e,r);if(s)return i(s,t);var a="arraybuffer"!==n&&r.responseText?function(e){for(var t=new Uint8Array(new ArrayBuffer(e.length)),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t.buffer}(r.responseText.substring(t.lastReachedChar||0)):r.response;return t.stats=function(e){return{bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}}(r),t.key?t.encryptedBytes=new Uint8Array(a):t.bytes=new Uint8Array(a),i(null,t)}},cx=function(e){var t=e.segment,i=e.bytes,n=e.trackInfoFn,r=e.timingInfoFn,s=e.videoSegmentTimingInfoFn,a=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,c=e.endedTimelineFn,h=e.dataFn,d=e.doneFn,p=e.onTransmuxerLog,f=t.map&&t.map.tracks||{},m=Boolean(f.audio&&f.video),g=r.bind(null,t,"audio","start"),y=r.bind(null,t,"audio","end"),v=r.bind(null,t,"video","start"),_=r.bind(null,t,"video","end");tx({action:"probeTs",transmuxer:t.transmuxer,data:i,baseStartTime:t.baseStartTime,callback:function(e){t.bytes=i=e.data;var r=e.result;r&&(n(t,{hasAudio:r.hasAudio,hasVideo:r.hasVideo,isMuxed:m}),n=null,r.hasAudio&&!m&&g(r.audioStart),r.hasVideo&&v(r.videoStart),g=null,v=null),Zw({bytes:i,transmuxer:t.transmuxer,audioAppendStart:t.audioAppendStart,gopsToAlignWith:t.gopsToAlignWith,remux:m,onData:function(e){e.type="combined"===e.type?"video":e.type,h(t,e)},onTrackInfo:function(e){n&&(m&&(e.isMuxed=!0),n(t,e))},onAudioTimingInfo:function(e){g&&void 0!==e.start&&(g(e.start),g=null),y&&void 0!==e.end&&y(e.end)},onVideoTimingInfo:function(e){v&&void 0!==e.start&&(v(e.start),v=null),_&&void 0!==e.end&&_(e.end)},onVideoSegmentTimingInfo:function(e){s(e)},onAudioSegmentTimingInfo:function(e){a(e)},onId3:function(e,i){o(t,e,i)},onCaptions:function(e){l(t,[e])},isEndOfTimeline:u,onEndedTimeline:function(){c()},onTransmuxerLog:p,onDone:function(e){d&&(e.type="combined"===e.type?"video":e.type,d(null,t,e))}})}})},hx=function(e){var t=e.segment,i=e.bytes,n=e.trackInfoFn,r=e.timingInfoFn,s=e.videoSegmentTimingInfoFn,a=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,c=e.endedTimelineFn,h=e.dataFn,d=e.doneFn,p=e.onTransmuxerLog,f=new Uint8Array(i);if(function(e){return Og(e,["moof"]).length>0}(f)){t.isFmp4=!0;var m=t.map.tracks,g={isFmp4:!0,hasVideo:!!m.video,hasAudio:!!m.audio};m.audio&&m.audio.codec&&"enca"!==m.audio.codec&&(g.audioCodec=m.audio.codec),m.video&&m.video.codec&&"encv"!==m.video.codec&&(g.videoCodec=m.video.codec),m.video&&m.audio&&(g.isMuxed=!0),n(t,g);var y=function(e){h(t,{data:f,type:g.hasAudio&&!g.isMuxed?"audio":"video"}),e&&e.length&&l(t,e),d(null,t,{})};tx({action:"probeMp4StartTime",timescales:t.map.timescales,data:f,transmuxer:t.transmuxer,callback:function(e){var n=e.data,s=e.startTime;i=n.buffer,t.bytes=f=n,g.hasAudio&&!g.isMuxed&&r(t,"audio","start",s),g.hasVideo&&r(t,"video","start",s),m.video&&n.byteLength&&t.transmuxer?tx({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:t.transmuxer,data:f,timescales:t.map.timescales,trackIds:[m.video.id],callback:function(e){i=e.data.buffer,t.bytes=f=e.data,e.logs.forEach(function(e){p(TS.mergeOptions(e,{stream:"mp4CaptionParser"}))}),y(e.captions)}}):y()}})}else if(t.transmuxer){if(void 0===t.container&&(t.container=Zg(f)),"ts"!==t.container&&"aac"!==t.container)return n(t,{hasAudio:!1,hasVideo:!1}),void d(null,t,{});cx({segment:t,bytes:i,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:d,onTransmuxerLog:p})}else d(null,t,{})},dx=function(e,t){var i,n=e.id,r=e.key,s=e.encryptedBytes,a=e.decryptionWorker;a.addEventListener("message",function e(i){if(i.data.source===n){a.removeEventListener("message",e);var r=i.data.decrypted;t(new Uint8Array(r.bytes,r.byteOffset,r.byteLength))}}),i=r.bytes.slice?r.bytes.slice():new Uint32Array(Array.prototype.slice.call(r.bytes)),a.postMessage(xw({source:n,encrypted:s,key:i,iv:r.iv}),[s.buffer,i.buffer])},px=function(e){var t=e.activeXhrs,i=e.decryptionWorker,n=e.trackInfoFn,r=e.timingInfoFn,s=e.videoSegmentTimingInfoFn,a=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,c=e.endedTimelineFn,h=e.dataFn,d=e.doneFn,p=e.onTransmuxerLog,f=0,m=!1;return function(e,g){if(!m){if(e)return m=!0,sx(t),d(e,g);if((f+=1)===t.length){var y=function(){if(g.encryptedBytes)return function(e){var t=e.decryptionWorker,i=e.segment,n=e.trackInfoFn,r=e.timingInfoFn,s=e.videoSegmentTimingInfoFn,a=e.audioSegmentTimingInfoFn,o=e.id3Fn,l=e.captionsFn,u=e.isEndOfTimeline,c=e.endedTimelineFn,h=e.dataFn,d=e.doneFn,p=e.onTransmuxerLog;dx({id:i.requestId,key:i.key,encryptedBytes:i.encryptedBytes,decryptionWorker:t},function(e){i.bytes=e,hx({segment:i,bytes:i.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:d,onTransmuxerLog:p})})}({decryptionWorker:i,segment:g,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:d,onTransmuxerLog:p});hx({segment:g,bytes:g.bytes,trackInfoFn:n,timingInfoFn:r,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:c,dataFn:h,doneFn:d,onTransmuxerLog:p})};if(g.endOfAllRequests=Date.now(),g.map&&g.map.encryptedBytes&&!g.map.bytes)return dx({decryptionWorker:i,id:g.requestId+"-init",encryptedBytes:g.map.encryptedBytes,key:g.map.key},function(e){g.map.bytes=e,lx(g,function(e){if(e)return sx(t),d(e,g);y()})});y()}}}},fx=function(e){var t=e.segment,i=e.progressFn;return function(e){if(!e.target.aborted)return t.stats=TS.mergeOptions(t.stats,function(e){var t=e.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return i.bytesReceived=e.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i}(e)),!t.stats.firstBytesReceivedAt&&t.stats.bytesReceived&&(t.stats.firstBytesReceivedAt=Date.now()),i(e,t)}},mx=function(e){var t=e.xhr,i=e.xhrOptions,n=e.decryptionWorker,r=e.segment,s=e.abortFn,a=e.progressFn,o=e.trackInfoFn,l=e.timingInfoFn,u=e.videoSegmentTimingInfoFn,c=e.audioSegmentTimingInfoFn,h=e.id3Fn,d=e.captionsFn,p=e.isEndOfTimeline,f=e.endedTimelineFn,m=e.dataFn,g=e.doneFn,y=e.onTransmuxerLog,v=[],_=px({activeXhrs:v,decryptionWorker:n,trackInfoFn:o,timingInfoFn:l,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:c,id3Fn:h,captionsFn:d,isEndOfTimeline:p,endedTimelineFn:f,dataFn:m,doneFn:g,onTransmuxerLog:y});if(r.key&&!r.key.bytes){var b=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&b.push(r.map.key);var T=t(TS.mergeOptions(i,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),ox(r,b,_));v.push(T)}if(r.map&&!r.map.bytes){if(r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri)){var S=t(TS.mergeOptions(i,{uri:r.map.key.resolvedUri,responseType:"arraybuffer"}),ox(r,[r.map.key],_));v.push(S)}var w=TS.mergeOptions(i,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:bw(r.map)}),x=function(e){var t=e.segment,i=e.finishProcessingFn;return function(e,n){var r=ax(e,n);if(r)return i(r,t);var s=new Uint8Array(n.response);if(t.map.key)return t.map.encryptedBytes=s,i(null,t);t.map.bytes=s,lx(t,function(e){if(e)return e.xhr=n,e.status=n.status,i(e,t);i(null,t)})}}({segment:r,finishProcessingFn:_}),A=t(w,x);v.push(A)}var E=TS.mergeOptions(i,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:bw(r)}),C=t(E,ux({segment:r,finishProcessingFn:_,responseType:E.responseType}));C.addEventListener("progress",fx({segment:r,progressFn:a})),v.push(C);var M={};return v.forEach(function(e){e.addEventListener("loadend",function(e){var t=e.loadendState,i=e.abortFn;return function(e){e.target.aborted&&i&&!t.calledAbortFn&&(i(),t.calledAbortFn=!0)}}({loadendState:M,abortFn:s}))}),function(){return sx(v)}},gx=ES("CodecUtils"),yx=function(e,t){var i=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&i.AUDIO&&e.mediaGroups.AUDIO[i.AUDIO]},vx=function(e){var t={};return e.forEach(function(e){var i=e.mediaType,n=e.type,r=e.details;t[i]=t[i]||[],t[i].push(om(""+n+r))}),Object.keys(t).forEach(function(e){if(t[e].length>1)return gx("multiple "+e+" codecs found as attributes: "+t[e].join(", ")+". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs."),void(t[e]=null);t[e]=t[e][0]}),t},_x=function(e){var t=0;return e.audio&&t++,e.video&&t++,t},bx=function(e,t){var i=t.attributes||{},n=vx(function(e){var t=e.attributes||{};if(t.CODECS)return lm(t.CODECS)}(t)||[]);if(yx(e,t)&&!n.audio&&!function(e,t){if(!yx(e,t))return!0;var i=t.attributes||{},n=e.mediaGroups.AUDIO[i.AUDIO];for(var r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1}(e,t)){var r=vx(function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var i=e.mediaGroups.AUDIO[t];if(!i)return null;for(var n in i){var r=i[n];if(r.default&&r.playlists)return lm(r.playlists[0].attributes.CODECS)}return null}(e,i.AUDIO)||[]);r.audio&&(n.audio=r.audio)}return n},Tx=ES("PlaylistSelector"),Sx=function(e){if(e&&e.playlist){var t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})}},wx=function(e,t){if(!e)return"";var i=N.getComputedStyle(e);return i?i[t]:""},xx=function(e,t){var i=e.slice();e.sort(function(e,n){var r=t(e,n);return 0===r?i.indexOf(e)-i.indexOf(n):r})},Ax=function(e,t){var i,n;return e.attributes.BANDWIDTH&&(i=e.attributes.BANDWIDTH),i=i||N.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(n=t.attributes.BANDWIDTH),i-(n=n||N.Number.MAX_VALUE)},Ex=function(e,t,i,n,r,s){if(e){var a={bandwidth:t,width:i,height:n,limitRenditionByPlayerDimensions:r},o=e.playlists;ew.isAudioOnly(e)&&(o=s.getAudioTrackPlaylists_(),a.audioOnly=!0);var l=o.map(function(e){var t=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,i=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return{bandwidth:e.attributes&&e.attributes.BANDWIDTH||N.Number.MAX_VALUE,width:t,height:i,playlist:e}});xx(l,function(e,t){return e.bandwidth-t.bandwidth});var u=(l=l.filter(function(e){return!ew.isIncompatible(e.playlist)})).filter(function(e){return ew.isEnabled(e.playlist)});u.length||(u=l.filter(function(e){return!ew.isDisabled(e.playlist)}));var c=u.filter(function(e){return e.bandwidth*zw.BANDWIDTH_VARIANCE<t}),h=c[c.length-1],d=c.filter(function(e){return e.bandwidth===h.bandwidth})[0];if(!1===r){var p=d||u[0]||l[0];if(p&&p.playlist){var f="sortedPlaylistReps";return d&&(f="bandwidthBestRep"),u[0]&&(f="enabledPlaylistReps"),Tx("choosing "+Sx(p)+" using "+f+" with options",a),p.playlist}return Tx("could not choose a playlist with options",a),null}var m=c.filter(function(e){return e.width&&e.height});xx(m,function(e,t){return e.width-t.width});var g=m.filter(function(e){return e.width===i&&e.height===n});h=g[g.length-1];var y,v,_,b,T=g.filter(function(e){return e.bandwidth===h.bandwidth})[0];if(T||(v=(y=m.filter(function(e){return e.width>i||e.height>n})).filter(function(e){return e.width===y[0].width&&e.height===y[0].height}),h=v[v.length-1],_=v.filter(function(e){return e.bandwidth===h.bandwidth})[0]),s.experimentalLeastPixelDiffSelector){var S=m.map(function(e){return e.pixelDiff=Math.abs(e.width-i)+Math.abs(e.height-n),e});xx(S,function(e,t){return e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff}),b=S[0]}var w=b||_||T||d||u[0]||l[0];if(w&&w.playlist){var x="sortedPlaylistReps";return b?x="leastPixelDiffRep":_?x="resolutionPlusOneRep":T?x="resolutionBestRep":d?x="bandwidthBestRep":u[0]&&(x="enabledPlaylistReps"),Tx("choosing "+Sx(w)+" using "+x+" with options",a),w.playlist}return Tx("could not choose a playlist with options",a),null}},Cx=function(){var e=this.useDevicePixelRatio&&N.devicePixelRatio||1;return Ex(this.playlists.master,this.systemBandwidth,parseInt(wx(this.tech_.el(),"width"),10)*e,parseInt(wx(this.tech_.el(),"height"),10)*e,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)},Mx=function(e){var t=e.inbandTextTracks,i=e.metadataArray,n=e.timestampOffset,r=e.videoDuration;if(i){var s=N.WebKitDataCue||N.VTTCue,a=t.metadataTrack_;if(a&&(i.forEach(function(e){var t=e.cueTime+n;!("number"!=typeof t||N.isNaN(t)||t<0)&&t<1/0&&e.frames.forEach(function(e){var i=new s(t,t,e.value||e.url||e.data||"");i.frame=e,i.value=e,function(e){Object.defineProperties(e.frame,{id:{get:function(){return TS.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get:function(){return TS.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get:function(){return TS.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}})}(i),a.addCue(i)})}),a.cues&&a.cues.length)){for(var o=a.cues,l=[],u=0;u<o.length;u++)o[u]&&l.push(o[u]);var c=l.reduce(function(e,t){var i=e[t.startTime]||[];return i.push(t),e[t.startTime]=i,e},{}),h=Object.keys(c).sort(function(e,t){return Number(e)-Number(t)});h.forEach(function(e,t){var i=c[e],n=Number(h[t+1])||r;i.forEach(function(e){e.endTime=n})})}}},kx=function(e,t,i){var n,r;if(i&&i.cues)for(n=i.cues.length;n--;)(r=i.cues[n]).startTime>=e&&r.endTime<=t&&i.removeCue(r)},Ix=function(e){return"number"==typeof e&&isFinite(e)},Px=1/60,Lx=function(e){var t=e.startOfSegment,i=e.duration,n=e.segment,r=e.part,s=e.playlist,a=s.mediaSequence,o=s.id,l=s.segments,u=void 0===l?[]:l,c=e.mediaIndex,h=e.partIndex,d=e.timeline,p=u.length-1,f="mediaIndex/partIndex increment";e.getMediaInfoForTime?f="getMediaInfoForTime ("+e.getMediaInfoForTime+")":e.isSyncRequest&&(f="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(f+=" with independent "+e.independent);var m="number"==typeof h,g=e.segment.uri?"segment":"pre-segment",y=m?jS({preloadSegment:n})-1:0;return g+" ["+(a+c)+"/"+(a+p)+"]"+(m?" part ["+h+"/"+y+"]":"")+" segment start/end ["+n.start+" => "+n.end+"]"+(m?" part start/end ["+r.start+" => "+r.end+"]":"")+" startOfSegment ["+t+"] duration ["+i+"] timeline ["+d+"] selected by ["+f+"] playlist ["+o+"]"},Dx=function(e){return e+"TimingInfo"},Ox=function(e){var t=e.timelineChangeController,i=e.currentTimeline,n=e.segmentTimeline,r=e.loaderType,s=e.audioDisabled;if(i===n)return!1;if("audio"===r){var a=t.lastTimelineChange({type:"main"});return!a||a.to!==n}if("main"===r&&s){var o=t.pendingTimelineChange({type:"audio"});return!o||o.to!==n}return!1},Rx=function(e){var t=e.segmentDuration,i=e.maxDuration;return!!t&&Math.round(t)>i+CS},Nx=function(e,t){if("hls"!==t)return null;var i,n,r=(i={audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo},n=0,["video","audio"].forEach(function(e){var t=i[e+"TimingInfo"];if(t){var r,s=t.start,a=t.end;"bigint"==typeof s||"bigint"==typeof a?r=N.BigInt(a)-N.BigInt(s):"number"==typeof s&&"number"==typeof a&&(r=a-s),void 0!==r&&r>n&&(n=r)}}),"bigint"==typeof n&&n<Number.MAX_SAFE_INTEGER&&(n=Number(n)),n);if(!r)return null;var s=e.playlist.targetDuration,a=Rx({segmentDuration:r,maxDuration:2*s}),o=Rx({segmentDuration:r,maxDuration:s}),l="Segment with index "+e.mediaIndex+" from playlist "+e.playlist.id+" has a duration of "+r+" when the reported duration is "+e.duration+" and the target duration is "+s+". For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1";return a||o?{severity:a?"warn":"info",message:l}:null},Fx=function(e){function t(t,i){var n;if(n=e.call(this)||this,!t)throw new TypeError("Initialization settings are required");if("function"!=typeof t.currentTime)throw new TypeError("No currentTime getter specified");if(!t.mediaSource)throw new TypeError("No MediaSource specified");return n.bandwidth=t.bandwidth,n.throughput={rate:0,count:0},n.roundTrip=NaN,n.resetStats_(),n.mediaIndex=null,n.partIndex=null,n.hasPlayed_=t.hasPlayed,n.currentTime_=t.currentTime,n.seekable_=t.seekable,n.seeking_=t.seeking,n.duration_=t.duration,n.mediaSource_=t.mediaSource,n.vhs_=t.vhs,n.loaderType_=t.loaderType,n.currentMediaInfo_=void 0,n.startingMediaInfo_=void 0,n.segmentMetadataTrack_=t.segmentMetadataTrack,n.goalBufferLength_=t.goalBufferLength,n.sourceType_=t.sourceType,n.sourceUpdater_=t.sourceUpdater,n.inbandTextTracks_=t.inbandTextTracks,n.state_="INIT",n.timelineChangeController_=t.timelineChangeController,n.shouldSaveSegmentTimingInfo_=!0,n.parse708captions_=t.parse708captions,n.useDtsForTimestampOffset_=t.useDtsForTimestampOffset,n.captionServices_=t.captionServices,n.experimentalExactManifestTimings=t.experimentalExactManifestTimings,n.checkBufferTimeout_=null,n.error_=void 0,n.currentTimeline_=-1,n.pendingSegment_=null,n.xhrOptions_=null,n.pendingSegments_=[],n.audioDisabled_=!1,n.isPendingTimestampOffset_=!1,n.gopBuffer_=[],n.timeMapping_=0,n.safeAppend_=TS.browser.IE_VERSION>=11,n.appendInitSegment_={audio:!0,video:!0},n.playlistOfLastInitSegment_={audio:null,video:null},n.callQueue_=[],n.loadQueue_=[],n.metadataQueue_={id3:[],caption:[]},n.waitingOnRemove_=!1,n.quotaExceededErrorRetryTimeout_=null,n.activeInitSegmentId_=null,n.initSegments_={},n.cacheEncryptionKeys_=t.cacheEncryptionKeys,n.keyCache_={},n.decrypter_=t.decrypter,n.syncController_=t.syncController,n.syncPoint_={segmentIndex:0,time:0},n.transmuxer_=n.createTransmuxer_(),n.triggerSyncInfoUpdate_=function(){return n.trigger("syncinfoupdate")},n.syncController_.on("syncinfoupdate",n.triggerSyncInfoUpdate_),n.mediaSource_.addEventListener("sourceopen",function(){n.isEndOfStream_()||(n.ended_=!1)}),n.fetchAtBuffer_=!1,n.logger_=ES("SegmentLoader["+n.loaderType_+"]"),Object.defineProperty(xf(n),"state",{get:function(){return this.state_},set:function(e){e!==this.state_&&(this.logger_(this.state_+" -> "+e),this.state_=e,this.trigger("statechange"))}}),n.sourceUpdater_.on("ready",function(){n.hasEnoughInfoToAppend_()&&n.processCallQueue_()}),"main"===n.loaderType_&&n.timelineChangeController_.on("pendingtimelinechange",function(){n.hasEnoughInfoToAppend_()&&n.processCallQueue_()}),"audio"===n.loaderType_&&n.timelineChangeController_.on("timelinechange",function(){n.hasEnoughInfoToLoad_()&&n.processLoadQueue_(),n.hasEnoughInfoToAppend_()&&n.processCallQueue_()}),n}Ef(t,e);var i=t.prototype;return i.createTransmuxer_=function(){return ex({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})},i.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0},i.dispose=function(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()},i.setAudio=function(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())},i.abort=function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)},i.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,N.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null},i.checkForAbort_=function(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)},i.error=function(e){return void 0!==e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_},i.endOfStream=function(){this.ended_=!0,this.transmuxer_&&Jw(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},i.buffered_=function(){var e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return TS.createTimeRanges();if("main"===this.loaderType_){var t=e.hasAudio,i=e.hasVideo,n=e.isMuxed;if(i&&t&&!this.audioDisabled_&&!n)return this.sourceUpdater_.buffered();if(i)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()},i.initSegmentForMap=function(e,t){if(void 0===t&&(t=!1),!e)return null;var i=Aw(e),n=this.initSegments_[i];return t&&!n&&e.bytes&&(this.initSegments_[i]=n={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),n||e},i.segmentKey=function(e,t){if(void 0===t&&(t=!1),!e)return null;var i=Ew(e),n=this.keyCache_[i];this.cacheEncryptionKeys_&&t&&!n&&e.bytes&&(this.keyCache_[i]=n={resolvedUri:e.resolvedUri,bytes:e.bytes});var r={resolvedUri:(n||e).resolvedUri};return n&&(r.bytes=n.bytes),r},i.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},i.load=function(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))},i.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},i.playlist=function(e,t){if(void 0===t&&(t={}),e){var i=this.playlist_,n=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));var r=null;if(i&&(i.id?r=i.id:i.uri&&(r=i.uri)),this.logger_("playlist update ["+r+" => "+(e.id||e.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==e.uri)return null!==this.mediaIndex&&(e.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,void this.trigger("playlistupdate");var s=e.mediaSequence-i.mediaSequence;if(this.logger_("live window shift ["+s+"]"),null!==this.mediaIndex)if(this.mediaIndex-=s,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{var a=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!a.parts||!a.parts.length||!a.parts[this.partIndex])){var o=this.mediaIndex;this.logger_("currently processing part (index "+this.partIndex+") no longer exists."),this.resetLoader(),this.mediaIndex=o}}n&&(n.mediaIndex-=s,n.mediaIndex<0?(n.mediaIndex=null,n.partIndex=null):(n.mediaIndex>=0&&(n.segment=e.segments[n.mediaIndex]),n.partIndex>=0&&n.segment.parts&&(n.part=n.segment.parts[n.partIndex]))),this.syncController_.saveExpiredSegmentInfo(i,e)}},i.pause=function(){this.checkBufferTimeout_&&(N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},i.paused=function(){return null===this.checkBufferTimeout_},i.resetEverything=function(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))},i.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},i.resyncLoader=function(){this.transmuxer_&&Jw(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})},i.remove=function(e,t,i,n){if(void 0===i&&(i=function(){}),void 0===n&&(n=!1),t===1/0&&(t=this.duration_()),t<=e)this.logger_("skipping remove because end ${end} is <= start ${start}");else if(this.sourceUpdater_&&this.getMediaInfo_()){var r=1,s=function(){0===--r&&i()};for(var a in!n&&this.audioDisabled_||(r++,this.sourceUpdater_.removeAudio(e,t,s)),(n||"main"===this.loaderType_)&&(this.gopBuffer_=function(e,t,i,n){for(var r=Math.ceil((t-n)*Jg.ONE_SECOND_IN_TS),s=Math.ceil((i-n)*Jg.ONE_SECOND_IN_TS),a=e.slice(),o=e.length;o--&&!(e[o].pts<=s););if(-1===o)return a;for(var l=o+1;l--&&!(e[l].pts<=r););return l=Math.max(l,0),a.splice(l,o-l+1),a}(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,s)),this.inbandTextTracks_)kx(e,t,this.inbandTextTracks_[a]);kx(e,t,this.segmentMetadataTrack_),s()}else this.logger_("skipping remove because no source updater or starting media info")},i.monitorBuffer_=function(){this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=N.setTimeout(this.monitorBufferTick_.bind(this),1)},i.monitorBufferTick_=function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&N.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=N.setTimeout(this.monitorBufferTick_.bind(this),500)},i.fillBuffer_=function(){if(!this.sourceUpdater_.updating()){var e=this.chooseNextRequest_();e&&("number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}},i.isEndOfStream_=function(e,t,i){if(void 0===e&&(e=this.mediaIndex),void 0===t&&(t=this.playlist_),void 0===i&&(i=this.partIndex),!t||!this.mediaSource_)return!1;var n="number"==typeof e&&t.segments[e],r=e+1===t.segments.length,s=!n||!n.parts||i+1===n.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&r&&s},i.chooseNextRequest_=function(){var e=this.buffered_(),t=OS(e)||0,i=RS(e,this.currentTime_()),n=!this.hasPlayed_()&&i>=1,r=i>=this.goalBufferLength_(),s=this.playlist_.segments;if(!s.length||n||r)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());var a={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(a.isSyncRequest)a.mediaIndex=function(e,t,i){t=t||[];for(var n=[],r=0,s=0;s<t.length;s++){var a=t[s];if(e===a.timeline&&(n.push(s),(r+=a.duration)>i))return s}return 0===n.length?0:n[n.length-1]}(this.currentTimeline_,s,t);else if(null!==this.mediaIndex){var o=s[this.mediaIndex],l="number"==typeof this.partIndex?this.partIndex:-1;a.startOfSegment=o.end?o.end:t,o.parts&&o.parts[l+1]?(a.mediaIndex=this.mediaIndex,a.partIndex=l+1):a.mediaIndex=this.mediaIndex+1}else{var u=ew.getMediaInfoForTime({experimentalExactManifestTimings:this.experimentalExactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?t:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time}),c=u.segmentIndex,h=u.startTime,d=u.partIndex;a.getMediaInfoForTime=this.fetchAtBuffer_?"bufferedEnd "+t:"currentTime "+this.currentTime_(),a.mediaIndex=c,a.startOfSegment=h,a.partIndex=d}var p=s[a.mediaIndex],f=p&&"number"==typeof a.partIndex&&p.parts&&p.parts[a.partIndex];if(!p||"number"==typeof a.partIndex&&!f)return null;if("number"!=typeof a.partIndex&&p.parts&&(a.partIndex=0,f=p.parts[0]),!i&&f&&!f.independent)if(0===a.partIndex){var m=s[a.mediaIndex-1],g=m.parts&&m.parts.length&&m.parts[m.parts.length-1];g&&g.independent&&(a.mediaIndex-=1,a.partIndex=m.parts.length-1,a.independent="previous segment")}else p.parts[a.partIndex-1].independent&&(a.partIndex-=1,a.independent="previous part");var y=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return a.mediaIndex>=s.length-1&&y&&!this.seeking_()?null:this.generateSegmentInfo_(a)},i.generateSegmentInfo_=function(e){var t=e.independent,i=e.playlist,n=e.mediaIndex,r=e.startOfSegment,s=e.isSyncRequest,a=e.partIndex,o=e.forceTimestampOffset,l=e.getMediaInfoForTime,u=i.segments[n],c="number"==typeof a&&u.parts[a],h={requestId:"segment-loader-"+Math.random(),uri:c&&c.resolvedUri||u.resolvedUri,mediaIndex:n,partIndex:c?a:null,isSyncRequest:s,startOfSegment:r,playlist:i,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:u.timeline,duration:c&&c.duration||u.duration,segment:u,part:c,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},d=void 0!==o?o:this.isPendingTimestampOffset_;h.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:u.timeline,currentTimeline:this.currentTimeline_,startOfSegment:r,buffered:this.buffered_(),overrideCheck:d});var p=OS(this.sourceUpdater_.audioBuffered());return"number"==typeof p&&(h.audioAppendStart=p-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(h.gopsToAlignWith=function(e,t,i){if(null==t||!e.length)return[];var n,r=Math.ceil((t-i+3)*Jg.ONE_SECOND_IN_TS);for(n=0;n<e.length&&!(e[n].pts>r);n++);return e.slice(n)}(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),h},i.timestampOffsetForSegment_=function(e){return i=(t=e).segmentTimeline,n=t.currentTimeline,r=t.startOfSegment,s=t.buffered,t.overrideCheck||i!==n?i<n?r:s.length?s.end(s.length-1):r:null;var t,i,n,r,s},i.earlyAbortWhenNeeded_=function(e){if(!this.vhs_.tech_.paused()&&this.xhrOptions_.timeout&&this.playlist_.attributes.BANDWIDTH&&!(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)){var t=this.currentTime_(),i=e.bandwidth,n=this.pendingSegment_.duration,r=ew.estimateSegmentRequestTime(n,i,this.playlist_,e.bytesReceived),s=function(e,t,i){return void 0===i&&(i=1),((e.length?e.end(e.length-1):0)-t)/i}(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(!(r<=s)){var a=function(e){var t=e.master,i=e.currentTime,n=e.bandwidth,r=e.duration,s=e.segmentDuration,a=e.timeUntilRebuffer,o=e.currentTimeline,l=e.syncController,u=t.playlists.filter(function(e){return!ew.isIncompatible(e)}),c=u.filter(ew.isEnabled);c.length||(c=u.filter(function(e){return!ew.isDisabled(e)}));var h=c.filter(ew.hasAttribute.bind(null,"BANDWIDTH")).map(function(e){var t=l.getSyncPoint(e,r,o,i)?1:2;return{playlist:e,rebufferingImpact:ew.estimateSegmentRequestTime(s,n,e)*t-a}}),d=h.filter(function(e){return e.rebufferingImpact<=0});return xx(d,function(e,t){return Ax(t.playlist,e.playlist)}),d.length?d[0]:(xx(h,function(e,t){return e.rebufferingImpact-t.rebufferingImpact}),h[0]||null)}({master:this.vhs_.playlists.master,currentTime:t,bandwidth:i,duration:this.duration_(),segmentDuration:n,timeUntilRebuffer:s,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(a){var o=r-s-a.rebufferingImpact,l=.5;s<=CS&&(l=1),!a.playlist||a.playlist.uri===this.playlist_.uri||o<l||(this.bandwidth=a.playlist.attributes.BANDWIDTH*zw.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}}}},i.handleAbort_=function(e){this.logger_("Aborting "+Lx(e)),this.mediaRequestsAborted+=1},i.handleProgress_=function(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")},i.handleTrackInfo_=function(e,t){this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;var i=Object.keys(e).sort(),n=Object.keys(t).sort();if(i.length!==n.length)return!1;for(var r=0;r<i.length;r++){var s=i[r];if(s!==n[r])return!1;if(e[s]!==t[s])return!1}return!0}(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()&&this.processCallQueue_()))},i.handleTimingInfo_=function(e,t,i,n){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){var r=this.pendingSegment_,s=Dx(t);r[s]=r[s]||{},r[s][i]=n,this.logger_("timinginfo: "+t+" - "+i+" - "+n),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}},i.handleCaptions_=function(e,t){var i=this;if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId))if(0!==t.length)if(this.pendingSegment_.hasAppendedData_){var n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r={};t.forEach(function(e){r[e.stream]=r[e.stream]||{startTime:1/0,captions:[],endTime:0};var t=r[e.stream];t.startTime=Math.min(t.startTime,e.startTime+n),t.endTime=Math.max(t.endTime,e.endTime+n),t.captions.push(e)}),Object.keys(r).forEach(function(e){var t=r[e],s=t.startTime,a=t.endTime,o=t.captions,l=i.inbandTextTracks_;i.logger_("adding cues from "+s+" -> "+a+" for "+e),function(e,t,i){if(!e[i]){t.trigger({type:"usage",name:"vhs-608"}),t.trigger({type:"usage",name:"hls-608"});var n=i;/^cc708_/.test(i)&&(n="SERVICE"+i.split("_")[1]);var r=t.textTracks().getTrackById(n);if(r)e[i]=r;else{var s=i,a=i,o=!1,l=(t.options_.vhs&&t.options_.vhs.captionServices||{})[n];l&&(s=l.label,a=l.language,o=l.default),e[i]=t.addRemoteTextTrack({kind:"captions",id:n,default:o,label:s,language:a},!1).track}}}(l,i.vhs_.tech_,e),kx(s,a,l[e]),function(e){var t=e.inbandTextTracks,i=e.captionArray,n=e.timestampOffset;if(i){var r=N.WebKitDataCue||N.VTTCue;i.forEach(function(e){var i=e.stream;t[i].addCue(new r(e.startTime+n,e.endTime+n,e.text))})}}({captionArray:o,inbandTextTracks:l,timestampOffset:n})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}else this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));else this.logger_("SegmentLoader received no captions from a caption event")},i.handleId3_=function(e,t,i){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId))if(this.pendingSegment_.hasAppendedData_){var n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();!function(e,t,i){e.metadataTrack_||(e.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=t)}(this.inbandTextTracks_,i,this.vhs_.tech_),Mx({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:n,videoDuration:this.duration_()})}else this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,i))},i.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(e){return e()}),this.metadataQueue_.caption.forEach(function(e){return e()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},i.processCallQueue_=function(){var e=this.callQueue_;this.callQueue_=[],e.forEach(function(e){return e()})},i.processLoadQueue_=function(){var e=this.loadQueue_;this.loadQueue_=[],e.forEach(function(e){return e()})},i.hasEnoughInfoToLoad_=function(){if("audio"!==this.loaderType_)return!0;var e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!Ox({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},i.getCurrentMediaInfo_=function(e){return void 0===e&&(e=this.pendingSegment_),e&&e.trackInfo||this.currentMediaInfo_},i.getMediaInfo_=function(e){return void 0===e&&(e=this.pendingSegment_),this.getCurrentMediaInfo_(e)||this.startingMediaInfo_},i.getPendingSegmentPlaylist=function(){return this.pendingSegment_?this.pendingSegment_.playlist:null},i.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;var e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;var i=t.hasAudio,n=t.hasVideo,r=t.isMuxed;return!(n&&!e.videoTimingInfo)&&(!(i&&!this.audioDisabled_&&!r&&!e.audioTimingInfo)&&!Ox({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},i.handleData_=function(e,t){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId))if(!this.callQueue_.length&&this.hasEnoughInfoToAppend_()){var i=this.pendingSegment_;if(this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.part||i.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),i.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),i.isFmp4=e.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4)this.trigger("fmp4"),i.timingInfo.start=i[Dx(t.type)].start;else{var n,r=this.getCurrentMediaInfo_(),s="main"===this.loaderType_&&r&&r.hasVideo;s&&(n=i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:s,firstVideoFrameTimeForData:n,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(i,t.type),this.updateSourceBufferTimestampOffset_(i),i.isSyncRequest){this.updateTimingInfoEnd_(i),this.syncController_.saveSegmentTimingInfo({segmentInfo:i,shouldSaveTimelineMapping:"main"===this.loaderType_});var a=this.chooseNextRequest_();if(a.mediaIndex!==i.mediaIndex||a.partIndex!==i.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,t)}}else this.callQueue_.push(this.handleData_.bind(this,e,t))},i.updateAppendInitSegmentStatus=function(e,t){"main"!==this.loaderType_||"number"!=typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)},i.getInitSegmentAndUpdateState_=function(e){var t=e.type,i=e.initSegment,n=e.map,r=e.playlist;if(n){var s=Aw(n);if(this.activeInitSegmentId_===s)return null;i=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=s}return i&&this.appendInitSegment_[t]?(this.playlistOfLastInitSegment_[t]=r,this.appendInitSegment_[t]=!1,this.activeInitSegmentId_=null,i):null},i.handleQuotaExceededError_=function(e,t){var i=this,n=e.segmentInfo,r=e.type,s=e.bytes,a=this.sourceUpdater_.audioBuffered(),o=this.sourceUpdater_.videoBuffered();a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+DS(a).join(", ")),o.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+DS(o).join(", "));var l=a.length?a.start(0):0,u=a.length?a.end(a.length-1):0,c=o.length?o.start(0):0,h=o.length?o.end(o.length-1):0;if(u-l<=1&&h-c<=1)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: "+s.byteLength+", audio buffer: "+DS(a).join(", ")+", video buffer: "+DS(o).join(", ")+", "),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:n,type:r,bytes:s}));var d=this.currentTime_()-1;this.logger_("On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to "+d),this.remove(0,d,function(){i.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),i.waitingOnRemove_=!1,i.quotaExceededErrorRetryTimeout_=N.setTimeout(function(){i.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),i.quotaExceededErrorRetryTimeout_=null,i.processCallQueue_()},1e3)},!0)},i.handleAppendError_=function(e,t){var i=e.segmentInfo,n=e.type,r=e.bytes;t&&(22!==t.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",t),this.error(n+" append of "+r.length+"b failed for segment #"+i.mediaIndex+" in playlist "+i.playlist.id),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:i,type:n,bytes:r}))},i.appendToSourceBuffer_=function(e){var t,i,n,r=e.segmentInfo,s=e.type,a=e.initSegment,o=e.data,l=e.bytes;if(!l){var u=[o],c=o.byteLength;a&&(u.unshift(a),c+=a.byteLength),n=0,(t={bytes:c,segments:u}).bytes&&(i=new Uint8Array(t.bytes),t.segments.forEach(function(e){i.set(e,n),n+=e.byteLength})),l=i}this.sourceUpdater_.appendBuffer({segmentInfo:r,type:s,bytes:l},this.handleAppendError_.bind(this,{segmentInfo:r,type:s,bytes:l}))},i.handleSegmentTimingInfo_=function(e,t,i){if(this.pendingSegment_&&t===this.pendingSegment_.requestId){var n=this.pendingSegment_.segment,r=e+"TimingInfo";n[r]||(n[r]={}),n[r].transmuxerPrependedSeconds=i.prependedContentDuration||0,n[r].transmuxedPresentationStart=i.start.presentation,n[r].transmuxedDecodeStart=i.start.decode,n[r].transmuxedPresentationEnd=i.end.presentation,n[r].transmuxedDecodeEnd=i.end.decode,n[r].baseMediaDecodeTime=i.baseMediaDecodeTime}},i.appendData_=function(e,t){var i=t.type,n=t.data;if(n&&n.byteLength&&("audio"!==i||!this.audioDisabled_)){var r=this.getInitSegmentAndUpdateState_({type:i,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:i,initSegment:r,data:n})}},i.loadSegment_=function(e){var t=this;this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(e):this.loadQueue_.push(function(){var i=ye({},e,{forceTimestampOffset:!0});ye(e,t.generateSegmentInfo_(i)),t.isPendingTimestampOffset_=!1,t.updateTransmuxerAndRequestSegment_(e)})},i.updateTransmuxerAndRequestSegment_=function(e){var t=this;this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));var i=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=null!==this.mediaIndex,s=e.timeline!==this.currentTimeline_&&e.timeline>0,a=n||r&&s;this.logger_("Requesting "+Lx(e)),i.map&&!i.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=mx({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:i,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:function(){t.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:function(i){var n=i.message,r=i.level,s=i.stream;t.logger_(Lx(e)+" logged from transmuxer stream "+s+" as a "+r+": "+n)}})},i.trimBackBuffer_=function(e){var t=function(e,t,i){var n=t-zw.BACK_BUFFER_LENGTH;e.length&&(n=Math.max(n,e.start(0)));var r=t-i;return Math.min(r,n)}(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)},i.createSimplifiedSegmentObj_=function(e){var t=e.segment,i=e.part,n={resolvedUri:i?i.resolvedUri:t.resolvedUri,byterange:i?i.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},r=e.playlist.segments[e.mediaIndex-1];if(r&&r.timeline===t.timeline&&(r.videoTimingInfo?n.baseStartTime=r.videoTimingInfo.transmuxedDecodeEnd:r.audioTimingInfo&&(n.baseStartTime=r.audioTimingInfo.transmuxedDecodeEnd)),t.key){var s=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);n.key=this.segmentKey(t.key),n.key.iv=s}return t.map&&(n.map=this.initSegmentForMap(t.map)),n},i.saveTransferStats_=function(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)},i.saveBandwidthRelatedStats_=function(e,t){this.pendingSegment_.byteLength=t.bytesReceived,e<Px?this.logger_("Ignoring segment's bandwidth because its duration of "+e+" is less than the min to record "+Px):(this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime)},i.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")},i.segmentRequestFinished_=function(e,t,i){if(this.callQueue_.length)this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,i));else if(this.saveTransferStats_(t.stats),this.pendingSegment_&&t.requestId===this.pendingSegment_.requestId){if(e){if(this.pendingSegment_=null,this.state="READY",e.code===rx)return;return this.pause(),e.code===nx?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}var n=this.pendingSegment_;this.saveBandwidthRelatedStats_(n.duration,t.stats),n.endOfAllRequests=t.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=function(e,t,i){if(!t.length)return e;if(i)return t.slice();for(var n=t[0].pts,r=0;r<e.length&&!(e[r].pts>=n);r++);return e.slice(0,r).concat(t)}(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(n)}},i.setTimeMapping_=function(e){var t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)},i.updateMediaSecondsLoaded_=function(e){"number"==typeof e.start&&"number"==typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration},i.shouldUpdateTransmuxerTimestampOffset_=function(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())},i.trueSegmentStart_=function(e){var t=e.currentStart,i=e.playlist,n=e.mediaIndex,r=e.firstVideoFrameTimeForData,s=e.currentVideoTimestampOffset,a=e.useVideoTimingInfo,o=e.videoTimingInfo,l=e.audioTimingInfo;if(void 0!==t)return t;if(!a)return l.start;var u=i.segments[n-1];return 0!==n&&u&&void 0!==u.start&&u.end===r+s?o.start:r},i.waitForAppendsToComplete_=function(e){var t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",blacklistDuration:1/0}),void this.trigger("error");var i=t.hasAudio,n=t.hasVideo,r=t.isMuxed,s="main"===this.loaderType_&&n,a=!this.audioDisabled_&&i&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!=typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);s&&e.waitingOnAppends++,a&&e.waitingOnAppends++,s&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),a&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))},i.checkAppendsDone_=function(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())},i.checkForIllegalMediaSwitch=function(e){var t=function(e,t,i){return"main"===e&&t&&i?i.hasAudio||i.hasVideo?t.hasVideo&&!i.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&i.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null}(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,blacklistDuration:1/0}),this.trigger("error"),!0)},i.updateSourceBufferTimestampOffset_=function(e){if(null!==e.timestampOffset&&"number"==typeof e.timingInfo.start&&!e.changedTimestampOffset&&"main"===this.loaderType_){var t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}},i.getSegmentStartTimeForTimestampOffsetCalculation_=function(e){var t=e.videoTimingInfo,i=e.audioTimingInfo,n=e.timingInfo;return this.useDtsForTimestampOffset_?t&&"number"==typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:i&&"number"==typeof i.transmuxedDecodeStart?i.transmuxedDecodeStart:n.start:n.start},i.updateTimingInfoEnd_=function(e){e.timingInfo=e.timingInfo||{};var t=this.getMediaInfo_(),i="main"===this.loaderType_&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;i&&(e.timingInfo.end="number"==typeof i.end?i.end:i.start+e.duration)},i.handleAppendsDone_=function(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});var t=Nx(e,this.sourceType_);if(t&&("warn"===t.severity?TS.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",!e.isSyncRequest||(this.trigger("syncinfoupdate"),e.hasAppendedData_)){this.logger_("Appended "+Lx(e)),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");var i=e.segment,n=e.part,r=i.end&&this.currentTime_()-i.end>3*e.playlist.targetDuration,s=n&&n.end&&this.currentTime_()-n.end>3*e.playlist.partTargetDuration;if(r||s)return this.logger_("bad "+(r?"segment":"part")+" "+Lx(e)),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}else this.logger_("Throwing away un-appended sync request "+Lx(e))},i.recordThroughput_=function(e){if(e.duration<Px)this.logger_("Ignoring segment's throughput because its duration of "+e.duration+" is less than the min to record "+Px);else{var t=this.throughput.rate,i=Date.now()-e.endOfAllRequests+1,n=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(n-t)/++this.throughput.count}},i.addSegmentMetadataCue_=function(e){if(this.segmentMetadataTrack_){var t=e.segment,i=t.start,n=t.end;if(Ix(i)&&Ix(n)){kx(i,n,this.segmentMetadataTrack_);var r=N.WebKitDataCue||N.VTTCue,s={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:i,end:n},a=new r(i,n,JSON.stringify(s));a.value=s,this.segmentMetadataTrack_.addCue(a)}}},t}(TS.EventTarget);function Ux(){}var Bx,jx=function(e){return"string"!=typeof e?e:e.replace(/./,function(e){return e.toUpperCase()})},zx=["video","audio"],Vx=function(e,t){var i=t[e+"Buffer"];return i&&i.updating||t.queuePending[e]},Hx=function e(t,i){if(0!==i.queue.length){var n=0,r=i.queue[n];if("mediaSource"!==r.type){if("mediaSource"!==t&&i.ready()&&"closed"!==i.mediaSource.readyState&&!Vx(t,i)){if(r.type!==t){if(n=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if("mediaSource"===n.type)return null;if(n.type===e)return i}return null}(t,i.queue),null===n)return;r=i.queue[n]}return i.queue.splice(n,1),i.queuePending[t]=r,r.action(t,i),r.doneFn?void 0:(i.queuePending[t]=null,void e(t,i))}}else i.updating()||"closed"===i.mediaSource.readyState||(i.queue.shift(),r.action(i),r.doneFn&&r.doneFn(),e("audio",i),e("video",i))}},qx=function(e,t){var i=t[e+"Buffer"],n=jx(e);i&&(i.removeEventListener("updateend",t["on"+n+"UpdateEnd_"]),i.removeEventListener("error",t["on"+n+"Error_"]),t.codecs[e]=null,t[e+"Buffer"]=null)},Gx=function(e,t){return e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t)},Wx=function(e,t,i){return function(n,r){var s=r[n+"Buffer"];if(Gx(r.mediaSource,s)){r.logger_("Appending segment "+t.mediaIndex+"'s "+e.length+" bytes to "+n+"Buffer");try{s.appendBuffer(e)}catch(a){r.logger_("Error with code "+a.code+" "+(22===a.code?"(QUOTA_EXCEEDED_ERR) ":"")+"when appending segment "+t.mediaIndex+" to "+n+"Buffer"),r.queuePending[n]=null,i(a)}}}},$x=function(e,t){return function(i,n){var r=n[i+"Buffer"];if(Gx(n.mediaSource,r)){n.logger_("Removing "+e+" to "+t+" from "+i+"Buffer");try{r.remove(e,t)}catch(s){n.logger_("Remove "+e+" to "+t+" from "+i+"Buffer failed")}}}},Xx=function(e){return function(t,i){var n=i[t+"Buffer"];Gx(i.mediaSource,n)&&(i.logger_("Setting "+t+"timestampOffset to "+e),n.timestampOffset=e)}},Yx=function(e){return function(t,i){e()}},Qx=function(e){return function(t){if("open"===t.mediaSource.readyState){t.logger_("Calling mediaSource endOfStream("+(e||"")+")");try{t.mediaSource.endOfStream(e)}catch(i){TS.log.warn("Failed to call media source endOfStream",i)}}}},Kx=function(e){return function(t){t.logger_("Setting mediaSource duration to "+e);try{t.mediaSource.duration=e}catch(i){TS.log.warn("Failed to set media source duration",i)}}},Zx=function(){return function(e,t){if("open"===t.mediaSource.readyState){var i=t[e+"Buffer"];if(Gx(t.mediaSource,i)){t.logger_("calling abort on "+e+"Buffer");try{i.abort()}catch(n){TS.log.warn("Failed to abort on "+e+"Buffer",n)}}}}},Jx=function(e,t){return function(i){var n=jx(e),r=cm(t);i.logger_("Adding "+e+"Buffer with codec "+t+" to mediaSource");var s=i.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",i["on"+n+"UpdateEnd_"]),s.addEventListener("error",i["on"+n+"Error_"]),i.codecs[e]=t,i[e+"Buffer"]=s}},eA=function(e){return function(t){var i=t[e+"Buffer"];if(qx(e,t),Gx(t.mediaSource,i)){t.logger_("Removing "+e+"Buffer with codec "+t.codecs[e]+" from mediaSource");try{t.mediaSource.removeSourceBuffer(i)}catch(n){TS.log.warn("Failed to removeSourceBuffer "+e+"Buffer",n)}}}},tA=function(e){return function(t,i){var n=i[t+"Buffer"],r=cm(e);if(Gx(i.mediaSource,n)&&i.codecs[t]!==e){i.logger_("changing "+t+"Buffer codec from "+i.codecs[t]+" to "+e);try{n.changeType(r),i.codecs[t]=e}catch(s){TS.log.warn("Failed to changeType on "+t+"Buffer",s)}}}},iA=function(e){var t=e.type,i=e.sourceUpdater,n=e.action,r=e.doneFn,s=e.name;i.queue.push({type:t,action:n,doneFn:r,name:s}),Hx(t,i)},nA=function(e,t){return function(i){if(t.queuePending[e]){var n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t[e+"Error_"])}Hx(e,t)}},rA=function(e){function t(t){var i;return(i=e.call(this)||this).mediaSource=t,i.sourceopenListener_=function(){return Hx("mediaSource",xf(i))},i.mediaSource.addEventListener("sourceopen",i.sourceopenListener_),i.logger_=ES("SourceUpdater"),i.audioTimestampOffset_=0,i.videoTimestampOffset_=0,i.queue=[],i.queuePending={audio:null,video:null},i.delayedAudioAppendQueue_=[],i.videoAppendQueued_=!1,i.codecs={},i.onVideoUpdateEnd_=nA("video",xf(i)),i.onAudioUpdateEnd_=nA("audio",xf(i)),i.onVideoError_=function(e){i.videoError_=e},i.onAudioError_=function(e){i.audioError_=e},i.createdSourceBuffers_=!1,i.initializedEme_=!1,i.triggeredReady_=!1,i}Ef(t,e);var i=t.prototype;return i.initializedEme=function(){this.initializedEme_=!0,this.triggerReady()},i.hasCreatedSourceBuffers=function(){return this.createdSourceBuffers_},i.hasInitializedAnyEme=function(){return this.initializedEme_},i.ready=function(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()},i.createSourceBuffers=function(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())},i.triggerReady=function(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))},i.addSourceBuffer=function(e,t){iA({type:"mediaSource",sourceUpdater:this,action:Jx(e,t),name:"addSourceBuffer"})},i.abort=function(e){iA({type:e,sourceUpdater:this,action:Zx(e),name:"abort"})},i.removeSourceBuffer=function(e){this.canRemoveSourceBuffer()?iA({type:"mediaSource",sourceUpdater:this,action:eA(e),name:"removeSourceBuffer"}):TS.log.error("removeSourceBuffer is not supported!")},i.canRemoveSourceBuffer=function(){return!TS.browser.IE_VERSION&&!TS.browser.IS_FIREFOX&&N.MediaSource&&N.MediaSource.prototype&&"function"==typeof N.MediaSource.prototype.removeSourceBuffer},t.canChangeType=function(){return N.SourceBuffer&&N.SourceBuffer.prototype&&"function"==typeof N.SourceBuffer.prototype.changeType},i.canChangeType=function(){return this.constructor.canChangeType()},i.changeType=function(e,t){this.canChangeType()?iA({type:e,sourceUpdater:this,action:tA(t),name:"changeType"}):TS.log.error("changeType is not supported!")},i.addOrChangeSourceBuffers=function(e){var t=this;if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(function(i){var n=e[i];if(!t.hasCreatedSourceBuffers())return t.addSourceBuffer(i,n);t.canChangeType()&&t.changeType(i,n)})},i.appendBuffer=function(e,t){var i=this,n=e.segmentInfo,r=e.type,s=e.bytes;if(this.processedAppend_=!0,"audio"===r&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_("delayed audio append of "+s.length+" until video append");if(iA({type:r,sourceUpdater:this,action:Wx(s,n||{mediaIndex:-1},t),doneFn:t,name:"appendBuffer"}),"video"===r){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;var a=this.delayedAudioAppendQueue_.slice();this.logger_("queuing delayed audio "+a.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,a.forEach(function(e){i.appendBuffer.apply(i,e)})}},i.audioBuffered=function(){return Gx(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:TS.createTimeRange()},i.videoBuffered=function(){return Gx(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:TS.createTimeRange()},i.buffered=function(){var e=Gx(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=Gx(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():function(e,t){var i=null,n=null,r=0,s=[],a=[];if(!(e&&e.length&&t&&t.length))return TS.createTimeRange();for(var o=e.length;o--;)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});for(o=t.length;o--;)s.push({time:t.start(o),type:"start"}),s.push({time:t.end(o),type:"end"});for(s.sort(function(e,t){return e.time-t.time}),o=0;o<s.length;o++)"start"===s[o].type?2===++r&&(i=s[o].time):"end"===s[o].type&&1===--r&&(n=s[o].time),null!==i&&null!==n&&(a.push([i,n]),i=null,n=null);return TS.createTimeRanges(a)}(this.audioBuffered(),this.videoBuffered())},i.setDuration=function(e,t){void 0===t&&(t=Ux),iA({type:"mediaSource",sourceUpdater:this,action:Kx(e),name:"duration",doneFn:t})},i.endOfStream=function(e,t){void 0===e&&(e=null),void 0===t&&(t=Ux),"string"!=typeof e&&(e=void 0),iA({type:"mediaSource",sourceUpdater:this,action:Qx(e),name:"endOfStream",doneFn:t})},i.removeAudio=function(e,t,i){void 0===i&&(i=Ux),this.audioBuffered().length&&0!==this.audioBuffered().end(0)?iA({type:"audio",sourceUpdater:this,action:$x(e,t),doneFn:i,name:"remove"}):i()},i.removeVideo=function(e,t,i){void 0===i&&(i=Ux),this.videoBuffered().length&&0!==this.videoBuffered().end(0)?iA({type:"video",sourceUpdater:this,action:$x(e,t),doneFn:i,name:"remove"}):i()},i.updating=function(){return!(!Vx("audio",this)&&!Vx("video",this))},i.audioTimestampOffset=function(e){return void 0!==e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(iA({type:"audio",sourceUpdater:this,action:Xx(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_},i.videoTimestampOffset=function(e){return void 0!==e&&this.videoBuffer&&this.videoTimestampOffset!==e&&(iA({type:"video",sourceUpdater:this,action:Xx(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_},i.audioQueueCallback=function(e){this.audioBuffer&&iA({type:"audio",sourceUpdater:this,action:Yx(e),name:"callback"})},i.videoQueueCallback=function(e){this.videoBuffer&&iA({type:"video",sourceUpdater:this,action:Yx(e),name:"callback"})},i.dispose=function(){var e=this;this.trigger("dispose"),zx.forEach(function(t){e.abort(t),e.canRemoveSourceBuffer()?e.removeSourceBuffer(t):e[t+"QueueCallback"](function(){return qx(t,e)})}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()},t}(TS.EventTarget),sA=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))},aA=new Uint8Array("\n\n".split("").map(function(e){return e.charCodeAt(0)})),oA=function(e){function t(){return e.call(this,"Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")||this}return Ef(t,e),t}(ty(Error)),lA=function(e){function t(t,i){var n;return void 0===i&&(i={}),(n=e.call(this,t,i)||this).mediaSource_=null,n.subtitlesTrack_=null,n.loaderType_="subtitle",n.featuresNativeTextTracks_=t.featuresNativeTextTracks,n.loadVttJs=t.loadVttJs,n.shouldSaveSegmentTimingInfo_=!1,n}Ef(t,e);var i=t.prototype;return i.createTransmuxer_=function(){return null},i.buffered_=function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return TS.createTimeRanges();var e=this.subtitlesTrack_.cues,t=e[0].startTime,i=e[e.length-1].startTime;return TS.createTimeRanges([[t,i]])},i.initSegmentForMap=function(e,t){if(void 0===t&&(t=!1),!e)return null;var i=Aw(e),n=this.initSegments_[i];if(t&&!n&&e.bytes){var r=aA.byteLength+e.bytes.byteLength,s=new Uint8Array(r);s.set(e.bytes),s.set(aA,e.bytes.byteLength),this.initSegments_[i]=n={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:s}}return n||e},i.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},i.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},i.track=function(e){return void 0===e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_},i.remove=function(e,t){kx(e,t,this.subtitlesTrack_)},i.fillBuffer_=function(){var e=this,t=this.chooseNextRequest_();if(t){if(null===this.syncController_.timestampOffsetForTimeline(t.timeline)){return this.syncController_.one("timestampoffset",function(){e.state="READY",e.paused()||e.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(t)}},i.timestampOffsetForSegment_=function(){return null},i.chooseNextRequest_=function(){return this.skipEmptySegments_(e.prototype.chooseNextRequest_.call(this))},i.skipEmptySegments_=function(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e},i.stopForError=function(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")},i.segmentRequestFinished_=function(e,t,i){var n=this;if(this.subtitlesTrack_){if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===nx&&this.handleTimeout_(),e.code===rx?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);var r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");var s=r.segment;if(s.map&&(s.map.bytes=t.map.bytes),r.bytes=t.bytes,"function"!=typeof N.WebVTT&&"function"==typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then(function(){return n.segmentRequestFinished_(e,t,i)},function(){return n.stopForError({message:"Error loading vtt.js"})});s.requested=!0;try{this.parseVTTCues_(r)}catch(a){return void this.stopForError({message:a.message})}if(this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,r.cues.forEach(function(e){n.subtitlesTrack_.addCue(n.featuresNativeTextTracks_?new N.VTTCue(e.startTime,e.endTime,e.text):e)}),function(e){var t=e.cues;if(t)for(var i=0;i<t.length;i++){for(var n=[],r=0,s=0;s<t.length;s++)t[i].startTime===t[s].startTime&&t[i].endTime===t[s].endTime&&t[i].text===t[s].text&&++r>1&&n.push(t[s]);n.length&&n.forEach(function(t){return e.removeCue(t)})}}(this.subtitlesTrack_),this.handleAppendsDone_()}else this.state="READY"},i.handleData_=function(){},i.updateTimingInfoEnd_=function(){},i.parseVTTCues_=function(e){var t,i=!1;if("function"!=typeof N.WebVTT)throw new oA;"function"==typeof N.TextDecoder?t=new N.TextDecoder("utf8"):(t=N.WebVTT.StringDecoder(),i=!0);var n=new N.WebVTT.Parser(N,N.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},n.oncue=e.cues.push.bind(e.cues),n.ontimestampmap=function(t){e.timestampmap=t},n.onparsingerror=function(e){TS.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){var r=e.segment.map.bytes;i&&(r=sA(r)),n.parse(r)}var s=e.bytes;i&&(s=sA(s)),n.parse(s),n.flush()},i.updateTimeMapping_=function(e,t,i){var n=e.segment;if(t)if(e.cues.length){var r=e.timestampmap,s=r.MPEGTS/Jg.ONE_SECOND_IN_TS-r.LOCAL+t.mapping;if(e.cues.forEach(function(e){e.startTime+=s,e.endTime+=s}),!i.syncInfo){var a=e.cues[0].startTime,o=e.cues[e.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:Math.min(a,o-n.duration)}}}else n.empty=!0},t}(Fx),uA=function(e,t){for(var i=e.cues,n=0;n<i.length;n++){var r=i[n];if(t>=r.adStartTime&&t<=r.adEndTime)return r}return null},cA=[{name:"VOD",run:function(e,t,i,n,r){if(i!==1/0){return{time:0,segmentIndex:0,partIndex:null}}return null}},{name:"ProgramDateTime",run:function(e,t,i,n,r){if(!Object.keys(e.timelineToDatetimeMappings).length)return null;var s=null,a=null,o=US(t);r=r||0;for(var l=0;l<o.length;l++){var u=o[t.endList||0===r?l:o.length-(l+1)],c=u.segment,h=e.timelineToDatetimeMappings[c.timeline];if(h&&c.dateTimeObject){var d=c.dateTimeObject.getTime()/1e3+h;if(c.parts&&"number"==typeof u.partIndex)for(var p=0;p<u.partIndex;p++)d+=c.parts[p].duration;var f=Math.abs(r-d);if(null!==a&&(0===f||a<f))break;a=f,s={time:d,segmentIndex:u.segmentIndex,partIndex:u.partIndex}}}return s}},{name:"Segment",run:function(e,t,i,n,r){var s=null,a=null;r=r||0;for(var o=US(t),l=0;l<o.length;l++){var u=o[t.endList||0===r?l:o.length-(l+1)],c=u.segment,h=u.part&&u.part.start||c&&c.start;if(c.timeline===n&&void 0!==h){var d=Math.abs(r-h);if(null!==a&&a<d)break;(!s||null===a||a>=d)&&(a=d,s={time:h,segmentIndex:u.segmentIndex,partIndex:u.partIndex})}}return s}},{name:"Discontinuity",run:function(e,t,i,n,r){var s=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(var a=null,o=0;o<t.discontinuityStarts.length;o++){var l=t.discontinuityStarts[o],u=t.discontinuitySequence+o+1,c=e.discontinuities[u];if(c){var h=Math.abs(r-c.time);if(null!==a&&a<h)break;(!s||null===a||a>=h)&&(a=h,s={time:c.time,segmentIndex:l,partIndex:null})}}return s}},{name:"Playlist",run:function(e,t,i,n,r){return t.syncInfo?{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null}:null}}],hA=function(e){function t(t){var i;return(i=e.call(this)||this).timelines=[],i.discontinuities=[],i.timelineToDatetimeMappings={},i.logger_=ES("SyncController"),i}Ef(t,e);var i=t.prototype;return i.getSyncPoint=function(e,t,i,n){var r=this.runStrategies_(e,t,i,n);return r.length?this.selectSyncPoint_(r,{key:"time",value:n}):null},i.getExpiredTime=function(e,t){if(!e||!e.segments)return null;var i=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!i.length)return null;var n=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return n.segmentIndex>0&&(n.time*=-1),Math.abs(n.time+qS({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:n.segmentIndex,endIndex:0}))},i.runStrategies_=function(e,t,i,n){for(var r=[],s=0;s<cA.length;s++){var a=cA[s],o=a.run(this,e,t,i,n);o&&(o.strategy=a.name,r.push({strategy:a.name,syncPoint:o}))}return r},i.selectSyncPoint_=function(e,t){for(var i=e[0].syncPoint,n=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy,s=1;s<e.length;s++){var a=Math.abs(e[s].syncPoint[t.key]-t.value);a<n&&(n=a,i=e[s].syncPoint,r=e[s].strategy)}return this.logger_("syncPoint for ["+t.key+": "+t.value+"] chosen with strategy ["+r+"]: [time:"+i.time+", segmentIndex:"+i.segmentIndex+("number"==typeof i.partIndex?",partIndex:"+i.partIndex:"")+"]"),i},i.saveExpiredSegmentInfo=function(e,t){var i=t.mediaSequence-e.mediaSequence;if(i>86400)TS.log.warn("Not saving expired segment info. Media sequence gap "+i+" is too large.");else for(var n=i-1;n>=0;n--){var r=e.segments[n];if(r&&void 0!==r.start){t.syncInfo={mediaSequence:e.mediaSequence+n,time:r.start},this.logger_("playlist refresh sync: [time:"+t.syncInfo.time+", mediaSequence: "+t.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}},i.setDateTimeMappingForStart=function(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var t=e.segments[0],i=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-i}},i.saveSegmentTimingInfo=function(e){var t=e.segmentInfo,i=e.shouldSaveTimelineMapping,n=this.calculateSegmentTimeMapping_(t,t.timingInfo,i),r=t.segment;n&&(this.saveDiscontinuitySyncInfo_(t),t.playlist.syncInfo||(t.playlist.syncInfo={mediaSequence:t.playlist.mediaSequence+t.mediaIndex,time:r.start}));var s=r.dateTimeObject;r.discontinuity&&i&&s&&(this.timelineToDatetimeMappings[r.timeline]=-s.getTime()/1e3)},i.timestampOffsetForTimeline=function(e){return void 0===this.timelines[e]?null:this.timelines[e].time},i.mappingForTimeline=function(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping},i.calculateSegmentTimeMapping_=function(e,t,i){var n,r,s=e.segment,a=e.part,o=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},i&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": [time: "+o.time+"] [mapping: "+o.mapping+"]")),n=e.startOfSegment,r=t.end+o.mapping;else{if(!o)return!1;n=t.start+o.mapping,r=t.end+o.mapping}return a&&(a.start=n,a.end=r),(!s.start||n<s.start)&&(s.start=n),s.end=r,!0},i.saveDiscontinuitySyncInfo_=function(e){var t=e.playlist,i=e.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(var n=0;n<t.discontinuityStarts.length;n++){var r=t.discontinuityStarts[n],s=t.discontinuitySequence+n+1,a=r-e.mediaIndex,o=Math.abs(a);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>o){var l=void 0;l=a<0?i.start-qS({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):i.end+qS({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[s]={time:l,accuracy:o}}}},i.dispose=function(){this.trigger("dispose"),this.off()},t}(TS.EventTarget),dA=function(e){function t(){var t;return(t=e.call(this)||this).pendingTimelineChanges_={},t.lastTimelineChanges_={},t}Ef(t,e);var i=t.prototype;return i.clearPendingTimelineChange=function(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")},i.pendingTimelineChange=function(e){var t=e.type,i=e.from,n=e.to;return"number"==typeof i&&"number"==typeof n&&(this.pendingTimelineChanges_[t]={type:t,from:i,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[t]},i.lastTimelineChange=function(e){var t=e.type,i=e.from,n=e.to;return"number"==typeof i&&"number"==typeof n&&(this.lastTimelineChanges_[t]={type:t,from:i,to:n},delete this.pendingTimelineChanges_[t],this.trigger("timelinechange")),this.lastTimelineChanges_[t]},i.dispose=function(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()},t}(TS.EventTarget),pA=qw(Gw(function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&i.path)}},i.exports),i.exports}var i=t(function(e){function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e},e.exports.default=e.exports,e.exports.__esModule=!0}),n=t(function(e){function t(i,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(i,n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}),r=t(function(e){e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0}),s=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(i,1),i>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,n=0;n<i;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();var a,o=null,l=function(){function e(e){var t,i,n;o||(o=function(){var e,t,i,n,r,s,a,o,l=[[[],[],[],[],[]],[[],[],[],[],[]]],u=l[0],c=l[1],h=u[4],d=c[4],p=[],f=[];for(e=0;e<256;e++)f[(p[e]=e<<1^283*(e>>7))^e]=e;for(t=i=0;!h[t];t^=n||1,i=f[i]||1)for(s=(s=i^i<<1^i<<2^i<<3^i<<4)>>8^255&s^99,h[t]=s,d[s]=t,o=16843009*p[r=p[n=p[t]]]^65537*r^257*n^16843008*t,a=257*p[s]^16843008*s,e=0;e<4;e++)u[e][t]=a=a<<24^a>>>8,c[e][s]=o=o<<24^o>>>8;for(e=0;e<5;e++)u[e]=u[e].slice(0),c[e]=c[e].slice(0);return l}()),this._tables=[[o[0][0].slice(),o[0][1].slice(),o[0][2].slice(),o[0][3].slice(),o[0][4].slice()],[o[1][0].slice(),o[1][1].slice(),o[1][2].slice(),o[1][3].slice(),o[1][4].slice()]];var r=this._tables[0][4],s=this._tables[1],a=e.length,l=1;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size");var u=e.slice(0),c=[];for(this._key=[u,c],t=a;t<4*a+28;t++)n=u[t-1],(t%a===0||8===a&&t%a===4)&&(n=r[n>>>24]<<24^r[n>>16&255]<<16^r[n>>8&255]<<8^r[255&n],t%a===0&&(n=n<<8^n>>>24^l<<24,l=l<<1^283*(l>>7))),u[t]=u[t-a]^n;for(i=0;t;i++,t--)n=u[3&i?t:t-4],c[i]=t<=4||i<4?n:s[0][r[n>>>24]]^s[1][r[n>>16&255]]^s[2][r[n>>8&255]]^s[3][r[255&n]]}return e.prototype.decrypt=function(e,t,i,n,r,s){var a,o,l,u,c=this._key[1],h=e^c[0],d=n^c[1],p=i^c[2],f=t^c[3],m=c.length/4-2,g=4,y=this._tables[1],v=y[0],_=y[1],b=y[2],T=y[3],S=y[4];for(u=0;u<m;u++)a=v[h>>>24]^_[d>>16&255]^b[p>>8&255]^T[255&f]^c[g],o=v[d>>>24]^_[p>>16&255]^b[f>>8&255]^T[255&h]^c[g+1],l=v[p>>>24]^_[f>>16&255]^b[h>>8&255]^T[255&d]^c[g+2],f=v[f>>>24]^_[h>>16&255]^b[d>>8&255]^T[255&p]^c[g+3],g+=4,h=a,d=o,p=l;for(u=0;u<4;u++)r[(3&-u)+s]=S[h>>>24]<<24^S[d>>16&255]<<16^S[p>>8&255]<<8^S[255&f]^c[g++],a=h,h=d,d=p,p=f,f=a},e}(),u=function(e){function t(){var t;return(t=e.call(this,s)||this).jobs=[],t.delay=1,t.timeout_=null,t}r(t,e);var i=t.prototype;return i.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},i.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(s),c=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},h=function(){function e(t,i,n,r){var s=e.STEP,a=new Int32Array(t.buffer),o=new Uint8Array(t.byteLength),l=0;for(this.asyncStream_=new u,this.asyncStream_.push(this.decryptChunk_(a.subarray(l,l+s),i,n,o)),l=s;l<a.length;l+=s)n=new Uint32Array([c(a[l-4]),c(a[l-3]),c(a[l-2]),c(a[l-1])]),this.asyncStream_.push(this.decryptChunk_(a.subarray(l,l+s),i,n,o));this.asyncStream_.push(function(){var e;r(null,(e=o).subarray(0,e.byteLength-e[e.byteLength-1]))})}return e.prototype.decryptChunk_=function(e,t,i,n){return function(){var r=function(e,t,i){var n,r,s,a,o,u,h,d,p,f=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),m=new l(Array.prototype.slice.call(t)),g=new Uint8Array(e.byteLength),y=new Int32Array(g.buffer);for(n=i[0],r=i[1],s=i[2],a=i[3],p=0;p<f.length;p+=4)o=c(f[p]),u=c(f[p+1]),h=c(f[p+2]),d=c(f[p+3]),m.decrypt(o,u,h,d,y,p),y[p]=c(y[p]^n),y[p+1]=c(y[p+1]^r),y[p+2]=c(y[p+2]^s),y[p+3]=c(y[p+3]^a),n=o,r=u,s=h,a=d;return g}(e,t,i);n.set(r,e.byteOffset)}},i(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}();a="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};var d=a.BigInt||Number;d("0x1"),d("0x100"),d("0x10000"),d("0x1000000"),d("0x100000000"),d("0x10000000000"),d("0x1000000000000"),d("0x100000000000000"),d("0x10000000000000000");var p=function(e){var t={};return Object.keys(e).forEach(function(i){var n,r=e[i];n=r,("function"===ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer)?t[i]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[i]=r}),t};self.onmessage=function(e){var t=e.data,i=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),n=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),r=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new h(i,n,r,function(e,i){self.postMessage(p({source:t.source,decrypted:i}),[i.buffer])})}})),fA=Hw(pA),mA=function(e){var t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},gA=function(e,t){e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},yA=function(e,t){t.activePlaylistLoader=e,e.load()},vA={AUDIO:function(e,t){return function(){var i=t.segmentLoaders[e],n=t.mediaTypes[e],r=t.blacklistCurrentPlaylist;gA(i,n);var s=n.activeTrack(),a=n.activeGroup(),o=(a.filter(function(e){return e.default})[0]||a[0]).id,l=n.tracks[o];if(s!==l){for(var u in TS.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),n.tracks)n.tracks[u].enabled=n.tracks[u]===l;n.onTrackChanged()}else r({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(e,t){return function(){var i=t.segmentLoaders[e],n=t.mediaTypes[e];TS.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),gA(i,n);var r=n.activeTrack();r&&(r.mode="disabled"),n.onTrackChanged()}}},_A={AUDIO:function(e,t,i){if(t){var n=i.tech,r=i.requestOptions,s=i.segmentLoaders[e];t.on("loadedmetadata",function(){var e=t.media();s.playlist(e,r),(!n.paused()||e.endList&&"none"!==n.preload())&&s.load()}),t.on("loadedplaylist",function(){s.playlist(t.media(),r),n.paused()||s.load()}),t.on("error",vA[e](e,i))}},SUBTITLES:function(e,t,i){var n=i.tech,r=i.requestOptions,s=i.segmentLoaders[e],a=i.mediaTypes[e];t.on("loadedmetadata",function(){var e=t.media();s.playlist(e,r),s.track(a.activeTrack()),(!n.paused()||e.endList&&"none"!==n.preload())&&s.load()}),t.on("loadedplaylist",function(){s.playlist(t.media(),r),n.paused()||s.load()}),t.on("error",vA[e](e,i))}},bA={AUDIO:function(e,t){var i=t.vhs,n=t.sourceType,r=t.segmentLoaders[e],s=t.requestOptions,a=t.master.mediaGroups,o=t.mediaTypes[e],l=o.groups,u=o.tracks,c=o.logger_,h=t.masterPlaylistLoader,d=JS(h.master);for(var p in a[e]&&0!==Object.keys(a[e]).length||(a[e]={main:{default:{default:!0}}},d&&(a[e].main.default.playlists=h.master.playlists)),a[e])for(var f in l[p]||(l[p]=[]),a[e][p]){var m=a[e][p][f],g=void 0;if(d?(c("AUDIO group '"+p+"' label '"+f+"' is a master playlist"),m.isMasterPlaylist=!0,g=null):g="vhs-json"===n&&m.playlists?new mw(m.playlists[0],i,s):m.resolvedUri?new mw(m.resolvedUri,i,s):m.playlists&&"dash"===n?new jw(m.playlists[0],i,s,h):null,m=TS.mergeOptions({id:f,playlistLoader:g},m),_A[e](e,m.playlistLoader,t),l[p].push(m),void 0===u[f]){var y=new TS.AudioTrack({id:f,kind:mA(m),enabled:!1,language:m.language,default:m.default,label:f});u[f]=y}}r.on("error",vA[e](e,t))},SUBTITLES:function(e,t){var i=t.tech,n=t.vhs,r=t.sourceType,s=t.segmentLoaders[e],a=t.requestOptions,o=t.master.mediaGroups,l=t.mediaTypes[e],u=l.groups,c=l.tracks,h=t.masterPlaylistLoader;for(var d in o[e])for(var p in u[d]||(u[d]=[]),o[e][d])if(!o[e][d][p].forced){var f=o[e][d][p],m=void 0;if("hls"===r)m=new mw(f.resolvedUri,n,a);else if("dash"===r){if(!f.playlists.filter(function(e){return e.excludeUntil!==1/0}).length)return;m=new jw(f.playlists[0],n,a,h)}else"vhs-json"===r&&(m=new mw(f.playlists?f.playlists[0]:f.resolvedUri,n,a));if(f=TS.mergeOptions({id:p,playlistLoader:m},f),_A[e](e,f.playlistLoader,t),u[d].push(f),void 0===c[p]){var g=i.addRemoteTextTrack({id:p,kind:"subtitles",default:f.default&&f.autoselect,language:f.language,label:p},!1).track;c[p]=g}}s.on("error",vA[e](e,t))},"CLOSED-CAPTIONS":function(e,t){var i=t.tech,n=t.master.mediaGroups,r=t.mediaTypes[e],s=r.groups,a=r.tracks;for(var o in n[e])for(var l in s[o]||(s[o]=[]),n[e][o]){var u=n[e][o][l];if(/^(?:CC|SERVICE)/.test(u.instreamId)){var c=i.options_.vhs&&i.options_.vhs.captionServices||{},h={label:l,language:u.language,instreamId:u.instreamId,default:u.default&&u.autoselect};if(c[h.instreamId]&&(h=TS.mergeOptions(h,c[h.instreamId])),void 0===h.default&&delete h.default,s[o].push(TS.mergeOptions({id:l},u)),void 0===a[l]){var d=i.addRemoteTextTrack({id:h.instreamId,kind:"captions",default:h.default,language:h.language,label:h.label},!1).track;a[l]=d}}}}},TA=function e(t,i){for(var n=0;n<t.length;n++){if(KS(i,t[n]))return!0;if(t[n].playlists&&e(t[n].playlists,i))return!0}return!1},SA={AUDIO:function(e,t){return function(){var i=t.mediaTypes[e].tracks;for(var n in i)if(i[n].enabled)return i[n];return null}},SUBTITLES:function(e,t){return function(){var i=t.mediaTypes[e].tracks;for(var n in i)if("showing"===i[n].mode||"hidden"===i[n].mode)return i[n];return null}}},wA=function(e){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){bA[t](t,e)});var t=e.mediaTypes,i=e.masterPlaylistLoader,n=e.tech,r=e.vhs,s=e.segmentLoaders,a=s.AUDIO,o=s.main;["AUDIO","SUBTITLES"].forEach(function(i){t[i].activeGroup=function(e,t){return function(i){var n=t.masterPlaylistLoader,r=t.mediaTypes[e].groups,s=n.media();if(!s)return null;var a=null;s.attributes[e]&&(a=r[s.attributes[e]]);var o=Object.keys(r);if(!a)if("AUDIO"===e&&o.length>1&&JS(t.master))for(var l=0;l<o.length;l++){var u=r[o[l]];if(TA(u,s)){a=u;break}}else r.main?a=r.main:1===o.length&&(a=r[o[0]]);return void 0===i?a:null!==i&&a&&a.filter(function(e){return e.id===i.id})[0]||null}}(i,e),t[i].activeTrack=SA[i](i,e),t[i].onGroupChanged=function(e,t){return function(){var i=t.segmentLoaders,n=i[e],r=i.main,s=t.mediaTypes[e],a=s.activeTrack(),o=s.getActiveGroup(),l=s.activePlaylistLoader,u=s.lastGroup_;o&&u&&o.id===u.id||(s.lastGroup_=o,s.lastTrack_=a,gA(n,s),o&&!o.isMasterPlaylist&&(o.playlistLoader?(n.resyncLoader(),yA(o.playlistLoader,s)):l&&r.resetEverything()))}}(i,e),t[i].onGroupChanging=function(e,t){return function(){var i=t.segmentLoaders[e];t.mediaTypes[e].lastGroup_=null,i.abort(),i.pause()}}(i,e),t[i].onTrackChanged=function(e,t){return function(){var i=t.masterPlaylistLoader,n=t.segmentLoaders,r=n[e],s=n.main,a=t.mediaTypes[e],o=a.activeTrack(),l=a.getActiveGroup(),u=a.activePlaylistLoader,c=a.lastTrack_;if((!c||!o||c.id!==o.id)&&(a.lastGroup_=l,a.lastTrack_=o,gA(r,a),l)){if(l.isMasterPlaylist){if(!o||!c||o.id===c.id)return;var h=t.vhs.masterPlaylistController_,d=h.selectPlaylist();if(h.media()===d)return;return a.logger_("track change. Switching master audio from "+c.id+" to "+o.id),i.pause(),s.resetEverything(),void h.fastQualityChange_(d)}if("AUDIO"===e){if(!l.playlistLoader)return s.setAudio(!0),void s.resetEverything();r.setAudio(!0),s.setAudio(!1)}u!==l.playlistLoader?(r.track&&r.track(o),r.resetEverything(),yA(l.playlistLoader,a)):yA(l.playlistLoader,a)}}}(i,e),t[i].getActiveGroup=function(e,t){var i=t.mediaTypes;return function(){var t=i[e].activeTrack();return t?i[e].activeGroup(t):null}}(i,e)});var l=t.AUDIO.activeGroup();if(l){var u=(l.filter(function(e){return e.default})[0]||l[0]).id;t.AUDIO.tracks[u].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged(),t.AUDIO.getActiveGroup().playlistLoader?(o.setAudio(!1),a.setAudio(!0)):o.setAudio(!0)}i.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanged()})}),i.on("mediachanging",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanging()})});var c=function(){t.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"}),n.trigger({type:"usage",name:"hls-audio-change"})};for(var h in n.audioTracks().addEventListener("change",c),n.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",function(){n.audioTracks().removeEventListener("change",c),n.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),n.clearTracks("audio"),t.AUDIO.tracks)n.audioTracks().addTrack(t.AUDIO.tracks[h])},xA=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],AA=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},EA=function(e){function t(t){var i;i=e.call(this)||this;var n=t.src,r=t.handleManifestRedirects,s=t.withCredentials,a=t.tech,o=t.bandwidth,l=t.externVhs,u=t.useCueTags,c=t.blacklistDuration,h=t.enableLowInitialPlaylist,d=t.sourceType,p=t.cacheEncryptionKeys,f=t.experimentalBufferBasedABR,m=t.experimentalLeastPixelDiffSelector,g=t.captionServices;if(!n)throw new Error("A non-empty playlist URL or JSON manifest string is required");var y,v=t.maxPlaylistRetries;null==v&&(v=1/0),Bx=l,i.experimentalBufferBasedABR=Boolean(f),i.experimentalLeastPixelDiffSelector=Boolean(m),i.withCredentials=s,i.tech_=a,i.vhs_=a.vhs,i.sourceType_=d,i.useCueTags_=u,i.blacklistDuration=c,i.maxPlaylistRetries=v,i.enableLowInitialPlaylist=h,i.useCueTags_&&(i.cueTagsTrack_=i.tech_.addTextTrack("metadata","ad-cues"),i.cueTagsTrack_.inBandMetadataTrackDispatchType=""),i.requestOptions_={withCredentials:s,handleManifestRedirects:r,maxPlaylistRetries:v,timeout:null},i.on("error",i.pauseLoading),i.mediaTypes_=(y={},["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(e){y[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Ux,activeTrack:Ux,getActiveGroup:Ux,onGroupChanged:Ux,onTrackChanged:Ux,lastTrack_:null,logger_:ES("MediaGroups["+e+"]")}}),y),i.mediaSource=new N.MediaSource,i.handleDurationChange_=i.handleDurationChange_.bind(xf(i)),i.handleSourceOpen_=i.handleSourceOpen_.bind(xf(i)),i.handleSourceEnded_=i.handleSourceEnded_.bind(xf(i)),i.mediaSource.addEventListener("durationchange",i.handleDurationChange_),i.mediaSource.addEventListener("sourceopen",i.handleSourceOpen_),i.mediaSource.addEventListener("sourceended",i.handleSourceEnded_),i.seekable_=TS.createTimeRanges(),i.hasPlayed_=!1,i.syncController_=new hA(t),i.segmentMetadataTrack_=a.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,i.decrypter_=new fA,i.sourceUpdater_=new rA(i.mediaSource),i.inbandTextTracks_={},i.timelineChangeController_=new dA;var _={vhs:i.vhs_,parse708captions:t.parse708captions,useDtsForTimestampOffset:t.useDtsForTimestampOffset,captionServices:g,mediaSource:i.mediaSource,currentTime:i.tech_.currentTime.bind(i.tech_),seekable:function(){return i.seekable()},seeking:function(){return i.tech_.seeking()},duration:function(){return i.duration()},hasPlayed:function(){return i.hasPlayed_},goalBufferLength:function(){return i.goalBufferLength()},bandwidth:o,syncController:i.syncController_,decrypter:i.decrypter_,sourceType:i.sourceType_,inbandTextTracks:i.inbandTextTracks_,cacheEncryptionKeys:p,sourceUpdater:i.sourceUpdater_,timelineChangeController:i.timelineChangeController_,experimentalExactManifestTimings:t.experimentalExactManifestTimings};i.masterPlaylistLoader_="dash"===i.sourceType_?new jw(n,i.vhs_,i.requestOptions_):new mw(n,i.vhs_,i.requestOptions_),i.setupMasterPlaylistLoaderListeners_(),i.mainSegmentLoader_=new Fx(TS.mergeOptions(_,{segmentMetadataTrack:i.segmentMetadataTrack_,loaderType:"main"}),t),i.audioSegmentLoader_=new Fx(TS.mergeOptions(_,{loaderType:"audio"}),t),i.subtitleSegmentLoader_=new lA(TS.mergeOptions(_,{loaderType:"vtt",featuresNativeTextTracks:i.tech_.featuresNativeTextTracks,loadVttJs:function(){return new Promise(function(e,t){function i(){a.off("vttjserror",n),e()}function n(){a.off("vttjsloaded",i),t()}a.one("vttjsloaded",i),a.one("vttjserror",n),a.addWebVttScript_()})}}),t),i.setupSegmentLoaderListeners_(),i.experimentalBufferBasedABR&&(i.masterPlaylistLoader_.one("loadedplaylist",function(){return i.startABRTimer_()}),i.tech_.on("pause",function(){return i.stopABRTimer_()}),i.tech_.on("play",function(){return i.startABRTimer_()})),xA.forEach(function(e){i[e+"_"]=AA.bind(xf(i),e)}),i.logger_=ES("MPC"),i.triggeredFmp4Usage=!1,"none"===i.tech_.preload()?(i.loadOnPlay_=function(){i.loadOnPlay_=null,i.masterPlaylistLoader_.load()},i.tech_.one("play",i.loadOnPlay_)):i.masterPlaylistLoader_.load(),i.timeToLoadedData__=-1,i.mainAppendsToLoadedData__=-1,i.audioAppendsToLoadedData__=-1;var b="none"===i.tech_.preload()?"play":"loadstart";return i.tech_.one(b,function(){var e=Date.now();i.tech_.one("loadeddata",function(){i.timeToLoadedData__=Date.now()-e,i.mainAppendsToLoadedData__=i.mainSegmentLoader_.mediaAppends,i.audioAppendsToLoadedData__=i.audioSegmentLoader_.mediaAppends})}),i}Ef(t,e);var i=t.prototype;return i.mainAppendsToLoadedData_=function(){return this.mainAppendsToLoadedData__},i.audioAppendsToLoadedData_=function(){return this.audioAppendsToLoadedData__},i.appendsToLoadedData_=function(){var e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t},i.timeToLoadedData_=function(){return this.timeToLoadedData__},i.checkABR_=function(e){void 0===e&&(e="abr");var t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)},i.switchMedia_=function(e,t,i){var n=this.media(),r=n&&(n.id||n.uri),s=e.id||e.uri;r&&r!==s&&(this.logger_("switch media "+r+" -> "+s+" from "+t),this.tech_.trigger({type:"usage",name:"vhs-rendition-change-"+t})),this.masterPlaylistLoader_.media(e,i)},i.startABRTimer_=function(){var e=this;this.stopABRTimer_(),this.abrTimer_=N.setInterval(function(){return e.checkABR_()},250)},i.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(N.clearInterval(this.abrTimer_),this.abrTimer_=null)},i.getAudioTrackPlaylists_=function(){var e=this.master(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;var i,n=e.mediaGroups.AUDIO,r=Object.keys(n);if(Object.keys(this.mediaTypes_.AUDIO.groups).length)i=this.mediaTypes_.AUDIO.activeTrack();else{var s=n.main||r.length&&n[r[0]];for(var a in s)if(s[a].default){i={label:a};break}}if(!i)return t;var o=[];for(var l in n)if(n[l][i.label]){var u=n[l][i.label];if(u.playlists&&u.playlists.length)o.push.apply(o,u.playlists);else if(u.uri)o.push(u);else if(e.playlists.length)for(var c=0;c<e.playlists.length;c++){var h=e.playlists[c];h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===l&&o.push(h)}}return o.length?o:t},i.setupMasterPlaylistLoaderListeners_=function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=e.masterPlaylistLoader_.media(),i=1.5*t.targetDuration*1e3;QS(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=i,t.endList&&"none"!==e.tech_.preload()&&(e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load()),wA({sourceType:e.sourceType_,segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,vhs:e.vhs_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),t),e.setupFirstPlay(),!e.mediaTypes_.AUDIO.activePlaylistLoader||e.mediaTypes_.AUDIO.activePlaylistLoader.media()?e.trigger("selectedinitialmedia"):e.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){e.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){e.loadOnPlay_&&e.tech_.off("play",e.loadOnPlay_);var t=e.masterPlaylistLoader_.media();if(!t){var i;if(e.excludeUnsupportedVariants_(),e.enableLowInitialPlaylist&&(i=e.selectInitialPlaylist()),i||(i=e.selectPlaylist()),!i||!e.shouldSwitchToMedia_(i))return;if(e.initialMedia_=i,e.switchMedia_(e.initialMedia_,"initial"),!("vhs-json"===e.sourceType_&&e.initialMedia_.segments))return;t=e.initialMedia_}e.handleUpdatedMediaPlaylist(t)}),this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var t=e.masterPlaylistLoader_.media(),i=1.5*t.targetDuration*1e3;QS(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=i,e.masterPlaylistLoader_.load(),e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var t=e.masterPlaylistLoader_.media();"playlist-unchanged"!==t.lastExcludeReason_&&(e.stuckAtPlaylistEnd_(t)&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating.",reason:"playlist-unchanged"}),e.tech_.trigger("playliststuck")))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},i.handleUpdatedMediaPlaylist=function(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},i.triggerPresenceUsage_=function(e,t){var i=e.mediaGroups||{},n=!0,r=Object.keys(i.AUDIO);for(var s in i.AUDIO)for(var a in i.AUDIO[s]){i.AUDIO[s][a].uri||(n=!1)}n&&(this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),this.tech_.trigger({type:"usage",name:"hls-demuxed"})),Object.keys(i.SUBTITLES).length&&(this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),this.tech_.trigger({type:"usage",name:"hls-webvtt"})),Bx.Playlist.isAes(t)&&(this.tech_.trigger({type:"usage",name:"vhs-aes"}),this.tech_.trigger({type:"usage",name:"hls-aes"})),r.length&&Object.keys(i.AUDIO[r[0]]).length>1&&(this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})),this.useCueTags_&&(this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"}),this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"}))},i.shouldSwitchToMedia_=function(e){var t=this.masterPlaylistLoader_.media()||this.masterPlaylistLoader_.pendingMedia_,i=this.tech_.currentTime(),n=this.bufferLowWaterLine(),r=this.bufferHighWaterLine();return function(e){var t=e.currentPlaylist,i=e.buffered,n=e.currentTime,r=e.nextPlaylist,s=e.bufferLowWaterLine,a=e.bufferHighWaterLine,o=e.duration,l=e.experimentalBufferBasedABR,u=e.log;if(!r)return TS.log.warn("We received no playlist to switch to. Please check your stream."),!1;var c="allowing switch "+(t&&t.id||"null")+" -> "+r.id;if(!t)return u(c+" as current playlist is not set"),!0;if(r.id===t.id)return!1;var h=Boolean(IS(i,n).length);if(!t.endList)return h||"number"!=typeof t.partTargetDuration?(u(c+" as current playlist is live"),!0):(u("not "+c+" as current playlist is live llhls, but currentTime isn't in buffered."),!1);var d=RS(i,n),p=l?zw.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:zw.MAX_BUFFER_LOW_WATER_LINE;if(o<p)return u(c+" as duration < max low water line ("+o+" < "+p+")"),!0;var f=r.attributes.BANDWIDTH,m=t.attributes.BANDWIDTH;if(f<m&&(!l||d<a)){var g=c+" as next bandwidth < current bandwidth ("+f+" < "+m+")";return l&&(g+=" and forwardBuffer < bufferHighWaterLine ("+d+" < "+a+")"),u(g),!0}if((!l||f>m)&&d>=s){var y=c+" as forwardBuffer >= bufferLowWaterLine ("+d+" >= "+s+")";return l&&(y+=" and next bandwidth > current bandwidth ("+f+" > "+m+")"),u(y),!0}return u("not "+c+" as no switching criteria met"),!1}({buffered:this.tech_.buffered(),currentTime:i,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:n,bufferHighWaterLine:r,duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},i.setupSegmentLoaderListeners_=function(){var e=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){e.checkABR_("bandwidthupdate"),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",function(){e.experimentalBufferBasedABR&&e.mainSegmentLoader_.load()}),this.experimentalBufferBasedABR||this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")}),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){e.error=e.mainSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"}),e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){e.error=e.audioSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){e.logger_("main segment loader ended"),e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(t){e.experimentalBufferBasedABR||(e.delegateLoaders_("all",["abort"]),e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120))});var t=function(){if(!e.sourceUpdater_.hasCreatedSourceBuffers())return e.tryToCreateSourceBuffers_();var t=e.getCodecsOrExclude_();t&&e.sourceUpdater_.addOrChangeSourceBuffers(t)};this.mainSegmentLoader_.on("trackinfo",t),this.audioSegmentLoader_.on("trackinfo",t),this.mainSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){e.logger_("audioSegmentLoader ended"),e.onEndOfStream()})},i.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},i.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},i.smoothQualityChange_=function(e){void 0===e&&(e=this.selectPlaylist()),this.fastQualityChange_(e)},i.fastQualityChange_=function(e){var t=this;void 0===e&&(e=this.selectPlaylist()),e!==this.masterPlaylistLoader_.media()?(this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything(function(){TS.browser.IE_VERSION||TS.browser.IS_EDGE?t.tech_.setCurrentTime(t.tech_.currentTime()+.04):t.tech_.setCurrentTime(t.tech_.currentTime())})):this.logger_("skipping fastQualityChange because new media is same as old")},i.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}},i.setupFirstPlay=function(){var e=this,t=this.masterPlaylistLoader_.media();if(!t||this.tech_.paused()||this.hasPlayed_)return!1;if(!t.endList){var i=this.seekable();if(!i.length)return!1;if(TS.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.tech_.setCurrentTime(i.end(0)),e.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(i.end(0))}return this.hasPlayed_=!0,this.load(),!0},i.handleSourceOpen_=function(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){var e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,function(e){})}this.trigger("sourceopen")},i.handleSourceEnded_=function(){if(this.inbandTextTracks_.metadataTrack_){var e=this.inbandTextTracks_.metadataTrack_.cues;if(e&&e.length){var t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}}},i.handleDurationChange_=function(){this.tech_.trigger("durationchange")},i.onEndOfStream=function(){var e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){var t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},i.stuckAtPlaylistEnd_=function(e){if(!this.seekable().length)return!1;var t=this.syncController_.getExpiredTime(e,this.duration());if(null===t)return!1;var i=Bx.Playlist.playlistEnd(e,t),n=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return i-n<=MS;var s=r.end(r.length-1);return s-n<=MS&&i-s<=MS},i.blacklistCurrentPlaylist=function(e,t){void 0===e&&(e={});var i=e.playlist||this.masterPlaylistLoader_.media();if(t=t||e.blacklistDuration||this.blacklistDuration,!i)return this.error=e,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));i.playlistErrors_++;var n,r=this.masterPlaylistLoader_.master.playlists,s=r.filter(XS),a=1===s.length&&s[0]===i;if(1===r.length&&t!==1/0)return TS.log.warn("Problem encountered with playlist "+i.id+". Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(a);if(a){var o=!1;r.forEach(function(e){if(e!==i){var t=e.excludeUntil;void 0!==t&&t!==1/0&&(o=!0,delete e.excludeUntil)}}),o&&(TS.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}n=i.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*t,i.excludeUntil=n,e.reason&&(i.lastExcludeReason_=e.reason),this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-blacklisted"}),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});var l=this.selectPlaylist();if(!l)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");var u=e.internal?this.logger_:TS.log.warn,c=e.message?" "+e.message:"";u((e.internal?"Internal problem":"Problem")+" encountered with playlist "+i.id+"."+c+" Switching to playlist "+l.id+"."),l.attributes.AUDIO!==i.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),l.attributes.SUBTITLES!==i.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);var h=l.targetDuration/2*1e3||5e3,d="number"==typeof l.lastRequest&&Date.now()-l.lastRequest<=h;return this.switchMedia_(l,"exclude",a||d)},i.pauseLoading=function(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()},i.delegateLoaders_=function(e,t){var i=this,n=[],r="all"===e;(r||"main"===e)&&n.push(this.masterPlaylistLoader_);var s=[];(r||"audio"===e)&&s.push("AUDIO"),(r||"subtitle"===e)&&(s.push("CLOSED-CAPTIONS"),s.push("SUBTITLES")),s.forEach(function(e){var t=i.mediaTypes_[e]&&i.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)}),["main","audio","subtitle"].forEach(function(t){var r=i[t+"SegmentLoader_"];!r||e!==t&&"all"!==e||n.push(r)}),n.forEach(function(e){return t.forEach(function(t){"function"==typeof e[t]&&e[t]()})})},i.setCurrentTime=function(e){var t=IS(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},i.duration=function(){if(!this.masterPlaylistLoader_)return 0;var e=this.masterPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Bx.Playlist.duration(e):1/0:0},i.seekable=function(){return this.seekable_},i.onSyncInfoUpdate_=function(){var e;if(this.masterPlaylistLoader_){var t=this.masterPlaylistLoader_.media();if(t){var i=this.syncController_.getExpiredTime(t,this.duration());if(null!==i){var n=this.masterPlaylistLoader_.master,r=Bx.Playlist.seekable(t,i,Bx.Playlist.liveEdgeDelay(n,t));if(0!==r.length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(i=this.syncController_.getExpiredTime(t,this.duration())))return;if(0===(e=Bx.Playlist.seekable(t,i,Bx.Playlist.liveEdgeDelay(n,t))).length)return}var s,a;this.seekable_&&this.seekable_.length&&(s=this.seekable_.end(0),a=this.seekable_.start(0)),e?e.start(0)>r.end(0)||r.start(0)>e.end(0)?this.seekable_=r:this.seekable_=TS.createTimeRanges([[e.start(0)>r.start(0)?e.start(0):r.start(0),e.end(0)<r.end(0)?e.end(0):r.end(0)]]):this.seekable_=r,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===s&&this.seekable_.start(0)===a||(this.logger_("seekable updated ["+LS(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},i.updateDuration=function(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){var t=this.seekable();if(!t.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<t.end(t.length-1))&&this.sourceUpdater_.setDuration(t.end(t.length-1))}else{var i=this.tech_.buffered(),n=Bx.Playlist.duration(this.masterPlaylistLoader_.media());i.length>0&&(n=Math.max(n,i.end(i.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}},i.dispose=function(){var e=this;this.trigger("dispose"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(function(t){var i=e.mediaTypes_[t].groups;for(var n in i)i[n].forEach(function(e){e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()},i.master=function(){return this.masterPlaylistLoader_.master},i.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},i.areMediaTypesKnown_=function(){var e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),i=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!i)},i.getCodecsOrExclude_=function(){var e=this,t={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},i=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();t.video=t.main;var n=bx(this.master(),i),r={},s=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(t.main.hasVideo&&(r.video=n.video||t.main.videoCodec||"avc1.4d400d"),t.main.isMuxed&&(r.video+=","+(n.audio||t.main.audioCodec||pm)),(t.main.hasAudio&&!t.main.isMuxed||t.audio.hasAudio||s)&&(r.audio=n.audio||t.main.audioCodec||t.audio.audioCodec||pm,t.audio.isFmp4=t.main.hasAudio&&!t.main.isMuxed?t.main.isFmp4:t.audio.isFmp4),r.audio||r.video){var a,o={};if(["video","audio"].forEach(function(e){if(r.hasOwnProperty(e)&&(n=t[e].isFmp4,s=r[e],!(n?hm(s):dm(s)))){var i=t[e].isFmp4?"browser":"muxer";o[i]=o[i]||[],o[i].push(r[e]),"audio"===e&&(a=i)}var n,s}),s&&a&&i.attributes.AUDIO){var l=i.attributes.AUDIO;this.master().playlists.forEach(function(e){(e.attributes&&e.attributes.AUDIO)===l&&e!==i&&(e.excludeUntil=1/0)}),this.logger_("excluding audio group "+l+" as "+a+' does not support codec(s): "'+r.audio+'"')}if(!Object.keys(o).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var u=[];if(["video","audio"].forEach(function(t){var i=(lm(e.sourceUpdater_.codecs[t]||"")[0]||{}).type,n=(lm(r[t]||"")[0]||{}).type;i&&n&&i.toLowerCase()!==n.toLowerCase()&&u.push('"'+e.sourceUpdater_.codecs[t]+'" -> "'+r[t]+'"')}),u.length)return void this.blacklistCurrentPlaylist({playlist:i,message:"Codec switching not supported: "+u.join(", ")+".",blacklistDuration:1/0,internal:!0})}return r}var c=Object.keys(o).reduce(function(e,t){return e&&(e+=", "),e+=t+' does not support codec(s): "'+o[t].join(",")+'"'},"")+".";this.blacklistCurrentPlaylist({playlist:i,internal:!0,message:c,blacklistDuration:1/0})}else this.blacklistCurrentPlaylist({playlist:i,message:"Could not determine codecs for playlist.",blacklistDuration:1/0})},i.tryToCreateSourceBuffers_=function(){if("open"===this.mediaSource.readyState&&!this.sourceUpdater_.hasCreatedSourceBuffers()&&this.areMediaTypesKnown_()){var e=this.getCodecsOrExclude_();if(e){this.sourceUpdater_.createSourceBuffers(e);var t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}}},i.excludeUnsupportedVariants_=function(){var e=this,t=this.master().playlists,i=[];Object.keys(t).forEach(function(n){var r=t[n];if(-1===i.indexOf(r.id)){i.push(r.id);var s=bx(e.master,r),a=[];!s.audio||dm(s.audio)||hm(s.audio)||a.push("audio codec "+s.audio),!s.video||dm(s.video)||hm(s.video)||a.push("video codec "+s.video),s.text&&"stpp.ttml.im1t"===s.text&&a.push("text codec "+s.text),a.length&&(r.excludeUntil=1/0,e.logger_("excluding "+r.id+" for unsupported: "+a.join(", ")))}})},i.excludeIncompatibleVariants_=function(e){var t=this,i=[],n=this.master().playlists,r=vx(lm(e)),s=_x(r),a=r.video&&lm(r.video)[0]||null,o=r.audio&&lm(r.audio)[0]||null;Object.keys(n).forEach(function(e){var r=n[e];if(-1===i.indexOf(r.id)&&r.excludeUntil!==1/0){i.push(r.id);var l=[],u=bx(t.masterPlaylistLoader_.master,r),c=_x(u);if(u.audio||u.video){if(c!==s&&l.push('codec count "'+c+'" !== "'+s+'"'),!t.sourceUpdater_.canChangeType()){var h=u.video&&lm(u.video)[0]||null,d=u.audio&&lm(u.audio)[0]||null;h&&a&&h.type.toLowerCase()!==a.type.toLowerCase()&&l.push('video codec "'+h.type+'" !== "'+a.type+'"'),d&&o&&d.type.toLowerCase()!==o.type.toLowerCase()&&l.push('audio codec "'+d.type+'" !== "'+o.type+'"')}l.length&&(r.excludeUntil=1/0,t.logger_("blacklisting "+r.id+": "+l.join(" && ")))}}})},i.updateAdCues_=function(e){var t=0,i=this.seekable();i.length&&(t=i.start(0)),function(e,t,i){if(void 0===i&&(i=0),e.segments)for(var n,r=i,s=0;s<e.segments.length;s++){var a=e.segments[s];if(n||(n=uA(t,r+a.duration/2)),n){if("cueIn"in a){n.endTime=r,n.adEndTime=r,r+=a.duration,n=null;continue}if(r<n.endTime){r+=a.duration;continue}n.endTime+=a.duration}else if("cueOut"in a&&((n=new N.VTTCue(r,r+a.duration,a.cueOut)).adStartTime=r,n.adEndTime=r+parseFloat(a.cueOut),t.addCue(n)),"cueOutCont"in a){var o=a.cueOutCont.split("/").map(parseFloat),l=o[0],u=o[1];(n=new N.VTTCue(r,r+a.duration,"")).adStartTime=r-l,n.adEndTime=n.adStartTime+u,t.addCue(n)}r+=a.duration}}(e,this.cueTagsTrack_,t)},i.goalBufferLength=function(){var e=this.tech_.currentTime(),t=zw.GOAL_BUFFER_LENGTH,i=zw.GOAL_BUFFER_LENGTH_RATE,n=Math.max(t,zw.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,n)},i.bufferLowWaterLine=function(){var e=this.tech_.currentTime(),t=zw.BUFFER_LOW_WATER_LINE,i=zw.BUFFER_LOW_WATER_LINE_RATE,n=Math.max(t,zw.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,zw.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,this.experimentalBufferBasedABR?r:n)},i.bufferHighWaterLine=function(){return zw.BUFFER_HIGH_WATER_LINE},t}(TS.EventTarget),CA=function(e,t,i){var n,r,s,a=e.masterPlaylistController_,o=a[(e.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(a);if(t.attributes){var l=t.attributes.RESOLUTION;this.width=l&&l.width,this.height=l&&l.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=bx(a.master(),t),this.playlist=t,this.id=i,this.enabled=(n=e.playlists,r=t.id,s=o,function(e){var t=n.master.playlists[r],i=$S(t),a=XS(t);return void 0===e?a:(e?delete t.disabled:t.disabled=!0,e===a||i||(s(),e?n.trigger("renditionenabled"):n.trigger("renditiondisabled")),e)})},MA=["seeking","seeked","pause","playing","error"],kA=function(){function e(e){var t=this;this.masterPlaylistController_=e.masterPlaylistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=ES("PlaybackWatcher"),this.logger_("initialize");var i=function(){return t.monitorCurrentTime_()},n=function(){return t.monitorCurrentTime_()},r=function(){return t.techWaiting_()},s=function(){return t.cancelTimer_()},a=this.masterPlaylistController_,o=["main","subtitle","audio"],l={};o.forEach(function(e){l[e]={reset:function(){return t.resetSegmentDownloads_(e)},updateend:function(){return t.checkSegmentDownloads_(e)}},a[e+"SegmentLoader_"].on("appendsdone",l[e].updateend),a[e+"SegmentLoader_"].on("playlistupdate",l[e].reset),t.tech_.on(["seeked","seeking"],l[e].reset)});var u=function(e){["main","audio"].forEach(function(i){a[i+"SegmentLoader_"][e]("appended",t.seekingAppendCheck_)})};this.seekingAppendCheck_=function(){t.fixesBadSeeks_()&&(t.consecutiveUpdates=0,t.lastRecordedTime=t.tech_.currentTime(),u("off"))},this.clearSeekingAppendCheck_=function(){return u("off")},this.watchForBadSeeking_=function(){t.clearSeekingAppendCheck_(),u("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(MA,s),this.tech_.on("canplay",n),this.tech_.one("play",i),this.dispose=function(){t.clearSeekingAppendCheck_(),t.logger_("dispose"),t.tech_.off("waiting",r),t.tech_.off(MA,s),t.tech_.off("canplay",n),t.tech_.off("play",i),t.tech_.off("seeking",t.watchForBadSeeking_),t.tech_.off("seeked",t.clearSeekingAppendCheck_),o.forEach(function(e){a[e+"SegmentLoader_"].off("appendsdone",l[e].updateend),a[e+"SegmentLoader_"].off("playlistupdate",l[e].reset),t.tech_.off(["seeked","seeking"],l[e].reset)}),t.checkCurrentTimeTimeout_&&N.clearTimeout(t.checkCurrentTimeTimeout_),t.cancelTimer_()}}var t=e.prototype;return t.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&N.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=N.setTimeout(this.monitorCurrentTime_.bind(this),250)},t.resetSegmentDownloads_=function(e){var t=this.masterPlaylistController_[e+"SegmentLoader_"];this[e+"StalledDownloads_"]>0&&this.logger_("resetting possible stalled download count for "+e+" loader"),this[e+"StalledDownloads_"]=0,this[e+"Buffered_"]=t.buffered_()},t.checkSegmentDownloads_=function(e){var t=this.masterPlaylistController_,i=t[e+"SegmentLoader_"],n=i.buffered_(),r=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(var i=0;i<e.length;i++)if(e.start(i)!==t.start(i)||e.end(i)!==t.end(i))return!0;return!1}(this[e+"Buffered_"],n);this[e+"Buffered_"]=n,r?this.resetSegmentDownloads_(e):(this[e+"StalledDownloads_"]++,this.logger_("found #"+this[e+"StalledDownloads_"]+" "+e+" appends that did not increase buffer (possible stalled download)",{playlistId:i.playlist_&&i.playlist_.id,buffered:DS(n)}),this[e+"StalledDownloads_"]<10||(this.logger_(e+" loader stalled download exclusion"),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:"vhs-"+e+"-download-exclusion"}),"subtitle"!==e&&t.blacklistCurrentPlaylist({message:"Excessive "+e+" segment downloading detected."},1/0)))},t.checkCurrentTime_=function(){if(!this.tech_.paused()&&!this.tech_.seeking()){var e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+MS>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}},t.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},t.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var e,t=this.seekable(),i=this.tech_.currentTime();this.afterSeekableWindow_(t,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(e=t.end(t.length-1));if(this.beforeSeekableWindow_(t,i)){var n=t.start(0);e=n+(n===t.end(0)?0:MS)}if(void 0!==e)return this.logger_("Trying to seek outside of seekable at time "+i+" with seekable range "+LS(t)+". Seeking to "+e+"."),this.tech_.setCurrentTime(e),!0;for(var r=this.masterPlaylistController_.sourceUpdater_,s=this.tech_.buffered(),a=r.audioBuffer?r.audioBuffered():null,o=r.videoBuffer?r.videoBuffered():null,l=this.media(),u=l.partTargetDuration?l.partTargetDuration:2*(l.targetDuration-CS),c=[a,o],h=0;h<c.length;h++){if(c[h])if(RS(c[h],i)<u)return!1}var d=PS(s,i);return 0!==d.length&&(e=d.start(0)+MS,this.logger_("Buffered region starts ("+d.start(0)+")  just beyond seek point ("+i+"). Seeking to "+e+"."),this.tech_.setCurrentTime(e),!0)},t.waiting_=function(){if(!this.techWaiting_()){var e=this.tech_.currentTime(),t=this.tech_.buffered(),i=IS(t,e);return i.length&&e+3<=i.end(0)?(this.cancelTimer_(),this.tech_.setCurrentTime(e),this.logger_("Stopped at "+e+" while inside a buffered region ["+i.start(0)+" -> "+i.end(0)+"]. Attempting to resume playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"}),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}},t.techWaiting_=function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var i=e.end(e.length-1);return this.logger_("Fell out of live window at time "+t+". Seeking to live point (seekable end) "+i),this.cancelTimer_(),this.tech_.setCurrentTime(i),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var n=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.cancelTimer_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;var s=PS(r,t);if(s.length>0){var a=s.start(0)-t;return this.logger_("Stopped at "+t+", setting timer for "+a+", seeking to "+s.start(0)),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*a,t),!0}return!1},t.afterSeekableWindow_=function(e,t,i,n){if(void 0===n&&(n=!1),!e.length)return!1;var r=e.end(e.length-1)+MS;return!i.endList&&n&&(r=e.end(e.length-1)+3*i.targetDuration),t>r},t.beforeSeekableWindow_=function(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)},t.videoUnderflow_=function(e){var t=e.videoBuffered,i=e.audioBuffered,n=e.currentTime;if(t){var r;if(t.length&&i.length){var s=IS(t,n-3),a=IS(t,n),o=IS(i,n);o.length&&!a.length&&s.length&&(r={start:s.end(0),end:o.end(0)})}else{PS(t,n).length||(r=this.gapFromVideoUnderflow_(t,n))}return!!r&&(this.logger_("Encountered a gap in video from "+r.start+" to "+r.end+". Seeking to current time "+n),!0)}},t.skipTheGap_=function(e){var t=this.tech_.buffered(),i=this.tech_.currentTime(),n=PS(t,i);this.cancelTimer_(),0!==n.length&&i===e&&(this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",n.start(0)),this.tech_.setCurrentTime(n.start(0)+CS),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},t.gapFromVideoUnderflow_=function(e,t){for(var i=function(e){if(e.length<2)return TS.createTimeRanges();for(var t=[],i=1;i<e.length;i++){var n=e.end(i-1),r=e.start(i);t.push([n,r])}return TS.createTimeRanges(t)}(e),n=0;n<i.length;n++){var r=i.start(n),s=i.end(n);if(t-r<4&&t-r>2)return{start:r,end:s}}return null},e}(),IA={errorInterval:30,getSource:function(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},PA=function e(t,i){var n=0,r=0,s=TS.mergeOptions(IA,i);t.ready(function(){t.trigger({type:"usage",name:"vhs-error-reload-initialized"}),t.trigger({type:"usage",name:"hls-error-reload-initialized"})});var a=function(){r&&t.currentTime(r)},o=function(e){null!=e&&(r=t.duration()!==1/0&&t.currentTime()||0,t.one("loadedmetadata",a),t.src(e),t.trigger({type:"usage",name:"vhs-error-reload"}),t.trigger({type:"usage",name:"hls-error-reload"}),t.play())},l=function(){return Date.now()-n<1e3*s.errorInterval?(t.trigger({type:"usage",name:"vhs-error-reload-canceled"}),void t.trigger({type:"usage",name:"hls-error-reload-canceled"})):s.getSource&&"function"==typeof s.getSource?(n=Date.now(),s.getSource.call(t,o)):void TS.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")},u=function e(){t.off("loadedmetadata",a),t.off("error",l),t.off("dispose",e)};t.on("error",l),t.on("dispose",u),t.reloadSourceOnError=function(i){u(),e(t,i)}},LA="2.16.3",DA={PlaylistLoader:mw,Playlist:ew,utils:Mw,STANDARD_PLAYLIST_SELECTOR:Cx,INITIAL_PLAYLIST_SELECTOR:function(){var e=this,t=this.playlists.master.playlists.filter(ew.isEnabled);return xx(t,function(e,t){return Ax(e,t)}),t.filter(function(t){return!!bx(e.playlists.master,t).video})[0]||null},lastBandwidthSelector:Cx,movingAverageBandwidthSelector:function(e){var t=-1,i=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){var n=this.useDevicePixelRatio&&N.devicePixelRatio||1;return t<0&&(t=this.systemBandwidth,i=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==i&&(t=e*this.systemBandwidth+(1-e)*t,i=this.systemBandwidth),Ex(this.playlists.master,t,parseInt(wx(this.tech_.el(),"width"),10)*n,parseInt(wx(this.tech_.el(),"height"),10)*n,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)}},comparePlaylistBandwidth:Ax,comparePlaylistResolution:function(e,t){var i,n;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(i=e.attributes.RESOLUTION.width),i=i||N.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(n=t.attributes.RESOLUTION.width),i===(n=n||N.Number.MAX_VALUE)&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:i-n},xhr:_w()};Object.keys(zw).forEach(function(e){Object.defineProperty(DA,e,{get:function(){return TS.log.warn("using Vhs."+e+" is UNSAFE be sure you know what you are doing"),zw[e]},set:function(t){TS.log.warn("using Vhs."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?TS.log.warn("value of Vhs."+e+" must be greater than or equal to 0"):zw[e]=t}})});var OA="videojs-vhs",RA=function(e,t){for(var i=t.media(),n=-1,r=0;r<e.length;r++)if(e[r].id===i.id){n=r;break}e.selectedIndex_=n,e.trigger({selectedIndex:n,type:"change"})};DA.canPlaySource=function(){return TS.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var NA=function(e){var t=e.player,i=e.sourceKeySystems,n=e.audioMedia,r=e.mainPlaylists;if(!t.eme.initializeMediaKeys)return Promise.resolve();var s=function(e,t){return e.reduce(function(e,i){if(!i.contentProtection)return e;var n=t.reduce(function(e,t){var n=i.contentProtection[t];return n&&n.pssh&&(e[t]={pssh:n.pssh}),e},{});return Object.keys(n).length&&e.push(n),e},[])}(n?r.concat([n]):r,Object.keys(i)),a=[],o=[];return s.forEach(function(e){o.push(new Promise(function(e,i){t.tech_.one("keysessioncreated",e)})),a.push(new Promise(function(i,n){t.eme.initializeMediaKeys({keySystems:e},function(e){e?n(e):i()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},FA=function(e){var t=e.player,i=function(e,t,i){if(!e)return e;var n={};t&&t.attributes&&t.attributes.CODECS&&(n=vx(lm(t.attributes.CODECS))),i&&i.attributes&&i.attributes.CODECS&&(n.audio=i.attributes.CODECS);var r=cm(n.video),s=cm(n.audio),a={};for(var o in e)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(a[o].pssh=t.contentProtection[o].pssh),"string"==typeof e[o]&&(a[o].url=e[o]);return TS.mergeOptions(e,a)}(e.sourceKeySystems,e.media,e.audioMedia);return!!i&&(t.currentSource().keySystems=i,!(i&&!t.eme)||(TS.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},UA=function(){if(!N.localStorage)return null;var e=N.localStorage.getItem(OA);if(!e)return null;try{return JSON.parse(e)}catch(t){return null}};DA.supportsNativeHls=function(){if(!z||!z.createElement)return!1;var e=z.createElement("video");if(!TS.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),DA.supportsNativeDash=!!(z&&z.createElement&&TS.getTech("Html5").isSupported())&&/maybe|probably/i.test(z.createElement("video").canPlayType("application/dash+xml")),DA.supportsTypeNatively=function(e){return"hls"===e?DA.supportsNativeHls:"dash"===e&&DA.supportsNativeDash},DA.isSupported=function(){return TS.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var BA=function(e){function t(t,i,n){var r;if(r=e.call(this,i,TS.mergeOptions(n.hls,n.vhs))||this,n.hls&&Object.keys(n.hls).length&&TS.log.warn("Using hls options is deprecated. Please rename `hls` to `vhs` in your options object."),"number"==typeof n.initialBandwidth&&(r.options_.bandwidth=n.initialBandwidth),r.logger_=ES("VhsHandler"),i.options_&&i.options_.playerId){var s=TS(i.options_.playerId);s.hasOwnProperty("hls")||Object.defineProperty(s,"hls",{get:function(){return TS.log.warn("player.hls is deprecated. Use player.tech().vhs instead."),i.trigger({type:"usage",name:"hls-player-access"}),xf(r)},configurable:!0}),s.hasOwnProperty("vhs")||Object.defineProperty(s,"vhs",{get:function(){return TS.log.warn("player.vhs is deprecated. Use player.tech().vhs instead."),i.trigger({type:"usage",name:"vhs-player-access"}),xf(r)},configurable:!0}),s.hasOwnProperty("dash")||Object.defineProperty(s,"dash",{get:function(){return TS.log.warn("player.dash is deprecated. Use player.tech().vhs instead."),xf(r)},configurable:!0}),r.player_=s}if(r.tech_=i,r.source_=t,r.stats={},r.ignoreNextSeekingEvent_=!1,r.setOptions_(),r.options_.overrideNative&&i.overrideNativeAudioTracks&&i.overrideNativeVideoTracks)i.overrideNativeAudioTracks(!0),i.overrideNativeVideoTracks(!0);else if(r.options_.overrideNative&&(i.featuresNativeVideoTracks||i.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return r.on(z,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(e){var t=z.fullscreenElement||z.webkitFullscreenElement||z.mozFullScreenElement||z.msFullscreenElement;t&&t.contains(r.tech_.el())?r.masterPlaylistController_.fastQualityChange_():r.masterPlaylistController_.checkABR_()}),r.on(r.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),r.on(r.tech_,"error",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),r.on(r.tech_,"play",r.play),r}Ef(t,e);var i=t.prototype;return i.setOptions_=function(){var e=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=!1!==this.options_.handleManifestRedirects,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){var t=UA();t&&t.bandwidth&&(this.options_.bandwidth=t.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),t&&t.throughput&&(this.options_.throughput=t.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=zw.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===zw.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","experimentalBufferBasedABR","liveRangeSafeTimeDelta","experimentalLLHLS","useNetworkInformationApi","useDtsForTimestampOffset","experimentalExactManifestTimings","experimentalLeastPixelDiffSelector"].forEach(function(t){void 0!==e.source_[t]&&(e.options_[t]=e.source_[t])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},i.src=function(e,t){var i=this;if(e){var n;this.setOptions_(),this.options_.src=0===(n=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(n.substring(n.indexOf(",")+1)):n,this.options_.tech=this.tech_,this.options_.externVhs=DA,this.options_.sourceType=gm(t),this.options_.seekTo=function(e){i.tech_.setCurrentTime(e)},this.options_.smoothQualityChange&&TS.log.warn("smoothQualityChange is deprecated and will be removed in the next major version"),this.masterPlaylistController_=new EA(this.options_);var r=TS.mergeOptions({liveRangeSafeTimeDelta:MS},this.options_,{seekable:function(){return i.seekable()},media:function(){return i.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_});this.playbackWatcher_=new kA(r),this.masterPlaylistController_.on("error",function(){var e=TS.players[i.tech_.options_.playerId],t=i.masterPlaylistController_.error;"object"!=typeof t||t.code?"string"==typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)});var s=this.options_.experimentalBufferBasedABR?DA.movingAverageBandwidthSelector(.55):DA.STANDARD_PLAYLIST_SELECTOR;this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):s.bind(this),this.masterPlaylistController_.selectInitialPlaylist=DA.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){var e=this.masterPlaylistController_.mainSegmentLoader_.bandwidth,t=N.navigator.connection||N.navigator.mozConnection||N.navigator.webkitConnection,i=1e7;if(this.options_.useNetworkInformationApi&&t){var n=1e3*t.downlink*1e3;e=n>=i&&e>=i?Math.max(e,n):n}return e},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e,t=1/(this.bandwidth||1);return e=this.throughput>0?1/this.throughput:0,Math.floor(1/(t+e))},set:function(){TS.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return i.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return i.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return i.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return i.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return i.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return i.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return i.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return i.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},mediaAppends:{get:function(){return i.masterPlaylistController_.mediaAppends_()||0},enumerable:!0},mainAppendsToLoadedData:{get:function(){return i.masterPlaylistController_.mainAppendsToLoadedData_()||0},enumerable:!0},audioAppendsToLoadedData:{get:function(){return i.masterPlaylistController_.audioAppendsToLoadedData_()||0},enumerable:!0},appendsToLoadedData:{get:function(){return i.masterPlaylistController_.appendsToLoadedData_()||0},enumerable:!0},timeToLoadedData:{get:function(){return i.masterPlaylistController_.timeToLoadedData_()||0},enumerable:!0},buffered:{get:function(){return DS(i.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return i.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return i.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return i.tech_.name_},enumerable:!0},duration:{get:function(){return i.tech_.duration()},enumerable:!0},master:{get:function(){return i.playlists.master},enumerable:!0},playerDimensions:{get:function(){return i.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return DS(i.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return i.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){i.options_.useBandwidthFromLocalStorage&&function(e){if(!N.localStorage)return!1;var t=UA();t=t?TS.mergeOptions(t,e):e;try{N.localStorage.setItem(OA,JSON.stringify(t))}catch(i){return!1}}({bandwidth:i.bandwidth,throughput:Math.round(i.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){var e;(e=i).representations=function(){var t=e.masterPlaylistController_.master(),i=JS(t)?e.masterPlaylistController_.getAudioTrackPlaylists_():t.playlists;return i?i.filter(function(e){return!$S(e)}).map(function(t,i){return new CA(e,t,t.id)}):[]}}),this.masterPlaylistController_.sourceUpdater_.on("createdsourcebuffers",function(){i.setupEme_()}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=N.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}},i.createKeySessions_=function(){var e=this,t=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),NA({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:t&&t.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){e.logger_("created EME key session"),e.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(t){e.logger_("error while creating EME key session",t),e.player_.error({message:"Failed to initialize media keys for EME",code:3})})},i.handleWaitingForKey_=function(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()},i.setupEme_=function(){var e=this,t=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,i=FA({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:t&&t.media()});this.player_.tech_.on("keystatuschange",function(t){if("output-restricted"===t.status){var i=e.masterPlaylistController_.master();if(i&&i.playlists){var n,r=[];if(i.playlists.forEach(function(e){e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height>=720&&(!e.excludeUntil||e.excludeUntil<1/0)&&(e.excludeUntil=1/0,r.push(e))}),r.length)(n=TS.log).warn.apply(n,['DRM keystatus changed to "output-restricted." Removing the following HD playlists that will most likely fail to play and clearing the buffer. This may be due to HDCP restrictions on the stream and the capabilities of the current device.'].concat(r)),e.masterPlaylistController_.fastQualityChange_()}}}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),11!==TS.browser.IE_VERSION&&i?this.createKeySessions_():this.masterPlaylistController_.sourceUpdater_.initializedEme()},i.setupQualityLevels_=function(){var e=this,t=TS.players[this.tech_.options_.playerId];t&&t.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){var t,i;t=e.qualityLevels_,(i=e).representations().forEach(function(e){t.addQualityLevel(e)}),RA(t,i.playlists)}),this.playlists.on("mediachange",function(){RA(e.qualityLevels_,e.playlists)}))},t.version=function(){return{"@videojs/http-streaming":LA,"mux.js":"6.0.1","mpd-parser":"0.22.1","m3u8-parser":"4.8.0","aes-decrypter":"3.1.3"}},i.version=function(){return this.constructor.version()},i.canChangeType=function(){return rA.canChangeType()},i.play=function(){this.masterPlaylistController_.play()},i.setCurrentTime=function(e){this.masterPlaylistController_.setCurrentTime(e)},i.duration=function(){return this.masterPlaylistController_.duration()},i.seekable=function(){return this.masterPlaylistController_.seekable()},i.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&N.URL.revokeObjectURL&&(N.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),e.prototype.dispose.call(this)},i.convertToProgramTime=function(e,t){return kw({playlist:this.masterPlaylistController_.media(),time:e,callback:t})},i.seekToProgramTime=function(e,t,i,n){return void 0===i&&(i=!0),void 0===n&&(n=2),Iw({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:n,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})},t}(TS.getComponent("Component")),jA={name:"videojs-http-streaming",VERSION:LA,canHandleSource:function(e,t){void 0===t&&(t={});var i=TS.mergeOptions(TS.options,t);return jA.canPlayType(e.type,i)},handleSource:function(e,t,i){void 0===i&&(i={});var n=TS.mergeOptions(TS.options,i);return t.vhs=new BA(e,t,n),TS.hasOwnProperty("hls")||Object.defineProperty(t,"hls",{get:function(){return TS.log.warn("player.tech().hls is deprecated. Use player.tech().vhs instead."),t.vhs},configurable:!0}),t.vhs.xhr=_w(),t.vhs.src(e.src,e.type),t.vhs},canPlayType:function(e,t){var i=gm(e);if(!i)return"";var n=jA.getOverrideNative(t);return!DA.supportsTypeNatively(i)||n?"maybe":""},getOverrideNative:function(e){void 0===e&&(e={});var t=e,i=t.vhs,n=void 0===i?{}:i,r=t.hls,s=void 0===r?{}:r,a=!(TS.browser.IS_ANY_SAFARI||TS.browser.IS_IOS),o=n.overrideNative,l=void 0===o?a:o,u=s.overrideNative;return void 0!==u&&u||l}};(hm("avc1.4d400d,mp4a.40.2")&&TS.getTech("Html5").registerSourceHandler(jA,0),TS.VhsHandler=BA,Object.defineProperty(TS,"HlsHandler",{get:function(){return TS.log.warn("videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead."),BA},configurable:!0}),TS.VhsSourceHandler=jA,Object.defineProperty(TS,"HlsSourceHandler",{get:function(){return TS.log.warn("videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead."),jA},configurable:!0}),TS.Vhs=DA,Object.defineProperty(TS,"Hls",{get:function(){return TS.log.warn("videojs.Hls is deprecated. Use videojs.Vhs instead."),DA},configurable:!0}),TS.use||(TS.registerComponent("Hls",DA),TS.registerComponent("Vhs",DA)),TS.options.vhs=TS.options.vhs||{},TS.options.hls=TS.options.hls||{},TS.getPlugin&&TS.getPlugin("reloadSourceOnError"))||(TS.registerPlugin||TS.plugin)("reloadSourceOnError",function(e){PA(this,e)});const zA=Object.freeze(Object.defineProperty({__proto__:null,default:TS},Symbol.toStringTag,{value:"Module"}));var VA;var HA=(VA||(VA=1,bf.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=t(e),n="2.0.0";const s=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},a=function(e,t){for(var i=0,n=e.length;i<n;i++)t[i]=e[i]},o=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e};var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var c,h={exports:{}};c=h,function(e,t){c.exports=t()}(0,function(){var e,t,i,n,r,s,a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(){function e(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(l){r=!0,s=l}finally{try{!n&&o.return&&o.return()}finally{if(r)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=.001,h=1,d=function(e,t){return"data:"+e+","+encodeURIComponent(t)},p=function(e,t,i){return e+(t-e)*i},f=(e=/iPad|iPhone|iPod/.test(navigator.platform),function(){return e}),m=(t=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome"),function(){return t}),g=(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),function(){return i}),y=(n=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android"),function(){return n}),v=function(){var e=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),t=e?parseInt(e[1],10):null;return function(){return t}}(),_=(r=!1,r=f()&&g()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return r}),b=function(){var e=!1;if(65===v()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var i=t[1].split("."),n=u(i,4);n[0],n[1];var r=n[2],s=n[3];e=3325===parseInt(r,10)&&parseInt(s,10)<148}}return function(){return e}}(),T=(s=-1!==navigator.userAgent.indexOf("R7 Build"),function(){return s}),S=function(){var e=90==window.orientation||-90==window.orientation;return T()?!e:e},w=function(e){return!(isNaN(e)||e<=c||e>h)},x=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},A=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},E=function(e){if(m())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0},C=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},M=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},k=function(e,t,i,n){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t),e.compileShader(r);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,i),e.compileShader(s);var a=e.createProgram();for(var o in e.attachShader(a,r),e.attachShader(a,s),n)e.bindAttribLocation(a,n[o],o);return e.linkProgram(a),e.deleteShader(r),e.deleteShader(s),a},I=function(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r="",s=0;s<n;s++)i[r=e.getActiveUniform(t,s).name.replace("[0]","")]=e.getUniformLocation(t,r);return i},P=function(e,t,i,n,r,s,a){var o=1/(t-i),l=1/(n-r),u=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+i)*o,e[13]=(r+n)*l,e[14]=(a+s)*u,e[15]=1,e},L=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},D=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},O=function(e){if(f()){var t=e.style.width,i=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(i)+"px",setTimeout(function(){e.style.width=t,e.style.height=i},100)}window.canvas=e},R=function(){var e=Math.PI/180,t=.25*Math.PI;function i(i,n,r,s){var a=Math.tan(n?n.upDegrees*e:t),o=Math.tan(n?n.downDegrees*e:t),l=Math.tan(n?n.leftDegrees*e:t),u=Math.tan(n?n.rightDegrees*e:t),c=2/(l+u),h=2/(a+o);return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=h,i[6]=0,i[7]=0,i[8]=-(l-u)*c*.5,i[9]=(a-o)*h*.5,i[10]=s/(r-s),i[11]=-1,i[12]=0,i[13]=0,i[14]=s*r/(r-s),i[15]=0,i}function n(e,t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=n+n,l=r+r,u=s+s,c=n*o,h=n*l,d=n*u,p=r*l,f=r*u,m=s*u,g=a*o,y=a*l,v=a*u;return e[0]=1-(p+m),e[1]=h+v,e[2]=d-y,e[3]=0,e[4]=h-v,e[5]=1-(c+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(c+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function r(e,t,i){var n,r,s,a,o,l,u,c,h,d,p,f,m=i[0],g=i[1],y=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n,e[1]=r,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+o*g+h*y+t[12],e[13]=r*m+l*g+d*y+t[13],e[14]=s*m+u*g+p*y+t[14],e[15]=a*m+c*g+f*y+t[15]),e}function s(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=i*o-n*a,_=i*l-r*a,b=i*u-s*a,T=n*l-r*o,S=n*u-s*o,w=r*u-s*l,x=c*m-h*f,A=c*g-d*f,E=c*y-p*f,C=h*g-d*m,M=h*y-p*m,k=d*y-p*g,I=v*k-_*M+b*C+T*E-S*A+w*x;return I?(I=1/I,e[0]=(o*k-l*M+u*C)*I,e[1]=(r*M-n*k-s*C)*I,e[2]=(m*w-g*S+y*T)*I,e[3]=(d*S-h*w-p*T)*I,e[4]=(l*E-a*k-u*A)*I,e[5]=(i*k-r*E+s*A)*I,e[6]=(g*b-f*w-y*_)*I,e[7]=(c*w-d*b+p*_)*I,e[8]=(a*M-o*E+u*x)*I,e[9]=(n*E-i*M-s*x)*I,e[10]=(f*S-m*b+y*v)*I,e[11]=(h*b-c*S-p*v)*I,e[12]=(o*A-a*C-l*x)*I,e[13]=(i*C-n*A+r*x)*I,e[14]=(m*_-f*T-g*v)*I,e[15]=(c*T-h*_+d*v)*I,e):null}var a=new Float32Array([0,0,0,1]),o=new Float32Array([0,0,0]);function l(e,t,l,u,c,h){i(e,u||null,h.depthNear,h.depthFar),n(t,l.orientation||a,l.position||o),c&&r(t,t,c),s(t,t)}return function(e,t,i){return!(!e||!t||(e.pose=t,e.timestamp=t.timestamp,l(e.leftProjectionMatrix,e.leftViewMatrix,t,i._getFieldOfView("left"),i._getEyeOffset("left"),i),l(e.rightProjectionMatrix,e.rightViewMatrix,t,i._getFieldOfView("right"),i._getEyeOffset("right"),i),0))}}(),N=function(){var e=window.self!==window.top,t=F(document.referrer),i=F(window.location.href);return e&&t!==i},F=function(e){var t,i=e.indexOf("://");t=-1!==i?i+3:0;var n=e.indexOf("/",t);return-1===n&&(n=e.length),e.substring(0,n)},U=function(){var e={};return function(t,i){void 0===e[t]&&(e[t]=!0)}}(),B=function(e,t){U(e,e+" has been deprecated. This may not work on native WebVR displays. "+(t?"Please use "+t+" instead.":""))};function j(e,t,i){if(t){for(var n=[],r=null,s=0;s<t.length;++s)switch(a=t[s]){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31){n.push(null,null);break}r||(r=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(l),n.push(e.getParameter(a),null);break;case e.ACTIVE_TEXTURE:r=e.getParameter(e.ACTIVE_TEXTURE),n.push(null);break;default:n.push(e.getParameter(a))}for(i(e),s=0;s<t.length;++s){var a=t[s],o=n[s];switch(a){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,o);break;case e.COLOR_CLEAR_VALUE:e.clearColor(o[0],o[1],o[2],o[3]);break;case e.COLOR_WRITEMASK:e.colorMask(o[0],o[1],o[2],o[3]);break;case e.CURRENT_PROGRAM:e.useProgram(o);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,o);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,o);break;case e.TEXTURE_BINDING_2D:if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_2D,o);break;case e.TEXTURE_BINDING_CUBE_MAP:var l;if((l=t[++s])<e.TEXTURE0||l>e.TEXTURE31)break;e.activeTexture(l),e.bindTexture(e.TEXTURE_CUBE_MAP,o);break;case e.VIEWPORT:e.viewport(o[0],o[1],o[2],o[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:o?e.enable(a):e.disable(a)}r&&e.activeTexture(r)}}else i(e)}var z=j,V=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),H=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function q(e,t,i,n){this.gl=e,this.cardboardUI=t,this.bufferScale=i,this.dirtySubmitFrameBindings=n,this.ctxAttribs=e.getContextAttributes(),this.instanceExt=e.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,f()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=k(e,V,H,this.attribs),this.uniforms=I(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}q.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},q.prototype.onResize=function(){var e=this.gl,t=this,i=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];z(e,i,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE,t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},q.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,i=this.gl;f()||(t.width=x()*this.bufferScale,t.height=A()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(i){e.bufferWidth=i,e.realCanvasWidth.set.call(t,i),e.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(i){e.bufferHeight=i,e.realCanvasHeight.set.call(t,i),e.onResize()}})),this.lastBoundFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,n){e.lastBoundFramebuffer=n||e.framebuffer,e.realBindFramebuffer.call(i,t,e.lastBoundFramebuffer)},this.cullFace=i.getParameter(i.CULL_FACE),this.depthTest=i.getParameter(i.DEPTH_TEST),this.blend=i.getParameter(i.BLEND),this.scissorTest=i.getParameter(i.SCISSOR_TEST),this.stencilTest=i.getParameter(i.STENCIL_TEST),i.enable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!0;break;case i.DEPTH_TEST:e.depthTest=!0;break;case i.BLEND:e.blend=!0;break;case i.SCISSOR_TEST:e.scissorTest=!0;break;case i.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(i,t)},i.disable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!1;break;case i.DEPTH_TEST:e.depthTest=!1;break;case i.BLEND:e.blend=!1;break;case i.SCISSOR_TEST:e.scissorTest=!1;break;case i.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(i,t)},this.colorMask=i.getParameter(i.COLOR_WRITEMASK),i.colorMask=function(t,n,r,s){e.colorMask[0]=t,e.colorMask[1]=n,e.colorMask[2]=r,e.colorMask[3]=s,e.realColorMask.call(i,t,n,r,s)},this.clearColor=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor=function(t,n,r,s){e.clearColor[0]=t,e.clearColor[1]=n,e.clearColor[2]=r,e.clearColor[3]=s,e.realClearColor.call(i,t,n,r,s)},this.viewport=i.getParameter(i.VIEWPORT),i.viewport=function(t,n,r,s){e.viewport[0]=t,e.viewport[1]=n,e.viewport[2]=r,e.viewport[3]=s,e.realViewport.call(i,t,n,r,s)},this.isPatched=!0,O(t)}},q.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;f()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){O(t)},1)}},q.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},q.prototype.submitFrame=function(){var e=this.gl,t=this,i=[];if(this.dirtySubmitFrameBindings||i.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),z(e,i,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null);var i=0,n=0;t.instanceExt&&(i=e.getVertexAttrib(t.attribs.position,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),n=e.getVertexAttrib(t.attribs.texCoord,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||f())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),t.instanceExt&&(0!=i&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,0),0!=n&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,0)),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),!t.ctxAttribs.alpha&&t.ctxAttribs.preserveDrawingBuffer||t.realClearColor.apply(e,t.clearColor),t.instanceExt&&(0!=i&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,i),0!=n&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,n))}),f()){var n=e.canvas;n.width==t.bufferWidth&&n.height==t.bufferHeight||(t.bufferWidth=n.width,t.bufferHeight=n.height,t.onResize())}},q.prototype.updateDeviceInfo=function(e){var t=this.gl,i=this,n=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];z(t,n,function(t){var n=i.computeMeshVertices_(i.meshWidth,i.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),!i.indexCount){var r=i.computeMeshIndices_(i.meshWidth,i.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),i.indexCount=r.length}})},q.prototype.computeMeshVertices_=function(e,t,i){for(var n=new Float32Array(2*e*t*5),r=i.getLeftEyeVisibleTanAngles(),s=i.getLeftEyeNoLensTanAngles(),a=i.getLeftEyeVisibleScreenRect(s),o=0,l=0;l<2;l++){for(var u=0;u<t;u++)for(var c=0;c<e;c++,o++){var h=c/(e-1),d=u/(t-1),f=h,m=d,g=p(r[0],r[2],h),y=p(r[3],r[1],d),v=Math.sqrt(g*g+y*y),_=i.distortion.distortInverse(v),b=y*_/v;h=(g*_/v-s[0])/(s[2]-s[0]),d=(b-s[3])/(s[1]-s[3]),h=2*(a.x+h*a.width-.5),d=2*(a.y+d*a.height-.5),n[5*o+0]=h,n[5*o+1]=d,n[5*o+2]=f,n[5*o+3]=m,n[5*o+4]=l}var T=r[2]-r[0];r[0]=-(T+r[0]),r[2]=T-r[2],T=s[2]-s[0],s[0]=-(T+s[0]),s[2]=T-s[2],a.x=1-(a.x+a.width)}return n},q.prototype.computeMeshIndices_=function(e,t){for(var i=new Uint16Array(2*(e-1)*(t-1)*6),n=e/2,r=t/2,s=0,a=0,o=0;o<2;o++)for(var l=0;l<t;l++)for(var u=0;u<e;u++,s++)0!=u&&0!=l&&(u<=n==l<=r?(i[a++]=s,i[a++]=s-e-1,i[a++]=s-e,i[a++]=s-e-1,i[a++]=s,i[a++]=s-1):(i[a++]=s-1,i[a++]=s-e,i[a++]=s,i[a++]=s-e,i[a++]=s-1,i[a++]=s-e-1));return i},q.prototype.getOwnPropertyDescriptor_=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);return void 0!==i.get&&void 0!==i.set||(i.configurable=!0,i.enumerable=!0,i.get=function(){return this.getAttribute(t)},i.set=function(e){this.setAttribute(t,e)}),i};var G=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),W=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),$=Math.PI/180,X=60,Y=12,Q=20,K=1,Z=.75,J=.3125,ee=4,te=28,ie=1.5;function ne(e){this.gl=e,this.attribs={position:0},this.program=k(e,G,W,this.attribs),this.uniforms=I(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function re(e){this.coefficients=e}ne.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},ne.prototype.listen=function(e,t){var i=this.gl.canvas;this.listener=function(n){var r=i.clientWidth/2,s=te*ie;n.clientX>r-s&&n.clientX<r+s&&n.clientY>i.clientHeight-s?e(n):n.clientX<s&&n.clientY<s&&t(n)},i.addEventListener("click",this.listener,!1)},ne.prototype.onResize=function(){var e=this.gl,t=this,i=[e.ARRAY_BUFFER_BINDING];z(e,i,function(e){var i=[],n=e.drawingBufferWidth/2,r=Math.max(screen.width,screen.height)*window.devicePixelRatio,s=e.drawingBufferWidth/r*window.devicePixelRatio,a=ee*s/2,o=te*ie*s,l=te*s/2,u=(te*ie-te)*s;function c(e,t){var r=(90-e)*$,s=Math.cos(r),a=Math.sin(r);i.push(J*s*l+n,J*a*l+l),i.push(t*s*l+n,t*a*l+l)}i.push(n-a,o),i.push(n-a,e.drawingBufferHeight),i.push(n+a,o),i.push(n+a,e.drawingBufferHeight),t.gearOffset=i.length/2;for(var h=0;h<=6;h++){var d=h*X;c(d,K),c(d+Y,K),c(d+Q,Z),c(d+(X-Q),Z),c(d+(X-Y),K)}function p(t,n){i.push(u+t,e.drawingBufferHeight-u-n)}t.gearVertexCount=i.length/2-t.gearOffset,t.arrowOffset=i.length/2;var f=a/Math.sin(45*$);p(0,l),p(l,0),p(l+f,f),p(f,l+f),p(f,l-f),p(0,l),p(l,2*l),p(l+f,2*l-f),p(f,l-f),p(0,l),p(f,l-a),p(te*s,l-a),p(f,l+a),p(te*s,l+a),t.arrowVertexCount=i.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW)})},ne.prototype.render=function(){var e=this.gl,t=this,i=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];z(e,i,function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()})},ne.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),P(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},re.prototype.distortInverse=function(e){for(var t=0,i=1,n=e-this.distort(t);Math.abs(i-t)>1e-4;){var r=e-this.distort(i),s=i-r*((i-t)/(r-n));t=i,i=s,n=r}return i},re.prototype.distort=function(e){for(var t=e*e,i=0,n=0;n<this.coefficients.length;n++)i=t*(i+this.coefficients[n]);return(i+1)*e};var se=Math.PI/180,ae=180/Math.PI,oe=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};oe.prototype={constructor:oe,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*n-a*i,u=o*i+a*t-r*n,c=o*n+r*i-s*t,h=-r*t-s*i-a*n;return this.x=l*o+h*-r+u*-a-c*-s,this.y=u*o+h*-s+c*-r-l*-a,this.z=c*o+h*-a+l*-s-u*-r,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}};var le=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};function ue(e){this.width=e.width||x(),this.height=e.height||A(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}le.prototype={constructor:le,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,i){var n=Math.cos(e/2),r=Math.cos(t/2),s=Math.cos(i/2),a=Math.sin(e/2),o=Math.sin(t/2),l=Math.sin(i/2);return this.x=a*r*s+n*o*l,this.y=n*o*s-a*r*l,this.z=n*r*l+a*o*s,this.w=n*r*s-a*o*l,this},setFromEulerYXZ:function(e,t,i){var n=Math.cos(e/2),r=Math.cos(t/2),s=Math.cos(i/2),a=Math.sin(e/2),o=Math.sin(t/2),l=Math.sin(i/2);return this.x=a*r*s+n*o*l,this.y=n*o*s-a*r*l,this.z=n*r*l-a*o*s,this.w=n*r*s+a*o*l,this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(i),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,n=e.y,r=e.z,s=e.w,a=t.x,o=t.y,l=t.z,u=t.w;return this.x=i*u+s*a+n*l-r*o,this.y=n*u+s*o+r*a-i*l,this.z=r*u+s*l+i*o-n*a,this.w=s*u-i*a-n*o-r*l,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this.x,n=this.y,r=this.z,s=this.w,a=s*e.w+i*e.x+n*e.y+r*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=s,this.x=i,this.y=n,this.z=r,this;var o=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this.w=.5*(s+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this;var u=Math.sin((1-t)*o)/l,c=Math.sin(t*o)/l;return this.w=s*u+this.w*c,this.x=i*u+this.x*c,this.y=n*u+this.y*c,this.z=r*u+this.z*c,this},setFromUnitVectors:function(){var e,t,i=1e-6;return function(n,r){return void 0===e&&(e=new oe),(t=n.dot(r)+1)<i?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,r),this.x=e.x,this.y=e.y,this.z=e.z,this.w=t,this.normalize(),this}}()};var ce=new ue({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),he=new ue({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),de={CardboardV1:new fe({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new fe({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function pe(e,t){this.viewer=de.CardboardV2,this.updateDeviceParams(e),this.distortion=new re(this.viewer.distortionCoefficients);for(var i=0;i<t.length;i++){var n=t[i];de[n.id]=new fe(n)}}function fe(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}pe.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},pe.prototype.getDevice=function(){return this.device},pe.prototype.setViewer=function(e){this.viewer=e,this.distortion=new re(this.viewer.distortionCoefficients)},pe.prototype.determineDevice_=function(e){if(!e)return f()?he:ce;var t=.0254,i=t/e.xdpi,n=t/e.ydpi;return new ue({widthMeters:i*x(),heightMeters:n*A(),bevelMeters:.001*e.bevelMm})},pe.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=this.distortion,n=e.screenLensDistance,r=(t.widthMeters-e.interLensDistance)/2,s=e.interLensDistance/2,a=e.baselineLensDistance-t.bevelMeters,o=t.heightMeters-a,l=ae*Math.atan(i.distort(r/n)),u=ae*Math.atan(i.distort(s/n)),c=ae*Math.atan(i.distort(a/n)),h=ae*Math.atan(i.distort(o/n));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(u,e.fov),downDegrees:Math.min(c,e.fov),upDegrees:Math.min(h,e.fov)}},pe.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,n=Math.tan(-se*e.fov),r=Math.tan(se*e.fov),s=Math.tan(se*e.fov),a=Math.tan(-se*e.fov),o=t.widthMeters/4,l=t.heightMeters/2,u=e.baselineLensDistance-t.bevelMeters-l,c=e.interLensDistance/2-o,h=-u,d=e.screenLensDistance,p=i.distort((c-o)/d),f=i.distort((h+l)/d),m=i.distort((c+o)/d),g=i.distort((h-l)/d),y=new Float32Array(4);return y[0]=Math.max(n,p),y[1]=Math.min(r,f),y[2]=Math.min(s,m),y[3]=Math.max(a,g),y},pe.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,n=new Float32Array(4),r=i.distortInverse(Math.tan(-se*e.fov)),s=i.distortInverse(Math.tan(se*e.fov)),a=i.distortInverse(Math.tan(se*e.fov)),o=i.distortInverse(Math.tan(-se*e.fov)),l=t.widthMeters/4,u=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-u,h=e.interLensDistance/2-l,d=-c,p=e.screenLensDistance,f=(h-l)/p,m=(d+u)/p,g=(h+l)/p,y=(d-u)/p;return n[0]=Math.max(r,f),n[1]=Math.min(s,m),n[2]=Math.min(a,g),n[3]=Math.max(o,y),n},pe.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,i=this.device,n=t.screenLensDistance,r=(i.widthMeters-t.interLensDistance)/2,s=t.baselineLensDistance-i.bevelMeters,a=(e[0]*n+r)/i.widthMeters,o=(e[1]*n+s)/i.heightMeters,l=(e[2]*n+r)/i.widthMeters,u=(e[3]*n+s)/i.heightMeters;return{x:a,y:u,width:l-a,height:o-u}},pe.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},pe.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},pe.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:ae*Math.atan(e.outerDist),rightDegrees:ae*Math.atan(e.innerDist),downDegrees:ae*Math.atan(e.bottomDist),upDegrees:ae*Math.atan(e.topDist)}},pe.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,i=this.device,n=t.screenLensDistance,r=i.widthMeters/n,s=i.heightMeters/n,a=i.width/r,o=i.height/s,l=Math.round((e.eyePosX-e.outerDist)*a),u=Math.round((e.eyePosY-e.bottomDist)*o);return{x:l,y:u,width:Math.round((e.eyePosX+e.innerDist)*a)-l,height:Math.round((e.eyePosY+e.topDist)*o)-u}},pe.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=this.distortion,n=e.screenLensDistance,r=e.interLensDistance/2/n,s=t.widthMeters/n,a=t.heightMeters/n,o=s/2-r,l=(e.baselineLensDistance-t.bevelMeters)/n,u=e.fov,c=i.distortInverse(Math.tan(se*u)),h=Math.min(o,c),d=Math.min(r,c),p=Math.min(l,c);return{outerDist:h,innerDist:d,topDist:Math.min(a-l,c),bottomDist:p,eyePosX:o,eyePosY:l}},pe.Viewers=de;var me={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function ge(e,t){if(this.dpdb=me,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var i=new XMLHttpRequest,n=this;i.open("GET",e,!0),i.addEventListener("load",function(){n.loading=!1,i.status>=200&&i.status<=299&&(n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_())}),i.send()}}function ye(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function ve(e,t){this.set(e,t)}function _e(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new ve,this.currentGyroMeasurement=new ve,this.previousGyroMeasurement=new ve,f()?this.filterQ=new le(-1,0,0,1):this.filterQ=new le(1,0,0,1),this.previousFilterQ=new le,this.previousFilterQ.copy(this.filterQ),this.accelQ=new le,this.isOrientationInitialized=!1,this.estimatedGravity=new oe,this.measuredGravity=new oe,this.gyroIntegralQ=new le}function be(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new le,this.previousTimestampS=null,this.deltaQ=new le,this.outQ=new le}function Te(e,t,i,n){this.yawOnly=i,this.accelerometer=new oe,this.gyroscope=new oe,this.filter=new _e(e,n),this.posePredictor=new be(t,n),this.isFirefoxAndroid=y(),this.isIOS=f();var r=v();this.isDeviceMotionInRadians=!this.isIOS&&r&&r<66,this.isWithoutDeviceMotion=b()||_(),this.filterToWorldQ=new le,f()?this.filterToWorldQ.setFromAxisAngle(new oe(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new oe(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new le,this.worldToScreenQ=new le,this.originalPoseAdjustQ=new le,this.originalPoseAdjustQ.setFromAxisAngle(new oe(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),S()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new le,this.orientationOut_=new Float32Array(4),this.start()}ge.prototype.getDeviceParams=function(){return this.deviceParams},ge.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e&&(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams))},ge.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return null;if(1!=e.format)return null;if(!e.devices||!e.devices.length)return null;var t=navigator.userAgent||navigator.vendor||window.opera,i=x(),n=A();if(!e.devices)return null;for(var r=0;r<e.devices.length;r++){var s=e.devices[r];if(s.rules&&("ios"==s.type||"android"==s.type)&&f()==("ios"==s.type)){for(var a=!1,o=0;o<s.rules.length;o++){var l=s.rules[o];if(this.ruleMatches_(l,t,i,n)){a=!0;break}}if(a)return new ye({xdpi:s.dpi[0]||s.dpi,ydpi:s.dpi[1]||s.dpi,bevelMm:s.bw})}}return null},ge.prototype.ruleMatches_=function(e,t,i,n){if(!e.ua&&!e.res)return!1;if(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var r=e.res[0],s=e.res[1];if(Math.min(i,n)!=Math.min(r,s)||Math.max(i,n)!=Math.max(r,s))return!1}return!0},ve.prototype.set=function(e,t){this.sample=e,this.timestampS=t},ve.prototype.copy=function(e){this.set(e.sample,e.timestampS)},_e.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},_e.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var i=t-this.previousGyroMeasurement.timestampS;w(i)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},_e.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var i=new le;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new le;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse(),this.isDebug;var r=new le;r.copy(this.filterQ),r.multiply(n),this.filterQ.slerp(r,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},_e.prototype.getOrientation=function(){return this.filterQ},_e.prototype.accelToQuaternion_=function(e){var t=new oe;t.copy(e),t.normalize();var i=new le;return i.setFromUnitVectors(new oe(0,0,-1),t),i.inverse(),i},_e.prototype.gyroToQuaternionDelta_=function(e,t){var i=new le,n=new oe;return n.copy(e),n.normalize(),i.setFromAxisAngle(n,e.length()*t),i},be.prototype.getPrediction=function(e,t,i){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=i,e;var n=new oe;n.copy(t),n.normalize();var r=t.length();if(r<20*se)return this.isDebug,this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var s=r*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,s),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=i,this.outQ},Te.prototype.getPosition=function(){return null},Te.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||(i=(new le).setFromAxisAngle(new oe(0,0,-1),0),n=new le,-90===window.orientation?n.setFromAxisAngle(new oe(0,1,0),Math.PI/-2):n.setFromAxisAngle(new oe(0,1,0),Math.PI/2),i.multiply(n)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((t=new le).setFromAxisAngle(new oe(1,0,0),-Math.PI/2),t),e=this._deviceOrientationQ,(r=new le).copy(e),r.multiply(this.deviceOrientationFilterToWorldQ),r.multiply(this.resetQ),r.multiply(this.worldToScreenQ),r.multiplyQuaternions(this.deviceOrientationFixQ,r),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_;var t,i,n,r,s=this.filter.getOrientation();return e=this.posePredictor.getPrediction(s,this.gyroscope,this.previousTimestampS),(r=new le).copy(this.filterToWorldQ),r.multiply(this.resetQ),r.multiply(e),r.multiply(this.worldToScreenQ),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_},Te.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),S()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Te.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new le;var t=e.alpha,i=e.beta,n=e.gamma;t=(t||0)*Math.PI/180,i=(i||0)*Math.PI/180,n=(n||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(i,t,-n)},Te.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},Te.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,i=e.rotationRate,n=e.timeStamp/1e3,r=n-this.previousTimestampS;return r<0?(U("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=n)):r<=c||r>h?(U("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=n)):(this.accelerometer.set(-t.x,-t.y,-t.z),i&&(T()?this.gyroscope.set(-i.beta,i.alpha,i.gamma):this.gyroscope.set(i.alpha,i.beta,i.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,n)),this.filter.addAccelMeasurement(this.accelerometer,n),void(this.previousTimestampS=n))},Te.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},Te.prototype.onMessage_=function(e){var t=e.data;t&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)},Te.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new oe(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new oe(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Te.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),f()&&N()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Te.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var Se=60,we=new oe(1,0,0),xe=new oe(0,0,1),Ae=new le;Ae.setFromAxisAngle(we,-Math.PI/2),Ae.multiply((new le).setFromAxisAngle(xe,Math.PI/2));var Ee=function(){function e(t){a(this,e),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new le,this._outQ=new le,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return o(e,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:Se,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(t){this.errors.push(t),("SecurityError"===t.name||"ReferenceError"===t.name)&&this.useDeviceMotion()}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Te(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy(Ae),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name||e.error.name,this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),e}(),Ce="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function Me(){this.loadIcon_();var e=document.createElement("div");(s=e.style).position="fixed",s.top=0,s.right=0,s.bottom=0,s.left=0,s.backgroundColor="gray",s.fontFamily="sans-serif",s.zIndex=1e6;var t=document.createElement("img");t.src=this.icon,(s=t.style).marginLeft="25%",s.marginTop="25%",s.width="50%",e.appendChild(t);var i=document.createElement("div");(s=i.style).textAlign="center",s.fontSize="16px",s.lineHeight="24px",s.margin="24px 25%",s.width="50%",i.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(i);var n=document.createElement("div");(s=n.style).backgroundColor="#CFD8DC",s.position="fixed",s.bottom=0,s.width="100%",s.height="48px",s.padding="14px 24px",s.boxSizing="border-box",s.color="#656A6B",e.appendChild(n);var r=document.createElement("div");r.style.float="left",r.innerHTML="No Cardboard viewer?";var s,a=document.createElement("a");a.href="https://www.google.com/get/cardboard/get-cardboard/",a.innerHTML="get one",a.target="_blank",(s=a.style).float="right",s.fontWeight=600,s.textTransform="uppercase",s.borderLeft="1px solid gray",s.paddingLeft="24px",s.textDecoration="none",s.color="#656A6B",n.appendChild(r),n.appendChild(a),this.overlay=e,this.text=i,this.hide()}Me.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img").style;S()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")},Me.prototype.hide=function(){this.overlay.style.display="none"},Me.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},Me.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},Me.prototype.update=function(){this.disableShowTemporarily(),!S()&&L()?this.show():this.hide()},Me.prototype.loadIcon_=function(){this.icon=d("image/svg+xml",Ce)};var ke="CardboardV1",Ie="WEBVR_CARDBOARD_VIEWER",Pe="webvr-polyfill-viewer-selector";function Le(e){try{this.selectedKey=localStorage.getItem(Ie)}catch(t){}this.selectedKey||(this.selectedKey=e||ke),this.dialog=this.createDialog_(pe.Viewers),this.root=null,this.onChangeCallbacks_=[]}function De(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Oe(e,t){return e(t={exports:{}},t.exports),t.exports}Le.prototype.show=function(e){this.root=e,e.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},Le.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Le.prototype.getCurrentViewer=function(){return pe.Viewers[this.selectedKey]},Le.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},Le.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},Le.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},Le.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&pe.Viewers[this.selectedKey]){this.fireOnChange_(pe.Viewers[this.selectedKey]);try{localStorage.setItem(Ie,this.selectedKey)}catch(e){}this.hide()}},Le.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add(Pe),t.style.display="none";var i=document.createElement("div");(s=i.style).position="fixed",s.left=0,s.top=0,s.width="100%",s.height="100%",s.background="rgba(0, 0, 0, 0.3)",i.addEventListener("click",this.hide.bind(this));var n=280,r=document.createElement("div"),s=r.style;for(var a in s.boxSizing="border-box",s.position="fixed",s.top="24px",s.left="50%",s.marginLeft=-n/2+"px",s.width=n+"px",s.padding="24px",s.overflow="hidden",s.background="#fafafa",s.fontFamily="'Roboto', sans-serif",s.boxShadow="0px 5px 20px #666",r.appendChild(this.createH1_("Select your viewer")),e)r.appendChild(this.createChoice_(a,e[a].label));return r.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(i),t.appendChild(r),t},Le.prototype.createH1_=function(e){var t=document.createElement("h1"),i=t.style;return i.color="black",i.fontSize="20px",i.fontWeight="bold",i.marginTop=0,i.marginBottom="24px",t.innerHTML=e,t},Le.prototype.createChoice_=function(e,t){var i=document.createElement("div");i.style.marginTop="8px",i.style.color="black";var n=document.createElement("input");n.style.fontSize="30px",n.setAttribute("id",e),n.setAttribute("type","radio"),n.setAttribute("value",e),n.setAttribute("name","field");var r=document.createElement("label");return r.style.marginLeft="4px",r.setAttribute("for",e),r.innerHTML=t,i.appendChild(n),i.appendChild(r),i},Le.prototype.createButton_=function(e,t){var i=document.createElement("button");i.innerHTML=e;var n=i.style;return n.float="right",n.textTransform="uppercase",n.color="#1094f7",n.fontSize="14px",n.letterSpacing=0,n.border=0,n.background="none",n.marginTop="16px",i.addEventListener("click",t),i},"undefined"!=typeof window?window:void 0!==l||"undefined"!=typeof self&&self;var Re=Oe(function(e,t){!function(t,i){e.exports=i()}(0,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(1),a="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,o=function(){function e(){r(this,e),a?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",s),this.noSleepVideo.addEventListener("timeupdate",function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return n(e,[{key:"enable",value:function(){a?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){a?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=o},function(e,t,i){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),Ne=De(Re),Fe=1e3,Ue=[0,0,.5,1],Be=[.5,0,.5,1],je=window.requestAnimationFrame,ze=window.cancelAnimationFrame;function Ve(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function He(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return B("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function qe(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=Fe++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return B("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new He({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&L()&&(this.wakelock_=new Ne)}qe.prototype.getFrameData=function(e){return R(e,this._getPose(),this)},qe.prototype.getPose=function(){return B("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},qe.prototype.resetPose=function(){return B("VRDisplay.prototype.resetPose"),this._resetPose()},qe.prototype.getImmediatePose=function(){return B("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},qe.prototype.requestAnimationFrame=function(e){return je(e)},qe.prototype.cancelAnimationFrame=function(e){return ze(e)},qe.prototype.wrapForFullscreen=function(e){if(f())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var i=this.fullscreenElement_.parentElement;i.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),i.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var n=this;function r(){if(n.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];n.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}return r(),this.fullscreenWrapper_},qe.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},qe.prototype.requestPresent=function(e){var t=this.isPresenting,i=this;return e instanceof Array||(B("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise(function(n,r){if(i.capabilities.canPresent)if(0==e.length||e.length>i.capabilities.maxLayers)r(new Error("Invalid number of layers."));else{var s=e[0];if(s.source){var a=s.leftBounds||Ue,o=s.rightBounds||Be;if(t){var l=i.layer_;l.source!==s.source&&(l.source=s.source);for(var u=0;u<4;u++)l.leftBounds[u]=a[u],l.rightBounds[u]=o[u];return i.wrapForFullscreen(i.layer_.source),i.updatePresent_(),void n()}if(i.layer_={predistorted:s.predistorted,source:s.source,leftBounds:a.slice(0),rightBounds:o.slice(0)},i.waitingForPresent_=!1,i.layer_&&i.layer_.source){var c=i.wrapForFullscreen(i.layer_.source),h=function(){var e=M();i.isPresenting=c===e,i.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(e){}),i.waitingForPresent_=!1,i.beginPresent_(),n()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),i.removeFullscreenWrapper(),i.disableWakeLock(),i.endPresent_(),i.removeFullscreenListeners_()),i.fireVRDisplayPresentChange_()},d=function(){i.waitingForPresent_&&(i.removeFullscreenWrapper(),i.removeFullscreenListeners_(),i.disableWakeLock(),i.waitingForPresent_=!1,i.isPresenting=!1,r(new Error("Unable to present.")))};i.addFullscreenListeners_(c,h,d),E(c)?(i.enableWakeLock(),i.waitingForPresent_=!0):(f()||m())&&(i.enableWakeLock(),i.isPresenting=!0,i.beginPresent_(),i.fireVRDisplayPresentChange_(),n())}i.waitingForPresent_||f()||(C(),r(new Error("Unable to present.")))}else n()}else r(new Error("VRDisplay is not capable of presenting."))})},qe.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(i,n){e?(!C()&&f()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),m()&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.endPresent_(),t.fireVRDisplayPresentChange_()),i()):n(new Error("Was not presenting to VRDisplay."))})},qe.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},qe.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},qe.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},qe.prototype.addFullscreenListeners_=function(e,t,i){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=i,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),i&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",i,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",i,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",i,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",i,!1))},qe.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var i=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",i,!1),e.removeEventListener("webkitfullscreenerror",i,!1),document.removeEventListener("mozfullscreenerror",i,!1),e.removeEventListener("msfullscreenerror",i,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},qe.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},qe.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},qe.prototype.beginPresent_=function(){},qe.prototype.endPresent_=function(){},qe.prototype.submitFrame=function(e){},qe.prototype.getEyeParameters=function(e){return null};var Ge={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},We={LEFT:"left",RIGHT:"right"};function $e(e){var t=D({},Ge);e=D(t,e||{}),qe.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new He({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new Ee(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new ge(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new pe(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new Le(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Me),f()&&window.addEventListener("resize",this.onResize_.bind(this))}return $e.prototype=Object.create(qe.prototype),$e.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},$e.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},$e.prototype._getFieldOfView=function(e){var t;if(e==We.LEFT)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=We.RIGHT)return null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},$e.prototype._getEyeOffset=function(e){var t;if(e==We.LEFT)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(e!=We.RIGHT)return null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},$e.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),i=this._getFieldOfView(e),n={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(n,"fieldOfView",{enumerable:!0,get:function(){return B("VRFieldOfView","VRFrameData's projection matrices"),i}}),n},$e.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG,this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},$e.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},$e.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=x()*this.bufferScale_,e.canvas.height=A()*this.bufferScale_,this.cardboardUI_=new ne(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new ne(e)),this.distorter_=new q(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}.bind(this),function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}.bind(this)),this.rotateInstructions_&&(S()&&L()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},$e.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},$e.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},$e.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var i=t.canvas;i.width==this.lastWidth&&i.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=i.width,this.lastHeight=i.height,this.cardboardUI_.render()}},$e.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},$e.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var i=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];t.canvas.setAttribute("style",i.join("; ")+";"),O(t.canvas)}},$e.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},$e.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},$e.VRFrameData=Ve,$e.VRDisplay=qe,$e});var d=u(h.exports),p="0.10.12",f={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function m(e){this.config=o(o({},f),e),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&s())&&(this.enable(),this.getVRDisplays().then(function(e){e&&e[0]&&e[0].fireVRDisplayConnect_&&e[0].fireVRDisplayConnect_()}))}function g(e,t,i,n,r,s,a){try{var o=e[s](a),l=o.value}catch(u){return void i(u)}o.done?t(l):Promise.resolve(l).then(n,r)}function y(e){return function(){var t=this,i=arguments;return new Promise(function(n,r){var s=e.apply(t,i);function a(e){g(s,n,r,a,o,"next",e)}function o(e){g(s,n,r,a,o,"throw",e)}a(void 0)})}}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},v.apply(this,arguments)}m.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(s()){var e=new d({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(e)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},m.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var e=this.native.VRFrameData,t=new this.native.VRFrameData,i=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(n){n instanceof e?i.call(this,n):(i.call(this,t),n.pose=t.pose,a(t.leftProjectionMatrix,n.leftProjectionMatrix),a(t.rightProjectionMatrix,n.rightProjectionMatrix),a(t.leftViewMatrix,n.leftViewMatrix),a(t.rightViewMatrix,n.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=d.VRDisplay,window.VRFrameData=d.VRFrameData},m.prototype.getVRDisplays=function(){return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then(e=>e.length>0?e:this.getPolyfillDisplays()):Promise.resolve(this.getPolyfillDisplays())},m.version=p,m.VRFrameData=d.VRFrameData,m.VRDisplay=d.VRDisplay;const _="125",b={LEFT:0,MIDDLE:1,RIGHT:2},T=0,S=1,w=2,x=1,A=2,E=3,C=0,M=1,k=2,I=1,P=0,L=1,D=2,O=3,R=4,N=5,F=100,U=101,B=102,j=103,z=104,V=200,H=201,q=202,G=203,W=204,$=205,X=206,Y=207,Q=208,K=209,Z=210,J=0,ee=1,te=2,ie=3,ne=4,re=5,se=6,ae=7,oe=0,le=1,ue=2,ce=0,he=1,de=2,pe=3,fe=4,me=5,ge=300,ye=301,ve=302,_e=303,be=304,Te=306,Se=307,we=1e3,xe=1001,Ae=1002,Ee=1003,Ce=1004,Me=1005,ke=1006,Ie=1007,Pe=1008,Le=1009,De=1010,Oe=1011,Re=1012,Ne=1013,Fe=1014,Ue=1015,Be=1016,je=1017,ze=1018,Ve=1019,He=1020,qe=1021,Ge=1022,We=1023,$e=1024,Xe=1025,Ye=1026,Qe=1027,Ke=1028,Ze=1029,Je=1030,et=1031,tt=1032,it=1033,nt=33776,rt=33777,st=33778,at=33779,ot=35840,lt=35841,ut=35842,ct=35843,ht=36196,dt=37492,pt=37496,ft=37808,mt=37809,gt=37810,yt=37811,vt=37812,_t=37813,bt=37814,Tt=37815,St=37816,wt=37817,xt=37818,At=37819,Et=37820,Ct=37821,Mt=36492,kt=37840,It=37841,Pt=37842,Lt=37843,Dt=37844,Ot=37845,Rt=37846,Nt=37847,Ft=37848,Ut=37849,Bt=37850,jt=37851,zt=37852,Vt=37853,Ht=2200,qt=2201,Gt=2202,Wt=2300,$t=2301,Xt=2302,Yt=2400,Qt=2401,Kt=2402,Zt=2500,Jt=2501,ei=0,ti=3e3,ii=3001,ni=3007,ri=3002,si=3003,ai=3004,oi=3005,li=3006,ui=3200,ci=3201,hi=0,di=1,pi=7680,fi=519,mi=35044,gi=35048,yi="300 es";function vi(){}v(vi.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}});const _i=[];for(let r=0;r<256;r++)_i[r]=(r<16?"0":"")+r.toString(16);let bi=1234567;const Ti={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_i[255&e]+_i[e>>8&255]+_i[e>>16&255]+_i[e>>24&255]+"-"+_i[255&t]+_i[t>>8&255]+"-"+_i[t>>16&15|64]+_i[t>>24&255]+"-"+_i[63&i|128]+_i[i>>8&255]+"-"+_i[i>>16&255]+_i[i>>24&255]+_i[255&n]+_i[n>>8&255]+_i[n>>16&255]+_i[n>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},damp:function(e,t,i,n){return Ti.lerp(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(Ti.euclideanModulo(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(bi=e%2147483647),bi=16807*bi%2147483647,(bi-1)/2147483646},degToRad:function(e){return e*Ti.DEG2RAD},radToDeg:function(e){return e*Ti.RAD2DEG},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),u=s((t+n)/2),c=a((t+n)/2),h=s((t-n)/2),d=a((t-n)/2),p=s((n-t)/2),f=a((n-t)/2);switch(r){case"XYX":e.set(o*c,l*h,l*d,o*u);break;case"YZY":e.set(l*d,o*c,l*h,o*u);break;case"ZXZ":e.set(l*h,l*d,o*c,o*u);break;case"XZX":e.set(o*c,l*f,l*p,o*u);break;case"YXY":e.set(l*p,o*c,l*f,o*u);break;case"ZYZ":e.set(l*f,l*p,o*c,o*u)}}};class Si{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class wi{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,s,a,o,l){const u=this.elements;return u[0]=e,u[1]=n,u[2]=a,u[3]=t,u[4]=r,u[5]=o,u[6]=i,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],u=i[4],c=i[7],h=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],y=n[1],v=n[4],_=n[7],b=n[2],T=n[5],S=n[8];return r[0]=s*f+a*y+o*b,r[3]=s*m+a*v+o*T,r[6]=s*g+a*_+o*S,r[1]=l*f+u*y+c*b,r[4]=l*m+u*v+c*T,r[7]=l*g+u*_+c*S,r[2]=h*f+d*y+p*b,r[5]=h*m+d*v+p*T,r[8]=h*g+d*_+p*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8];return t*s*u-t*a*l-i*r*u+i*a*o+n*r*l-n*s*o}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=u*s-a*l,h=a*o-u*r,d=l*r-s*o,p=t*c+i*h+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(n*l-u*i)*f,e[2]=(a*i-n*s)*f,e[3]=h*f,e[4]=(u*t-n*o)*f,e[5]=(n*r-a*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-n*l,n*o,-n*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],u=n[7];return n[0]=t*r+i*o,n[3]=t*s+i*l,n[6]=t*a+i*u,n[1]=-i*r+t*o,n[4]=-i*s+t*l,n[7]=-i*a+t*u,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}}let xi;const Ai={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===xi&&(xi=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),xi.width=e.width,xi.height=e.height;const i=xi.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=xi}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let Ei=0;function Ci(e=Ci.DEFAULT_IMAGE,t=Ci.DEFAULT_MAPPING,i=xe,n=xe,r=ke,s=Pe,a=We,o=Le,l=1,u=ti){Object.defineProperty(this,"id",{value:Ei++}),this.uuid=Ti.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Si(0,0),this.repeat=new Si(1,1),this.center=new Si(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}function Mi(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ai.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}Ci.DEFAULT_IMAGE=void 0,Ci.DEFAULT_MAPPING=ge,Ci.prototype=v(Object.create(vi.prototype),{constructor:Ci,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=Ti.generateUUID()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(Mi(n[e].image)):t.push(Mi(n[e]))}else t=Mi(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==ge)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case we:e.x=e.x-Math.floor(e.x);break;case xe:e.x=e.x<0?0:1;break;case Ae:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case we:e.y=e.y-Math.floor(e.y);break;case xe:e.y=e.y<0?0:1;break;case Ae:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Ci.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class ki{constructor(e=0,t=0,i=0,n=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=.01,a=.1,o=e.elements,l=o[0],u=o[4],c=o[8],h=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(u-h)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+h)<a&&Math.abs(c+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,y=(g+1)/2,v=(u+h)/4,_=(c+f)/4,b=(p+m)/4;return e>o&&e>y?e<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=v/i,r=_/i):o>y?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=v/n,r=b/n):y<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(y),i=_/r,n=b/r),this.set(i,n,r,t),this}let y=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(c-f)/y,this.z=(h-u)/y,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}class Ii extends vi{constructor(e,t,i){super(),Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=e,this.height=t,this.scissor=new ki(0,0,e,t),this.scissorTest=!1,this.viewport=new ki(0,0,e,t),i=i||{},this.texture=new Ci(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:ke,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setSize(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Pi{constructor(e=0,t=0,i=0,n=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return i.copy(e).slerp(t,n)}static slerpFlat(e,t,i,n,r,s,a){let o=i[n+0],l=i[n+1],u=i[n+2],c=i[n+3];const h=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(c!==f||o!==h||l!==d||u!==p){let e=1-a;const t=o*h+l*d+u*p+c*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*e+h*r,l=l*e+d*r,u=u*e+p*r,c=c*e+f*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=e,l*=e,u*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],u=i[n+3],c=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=a*p+u*c+o*d-l*h,e[t+1]=o*p+u*h+l*c-a*d,e[t+2]=l*p+u*d+a*h-o*c,e[t+3]=u*p-a*c-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),u=a(n/2),c=a(r/2),h=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],u=t[6],c=t[10],h=i+a+c;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(u-o)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>a&&i>c){const e=2*Math.sqrt(1+i-a-c);this._w=(u-o)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(a>c){const e=2*Math.sqrt(1+a-i-c);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(o+u)/e}else{const e=2*Math.sqrt(1+c-i-a);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(o+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){const i=1e-6;let n=e.dot(t)+1;return n<i?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ti.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?this.multiplyQuaternions(e,t):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,u=t._w;return this._x=i*u+s*a+n*l-r*o,this._y=n*u+s*o+r*a-i*l,this._z=r*u+s*l+i*o-n*a,this._w=s*u-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),u=Math.atan2(l,a),c=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=s*c+this._w*h,this._x=i*c+this._x*h,this._y=n*c+this._y*h,this._z=r*c+this._z*h,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class Li{constructor(e=0,t=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?this.multiplyVectors(e,t):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return!e||e.isEuler,this.applyQuaternion(Oi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Oi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*n-a*i,u=o*i+a*t-r*n,c=o*n+r*i-s*t,h=-r*t-s*i-a*n;return this.x=l*o+h*-r+u*-a-c*-s,this.y=u*o+h*-s+c*-r-l*-a,this.z=c*o+h*-a+l*-s-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?this.crossVectors(e,t):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Di.copy(this).projectOnVector(e),this.sub(Di)}reflect(e){return this.sub(Di.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ti.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Di=new Li,Oi=new Pi;class Ri{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new Li(1/0,1/0,1/0),this.max=void 0!==t?t:new Li(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){const l=e[o],u=e[o+1],c=e[o+2];l<t&&(t=l),u<i&&(i=u),c<n&&(n=c),l>r&&(r=l),u>s&&(s=u),c>a&&(a=c)}return this.min.set(t,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){const l=e.getX(o),u=e.getY(o),c=e.getZ(o);l<t&&(t=l),u<i&&(i=u),c<n&&(n=c),l>r&&(r=l),u>s&&(s=u),c>a&&(a=c)}return this.min.set(t,i,n),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ui.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(e=new Li),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(e=new Li),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Bi.copy(t.boundingBox),Bi.applyMatrix4(e.matrixWorld),this.union(Bi));const i=e.children;for(let n=0,r=i.length;n<r;n++)this.expandByObject(i[n]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(t=new Li),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ui),Ui.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wi),$i.subVectors(this.max,Wi),ji.subVectors(e.a,Wi),zi.subVectors(e.b,Wi),Vi.subVectors(e.c,Wi),Hi.subVectors(zi,ji),qi.subVectors(Vi,zi),Gi.subVectors(ji,Vi);let t=[0,-Hi.z,Hi.y,0,-qi.z,qi.y,0,-Gi.z,Gi.y,Hi.z,0,-Hi.x,qi.z,0,-qi.x,Gi.z,0,-Gi.x,-Hi.y,Hi.x,0,-qi.y,qi.x,0,-Gi.y,Gi.x,0];return!!Ni(t,ji,zi,Vi,$i)&&(t=[1,0,0,0,1,0,0,0,1],!!Ni(t,ji,zi,Vi,$i)&&(Xi.crossVectors(Hi,qi),t=[Xi.x,Xi.y,Xi.z],Ni(t,ji,zi,Vi,$i)))}clampPoint(e,t){return void 0===t&&(t=new Li),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ui.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Ui).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Fi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function Ni(e,t,i,n,r){for(let s=0,a=e.length-3;s<=a;s+=3){Yi.fromArray(e,s);const a=r.x*Math.abs(Yi.x)+r.y*Math.abs(Yi.y)+r.z*Math.abs(Yi.z),o=t.dot(Yi),l=i.dot(Yi),u=n.dot(Yi);if(Math.max(-Math.max(o,l,u),Math.min(o,l,u))>a)return!1}return!0}const Fi=[new Li,new Li,new Li,new Li,new Li,new Li,new Li,new Li],Ui=new Li,Bi=new Ri,ji=new Li,zi=new Li,Vi=new Li,Hi=new Li,qi=new Li,Gi=new Li,Wi=new Li,$i=new Li,Xi=new Li,Yi=new Li,Qi=new Ri;class Ki{constructor(e,t){this.center=void 0!==e?e:new Li,this.radius=void 0!==t?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):Qi.setFromPoints(e).getCenter(i);let n=0;for(let r=0,s=e.length;r<s;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return void 0===t&&(t=new Li),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(e=new Ri),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const Zi=new Li,Ji=new Li,en=new Li,tn=new Li,nn=new Li,rn=new Li,sn=new Li;class an{constructor(e,t){this.origin=void 0!==e?e:new Li,this.direction=void 0!==t?t:new Li(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(t=new Li),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Zi)),this}closestPointToPoint(e,t){void 0===t&&(t=new Li),t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Zi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Zi.copy(this.direction).multiplyScalar(t).add(this.origin),Zi.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){Ji.copy(e).add(t).multiplyScalar(.5),en.copy(t).sub(e).normalize(),tn.copy(this.origin).sub(Ji);const r=.5*e.distanceTo(t),s=-this.direction.dot(en),a=tn.dot(this.direction),o=-tn.dot(en),l=tn.lengthSq(),u=Math.abs(1-s*s);let c,h,d,p;if(u>0)if(c=s*o-a,h=s*a-o,p=r*u,c>=0)if(h>=-p)if(h<=p){const e=1/u;c*=e,h*=e,d=c*(c+s*h+2*a)+h*(s*c+h+2*o)+l}else h=r,c=Math.max(0,-(s*h+a)),d=-c*c+h*(h+2*o)+l;else h=-r,c=Math.max(0,-(s*h+a)),d=-c*c+h*(h+2*o)+l;else h<=-p?(c=Math.max(0,-(-s*r+a)),h=c>0?-r:Math.min(Math.max(-r,-o),r),d=-c*c+h*(h+2*o)+l):h<=p?(c=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(c=Math.max(0,-(s*r+a)),h=c>0?r:Math.min(Math.max(-r,-o),r),d=-c*c+h*(h+2*o)+l);else h=s>0?-r:r,c=Math.max(0,-(s*h+a)),d=-c*c+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(en).multiplyScalar(h).add(Ji),d}intersectSphere(e,t){Zi.subVectors(e.center,this.origin);const i=Zi.dot(this.direction),n=Zi.dot(Zi)-i*i,r=e.radius*e.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,a,o;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),c>=0?(a=(e.min.z-h.z)*c,o=(e.max.z-h.z)*c):(a=(e.max.z-h.z)*c,o=(e.min.z-h.z)*c),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,Zi)}intersectTriangle(e,t,i,n,r){nn.subVectors(t,e),rn.subVectors(i,e),sn.crossVectors(nn,rn);let s,a=this.direction.dot(sn);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}tn.subVectors(this.origin,e);const o=s*this.direction.dot(rn.crossVectors(tn,rn));if(o<0)return null;const l=s*this.direction.dot(nn.cross(tn));if(l<0)return null;if(o+l>a)return null;const u=-s*tn.dot(sn);return u<0?null:this.at(u/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class on{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,s,a,o,l,u,c,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new on).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/ln.setFromMatrixColumn(e,0).length(),r=1/ln.setFromMatrixColumn(e,1).length(),s=1/ln.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){!e||e.isEuler;const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){const e=s*u,i=s*c,n=a*u,r=a*c;t[0]=o*u,t[4]=-o*c,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*u,i=o*c,n=l*u,r=l*c;t[0]=e+r*a,t[4]=n*a-i,t[8]=s*l,t[1]=s*c,t[5]=s*u,t[9]=-a,t[2]=i*a-n,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*u,i=o*c,n=l*u,r=l*c;t[0]=e-r*a,t[4]=-s*c,t[8]=n+i*a,t[1]=i+n*a,t[5]=s*u,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*u,i=s*c,n=a*u,r=a*c;t[0]=o*u,t[4]=n*l-i,t[8]=e*l+r,t[1]=o*c,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,i=s*l,n=a*o,r=a*l;t[0]=o*u,t[4]=r-e*c,t[8]=n*c+i,t[1]=c,t[5]=s*u,t[9]=-a*u,t[2]=-l*u,t[6]=i*c+n,t[10]=e-r*c}else if("XZY"===e.order){const e=s*o,i=s*l,n=a*o,r=a*l;t[0]=o*u,t[4]=-c,t[8]=l*u,t[1]=e*c+r,t[5]=s*u,t[9]=i*c-n,t[2]=n*c-i,t[6]=a*u,t[10]=r*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(cn,e,hn)}lookAt(e,t,i){const n=this.elements;return fn.subVectors(e,t),0===fn.lengthSq()&&(fn.z=1),fn.normalize(),dn.crossVectors(i,fn),0===dn.lengthSq()&&(1===Math.abs(i.z)?fn.x+=1e-4:fn.z+=1e-4,fn.normalize(),dn.crossVectors(i,fn)),dn.normalize(),pn.crossVectors(fn,dn),n[0]=dn.x,n[4]=pn.x,n[8]=fn.x,n[1]=dn.y,n[5]=pn.y,n[9]=fn.y,n[2]=dn.z,n[6]=pn.z,n[10]=fn.z,this}multiply(e,t){return void 0!==t?this.multiplyMatrices(e,t):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],u=i[1],c=i[5],h=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],y=i[3],v=i[7],_=i[11],b=i[15],T=n[0],S=n[4],w=n[8],x=n[12],A=n[1],E=n[5],C=n[9],M=n[13],k=n[2],I=n[6],P=n[10],L=n[14],D=n[3],O=n[7],R=n[11],N=n[15];return r[0]=s*T+a*A+o*k+l*D,r[4]=s*S+a*E+o*I+l*O,r[8]=s*w+a*C+o*P+l*R,r[12]=s*x+a*M+o*L+l*N,r[1]=u*T+c*A+h*k+d*D,r[5]=u*S+c*E+h*I+d*O,r[9]=u*w+c*C+h*P+d*R,r[13]=u*x+c*M+h*L+d*N,r[2]=p*T+f*A+m*k+g*D,r[6]=p*S+f*E+m*I+g*O,r[10]=p*w+f*C+m*P+g*R,r[14]=p*x+f*M+m*L+g*N,r[3]=y*T+v*A+_*k+b*D,r[7]=y*S+v*E+_*I+b*O,r[11]=y*w+v*C+_*P+b*R,r[15]=y*x+v*M+_*L+b*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*o*c-n*l*c-r*a*h+i*l*h+n*a*d-i*o*d)+e[7]*(+t*o*d-t*l*h+r*s*h-n*s*d+n*l*u-r*o*u)+e[11]*(+t*l*c-t*a*d-r*s*c+i*s*d+r*a*u-i*l*u)+e[15]*(-n*a*u-t*o*c+t*a*h+n*s*c-i*s*h+i*o*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],y=c*m*l-f*h*l+f*o*d-a*m*d-c*o*g+a*h*g,v=p*h*l-u*m*l-p*o*d+s*m*d+u*o*g-s*h*g,_=u*f*l-p*c*l+p*a*d-s*f*d-u*a*g+s*c*g,b=p*c*o-u*f*o-p*a*h+s*f*h+u*a*m-s*c*m,T=t*y+i*v+n*_+r*b;if(0===T)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/T;return e[0]=y*S,e[1]=(f*h*r-c*m*r-f*n*d+i*m*d+c*n*g-i*h*g)*S,e[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*g+i*o*g)*S,e[3]=(c*o*r-a*h*r-c*n*l+i*h*l+a*n*d-i*o*d)*S,e[4]=v*S,e[5]=(u*m*r-p*h*r+p*n*d-t*m*d-u*n*g+t*h*g)*S,e[6]=(p*o*r-s*m*r-p*n*l+t*m*l+s*n*g-t*o*g)*S,e[7]=(s*h*r-u*o*r+u*n*l-t*h*l-s*n*d+t*o*d)*S,e[8]=_*S,e[9]=(p*c*r-u*f*r-p*i*d+t*f*d+u*i*g-t*c*g)*S,e[10]=(s*f*r-p*a*r+p*i*l-t*f*l-s*i*g+t*a*g)*S,e[11]=(u*a*r-s*c*r-u*i*l+t*c*l+s*i*d-t*a*d)*S,e[12]=b*S,e[13]=(u*f*n-p*c*n+p*i*h-t*f*h-u*i*m+t*c*m)*S,e[14]=(p*a*n-s*f*n-p*i*o+t*f*o+s*i*m-t*a*m)*S,e[15]=(s*c*n-u*a*n+u*i*o-t*c*o-s*i*h+t*a*h)*S,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,a=e.y,o=e.z,l=r*s,u=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,u*a+i,u*o-n*s,0,l*o-n*a,u*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,u=s+s,c=a+a,h=r*l,d=r*u,p=r*c,f=s*u,m=s*c,g=a*c,y=o*l,v=o*u,_=o*c,b=i.x,T=i.y,S=i.z;return n[0]=(1-(f+g))*b,n[1]=(d+_)*b,n[2]=(p-v)*b,n[3]=0,n[4]=(d-_)*T,n[5]=(1-(h+g))*T,n[6]=(m+y)*T,n[7]=0,n[8]=(p+v)*S,n[9]=(m-y)*S,n[10]=(1-(h+f))*S,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=ln.set(n[0],n[1],n[2]).length();const s=ln.set(n[4],n[5],n[6]).length(),a=ln.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],un.copy(this);const o=1/r,l=1/s,u=1/a;return un.elements[0]*=o,un.elements[1]*=o,un.elements[2]*=o,un.elements[4]*=l,un.elements[5]*=l,un.elements[6]*=l,un.elements[8]*=u,un.elements[9]*=u,un.elements[10]*=u,t.setFromRotationMatrix(un),i.x=r,i.y=s,i.z=a,this}makePerspective(e,t,i,n,r,s){const a=this.elements,o=2*r/(t-e),l=2*r/(i-n),u=(t+e)/(t-e),c=(i+n)/(i-n),h=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,n,r,s){const a=this.elements,o=1/(t-e),l=1/(i-n),u=1/(s-r),c=(t+e)*o,h=(i+n)*l,d=(s+r)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const ln=new Li,un=new on,cn=new Li(0,0,0),hn=new Li(1,1,1),dn=new Li,pn=new Li,fn=new Li;class mn{constructor(e=0,t=0,i=0,n=mn.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const n=Ti.clamp,r=e.elements,s=r[0],a=r[4],o=r[8],l=r[1],u=r[5],c=r[9],h=r[2],d=r[6],p=r[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,p),this._y=0)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return gn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(gn,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return yn.setFromEuler(this),this.setFromQuaternion(yn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Li(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}mn.DefaultOrder="XYZ",mn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const gn=new on,yn=new Pi;class vn{constructor(){this.mask=1}set(e){this.mask=1<<e}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}}let _n=0;const bn=new Li,Tn=new Pi,Sn=new on,wn=new Li,xn=new Li,An=new Li,En=new Pi,Cn=new Li(1,0,0),Mn=new Li(0,1,0),kn=new Li(0,0,1),In={type:"added"},Pn={type:"removed"};function Ln(){Object.defineProperty(this,"id",{value:_n++}),this.uuid=Ti.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ln.DefaultUp.clone();const e=new Li,t=new mn,i=new Pi,n=new Li(1,1,1);function r(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new on},normalMatrix:{value:new wi}}),this.matrix=new on,this.matrixWorld=new on,this.matrixAutoUpdate=Ln.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new vn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Ln.DefaultUp=new Li(0,1,0),Ln.DefaultMatrixAutoUpdate=!0,Ln.prototype=v(Object.create(vi.prototype),{constructor:Ln,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Tn.setFromAxisAngle(e,t),this.quaternion.multiply(Tn),this},rotateOnWorldAxis:function(e,t){return Tn.setFromAxisAngle(e,t),this.quaternion.premultiply(Tn),this},rotateX:function(e){return this.rotateOnAxis(Cn,e)},rotateY:function(e){return this.rotateOnAxis(Mn,e)},rotateZ:function(e){return this.rotateOnAxis(kn,e)},translateOnAxis:function(e,t){return bn.copy(e).applyQuaternion(this.quaternion),this.position.add(bn.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Cn,e)},translateY:function(e){return this.translateOnAxis(Mn,e)},translateZ:function(e){return this.translateOnAxis(kn,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Sn.copy(this.matrixWorld).invert())},lookAt:function(e,t,i){e.isVector3?wn.copy(e):wn.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),xn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sn.lookAt(xn,wn,this.up):Sn.lookAt(wn,xn,this.up),this.quaternion.setFromRotationMatrix(Sn),n&&(Sn.extractRotation(n.matrixWorld),Tn.setFromRotationMatrix(Sn),this.quaternion.premultiply(Tn.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this||e&&e.isObject3D&&(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(In)),this},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Pn)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Pn)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),Sn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Sn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Sn),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(e=new Li),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(e=new Pi),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xn,e,An),e},getWorldScale:function(e){return void 0===e&&(e=new Li),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xn,En,e),e},getWorldDirection:function(e){void 0===e&&(e=new Li),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),u=s(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),u.length>0&&(i.animations=u)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++){const t=e.children[i];this.add(t.clone())}return this}});const Dn=new Li,On=new Li,Rn=new wi;class Nn{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new Li(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Dn.subVectors(i,t).cross(On.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(t=new Li),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(t=new Li);const i=e.delta(Dn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?void 0:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(e=new Li),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Rn.getNormalMatrix(e),n=this.coplanarPoint(Dn).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const Fn=new Li,Un=new Li,Bn=new Li,jn=new Li,zn=new Li,Vn=new Li,Hn=new Li,qn=new Li,Gn=new Li,Wn=new Li;class $n{constructor(e,t,i){this.a=void 0!==e?e:new Li,this.b=void 0!==t?t:new Li,this.c=void 0!==i?i:new Li}static getNormal(e,t,i,n){void 0===n&&(n=new Li),n.subVectors(i,t),Fn.subVectors(e,t),n.cross(Fn);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){Fn.subVectors(n,t),Un.subVectors(i,t),Bn.subVectors(e,t);const s=Fn.dot(Fn),a=Fn.dot(Un),o=Fn.dot(Bn),l=Un.dot(Un),u=Un.dot(Bn),c=s*l-a*a;if(void 0===r&&(r=new Li),0===c)return r.set(-2,-1,-1);const h=1/c,d=(l*o-a*u)*h,p=(s*u-a*o)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,jn),jn.x>=0&&jn.y>=0&&jn.x+jn.y<=1}static getUV(e,t,i,n,r,s,a,o){return this.getBarycoord(e,t,i,n,jn),o.set(0,0),o.addScaledVector(r,jn.x),o.addScaledVector(s,jn.y),o.addScaledVector(a,jn.z),o}static isFrontFacing(e,t,i,n){return Fn.subVectors(i,t),Un.subVectors(e,t),Fn.cross(Un).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fn.subVectors(this.c,this.b),Un.subVectors(this.a,this.b),.5*Fn.cross(Un).length()}getMidpoint(e){return void 0===e&&(e=new Li),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $n.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(e=new Nn),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $n.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return $n.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return $n.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $n.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(t=new Li);const i=this.a,n=this.b,r=this.c;let s,a;zn.subVectors(n,i),Vn.subVectors(r,i),qn.subVectors(e,i);const o=zn.dot(qn),l=Vn.dot(qn);if(o<=0&&l<=0)return t.copy(i);Gn.subVectors(e,n);const u=zn.dot(Gn),c=Vn.dot(Gn);if(u>=0&&c<=u)return t.copy(n);const h=o*c-u*l;if(h<=0&&o>=0&&u<=0)return s=o/(o-u),t.copy(i).addScaledVector(zn,s);Wn.subVectors(e,r);const d=zn.dot(Wn),p=Vn.dot(Wn);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(Vn,a);const m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return Hn.subVectors(r,n),a=(c-u)/(c-u+(d-p)),t.copy(n).addScaledVector(Hn,a);const g=1/(m+f+h);return s=f*g,a=h*g,t.copy(i).addScaledVector(zn,s).addScaledVector(Vn,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Xn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yn={h:0,s:0,l:0},Qn={h:0,s:0,l:0};function Kn(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Zn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Jn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class er{constructor(e,t,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Ti.euclideanModulo(e,1),t=Ti.clamp(t,0,1),i=Ti.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=Kn(r,n,e+1/3),this.g=Kn(r,n,e),this.b=Kn(r,n,e-1/3)}return this}setStyle(e){function t(e){void 0!==e&&parseFloat(e)}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Xn[e];return void 0!==t&&this.setHex(t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Zn(e.r),this.g=Zn(e.g),this.b=Zn(e.b),this}copyLinearToSRGB(e){return this.r=Jn(e.r),this.g=Jn(e.g),this.b=Jn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(e={h:0,s:0,l:0});const t=this.r,i=this.g,n=this.b,r=Math.max(t,i,n),s=Math.min(t,i,n);let a,o;const l=(s+r)/2;if(s===r)a=0,o=0;else{const e=r-s;switch(o=l<=.5?e/(r+s):e/(2-r-s),r){case t:a=(i-n)/e+(i<n?6:0);break;case i:a=(n-t)/e+2;break;case n:a=(t-i)/e+4}a/=6}return e.h=a,e.s=o,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(Yn),Yn.h+=e,Yn.s+=t,Yn.l+=i,this.setHSL(Yn.h,Yn.s,Yn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Yn),e.getHSL(Qn);const i=Ti.lerp(Yn.h,Qn.h,t),n=Ti.lerp(Yn.s,Qn.s,t),r=Ti.lerp(Yn.l,Qn.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}er.NAMES=Xn,er.prototype.r=1,er.prototype.g=1,er.prototype.b=1;class tr{constructor(e,t,i,n,r,s=0){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new Li,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new er,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let ir=0;function nr(){Object.defineProperty(this,"id",{value:ir++}),this.uuid=Ti.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=L,this.side=C,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=W,this.blendDst=$,this.blendEquation=F,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ie,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fi,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=pi,this.stencilZFail=pi,this.stencilZPass=pi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function rr(e){nr.call(this),this.type="MeshBasicMaterial",this.color=new er(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=oe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}nr.prototype=v(Object.create(vi.prototype),{constructor:nr,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i)continue;if("shading"===t){this.flatShading=i===I;continue}const n=this[t];void 0!==n&&(n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i)}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==L&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==C&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(nr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),rr.prototype=Object.create(nr.prototype),rr.prototype.constructor=rr,rr.prototype.isMeshBasicMaterial=!0,rr.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const sr=new Li,ar=new Si;function or(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=mi,this.updateRange={offset:0,count:-1},this.version=0}function lr(e,t,i){or.call(this,new Int8Array(e),t,i)}function ur(e,t,i){or.call(this,new Uint8Array(e),t,i)}function cr(e,t,i){or.call(this,new Uint8ClampedArray(e),t,i)}function hr(e,t,i){or.call(this,new Int16Array(e),t,i)}function dr(e,t,i){or.call(this,new Uint16Array(e),t,i)}function pr(e,t,i){or.call(this,new Int32Array(e),t,i)}function fr(e,t,i){or.call(this,new Uint32Array(e),t,i)}function mr(e,t,i){or.call(this,new Uint16Array(e),t,i)}function gr(e,t,i){or.call(this,new Float32Array(e),t,i)}function yr(e,t,i){or.call(this,new Float64Array(e),t,i)}function vr(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}Object.defineProperty(or.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),v(or.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(r=new er),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this},copyVector2sArray:function(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(r=new Si),t[i++]=r.x,t[i++]=r.y}return this},copyVector3sArray:function(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(r=new Li),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this},copyVector4sArray:function(e){const t=this.array;let i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(r=new ki),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)ar.fromBufferAttribute(this,t),ar.applyMatrix3(e),this.setXY(t,ar.x,ar.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix3(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this},applyMatrix4:function(e){for(let t=0,i=this.count;t<i;t++)sr.x=this.getX(t),sr.y=this.getY(t),sr.z=this.getZ(t),sr.applyMatrix4(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this},applyNormalMatrix:function(e){for(let t=0,i=this.count;t<i;t++)sr.x=this.getX(t),sr.y=this.getY(t),sr.z=this.getZ(t),sr.applyNormalMatrix(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this},transformDirection:function(e){for(let t=0,i=this.count;t<i;t++)sr.x=this.getX(t),sr.y=this.getY(t),sr.z=this.getZ(t),sr.transformDirection(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),lr.prototype=Object.create(or.prototype),lr.prototype.constructor=lr,ur.prototype=Object.create(or.prototype),ur.prototype.constructor=ur,cr.prototype=Object.create(or.prototype),cr.prototype.constructor=cr,hr.prototype=Object.create(or.prototype),hr.prototype.constructor=hr,dr.prototype=Object.create(or.prototype),dr.prototype.constructor=dr,pr.prototype=Object.create(or.prototype),pr.prototype.constructor=pr,fr.prototype=Object.create(or.prototype),fr.prototype.constructor=fr,mr.prototype=Object.create(or.prototype),mr.prototype.constructor=mr,mr.prototype.isFloat16BufferAttribute=!0,gr.prototype=Object.create(or.prototype),gr.prototype.constructor=gr,yr.prototype=Object.create(or.prototype),yr.prototype.constructor=yr;const _r={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function br(e,t){return new _r[e](t)}let Tr=0;const Sr=new on,wr=new Ln,xr=new Li,Ar=new Ri,Er=new Ri,Cr=new Li;function Mr(){Object.defineProperty(this,"id",{value:Tr++}),this.uuid=Ti.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Mr.prototype=v(Object.create(vi.prototype),{constructor:Mr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(vr(e)>65535?fr:dr)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new wi).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Sr.makeRotationX(e),this.applyMatrix4(Sr),this},rotateY:function(e){return Sr.makeRotationY(e),this.applyMatrix4(Sr),this},rotateZ:function(e){return Sr.makeRotationZ(e),this.applyMatrix4(Sr),this},translate:function(e,t,i){return Sr.makeTranslation(e,t,i),this.applyMatrix4(Sr),this},scale:function(e,t,i){return Sr.makeScale(e,t,i),this.applyMatrix4(Sr),this},lookAt:function(e){return wr.lookAt(e),wr.updateMatrix(),this.applyMatrix4(wr.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(xr).negate(),this.translate(xr.x,xr.y,xr.z),this},setFromPoints:function(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new gr(t,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ri);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new Li(-1/0,-1/0,-1/0),new Li(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Ar.setFromBufferAttribute(i),this.morphTargetsRelative?(Cr.addVectors(this.boundingBox.min,Ar.min),this.boundingBox.expandByPoint(Cr),Cr.addVectors(this.boundingBox.max,Ar.max),this.boundingBox.expandByPoint(Cr)):(this.boundingBox.expandByPoint(Ar.min),this.boundingBox.expandByPoint(Ar.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ki);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new Li,1/0);else if(e){const i=this.boundingSphere.center;if(Ar.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const i=t[e];Er.setFromBufferAttribute(i),this.morphTargetsRelative?(Cr.addVectors(Ar.min,Er.min),Ar.expandByPoint(Cr),Cr.addVectors(Ar.max,Er.max),Ar.expandByPoint(Cr)):(Ar.expandByPoint(Er.min),Ar.expandByPoint(Er.max))}Ar.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)Cr.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(Cr));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Cr.fromBufferAttribute(s,t),a&&(xr.fromBufferAttribute(e,t),Cr.add(xr)),n=Math.max(n,i.distanceToSquared(Cr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)}},computeFaceNormals:function(){},computeTangents:function(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return;const i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,a=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new or(new Float32Array(4*a),4));const o=t.tangent.array,l=[],u=[];for(let A=0;A<a;A++)l[A]=new Li,u[A]=new Li;const c=new Li,h=new Li,d=new Li,p=new Si,f=new Si,m=new Si,g=new Li,y=new Li;function v(e,t,i){c.fromArray(n,3*e),h.fromArray(n,3*t),d.fromArray(n,3*i),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*i),h.sub(c),d.sub(c),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),y.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),u[e].add(y),u[t].add(y),u[i].add(y))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let A=0,E=_.length;A<E;++A){const e=_[A],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)v(i[n+0],i[n+1],i[n+2])}const b=new Li,T=new Li,S=new Li,w=new Li;function x(e){S.fromArray(r,3*e),w.copy(S);const t=l[e];b.copy(t),b.sub(S.multiplyScalar(S.dot(t))).normalize(),T.crossVectors(w,t);const i=T.dot(u[e])<0?-1:1;o[4*e]=b.x,o[4*e+1]=b.y,o[4*e+2]=b.z,o[4*e+3]=i}for(let A=0,E=_.length;A<E;++A){const e=_[A],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)x(i[n+0]),x(i[n+1]),x(i[n+2])}},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new or(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new Li,r=new Li,s=new Li,a=new Li,o=new Li,l=new Li,u=new Li,c=new Li;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),u.subVectors(s,r),c.subVectors(n,r),u.cross(c),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(u),o.add(u),l.add(u),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),u.subVectors(s,r),c.subVectors(n,r),u.cross(c),i.setXYZ(e+0,u.x,u.y,u.z),i.setXYZ(e+1,u.x,u.y,u.z),i.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return;void 0===t&&(t=0);const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const r=i[n].array,s=e.attributes[n],a=s.array,o=s.itemSize*t,l=Math.min(a.length,r.length-o);for(let e=0,t=o;e<l;e++,t++)r[t]=a[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Cr.fromBufferAttribute(e,t),Cr.normalize(),e.setXYZ(t,Cr.x,Cr.y,Cr.z)},toNonIndexed:function(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let a=0,o=0;for(let l=0,u=t.length;l<u;l++){a=t[l]*n;for(let e=0;e<n;e++)s[o++]=i[a++]}return new or(s,n,r)}if(null===this.index)return this;const t=new Mr,i=this.index.array,n=this.attributes;for(const a in n){const r=e(n[a],i);t.setAttribute(a,r)}const r=this.morphAttributes;for(const a in r){const n=[],s=r[a];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],i);n.push(r)}t.morphAttributes[a]=n}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,o=s.length;a<o;a++){const e=s[a];t.addGroup(e.start,e.count,e.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const o in i){const t=i[o],n=t.toJSON(e.data);""!==t.name&&(n.name=t.name),e.data.attributes[o]=n}const n={};let r=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],i=[];for(let n=0,r=t.length;n<r;n++){const r=t[n],s=r.toJSON(e.data);""!==r.name&&(s.name=r.name),i.push(s)}i.length>0&&(n[o]=i,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e},clone:function(){return(new Mr).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const l in n){const e=n[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],i=r[l];for(let n=0,r=i.length;n<r;n++)e.push(i[n].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,u=s.length;l<u;l++){const e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const kr=new on,Ir=new an,Pr=new Ki,Lr=new Li,Dr=new Li,Or=new Li,Rr=new Li,Nr=new Li,Fr=new Li,Ur=new Li,Br=new Li,jr=new Li,zr=new Si,Vr=new Si,Hr=new Si,qr=new Li,Gr=new Li;function Wr(e=new Mr,t=new rr){Ln.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function $r(e,t,i,n,r,s,a,o){let l;if(l=t.side===M?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,t.side!==k,o),null===l)return null;Gr.copy(o),Gr.applyMatrix4(e.matrixWorld);const u=i.ray.origin.distanceTo(Gr);return u<i.near||u>i.far?null:{distance:u,point:Gr.clone(),object:e}}function Xr(e,t,i,n,r,s,a,o,l,u,c,h){Lr.fromBufferAttribute(r,u),Dr.fromBufferAttribute(r,c),Or.fromBufferAttribute(r,h);const d=e.morphTargetInfluences;if(t.morphTargets&&s&&d){Ur.set(0,0,0),Br.set(0,0,0),jr.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=d[e],i=s[e];0!==t&&(Rr.fromBufferAttribute(i,u),Nr.fromBufferAttribute(i,c),Fr.fromBufferAttribute(i,h),a?(Ur.addScaledVector(Rr,t),Br.addScaledVector(Nr,t),jr.addScaledVector(Fr,t)):(Ur.addScaledVector(Rr.sub(Lr),t),Br.addScaledVector(Nr.sub(Dr),t),jr.addScaledVector(Fr.sub(Or),t)))}Lr.add(Ur),Dr.add(Br),Or.add(jr)}e.isSkinnedMesh&&(e.boneTransform(u,Lr),e.boneTransform(c,Dr),e.boneTransform(h,Or));const p=$r(e,t,i,n,Lr,Dr,Or,qr);if(p){o&&(zr.fromBufferAttribute(o,u),Vr.fromBufferAttribute(o,c),Hr.fromBufferAttribute(o,h),p.uv=$n.getUV(qr,Lr,Dr,Or,zr,Vr,Hr,new Si)),l&&(zr.fromBufferAttribute(l,u),Vr.fromBufferAttribute(l,c),Hr.fromBufferAttribute(l,h),p.uv2=$n.getUV(qr,Lr,Dr,Or,zr,Vr,Hr,new Si));const e=new tr(u,c,h);$n.getNormal(Lr,Dr,Or,e.normal),p.face=e}return p}Wr.prototype=v(Object.create(Ln.prototype),{constructor:Wr,isMesh:!0,copy:function(e){return Ln.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=v({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length}},raycast:function(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Pr.copy(i.boundingSphere),Pr.applyMatrix4(r),!1===e.ray.intersectsSphere(Pr))return;if(kr.copy(r).invert(),Ir.copy(e.ray).applyMatrix4(kr),null!==i.boundingBox&&!1===Ir.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,u=i.attributes.uv,c=i.attributes.uv2,h=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=h.length;i<p;i++){const p=h[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(p.start+p.count,d.start+d.count);i<n;i+=3){const n=r.getX(i),h=r.getX(i+1),d=r.getX(i+2);s=Xr(this,f,e,Ir,a,o,l,u,c,n,h,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else for(let i=Math.max(0,d.start),p=Math.min(r.count,d.start+d.count);i<p;i+=3){const h=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=Xr(this,n,e,Ir,a,o,l,u,c,h,d,p),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}else if(void 0!==a)if(Array.isArray(n))for(let i=0,p=h.length;i<p;i++){const r=h[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(r.start+r.count,d.start+d.count);i<n;i+=3)s=Xr(this,p,e,Ir,a,o,l,u,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}else for(let i=Math.max(0,d.start),p=Math.min(a.count,d.start+d.count);i<p;i+=3)s=Xr(this,n,e,Ir,a,o,l,u,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}else i.isGeometry}});class Yr extends Mr{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],u=[],c=[];let h=0,d=0;function p(e,t,i,n,r,s,p,f,m,g,y){const v=s/m,_=p/g,b=s/2,T=p/2,S=f/2,w=m+1,x=g+1;let A=0,E=0;const C=new Li;for(let a=0;a<x;a++){const s=a*_-T;for(let o=0;o<w;o++){const h=o*v-b;C[e]=h*n,C[t]=s*r,C[i]=S,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[i]=f>0?1:-1,u.push(C.x,C.y,C.z),c.push(o/m),c.push(1-a/g),A+=1}}for(let a=0;a<g;a++)for(let e=0;e<m;e++){const t=h+e+w*a,i=h+e+w*(a+1),n=h+(e+1)+w*(a+1),r=h+(e+1)+w*a;o.push(t,i,r),o.push(i,n,r),E+=6}a.addGroup(d,E,y),d+=E,h+=A}p("z","y","x",-1,-1,i,t,e,s,r,0),p("z","y","x",1,-1,i,t,-e,s,r,1),p("x","z","y",1,1,e,i,t,n,s,2),p("x","z","y",1,-1,e,i,-t,n,s,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new gr(l,3)),this.setAttribute("normal",new gr(u,3)),this.setAttribute("uv",new gr(c,2))}}function Qr(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Kr(e){const t={};for(let i=0;i<e.length;i++){const n=Qr(e[i]);for(const e in n)t[e]=n[e]}return t}const Zr={clone:Qr,merge:Kr};var Jr="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",es="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ts(e){nr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Jr,this.fragmentShader=es,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(e.attributes,this.setValues(e))}function is(){Ln.call(this),this.type="Camera",this.matrixWorldInverse=new on,this.projectionMatrix=new on,this.projectionMatrixInverse=new on}function ns(e=50,t=1,i=.1,n=2e3){is.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ts.prototype=Object.create(nr.prototype),ts.prototype.constructor=ts,ts.prototype.isShaderMaterial=!0,ts.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qr(e.uniforms),this.defines=v({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=v({},e.extensions),this.glslVersion=e.glslVersion,this},ts.prototype.toJSON=function(e){const t=nr.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},is.prototype=v(Object.create(Ln.prototype),{constructor:is,isCamera:!0,copy:function(e,t){return Ln.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(e=new Li),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Ln.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Ln.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),ns.prototype=v(Object.create(is.prototype),{constructor:ns,isPerspectiveCamera:!0,copy:function(e,t){return is.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:v({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ti.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*Ti.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Ti.RAD2DEG*Math.atan(Math.tan(.5*Ti.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*Ti.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/a,n*=s.width/e,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Ln.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=v({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const rs=90,ss=1;function as(e,t,i){if(Ln.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return;this.renderTarget=i;const n=new ns(rs,ss,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Li(1,0,0)),this.add(n);const r=new ns(rs,ss,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Li(-1,0,0)),this.add(r);const s=new ns(rs,ss,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Li(0,1,0)),this.add(s);const a=new ns(rs,ss,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Li(0,-1,0)),this.add(a);const o=new ns(rs,ss,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Li(0,0,1)),this.add(o);const l=new ns(rs,ss,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Li(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u}}function os(e,t,i,n,r,s,a,o,l,u){e=void 0!==e?e:[],t=void 0!==t?t:ye,a=void 0!==a?a:Ge,Ci.call(this,e,t,i,n,r,s,a,o,l,u),this.flipY=!1,this._needsFlipEnvMap=!0}as.prototype=Object.create(Ln.prototype),as.prototype.constructor=as,os.prototype=Object.create(Ci.prototype),os.prototype.constructor=os,os.prototype.isCubeTexture=!0,Object.defineProperty(os.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});class ls extends Ii{constructor(e,t,i){Number.isInteger(t)&&(t=i),super(e,e,t),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),t=t||{},this.texture=new os(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=We,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Yr(5,5,5),r=new ts({name:"CubemapFromEquirect",uniforms:Qr(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:M,blending:P});r.uniforms.tEquirect.value=t;const s=new Wr(n,r),a=t.minFilter;return t.minFilter===Pe&&(t.minFilter=ke),new as(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(r)}}function us(e,t,i,n,r,s,a,o,l,u,c,h){Ci.call(this,null,s,a,o,l,u,n,r,c,h),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:Ee,this.minFilter=void 0!==u?u:Ee,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}us.prototype=Object.create(Ci.prototype),us.prototype.constructor=us,us.prototype.isDataTexture=!0;const cs=new Ki,hs=new Li;class ds{constructor(e,t,i,n,r,s){this.planes=[void 0!==e?e:new Nn,void 0!==t?t:new Nn,void 0!==i?i:new Nn,void 0!==n?n:new Nn,void 0!==r?r:new Nn,void 0!==s?s:new Nn]}set(e,t,i,n,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],u=i[6],c=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return t[0].setComponents(a-n,c-o,f-h,v-m).normalize(),t[1].setComponents(a+n,c+o,f+h,v+m).normalize(),t[2].setComponents(a+r,c+l,f+d,v+g).normalize(),t[3].setComponents(a-r,c-l,f-d,v-g).normalize(),t[4].setComponents(a-s,c-u,f-p,v-y).normalize(),t[5].setComponents(a+s,c+u,f+p,v+y).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),cs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(cs)}intersectsSprite(e){return cs.center.set(0,0,0),cs.radius=.7071067811865476,cs.applyMatrix4(e.matrixWorld),this.intersectsSphere(cs)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(hs.x=n.normal.x>0?e.max.x:e.min.x,hs.y=n.normal.y>0?e.max.y:e.min.y,hs.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(hs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}}function ps(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function fs(e,t){const i=t.isWebGL2,n=new WeakMap;function r(t,n){const r=t.array,s=t.usage,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,r,s),t.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array||(r instanceof Uint16Array?t.isFloat16BufferAttribute?i&&(o=5131):o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121)),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function s(t,n,r){const s=n.array,a=n.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}function a(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)}function o(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))}function l(e,t){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);void 0===i?n.set(e,r(e,t)):i.version<e.version&&(s(i.buffer,e,t),i.version=e.version)}return{get:a,remove:o,update:l}}class ms extends Mr{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,s=t/2,a=Math.floor(i),o=Math.floor(n),l=a+1,u=o+1,c=e/a,h=t/o,d=[],p=[],f=[],m=[];for(let g=0;g<u;g++){const e=g*h-s;for(let t=0;t<l;t++){const i=t*c-r;p.push(i,-e,0),f.push(0,0,1),m.push(t/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<a;e++){const t=e+l*g,i=e+l*(g+1),n=e+1+l*(g+1),r=e+1+l*g;d.push(t,i,r),d.push(i,n,r)}this.setIndex(d),this.setAttribute("position",new gr(p,3)),this.setAttribute("normal",new gr(f,3)),this.setAttribute("uv",new gr(m,2))}}const gs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ys={common:{diffuse:{value:new er(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new wi},uv2Transform:{value:new wi},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Si(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new er(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new er(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new wi}},sprite:{diffuse:{value:new er(15658734)},opacity:{value:1},center:{value:new Si(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new wi}}},vs={basic:{uniforms:Kr([ys.common,ys.specularmap,ys.envmap,ys.aomap,ys.lightmap,ys.fog]),vertexShader:gs.meshbasic_vert,fragmentShader:gs.meshbasic_frag},lambert:{uniforms:Kr([ys.common,ys.specularmap,ys.envmap,ys.aomap,ys.lightmap,ys.emissivemap,ys.fog,ys.lights,{emissive:{value:new er(0)}}]),vertexShader:gs.meshlambert_vert,fragmentShader:gs.meshlambert_frag},phong:{uniforms:Kr([ys.common,ys.specularmap,ys.envmap,ys.aomap,ys.lightmap,ys.emissivemap,ys.bumpmap,ys.normalmap,ys.displacementmap,ys.fog,ys.lights,{emissive:{value:new er(0)},specular:{value:new er(1118481)},shininess:{value:30}}]),vertexShader:gs.meshphong_vert,fragmentShader:gs.meshphong_frag},standard:{uniforms:Kr([ys.common,ys.envmap,ys.aomap,ys.lightmap,ys.emissivemap,ys.bumpmap,ys.normalmap,ys.displacementmap,ys.roughnessmap,ys.metalnessmap,ys.fog,ys.lights,{emissive:{value:new er(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:gs.meshphysical_vert,fragmentShader:gs.meshphysical_frag},toon:{uniforms:Kr([ys.common,ys.aomap,ys.lightmap,ys.emissivemap,ys.bumpmap,ys.normalmap,ys.displacementmap,ys.gradientmap,ys.fog,ys.lights,{emissive:{value:new er(0)}}]),vertexShader:gs.meshtoon_vert,fragmentShader:gs.meshtoon_frag},matcap:{uniforms:Kr([ys.common,ys.bumpmap,ys.normalmap,ys.displacementmap,ys.fog,{matcap:{value:null}}]),vertexShader:gs.meshmatcap_vert,fragmentShader:gs.meshmatcap_frag},points:{uniforms:Kr([ys.points,ys.fog]),vertexShader:gs.points_vert,fragmentShader:gs.points_frag},dashed:{uniforms:Kr([ys.common,ys.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:gs.linedashed_vert,fragmentShader:gs.linedashed_frag},depth:{uniforms:Kr([ys.common,ys.displacementmap]),vertexShader:gs.depth_vert,fragmentShader:gs.depth_frag},normal:{uniforms:Kr([ys.common,ys.bumpmap,ys.normalmap,ys.displacementmap,{opacity:{value:1}}]),vertexShader:gs.normal_vert,fragmentShader:gs.normal_frag},sprite:{uniforms:Kr([ys.sprite,ys.fog]),vertexShader:gs.sprite_vert,fragmentShader:gs.sprite_frag},background:{uniforms:{uvTransform:{value:new wi},t2D:{value:null}},vertexShader:gs.background_vert,fragmentShader:gs.background_frag},cube:{uniforms:Kr([ys.envmap,{opacity:{value:1}}]),vertexShader:gs.cube_vert,fragmentShader:gs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:gs.equirect_vert,fragmentShader:gs.equirect_frag},distanceRGBA:{uniforms:Kr([ys.common,ys.displacementmap,{referencePosition:{value:new Li},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:gs.distanceRGBA_vert,fragmentShader:gs.distanceRGBA_frag},shadow:{uniforms:Kr([ys.lights,ys.fog,{color:{value:new er(0)},opacity:{value:1}}]),vertexShader:gs.shadow_vert,fragmentShader:gs.shadow_frag}};function _s(e,t,i,n,r){const s=new er(0);let a,o,l=0,u=null,c=0,h=null;function d(i,r,d,f){let m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?p(s,l):m&&m.isColor&&(p(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===Te)?(void 0===o&&(o=new Wr(new Yr(1,1,1),new ts({name:"BackgroundCubeMaterial",uniforms:Qr(vs.cube.uniforms),vertexShader:vs.cube.vertexShader,fragmentShader:vs.cube.fragmentShader,side:M,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o)),m.isWebGLCubeRenderTarget&&(m=m.texture),o.material.uniforms.envMap.value=m,o.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,u===m&&c===m.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null)):m&&m.isTexture&&(void 0===a&&(a=new Wr(new ms(2,2),new ts({name:"BackgroundMaterial",uniforms:Qr(vs.background.uniforms),vertexShader:vs.background.vertexShader,fragmentShader:vs.background.fragmentShader,side:C,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&c===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null))}function p(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),l=t,p(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,p(s,l)},render:d}}function bs(e,t,i,n){const r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=m(null);let u=l;function c(t,n,r,s,o){let l=!1;if(a){const e=f(s,r,n);u!==e&&(u=e,d(u.object)),l=g(s,o),l&&y(s,o)}else{const e=!0===n.wireframe;u.geometry===s.id&&u.program===r.id&&u.wireframe===e||(u.geometry=s.id,u.program=r.id,u.wireframe=e,l=!0)}!0===t.isInstancedMesh&&(l=!0),null!==o&&i.update(o,34963),l&&(w(t,n,r,s),null!==o&&e.bindBuffer(34963,i.get(o).buffer))}function h(){return n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function d(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function p(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function f(e,t,i){const n=!0===i.wireframe;let r=o[e.id];void 0===r&&(r={},o[e.id]=r);let s=r[t.id];void 0===s&&(s={},r[t.id]=s);let a=s[n];return void 0===a&&(a=m(h()),s[n]=a),a}function m(e){const t=[],i=[],n=[];for(let s=0;s<r;s++)t[s]=0,i[s]=0,n[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function g(e,t){const i=u.attributes,n=e.attributes;let r=0;for(const s in n){const e=i[s],t=n[s];if(void 0===e)return!0;if(e.attribute!==t)return!0;if(e.data!==t.data)return!0;r++}return u.attributesNum!==r||u.index!==t}function y(e,t){const i={},n=e.attributes;let r=0;for(const s in n){const e=n[s],t={};t.attribute=e,e.data&&(t.data=e.data),i[s]=t,r++}u.attributes=i,u.attributesNum=r,u.index=t}function v(){const e=u.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function _(e){b(e,0)}function b(i,r){const s=u.newAttributes,a=u.enabledAttributes,o=u.attributeDivisors;s[i]=1,0===a[i]&&(e.enableVertexAttribArray(i),a[i]=1),o[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function T(){const t=u.newAttributes,i=u.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function S(t,i,r,s,a,o){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,s,a,o):e.vertexAttribIPointer(t,i,r,a,o)}function w(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;v();const l=o.attributes,u=a.getAttributes(),c=s.defaultAttributeValues;for(const t in u){const n=u[t];if(n>=0){const s=l[t];if(void 0!==s){const t=s.normalized,r=s.itemSize,a=i.get(s);if(void 0===a)continue;const l=a.buffer,u=a.type,c=a.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,a=i.stride,h=s.offset;i&&i.isInstancedInterleavedBuffer?(b(n,i.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)):_(n),e.bindBuffer(34962,l),S(n,r,u,t,a*c,h*c)}else s.isInstancedBufferAttribute?(b(n,s.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)):_(n),e.bindBuffer(34962,l),S(n,r,u,t,0,0)}else if("instanceMatrix"===t){const t=i.get(r.instanceMatrix);if(void 0===t)continue;const s=t.buffer,a=t.type;b(n+0,1),b(n+1,1),b(n+2,1),b(n+3,1),e.bindBuffer(34962,s),e.vertexAttribPointer(n+0,4,a,!1,64,0),e.vertexAttribPointer(n+1,4,a,!1,64,16),e.vertexAttribPointer(n+2,4,a,!1,64,32),e.vertexAttribPointer(n+3,4,a,!1,64,48)}else if("instanceColor"===t){const t=i.get(r.instanceColor);if(void 0===t)continue;const s=t.buffer,a=t.type;b(n,1),e.bindBuffer(34962,s),e.vertexAttribPointer(n,3,a,!1,12,0)}else if(void 0!==c){const i=c[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:e.vertexAttrib1fv(n,i)}}}}T()}function x(){C();for(const e in o){const t=o[e];for(const e in t){const i=t[e];for(const e in i)p(i[e].object),delete i[e];delete t[e]}delete o[e]}}function A(e){if(void 0===o[e.id])return;const t=o[e.id];for(const i in t){const e=t[i];for(const t in e)p(e[t].object),delete e[t];delete t[i]}delete o[e.id]}function E(e){for(const t in o){const i=o[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)p(n[e].object),delete n[e];delete i[e.id]}}function C(){M(),u!==l&&(u=l,d(u.object))}function M(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:c,reset:C,resetDefaultState:M,dispose:x,releaseStatesOfGeometry:A,releaseStatesOfProgram:E,initAttributes:v,enableAttribute:_,disableUnusedAttributes:T}}function Ts(e,t,i,n){const r=n.isWebGL2;let s;function a(e){s=e}function o(t,n){e.drawArrays(s,t,n),i.update(n,s,1)}function l(n,a,o){if(0===o)return;let l,u;if(r)l=e,u="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===l)return;l[u](s,n,a,o),i.update(a,s,o)}this.setMode=a,this.render=o,this.renderInstances=l}function Ss(e,t,i){let n;function r(){if(void 0!==n)return n;const i=t.get("EXT_texture_filter_anisotropic");return n=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,n}function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const l=s(o);l!==o&&(o=l);const u=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),y=e.getParameter(36349),v=h>0,_=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:r,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:_,floatVertexTextures:v&&_,maxSamples:a?e.getParameter(36183):0}}function ws(e){const t=this;let i=null,n=0,r=!1,s=!1;const a=new Nn,o=new wi,l={value:null,needsUpdate:!1};function u(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function c(e,i,n,r){const s=null!==e?e.length:0;let u=null;if(0!==s){if(u=l.value,!0!==r||null===u){const t=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===u||u.length<t)&&(u=new Float32Array(t));for(let i=0,l=n;i!==s;++i,l+=4)a.copy(e[i]).applyMatrix4(r,o),a.normal.toArray(u,l),u[l+3]=a.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const a=0!==e.length||t||0!==n||r;return r=t,i=c(e,s,0),n=e.length,a},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,u()},this.setState=function(t,a,o){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||s&&!p)s?c(null):u();else{const e=s?0:n,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,a,t,o);for(let n=0;n!==t;++n)r[n]=i[n];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function xs(e){let t=new WeakMap;function i(e,t){return t===_e?e.mapping=ye:t===be&&(e.mapping=ve),e}function n(n){if(n&&n.isTexture){const s=n.mapping;if(s===_e||s===be){if(t.has(n))return i(t.get(n).texture,n.mapping);{const s=n.image;if(s&&s.height>0){const a=e.getRenderList(),o=e.getRenderTarget(),l=new ls(s.height/2);return l.fromEquirectangularTexture(e,n),t.set(n,l),e.setRenderTarget(o),e.setRenderList(a),n.addEventListener("dispose",r),i(l.texture,n.mapping)}return null}}}return n}function r(e){const i=e.target;i.removeEventListener("dispose",r);const n=t.get(i);void 0!==n&&(t.delete(i),n.dispose())}function s(){t=new WeakMap}return{get:n,dispose:s}}function As(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){const t=i(e);return t}}}function Es(e,t,i,n){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const i in o.attributes)t.remove(o.attributes[i]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,i.memory.geometries++),t}function l(e){const i=e.attributes;for(const r in i)t.update(i[r],34962);const n=e.morphAttributes;for(const r in n){const e=n[r];for(let i=0,n=e.length;i<n;i++)t.update(e[i],34962)}}function u(e){const i=[],n=e.index,r=e.attributes.position;let a=0;if(null!==n){const e=n.array;a=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{const e=r.array;a=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}const o=new(vr(i)>65535?fr:dr)(i,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}function c(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&u(e)}else u(e);return s.get(e)}return{get:o,update:l,getWireframeAttribute:c}}function Cs(e,t,i,n){const r=n.isWebGL2;let s,a,o;function l(e){s=e}function u(e){a=e.type,o=e.bytesPerElement}function c(t,n){e.drawElements(s,n,a,t*o),i.update(n,s,1)}function h(n,l,u){if(0===u)return;let c,h;if(r)c=e,h="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return;c[h](s,l,a,n*o,u),i.update(l,s,u)}this.setMode=l,this.setIndex=u,this.render=c,this.renderInstances=h}function Ms(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e}}function n(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:n,update:i}}function ks(e,t){return e[0]-t[0]}function Is(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ps(e){const t={},i=new Float32Array(8),n=[];for(let s=0;s<8;s++)n[s]=[s,0];function r(r,s,a,o){const l=r.morphTargetInfluences,u=void 0===l?0:l.length;let c=t[s.id];if(void 0===c){c=[];for(let e=0;e<u;e++)c[e]=[e,0];t[s.id]=c}for(let e=0;e<u;e++){const t=c[e];t[0]=e,t[1]=l[e]}c.sort(Is);for(let e=0;e<8;e++)e<u&&c[e][1]?(n[e][0]=c[e][0],n[e][1]=c[e][1]):(n[e][0]=Number.MAX_SAFE_INTEGER,n[e][1]=0);n.sort(ks);const h=a.morphTargets&&s.morphAttributes.position,d=a.morphNormals&&s.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=n[e],r=t[0],a=t[1];r!==Number.MAX_SAFE_INTEGER&&a?(h&&s.getAttribute("morphTarget"+e)!==h[r]&&s.setAttribute("morphTarget"+e,h[r]),d&&s.getAttribute("morphNormal"+e)!==d[r]&&s.setAttribute("morphNormal"+e,d[r]),i[e]=a,p+=a):(h&&!0===s.hasAttribute("morphTarget"+e)&&s.deleteAttribute("morphTarget"+e),d&&!0===s.hasAttribute("morphNormal"+e)&&s.deleteAttribute("morphNormal"+e),i[e]=0)}const f=s.morphTargetsRelative?1:1-p;o.getUniforms().setValue(e,"morphTargetBaseInfluence",f),o.getUniforms().setValue(e,"morphTargetInfluences",i)}return{update:r}}function Ls(e,t,i,n){let r=new WeakMap;function s(e){const s=n.render.frame,a=e.geometry,l=t.get(e,a);return r.get(l)!==s&&(t.update(l),r.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l}function a(){r=new WeakMap}function o(e){const t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:s,dispose:a}}function Ds(e=null,t=1,i=1,n=1){Ci.call(this,null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ee,this.minFilter=Ee,this.wrapR=xe,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Os(e=null,t=1,i=1,n=1){Ci.call(this,null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ee,this.minFilter=Ee,this.wrapR=xe,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}vs.physical={uniforms:Kr([vs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Si(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new er(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:gs.meshphysical_vert,fragmentShader:gs.meshphysical_frag},Ds.prototype=Object.create(Ci.prototype),Ds.prototype.constructor=Ds,Ds.prototype.isDataTexture2DArray=!0,Os.prototype=Object.create(Ci.prototype),Os.prototype.constructor=Os,Os.prototype.isDataTexture3D=!0;const Rs=new Ci,Ns=new Ds,Fs=new Os,Us=new os,Bs=[],js=[],zs=new Float32Array(16),Vs=new Float32Array(9),Hs=new Float32Array(4);function qs(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=Bs[r];if(void 0===s&&(s=new Float32Array(r),Bs[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function Gs(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Ws(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function $s(e,t){let i=js[t];void 0===i&&(i=new Int32Array(t),js[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Xs(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Ys(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Gs(i,t))return;e.uniform2fv(this.addr,t),Ws(i,t)}}function Qs(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Gs(i,t))return;e.uniform3fv(this.addr,t),Ws(i,t)}}function Ks(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Gs(i,t))return;e.uniform4fv(this.addr,t),Ws(i,t)}}function Zs(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(Gs(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ws(i,t)}else{if(Gs(i,n))return;Hs.set(n),e.uniformMatrix2fv(this.addr,!1,Hs),Ws(i,n)}}function Js(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(Gs(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ws(i,t)}else{if(Gs(i,n))return;Vs.set(n),e.uniformMatrix3fv(this.addr,!1,Vs),Ws(i,n)}}function ea(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(Gs(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ws(i,t)}else{if(Gs(i,n))return;zs.set(n),e.uniformMatrix4fv(this.addr,!1,zs),Ws(i,n)}}function ta(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(t||Rs,r)}function ia(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||Ns,r)}function na(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||Fs,r)}function ra(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(t||Us,r)}function sa(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function aa(e,t){const i=this.cache;Gs(i,t)||(e.uniform2iv(this.addr,t),Ws(i,t))}function oa(e,t){const i=this.cache;Gs(i,t)||(e.uniform3iv(this.addr,t),Ws(i,t))}function la(e,t){const i=this.cache;Gs(i,t)||(e.uniform4iv(this.addr,t),Ws(i,t))}function ua(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function ca(e){switch(e){case 5126:return Xs;case 35664:return Ys;case 35665:return Qs;case 35666:return Ks;case 35674:return Zs;case 35675:return Js;case 35676:return ea;case 5124:case 35670:return sa;case 35667:case 35671:return aa;case 35668:case 35672:return oa;case 35669:case 35673:return la;case 5125:return ua;case 35678:case 36198:case 36298:case 36306:case 35682:return ta;case 35679:case 36299:case 36307:return na;case 35680:case 36300:case 36308:case 36293:return ra;case 36289:case 36303:case 36311:case 36292:return ia}}function ha(e,t){e.uniform1fv(this.addr,t)}function da(e,t){e.uniform1iv(this.addr,t)}function pa(e,t){e.uniform2iv(this.addr,t)}function fa(e,t){e.uniform3iv(this.addr,t)}function ma(e,t){e.uniform4iv(this.addr,t)}function ga(e,t){const i=qs(t,this.size,2);e.uniform2fv(this.addr,i)}function ya(e,t){const i=qs(t,this.size,3);e.uniform3fv(this.addr,i)}function va(e,t){const i=qs(t,this.size,4);e.uniform4fv(this.addr,i)}function _a(e,t){const i=qs(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function ba(e,t){const i=qs(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Ta(e,t){const i=qs(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Sa(e,t,i){const n=t.length,r=$s(i,n);e.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)i.safeSetTexture2D(t[s]||Rs,r[s])}function wa(e,t,i){const n=t.length,r=$s(i,n);e.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)i.safeSetTextureCube(t[s]||Us,r[s])}function xa(e){switch(e){case 5126:return ha;case 35664:return ga;case 35665:return ya;case 35666:return va;case 35674:return _a;case 35675:return ba;case 35676:return Ta;case 5124:case 35670:return da;case 35667:case 35671:return pa;case 35668:case 35672:return fa;case 35669:case 35673:return ma;case 35678:case 36198:case 36298:case 36306:case 35682:return Sa;case 35680:case 36300:case 36308:case 36293:return wa}}function Aa(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=ca(t.type)}function Ea(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=xa(t.type)}function Ca(e){this.id=e,this.seq=[],this.map={}}Ea.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Ws(t,e)},Ca.prototype.setValue=function(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}};const Ma=/(\w+)(\])?(\[|\.)?/g;function ka(e,t){e.seq.push(t),e.map[t.id]=t}function Ia(e,t,i){const n=e.name,r=n.length;for(Ma.lastIndex=0;;){const s=Ma.exec(n),a=Ma.lastIndex;let o=s[1];const l="]"===s[2],u=s[3];if(l&&(o|=0),void 0===u||"["===u&&a+2===r){ka(i,void 0===u?new Aa(o,e,t):new Ea(o,e,t));break}{let e=i.map[o];void 0===e&&(e=new Ca(o),ka(i,e)),i=e}}}function Pa(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);Ia(i,e.getUniformLocation(t,i.name),this)}}function La(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}Pa.prototype.setValue=function(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)},Pa.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},Pa.upload=function(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}},Pa.seqWithValue=function(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i};let Da=0;function Oa(e){const t=e.split("\n");for(let i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function Ra(e){switch(e){case ti:return["Linear","( value )"];case ii:return["sRGB","( value )"];case ri:return["RGBE","( value )"];case ai:return["RGBM","( value, 7.0 )"];case oi:return["RGBM","( value, 16.0 )"];case li:return["RGBD","( value, 256.0 )"];case ni:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case si:return["LogLuv","( value )"];default:return["Linear","( value )"]}}function Na(e,t,i){const n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return n&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+Oa(e.getShaderSource(t))}function Fa(e,t){const i=Ra(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Ua(e,t){const i=Ra(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Ba(e,t){let i;switch(t){case he:i="Linear";break;case de:i="Reinhard";break;case pe:i="OptimizedCineon";break;case fe:i="ACESFilmic";break;case me:i="Custom";break;default:i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ja(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ha).join("\n")}function za(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}function Va(e,t){const i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r).name;i[n]=e.getAttribLocation(t,n)}return i}function Ha(e){return""!==e}function qa(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ga(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Wa=/^[ \t]*#include +<([\w\d./]+)>/gm;function $a(e){return e.replace(Wa,Xa)}function Xa(e,t){const i=gs[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return $a(i)}const Ya=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Qa=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ka(e){return e.replace(Qa,Ja).replace(Ya,Za)}function Za(e,t,i,n){return Ja(e,t,i,n)}function Ja(e,t,i,n){let r="";for(let s=parseInt(t);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function eo(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function to(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===x?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===A?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===E&&(t="SHADOWMAP_TYPE_VSM"),t}function io(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ye:case ve:t="ENVMAP_TYPE_CUBE";break;case Te:case Se:t="ENVMAP_TYPE_CUBE_UV"}return t}function no(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ve:case Se:t="ENVMAP_MODE_REFRACTION"}return t}function ro(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case oe:t="ENVMAP_BLENDING_MULTIPLY";break;case le:t="ENVMAP_BLENDING_MIX";break;case ue:t="ENVMAP_BLENDING_ADD"}return t}function so(e,t,i,n){const r=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=to(i),u=io(i),c=no(i),h=ro(i),d=e.gammaFactor>0?e.gammaFactor:1,p=i.isWebGL2?"":ja(i),f=za(s),m=r.createProgram();let g,y,v=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=[f].filter(Ha).join("\n"),g.length>0&&(g+="\n"),y=[p,f].filter(Ha).join("\n"),y.length>0&&(y+="\n")):(g=[eo(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ha).join("\n"),y=[p,eo(i),"#define SHADER_NAME "+i.shaderName,f,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ce?"#define TONE_MAPPING":"",i.toneMapping!==ce?gs.tonemapping_pars_fragment:"",i.toneMapping!==ce?Ba("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",gs.encodings_pars_fragment,i.map?Fa("mapTexelToLinear",i.mapEncoding):"",i.matcap?Fa("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?Fa("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?Fa("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?Fa("lightMapTexelToLinear",i.lightMapEncoding):"",Ua("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Ha).join("\n")),a=$a(a),a=qa(a,i),a=Ga(a,i),o=$a(o),o=qa(o,i),o=Ga(o,i),a=Ka(a),o=Ka(o),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(v="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in",i.glslVersion===yi?"":"out highp vec4 pc_fragColor;",i.glslVersion===yi?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const _=v+y+o,b=La(r,35633,v+g+a),T=La(r,35632,_);if(r.attachShader(m,b),r.attachShader(m,T),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(m).trim(),t=r.getShaderInfoLog(b).trim(),i=r.getShaderInfoLog(T).trim();let n=!0,s=!0;!1===r.getProgramParameter(m,35714)?(n=!1,Na(r,b,"vertex"),Na(r,T,"fragment")):""!==e||""!==t&&""!==i||(s=!1),s&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:i,prefix:y}})}let S,w;return r.deleteShader(b),r.deleteShader(T),this.getUniforms=function(){return void 0===S&&(S=new Pa(r,m)),S},this.getAttributes=function(){return void 0===w&&(w=Va(r,m)),w},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=Da++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=T,this}function ao(e,t,i,n,r,s){const a=[],o=n.isWebGL2,l=n.logarithmicDepthBuffer,u=n.floatVertexTextures,c=n.maxVertexUniforms,h=n.vertexTextures;let d=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){const t=e.skeleton.bones;if(u)return 1024;{const e=c,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?0:n}}function g(e){let t;return t=e&&e.isTexture?e.encoding:e&&e.isWebGLRenderTarget?e.texture.encoding:ti,t}function y(r,a,c,f,y){const v=f.fog,_=r.isMeshStandardMaterial?f.environment:null,b=t.get(r.envMap||_),T=p[r.type],S=y.isSkinnedMesh?m(y):0;let w,x;if(null!==r.precision&&(d=n.getMaxPrecision(r.precision),r.precision),T){const e=vs[T];w=e.vertexShader,x=e.fragmentShader}else w=r.vertexShader,x=r.fragmentShader;const A=e.getRenderTarget();return{isWebGL2:o,shaderID:T,shaderName:r.type,vertexShader:w,fragmentShader:x,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:h,outputEncoding:null!==A?g(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:g(r.map),matcap:!!r.matcap,matcapEncoding:g(r.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:g(b),envMapCubeUV:!!b&&(b.mapping===Te||b.mapping===Se),lightMap:!!r.lightMap,lightMapEncoding:g(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:g(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===di,tangentSpaceNormalMap:r.normalMapType===hi,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!v,useFog:r.fog,fogExp2:v&&v.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:r.skinning&&S>0,maxBones:S,useVertexTexture:u,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:ce,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===k,flipSided:r.side===M,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}}function v(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)i.push(t[f[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()}function _(e){const t=p[e.type];let i;if(t){const e=vs[t];i=Zr.clone(e.uniforms)}else i=e.uniforms;return i}function b(t,i){let n;for(let e=0,r=a.length;e<r;e++){const t=a[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new so(e,i,t,r),a.push(n)),n}function T(e){if(0===--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}}return{getParameters:y,getProgramCacheKey:v,getUniforms:_,acquireProgram:b,releaseProgram:T,programs:a}}function oo(){let e=new WeakMap;function t(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i}function i(t){e.delete(t)}function n(t,i,n){e.get(t)[i]=n}function r(){e=new WeakMap}return{get:t,remove:i,update:n,dispose:r}}function lo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function uo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function co(e){const t=[];let i=0;const n=[],r=[],s={id:-1};function a(){i=0,n.length=0,r.length=0}function o(n,r,a,o,l,u){let c=t[i];const h=e.get(a);return void 0===c?(c={id:n.id,object:n,geometry:r,material:a,program:h.program||s,groupOrder:o,renderOrder:n.renderOrder,z:l,group:u},t[i]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=a,c.program=h.program||s,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=l,c.group=u),i++,c}function l(e,t,i,s,a,l){const u=o(e,t,i,s,a,l);(!0===i.transparent?r:n).push(u)}function u(e,t,i,s,a,l){const u=o(e,t,i,s,a,l);(!0===i.transparent?r:n).unshift(u)}function c(e,t){n.length>1&&n.sort(e||lo),r.length>1&&r.sort(t||uo)}function h(){for(let e=i,n=t.length;e<n;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}}return{opaque:n,transparent:r,init:a,push:l,unshift:u,finish:h,sort:c}}function ho(e){let t=new WeakMap;function i(i,n){const r=t.get(i);let s;return void 0===r?(s=new co(e),t.set(i,new WeakMap),t.get(i).set(n,s)):(s=r.get(n),void 0===s&&(s=new co(e),r.set(n,s))),s}function n(){t=new WeakMap}return{get:i,dispose:n}}function po(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Li,color:new er};break;case"SpotLight":i={position:new Li,direction:new Li,color:new er,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Li,color:new er,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Li,skyColor:new er,groundColor:new er};break;case"RectAreaLight":i={color:new er,position:new Li,halfWidth:new Li,halfHeight:new Li}}return e[t.id]=i,i}}}function fo(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Si};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Si,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}let mo=0;function go(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function yo(e,t){const i=new po,n=fo(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let c=0;c<9;c++)r.probe.push(new Li);const s=new Li,a=new on,o=new on;function l(s){let a=0,o=0,l=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0;s.sort(go);for(let e=0,t=s.length;e<t;e++){const t=s[e],y=t.color,v=t.intensity,_=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=y.r*v,o+=y.g*v,l+=y.b*v;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],v);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[u]=i,r.directionalShadowMap[u]=b,r.directionalShadowMatrix[u]=t.shadow.matrix,f++}r.directional[u]=e,u++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(y).multiplyScalar(v),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.spotShadow[h]=i,r.spotShadowMap[h]=b,r.spotShadowMatrix[h]=t.shadow.matrix,g++}r.spot[h]=e,h++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(y).multiplyScalar(v),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[d]=e,d++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[c]=i,r.pointShadowMap[c]=b,r.pointShadowMatrix[c]=t.shadow.matrix,m++}r.point[c]=e,c++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(v),e.groundColor.copy(t.groundColor).multiplyScalar(v),r.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ys.LTC_FLOAT_1,r.rectAreaLTC2=ys.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")&&(r.rectAreaLTC1=ys.LTC_HALF_1,r.rectAreaLTC2=ys.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=l;const y=r.hash;y.directionalLength===u&&y.pointLength===c&&y.spotLength===h&&y.rectAreaLength===d&&y.hemiLength===p&&y.numDirectionalShadows===f&&y.numPointShadows===m&&y.numSpotShadows===g||(r.directional.length=u,r.spot.length=h,r.rectArea.length=d,r.point.length=c,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,y.directionalLength=u,y.pointLength=c,y.spotLength=h,y.rectAreaLength=d,y.hemiLength=p,y.numDirectionalShadows=f,y.numPointShadows=m,y.numSpotShadows=g,r.version=mo++)}function u(e,t){let i=0,n=0,l=0,u=0,c=0;const h=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){const t=e[d];if(t.isDirectionalLight){const e=r.directional[i];e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),i++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=r.rectArea[u];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),o.identity(),a.copy(t.matrixWorld),a.premultiply(h),o.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),u++}else if(t.isPointLight){const e=r.point[n];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),n++}else if(t.isHemisphereLight){const e=r.hemi[c];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),c++}}}return{setup:l,setupView:u,state:r}}function vo(e,t){const i=new yo(e,t),n=[],r=[];function s(){n.length=0,r.length=0}function a(e){n.push(e)}function o(e){r.push(e)}function l(){i.setup(n)}function u(e){i.setupView(n,e)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:l,setupLightsView:u,pushLight:a,pushShadow:o}}function _o(e,t){let i=new WeakMap;function n(n,r=0){let s;return!1===i.has(n)?(s=new vo(e,t),i.set(n,[]),i.get(n).push(s)):r>=i.get(n).length?(s=new vo(e,t),i.get(n).push(s)):s=i.get(n)[r],s}function r(){i=new WeakMap}return{get:n,dispose:r}}function bo(e){nr.call(this),this.type="MeshDepthMaterial",this.depthPacking=ui,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function To(e){nr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Li,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}bo.prototype=Object.create(nr.prototype),bo.prototype.constructor=bo,bo.prototype.isMeshDepthMaterial=!0,bo.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},To.prototype=Object.create(nr.prototype),To.prototype.constructor=To,To.prototype.isMeshDistanceMaterial=!0,To.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var So="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",wo="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function xo(e,t,i){let n=new ds;const r=new Si,s=new Si,a=new ki,o=[],l=[],u={},c={0:M,1:C,2:k},h=new ts({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Si},radius:{value:4}},vertexShader:wo,fragmentShader:So}),d=h.clone();d.defines.HORIZONTAL_PASS=1;const p=new Mr;p.setAttribute("position",new or(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new Wr(p,h),m=this;function g(i,n){const r=t.update(f);h.uniforms.shadow_pass.value=i.map.texture,h.uniforms.resolution.value=i.mapSize,h.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,r,h,f,null),d.uniforms.shadow_pass.value=i.mapPass.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,r,d,f,null)}function y(e,t,i){const n=e|t<<1|i<<2;let r=o[n];return void 0===r&&(r=new bo({depthPacking:ci,morphTargets:e,skinning:t}),o[n]=r),r}function v(e,t,i){const n=e|t<<1|i<<2;let r=l[n];return void 0===r&&(r=new To({morphTargets:e,skinning:t}),l[n]=r),r}function _(t,i,n,r,s,a,o){let l=null,h=y,d=t.customDepthMaterial;if(!0===r.isPointLight&&(h=v,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===n.morphTargets&&(e=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let r=!1;!0===t.isSkinnedMesh&&!0===n.skinning&&(r=!0),l=h(e,r,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const e=l.uuid,t=n.uuid;let i=u[e];void 0===i&&(i={},u[e]=i);let r=i[t];void 0===r&&(r=l.clone(),i[t]=r),l=r}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=o===E?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=s,l.farDistance=a),l}function b(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===E)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=t.update(i),r=i.material;if(Array.isArray(r)){const t=n.groups;for(let l=0,u=t.length;l<u;l++){const u=t[l],c=r[u.materialIndex];if(c&&c.visible){const t=_(i,n,c,a,s.near,s.far,o);e.renderBufferDirect(s,null,n,t,i,u)}}}else if(r.visible){const t=_(i,n,r,a,s.near,s.far,o);e.renderBufferDirect(s,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)b(l[e],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=x,this.render=function(t,o,l){if(!1===m.enabled)return;if(!1===m.autoUpdate&&!1===m.needsUpdate)return;if(0===t.length)return;const u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(P),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let p=0,f=t.length;p<f;p++){const u=t[p],c=u.shadow;if(void 0===c)continue;if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),s.copy(c.mapSize),(r.x>i||r.y>i)&&(r.x>i&&(s.x=Math.floor(i/h.x),r.x=s.x*h.x,c.mapSize.x=s.x),r.y>i&&(s.y=Math.floor(i/h.y),r.y=s.y*h.y,c.mapSize.y=s.y)),null===c.map&&!c.isPointLightShadow&&this.type===E){const e={minFilter:ke,magFilter:ke,format:We};c.map=new Ii(r.x,r.y,e),c.map.texture.name=u.name+".shadowMap",c.mapPass=new Ii(r.x,r.y,e),c.camera.updateProjectionMatrix()}if(null===c.map){const e={minFilter:Ee,magFilter:Ee,format:We};c.map=new Ii(r.x,r.y,e),c.map.texture.name=u.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const f=c.getViewportCount();for(let e=0;e<f;e++){const t=c.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),d.viewport(a),c.updateMatrices(u,e),n=c.getFrustum(),b(o,l,c.camera,u,this.type)}c.isPointLightShadow||this.type!==E||g(c,l),c.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(u,c,h)}}function Ao(e,t,i){const n=i.isWebGL2;function r(){let t=!1;const i=new ki;let n=null;const r=new ki(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,a,o){!0===o&&(t*=a,n*=a,s*=a),i.set(t,n,s,a),!1===r.equals(i)&&(e.clearColor(t,n,s,a),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}}function s(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?ye(2929):ve(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case J:e.depthFunc(512);break;case ee:e.depthFunc(519);break;case te:e.depthFunc(513);break;case ie:e.depthFunc(515);break;case ne:e.depthFunc(514);break;case re:e.depthFunc(518);break;case se:e.depthFunc(516);break;case ae:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}}function a(){let t=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,u=null;return{setTest:function(e){t||(e?ye(2960):ve(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,a){n===t&&r===i&&s===a||(e.stencilFunc(t,i,a),n=t,r=i,s=a)},setOp:function(t,i,n){a===t&&o===i&&l===n||(e.stencilOp(t,i,n),a=t,o=i,l=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,u=null}}}const o=new r,l=new s,u=new a;let c={},h=null,d=null,p=null,f=null,m=null,g=null,y=null,v=null,_=null,b=!1,x=null,A=null,E=null,C=null,I=null;const oe=e.getParameter(35661);let le=!1,ue=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(ue=parseFloat(/^WebGL (\d)/.exec(ce)[1]),le=ue>=1):-1!==ce.indexOf("OpenGL ES")&&(ue=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),le=ue>=2);let he=null,de={};const pe=new ki,fe=new ki;function me(t,i,n){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let a=0;a<n;a++)e.texImage2D(i+a,0,6408,1,1,0,6408,5121,r);return s}const ge={};function ye(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function ve(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}function _e(t){return h!==t&&(e.useProgram(t),h=t,!0)}ge[3553]=me(3553,3553,1),ge[34067]=me(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),ye(2929),l.setFunc(ie),xe(!1),Ae(S),ye(2884),Se(P);const be={[F]:32774,[U]:32778,[B]:32779};if(n)be[j]=32775,be[z]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(be[j]=e.MIN_EXT,be[z]=e.MAX_EXT)}const Te={[V]:0,[H]:1,[q]:768,[W]:770,[Z]:776,[Q]:774,[X]:772,[G]:769,[$]:771,[K]:775,[Y]:773};function Se(t,i,n,r,s,a,o,l){if(t!==P){if(d||(ye(3042),d=!0),t===N)s=s||i,a=a||n,o=o||r,i===f&&s===y||(e.blendEquationSeparate(be[i],be[s]),f=i,y=s),n===m&&r===g&&a===v&&o===_||(e.blendFuncSeparate(Te[n],Te[r],Te[a],Te[o]),m=n,g=r,v=a,_=o),p=t,b=null;else if(t!==p||l!==b){if(f===F&&y===F||(e.blendEquation(32774),f=F,y=F),l)switch(t){case L:e.blendFuncSeparate(1,771,1,771);break;case D:e.blendFunc(1,1);break;case O:e.blendFuncSeparate(0,0,769,771);break;case R:e.blendFuncSeparate(0,768,0,770)}else switch(t){case L:e.blendFuncSeparate(770,771,1,771);break;case D:e.blendFunc(770,1);break;case O:e.blendFunc(0,769);break;case R:e.blendFunc(0,768)}m=null,g=null,v=null,_=null,p=t,b=l}}else d&&(ve(3042),d=!1)}function we(e,t){e.side===k?ve(2884):ye(2884);let i=e.side===M;t&&(i=!i),xe(i),e.blending===L&&!1===e.transparent?Se(P):Se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),l.setFunc(e.depthFunc),l.setTest(e.depthTest),l.setMask(e.depthWrite),o.setMask(e.colorWrite);const n=e.stencilWrite;u.setTest(n),n&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ce(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function xe(t){x!==t&&(t?e.frontFace(2304):e.frontFace(2305),x=t)}function Ae(t){t!==T?(ye(2884),t!==A&&(t===S?e.cullFace(1029):t===w?e.cullFace(1028):e.cullFace(1032))):ve(2884),A=t}function Ee(t){t!==E&&(le&&e.lineWidth(t),E=t)}function Ce(t,i,n){t?(ye(32823),C===i&&I===n||(e.polygonOffset(i,n),C=i,I=n)):ve(32823)}function Me(e){e?ye(3089):ve(3089)}function ke(t){void 0===t&&(t=33984+oe-1),he!==t&&(e.activeTexture(t),he=t)}function Ie(t,i){null===he&&ke();let n=de[he];void 0===n&&(n={type:void 0,texture:void 0},de[he]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||ge[t]),n.type=t,n.texture=i)}function Pe(){const t=de[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)}function Le(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){}}function De(){try{e.texImage2D.apply(e,arguments)}catch(t){}}function Oe(){try{e.texImage3D.apply(e,arguments)}catch(t){}}function Re(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))}function Ne(t){!1===fe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),fe.copy(t))}function Fe(){c={},he=null,de={},h=null,d=null,p=null,f=null,m=null,g=null,y=null,v=null,_=null,b=!1,x=null,A=null,E=null,C=null,I=null,o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:ye,disable:ve,useProgram:_e,setBlending:Se,setMaterial:we,setFlipSided:xe,setCullFace:Ae,setLineWidth:Ee,setPolygonOffset:Ce,setScissorTest:Me,activeTexture:ke,bindTexture:Ie,unbindTexture:Pe,compressedTexImage2D:Le,texImage2D:De,texImage3D:Oe,scissor:Re,viewport:Ne,reset:Fe}}function Eo(e,t,i,n,r,s,a){const o=r.isWebGL2,l=(r.maxTextures,r.maxCubemapSize),u=r.maxTextureSize,c=r.maxSamples,h=new WeakMap;let d,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(Z){}function f(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function m(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?Ti.floorPowerOfTwo:Math.floor,s=n(r*e.width),a=n(r*e.height);void 0===d&&(d=f(s,a));const o=i?f(s,a):d;return o.width=s,o.height=a,o.getContext("2d").drawImage(e,0,0,s,a),o}return e}return e}function g(e){return Ti.isPowerOfTwo(e.width)&&Ti.isPowerOfTwo(e.height)}function y(e){return!o&&(e.wrapS!==xe||e.wrapT!==xe||e.minFilter!==Ee&&e.minFilter!==ke)}function v(e,t){return e.generateMipmaps&&t&&e.minFilter!==Ee&&e.minFilter!==ke}function _(t,i,r,s){e.generateMipmap(t),n.get(i).__maxMipLevel=Math.log(Math.max(r,s))*Math.LOG2E}function b(i,n,r){if(!1===o)return n;if(null!==i&&void 0!==e[i])return e[i];let s=n;return 6403===n&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),6407===n&&(5126===r&&(s=34837),5131===r&&(s=34843),5121===r&&(s=32849)),6408===n&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=32856)),33325!==s&&33326!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function T(e){return e===Ee||e===Ce||e===Me?9728:9729}function S(e){const t=e.target;t.removeEventListener("dispose",S),x(t),t.isVideoTexture&&h.delete(t),a.memory.textures--}function w(e){const t=e.target;t.removeEventListener("dispose",w),A(t),a.memory.textures--}function x(t){const i=n.get(t);void 0!==i.__webglInit&&(e.deleteTexture(i.__webglTexture),n.remove(t))}function A(t){const i=n.get(t),r=n.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);n.remove(t.texture),n.remove(t)}}let E=0;function C(){E=0}function M(){const e=E;return E+=1,e}function k(e,t){const r=n.get(e);if(e.isVideoTexture&&$(e),e.version>0&&r.__version!==e.version){const i=e.image;if(void 0===i);else if(!1!==i.complete)return void F(r,e,t)}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function I(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?F(r,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,r.__webglTexture))}function P(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?F(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))}function L(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?U(r,e,t):(i.activeTexture(33984+t),i.bindTexture(34067,r.__webglTexture))}const D={[we]:10497,[xe]:33071,[Ae]:33648},O={[Ee]:9728,[Ce]:9984,[Me]:9986,[ke]:9729,[Ie]:9985,[Pe]:9987};function R(i,s,a){a?(e.texParameteri(i,10242,D[s.wrapS]),e.texParameteri(i,10243,D[s.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,D[s.wrapR]),e.texParameteri(i,10240,O[s.magFilter]),e.texParameteri(i,10241,O[s.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),s.wrapS!==xe||s.wrapT,e.texParameteri(i,10240,T(s.magFilter)),e.texParameteri(i,10241,T(s.minFilter)),s.minFilter!==Ee&&s.minFilter);const l=t.get("EXT_texture_filter_anisotropic");if(l){if(s.type===Ue&&null===t.get("OES_texture_float_linear"))return;if(s.type===Be&&null===(o||t.get("OES_texture_half_float_linear")))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function N(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",S),t.__webglTexture=e.createTexture(),a.memory.textures++)}function F(t,n,r){let a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),N(t,n),i.activeTexture(33984+r),i.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);const l=y(n)&&!1===g(n.image),c=m(n.image,l,!1,u),h=g(c)||o,d=s.convert(n.format);let p,f=s.convert(n.type),T=b(n.internalFormat,d,f);R(a,n,h);const S=n.mipmaps;if(n.isDepthTexture)T=6402,o?T=n.type===Ue?36012:n.type===Fe?33190:n.type===He?35056:33189:n.type,n.format===Ye&&6402===T&&n.type!==Re&&n.type!==Fe&&(n.type=Re,f=s.convert(n.type)),n.format===Qe&&6402===T&&(T=34041,n.type!==He&&(n.type=He,f=s.convert(n.type))),i.texImage2D(3553,0,T,c.width,c.height,0,d,f,null);else if(n.isDataTexture)if(S.length>0&&h){for(let e=0,t=S.length;e<t;e++)p=S[e],i.texImage2D(3553,e,T,p.width,p.height,0,d,f,p.data);n.generateMipmaps=!1,t.__maxMipLevel=S.length-1}else i.texImage2D(3553,0,T,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=S.length;e<t;e++)p=S[e],n.format!==We&&n.format!==Ge?null!==d&&i.compressedTexImage2D(3553,e,T,p.width,p.height,0,p.data):i.texImage2D(3553,e,T,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=S.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,T,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,T,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(S.length>0&&h){for(let e=0,t=S.length;e<t;e++)p=S[e],i.texImage2D(3553,e,T,d,f,p);n.generateMipmaps=!1,t.__maxMipLevel=S.length-1}else i.texImage2D(3553,0,T,d,f,c),t.__maxMipLevel=0;v(n,h)&&_(a,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function U(t,n,r){if(6!==n.image.length)return;N(t,n),i.activeTexture(33984+r),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);const a=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),u=n.image[0]&&n.image[0].isDataTexture,c=[];for(let e=0;e<6;e++)c[e]=a||u?u?n.image[e].image:n.image[e]:m(n.image[e],!1,!0,l);const h=c[0],d=g(h)||o,p=s.convert(n.format),f=s.convert(n.type),y=b(n.internalFormat,p,f);let T;if(R(34067,n,d),a){for(let e=0;e<6;e++){T=c[e].mipmaps;for(let t=0;t<T.length;t++){const r=T[t];n.format!==We&&n.format!==Ge?null!==p&&i.compressedTexImage2D(34069+e,t,y,r.width,r.height,0,r.data):i.texImage2D(34069+e,t,y,r.width,r.height,0,p,f,r.data)}}t.__maxMipLevel=T.length-1}else{T=n.mipmaps;for(let e=0;e<6;e++)if(u){i.texImage2D(34069+e,0,y,c[e].width,c[e].height,0,p,f,c[e].data);for(let t=0;t<T.length;t++){const n=T[t].image[e].image;i.texImage2D(34069+e,t+1,y,n.width,n.height,0,p,f,n.data)}}else{i.texImage2D(34069+e,0,y,p,f,c[e]);for(let t=0;t<T.length;t++){const n=T[t];i.texImage2D(34069+e,t+1,y,p,f,n.image[e])}}t.__maxMipLevel=T.length}v(n,d)&&_(34067,n,h.width,h.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function B(t,r,a,o){const l=s.convert(r.texture.format),u=s.convert(r.texture.type),c=b(r.texture.internalFormat,l,u);i.texImage2D(o,0,c,r.width,r.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,o,n.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function j(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===Ue?r=36012:t.type===Fe&&(r=33190));const n=W(i);e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const t=W(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=s.convert(i.texture.format),r=s.convert(i.texture.type),a=b(i.texture.internalFormat,t,r);if(n){const t=W(i);e.renderbufferStorageMultisample(36161,t,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function z(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),k(i.depthTexture,0);const r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Ye)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(i.depthTexture.format!==Qe)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}function V(t){const i=n.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");z(i.__webglFramebuffer,t)}else if(r){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)e.bindFramebuffer(36160,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=e.createRenderbuffer(),j(i.__webglDepthbuffer[n],t,!1)}else e.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),j(i.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function H(t){const r=n.get(t),l=n.get(t.texture);t.addEventListener("dispose",w),l.__webglTexture=e.createTexture(),a.memory.textures++;const u=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultisampleRenderTarget,h=g(t)||o;if(!o||t.texture.format!==Ge||t.texture.type!==Ue&&t.texture.type!==Be||(t.texture.format=We),u){r.__webglFramebuffer=[];for(let t=0;t<6;t++)r.__webglFramebuffer[t]=e.createFramebuffer()}else if(r.__webglFramebuffer=e.createFramebuffer(),c&&o){r.__webglMultisampledFramebuffer=e.createFramebuffer(),r.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const i=s.convert(t.texture.format),n=s.convert(t.texture.type),a=b(t.texture.internalFormat,i,n),o=W(t);e.renderbufferStorageMultisample(36161,o,a,t.width,t.height),e.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(r.__webglDepthRenderbuffer=e.createRenderbuffer(),j(r.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}if(u){i.bindTexture(34067,l.__webglTexture),R(34067,t.texture,h);for(let e=0;e<6;e++)B(r.__webglFramebuffer[e],t,36064,34069+e);v(t.texture,h)&&_(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,l.__webglTexture),R(3553,t.texture,h),B(r.__webglFramebuffer,t,36064,3553),v(t.texture,h)&&_(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);t.depthBuffer&&V(t)}function q(e){const t=e.texture;if(v(t,g(e)||o)){const r=e.isWebGLCubeRenderTarget?34067:3553,s=n.get(t).__webglTexture;i.bindTexture(r,s),_(r,t,e.width,e.height),i.bindTexture(r,null)}}function G(t){if(t.isWebGLMultisampleRenderTarget&&o){const i=n.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);const r=t.width,s=t.height;let a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,r,s,0,0,r,s,a,9728),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}}function W(e){return o&&e.isWebGLMultisampleRenderTarget?Math.min(c,e.samples):0}function $(e){const t=a.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}let X=!1,Y=!1;function Q(e,t){e&&e.isWebGLRenderTarget&&(!1===X&&(X=!0),e=e.texture),k(e,t)}function K(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===Y&&(Y=!0),e=e.texture),L(e,t)}this.allocateTextureUnit=M,this.resetTextureUnits=C,this.setTexture2D=k,this.setTexture2DArray=I,this.setTexture3D=P,this.setTextureCube=L,this.setupRenderTarget=H,this.updateRenderTargetMipmap=q,this.updateMultisampleRenderTarget=G,this.safeSetTexture2D=Q,this.safeSetTextureCube=K}function Co(e,t,i){const n=i.isWebGL2;function r(e){let i;if(e===Le)return 5121;if(e===je)return 32819;if(e===ze)return 32820;if(e===Ve)return 33635;if(e===De)return 5120;if(e===Oe)return 5122;if(e===Re)return 5123;if(e===Ne)return 5124;if(e===Fe)return 5125;if(e===Ue)return 5126;if(e===Be)return n?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===qe)return 6406;if(e===Ge)return 6407;if(e===We)return 6408;if(e===$e)return 6409;if(e===Xe)return 6410;if(e===Ye)return 6402;if(e===Qe)return 34041;if(e===Ke)return 6403;if(e===Ze)return 36244;if(e===Je)return 33319;if(e===et)return 33320;if(e===tt)return 36248;if(e===it)return 36249;if(e===nt||e===rt||e===st||e===at){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===nt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===rt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===st)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===at)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===ot||e===lt||e===ut||e===ct){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===ot)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===lt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===ut)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ct)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ht)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===dt||e===pt)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(e===dt)return i.COMPRESSED_RGB8_ETC2;if(e===pt)return i.COMPRESSED_RGBA8_ETC2_EAC}return e===ft||e===mt||e===gt||e===yt||e===vt||e===_t||e===bt||e===Tt||e===St||e===wt||e===xt||e===At||e===Et||e===Ct||e===kt||e===It||e===Pt||e===Lt||e===Dt||e===Ot||e===Rt||e===Nt||e===Ft||e===Ut||e===Bt||e===jt||e===zt||e===Vt?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):e===Mt?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===He?n?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}return{convert:r}}function Mo(e=[]){ns.call(this),this.cameras=e}function ko(){Ln.call(this),this.type="Group"}function Io(){this._targetRay=null,this._grip=null,this._hand=null}function Po(e,t){const i=this;let n=null,r=1,s=null,a="local-floor",o=null;const l=[],u=new Map,c=new ns;c.layers.enable(1),c.viewport=new ki;const h=new ns;h.layers.enable(2),h.viewport=new ki;const d=[c,h],p=new Mo;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(e){const t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function v(){u.forEach(function(e,t){e.disconnect(t)}),u.clear(),f=null,m=null,e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),E.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function _(e){const t=n.inputSources;for(let i=0;i<l.length;i++)u.set(t[i],l[i]);for(let i=0;i<e.removed.length;i++){const t=e.removed[i],n=u.get(t);n&&(n.dispatchEvent({type:"disconnected",data:t}),u.delete(t))}for(let i=0;i<e.added.length;i++){const t=e.added[i],n=u.get(t);n&&n.dispatchEvent({type:"connected",data:t})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=l[e];return void 0===t&&(t=new Io,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=l[e];return void 0===t&&(t=new Io,l[e]=t),t.getGripSpace()},this.getHand=function(e){let t=l[e];return void 0===t&&(t=new Io,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,i.isPresenting},this.setReferenceSpaceType=function(e){a=e,i.isPresenting},this.getReferenceSpace=function(){return s},this.getSession=function(){return n},this.setSession=function(){var e=y(function*(e){if(n=e,null!==n){n.addEventListener("select",g),n.addEventListener("selectstart",g),n.addEventListener("selectend",g),n.addEventListener("squeeze",g),n.addEventListener("squeezestart",g),n.addEventListener("squeezeend",g),n.addEventListener("end",v),n.addEventListener("inputsourceschange",_);const e=t.getContextAttributes();!0!==e.xrCompatible&&(yield t.makeXRCompatible());const o={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r},l=new XRWebGLLayer(n,t,o);n.updateRenderState({baseLayer:l}),s=yield n.requestReferenceSpace(a),E.setContext(n),E.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(t){return e.apply(this,arguments)}}();const b=new Li,T=new Li;function S(e,t,i){b.setFromMatrixPosition(t.matrixWorld),T.setFromMatrixPosition(i.matrixWorld);const n=b.distanceTo(T),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(s[8]+1)/s[0],d=a*c,p=a*h,f=n/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=a+f,y=o+f,v=d-m,_=p+(n-m),S=l*o/y*g,w=u*o/y*g;e.projectionMatrix.makePerspective(v,_,S,w,g,y)}function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=h.near=c.near=e.near,p.far=h.far=c.far=e.far,f===p.near&&m===p.far||(n.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const t=e.parent,i=p.cameras;w(p,t);for(let n=0;n<i.length;n++)w(i[n],t);e.matrixWorld.copy(p.matrixWorld),e.matrix.copy(p.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let n=0,s=r.length;n<s;n++)r[n].updateMatrixWorld(!0);return 2===i.length?S(p,c,h):p.projectionMatrix.copy(c.projectionMatrix),p};let x=null;function A(t,i){if(o=i.getViewerPose(s),null!==o){const t=o.views,i=n.renderState.baseLayer;e.setFramebuffer(i.framebuffer);let r=!1;t.length!==p.cameras.length&&(p.cameras.length=0,r=!0);for(let e=0;e<t.length;e++){const n=t[e],s=i.getViewport(n),a=d[e];a.matrix.fromArray(n.transform.matrix),a.projectionMatrix.fromArray(n.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===e&&p.matrix.copy(a.matrix),!0===r&&p.cameras.push(a)}}const r=n.inputSources;for(let e=0;e<l.length;e++){const t=l[e],n=r[e];t.update(n,i,s)}x&&x(t,i)}const E=new ps;E.setAnimationLoop(A),this.setAnimationLoop=function(e){x=e},this.dispose=function(){}}function Lo(e){function t(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function i(e,t,i,y){t.isMeshBasicMaterial?n(e,t):t.isMeshLambertMaterial?(n(e,t),l(e,t)):t.isMeshToonMaterial?(n(e,t),c(e,t)):t.isMeshPhongMaterial?(n(e,t),u(e,t)):t.isMeshStandardMaterial?(n(e,t),t.isMeshPhysicalMaterial?d(e,t):h(e,t)):t.isMeshMatcapMaterial?(n(e,t),p(e,t)):t.isMeshDepthMaterial?(n(e,t),f(e,t)):t.isMeshDistanceMaterial?(n(e,t),m(e,t)):t.isMeshNormalMaterial?(n(e,t),g(e,t)):t.isLineBasicMaterial?(r(e,t),t.isLineDashedMaterial&&s(e,t)):t.isPointsMaterial?a(e,t,i,y):t.isSpriteMaterial?o(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}function n(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);const n=e.get(i).envMap;if(n){t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;const r=e.get(n).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,s;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),i.aoMap?s=i.aoMap:i.lightMap&&(s=i.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uv2Transform.value.copy(s.matrix))}function r(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}function s(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function a(e,t,i,n){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function o(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}function l(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function u(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===M&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===M&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function c(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===M&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===M&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function h(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===M&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===M&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}function d(e,t){h(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===M&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}function p(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===M&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===M&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function f(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function m(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}function g(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===M&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===M&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:i}}function Do(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}function Oo(e){const t=void 0!==(e=e||{}).canvas?e.canvas:Do(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=ti,this.physicallyCorrectLights=!1,this.toneMapping=ce,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const f=this;let m=!1,g=null,y=0,v=0,_=null,b=null,T=-1,S=null;const w=new ki,x=new ki;let A=null,E=t.width,C=t.height,M=1,k=null,I=null;const P=new ki(0,0,E,C),L=new ki(0,0,E,C);let D=!1;const O=new ds;let R=!1,N=!1;const F=new on,U=new Li,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===_?M:1}let z,V,H,q,G,W,$,X,Y,Q,K,Z,J,ee,te,ie,ne,re,se,ae,oe,le=i;function ue(e,i){for(let n=0;n<e.length;n++){const r=e[n],s=t.getContext(r,i);if(null!==s)return s}return null}try{const e={alpha:n,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",me,!1),null===le){const t=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&t.shift(),le=ue(t,e),null===le)throw ue(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===le.getShaderPrecisionFormat&&(le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ie){throw Ie}function he(){z=new As(le),V=new Ss(le,z,e),z.init(V),ae=new Co(le,z,V),H=new Ao(le,z,V),H.scissor(x.copy(L).multiplyScalar(M).floor()),H.viewport(w.copy(P).multiplyScalar(M).floor()),q=new Ms,G=new oo,W=new Eo(le,z,H,G,V,ae,q),$=new xs(f),X=new fs(le,V),oe=new bs(le,z,X,V),Y=new Es(le,X,q,oe),Q=new Ls(le,Y,X,q),ne=new Ps(le),te=new ws(G),K=new ao(f,$,z,V,oe,te),Z=new Lo(G),J=new ho(G),ee=new _o(z,V),ie=new _s(f,$,H,Q,o),re=new Ts(le,z,q,V),se=new Cs(le,z,q,V),q.programs=K.programs,f.capabilities=V,f.extensions=z,f.properties=G,f.renderLists=J,f.state=H,f.info=q}he();const de=new Po(f,le);this.xr=de;const pe=new xo(f,Q,V.maxTextureSize);function fe(e){e.preventDefault(),m=!0}function me(){m=!1,he()}function ge(e){const t=e.target;t.removeEventListener("dispose",ge),ye(t)}function ye(e){ve(e),G.remove(e)}function ve(e){const t=G.get(e).program;void 0!==t&&K.releaseProgram(t)}function _e(e,t){e.render(function(e){f.renderBufferImmediate(e,t)})}this.shadowMap=pe,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){const e=z.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=z.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(E,C,!1))},this.getSize=function(e){return void 0===e&&(e=new Si),e.set(E,C)},this.setSize=function(e,i,n){de.isPresenting||(E=e,C=i,t.width=Math.floor(e*M),t.height=Math.floor(i*M),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(e=new Si),e.set(E*M,C*M).floor()},this.setDrawingBufferSize=function(e,i,n){E=e,C=i,M=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(e=new ki),e.copy(w)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,i,n){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,i,n),H.viewport(w.copy(P).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,i,n){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,i,n),H.scissor(x.copy(L).multiplyScalar(M).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){H.setScissorTest(D=e)},this.setOpaqueSort=function(e){k=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return void 0===e&&(e=new er),e.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),le.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",me,!1),J.dispose(),ee.dispose(),G.dispose(),$.dispose(),Q.dispose(),oe.dispose(),de.dispose(),Se.stop()},this.renderBufferImmediate=function(e,t){oe.initAttributes();const i=G.get(e);e.hasPositions&&!i.position&&(i.position=le.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=le.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=le.createBuffer()),e.hasColors&&!i.color&&(i.color=le.createBuffer());const n=t.getAttributes();e.hasPositions&&(le.bindBuffer(34962,i.position),le.bufferData(34962,e.positionArray,35048),oe.enableAttribute(n.position),le.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(le.bindBuffer(34962,i.normal),le.bufferData(34962,e.normalArray,35048),oe.enableAttribute(n.normal),le.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(le.bindBuffer(34962,i.uv),le.bufferData(34962,e.uvArray,35048),oe.enableAttribute(n.uv),le.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(le.bindBuffer(34962,i.color),le.bufferData(34962,e.colorArray,35048),oe.enableAttribute(n.color),le.vertexAttribPointer(n.color,3,5126,!1,0,0)),oe.disableUnusedAttributes(),le.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=B);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=Ce(e,t,n,r);H.setMaterial(n,a);let l=i.index;const u=i.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;let c,h=1;!0===n.wireframe&&(l=Y.getWireframeAttribute(i),h=2),(n.morphTargets||n.morphNormals)&&ne.update(r,i,n,o),oe.setup(r,n,o,i,l);let d=re;null!==l&&(c=X.get(l),d=se,d.setIndex(c));const p=null!==l?l.count:u.count,f=i.drawRange.start*h,m=i.drawRange.count*h,g=null!==s?s.start*h:0,y=null!==s?s.count*h:1/0,v=Math.max(f,g),_=Math.min(p,f+m,g+y)-1,b=Math.max(0,_-v+1);if(0!==b){if(r.isMesh)!0===n.wireframe?(H.setLineWidth(n.wireframeLinewidth*j()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),H.setLineWidth(e*j()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(v,b,r.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(v,b,e)}else d.render(v,b)}},this.compile=function(e,t){d=ee.get(e),d.init(),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))}),d.setupLights();const i=new WeakMap;e.traverse(function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){const s=n[r];!1===i.has(s)&&(Ee(s,e,t),i.set(s))}else!1===i.has(n)&&(Ee(n,e,t),i.set(n))})};let be=null;function Te(e){de.isPresenting||be&&be(e)}const Se=new ps;function we(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){n&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=Q.update(e),r=e.material;r.visible&&h.push(e,t,r,i,U.z,null)}}else if(e.isImmediateRenderObject)n&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F),h.push(e,null,e.material,i,U.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==q.render.frame&&(e.skeleton.update(),e.skeleton.frame=q.render.frame),!e.frustumCulled||O.intersectsObject(e))){n&&U.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=Q.update(e),r=e.material;if(Array.isArray(r)){const n=t.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&h.push(e,t,o,i,U.z,a)}}else r.visible&&h.push(e,t,r,i,U.z,null)}const r=e.children;for(let s=0,a=r.length;s<a;s++)we(r[s],t,i,n)}function xe(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=null===n?s.material:n,u=s.group;if(i.isArrayCamera){const e=i.cameras;for(let i=0,n=e.length;i<n;i++){const n=e[i];a.layers.test(n.layers)&&(H.viewport(w.copy(n.viewport)),d.setupLightsView(n),Ae(a,t,n,o,l,u))}}else Ae(a,t,i,o,l,u)}}function Ae(e,t,i,n,r,s){if(e.onBeforeRender(f,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const n=Ce(i,t,r,e);H.setMaterial(r),oe.reset(),_e(e,n)}else f.renderBufferDirect(i,t,n,r,e,s);e.onAfterRender(f,t,i,n,r,s)}function Ee(e,t,i){!0!==t.isScene&&(t=B);const n=G.get(e),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=K.getParameters(e,r.state,s,t,i),l=K.getProgramCacheKey(o);let u=n.program,c=!0;if(n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=$.get(e.envMap||n.environment),void 0===u)e.addEventListener("dispose",ge);else if(u.cacheKey!==l)ve(e);else if(n.lightsStateVersion!==a)c=!1;else{if(void 0!==o.shaderID)return;c=!1}c&&(o.uniforms=K.getUniforms(e),e.onBeforeCompile(o,f),u=K.acquireProgram(o,l),n.program=u,n.uniforms=o.uniforms,n.outputEncoding=o.outputEncoding);const h=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=te.numPlanes,n.numIntersection=te.numIntersection,h.clippingPlanes=te.uniform),n.needsLights=ke(e),n.lightsStateVersion=a,n.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=n.program.getUniforms(),m=Pa.seqWithValue(p.seq,h);n.uniformsList=m}function Ce(e,t,i,n){!0!==t.isScene&&(t=B),W.resetTextureUnits();const r=t.fog,s=i.isMeshStandardMaterial?t.environment:null,a=null===_?f.outputEncoding:_.texture.encoding,o=$.get(i.envMap||s),l=G.get(i),u=d.state.lights;if(!0===R&&(!0===N||e!==S)){const t=e===S&&i.id===T;te.setState(i,e,t)}i.version===l.__version?i.fog&&l.fog!==r||l.environment!==s||l.needsLights&&l.lightsStateVersion!==u.state.version?Ee(i,t,n):void 0===l.numClippingPlanes||l.numClippingPlanes===te.numPlanes&&l.numIntersection===te.numIntersection?(l.outputEncoding!==a||l.envMap!==o)&&Ee(i,t,n):Ee(i,t,n):(Ee(i,t,n),l.__version=i.version);let c=!1,h=!1,p=!1;const m=l.program,g=m.getUniforms(),y=l.uniforms;if(H.useProgram(m.program)&&(c=!0,h=!0,p=!0),i.id!==T&&(T=i.id,h=!0),c||S!==e){if(g.setValue(le,"projectionMatrix",e.projectionMatrix),V.logarithmicDepthBuffer&&g.setValue(le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),S!==e&&(S=e,h=!0,p=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=g.map.cameraPosition;void 0!==t&&t.setValue(le,U.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&g.setValue(le,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&g.setValue(le,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){g.setOptional(le,n,"bindMatrix"),g.setOptional(le,n,"bindMatrixInverse");const e=n.skeleton;if(e){const t=e.bones;if(V.floatVertexTextures){if(null===e.boneTexture){let i=Math.sqrt(4*t.length);i=Ti.ceilPowerOfTwo(i),i=Math.max(i,4);const n=new Float32Array(i*i*4);n.set(e.boneMatrices);const r=new us(n,i,i,We,Ue);e.boneMatrices=n,e.boneTexture=r,e.boneTextureSize=i}g.setValue(le,"boneTexture",e.boneTexture,W),g.setValue(le,"boneTextureSize",e.boneTextureSize)}else g.setOptional(le,e,"boneMatrices")}}return(h||l.receiveShadow!==n.receiveShadow)&&(l.receiveShadow=n.receiveShadow,g.setValue(le,"receiveShadow",n.receiveShadow)),h&&(g.setValue(le,"toneMappingExposure",f.toneMappingExposure),l.needsLights&&Me(y,p),r&&i.fog&&Z.refreshFogUniforms(y,r),Z.refreshMaterialUniforms(y,i,M,C),Pa.upload(le,l.uniformsList,y,W)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Pa.upload(le,l.uniformsList,y,W),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&g.setValue(le,"center",n.center),g.setValue(le,"modelViewMatrix",n.modelViewMatrix),g.setValue(le,"normalMatrix",n.normalMatrix),g.setValue(le,"modelMatrix",n.matrixWorld),m}function Me(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function ke(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Se.setAnimationLoop(Te),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){be=e,de.setAnimationLoop(e),null===e?Se.stop():Se.start()},this.render=function(e,t){let i,n;if(void 0!==arguments[2]&&(i=arguments[2]),void 0!==arguments[3]&&(n=arguments[3]),void 0!==t&&!0!==t.isCamera)return;if(!0===m)return;oe.resetDefaultState(),T=-1,S=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===de.enabled&&!0===de.isPresenting&&(t=de.getCamera(t)),!0===e.isScene&&e.onBeforeRender(f,e,t,i||_),d=ee.get(e,p.length),d.init(),p.push(d),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(F),N=this.localClippingEnabled,R=te.init(this.clippingPlanes,N,t),h=J.get(e,t),h.init(),we(e,t,0,f.sortObjects),h.finish(),!0===f.sortObjects&&h.sort(k,I),!0===R&&te.beginShadows();const r=d.state.shadowsArray;pe.render(r,e,t),d.setupLights(),d.setupLightsView(t),!0===R&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),ie.render(h,e,t,n);const s=h.opaque,a=h.transparent;s.length>0&&xe(s,e,t),a.length>0&&xe(a,e,t),!0===e.isScene&&e.onAfterRender(f,e,t),null!==_&&(W.updateRenderTargetMipmap(_),W.updateMultisampleRenderTarget(_)),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),p.pop(),d=p.length>0?p[p.length-1]:null,h=null},this.setFramebuffer=function(e){g!==e&&null===_&&le.bindFramebuffer(36160,e),g=e},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return v},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderTarget=function(){return _},this.setRenderTarget=function(e,t=0,i=0){_=e,y=t,v=i,e&&void 0===G.get(e).__webglFramebuffer&&W.setupRenderTarget(e);let n=g,r=!1;if(e){const i=G.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=i[t],r=!0):n=e.isWebGLMultisampleRenderTarget?G.get(e).__webglMultisampledFramebuffer:i,w.copy(e.viewport),x.copy(e.scissor),A=e.scissorTest}else w.copy(P).multiplyScalar(M).floor(),x.copy(L).multiplyScalar(M).floor(),A=D;if(b!==n&&(le.bindFramebuffer(36160,n),b=n),H.viewport(w),H.scissor(x),H.setScissorTest(A),r){const n=G.get(e.texture);le.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}},this.readRenderTargetPixels=function(e,t,i,n,r,s,a){if(!e||!e.isWebGLRenderTarget)return;let o=G.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){let a=!1;o!==b&&(le.bindFramebuffer(36160,o),a=!0);try{const a=e.texture,o=a.format,l=a.type;if(o!==We&&ae.convert(o)!==le.getParameter(35739))return;const u=l===Be&&(z.has("EXT_color_buffer_half_float")||V.isWebGL2&&z.has("EXT_color_buffer_float"));if(!(l===Le||ae.convert(l)===le.getParameter(35738)||l===Ue&&(V.isWebGL2||z.has("OES_texture_float")||z.has("WEBGL_color_buffer_float"))||u))return;36053===le.checkFramebufferStatus(36160)&&t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&le.readPixels(t,i,n,r,ae.convert(o),ae.convert(l),s)}finally{a&&le.bindFramebuffer(36160,b)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n),a=ae.convert(t.format);W.setTexture2D(t,0),le.copyTexImage2D(3553,i,a,e.x,e.y,r,s,0),H.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const r=t.image.width,s=t.image.height,a=ae.convert(i.format),o=ae.convert(i.type);W.setTexture2D(i,0),le.pixelStorei(37440,i.flipY),le.pixelStorei(37441,i.premultiplyAlpha),le.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?le.texSubImage2D(3553,n,e.x,e.y,r,s,a,o,t.image.data):t.isCompressedTexture?le.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):le.texSubImage2D(3553,n,e.x,e.y,a,o,t.image),0===n&&i.generateMipmaps&&le.generateMipmap(3553),H.unbindTexture()},this.initTexture=function(e){W.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){H.reset(),oe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ro(e){Oo.call(this,e)}Mo.prototype=v(Object.create(ns.prototype),{constructor:Mo,isArrayCamera:!0}),ko.prototype=v(Object.create(Ln.prototype),{constructor:ko,isGroup:!0}),v(Io.prototype,{constructor:Io,getHandSpace:function(){return null===this._hand&&(this._hand=new ko,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ko,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ko,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){s=!0;for(const s of e.hand.values()){const e=t.getJointPose(s,i);if(void 0===l.joints[s.jointName]){const e=new ko;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[s.jointName]=e,l.add(e)}const n=l.joints[s.jointName];null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=e.radius),n.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,u=.005;l.inputState.pinching&&a>o+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale))),null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)));return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}),v(Po.prototype,vi.prototype),Ro.prototype=v(Object.create(Oo.prototype),{constructor:Ro,isWebGL1Renderer:!0});class No extends Ln{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}function Fo(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=mi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ti.generateUUID()}Object.defineProperty(Fo.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),v(Fo.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ti.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new Fo(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ti.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Uo=new Li;function Bo(e,t,i,n){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}function jo(e){nr.call(this),this.type="SpriteMaterial",this.color=new er(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let zo;Object.defineProperties(Bo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),v(Bo.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,i=this.data.count;t<i;t++)Uo.x=this.getX(t),Uo.y=this.getY(t),Uo.z=this.getZ(t),Uo.applyMatrix4(e),this.setXYZ(t,Uo.x,Uo.y,Uo.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this},clone:function(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new or(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Bo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),jo.prototype=Object.create(nr.prototype),jo.prototype.constructor=jo,jo.prototype.isSpriteMaterial=!0,jo.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const Vo=new Li,Ho=new Li,qo=new Li,Go=new Si,Wo=new Si,$o=new on,Xo=new Li,Yo=new Li,Qo=new Li,Ko=new Si,Zo=new Si,Jo=new Si;function el(e){if(Ln.call(this),this.type="Sprite",void 0===zo){zo=new Mr;const e=new Fo(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);zo.setIndex([0,1,2,0,2,3]),zo.setAttribute("position",new Bo(e,3,0,!1)),zo.setAttribute("uv",new Bo(e,2,3,!1))}this.geometry=zo,this.material=void 0!==e?e:new jo,this.center=new Si(.5,.5)}function tl(e,t,i,n,r,s){Go.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(Wo.x=s*Go.x-r*Go.y,Wo.y=r*Go.x+s*Go.y):Wo.copy(Go),e.copy(t),e.x+=Wo.x,e.y+=Wo.y,e.applyMatrix4($o)}el.prototype=v(Object.create(Ln.prototype),{constructor:el,isSprite:!0,raycast:function(e,t){e.camera,Ho.setFromMatrixScale(this.matrixWorld),$o.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),qo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ho.multiplyScalar(-qo.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;tl(Xo.set(-.5,-.5,0),qo,s,Ho,n,r),tl(Yo.set(.5,-.5,0),qo,s,Ho,n,r),tl(Qo.set(.5,.5,0),qo,s,Ho,n,r),Ko.set(0,0),Zo.set(1,0),Jo.set(1,1);let a=e.ray.intersectTriangle(Xo,Yo,Qo,!1,Vo);if(null===a&&(tl(Yo.set(-.5,.5,0),qo,s,Ho,n,r),Zo.set(0,1),a=e.ray.intersectTriangle(Xo,Qo,Yo,!1,Vo),null===a))return;const o=e.ray.origin.distanceTo(Vo);o<e.near||o>e.far||t.push({distance:o,point:Vo.clone(),uv:$n.getUV(Vo,Xo,Yo,Qo,Ko,Zo,Jo,new Si),face:null,object:this})},copy:function(e){return Ln.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const il=new Li,nl=new Li;function rl(){Ln.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}rl.prototype=v(Object.create(Ln.prototype),{constructor:rl,isLOD:!0,copy:function(e){Ln.prototype.copy.call(this,e,!1);const t=e.levels;for(let i=0,n=t.length;i<n;i++){const e=t[i];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){il.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(il);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){il.setFromMatrixPosition(e.matrixWorld),nl.setFromMatrixPosition(this.matrixWorld);const i=il.distanceTo(nl)/e.zoom;let n,r;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}},toJSON:function(e){const t=Ln.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let n=0,r=i.length;n<r;n++){const e=i[n];t.object.levels.push({object:e.object.uuid,distance:e.distance})}return t}});const sl=new Li,al=new ki,ol=new ki,ll=new Li,ul=new on;function cl(e,t){e&&e.isGeometry,Wr.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new on,this.bindMatrixInverse=new on}function hl(){Ln.call(this),this.type="Bone"}cl.prototype=v(Object.create(Wr.prototype),{constructor:cl,isSkinnedMesh:!0,copy:function(e){return Wr.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new ki,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Wr.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()},boneTransform:function(e,t){const i=this.skeleton,n=this.geometry;al.fromBufferAttribute(n.attributes.skinIndex,e),ol.fromBufferAttribute(n.attributes.skinWeight,e),sl.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=ol.getComponent(r);if(0!==e){const n=al.getComponent(r);ul.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(ll.copy(sl).applyMatrix4(ul),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}),hl.prototype=v(Object.create(Ln.prototype),{constructor:hl,isBone:!0});const dl=new on,pl=new on;function fl(e=[],t=[]){this.uuid=Ti.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}v(fl.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new on)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new on;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,s=e.length;r<s;r++){const n=e[r]?e[r].matrixWorld:pl;dl.multiplyMatrices(n,t[r]),dl.toArray(i,16*r)}null!==n&&(n.needsUpdate=!0)},clone:function(){return new fl(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let n=t[e.bones[i]];void 0===n&&(n=new hl),this.bones.push(n),this.boneInverses.push((new on).fromArray(e.boneInverses[i]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.bones.push(r.uuid);const s=i[n];e.boneInverses.push(s.toArray())}return e}});const ml=new on,gl=new on,yl=[],vl=new Wr;function _l(e,t,i){Wr.call(this,e,t),this.instanceMatrix=new or(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function bl(e){nr.call(this),this.type="LineBasicMaterial",this.color=new er(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}_l.prototype=v(Object.create(Wr.prototype),{constructor:_l,isInstancedMesh:!0,copy:function(e){return Wr.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const i=this.matrixWorld,n=this.count;if(vl.geometry=this.geometry,vl.material=this.material,void 0!==vl.material)for(let r=0;r<n;r++){this.getMatrixAt(r,ml),gl.multiplyMatrices(i,ml),vl.matrixWorld=gl,vl.raycast(e,yl);for(let e=0,i=yl.length;e<i;e++){const i=yl[e];i.instanceId=r,i.object=this,t.push(i)}yl.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new or(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),bl.prototype=Object.create(nr.prototype),bl.prototype.constructor=bl,bl.prototype.isLineBasicMaterial=!0,bl.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const Tl=new Li,Sl=new Li,wl=new on,xl=new an,Al=new Ki;function El(e=new Mr,t=new bl){Ln.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}El.prototype=v(Object.create(Ln.prototype),{constructor:El,isLine:!0,copy:function(e){return Ln.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry){if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Tl.fromBufferAttribute(t,e-1),Sl.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Tl.distanceTo(Sl);e.setAttribute("lineDistance",new gr(i,1))}}else e.isGeometry;return this},raycast:function(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Al.copy(i.boundingSphere),Al.applyMatrix4(n),Al.radius+=r,!1===e.ray.intersectsSphere(Al))return;wl.copy(n).invert(),xl.copy(e.ray).applyMatrix4(wl);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,o=new Li,l=new Li,u=new Li,c=new Li,h=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){const i=n.array;for(let n=0,s=i.length-1;n<s;n+=h){const s=i[n],h=i[n+1];if(o.fromBufferAttribute(r,s),l.fromBufferAttribute(r,h),xl.distanceSqToSegment(o,l,c,u)>a)continue;c.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(c);d<e.near||d>e.far||t.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else for(let i=0,s=r.count-1;i<s;i+=h){if(o.fromBufferAttribute(r,i),l.fromBufferAttribute(r,i+1),xl.distanceSqToSegment(o,l,c,u)>a)continue;c.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(c);n<e.near||n>e.far||t.push({distance:n,point:u.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else i.isGeometry},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length}}});const Cl=new Li,Ml=new Li;function kl(e,t){El.call(this,e,t),this.type="LineSegments"}function Il(e,t){El.call(this,e,t),this.type="LineLoop"}function Pl(e){nr.call(this),this.type="PointsMaterial",this.color=new er(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}kl.prototype=v(Object.create(El.prototype),{constructor:kl,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry){if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)Cl.fromBufferAttribute(t,e),Ml.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+Cl.distanceTo(Ml);e.setAttribute("lineDistance",new gr(i,1))}}else e.isGeometry;return this}}),Il.prototype=v(Object.create(El.prototype),{constructor:Il,isLineLoop:!0}),Pl.prototype=Object.create(nr.prototype),Pl.prototype.constructor=Pl,Pl.prototype.isPointsMaterial=!0,Pl.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const Ll=new on,Dl=new an,Ol=new Ki,Rl=new Li;function Nl(e=new Mr,t=new Pl){Ln.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function Fl(e,t,i,n,r,s,a){const o=Dl.distanceSqToPoint(e);if(o<i){const i=new Li;Dl.closestPointToPoint(e,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:t,face:null,object:a})}}function Ul(e,t,i,n,r,s,a,o,l){Ci.call(this,e,t,i,n,r,s,a,o,l),this.format=void 0!==a?a:Ge,this.minFilter=void 0!==s?s:ke,this.magFilter=void 0!==r?r:ke,this.generateMipmaps=!1;const u=this;function c(){u.needsUpdate=!0,e.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(c)}function Bl(e,t,i,n,r,s,a,o,l,u,c,h){Ci.call(this,null,s,a,o,l,u,n,r,c,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function jl(e,t,i,n,r,s,a,o,l){Ci.call(this,e,t,i,n,r,s,a,o,l),this.needsUpdate=!0}function zl(e,t,i,n,r,s,a,o,l,u){if((u=void 0!==u?u:Ye)!==Ye&&u!==Qe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===Ye&&(i=Re),void 0===i&&u===Qe&&(i=He),Ci.call(this,null,n,r,s,a,o,u,i,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:Ee,this.minFilter=void 0!==o?o:Ee,this.flipY=!1,this.generateMipmaps=!1}Nl.prototype=v(Object.create(Ln.prototype),{constructor:Nl,isPoints:!0,copy:function(e){return Ln.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ol.copy(i.boundingSphere),Ol.applyMatrix4(n),Ol.radius+=r,!1===e.ray.intersectsSphere(Ol))return;Ll.copy(n).invert(),Dl.copy(e.ray).applyMatrix4(Ll);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(i.isBufferGeometry){const r=i.index,s=i.attributes.position;if(null!==r){const i=r.array;for(let r=0,o=i.length;r<o;r++){const o=i[r];Rl.fromBufferAttribute(s,o),Fl(Rl,o,a,n,e,t,this)}}else for(let i=0,o=s.count;i<o;i++)Rl.fromBufferAttribute(s,i),Fl(Rl,i,a,n,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length}}}),Ul.prototype=v(Object.create(Ci.prototype),{constructor:Ul,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Bl.prototype=Object.create(Ci.prototype),Bl.prototype.constructor=Bl,Bl.prototype.isCompressedTexture=!0,jl.prototype=Object.create(Ci.prototype),jl.prototype.constructor=jl,jl.prototype.isCanvasTexture=!0,zl.prototype=Object.create(Ci.prototype),zl.prototype.constructor=zl,zl.prototype.isDepthTexture=!0,new Li,new Li,new Li,new $n;const Vl={triangulate:function(e,t,i){i=i||2;const n=t&&t.length,r=n?t[0]*i:e.length;let s=Hl(e,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,u,c,h,d,p;if(n&&(s=Ql(e,t,s,i)),e.length>80*i){o=u=e[0],l=c=e[1];for(let t=i;t<r;t+=i)h=e[t],d=e[t+1],h<o&&(o=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);p=Math.max(u-o,c-l),p=0!==p?1/p:0}return Gl(s,a,i,o,l,p),a}};function Hl(e,t,i,n,r){let s,a;if(r===_u(e,t,i,n)>0)for(s=t;s<i;s+=n)a=gu(s,e[s],e[s+1],a);else for(s=i-n;s>=t;s-=n)a=gu(s,e[s],e[s+1],a);return a&&lu(a,a.next)&&(yu(a),a=a.next),a}function ql(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!lu(n,n.next)&&0!==ou(n.prev,n,n.next))n=n.next;else{if(yu(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function Gl(e,t,i,n,r,s,a){if(!e)return;!a&&s&&tu(e,n,r,s);let o,l,u=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?$l(e,n,r,s):Wl(e))t.push(o.i/i),t.push(e.i/i),t.push(l.i/i),yu(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?Gl(e=Xl(ql(e),t,i),t,i,n,r,s,2):2===a&&Yl(e,t,i,n,r,s):Gl(ql(e),t,i,n,r,s,1);break}}function Wl(e){const t=e.prev,i=e,n=e.next;if(ou(t,i,n)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(su(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&ou(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function $l(e,t,i,n){const r=e.prev,s=e,a=e.next;if(ou(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,u=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,c=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,h=nu(o,l,t,i,n),d=nu(u,c,t,i,n);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&su(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&ou(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&su(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&ou(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&su(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&ou(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&su(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&ou(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Xl(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!lu(r,s)&&uu(r,n,n.next,s)&&pu(r,s)&&pu(s,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(s.i/i),yu(n),yu(n.next),n=e=s),n=n.next}while(n!==e);return ql(n)}function Yl(e,t,i,n,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&au(a,e)){let o=mu(a,e);return a=ql(a,a.next),o=ql(o,o.next),Gl(a,t,i,n,r,s),void Gl(o,t,i,n,r,s)}e=e.next}a=a.next}while(a!==e)}function Ql(e,t,i,n){const r=[];let s,a,o,l,u;for(s=0,a=t.length;s<a;s++)o=t[s]*n,l=s<a-1?t[s+1]*n:e.length,u=Hl(e,o,l,n,!1),u===u.next&&(u.steiner=!0),r.push(ru(u));for(r.sort(Kl),s=0;s<r.length;s++)Zl(r[s],i),i=ql(i,i.next);return i}function Kl(e,t){return e.x-t.x}function Zl(e,t){if(t=Jl(e,t)){const i=mu(t,e);ql(t,t.next),ql(i,i.next)}}function Jl(e,t){let i=t;const n=e.x,r=e.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>a){if(a=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===a)return s;const o=s,l=s.x,u=s.y;let c,h=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&su(r<u?n:a,r,l,u,r<u?a:n,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(n-i.x),pu(i,e)&&(c<h||c===h&&(i.x>s.x||i.x===s.x&&eu(s,i)))&&(s=i,h=c)),i=i.next}while(i!==o);return s}function eu(e,t){return ou(e.prev,e,t.prev)<0&&ou(t.next,e,e.next)<0}function tu(e,t,i,n){let r=e;do{null===r.z&&(r.z=nu(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,iu(r)}function iu(e){let t,i,n,r,s,a,o,l,u=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,n=i,o=0,t=0;t<u&&(o++,n=n.nextZ,n);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,u*=2}while(a>1);return e}function nu(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ru(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function su(e,t,i,n,r,s,a,o){return(r-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(n-o)-(i-a)*(t-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function au(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!du(e,t)&&(pu(e,t)&&pu(t,e)&&fu(e,t)&&(ou(e.prev,e,t.prev)||ou(e,t.prev,t))||lu(e,t)&&ou(e.prev,e,e.next)>0&&ou(t.prev,t,t.next)>0)}function ou(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function lu(e,t){return e.x===t.x&&e.y===t.y}function uu(e,t,i,n){const r=hu(ou(e,t,i)),s=hu(ou(e,t,n)),a=hu(ou(i,n,e)),o=hu(ou(i,n,t));return r!==s&&a!==o||!(0!==r||!cu(e,i,t))||!(0!==s||!cu(e,n,t))||!(0!==a||!cu(i,e,n))||!(0!==o||!cu(i,t,n))}function cu(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function hu(e){return e>0?1:e<0?-1:0}function du(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&uu(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function pu(e,t){return ou(e.prev,e,e.next)<0?ou(e,t,e.next)>=0&&ou(e,e.prev,t)>=0:ou(e,t,e.prev)<0||ou(e,e.next,t)<0}function fu(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}function mu(e,t){const i=new vu(e.i,e.x,e.y),n=new vu(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function gu(e,t,i,n){const r=new vu(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function yu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vu(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _u(e,t,i,n){let r=0;for(let s=t,a=i-n;s<i;s+=n)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}const bu={area:function(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},isClockWise:function(e){return bu.area(e)<0},triangulateShape:function(e,t){const i=[],n=[],r=[];Tu(e),Su(i,e);let s=e.length;t.forEach(Tu);for(let o=0;o<t.length;o++)n.push(s),s+=t[o].length,Su(i,t[o]);const a=Vl.triangulate(i,n);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}};function Tu(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Su(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class wu extends Mr{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let a=0,o=e.length;a<o;a++)s(e[a]);function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:c-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:xu;void 0!==t.amount&&(l=t.amount);let g,y,v,_,b,T=!1;f&&(g=f.getSpacedPoints(o),T=!0,u=!1,y=f.computeFrenetFrames(o,!1),v=new Li,_=new Li,b=new Li),u||(p=0,c=0,h=0,d=0);const S=e.extractPoints(a);let w=S.shape;const x=S.holes;if(!bu.isClockWise(w)){w=w.reverse();for(let e=0,t=x.length;e<t;e++){const t=x[e];bu.isClockWise(t)&&(x[e]=t.reverse())}}const A=bu.triangulateShape(w,x),E=w;for(let t=0,i=x.length;t<i;t++){const e=x[t];w=w.concat(e)}function C(e,t,i){return t.clone().multiplyScalar(i).add(e)}const M=w.length,k=A.length;function I(e,t,i){let n,r,s;const a=e.x-t.x,o=e.y-t.y,l=i.x-e.x,u=i.y-e.y,c=a*a+o*o,h=a*u-o*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(c),d=Math.sqrt(l*l+u*u),p=t.x-o/h,f=t.y+a/h,m=((i.x-u/d-p)*u-(i.y+l/d-f)*l)/(a*u-o*l);n=p+a*m-e.x,r=f+o*m-e.y;const g=n*n+r*r;if(g<=2)return new Si(n,r);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(u)&&(e=!0),e?(n=-o,r=a,s=Math.sqrt(c)):(n=a,r=o,s=Math.sqrt(c/2))}return new Si(n/s,r/s)}const P=[];for(let t=0,i=E.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),P[t]=I(E[t],E[n],E[r]);const L=[];let D,O=P.concat();for(let t=0,i=x.length;t<i;t++){const e=x[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=I(e[t],e[n],e[r]);L.push(D),O=O.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=E.length;t<r;t++){const e=C(E[t],P[t],n);B(e.x,e.y,-i)}for(let t=0,r=x.length;t<r;t++){const e=x[t];D=L[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],D[t],n);B(r.x,r.y,-i)}}}const R=h+d;for(let t=0;t<M;t++){const e=u?C(w[t],O[t],R):w[t];T?(_.copy(y.normals[0]).multiplyScalar(e.x),v.copy(y.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(_).add(v),B(b.x,b.y,b.z)):B(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<M;e++){const i=u?C(w[e],O[e],R):w[e];T?(_.copy(y.normals[t]).multiplyScalar(i.x),v.copy(y.binormals[t]).multiplyScalar(i.y),b.copy(g[t]).add(_).add(v),B(b.x,b.y,b.z)):B(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=E.length;t<r;t++){const e=C(E[t],P[t],n);B(e.x,e.y,l+i)}for(let t=0,r=x.length;t<r;t++){const e=x[t];D=L[t];for(let t=0,r=e.length;t<r;t++){const r=C(e[t],D[t],n);T?B(r.x,r.y+g[o-1].y,g[o-1].x+i):B(r.x,r.y,l+i)}}}function N(){const e=n.length/3;if(u){let e=0,t=M*e;for(let i=0;i<k;i++){const e=A[i];j(e[2]+t,e[1]+t,e[0]+t)}e=o+2*p,t=M*e;for(let i=0;i<k;i++){const e=A[i];j(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<k;e++){const t=A[e];j(t[2],t[1],t[0])}for(let e=0;e<k;e++){const t=A[e];j(t[0]+M*o,t[1]+M*o,t[2]+M*o)}}i.addGroup(e,n.length/3-e,0)}function F(){const e=n.length/3;let t=0;U(E,t),t+=E.length;for(let i=0,n=x.length;i<n;i++){const e=x[i];U(e,t),t+=e.length}i.addGroup(e,n.length/3-e,1)}function U(e,t){let i=e.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=e.length-1);for(let e=0,i=o+2*p;e<i;e++){const i=M*e,s=M*(e+1);z(t+n+i,t+r+i,t+r+s,t+n+s)}}}function B(e,t,i){s.push(e),s.push(t),s.push(i)}function j(e,t,r){V(e),V(t),V(r);const s=n.length/3,a=m.generateTopUV(i,n,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[2])}function z(e,t,r,s){V(e),V(t),V(s),V(t),V(r),V(s);const a=n.length/3,o=m.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function V(e){n.push(s[3*e+0]),n.push(s[3*e+1]),n.push(s[3*e+2])}function H(e){r.push(e.x),r.push(e.y)}N(),F()}this.setAttribute("position",new gr(n,3)),this.setAttribute("uv",new gr(r,2)),this.computeVertexNormals()}toJSON(){const e=Mr.prototype.toJSON.call(this);return Au(this.parameters.shapes,this.parameters.options,e)}}const xu={generateTopUV:function(e,t,i,n,r){const s=t[3*i],a=t[3*i+1],o=t[3*n],l=t[3*n+1],u=t[3*r],c=t[3*r+1];return[new Si(s,a),new Si(o,l),new Si(u,c)]},generateSideWallUV:function(e,t,i,n,r,s){const a=t[3*i],o=t[3*i+1],l=t[3*i+2],u=t[3*n],c=t[3*n+1],h=t[3*n+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*s],g=t[3*s+1],y=t[3*s+2];return Math.abs(o-c)<.01?[new Si(a,1-l),new Si(u,1-h),new Si(d,1-f),new Si(m,1-y)]:[new Si(o,1-l),new Si(c,1-h),new Si(p,1-f),new Si(g,1-y)]}};function Au(e,t,i){if(i.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const t=e[n];i.shapes.push(t.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Eu(e,t,i){Mr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};const n=[],r=[],s=[],a=[],o=1e-5,l=new Li,u=new Li,c=new Li,h=new Li,d=new Li;e.length;const p=t+1;for(let f=0;f<=i;f++){const n=f/i;for(let i=0;i<=t;i++){const p=i/t;e(p,n,u),r.push(u.x,u.y,u.z),p-o>=0?(e(p-o,n,c),h.subVectors(u,c)):(e(p+o,n,c),h.subVectors(c,u)),n-o>=0?(e(p,n-o,c),d.subVectors(u,c)):(e(p,n+o,c),d.subVectors(c,u)),l.crossVectors(h,d).normalize(),s.push(l.x,l.y,l.z),a.push(p,n)}}for(let f=0;f<i;f++)for(let e=0;e<t;e++){const t=f*p+e,i=f*p+e+1,r=(f+1)*p+e+1,s=(f+1)*p+e;n.push(t,i,s),n.push(i,r,s)}this.setIndex(n),this.setAttribute("position",new gr(r,3)),this.setAttribute("normal",new gr(s,3)),this.setAttribute("uv",new gr(a,2))}Eu.prototype=Object.create(Mr.prototype),Eu.prototype.constructor=Eu;class Cu extends Mr{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let u=0;u<e.length;u++)l(e[u]),this.addGroup(a,o,u),a+=o,o=0;function l(e){const a=n.length/3,l=e.extractPoints(t);let u=l.shape;const c=l.holes;!1===bu.isClockWise(u)&&(u=u.reverse());for(let t=0,i=c.length;t<i;t++){const e=c[t];!0===bu.isClockWise(e)&&(c[t]=e.reverse())}const h=bu.triangulateShape(u,c);for(let t=0,i=c.length;t<i;t++){const e=c[t];u=u.concat(e)}for(let t=0,i=u.length;t<i;t++){const e=u[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,n=h.length;t<n;t++){const e=h[t],n=e[0]+a,r=e[1]+a,s=e[2]+a;i.push(n,r,s),o+=3}}this.setIndex(i),this.setAttribute("position",new gr(n,3)),this.setAttribute("normal",new gr(r,3)),this.setAttribute("uv",new gr(s,2))}toJSON(){const e=Mr.prototype.toJSON.call(this);return Mu(this.parameters.shapes,e)}}function Mu(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class ku extends Mr{constructor(e=1,t=8,i=6,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const u=[],c=new Li,h=new Li,d=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){const d=[],y=g/i;let v=0;0==g&&0==s?v=.5/t:g==i&&o==Math.PI&&(v=-.5/t);for(let i=0;i<=t;i++){const o=i/t;c.x=-e*Math.cos(n+o*r)*Math.sin(s+y*a),c.y=e*Math.cos(s+y*a),c.z=e*Math.sin(n+o*r)*Math.sin(s+y*a),p.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),m.push(o+v,1-y),d.push(l++)}u.push(d)}for(let g=0;g<i;g++)for(let e=0;e<t;e++){const t=u[g][e+1],n=u[g][e],r=u[g+1][e],a=u[g+1][e+1];(0!==g||s>0)&&d.push(t,n,a),(g!==i-1||o<Math.PI)&&d.push(n,r,a)}this.setIndex(d),this.setAttribute("position",new gr(p,3)),this.setAttribute("normal",new gr(f,3)),this.setAttribute("uv",new gr(m,2))}}function Iu(e){nr.call(this),this.type="ShadowMaterial",this.color=new er(0),this.transparent=!0,this.setValues(e)}function Pu(e){ts.call(this,e),this.type="RawShaderMaterial"}function Lu(e){nr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new er(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=hi,this.normalScale=new Si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Du(e){Lu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Si(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Ti.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Ou(e){nr.call(this),this.type="MeshPhongMaterial",this.color=new er(16777215),this.specular=new er(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=hi,this.normalScale=new Si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=oe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ru(e){nr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new er(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=hi,this.normalScale=new Si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Nu(e){nr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=hi,this.normalScale=new Si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Fu(e){nr.call(this),this.type="MeshLambertMaterial",this.color=new er(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new er(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=oe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Uu(e){nr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new er(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=hi,this.normalScale=new Si(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Bu(e){bl.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Iu.prototype=Object.create(nr.prototype),Iu.prototype.constructor=Iu,Iu.prototype.isShadowMaterial=!0,Iu.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this},Pu.prototype=Object.create(ts.prototype),Pu.prototype.constructor=Pu,Pu.prototype.isRawShaderMaterial=!0,Lu.prototype=Object.create(nr.prototype),Lu.prototype.constructor=Lu,Lu.prototype.isMeshStandardMaterial=!0,Lu.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Du.prototype=Object.create(Lu.prototype),Du.prototype.constructor=Du,Du.prototype.isMeshPhysicalMaterial=!0,Du.prototype.copy=function(e){return Lu.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new er).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Ou.prototype=Object.create(nr.prototype),Ou.prototype.constructor=Ou,Ou.prototype.isMeshPhongMaterial=!0,Ou.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ru.prototype=Object.create(nr.prototype),Ru.prototype.constructor=Ru,Ru.prototype.isMeshToonMaterial=!0,Ru.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Nu.prototype=Object.create(nr.prototype),Nu.prototype.constructor=Nu,Nu.prototype.isMeshNormalMaterial=!0,Nu.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Fu.prototype=Object.create(nr.prototype),Fu.prototype.constructor=Fu,Fu.prototype.isMeshLambertMaterial=!0,Fu.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Uu.prototype=Object.create(nr.prototype),Uu.prototype.constructor=Uu,Uu.prototype.isMeshMatcapMaterial=!0,Uu.prototype.copy=function(e){return nr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Bu.prototype=Object.create(bl.prototype),Bu.prototype.constructor=Bu,Bu.prototype.isLineDashedMaterial=!0,Bu.prototype.copy=function(e){return bl.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ju=Object.freeze({__proto__:null,ShadowMaterial:Iu,SpriteMaterial:jo,RawShaderMaterial:Pu,ShaderMaterial:ts,PointsMaterial:Pl,MeshPhysicalMaterial:Du,MeshStandardMaterial:Lu,MeshPhongMaterial:Ou,MeshToonMaterial:Ru,MeshNormalMaterial:Nu,MeshLambertMaterial:Fu,MeshDepthMaterial:bo,MeshDistanceMaterial:To,MeshBasicMaterial:rr,MeshMatcapMaterial:Uu,LineDashedMaterial:Bu,LineBasicMaterial:bl,Material:nr});const zu={arraySlice:function(e,t,i){return zu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,i){return e[t]-e[i]}const i=e.length,n=new Array(i);for(let r=0;r!==i;++r)n[r]=r;return n.sort(t),n},sortedArray:function(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[a++]=e[n+i]}return r},flattenJSON:function(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(t.push(s.time),i.push.apply(i,a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(t.push(s.time),a.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(t.push(s.time),i.push(a)),s=e[r++]}while(void 0!==s)},subclip:function(e,t,i,n,r=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const e=s.tracks[l],t=e.getValueSize(),o=[],u=[];for(let s=0;s<e.times.length;++s){const a=e.times[s]*r;if(!(a<i||a>=n)){o.push(e.times[s]);for(let i=0;i<t;++i)u.push(e.values[s*t+i])}}0!==o.length&&(e.times=zu.convertArray(o,e.times.constructor),e.values=zu.convertArray(u,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const r=i.tracks.length,s=t/n;for(let a=0;a<r;++a){const t=i.tracks[a],n=t.ValueTypeName;if("bool"===n||"string"===n)continue;const r=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===n});if(void 0===r)continue;let o=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let u=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);const h=t.times.length-1;let d;if(s<=t.times[0]){const e=o,i=l-o;d=zu.arraySlice(t.values,e,i)}else if(s>=t.times[h]){const e=h*l+o,i=e+l-o;d=zu.arraySlice(t.values,e,i)}else{const e=t.createInterpolant(),i=o,n=l-o;e.evaluate(s),d=zu.arraySlice(e.resultBuffer,i,n)}"quaternion"===n&&(new Pi).fromArray(d).normalize().conjugate().toArray(d);const p=r.times.length;for(let e=0;e<p;++e){const t=e*c+u;if("quaternion"===n)Pi.multiplyQuaternionsFlat(r.values,t,d,0,r.values,t);else{const e=c-2*u;for(let i=0;i<e;++i)r.values[t+i]-=d[i]}}}return e.blendMode=Jt,e}};function Vu(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Hu(e,t,i,n){Vu.call(this,e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function qu(e,t,i,n){Vu.call(this,e,t,i,n)}function Gu(e,t,i,n){Vu.call(this,e,t,i,n)}function Wu(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=zu.convertArray(t,this.TimeBufferType),this.values=zu.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function $u(e,t,i){Wu.call(this,e,t,i)}function Xu(e,t,i,n){Wu.call(this,e,t,i,n)}function Yu(e,t,i,n){Wu.call(this,e,t,i,n)}function Qu(e,t,i,n){Vu.call(this,e,t,i,n)}function Ku(e,t,i,n){Wu.call(this,e,t,i,n)}function Zu(e,t,i,n){Wu.call(this,e,t,i,n)}function Ju(e,t,i,n){Wu.call(this,e,t,i,n)}function ec(e,t=-1,i,n=Zt){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Ti.generateUUID(),this.duration<0&&this.resetDuration()}function tc(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Yu;case"vector":case"vector2":case"vector3":case"vector4":return Ju;case"color":return Xu;case"quaternion":return Ku;case"bool":case"boolean":return $u;case"string":return Zu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function ic(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=tc(e.type);if(void 0===e.times){const t=[],i=[];zu.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}v(Vu.prototype,{evaluate:function(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,r)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0;break i}break e}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let s=0;s!==n;++s)t[s]=i[r+s];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),v(Vu.prototype,{beforeStart_:Vu.prototype.copySampleValue_,afterEnd_:Vu.prototype.copySampleValue_}),Hu.prototype=v(Object.create(Vu.prototype),{constructor:Hu,DefaultSettings_:{endingStart:Yt,endingEnd:Yt},intervalChanged_:function(e,t,i){const n=this.parameterPositions;let r=e-2,s=e+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case Qt:r=e,a=2*t-i;break;case Kt:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case Qt:s=e,o=2*i-t;break;case Kt:s=1,o=i+n[1]-n[0];break;default:s=e-1,o=t}const l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=r*u,this._offsetNext=s*u},interpolate_:function(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let b=0;b!==a;++b)r[b]=g*s[u+b]+y*s[l+b]+v*s[o+b]+_*s[c+b];return r}}),qu.prototype=v(Object.create(Vu.prototype),{constructor:qu,interpolate_:function(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=(i-t)/(n-t),c=1-u;for(let h=0;h!==a;++h)r[h]=s[l+h]*c+s[o+h]*u;return r}}),Gu.prototype=v(Object.create(Vu.prototype),{constructor:Gu,interpolate_:function(e){return this.copySampleValue_(e-1)}}),v(Wu,{toJSON:function(e){const t=e.constructor;let i;if(void 0!==t.toJSON)i=t.toJSON(e);else{i={name:e.name,times:zu.convertArray(e.times,Array),values:zu.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}}),v(Wu.prototype,{constructor:Wu,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:$t,InterpolantFactoryMethodDiscrete:function(e){return new Gu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new qu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Hu(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case Wt:t=this.InterpolantFactoryMethodDiscrete;break;case $t:t=this.InterpolantFactoryMethodLinear;break;case Xt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Wt;case this.InterpolantFactoryMethodLinear:return $t;case this.InterpolantFactoryMethodSmooth:return Xt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this},trim:function(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=zu.arraySlice(i,r,s),this.values=zu.arraySlice(this.values,r*e,s*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(e=!1);let s=null;for(let a=0;a!==r;a++){const t=i[a];if("number"==typeof t&&isNaN(t)){e=!1;break}if(null!==s&&s>t){e=!1;break}s=t}if(void 0!==n&&zu.isTypedArray(n))for(let a=0,o=n.length;a!==o;++a){const t=n[a];if(isNaN(t)){e=!1;break}}return e},optimize:function(){const e=zu.arraySlice(this.times),t=zu.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Xt,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(n)r=!0;else{const e=a*i,n=e-i,s=e+i;for(let a=0;a!==i;++a){const i=t[e+a];if(i!==t[n+a]||i!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const n=a*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,a=0;a!==i;++a)t[n+a]=t[e+a];++s}return s!==e.length?(this.times=zu.arraySlice(e,0,s),this.values=zu.arraySlice(t,0,s*i)):(this.times=e,this.values=t),this},clone:function(){const e=zu.arraySlice(this.times,0),t=zu.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),$u.prototype=v(Object.create(Wu.prototype),{constructor:$u,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Wt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Xu.prototype=v(Object.create(Wu.prototype),{constructor:Xu,ValueTypeName:"color"}),Yu.prototype=v(Object.create(Wu.prototype),{constructor:Yu,ValueTypeName:"number"}),Qu.prototype=v(Object.create(Vu.prototype),{constructor:Qu,interpolate_:function(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(n-t);let l=e*a;for(let u=l+a;l!==u;l+=4)Pi.slerpFlat(r,0,s,l-a,s,l,o);return r}}),Ku.prototype=v(Object.create(Wu.prototype),{constructor:Ku,ValueTypeName:"quaternion",DefaultInterpolation:$t,InterpolantFactoryMethodLinear:function(e){return new Qu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Zu.prototype=v(Object.create(Wu.prototype),{constructor:Zu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Wt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ju.prototype=v(Object.create(Wu.prototype),{constructor:Ju,ValueTypeName:"vector"}),v(ec,{parse:function(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(ic(i[s]).scale(n));const r=new ec(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r},toJSON:function(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=i.length;r!==s;++r)t.push(Wu.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(e,t,i,n){const r=t.length,s=[];for(let a=0;a<r;a++){let e=[],o=[];e.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);const l=zu.getKeyframeOrder(e);e=zu.sortedArray(e,1,l),o=zu.sortedArray(o,1,l),n||0!==e[0]||(e.push(r),o.push(o[0])),s.push(new Yu(".morphTargetInfluences["+t[a].name+"]",e,o).scale(1/i))}return new ec(e,-1,s)},findByName:function(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){const t=e[a],i=t.name.match(r);if(i&&i.length>1){const e=i[1];let r=n[e];r||(n[e]=r=[]),r.push(t)}}const s=[];for(const a in n)s.push(ec.CreateFromMorphTargetSequence(a,n[a],t,i));return s},parseAnimation:function(e,t){if(!e)return null;const i=function(e,t,i,n,r){if(0!==i.length){const s=[],a=[];zu.flattenJSON(i,s,a,n),0!==s.length&&r.push(new e(t,s,a))}},n=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let u=0;u<l.length;u++){const e=l[u].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let i;for(i=0;i<e.length;i++)if(e[i].morphTargets)for(let n=0;n<e[i].morphTargets.length;n++)t[e[i].morphTargets[n]]=-1;for(const r in t){const t=[],s=[];for(let n=0;n!==e[i].morphTargets.length;++n){const n=e[i];t.push(n.time),s.push(n.morphTarget===r?1:0)}n.push(new Yu(".morphTargetInfluence["+r+"]",t,s))}o=t.length*s}else{const r=".bones["+t[u].name+"]";i(Ju,r+".position",e,"pos",n),i(Ku,r+".quaternion",e,"rot",n),i(Ju,r+".scale",e,"scl",n)}}return 0===n.length?null:new ec(r,o,n,a)}}),v(ec.prototype,{resetDuration:function(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new ec(this.name,this.duration,e,this.blendMode)},toJSON:function(){return ec.toJSON(this)}});const nc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function rc(e,t,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===s&&void 0!==n.onStart&&n.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}const sc=new rc;function ac(e){this.manager=void 0!==e?e:sc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}v(ac.prototype,{load:function(){},loadAsync:function(e,t){const i=this;return new Promise(function(n,r){i.load(e,n,t,r)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const oc={};function lc(e){ac.call(this,e)}function uc(e){ac.call(this,e)}function cc(e){ac.call(this,e)}function hc(e){ac.call(this,e)}function dc(e){ac.call(this,e)}function pc(e){ac.call(this,e)}function fc(e){ac.call(this,e)}function mc(){this.type="Curve",this.arcLengthDivisions=200}function gc(e,t,i,n,r,s,a,o){mc.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=a||!1,this.aRotation=o||0}function yc(e,t,i,n,r,s){gc.call(this,e,t,i,i,n,r,s),this.type="ArcCurve"}function vc(){let e=0,t=0,i=0,n=0;function r(r,s,a,o){e=r,t=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,a,o){let l=(t-e)/s-(i-e)/(s+a)+(i-t)/a,u=(i-t)/a-(n-t)/(a+o)+(n-i)/o;l*=a,u*=a,r(t,i,l,u)},calc:function(r){const s=r*r;return e+t*r+i*s+n*(s*r)}}}lc.prototype=v(Object.create(ac.prototype),{constructor:lc,load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=nc.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;if(void 0!==oc[e])return void oc[e].push({onLoad:t,onProgress:i,onError:n});const a=/^data:(.*?)(;base64)?,(.*)$/,o=e.match(a);let l;if(o){const i=o[1],s=!!o[2];let a=o[3];a=decodeURIComponent(a),s&&(a=atob(a));try{let n;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let i=0;i<a.length;i++)e[i]=a.charCodeAt(i);n="blob"===s?new Blob([e.buffer],{type:i}):e.buffer;break;case"document":const t=new DOMParser;n=t.parseFromString(a,i);break;case"json":n=JSON.parse(a);break;default:n=a}setTimeout(function(){t&&t(n),r.manager.itemEnd(e)},0)}catch(u){setTimeout(function(){n&&n(u),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{oc[e]=[],oc[e].push({onLoad:t,onProgress:i,onError:n}),l=new XMLHttpRequest,l.open("GET",e,!0),l.addEventListener("load",function(t){const i=this.response,n=oc[e];if(delete oc[e],200===this.status||0===this.status){this.status,nc.add(e,i);for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onLoad&&t.onLoad(i)}r.manager.itemEnd(e)}else{for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),l.addEventListener("progress",function(t){const i=oc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onProgress&&n.onProgress(t)}},!1),l.addEventListener("error",function(t){const i=oc[e];delete oc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),l.addEventListener("abort",function(t){const i=oc[e];delete oc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(l.responseType=this.responseType),void 0!==this.withCredentials&&(l.withCredentials=this.withCredentials),l.overrideMimeType&&l.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)l.setRequestHeader(e,this.requestHeader[e]);l.send(null)}return r.manager.itemStart(e),l},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),uc.prototype=v(Object.create(ac.prototype),{constructor:uc,load:function(e,t,i,n){const r=this,s=new lc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(i){try{t(r.parse(JSON.parse(i)))}catch(s){n&&n(s),r.manager.itemError(e)}},i,n)},parse:function(e){const t=[];for(let i=0;i<e.length;i++){const n=ec.parse(e[i]);t.push(n)}return t}}),cc.prototype=v(Object.create(ac.prototype),{constructor:cc,load:function(e,t,i,n){const r=this,s=[],a=new Bl,o=new lc(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function u(u){o.load(e[u],function(e){const i=r.parse(e,!0);s[u]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=ke),a.image=s,a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,n)}if(Array.isArray(e))for(let c=0,h=e.length;c<h;++c)u(c);else o.load(e,function(e){const i=r.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)s[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),s[t].format=i.format,s[t].width=i.width,s[t].height=i.height}a.image=s}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=ke),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,n);return a}}),hc.prototype=v(Object.create(ac.prototype),{constructor:hc,load:function(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=nc.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),nc.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}),dc.prototype=v(Object.create(ac.prototype),{constructor:dc,load:function(e,t,i,n){const r=new os,s=new hc(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(i){s.load(e[i],function(e){r.images[i]=e,a++,6===a&&(r.needsUpdate=!0,t&&t(r))},void 0,n)}for(let l=0;l<e.length;++l)o(l);return r}}),pc.prototype=v(Object.create(ac.prototype),{constructor:pc,load:function(e,t,i,n){const r=this,s=new us,a=new lc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(e){const i=r.parse(e);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:xe,s.wrapT=void 0!==i.wrapT?i.wrapT:xe,s.magFilter=void 0!==i.magFilter?i.magFilter:ke,s.minFilter=void 0!==i.minFilter?i.minFilter:ke,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=Pe),1===i.mipmapCount&&(s.minFilter=ke),s.needsUpdate=!0,t&&t(s,i))},i,n),s}}),fc.prototype=v(Object.create(ac.prototype),{constructor:fc,load:function(e,t,i,n){const r=new Ci,s=new hc(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(i){r.image=i;const n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=n?Ge:We,r.needsUpdate=!0,void 0!==t&&t(r)},i,n),r}}),v(mc.prototype,{getPoint:function(){return null},getPointAt:function(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const i=this.getLengths();let n=0;const r=i.length;let s;s=t||e*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const u=i[n];return(n+(s-u)/(i[n+1]-u))/(r-1)},getTangent:function(e,t){const i=1e-4;let n=e-i,r=e+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),a=this.getPoint(r),o=t||(s.isVector2?new Si:new Li);return o.copy(a).sub(s).normalize(),o},getTangentAt:function(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){const i=new Li,n=[],r=[],s=[],a=new Li,o=new on;for(let d=0;d<=e;d++){const t=d/e;n[d]=this.getTangentAt(t,new Li),n[d].normalize()}r[0]=new Li,s[0]=new Li;let l=Number.MAX_VALUE;const u=Math.abs(n[0].x),c=Math.abs(n[0].y),h=Math.abs(n[0].z);u<=l&&(l=u,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(n[d-1],n[d]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Ti.clamp(n[d-1].dot(n[d]),-1,1));r[d].applyMatrix4(o.makeRotationAxis(a,e))}s[d].crossVectors(n[d],r[d])}if(!0===t){let t=Math.acos(Ti.clamp(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],t*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),gc.prototype=Object.create(mc.prototype),gc.prototype.constructor=gc,gc.prototype.isEllipseCurve=!0,gc.prototype.getPoint=function(e,t){const i=t||new Si,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+e*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(o,l)},gc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},gc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},gc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},yc.prototype=Object.create(gc.prototype),yc.prototype.constructor=yc,yc.prototype.isArcCurve=!0;const _c=new Li,bc=new vc,Tc=new vc,Sc=new vc;function wc(e=[],t=!1,i="centripetal",n=.5){mc.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}function xc(e,t,i,n,r){const s=.5*(n-t),a=.5*(r-i),o=e*e;return(2*i-2*n+s+a)*(e*o)+(-3*i+3*n-2*s-a)*o+s*e+i}function Ac(e,t){const i=1-e;return i*i*t}function Ec(e,t){return 2*(1-e)*e*t}function Cc(e,t){return e*e*t}function Mc(e,t,i,n){return Ac(e,t)+Ec(e,i)+Cc(e,n)}function kc(e,t){const i=1-e;return i*i*i*t}function Ic(e,t){const i=1-e;return 3*i*i*e*t}function Pc(e,t){return 3*(1-e)*e*e*t}function Lc(e,t){return e*e*e*t}function Dc(e,t,i,n,r){return kc(e,t)+Ic(e,i)+Pc(e,n)+Lc(e,r)}function Oc(e=new Si,t=new Si,i=new Si,n=new Si){mc.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}function Rc(e=new Li,t=new Li,i=new Li,n=new Li){mc.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}function Nc(e=new Si,t=new Si){mc.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function Fc(e=new Li,t=new Li){mc.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function Uc(e=new Si,t=new Si,i=new Si){mc.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}function Bc(e=new Li,t=new Li,i=new Li){mc.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}function jc(e=[]){mc.call(this),this.type="SplineCurve",this.points=e}wc.prototype=Object.create(mc.prototype),wc.prototype.constructor=wc,wc.prototype.isCatmullRomCurve3=!0,wc.prototype.getPoint=function(e,t=new Li){const i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e;let a,o,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===u&&l===r-1&&(l=r-2,u=1),this.closed||l>0?a=n[(l-1)%r]:(_c.subVectors(n[0],n[1]).add(n[0]),a=_c);const c=n[l%r],h=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(_c.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=_c),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(c),e),i=Math.pow(c.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(o),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),bc.initNonuniformCatmullRom(a.x,c.x,h.x,o.x,t,i,n),Tc.initNonuniformCatmullRom(a.y,c.y,h.y,o.y,t,i,n),Sc.initNonuniformCatmullRom(a.z,c.z,h.z,o.z,t,i,n)}else"catmullrom"===this.curveType&&(bc.initCatmullRom(a.x,c.x,h.x,o.x,this.tension),Tc.initCatmullRom(a.y,c.y,h.y,o.y,this.tension),Sc.initCatmullRom(a.z,c.z,h.z,o.z,this.tension));return i.set(bc.calc(u),Tc.calc(u),Sc.calc(u)),i},wc.prototype.copy=function(e){mc.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},wc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},wc.prototype.fromJSON=function(e){mc.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Li).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Oc.prototype=Object.create(mc.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isCubicBezierCurve=!0,Oc.prototype.getPoint=function(e,t=new Si){const i=t,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Dc(e,n.x,r.x,s.x,a.x),Dc(e,n.y,r.y,s.y,a.y)),i},Oc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Oc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Oc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Rc.prototype=Object.create(mc.prototype),Rc.prototype.constructor=Rc,Rc.prototype.isCubicBezierCurve3=!0,Rc.prototype.getPoint=function(e,t=new Li){const i=t,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Dc(e,n.x,r.x,s.x,a.x),Dc(e,n.y,r.y,s.y,a.y),Dc(e,n.z,r.z,s.z,a.z)),i},Rc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Rc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Rc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Nc.prototype=Object.create(mc.prototype),Nc.prototype.constructor=Nc,Nc.prototype.isLineCurve=!0,Nc.prototype.getPoint=function(e,t=new Si){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Nc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Nc.prototype.getTangent=function(e,t){const i=t||new Si;return i.copy(this.v2).sub(this.v1).normalize(),i},Nc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Nc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Nc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Fc.prototype=Object.create(mc.prototype),Fc.prototype.constructor=Fc,Fc.prototype.isLineCurve3=!0,Fc.prototype.getPoint=function(e,t=new Li){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Fc.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Fc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Uc.prototype=Object.create(mc.prototype),Uc.prototype.constructor=Uc,Uc.prototype.isQuadraticBezierCurve=!0,Uc.prototype.getPoint=function(e,t=new Si){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(Mc(e,n.x,r.x,s.x),Mc(e,n.y,r.y,s.y)),i},Uc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Uc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Uc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Bc.prototype=Object.create(mc.prototype),Bc.prototype.constructor=Bc,Bc.prototype.isQuadraticBezierCurve3=!0,Bc.prototype.getPoint=function(e,t=new Li){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set(Mc(e,n.x,r.x,s.x),Mc(e,n.y,r.y,s.y),Mc(e,n.z,r.z,s.z)),i},Bc.prototype.copy=function(e){return mc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Bc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Bc.prototype.fromJSON=function(e){return mc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},jc.prototype=Object.create(mc.prototype),jc.prototype.constructor=jc,jc.prototype.isSplineCurve=!0,jc.prototype.getPoint=function(e,t=new Si){const i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],u=n[s>n.length-2?n.length-1:s+1],c=n[s>n.length-3?n.length-1:s+2];return i.set(xc(a,o.x,l.x,u.x,c.x),xc(a,o.y,l.y,u.y,c.y)),i},jc.prototype.copy=function(e){mc.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this},jc.prototype.toJSON=function(){const e=mc.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e},jc.prototype.fromJSON=function(e){mc.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Si).fromArray(i))}return this};var zc=Object.freeze({__proto__:null,ArcCurve:yc,CatmullRomCurve3:wc,CubicBezierCurve:Oc,CubicBezierCurve3:Rc,EllipseCurve:gc,LineCurve:Nc,LineCurve3:Fc,QuadraticBezierCurve:Uc,QuadraticBezierCurve3:Bc,SplineCurve:jc});function Vc(){mc.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Hc(e){Vc.call(this),this.type="Path",this.currentPoint=new Si,e&&this.setFromPoints(e)}function qc(e){Hc.call(this,e),this.uuid=Ti.generateUUID(),this.type="Shape",this.holes=[]}function Gc(e,t=1){Ln.call(this),this.type="Light",this.color=new er(e),this.intensity=t}function Wc(e,t,i){Gc.call(this,e,i),this.type="HemisphereLight",this.position.copy(Ln.DefaultUp),this.updateMatrix(),this.groundColor=new er(t)}function $c(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Si(512,512),this.map=null,this.mapPass=null,this.matrix=new on,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ds,this._frameExtents=new Si(1,1),this._viewportCount=1,this._viewports=[new ki(0,0,1,1)]}function Xc(){$c.call(this,new ns(50,1,.5,500)),this.focus=1}function Yc(e,t,i,n,r,s){Gc.call(this,e,t),this.type="SpotLight",this.position.copy(Ln.DefaultUp),this.updateMatrix(),this.target=new Ln,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==s?s:1,this.shadow=new Xc}function Qc(){$c.call(this,new ns(90,1,.5,500)),this._frameExtents=new Si(4,2),this._viewportCount=6,this._viewports=[new ki(2,1,1,1),new ki(0,1,1,1),new ki(3,1,1,1),new ki(1,1,1,1),new ki(3,0,1,1),new ki(1,0,1,1)],this._cubeDirections=[new Li(1,0,0),new Li(-1,0,0),new Li(0,0,1),new Li(0,0,-1),new Li(0,1,0),new Li(0,-1,0)],this._cubeUps=[new Li(0,1,0),new Li(0,1,0),new Li(0,1,0),new Li(0,1,0),new Li(0,0,1),new Li(0,0,-1)]}function Kc(e,t,i,n){Gc.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new Qc}function Zc(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){is.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}function Jc(){$c.call(this,new Zc(-5,5,5,-5,.5,500))}function eh(e,t){Gc.call(this,e,t),this.type="DirectionalLight",this.position.copy(Ln.DefaultUp),this.updateMatrix(),this.target=new Ln,this.shadow=new Jc}function th(e,t){Gc.call(this,e,t),this.type="AmbientLight"}function ih(e,t,i,n){Gc.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}Vc.prototype=v(Object.create(mc.prototype),{constructor:Vc,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Nc(t,e))},getPoint:function(e){const t=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=t){const e=i[n]-t,r=this.curves[n],s=r.getLength(),a=0===s?0:1-e/s;return r.getPointAt(a)}n++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s&&s.isEllipseCurve?2*e:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const n=o[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){mc.prototype.copy.call(this,e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=mc.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){mc.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new zc[i.type]).fromJSON(i))}return this}}),Hc.prototype=v(Object.create(Vc.prototype),{constructor:Hc,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const i=new Nc(this.currentPoint.clone(),new Si(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,n){const r=new Uc(this.currentPoint.clone(),new Si(e,t),new Si(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this},bezierCurveTo:function(e,t,i,n,r,s){const a=new Oc(this.currentPoint.clone(),new Si(e,t),new Si(i,n),new Si(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this},splineThru:function(e){const t=new jc([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,n,r,s),this},absarc:function(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this},ellipse:function(e,t,i,n,r,s,a,o){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,i,n,r,s,a,o),this},absellipse:function(e,t,i,n,r,s,a,o){const l=new gc(e,t,i,n,r,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this},copy:function(e){return Vc.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=Vc.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Vc.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),qc.prototype=v(Object.create(Hc.prototype),{constructor:qc,getPointsHoles:function(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Hc.prototype.copy.call(this,e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){const e=Hc.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){Hc.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new Hc).fromJSON(i))}return this}}),Gc.prototype=v(Object.create(Ln.prototype),{constructor:Gc,isLight:!0,copy:function(e){return Ln.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=Ln.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Wc.prototype=v(Object.create(Gc.prototype),{constructor:Wc,isHemisphereLight:!0,copy:function(e){return Gc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),v($c.prototype,{_projScreenMatrix:new on,_lightPositionWorld:new Li,_lookTarget:new Li,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,i=this.matrix,n=this._projScreenMatrix,r=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(e.matrixWorld),t.position.copy(s),r.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Xc.prototype=v(Object.create($c.prototype),{constructor:Xc,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,i=2*Ti.RAD2DEG*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),$c.prototype.updateMatrices.call(this,e)}}),Yc.prototype=v(Object.create(Gc.prototype),{constructor:Yc,isSpotLight:!0,copy:function(e){return Gc.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Qc.prototype=v(Object.create($c.prototype),{constructor:Qc,isPointLightShadow:!0,updateMatrices:function(e,t=0){const i=this.camera,n=this.matrix,r=this._lightPositionWorld,s=this._lookTarget,a=this._projScreenMatrix;r.setFromMatrixPosition(e.matrixWorld),i.position.copy(r),s.copy(i.position),s.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(s),i.updateMatrixWorld(),n.makeTranslation(-r.x,-r.y,-r.z),a.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),Kc.prototype=v(Object.create(Gc.prototype),{constructor:Kc,isPointLight:!0,copy:function(e){return Gc.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Zc.prototype=v(Object.create(is.prototype),{constructor:Zc,isOrthographicCamera:!0,copy:function(e,t){return is.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:v({},e.view),this},setViewOffset:function(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,a=n+t,o=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Ln.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=v({},this.view)),t}}),Jc.prototype=v(Object.create($c.prototype),{constructor:Jc,isDirectionalLightShadow:!0,updateMatrices:function(e){$c.prototype.updateMatrices.call(this,e)}}),eh.prototype=v(Object.create(Gc.prototype),{constructor:eh,isDirectionalLight:!0,copy:function(e){return Gc.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),th.prototype=v(Object.create(Gc.prototype),{constructor:th,isAmbientLight:!0}),ih.prototype=v(Object.create(Gc.prototype),{constructor:ih,isRectAreaLight:!0,copy:function(e){return Gc.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=Gc.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class nh{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Li)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*i),t.addScaledVector(s[4],i*n*1.092548),t.addScaledVector(s[5],n*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],i*r*1.092548),t.addScaledVector(s[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*i),t.addScaledVector(s[4],.858086*i*n),t.addScaledVector(s[5],.858086*n*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*i*r),t.addScaledVector(s[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}function rh(e,t){Gc.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new nh}function sh(e){ac.call(this,e),this.textures={}}rh.prototype=v(Object.create(Gc.prototype),{constructor:rh,isLightProbe:!0,copy:function(e){return Gc.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=Gc.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),sh.prototype=v(Object.create(ac.prototype),{constructor:sh,load:function(e,t,i,n){const r=this,s=new lc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(i){try{t(r.parse(JSON.parse(i)))}catch(s){n&&n(s),r.manager.itemError(e)}},i,n)},parse:function(e){const t=this.textures;function i(e){return t[e],t[e]}const n=new ju[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new er).setHex(e.sheen)),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(n.uniforms[r]={},t.type){case"t":n.uniforms[r].value=i(t.value);break;case"c":n.uniforms[r].value=(new er).setHex(t.value);break;case"v2":n.uniforms[r].value=(new Si).fromArray(t.value);break;case"v3":n.uniforms[r].value=(new Li).fromArray(t.value);break;case"v4":n.uniforms[r].value=(new ki).fromArray(t.value);break;case"m3":n.uniforms[r].value=(new wi).fromArray(t.value);break;case"m4":n.uniforms[r].value=(new on).fromArray(t.value);break;default:n.uniforms[r].value=t.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const r in e.extensions)n.extensions[r]=e.extensions[r];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Si).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Si).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),n},setTextures:function(e){return this.textures=e,this}});const ah={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(i){return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function oh(){Mr.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function lh(e,t,i,n){"number"==typeof i&&(n=i,i=!1),or.call(this,e,t,i),this.meshPerAttribute=n||1}function uh(e){ac.call(this,e)}function ch(e){ac.call(this,e),this.options={premultiplyAlpha:"none"}}function hh(){this.type="ShapePath",this.color=new er,this.subPaths=[],this.currentPath=null}oh.prototype=v(Object.create(Mr.prototype),{constructor:oh,isInstancedBufferGeometry:!0,copy:function(e){return Mr.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=Mr.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),lh.prototype=v(Object.create(or.prototype),{constructor:lh,isInstancedBufferAttribute:!0,copy:function(e){return or.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=or.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),uh.prototype=v(Object.create(ac.prototype),{constructor:uh,load:function(e,t,i,n){const r=this,s=new lc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(i){try{t(r.parse(JSON.parse(i)))}catch(s){n&&n(s),r.manager.itemError(e)}},i,n)},parse:function(e){const t={},i={};function n(e,i){if(void 0!==t[i])return t[i];const n=e.interleavedBuffers[i],s=r(e,n.buffer),a=new Fo(br(n.type,s),n.stride);return a.uuid=n.uuid,t[i]=a,a}function r(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],r=new Uint32Array(n).buffer;return i[t]=r,r}const s=e.isInstancedBufferGeometry?new oh:new Mr,a=e.data.index;if(void 0!==a){const e=br(a.type,a.array);s.setIndex(new or(e,1))}const o=e.data.attributes;for(const h in o){const t=o[h];let i;if(t.isInterleavedBufferAttribute)i=new Bo(n(e.data,t.data),t.itemSize,t.offset,t.normalized);else{const e=br(t.type,t.array);i=new(t.isInstancedBufferAttribute?lh:or)(e,t.itemSize,t.normalized)}void 0!==t.name&&(i.name=t.name),s.setAttribute(h,i)}const l=e.data.morphAttributes;if(l)for(const h in l){const t=l[h],i=[];for(let r=0,s=t.length;r<s;r++){const s=t[r];let a;a=s.isInterleavedBufferAttribute?new Bo(n(e.data,s.data),s.itemSize,s.offset,s.normalized):new or(br(s.type,s.array),s.itemSize,s.normalized),void 0!==s.name&&(a.name=s.name),i.push(a)}s.morphAttributes[h]=i}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==u)for(let h=0,d=u.length;h!==d;++h){const e=u[h];s.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Li;void 0!==c.center&&e.fromArray(c.center),s.boundingSphere=new Ki(e,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}),ch.prototype=v(Object.create(ac.prototype),{constructor:ch,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=nc.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,r.options)}).then(function(i){nc.add(e,i),t&&t(i),r.manager.itemEnd(e)}).catch(function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}),v(hh.prototype,{moveTo:function(e,t){return this.currentPath=new Hc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this},bezierCurveTo:function(e,t,i,n,r,s){return this.currentPath.bezierCurveTo(e,t,i,n,r,s),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i],r=new qc;r.curves=n.curves,t.push(r)}return t}function n(e,t){const i=t.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=t[r],a=t[s],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[s],o=-o,a=t[r],l=-l),e.y<i.y||e.y>a.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-o*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(a.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=a.x)return!0}}return n}const r=bu.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===t)return i(s);let a,o,l;const u=[];if(1===s.length)return o=s[0],l=new qc,l.curves=o.curves,u.push(l),u;let c=!r(s[0].getPoints());c=e?!c:c;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let y=0,v=s.length;y<v;y++)o=s[y],p=o.getPoints(),a=r(p),a=e?!a:a,a?(!c&&d[g]&&g++,d[g]={s:new qc,p:p},d[g].s.curves=o.curves,c&&g++,m[g]=[]):m[g].push({h:o,p:p[0]});if(!d[0])return i(s);if(d.length>1){let e=!1;const t=[];for(let i=0,n=d.length;i<n;i++)h[i]=[];for(let i=0,r=d.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<d.length;r++)n(a.p,d[r].p)&&(i!==r&&t.push({froms:i,tos:r,hole:s}),o?(o=!1,h[r].push(a)):e=!0);o&&h[i].push(a)}}t.length>0&&(e||(m=h))}for(let y=0,v=d.length;y<v;y++){l=d[y].s,u.push(l),f=m[y];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return u}});class dh{constructor(e){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=ph(e,t,this.data);for(let r=0,s=n.length;r<s;r++)Array.prototype.push.apply(i,n[r].toShapes());return i}}function ph(e,t,i){const n=Array.from?Array.from(e):String(e).split(""),r=t/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[];let o=0,l=0;for(let u=0;u<n.length;u++){const e=n[u];if("\n"===e)o=0,l-=s;else{const t=fh(e,r,o,l,i);o+=t.offsetX,a.push(t.path)}}return a}function fh(e,t,i,n,r){const s=r.glyphs[e]||r.glyphs["?"];if(!s)return;const a=new hh;let o,l,u,c,h,d,p,f;if(s.o){const e=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=e.length;r<s;)switch(e[r++]){case"m":o=e[r++]*t+i,l=e[r++]*t+n,a.moveTo(o,l);break;case"l":o=e[r++]*t+i,l=e[r++]*t+n,a.lineTo(o,l);break;case"q":u=e[r++]*t+i,c=e[r++]*t+n,h=e[r++]*t+i,d=e[r++]*t+n,a.quadraticCurveTo(h,d,u,c);break;case"b":u=e[r++]*t+i,c=e[r++]*t+n,h=e[r++]*t+i,d=e[r++]*t+n,p=e[r++]*t+i,f=e[r++]*t+n,a.bezierCurveTo(h,d,p,f,u,c)}}return{offsetX:s.ha*t,path:a}}function mh(e){ac.call(this,e)}let gh;mh.prototype=v(Object.create(ac.prototype),{constructor:mh,load:function(e,t,i,n){const r=this,s=new lc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(e){let i;try{i=JSON.parse(e)}catch(s){i=JSON.parse(e.substring(65,e.length-2))}const n=r.parse(i);t&&t(n)},i,n)},parse:function(e){return new dh(e)}});const yh={getContext:function(){return void 0===gh&&(gh=new(window.AudioContext||window.webkitAudioContext)),gh},setContext:function(e){gh=e}};function vh(e){ac.call(this,e)}function _h(e,t,i){rh.call(this,void 0,i);const n=(new er).set(e),r=(new er).set(t),s=new Li(n.r,n.g,n.b),a=new Li(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}function bh(e,t){rh.call(this,void 0,t);const i=(new er).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}vh.prototype=v(Object.create(ac.prototype),{constructor:vh,load:function(e,t,i,n){const r=this,s=new lc(r.manager);s.setResponseType("arraybuffer"),s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(i){try{const e=i.slice(0);yh.getContext().decodeAudioData(e,function(e){t(e)})}catch(s){n&&n(s),r.manager.itemError(e)}},i,n)}}),_h.prototype=v(Object.create(rh.prototype),{constructor:_h,isHemisphereLightProbe:!0,copy:function(e){return rh.prototype.copy.call(this,e),this},toJSON:function(e){return rh.prototype.toJSON.call(this,e)}}),bh.prototype=v(Object.create(rh.prototype),{constructor:bh,isAmbientLightProbe:!0,copy:function(e){return rh.prototype.copy.call(this,e),this},toJSON:function(e){return rh.prototype.toJSON.call(this,e)}});const Th=new on,Sh=new on;function wh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ns,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ns,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function xh(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}v(wh.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),n=t.eyeSep/2,r=n*t.near/t.focus,s=t.near*Math.tan(Ti.DEG2RAD*t.fov*.5)/t.zoom;let a,o;Sh.elements[12]=-n,Th.elements[12]=n,a=-s*t.aspect+r,o=s*t.aspect+r,i.elements[0]=2*t.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(i),a=-s*t.aspect-r,o=s*t.aspect-r,i.elements[0]=2*t.near/(o-a),i.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Sh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Th)}}),v(xh.prototype,{accumulate:function(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s},accumulateAdditive:function(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,n);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,s=n;r!==s;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,n,r){if(n>=.5)for(let s=0;s!==r;++s)e[t+s]=e[i+s]},_slerp:function(e,t,i,n){Pi.slerpFlat(e,t,e,t,e,i,n)},_slerpAdditive:function(e,t,i,n,r){const s=this._workIndex*r;Pi.multiplyQuaternionsFlat(e,s,e,t,e,i),Pi.slerpFlat(e,t,e,t,e,s,n)},_lerp:function(e,t,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*s+e[i+a]*n}},_lerpAdditive:function(e,t,i,n,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[i+s]*n}}});const Ah="\\[\\]\\.:\\/",Eh=new RegExp("["+Ah+"]","g"),Ch="[^"+Ah+"]",Mh="[^"+Ah.replace("\\.","")+"]",kh=/((?:WC+[\/:])*)/.source.replace("WC",Ch),Ih=/(WCOD+)?/.source.replace("WCOD",Mh),Ph=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ch),Lh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ch),Dh=new RegExp("^"+kh+Ih+Ph+Lh+"$"),Oh=["material","materials","bones"];function Rh(e,t,i){const n=i||Nh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function Nh(e,t,i){this.path=t,this.parsedPath=i||Nh.parseTrackName(t),this.node=Nh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Fh(){this.uuid=Ti.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}v(Rh.prototype,{getValue:function(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),v(Nh,{Composite:Rh,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new Nh.Composite(e,t,i):new Nh(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Eh,"")},parseTrackName:function(e){const t=Dh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==Oh.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}}),v(Nh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]},function(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Nh.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return;if(!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return;e=e[i]}if(void 0!==n){if(void 0===e[n])return;e=e[n]}}const s=e[n];if(void 0===s)return void t.nodeName;let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return;if(!e.geometry.isBufferGeometry)return;if(!e.geometry.morphAttributes)return;void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),v(Nh.prototype,{_getValue_unbound:Nh.prototype.getValue,_setValue_unbound:Nh.prototype.setValue}),v(Fh.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let a,o=e.length,l=this.nCachedObjects_;for(let u=0,c=arguments.length;u!==c;++u){const c=arguments[u],h=c.uuid;let d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(c);for(let e=0,t=s;e!==t;++e)r[e].push(new Nh(c,i[e],n[e]))}else if(d<l){a=e[d];const o=--l,u=e[o];t[u.uuid]=d,e[d]=u,t[h]=o,e[o]=c;for(let e=0,t=s;e!==t;++e){const t=r[e],s=t[o];let a=t[d];t[d]=s,void 0===a&&(a=new Nh(c,i[e],n[e])),t[o]=a}}else e[d]}this.nCachedObjects_=l},remove:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=r){const s=r++,u=e[s];t[u.uuid]=l,e[l]=u,t[o]=s,e[s]=a;for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[s],r=t[l];t[l]=n,t[s]=r}}}this.nCachedObjects_=r},uncache:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<r){const a=--r,o=e[a],u=--s,c=e[u];t[o.uuid]=l,e[l]=o,t[c.uuid]=a,e[a]=c,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[a],r=t[u];t[l]=n,t[a]=r,t.pop()}}else{const r=--s,a=e[r];r>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,u=this.nCachedObjects_,c=new Array(l);n=r.length,i[e]=n,s.push(e),a.push(t),r.push(c);for(let h=u,d=o.length;h!==d;++h){const i=o[h];c[h]=new Nh(i,e,t)}return c},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=i,s[i]=o,s.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}});class Uh{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Yt,endingEnd:Yt};for(let l=0;l!==s;++l){const e=r[l].createInterpolant(null);a[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=qt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const n=(e-r)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Jt)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(s),t[i].accumulateAdditive(a);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(s),t[i].accumulate(n,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const s=i===Gt;if(0===e)return-1===r||!s||1&~r?n:t-n;if(i===Ht){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&!(1&~r))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=Qt,n.endingEnd=Qt):(n.endingStart=e?this.zeroSlopeAtStart?Qt:Yt:Kt,n.endingEnd=t?this.zeroSlopeAtEnd?Qt:Yt:Kt)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=i,this}}function Bh(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function jh(e,t,i){Fo.call(this,e,t),this.meshPerAttribute=i||1}function zh(e,t,i,n,r){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}function Vh(e,t,i,n){this.ray=new an(e,t),this.near=i||0,this.far=n||1/0,this.camera=null,this.layers=new vn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return this.Points}}})}function Hh(e,t){return e.distance-t.distance}function qh(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,r=n.length;e<r;e++)qh(n[e],t,i,!0)}}Bh.prototype=v(Object.create(vi.prototype),{constructor:Bh,_bindAction:function(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let u=l[o];void 0===u&&(u={},l[o]=u);for(let c=0;c!==r;++c){const e=n[c],r=e.name;let l=u[r];if(void 0!==l)s[c]=l;else{if(l=s[c],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}const n=t&&t._propertyBindings[c].binding.parsedPath;l=new xh(Nh.create(i,r,n),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[c]=l}a[c].resultBuffer=l.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){const n=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e},_removeInactiveAction:function(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const e=t[i];0===--e.referenceCount&&this._removeInactiveBinding(e)}},_lendAction:function(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackAction:function(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_addInactiveBinding:function(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]},_lendBinding:function(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackBinding:function(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new qu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){const n=t||this._root,r=n.uuid;let s="string"==typeof e?ec.findByName(n,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:Zt),void 0!==o){const e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const u=new Uh(this,s,t,i);return this._bindAction(u,l),this._addInactiveAction(u,a,r),u},existingAction:function(e,t){const i=t||this._root,n=i.uuid,r="string"==typeof e?ec.findByName(i,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(n,e,r,s);const a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this},setTime:function(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}},uncacheRoot:function(e){const t=e.uuid,i=this._actionsByClip;for(const r in i){const e=i[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const r in n){const e=n[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),jh.prototype=v(Object.create(Fo.prototype),{constructor:jh,isInstancedInterleavedBuffer:!0,copy:function(e){return Fo.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=Fo.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=Fo.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(zh.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),v(zh.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),v(Vh.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)},intersectObject:function(e,t,i){const n=i||[];return qh(e,this,n,t),n.sort(Hh),n},intersectObjects:function(e,t,i){const n=i||[];if(!1===Array.isArray(e))return n;for(let r=0,s=e.length;r<s;r++)qh(e[r],this,n,t);return n.sort(Hh),n}});class Gh{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ti.clamp(t/this.radius,-1,1))),this}}const Wh=new Si;class $h{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Si(1/0,1/0),this.max=void 0!==t?t:new Si(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Wh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(e=new Si),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(e=new Si),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(t=new Si),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(t=new Si),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Wh.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function Xh(e){Ln.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Xh.prototype=Object.create(Ln.prototype),Xh.prototype.constructor=Xh,Xh.prototype.isImmediateRenderObject=!0;const Yh=new rr({side:M,depthWrite:!1,depthTest:!1});function Qh(e){wc.call(this,e),this.type="catmullrom"}new Wr(new Yr,Yh),mc.create=function(e,t){return e.prototype=Object.create(mc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},v(Hc.prototype,{fromPoints:function(e){return this.setFromPoints(e)}}),Qh.prototype=Object.create(wc.prototype),v(Qh.prototype,{initFromArray:function(){},getControlPointsArray:function(){},reparametrizeByArcLength:function(){}}),v(ac.prototype,{extractUrlBase:function(e){return ah.extractUrlBase(e)}}),ac.Handlers={add:function(){},get:function(){}},v($h.prototype,{center:function(e){return this.getCenter(e)},empty:function(){return this.isEmpty()},isIntersectionBox:function(e){return this.intersectsBox(e)},size:function(e){return this.getSize(e)}}),v(Ri.prototype,{center:function(e){return this.getCenter(e)},empty:function(){return this.isEmpty()},isIntersectionBox:function(e){return this.intersectsBox(e)},isIntersectionSphere:function(e){return this.intersectsSphere(e)},size:function(e){return this.getSize(e)}}),v(Ki.prototype,{empty:function(){return this.isEmpty()}}),ds.prototype.setFromMatrix=function(e){return this.setFromProjectionMatrix(e)},v(Ti,{random16:function(){return Math.random()},nearestPowerOfTwo:function(e){return Ti.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return Ti.ceilPowerOfTwo(e)}}),v(wi.prototype,{flattenToArrayOffset:function(e,t){return this.toArray(e,t)},multiplyVector3:function(e){return e.applyMatrix3(this)},multiplyVector3Array:function(){},applyToBufferAttribute:function(e){return e.applyMatrix3(this)},applyToVector3Array:function(){},getInverse:function(e){return this.copy(e).invert()}}),v(on.prototype,{extractPosition:function(e){return this.copyPosition(e)},flattenToArrayOffset:function(e,t){return this.toArray(e,t)},getPosition:function(){return(new Li).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return this.makeRotationFromQuaternion(e)},multiplyToArray:function(){},multiplyVector3:function(e){return e.applyMatrix4(this)},multiplyVector4:function(e){return e.applyMatrix4(this)},multiplyVector3Array:function(){},rotateAxis:function(e){e.transformDirection(this)},crossVector:function(e){return e.applyMatrix4(this)},translate:function(){},rotateX:function(){},rotateY:function(){},rotateZ:function(){},rotateByAxis:function(){},applyToBufferAttribute:function(e){return e.applyMatrix4(this)},applyToVector3Array:function(){},makeFrustum:function(e,t,i,n,r,s){return this.makePerspective(e,t,n,i,r,s)},getInverse:function(e){return this.copy(e).invert()}}),Nn.prototype.isIntersectionLine=function(e){return this.intersectsLine(e)},v(Pi.prototype,{multiplyVector3:function(e){return e.applyQuaternion(this)},inverse:function(){return this.invert()}}),v(an.prototype,{isIntersectionBox:function(e){return this.intersectsBox(e)},isIntersectionPlane:function(e){return this.intersectsPlane(e)},isIntersectionSphere:function(e){return this.intersectsSphere(e)}}),v($n.prototype,{area:function(){return this.getArea()},barycoordFromPoint:function(e,t){return this.getBarycoord(e,t)},midpoint:function(e){return this.getMidpoint(e)},normal:function(e){return this.getNormal(e)},plane:function(e){return this.getPlane(e)}}),v($n,{barycoordFromPoint:function(e,t,i,n,r){return $n.getBarycoord(e,t,i,n,r)},normal:function(e,t,i,n){return $n.getNormal(e,t,i,n)}}),v(qc.prototype,{extractAllPoints:function(e){return this.extractPoints(e)},extrude:function(e){return new wu(this,e)},makeGeometry:function(e){return new Cu(this,e)}}),v(Si.prototype,{fromAttribute:function(e,t,i){return this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return this.manhattanDistanceTo(e)},lengthManhattan:function(){return this.manhattanLength()}}),v(Li.prototype,{setEulerFromRotationMatrix:function(){},setEulerFromQuaternion:function(){},getPositionFromMatrix:function(e){return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return this.setFromMatrixColumn(t,e)},applyProjection:function(e){return this.applyMatrix4(e)},fromAttribute:function(e,t,i){return this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return this.manhattanDistanceTo(e)},lengthManhattan:function(){return this.manhattanLength()}}),v(ki.prototype,{fromAttribute:function(e,t,i){return this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return this.manhattanLength()}}),v(Ln.prototype,{getChildByName:function(e){return this.getObjectByName(e)},renderDepth:function(){},translate:function(e,t){return this.translateOnAxis(t,e)},getWorldRotation:function(){},applyMatrix:function(e){return this.applyMatrix4(e)}}),Object.defineProperties(Ln.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(e){this.rotation.order=e}},useQuaternion:{get:function(){},set:function(){}}}),v(Wr.prototype,{setDrawMode:function(){}}),Object.defineProperties(Wr.prototype,{drawMode:{get:function(){return ei},set:function(){}}}),Object.defineProperties(rl.prototype,{objects:{get:function(){return this.levels}}}),Object.defineProperty(fl.prototype,"useVertexTexture",{get:function(){},set:function(){}}),cl.prototype.initBones=function(){},Object.defineProperty(mc.prototype,"__arcLengthDivisions",{get:function(){return this.arcLengthDivisions},set:function(e){this.arcLengthDivisions=e}}),ns.prototype.setLens=function(e,t){void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Gc.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}}),Object.defineProperties(or.prototype,{length:{get:function(){return this.array.length}},dynamic:{get:function(){return this.usage===gi},set:function(){this.setUsage(gi)}}}),v(or.prototype,{setDynamic:function(e){return this.setUsage(!0===e?gi:mi),this},copyIndicesArray:function(){},setArray:function(){}}),v(Mr.prototype,{addIndex:function(e){this.setIndex(e)},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(this.setIndex(t),this):this.setAttribute(e,t):this.setAttribute(e,new or(arguments[1],arguments[2]))},addDrawCall:function(e,t,i){this.addGroup(e,t)},clearDrawCalls:function(){this.clearGroups()},computeOffsets:function(){},removeAttribute:function(e){return this.deleteAttribute(e)},applyMatrix:function(e){return this.applyMatrix4(e)}}),Object.defineProperties(Mr.prototype,{drawcalls:{get:function(){return this.groups}},offsets:{get:function(){return this.groups}}}),Object.defineProperties(oh.prototype,{maxInstancedCount:{get:function(){return this.instanceCount},set:function(e){this.instanceCount=e}}}),Object.defineProperties(Vh.prototype,{linePrecision:{get:function(){return this.params.Line.threshold},set:function(e){this.params.Line.threshold=e}}}),Object.defineProperties(Fo.prototype,{dynamic:{get:function(){return this.usage===gi},set:function(e){this.setUsage(e)}}}),v(Fo.prototype,{setDynamic:function(e){return this.setUsage(!0===e?gi:mi),this},setArray:function(){}}),v(wu.prototype,{getArrays:function(){},addShapeList:function(){},addShape:function(){}}),v(No.prototype,{dispose:function(){}}),Object.defineProperties(nr.prototype,{wrapAround:{get:function(){},set:function(){}},overdraw:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new er}},shading:{get:function(){},set:function(e){this.flatShading=e===I}},stencilMask:{get:function(){return this.stencilFuncMask},set:function(e){this.stencilFuncMask=e}}}),Object.defineProperties(Ou.prototype,{metal:{get:function(){return!1},set:function(){}}}),Object.defineProperties(Du.prototype,{transparency:{get:function(){return this.transmission},set:function(e){this.transmission=e}}}),Object.defineProperties(ts.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(e){this.extensions.derivatives=e}}}),v(Oo.prototype,{clearTarget:function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},animate:function(e){this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return this.getRenderTarget()},getMaxAnisotropy:function(){return this.capabilities.getMaxAnisotropy()},getPrecision:function(){return this.capabilities.precision},resetGLState:function(){return this.state.reset()},supportsFloatTextures:function(){return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){this.setScissorTest(e)},initMaterial:function(){},addPrePlugin:function(){},addPostPlugin:function(){},updateShadowMap:function(){},setFaceCulling:function(){},allocTextureUnit:function(){},setTexture:function(){},setTexture2D:function(){},setTextureCube:function(){},getActiveMipMapLevel:function(){return this.getActiveMipmapLevel()}}),Object.defineProperties(Oo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){this.shadowMap.type=e}},shadowMapCullFace:{get:function(){},set:function(){}},context:{get:function(){return this.getContext()}},vr:{get:function(){return this.xr}},gammaInput:{get:function(){return!1},set:function(){}},gammaOutput:{get:function(){return!1},set:function(e){this.outputEncoding=!0===e?ii:ti}},toneMappingWhitePoint:{get:function(){return 1},set:function(){}}}),Object.defineProperties(xo.prototype,{cullFace:{get:function(){},set:function(){}},renderReverseSided:{get:function(){},set:function(){}},renderSingleSided:{get:function(){},set:function(){}}}),Object.defineProperties(Ii.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(e){this.texture.wrapS=e}},wrapT:{get:function(){return this.texture.wrapT},set:function(e){this.texture.wrapT=e}},magFilter:{get:function(){return this.texture.magFilter},set:function(e){this.texture.magFilter=e}},minFilter:{get:function(){return this.texture.minFilter},set:function(e){this.texture.minFilter=e}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(e){this.texture.anisotropy=e}},offset:{get:function(){return this.texture.offset},set:function(e){this.texture.offset=e}},repeat:{get:function(){return this.texture.repeat},set:function(e){this.texture.repeat=e}},format:{get:function(){return this.texture.format},set:function(e){this.texture.format=e}},type:{get:function(){return this.texture.type},set:function(e){this.texture.type=e}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(e){this.texture.generateMipmaps=e}}}),as.prototype.updateCubeMap=function(e,t){return this.update(e,t)},as.prototype.clear=function(e,t,i,n){return this.renderTarget.clear(e,t,i,n)},Ai.crossOrigin=void 0,Ai.loadTexture=function(e,t,i,n){const r=new fc;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},Ai.loadTextureCube=function(e,t,i,n){const r=new dc;r.setCrossOrigin(this.crossOrigin);const s=r.load(e,i,void 0,n);return t&&(s.mapping=t),s},Ai.loadCompressedTexture=function(){},Ai.loadCompressedTextureCube=function(){},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=_));const Kh=function(e,t){var i,n,r=this,s=new on,a=null;function o(e){n=e,e.length>0?i=e[0]:t&&t("VR input not available.")}"VRFrameData"in window&&(a=new VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(o).catch(function(){}),this.scale=1,this.standing=!1,this.userHeight=1.6,this.getVRDisplay=function(){return i},this.setVRDisplay=function(e){i=e},this.getVRDisplays=function(){return n},this.getStandingMatrix=function(){return s},this.update=function(){var t;i&&(i.getFrameData?(i.getFrameData(a),t=a.pose):i.getPose&&(t=i.getPose()),null!==t.orientation&&e.quaternion.fromArray(t.orientation),null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0),this.standing&&(i.stageParameters?(e.updateMatrix(),s.fromArray(i.stageParameters.sittingToStandingTransform),e.applyMatrix(s)):e.position.setY(e.position.y+this.userHeight)),e.position.multiplyScalar(r.scale))},this.dispose=function(){i=null}},Zh=function(e,t){var i,n,r,s,a=new Li,o=new Li,l=new on,u=new on,c=new on,h=null;function d(e){n=e,e.length>0?i=e[0]:t&&t("HMD not available")}"VRFrameData"in window&&(h=new window.VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(d).catch(function(){}),this.isPresenting=!1;var p=this,f=e.getSize(),m=!1,g=e.getPixelRatio();this.getVRDisplay=function(){return i},this.setVRDisplay=function(e){i=e},this.getVRDisplays=function(){return n},this.setSize=function(t,n,r){if(f={width:t,height:n},m=r,p.isPresenting){var s=i.getEyeParameters("left");e.setPixelRatio(1),e.setSize(2*s.renderWidth,s.renderHeight,!1)}else e.setPixelRatio(g),e.setSize(t,n,r)};var y=e.domElement,v=[0,0,.5,1],_=[.5,0,.5,1];function b(){var t=p.isPresenting;if(p.isPresenting=void 0!==i&&i.isPresenting,p.isPresenting){var n=i.getEyeParameters("left"),r=n.renderWidth,s=n.renderHeight;t||(g=e.getPixelRatio(),f=e.getSize(),e.setPixelRatio(1),e.setSize(2*r,s,!1))}else t&&(e.setPixelRatio(g),e.setSize(f.width,f.height,m))}window.addEventListener("vrdisplaypresentchange",b,!1),this.setFullScreen=function(e){return new Promise(function(t,n){void 0!==i?p.isPresenting!==e?t(e?i.requestPresent([{source:y}]):i.exitPresent()):t():n(new Error("No VR hardware found."))})},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)},this.requestAnimationFrame=function(e){return void 0!==i?i.requestAnimationFrame(e):window.requestAnimationFrame(e)},this.cancelAnimationFrame=function(e){void 0!==i?i.cancelAnimationFrame(e):window.cancelAnimationFrame(e)},this.submitFrame=function(){void 0!==i&&p.isPresenting&&i.submitFrame()},this.autoSubmitFrame=!0;var T=new ns;T.layers.enable(1);var S=new ns;S.layers.enable(2),this.render=function(t,n,l,d){if(i&&p.isPresenting){var f=t.autoUpdate;f&&(t.updateMatrixWorld(),t.autoUpdate=!1),Array.isArray(t)&&(t=t[0]);var m,g,y=e.getSize(),b=i.getLayers();if(b.length){var w=b[0];m=null!==w.leftBounds&&4===w.leftBounds.length?w.leftBounds:v,g=null!==w.rightBounds&&4===w.rightBounds.length?w.rightBounds:_}else m=v,g=_;if(r={x:Math.round(y.width*m[0]),y:Math.round(y.height*m[1]),width:Math.round(y.width*m[2]),height:Math.round(y.height*m[3])},s={x:Math.round(y.width*g[0]),y:Math.round(y.height*g[1]),width:Math.round(y.width*g[2]),height:Math.round(y.height*g[3])},l?(e.setRenderTarget(l),l.scissorTest=!0):(e.setRenderTarget(null),e.setScissorTest(!0)),(e.autoClear||d)&&e.clear(),null===n.parent&&n.updateMatrixWorld(),n.matrixWorld.decompose(T.position,T.quaternion,T.scale),S.position.copy(T.position),S.quaternion.copy(T.quaternion),S.scale.copy(T.scale),i.getFrameData)i.depthNear=n.near,i.depthFar=n.far,i.getFrameData(h),T.projectionMatrix.elements=h.leftProjectionMatrix,S.projectionMatrix.elements=h.rightProjectionMatrix,A(h),T.updateMatrix(),T.matrix.multiply(u),T.matrix.decompose(T.position,T.quaternion,T.scale),S.updateMatrix(),S.matrix.multiply(c),S.matrix.decompose(S.position,S.quaternion,S.scale);else{var x=i.getEyeParameters("left"),E=i.getEyeParameters("right");T.projectionMatrix=M(x.fieldOfView,!0,n.near,n.far),S.projectionMatrix=M(E.fieldOfView,!0,n.near,n.far),a.fromArray(x.offset),o.fromArray(E.offset),T.translateOnAxis(a,T.scale.x),S.translateOnAxis(o,S.scale.x)}return l?(l.viewport.set(r.x,r.y,r.width,r.height),l.scissor.set(r.x,r.y,r.width,r.height)):(e.setViewport(r.x,r.y,r.width,r.height),e.setScissor(r.x,r.y,r.width,r.height)),e.render(t,T,l,d),l?(l.viewport.set(s.x,s.y,s.width,s.height),l.scissor.set(s.x,s.y,s.width,s.height)):(e.setViewport(s.x,s.y,s.width,s.height),e.setScissor(s.x,s.y,s.width,s.height)),e.render(t,S,l,d),l?(l.viewport.set(0,0,y.width,y.height),l.scissor.set(0,0,y.width,y.height),l.scissorTest=!1,e.setRenderTarget(null)):(e.setViewport(0,0,y.width,y.height),e.setScissorTest(!1)),f&&(t.autoUpdate=!0),void(p.autoSubmitFrame&&p.submitFrame())}e.render(t,n,l,d)},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",b,!1)};var w=new Pi,x=new Li;function A(e){e.pose.orientation?(w.fromArray(e.pose.orientation),l.makeRotationFromQuaternion(w)):l.identity(),e.pose.position&&(x.fromArray(e.pose.position),l.setPosition(x)),u.fromArray(e.leftViewMatrix),u.multiply(l),c.fromArray(e.rightViewMatrix),c.multiply(l),u.getInverse(u),c.getInverse(c)}function E(e){var t=2/(e.leftTan+e.rightTan),i=(e.leftTan-e.rightTan)*t*.5,n=2/(e.upTan+e.downTan);return{scale:[t,n],offset:[i,(e.upTan-e.downTan)*n*.5]}}function C(e,t,i,n){i=void 0===i?.01:i,n=void 0===n?1e4:n;var r=(t=void 0===t||t)?-1:1,s=new on,a=s.elements,o=E(e);return a[0]=o.scale[0],a[1]=0,a[2]=o.offset[0]*r,a[3]=0,a[4]=0,a[5]=o.scale[1],a[6]=-o.offset[1]*r,a[7]=0,a[8]=0,a[9]=0,a[10]=n/(i-n)*-r,a[11]=n*i/(i-n),a[12]=0,a[13]=0,a[14]=r,a[15]=0,s.transpose(),s}function M(e,t,i,n){var r=Math.PI/180;return C({upTan:Math.tan(e.upDegrees*r),downTan:Math.tan(e.downDegrees*r),leftTan:Math.tan(e.leftDegrees*r),rightTan:Math.tan(e.rightDegrees*r)},t,i,n)}},Jh=function(e,t){var i,n,r,s,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Li,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:b.LEFT,ZOOM:b.MIDDLE,PAN:b.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){o.target0.copy(o.target),o.position0.copy(o.object.position),o.zoom0=o.object.zoom},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(l),o.update(),d=h.NONE},this.update=(i=new Li,n=(new Pi).setFromUnitVectors(e.up,new Li(0,1,0)),r=n.clone().inverse(),s=new Li,a=new Pi,function(){var e=o.object.position;return i.copy(e).sub(o.target),i.applyQuaternion(n),f.setFromVector3(i),o.autoRotate&&d===h.NONE&&o.rotateLeft(k()),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(o.minAzimuthAngle,Math.min(o.maxAzimuthAngle,f.theta)),f.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=g,f.radius=Math.max(o.minDistance,Math.min(o.maxDistance,f.radius)),o.target.add(y),i.setFromSpherical(f),i.applyQuaternion(r),e.copy(o.target).add(i),o.object.lookAt(o.target),!0===o.enableDamping?(m.theta*=1-o.dampingFactor,m.phi*=1-o.dampingFactor,y.multiplyScalar(1-o.dampingFactor)):(m.set(0,0,0),y.set(0,0,0)),g=1,!!(v||s.distanceToSquared(o.object.position)>p||8*(1-a.dot(o.object.quaternion))>p)&&(o.dispatchEvent(l),s.copy(o.object.position),a.copy(o.object.quaternion),v=!1,!0)}),this.dispose=function(){o.domElement.removeEventListener("contextmenu",ne,!1),o.domElement.removeEventListener("mousedown",Y,!1),o.domElement.removeEventListener("wheel",Z,!1),o.domElement.removeEventListener("touchstart",ee,!1),o.domElement.removeEventListener("touchend",ie,!1),o.domElement.removeEventListener("touchmove",te,!1),document.removeEventListener("mousemove",Q,!1),document.removeEventListener("mouseup",K,!1),window.removeEventListener("keydown",J,!1)};var o=this,l={type:"change"},u={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},d=h.NONE,p=1e-6,f=new Gh,m=new Gh,g=1,y=new Li,v=!1,_=new Si,T=new Si,S=new Si,w=new Si,x=new Si,A=new Si,E=new Si,C=new Si,M=new Si;function k(){return 2*Math.PI/60/60*o.autoRotateSpeed}function I(){return Math.pow(.95,o.zoomSpeed)}o.rotateLeft=function(e){m.theta-=e},o.rotateUp=function(e){m.phi-=e};var P,L=(P=new Li,function(e,t){P.setFromMatrixColumn(t,0),P.multiplyScalar(-e),y.add(P)}),D=function(){var e=new Li;return function(t,i){!0===o.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(o.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),O=function(){var e=new Li;return function(t,i){var n=o.domElement===document?o.domElement.body:o.domElement;if(o.object.isPerspectiveCamera){var r=o.object.position;e.copy(r).sub(o.target);var s=e.length();s*=Math.tan(o.object.fov/2*Math.PI/180),L(2*t*s/n.clientHeight,o.object.matrix),D(2*i*s/n.clientHeight,o.object.matrix)}else o.object.isOrthographicCamera?(L(t*(o.object.right-o.object.left)/o.object.zoom/n.clientWidth,o.object.matrix),D(i*(o.object.top-o.object.bottom)/o.object.zoom/n.clientHeight,o.object.matrix)):o.enablePan=!1}}();function R(e){o.object.isPerspectiveCamera?g/=e:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*e)),o.object.updateProjectionMatrix(),v=!0):o.enableZoom=!1}function N(e){o.object.isPerspectiveCamera?g*=e:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/e)),o.object.updateProjectionMatrix(),v=!0):o.enableZoom=!1}function F(e){_.set(e.clientX,e.clientY)}function U(e){E.set(e.clientX,e.clientY)}function B(e){w.set(e.clientX,e.clientY)}function j(e){T.set(e.clientX,e.clientY),S.subVectors(T,_).multiplyScalar(o.rotateSpeed);var t=o.domElement===document?o.domElement.body:o.domElement;o.rotateLeft(2*Math.PI*S.x/t.clientHeight),o.rotateUp(2*Math.PI*S.y/t.clientHeight),_.copy(T),o.update()}function z(e){C.set(e.clientX,e.clientY),M.subVectors(C,E),M.y>0?R(I()):M.y<0&&N(I()),E.copy(C),o.update()}function V(e){x.set(e.clientX,e.clientY),A.subVectors(x,w).multiplyScalar(o.panSpeed),O(A.x,A.y),w.copy(x),o.update()}function H(e){e.deltaY<0?N(I()):e.deltaY>0&&R(I()),o.update()}function q(e){switch(e.keyCode){case o.keys.UP:O(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:O(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:O(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:O(-o.keyPanSpeed,0),o.update()}}function G(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}function W(e){if(o.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);E.set(0,n)}if(o.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),s=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(r,s)}}function $(e){T.set(e.touches[0].pageX,e.touches[0].pageY),S.subVectors(T,_).multiplyScalar(o.rotateSpeed);var t=o.domElement===document?o.domElement.body:o.domElement;o.rotateLeft(2*Math.PI*S.x/t.clientHeight),o.rotateUp(2*Math.PI*S.y/t.clientHeight),_.copy(T),o.update()}function X(e){if(o.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);C.set(0,n),M.set(0,Math.pow(C.y/E.y,o.zoomSpeed)),R(M.y),E.copy(C)}if(o.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),s=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(r,s),A.subVectors(x,w).multiplyScalar(o.panSpeed),O(A.x,A.y),w.copy(x)}o.update()}function Y(e){if(!1!==o.enabled){switch(e.preventDefault(),e.button){case o.mouseButtons.ORBIT:if(!1===o.enableRotate)return;F(e),d=h.ROTATE;break;case o.mouseButtons.ZOOM:if(!1===o.enableZoom)return;U(e),d=h.DOLLY;break;case o.mouseButtons.PAN:if(!1===o.enablePan)return;B(e),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",Q,!1),document.addEventListener("mouseup",K,!1),o.dispatchEvent(u))}}function Q(e){if(!1!==o.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===o.enableRotate)return;j(e);break;case h.DOLLY:if(!1===o.enableZoom)return;z(e);break;case h.PAN:if(!1===o.enablePan)return;V(e)}}function K(e){!1!==o.enabled&&(document.removeEventListener("mousemove",Q,!1),document.removeEventListener("mouseup",K,!1),o.dispatchEvent(c),d=h.NONE)}function Z(e){!1===o.enabled||!1===o.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),o.dispatchEvent(u),H(e),o.dispatchEvent(c))}function J(e){!1!==o.enabled&&!1!==o.enableKeys&&!1!==o.enablePan&&q(e)}function ee(e){if(!1!==o.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===o.enableRotate)return;G(e),d=h.TOUCH_ROTATE;break;case 2:if(!1===o.enableZoom&&!1===o.enablePan)return;W(e),d=h.TOUCH_DOLLY_PAN;break;default:d=h.NONE}d!==h.NONE&&o.dispatchEvent(u)}}function te(e){if(!1!==o.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===o.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;$(e);break;case 2:if(!1===o.enableZoom&&!1===o.enablePan)return;if(d!==h.TOUCH_DOLLY_PAN)return;X(e);break;default:d=h.NONE}}function ie(e){!1!==o.enabled&&(o.dispatchEvent(c),d=h.NONE)}function ne(e){!1!==o.enabled&&e.preventDefault()}o.domElement.addEventListener("mousedown",Y,!1),o.domElement.addEventListener("wheel",Z,!1),o.domElement.addEventListener("touchstart",ee,!1),o.domElement.addEventListener("touchend",ie,!1),o.domElement.addEventListener("touchmove",te,!1),window.addEventListener("keydown",J,!1),this.update()};Jh.prototype=Object.create(vi.prototype),Jh.prototype.constructor=Jh,Object.defineProperties(Jh.prototype,{center:{get:function(){return this.target}},noZoom:{get:function(){return!this.enableZoom},set:function(e){this.enableZoom=!e}},noRotate:{get:function(){return!this.enableRotate},set:function(e){this.enableRotate=!e}},noPan:{get:function(){return!this.enablePan},set:function(e){this.enablePan=!e}},noKeys:{get:function(){return!this.enableKeys},set:function(e){this.enableKeys=!e}},staticMoving:{get:function(){return!this.enableDamping},set:function(e){this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return this.dampingFactor},set:function(e){this.dampingFactor=e}}});const ed=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,n,r,s,a=function(e){t.deviceOrientation=e},o=function(){t.screenOrientation=window.orientation||0},l=(i=new Li(0,0,1),n=new mn,r=new Pi,s=new Pi(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,o,l){n.set(a,t,-o,"YXZ"),e.setFromEuler(n),e.multiply(s),e.multiply(r.setFromAxisAngle(i,-l))});this.connect=function(){o(),window.addEventListener("orientationchange",o,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",o,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?Ti.degToRad(e.alpha)+t.alphaOffset:0,n=e.beta?Ti.degToRad(e.beta):0,r=e.gamma?Ti.degToRad(e.gamma):0,s=t.screenOrientation?Ti.degToRad(t.screenOrientation):0;l(t.object.quaternion,i,n,r,s)}}},this.dispose=function(){t.disconnect()},this.connect()};function td(e,t,i,n){const r=e*t+i*n;if(r>.499){const t=2*Math.atan2(e,n),i=Math.PI/2;return new Li(i,0,t)}if(r<-.499){const t=-2*Math.atan2(e,n),i=-Math.PI/2;return new Li(i,0,t)}const s=e*e,a=t*t,o=i*i,l=Math.atan2(2*t*n-2*e*i,1-2*a-2*o),u=Math.asin(2*r),c=Math.atan2(2*e*n-2*t*i,1-2*s-2*o);return new Li(u,c,l)}class id{constructor(e){this.object=e.camera,this.domElement=e.canvas,this.orbit=new Jh(this.object,this.domElement),this.speed=.5,this.orbit.target.set(0,0,-1),this.orbit.enableZoom=!1,this.orbit.enablePan=!1,this.orbit.rotateSpeed=-this.speed,e.orientation&&(this.orientation=new ed(this.object)),e.halfView&&(this.orbit.minAzimuthAngle=-Math.PI/4,this.orbit.maxAzimuthAngle=Math.PI/4)}update(){if(this.orientation){this.orientation.update();const e=this.orientation.object.quaternion,t=td(e.x,e.y,e.z,e.w);void 0===this.lastAngle_&&(this.lastAngle_=t),this.orbit.rotateLeft((this.lastAngle_.z-t.z)*(1+this.speed)),this.orbit.rotateUp((this.lastAngle_.y-t.y)*(1+this.speed)),this.lastAngle_=t}this.orbit.update()}dispose(){this.orbit.dispose(),this.orientation&&this.orientation.dispose()}}const nd=function(){const e=document.createElement("video");return e.crossOrigin="anonymous",e.hasAttribute("crossorigin")}(),rd=["360","360_LR","360_TB","360_CUBE","EAC","EAC_LR","NONE","AUTO","Sphere","Cube","equirectangular","180","180_LR","180_MONO"],sd=function(e){if(e){if(e=e.toString().trim(),/sphere/i.test(e))return"360";if(/cube/i.test(e))return"360_CUBE";if(/equirectangular/i.test(e))return"360";for(let t=0;t<rd.length;t++)if(new RegExp("^"+rd[t]+"$","i").test(e))return rd[t]}};class ad extends i.default.EventTarget{constructor(e,t,n){super(),this.player=e,this.canvas=t,this.options=n,this.onMoveEnd=i.default.bind(this,this.onMoveEnd),this.onMoveStart=i.default.bind(this,this.onMoveStart),this.onMove=i.default.bind(this,this.onMove),this.onControlBarMove=i.default.bind(this,this.onControlBarMove),this.player.controlBar.on(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],this.onControlBarMove),this.oldReportUserActivity=this.player.reportUserActivity,this.player.reportUserActivity=()=>{},this.canvas.addEventListener("mousedown",this.onMoveStart),this.canvas.addEventListener("touchstart",this.onMoveStart),this.canvas.addEventListener("mousemove",this.onMove),this.canvas.addEventListener("touchmove",this.onMove),this.canvas.addEventListener("mouseup",this.onMoveEnd),this.canvas.addEventListener("touchend",this.onMoveEnd),this.shouldTogglePlay=!1}togglePlay(){this.player.paused()?this.player.play():this.player.pause()}onMoveStart(e){this.options.disableTogglePlay||!this.player.controls()||"mousedown"===e.type&&!i.default.dom.isSingleLeftClick(e)?this.shouldTogglePlay=!1:(this.shouldTogglePlay=!0,this.touchMoveCount_=0)}onMoveEnd(e){if("touchend"===e.type&&this.touchMoveCount_<10)return!1===this.player.userActive()?void this.player.userActive(!0):void this.player.userActive(!1);this.shouldTogglePlay&&"mouseup"===e.type&&this.togglePlay()}onMove(e){this.touchMoveCount_++,this.shouldTogglePlay=!1}onControlBarMove(e){this.player.userActive(!0)}dispose(){this.canvas.removeEventListener("mousedown",this.onMoveStart),this.canvas.removeEventListener("touchstart",this.onMoveStart),this.canvas.removeEventListener("mousemove",this.onMove),this.canvas.removeEventListener("touchmove",this.onMove),this.canvas.removeEventListener("mouseup",this.onMoveEnd),this.canvas.removeEventListener("touchend",this.onMoveEnd),this.player.controlBar.off(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],this.onControlBarMove),this.player.reportUserActivity=this.oldReportUserActivity}}class od extends i.default.EventTarget{constructor(e,t,n,r){super();const s=i.default.mergeOptions({channelMap:i.default.browser.IS_SAFARI?[2,0,1,3]:[0,1,2,3],ambisonicOrder:1},r);this.videoElementSource=e.createMediaElementSource(n),this.foaRenderer=t.createFOARenderer(e,s),this.foaRenderer.initialize().then(()=>{"suspended"===e.state&&this.trigger({type:"audiocontext-suspended"}),this.videoElementSource.connect(this.foaRenderer.input),this.foaRenderer.output.connect(e.destination),this.initialized=!0,this.trigger({type:"omnitone-ready"})},e=>{i.default.log.warn(`videojs-vr: Omnitone initializes failed with the following error: ${e})`)})}update(e){this.initialized&&this.foaRenderer.setRotationMatrixFromCamera(e.matrix)}dispose(){this.initialized=!1,this.foaRenderer.setRenderingMode("bypass"),this.foaRenderer=null}}const ld=i.default.getComponent("Button");class ud extends ld{constructor(e,t){super(e,t),this.handleVrDisplayActivate_=i.default.bind(this,this.handleVrDisplayActivate_),this.handleVrDisplayDeactivate_=i.default.bind(this,this.handleVrDisplayDeactivate_),this.handleVrDisplayPresentChange_=i.default.bind(this,this.handleVrDisplayPresentChange_),this.handleOrientationChange_=i.default.bind(this,this.handleOrientationChange_),window.addEventListener("orientationchange",this.handleOrientationChange_),window.addEventListener("vrdisplayactivate",this.handleVrDisplayActivate_),window.addEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_),window.addEventListener("vrdisplaypresentchange",this.handleVrDisplayPresentChange_),i.default.browser.IS_ANDROID&&this.on(e,"fullscreenchange",()=>{e.isFullscreen()?this.hide():this.show()})}buildCSSClass(){return`vjs-button-vr ${super.buildCSSClass()}`}handleVrDisplayPresentChange_(){!this.player_.vr().vrDisplay.isPresenting&&this.active_&&this.handleVrDisplayDeactivate_(),this.player_.vr().vrDisplay.isPresenting&&!this.active_&&this.handleVrDisplayActivate_()}handleOrientationChange_(){this.active_&&i.default.browser.IS_IOS&&this.changeSize_()}changeSize_(){this.player_.width(window.innerWidth),this.player_.height(window.innerHeight),window.dispatchEvent(new window.Event("resize"))}handleVrDisplayActivate_(){i.default.browser.IS_IOS&&(this.oldWidth_=this.player_.currentWidth(),this.oldHeight_=this.player_.currentHeight(),this.player_.enterFullWindow(),this.changeSize_()),this.active_=!0}handleVrDisplayDeactivate_(){i.default.browser.IS_IOS&&(this.oldWidth_&&this.player_.width(this.oldWidth_),this.oldHeight_&&this.player_.height(this.oldHeight_),this.player_.exitFullWindow()),this.active_=!1}handleClick(e){this.active_?window.dispatchEvent(new window.Event("vrdisplaydeactivate")):(!this.player_.hasStarted()&&i.default.browser.IS_ANDROID&&this.player_.play(),window.dispatchEvent(new window.Event("vrdisplayactivate")))}dispose(){super.dispose(),window.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_),window.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_),window.removeEventListener("vrdisplaypresentchange",this.handleVrDisplayPresentChange_)}}i.default.registerComponent("CardboardButton",ud);const cd=i.default.getComponent("BigPlayButton");class hd extends cd{buildCSSClass(){return`vjs-big-vr-play-button ${super.buildCSSClass()}`}}i.default.registerComponent("BigVrPlayButton",hd);const dd={debug:!1,omnitone:!1,forceCardboard:!1,omnitoneOptions:{},projection:"AUTO",sphereDetail:32,disableTogglePlay:!1},pd={"web-vr-out-of-date":{headline:"360 is out of date",type:"360_OUT_OF_DATE",message:"Your browser supports 360 but not the latest version. See <a href='http://webvr.info'>http://webvr.info</a> for more info."},"web-vr-not-supported":{headline:"360 not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser does not support 360. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."},"web-vr-hls-cors-not-supported":{headline:"360 HLS video not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser/device does not support HLS 360 video. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."}},fd=i.default.getPlugin("plugin"),md=i.default.getComponent("Component");class gd extends fd{constructor(e,t){const n=i.default.mergeOptions(dd,t);super(e,n),this.options_=n,this.player_=e,this.bigPlayButtonIndex_=e.children().indexOf(e.getChild("BigPlayButton"))||0,this.videojsErrorsSupport_=!!i.default.errors,this.videojsErrorsSupport_&&e.errors({errors:pd}),!i.default.browser.IE_VERSION&&nd?(this.polyfill_=new m({ROTATE_INSTRUCTIONS_DISABLED:!0}),this.polyfill_=new m,this.handleVrDisplayActivate_=i.default.bind(this,this.handleVrDisplayActivate_),this.handleVrDisplayDeactivate_=i.default.bind(this,this.handleVrDisplayDeactivate_),this.handleResize_=i.default.bind(this,this.handleResize_),this.animate_=i.default.bind(this,this.animate_),this.setProjection(this.options_.projection),this.on(e,"adstart",()=>e.setTimeout(()=>{e.ads&&e.ads.videoElementRecycled()?(this.log("video element recycled for this ad, reseting"),this.reset(),this.one(e,"playing",this.init)):this.log("video element not recycled for this ad, no need to reset")}),1),this.on(e,"loadedmetadata",this.init)):this.player_.on("loadstart",()=>{this.triggerError_({code:"web-vr-not-supported",dismiss:!1})})}changeProjection_(e){(e=sd(e))||(e="NONE");const t={x:0,y:0,z:0};if(this.scene&&this.scene.remove(this.movieScreen),"AUTO"===e){if(this.player_.mediainfo&&this.player_.mediainfo.projection&&"AUTO"!==this.player_.mediainfo.projection){const e=sd(this.player_.mediainfo.projection);return this.changeProjection_(e)}return this.changeProjection_("NONE")}if("360"===e)this.movieGeometry=new ku(256,this.options_.sphereDetail,this.options_.sphereDetail),this.movieMaterial=new rr({map:this.videoTexture,overdraw:!0,side:M}),this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(t.x,t.y,t.z),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.scene.add(this.movieScreen);else if("360_LR"===e||"360_TB"===e){let t=new ku(256,this.options_.sphereDetail,this.options_.sphereDetail),i=t.faceVertexUvs[0];for(let n=0;n<i.length;n++)for(let t=0;t<3;t++)"360_LR"===e?i[n][t].x*=.5:(i[n][t].y*=.5,i[n][t].y+=.5);this.movieGeometry=(new Mr).fromGeometry(t),this.movieMaterial=new rr({map:this.videoTexture,overdraw:!0,side:M}),this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),t=new ku(256,this.options_.sphereDetail,this.options_.sphereDetail),i=t.faceVertexUvs[0];for(let n=0;n<i.length;n++)for(let t=0;t<3;t++)"360_LR"===e?(i[n][t].x*=.5,i[n][t].x+=.5):i[n][t].y*=.5;this.movieGeometry=(new Mr).fromGeometry(t),this.movieMaterial=new rr({map:this.videoTexture,overdraw:!0,side:M}),this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if("360_CUBE"===e){this.movieGeometry=new Yr(256,256,256),this.movieMaterial=new rr({map:this.videoTexture,overdraw:!0,side:M});const e=[new Si(0,.5),new Si(.333,.5),new Si(.333,1),new Si(0,1)],i=[new Si(.333,.5),new Si(.666,.5),new Si(.666,1),new Si(.333,1)],n=[new Si(.666,.5),new Si(1,.5),new Si(1,1),new Si(.666,1)],r=[new Si(0,0),new Si(.333,0),new Si(.333,.5),new Si(0,.5)],s=[new Si(.333,0),new Si(.666,0),new Si(.666,.5),new Si(.333,.5)],a=[new Si(.666,0),new Si(1,0),new Si(1,.5),new Si(.666,.5)];this.movieGeometry.faceVertexUvs[0]=[],this.movieGeometry.faceVertexUvs[0][0]=[i[2],i[1],i[3]],this.movieGeometry.faceVertexUvs[0][1]=[i[1],i[0],i[3]],this.movieGeometry.faceVertexUvs[0][2]=[e[2],e[1],e[3]],this.movieGeometry.faceVertexUvs[0][3]=[e[1],e[0],e[3]],this.movieGeometry.faceVertexUvs[0][4]=[n[2],n[1],n[3]],this.movieGeometry.faceVertexUvs[0][5]=[n[1],n[0],n[3]],this.movieGeometry.faceVertexUvs[0][6]=[r[2],r[1],r[3]],this.movieGeometry.faceVertexUvs[0][7]=[r[1],r[0],r[3]],this.movieGeometry.faceVertexUvs[0][8]=[s[2],s[1],s[3]],this.movieGeometry.faceVertexUvs[0][9]=[s[1],s[0],s[3]],this.movieGeometry.faceVertexUvs[0][10]=[a[2],a[1],a[3]],this.movieGeometry.faceVertexUvs[0][11]=[a[1],a[0],a[3]],this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(t.x,t.y,t.z),this.movieScreen.rotation.y=-Math.PI,this.scene.add(this.movieScreen)}else if("180"===e||"180_LR"===e||"180_MONO"===e){let t=new ku(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI);t.scale(-1,1,1);let i=t.faceVertexUvs[0];if("180_MONO"!==e)for(let e=0;e<i.length;e++)for(let t=0;t<3;t++)i[e][t].x*=.5;this.movieGeometry=(new Mr).fromGeometry(t),this.movieMaterial=new rr({map:this.videoTexture,overdraw:!0}),this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),t=new ku(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI),t.scale(-1,1,1),i=t.faceVertexUvs[0];for(let e=0;e<i.length;e++)for(let t=0;t<3;t++)i[e][t].x*=.5,i[e][t].x+=.5;this.movieGeometry=(new Mr).fromGeometry(t),this.movieMaterial=new rr({map:this.videoTexture,overdraw:!0}),this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if("EAC"===e||"EAC_LR"===e){const i=(e,i)=>{const n=2;this.movieGeometry=new Yr(256,256,256),this.movieMaterial=new ts({overdraw:!0,side:M,uniforms:{mapped:{value:this.videoTexture},mapMatrix:{value:e},contCorrect:{value:n},faceWH:{value:new Si(1/3,.5).applyMatrix3(i)},vidWH:{value:new Si(this.videoTexture.image.videoWidth,this.videoTexture.image.videoHeight).applyMatrix3(i)}},vertexShader:"\nvarying vec2 vUv;\nuniform mat3 mapMatrix;\n\nvoid main() {\n  vUv = (mapMatrix * vec3(uv, 1.)).xy;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);\n}",fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D mapped;\nuniform vec2 faceWH;\nuniform vec2 vidWH;\nuniform float contCorrect;\n\nconst float PI = 3.1415926535897932384626433832795;\n\nvoid main() {\n  vec2 corner = vUv - mod(vUv, faceWH) + vec2(0, contCorrect / vidWH.y);\n\n  vec2 faceWHadj = faceWH - vec2(0, contCorrect * 2. / vidWH.y);\n\n  vec2 p = (vUv - corner) / faceWHadj - .5;\n  vec2 q = 2. / PI * atan(2. * p) + .5;\n\n  vec2 eUv = corner + q * faceWHadj;\n\n  gl_FragColor = texture2D(mapped, eUv);\n}"});const r=[new Si(0,.5),new Si(1/3,.5),new Si(1/3,1),new Si(0,1)],s=[new Si(1/3,.5),new Si(2/3,.5),new Si(2/3,1),new Si(1/3,1)],a=[new Si(2/3,.5),new Si(1,.5),new Si(1,1),new Si(2/3,1)],o=[new Si(1/3,0),new Si(1/3,.5),new Si(0,.5),new Si(0,0)],l=[new Si(1/3,.5),new Si(1/3,0),new Si(2/3,0),new Si(2/3,.5)],u=[new Si(1,0),new Si(1,.5),new Si(2/3,.5),new Si(2/3,0)];for(const t of[r,s,a,o,l,u]){const e=this.videoTexture.image.videoHeight;let i=1,r=0;for(const n of t)n.y<i&&(i=n.y),n.y>r&&(r=n.y);for(const s of t)Math.abs(s.y-i)<Number.EPSILON&&(s.y+=n/e),Math.abs(s.y-r)<Number.EPSILON&&(s.y-=n/e),s.x=s.x/e*(e-2*n)+n/e}return this.movieGeometry.faceVertexUvs[0]=[],this.movieGeometry.faceVertexUvs[0][0]=[r[2],r[1],r[3]],this.movieGeometry.faceVertexUvs[0][1]=[r[1],r[0],r[3]],this.movieGeometry.faceVertexUvs[0][2]=[a[2],a[1],a[3]],this.movieGeometry.faceVertexUvs[0][3]=[a[1],a[0],a[3]],this.movieGeometry.faceVertexUvs[0][4]=[u[2],u[1],u[3]],this.movieGeometry.faceVertexUvs[0][5]=[u[1],u[0],u[3]],this.movieGeometry.faceVertexUvs[0][6]=[o[2],o[1],o[3]],this.movieGeometry.faceVertexUvs[0][7]=[o[1],o[0],o[3]],this.movieGeometry.faceVertexUvs[0][8]=[s[2],s[1],s[3]],this.movieGeometry.faceVertexUvs[0][9]=[s[1],s[0],s[3]],this.movieGeometry.faceVertexUvs[0][10]=[l[2],l[1],l[3]],this.movieGeometry.faceVertexUvs[0][11]=[l[1],l[0],l[3]],this.movieScreen=new Wr(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(t.x,t.y,t.z),this.movieScreen.rotation.y=-Math.PI,this.movieScreen};if("EAC"===e)this.scene.add(i(new wi,new wi));else{const e=(new wi).set(0,.5,0,1,0,0,0,0,1);i((new wi).set(0,-.5,.5,1,0,0,0,0,1),e),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),i((new wi).set(0,-.5,1,1,0,0,0,0,1),e),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}}this.currentProjection_=e}triggerError_(e){if(this.videojsErrorsSupport_)this.player_.error(e);else{const t=document.createElement("div");t.innerHTML=pd[e.code].message;const i=t.textContent||t.innerText||"";this.player_.error({code:e.code,message:i})}}log(...e){this.options_.debug&&e.forEach(e=>{i.default.log("VR: ",e)})}handleVrDisplayActivate_(){this.vrDisplay&&this.vrDisplay.requestPresent([{source:this.renderedCanvas}]).then(()=>{if(!this.vrDisplay.cardboardUI_||!i.default.browser.IS_IOS)return;let e=[];const t=t=>{for(let i=0;i<t.touches.length;i++)e.push(t.touches[i])},n=t=>{e.length&&(e.forEach(e=>{const t=new window.MouseEvent("click",{screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});this.renderedCanvas.dispatchEvent(t)}),e=[])};this.renderedCanvas.addEventListener("touchstart",t),this.renderedCanvas.addEventListener("touchend",n),this.iosRevertTouchToClick_=()=>{this.renderedCanvas.removeEventListener("touchstart",t),this.renderedCanvas.removeEventListener("touchend",n),this.iosRevertTouchToClick_=null}})}handleVrDisplayDeactivate_(){this.vrDisplay&&this.vrDisplay.isPresenting&&(this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.vrDisplay.exitPresent())}requestAnimationFrame(e){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(e):this.player_.requestAnimationFrame(e)}cancelAnimationFrame(e){return this.vrDisplay?this.vrDisplay.cancelAnimationFrame(e):this.player_.cancelAnimationFrame(e)}togglePlay_(){this.player_.paused()?this.player_.play():this.player_.pause()}animate_(){if(this.initialized_){if(this.getVideoEl_().readyState===this.getVideoEl_().HAVE_ENOUGH_DATA&&this.videoTexture&&(this.videoTexture.needsUpdate=!0),this.controls3d.update(),this.omniController&&this.omniController.update(this.camera),this.effect.render(this.scene,this.camera),window.navigator.getGamepads){const e=window.navigator.getGamepads();for(let t=0;t<e.length;++t){const i=e[t];if(i&&i.timestamp&&i.timestamp!==this.prevTimestamps_[t])for(let e=0;e<i.buttons.length;++e)if(i.buttons[e].pressed){this.togglePlay_(),this.prevTimestamps_[t]=i.timestamp;break}}}this.camera.getWorldDirection(this.cameraVector),this.animationFrameId_=this.requestAnimationFrame(this.animate_)}}handleResize_(){const e=this.player_.currentWidth(),t=this.player_.currentHeight();this.effect.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}setProjection(e){sd(e)?(this.currentProjection_=e,this.defaultProjection_=e):i.default.log.error("videojs-vr: please pass a valid projection "+rd.join(", "))}init(){if(this.reset(),this.camera=new ns(75,this.player_.currentWidth()/this.player_.currentHeight(),1,1e3),this.cameraVector=new Li,"360_LR"!==this.currentProjection_&&"360_TB"!==this.currentProjection_&&"180"!==this.currentProjection_&&"180_LR"!==this.currentProjection_&&"180_MONO"!==this.currentProjection_&&"EAC_LR"!==this.currentProjection_||this.camera.layers.enable(1),this.scene=new No,this.videoTexture=new Ul(this.getVideoEl_()),this.videoTexture.generateMipmaps=!1,this.videoTexture.minFilter=ke,this.videoTexture.magFilter=ke,this.videoTexture.format=Ge,this.changeProjection_(this.currentProjection_),"NONE"===this.currentProjection_)return this.log("Projection is NONE, dont init"),void this.reset();this.player_.removeChild("BigPlayButton"),this.player_.addChild("BigVrPlayButton",{},this.bigPlayButtonIndex_),this.player_.bigPlayButton=this.player_.getChild("BigVrPlayButton"),(this.options_.forceCardboard||i.default.browser.IS_ANDROID||i.default.browser.IS_IOS)&&this.addCardboardButton_(),i.default.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.hide(),this.camera.position.set(0,0,0),this.renderer=new Oo({devicePixelRatio:window.devicePixelRatio,alpha:!1,clearColor:16777215,antialias:!0});const e=this.renderer.getContext("webgl"),t=e.texImage2D;e.texImage2D=(...i)=>{try{return t.apply(e,i)}catch(n){throw this.reset(),this.player_.pause(),this.triggerError_({code:"web-vr-hls-cors-not-supported",dismiss:!1}),new Error(n)}},this.renderer.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.effect=new Zh(this.renderer),this.effect.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.vrDisplay=null,this.prevTimestamps_=[],this.renderedCanvas=this.renderer.domElement,this.renderedCanvas.setAttribute("style","width: 100%; height: 100%; position: absolute; top:0;");const n=this.getVideoEl_().style;if(this.player_.el().insertBefore(this.renderedCanvas,this.player_.el().firstChild),n.zIndex="-1",n.opacity="0",window.navigator.getVRDisplays?(this.log("is supported, getting vr displays"),window.navigator.getVRDisplays().then(e=>{if(e.length>0&&(this.log("Displays found",e),this.vrDisplay=e[0],this.vrDisplay.isPolyfilled||(this.log("Real HMD found using VRControls",this.vrDisplay),this.addCardboardButton_(),this.controls3d=new Kh(this.camera))),!this.controls3d){this.log("no HMD found Using Orbit & Orientation Controls");const e={camera:this.camera,canvas:this.renderedCanvas,halfView:0===this.currentProjection_.indexOf("180"),orientation:i.default.browser.IS_IOS||i.default.browser.IS_ANDROID||!1};!1===this.options_.motionControls&&(e.orientation=!1),this.controls3d=new id(e),this.canvasPlayerControls=new ad(this.player_,this.renderedCanvas,this.options_)}this.animationFrameId_=this.requestAnimationFrame(this.animate_)})):window.navigator.getVRDevices?this.triggerError_({code:"web-vr-out-of-date",dismiss:!1}):this.triggerError_({code:"web-vr-not-supported",dismiss:!1}),this.options_.omnitone){const e=yh.getContext();this.omniController=new od(e,this.options_.omnitone,this.getVideoEl_(),this.options_.omnitoneOptions),this.omniController.one("audiocontext-suspended",()=>{this.player.pause(),this.player.one("playing",()=>{e.resume()})})}this.on(this.player_,"fullscreenchange",this.handleResize_),window.addEventListener("vrdisplaypresentchange",this.handleResize_,!0),window.addEventListener("resize",this.handleResize_,!0),window.addEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),window.addEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.initialized_=!0,this.trigger("initialized")}addCardboardButton_(){this.player_.controlBar.getChild("CardboardButton")||this.player_.controlBar.addChild("CardboardButton",{})}getVideoEl_(){return this.player_.el().getElementsByTagName("video")[0]}reset(){if(!this.initialized_)return;this.omniController&&(this.omniController.off("audiocontext-suspended"),this.omniController.dispose(),this.omniController=void 0),this.controls3d&&(this.controls3d.dispose(),this.controls3d=null),this.canvasPlayerControls&&(this.canvasPlayerControls.dispose(),this.canvasPlayerControls=null),this.effect&&(this.effect.dispose(),this.effect=null),window.removeEventListener("resize",this.handleResize_,!0),window.removeEventListener("vrdisplaypresentchange",this.handleResize_,!0),window.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),window.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.player_.getChild("BigPlayButton")||this.player_.addChild("BigPlayButton",{},this.bigPlayButtonIndex_),this.player_.getChild("BigVrPlayButton")&&this.player_.removeChild("BigVrPlayButton"),this.player_.getChild("CardboardButton")&&this.player_.controlBar.removeChild("CardboardButton"),i.default.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.show();const e=this.getVideoEl_().style;e.zIndex="",e.opacity="",this.currentProjection_=this.defaultProjection_,this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.renderedCanvas&&this.renderedCanvas.parentNode.removeChild(this.renderedCanvas),this.animationFrameId_&&this.cancelAnimationFrame(this.animationFrameId_),this.initialized_=!1}dispose(){super.dispose(),this.reset()}polyfillVersion(){return m.version}}return gd.prototype.setTimeout=md.prototype.setTimeout,gd.prototype.clearTimeout=md.prototype.clearTimeout,gd.VERSION=n,i.default.registerPlugin("vr",gd),gd}(a(zA))),bf.exports);const qA=n({__proto__:null,default:s(HA)},[HA]),GA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let WA=e=>{const t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout),t.trigger&&e.off("ended",t.trigger),t.abortOrErrorHandler&&e.off(["abort","error"],t.abortOrErrorHandler),t.timeout=null,t.trigger=null,t.abortOrErrorHandler=null};const $A=(e,t)=>{var i;(WA(e),"number"==typeof(i=t)&&!isNaN(i)&&i>=0&&i<1/0)?(e.playlist.autoadvance_.delay=t,e.playlist.autoadvance_.trigger=function(){const i=()=>$A(e,t);e.one("play",i),e.playlist.autoadvance_.timeout=e.setTimeout(()=>{WA(e),e.off("play",i),e.one("loadstart",function(){e.playlist.isAutoadvancing=!0}),e.playlist.next(!0)},1e3*t)},e.playlist.autoadvance_.abortOrErrorHandler=function(){e.playlist.isAutoadvancing=!1},e.one("ended",e.playlist.autoadvance_.trigger),e.one(["abort","error"],e.playlist.autoadvance_.abortOrErrorHandler)):e.playlist.autoadvance_.delay=null};let XA=1;const YA=e=>{let t=e;return e&&"object"==typeof e||(t=Object(e),t.originalValue=e),t.playlistItemId_=XA++,t},QA=e=>e.map(YA),KA=(e,t)=>{let i=e,n=t;return"object"==typeof e&&(i=e.src),"object"==typeof t&&(n=t.src),/^\/\//.test(i)&&(n=n.slice(n.indexOf("//"))),/^\/\//.test(n)&&(i=i.slice(i.indexOf("//"))),i===n},ZA=(e,t)=>{for(let i=0;i<e.length;i++){const n=e[i].sources;if(Array.isArray(n))for(let e=0;e<n.length;e++){const r=n[e];if(r&&KA(r,t))return i}}return-1};function JA(e,t,i=0){let n=null,r=!1;const s=e.playlist=(t,i=0)=>{if(r)throw new Error("do not call playlist() during a playlist change");if(Array.isArray(t)){const a=Array.isArray(n)?n.slice():null;n=QA(t),r=!0,e.trigger({type:"duringplaylistchange",nextIndex:i,nextPlaylist:t,previousIndex:s.currentIndex_,previousPlaylist:a||[]}),r=!1,-1!==i&&s.currentItem(i),a&&e.setTimeout(()=>{e.trigger({type:"playlistchange",action:"change"})},0)}return n.map(e=>e.originalValue||e)};return e.on("loadstart",()=>{-1===s.currentItem()&&WA(e)}),s.currentIndex_=-1,s.player_=e,s.autoadvance_={},s.repeat_=!1,s.currentPlaylistItemId_=null,s.currentItem=(e,t)=>{if(r)return s.currentIndex_;if("number"==typeof e&&s.currentIndex_!==e&&e>=0&&e<n.length)return s.currentIndex_=e,((e,t,i=!1)=>{const n=!e.paused()||e.ended(),r=()=>{e.audioPosterMode()&&e.poster(t.poster||"")};e.trigger("beforeplaylistitem",t.originalValue||t),t.playlistItemId_&&(e.playlist.currentPlaylistItemId_=t.playlistItemId_),e.poster(i?"":t.poster||""),e.off("audiopostermodechange",r),e.one("audiopostermodechange",r),e.src(t.sources),(e=>{const t=e.remoteTextTracks();let i=t&&t.length||0;for(;i--;)e.removeRemoteTextTrack(t[i])})(e),e.ready(()=>{if((t.textTracks||[]).forEach(e.addRemoteTextTrack.bind(e)),e.trigger("playlistitem",t.originalValue||t),n){const t=e.play();void 0!==t&&"function"==typeof t.then&&t.then(null,e=>{})}$A(e,e.playlist.autoadvance_.delay)})})(s.player_,n[s.currentIndex_],t),s.currentIndex_;const i=s.player_.currentSrc()||"";if(s.currentPlaylistItemId_){const e=((e,t)=>{for(let i=0;i<e.length;i++)if(e[i].playlistItemId_===t)return i;return-1})(n,s.currentPlaylistItemId_),t=n[e];if(t&&Array.isArray(t.sources)&&ZA([t],i)>-1)return s.currentIndex_=e,s.currentIndex_;s.currentPlaylistItemId_=null}return s.currentIndex_=s.indexOf(i),s.currentIndex_},s.add=(t,i)=>{if(r)throw new Error("cannot modify a playlist that is currently changing");("number"!=typeof i||i<0||i>n.length)&&(i=n.length),Array.isArray(t)||(t=[t]),n.splice(i,0,...QA(t)),e.trigger({type:"playlistchange",action:"add"}),e.trigger({type:"playlistadd",count:t.length,index:i})},s.remove=(t,i=1)=>{if(r)throw new Error("cannot modify a playlist that is currently changing");"number"!=typeof t||t<0||t>n.length||(n.splice(t,i),e.trigger({type:"playlistchange",action:"remove"}),e.trigger({type:"playlistremove",count:i,index:t}))},s.contains=e=>-1!==s.indexOf(e),s.indexOf=e=>{if("string"==typeof e)return ZA(n,e);const t=Array.isArray(e)?e:e.sources;for(let i=0;i<t.length;i++){const e=t[i];if("string"==typeof e)return ZA(n,e);if(e.src)return ZA(n,e.src)}return-1},s.currentIndex=()=>s.currentItem(),s.lastIndex=()=>n.length-1,s.nextIndex=()=>{const e=s.currentItem();if(-1===e)return-1;const t=s.lastIndex();return s.repeat_&&e===t?0:Math.min(e+1,t)},s.previousIndex=()=>{const e=s.currentItem();return-1===e?-1:s.repeat_&&0===e?s.lastIndex():Math.max(e-1,0)},s.first=()=>{if(r)return;const e=s.currentItem(0);if(n.length)return n[e].originalValue||n[e];s.currentIndex_=-1},s.last=()=>{if(r)return;const e=s.currentItem(s.lastIndex());if(n.length)return n[e].originalValue||n[e];s.currentIndex_=-1},s.next=(e=!1)=>{if(r)return;const t=s.nextIndex();if(t!==s.currentIndex_){const i=s.currentItem(t,e);return n[i].originalValue||n[i]}},s.previous=()=>{if(r)return;const e=s.previousIndex();if(e!==s.currentIndex_){const t=s.currentItem(e);return n[t].originalValue||n[t]}},s.autoadvance=e=>{$A(s.player_,e)},s.repeat=e=>void 0===e?s.repeat_:"boolean"==typeof e?(s.repeat_=!!e,s.repeat_):void dl.log.error("videojs-playlist: Invalid value for repeat",e),s.sort=t=>{n.length&&(n.sort(t),r||e.trigger("playlistsorted"))},s.reverse=()=>{n.length&&(n.reverse(),r||e.trigger("playlistsorted"))},s.shuffle=({rest:t}={})=>{let i=0,a=n;t&&(i=s.currentIndex_+1,a=n.slice(i)),a.length<=1||((e=>{let t=-1;const i=e.length-1;for(;++t<e.length;){const n=t+Math.floor(Math.random()*(i-t+1)),r=e[n];e[n]=e[t],e[t]=r}})(a),t&&n.splice(...[i,a.length].concat(a)),r||e.trigger("playlistsorted"))},Array.isArray(t)?s(t,i):n=[],s}const eE=function(e,t){JA(this,e,t)};(dl.registerPlugin||dl.plugin)("playlist",eE),eE.VERSION="5.2.0";const tE=Object.freeze(Object.defineProperty({__proto__:null,default:eE},Symbol.toStringTag,{value:"Module"}));e.ALL_SUPPORTED_EVENTS=hf,e.FunPlayerWebComponent=mf,e.createFunPlayerElement=yf,e.default=vf,e.getEventDocumentation=df,e.registerFunPlayerWebComponent=gf,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
