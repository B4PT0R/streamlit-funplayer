import{g as Xo,r as y0,a as nS,b as rS,w as ie,_ as ba,l as aS,d as et,v as ev,c as sS,e as tv}from"./main-SQlJ5dD_.js";function oS(d,s){for(var o=0;o<s.length;o++){const a=s[o];if(typeof a!="string"&&!Array.isArray(a)){for(const e in a)if(e!=="default"&&!(e in d)){const r=Object.getOwnPropertyDescriptor(a,e);r&&Object.defineProperty(d,e,r.get?r:{enumerable:!0,get:()=>a[e]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}var Kc={exports:{}},Uc={exports:{}},iv;function lS(){return iv||(iv=1,function(d,s){function o(m){if(m&&typeof m=="object"){var v=m.which||m.keyCode||m.charCode;v&&(m=v)}if(typeof m=="number")return l[m];var A=String(m),L=a[A.toLowerCase()];if(L)return L;var L=e[A.toLowerCase()];if(L)return L;if(A.length===1)return A.charCodeAt(0)}o.isEventKey=function(v,A){if(v&&typeof v=="object"){var L=v.which||v.keyCode||v.charCode;if(L==null)return!1;if(typeof A=="string"){var P=a[A.toLowerCase()];if(P)return P===L;var P=e[A.toLowerCase()];if(P)return P===L}else if(typeof A=="number")return A===L;return!1}},s=d.exports=o;var a=s.code=s.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},e=s.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(r=97;r<123;r++)a[String.fromCharCode(r)]=r-32;for(var r=48;r<58;r++)a[r-48]=r;for(r=1;r<13;r++)a["f"+r]=r+111;for(r=0;r<10;r++)a["numpad "+r]=r+96;var l=s.names=s.title={};for(r in a)l[a[r]]=r;for(var f in e)a[f]=e[f]}(Uc,Uc.exports)),Uc.exports}var uS=lS();const Nt=Xo(uS);function Ft(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function No(d,s){return No=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,a){return o.__proto__=a,o},No(d,s)}function it(d,s){d.prototype=Object.create(s.prototype),d.prototype.constructor=d,No(d,s)}var Ef,nv;function cS(){if(nv)return Ef;nv=1,Ef=d;function d(s,o){var a,e=null;try{a=JSON.parse(s,o)}catch(r){e=r}return[e,a]}return Ef}var dS=cS();const hS=Xo(dS);var Hc={exports:{}},Mf,rv;function fS(){if(rv)return Mf;rv=1;var d=y0(),s=function(e,r){return r===void 0&&(r=!1),function(l,f,m){if(l){e(l);return}if(f.statusCode>=400&&f.statusCode<=599){var v=m;if(r)if(d.TextDecoder){var A=o(f.headers&&f.headers["content-type"]);try{v=new TextDecoder(A).decode(m)}catch{}}else v=String.fromCharCode.apply(null,new Uint8Array(m));e({cause:v});return}e(null,m)}};function o(a){return a===void 0&&(a=""),a.toLowerCase().split(";").reduce(function(e,r){var l=r.split("="),f=l[0],m=l[1];return f.trim()==="charset"?m.trim():e},"utf-8")}return Mf=s,Mf}var av;function pS(){if(av)return Hc.exports;av=1;var d=y0(),s=nS(),o=rS();f.httpHandler=fS();/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Björklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var a=function(P){var U={};return P&&P.trim().split(`
`).forEach(function(W){var Y=W.indexOf(":"),q=W.slice(0,Y).trim().toLowerCase(),_e=W.slice(Y+1).trim();typeof U[q]>"u"?U[q]=_e:Array.isArray(U[q])?U[q].push(_e):U[q]=[U[q],_e]}),U};Hc.exports=f,Hc.exports.default=f,f.XMLHttpRequest=d.XMLHttpRequest||A,f.XDomainRequest="withCredentials"in new f.XMLHttpRequest?f.XMLHttpRequest:d.XDomainRequest,e(["get","put","post","patch","head","delete"],function(L){f[L==="delete"?"del":L]=function(P,U,W){return U=l(P,U,W),U.method=L.toUpperCase(),m(U)}});function e(L,P){for(var U=0;U<L.length;U++)P(L[U])}function r(L){for(var P in L)if(L.hasOwnProperty(P))return!1;return!0}function l(L,P,U){var W=L;return o(P)?(U=P,typeof L=="string"&&(W={uri:L})):W=s({},P,{uri:L}),W.callback=U,W}function f(L,P,U){return P=l(L,P,U),m(P)}function m(L){if(typeof L.callback>"u")throw new Error("callback argument missing");var P=!1,U=function(Kt,Jt,hi){P||(P=!0,L.callback(Kt,Jt,hi))};function W(){J.readyState===4&&setTimeout(_e,0)}function Y(){var ut=void 0;if(J.response?ut=J.response:ut=J.responseText||v(J),Ce)try{ut=JSON.parse(ut)}catch{}return ut}function q(ut){return clearTimeout(vt),ut instanceof Error||(ut=new Error(""+(ut||"Unknown XMLHttpRequest Error"))),ut.statusCode=0,U(ut,je)}function _e(){if(!Me){var ut;clearTimeout(vt),L.useXDR&&J.status===void 0?ut=200:ut=J.status===1223?204:J.status;var Kt=je,Jt=null;return ut!==0?(Kt={body:Y(),statusCode:ut,method:ze,headers:{},url:Le,rawRequest:J},J.getAllResponseHeaders&&(Kt.headers=a(J.getAllResponseHeaders()))):Jt=new Error("Internal XMLHttpRequest Error"),U(Jt,Kt,Kt.body)}}var J=L.xhr||null;J||(L.cors||L.useXDR?J=new f.XDomainRequest:J=new f.XMLHttpRequest);var at,Me,Le=J.url=L.uri||L.url,ze=J.method=L.method||"GET",De=L.body||L.data,Ee=J.headers=L.headers||{},We=!!L.sync,Ce=!1,vt,je={body:void 0,headers:{},statusCode:0,method:ze,url:Le,rawRequest:J};if("json"in L&&L.json!==!1&&(Ce=!0,Ee.accept||Ee.Accept||(Ee.Accept="application/json"),ze!=="GET"&&ze!=="HEAD"&&(Ee["content-type"]||Ee["Content-Type"]||(Ee["Content-Type"]="application/json"),De=JSON.stringify(L.json===!0?De:L.json))),J.onreadystatechange=W,J.onload=_e,J.onerror=q,J.onprogress=function(){},J.onabort=function(){Me=!0},J.ontimeout=q,J.open(ze,Le,!We,L.username,L.password),We||(J.withCredentials=!!L.withCredentials),!We&&L.timeout>0&&(vt=setTimeout(function(){if(!Me){Me=!0,J.abort("timeout");var ut=new Error("XMLHttpRequest timeout");ut.code="ETIMEDOUT",q(ut)}},L.timeout)),J.setRequestHeader)for(at in Ee)Ee.hasOwnProperty(at)&&J.setRequestHeader(at,Ee[at]);else if(L.headers&&!r(L.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in L&&(J.responseType=L.responseType),"beforeSend"in L&&typeof L.beforeSend=="function"&&L.beforeSend(J),J.send(De||null),J}function v(L){try{if(L.responseType==="document")return L.responseXML;var P=L.responseXML&&L.responseXML.documentElement.nodeName==="parsererror";if(L.responseType===""&&!P)return L.responseXML}catch{}return null}function A(){}return Hc.exports}var mS=pS();const _0=Xo(mS);function x0(){try{var d=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x0=function(){return!!d})()}function b0(d,s,o){if(x0())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,s);var e=new(d.bind.apply(d,a));return o&&No(e,o.prototype),e}function gS(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),Object.defineProperty(d,"prototype",{writable:!1}),s&&No(d,s)}var Cf={exports:{}},sv;function vS(){return sv||(sv=1,function(d,s){(function(o){var a=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,f={buildAbsoluteURL:function(m,v,A){if(A=A||{},m=m.trim(),v=v.trim(),!v){if(!A.alwaysNormalize)return m;var L=f.parseURL(m);if(!L)throw new Error("Error trying to parse base URL.");return L.path=f.normalizePath(L.path),f.buildURLFromParts(L)}var P=f.parseURL(v);if(!P)throw new Error("Error trying to parse relative URL.");if(P.scheme)return A.alwaysNormalize?(P.path=f.normalizePath(P.path),f.buildURLFromParts(P)):v;var U=f.parseURL(m);if(!U)throw new Error("Error trying to parse base URL.");if(!U.netLoc&&U.path&&U.path[0]!=="/"){var W=e.exec(U.path);U.netLoc=W[1],U.path=W[2]}U.netLoc&&!U.path&&(U.path="/");var Y={scheme:U.scheme,netLoc:P.netLoc,path:null,params:P.params,query:P.query,fragment:P.fragment};if(!P.netLoc&&(Y.netLoc=U.netLoc,P.path[0]!=="/"))if(!P.path)Y.path=U.path,P.params||(Y.params=U.params,P.query||(Y.query=U.query));else{var q=U.path,_e=q.substring(0,q.lastIndexOf("/")+1)+P.path;Y.path=f.normalizePath(_e)}return Y.path===null&&(Y.path=A.alwaysNormalize?f.normalizePath(P.path):P.path),f.buildURLFromParts(Y)},parseURL:function(m){var v=a.exec(m);return v?{scheme:v[1]||"",netLoc:v[2]||"",path:v[3]||"",params:v[4]||"",query:v[5]||"",fragment:v[6]||""}:null},normalizePath:function(m){for(m=m.split("").reverse().join("").replace(r,"");m.length!==(m=m.replace(l,"")).length;);return m.split("").reverse().join("")},buildURLFromParts:function(m){return m.scheme+m.netLoc+m.path+m.params+m.query+m.fragment}};d.exports=f})()}(Cf)),Cf.exports}var yS=vS();const ov=Xo(yS);var lv="http://example.com",bd=function(s,o){if(/^[a-z]+:/i.test(o))return o;/^data:/.test(s)&&(s=ie.location&&ie.location.href||"");var a=typeof ie.URL=="function",e=/^\/\//.test(s),r=!ie.location&&!/\/\//i.test(s);if(a?s=new ie.URL(s,ie.location||lv):/\/\//i.test(s)||(s=ov.buildAbsoluteURL(ie.location&&ie.location.href||"",s)),a){var l=new URL(o,s);return r?l.href.slice(lv.length):e?l.href.slice(l.protocol.length):l.href}return ov.buildAbsoluteURL(s,o)},Sp=function(){function d(){this.listeners={}}var s=d.prototype;return s.on=function(a,e){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(e)},s.off=function(a,e){if(!this.listeners[a])return!1;var r=this.listeners[a].indexOf(e);return this.listeners[a]=this.listeners[a].slice(0),this.listeners[a].splice(r,1),r>-1},s.trigger=function(a){var e=this.listeners[a];if(e)if(arguments.length===2)for(var r=e.length,l=0;l<r;++l)e[l].call(this,arguments[1]);else for(var f=Array.prototype.slice.call(arguments,1),m=e.length,v=0;v<m;++v)e[v].apply(this,f)},s.dispose=function(){this.listeners={}},s.pipe=function(a){this.on("data",function(e){a.push(e)})},d}(),_S=function(s){return ie.atob?ie.atob(s):Buffer.from(s,"base64").toString("binary")};function T0(d){for(var s=_S(d),o=new Uint8Array(s.length),a=0;a<s.length;a++)o[a]=s.charCodeAt(a);return o}/*! @name m3u8-parser @version 4.8.0 @license Apache-2.0 */var xS=function(d){it(s,d);function s(){var a;return a=d.call(this)||this,a.buffer="",a}var o=s.prototype;return o.push=function(e){var r;for(this.buffer+=e,r=this.buffer.indexOf(`
`);r>-1;r=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,r)),this.buffer=this.buffer.substring(r+1)},s}(Sp),bS="	",Pf=function(s){var o=/([0-9.]*)?@?([0-9.]*)?/.exec(s||""),a={};return o[1]&&(a.length=parseInt(o[1],10)),o[2]&&(a.offset=parseInt(o[2],10)),a},TS=function(){var s="[^=]*",o='"[^"]*"|[^,]*',a="(?:"+s+")=(?:"+o+")";return new RegExp("(?:^|,)("+a+")")},Tr=function(s){for(var o=s.split(TS()),a={},e=o.length,r;e--;)o[e]!==""&&(r=/([^=]*)=(.*)/.exec(o[e]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),a[r[0]]=r[1]);return a},AS=function(d){it(s,d);function s(){var a;return a=d.call(this)||this,a.customParsers=[],a.tagMappers=[],a}var o=s.prototype;return o.push=function(e){var r=this,l,f;if(e=e.trim(),e.length!==0){if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}var m=this.tagMappers.reduce(function(v,A){var L=A(e);return L===e?v:v.concat([L])},[e]);m.forEach(function(v){for(var A=0;A<r.customParsers.length;A++)if(r.customParsers[A].call(r,v))return;if(v.indexOf("#EXT")!==0){r.trigger("data",{type:"comment",text:v.slice(1)});return}if(v=v.replace("\r",""),l=/^#EXTM3U/.exec(v),l){r.trigger("data",{type:"tag",tagType:"m3u"});return}if(l=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(v),l){f={type:"tag",tagType:"inf"},l[1]&&(f.duration=parseFloat(l[1])),l[2]&&(f.title=l[2]),r.trigger("data",f);return}if(l=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(v),l){f={type:"tag",tagType:"targetduration"},l[1]&&(f.duration=parseInt(l[1],10)),r.trigger("data",f);return}if(l=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(v),l){f={type:"tag",tagType:"version"},l[1]&&(f.version=parseInt(l[1],10)),r.trigger("data",f);return}if(l=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(v),l){f={type:"tag",tagType:"media-sequence"},l[1]&&(f.number=parseInt(l[1],10)),r.trigger("data",f);return}if(l=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(v),l){f={type:"tag",tagType:"discontinuity-sequence"},l[1]&&(f.number=parseInt(l[1],10)),r.trigger("data",f);return}if(l=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(v),l){f={type:"tag",tagType:"playlist-type"},l[1]&&(f.playlistType=l[1]),r.trigger("data",f);return}if(l=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(v),l){f=ba(Pf(l[1]),{type:"tag",tagType:"byterange"}),r.trigger("data",f);return}if(l=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(v),l){f={type:"tag",tagType:"allow-cache"},l[1]&&(f.allowed=!/NO/.test(l[1])),r.trigger("data",f);return}if(l=/^#EXT-X-MAP:?(.*)$/.exec(v),l){if(f={type:"tag",tagType:"map"},l[1]){var L=Tr(l[1]);L.URI&&(f.uri=L.URI),L.BYTERANGE&&(f.byterange=Pf(L.BYTERANGE))}r.trigger("data",f);return}if(l=/^#EXT-X-STREAM-INF:?(.*)$/.exec(v),l){if(f={type:"tag",tagType:"stream-inf"},l[1]){if(f.attributes=Tr(l[1]),f.attributes.RESOLUTION){var P=f.attributes.RESOLUTION.split("x"),U={};P[0]&&(U.width=parseInt(P[0],10)),P[1]&&(U.height=parseInt(P[1],10)),f.attributes.RESOLUTION=U}f.attributes.BANDWIDTH&&(f.attributes.BANDWIDTH=parseInt(f.attributes.BANDWIDTH,10)),f.attributes["FRAME-RATE"]&&(f.attributes["FRAME-RATE"]=parseFloat(f.attributes["FRAME-RATE"])),f.attributes["PROGRAM-ID"]&&(f.attributes["PROGRAM-ID"]=parseInt(f.attributes["PROGRAM-ID"],10))}r.trigger("data",f);return}if(l=/^#EXT-X-MEDIA:?(.*)$/.exec(v),l){f={type:"tag",tagType:"media"},l[1]&&(f.attributes=Tr(l[1])),r.trigger("data",f);return}if(l=/^#EXT-X-ENDLIST/.exec(v),l){r.trigger("data",{type:"tag",tagType:"endlist"});return}if(l=/^#EXT-X-DISCONTINUITY/.exec(v),l){r.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(l=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(v),l){f={type:"tag",tagType:"program-date-time"},l[1]&&(f.dateTimeString=l[1],f.dateTimeObject=new Date(l[1])),r.trigger("data",f);return}if(l=/^#EXT-X-KEY:?(.*)$/.exec(v),l){f={type:"tag",tagType:"key"},l[1]&&(f.attributes=Tr(l[1]),f.attributes.IV&&(f.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(f.attributes.IV=f.attributes.IV.substring(2)),f.attributes.IV=f.attributes.IV.match(/.{8}/g),f.attributes.IV[0]=parseInt(f.attributes.IV[0],16),f.attributes.IV[1]=parseInt(f.attributes.IV[1],16),f.attributes.IV[2]=parseInt(f.attributes.IV[2],16),f.attributes.IV[3]=parseInt(f.attributes.IV[3],16),f.attributes.IV=new Uint32Array(f.attributes.IV))),r.trigger("data",f);return}if(l=/^#EXT-X-START:?(.*)$/.exec(v),l){f={type:"tag",tagType:"start"},l[1]&&(f.attributes=Tr(l[1]),f.attributes["TIME-OFFSET"]=parseFloat(f.attributes["TIME-OFFSET"]),f.attributes.PRECISE=/YES/.test(f.attributes.PRECISE)),r.trigger("data",f);return}if(l=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(v),l){f={type:"tag",tagType:"cue-out-cont"},l[1]?f.data=l[1]:f.data="",r.trigger("data",f);return}if(l=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(v),l){f={type:"tag",tagType:"cue-out"},l[1]?f.data=l[1]:f.data="",r.trigger("data",f);return}if(l=/^#EXT-X-CUE-IN:?(.*)?$/.exec(v),l){f={type:"tag",tagType:"cue-in"},l[1]?f.data=l[1]:f.data="",r.trigger("data",f);return}if(l=/^#EXT-X-SKIP:(.*)$/.exec(v),l&&l[1]){f={type:"tag",tagType:"skip"},f.attributes=Tr(l[1]),f.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(f.attributes["SKIPPED-SEGMENTS"]=parseInt(f.attributes["SKIPPED-SEGMENTS"],10)),f.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(f.attributes["RECENTLY-REMOVED-DATERANGES"]=f.attributes["RECENTLY-REMOVED-DATERANGES"].split(bS)),r.trigger("data",f);return}if(l=/^#EXT-X-PART:(.*)$/.exec(v),l&&l[1]){f={type:"tag",tagType:"part"},f.attributes=Tr(l[1]),["DURATION"].forEach(function(W){f.attributes.hasOwnProperty(W)&&(f.attributes[W]=parseFloat(f.attributes[W]))}),["INDEPENDENT","GAP"].forEach(function(W){f.attributes.hasOwnProperty(W)&&(f.attributes[W]=/YES/.test(f.attributes[W]))}),f.attributes.hasOwnProperty("BYTERANGE")&&(f.attributes.byterange=Pf(f.attributes.BYTERANGE)),r.trigger("data",f);return}if(l=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(v),l&&l[1]){f={type:"tag",tagType:"server-control"},f.attributes=Tr(l[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(W){f.attributes.hasOwnProperty(W)&&(f.attributes[W]=parseFloat(f.attributes[W]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(W){f.attributes.hasOwnProperty(W)&&(f.attributes[W]=/YES/.test(f.attributes[W]))}),r.trigger("data",f);return}if(l=/^#EXT-X-PART-INF:(.*)$/.exec(v),l&&l[1]){f={type:"tag",tagType:"part-inf"},f.attributes=Tr(l[1]),["PART-TARGET"].forEach(function(W){f.attributes.hasOwnProperty(W)&&(f.attributes[W]=parseFloat(f.attributes[W]))}),r.trigger("data",f);return}if(l=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(v),l&&l[1]){f={type:"tag",tagType:"preload-hint"},f.attributes=Tr(l[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(W){if(f.attributes.hasOwnProperty(W)){f.attributes[W]=parseInt(f.attributes[W],10);var Y=W==="BYTERANGE-LENGTH"?"length":"offset";f.attributes.byterange=f.attributes.byterange||{},f.attributes.byterange[Y]=f.attributes[W],delete f.attributes[W]}}),r.trigger("data",f);return}if(l=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(v),l&&l[1]){f={type:"tag",tagType:"rendition-report"},f.attributes=Tr(l[1]),["LAST-MSN","LAST-PART"].forEach(function(W){f.attributes.hasOwnProperty(W)&&(f.attributes[W]=parseInt(f.attributes[W],10))}),r.trigger("data",f);return}r.trigger("data",{type:"tag",data:v.slice(4)})})}},o.addParser=function(e){var r=this,l=e.expression,f=e.customType,m=e.dataParser,v=e.segment;typeof m!="function"&&(m=function(L){return L}),this.customParsers.push(function(A){var L=l.exec(A);if(L)return r.trigger("data",{type:"custom",data:m(A),customType:f,segment:v}),!0})},o.addTagMapper=function(e){var r=e.expression,l=e.map,f=function(v){return r.test(v)?l(v):v};this.tagMappers.push(f)},s}(Sp),SS=function(s){return s.toLowerCase().replace(/-(\w)/g,function(o){return o[1].toUpperCase()})},Co=function(s){var o={};return Object.keys(s).forEach(function(a){o[SS(a)]=s[a]}),o},Lf=function(s){var o=s.serverControl,a=s.targetDuration,e=s.partTargetDuration;if(o){var r="#EXT-X-SERVER-CONTROL",l="holdBack",f="partHoldBack",m=a&&a*3,v=e&&e*2;a&&!o.hasOwnProperty(l)&&(o[l]=m,this.trigger("info",{message:r+" defaulting HOLD-BACK to targetDuration * 3 ("+m+")."})),m&&o[l]<m&&(this.trigger("warn",{message:r+" clamping HOLD-BACK ("+o[l]+") to targetDuration * 3 ("+m+")"}),o[l]=m),e&&!o.hasOwnProperty(f)&&(o[f]=e*3,this.trigger("info",{message:r+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+o[f]+")."})),e&&o[f]<v&&(this.trigger("warn",{message:r+" clamping PART-HOLD-BACK ("+o[f]+") to partTargetDuration * 2 ("+v+")."}),o[f]=v)}},wS=function(d){it(s,d);function s(){var a;a=d.call(this)||this,a.lineStream=new xS,a.parseStream=new AS,a.lineStream.pipe(a.parseStream);var e=Ft(a),r=[],l={},f,m,v=!1,A=function(){},L={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},P="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",U=0;a.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var W=0,Y=0;return a.on("end",function(){l.uri||!l.parts&&!l.preloadHints||(!l.map&&f&&(l.map=f),!l.key&&m&&(l.key=m),!l.timeline&&typeof U=="number"&&(l.timeline=U),a.manifest.preloadSegment=l)}),a.parseStream.on("data",function(q){var _e,J;({tag:function(){({version:function(){q.version&&(this.manifest.version=q.version)},"allow-cache":function(){this.manifest.allowCache=q.allowed,"allowed"in q||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var Le={};"length"in q&&(l.byterange=Le,Le.length=q.length,"offset"in q||(q.offset=W)),"offset"in q&&(l.byterange=Le,Le.offset=q.offset),W=Le.offset+Le.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),q.duration>0&&(l.duration=q.duration),q.duration===0&&(l.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=r},key:function(){if(!q.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(q.attributes.METHOD==="NONE"){m=null;return}if(!q.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(q.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:q.attributes};return}if(q.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:q.attributes.URI};return}if(q.attributes.KEYFORMAT===P){var Le=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];if(Le.indexOf(q.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(q.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),q.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(q.attributes.KEYID&&q.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:q.attributes.KEYFORMAT,keyId:q.attributes.KEYID.substring(2)},pssh:T0(q.attributes.URI.split(",")[1])};return}q.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),m={method:q.attributes.METHOD||"AES-128",uri:q.attributes.URI},typeof q.attributes.IV<"u"&&(m.iv=q.attributes.IV)},"media-sequence":function(){if(!isFinite(q.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+q.number});return}this.manifest.mediaSequence=q.number},"discontinuity-sequence":function(){if(!isFinite(q.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+q.number});return}this.manifest.discontinuitySequence=q.number,U=q.number},"playlist-type":function(){if(!/VOD|EVENT/.test(q.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+q.playlist});return}this.manifest.playlistType=q.playlistType},map:function(){f={},q.uri&&(f.uri=q.uri),q.byterange&&(f.byterange=q.byterange),m&&(f.key=m)},"stream-inf":function(){if(this.manifest.playlists=r,this.manifest.mediaGroups=this.manifest.mediaGroups||L,!q.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}l.attributes||(l.attributes={}),ba(l.attributes,q.attributes)},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||L,!(q.attributes&&q.attributes.TYPE&&q.attributes["GROUP-ID"]&&q.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var Le=this.manifest.mediaGroups[q.attributes.TYPE];Le[q.attributes["GROUP-ID"]]=Le[q.attributes["GROUP-ID"]]||{},_e=Le[q.attributes["GROUP-ID"]],J={default:/yes/i.test(q.attributes.DEFAULT)},J.default?J.autoselect=!0:J.autoselect=/yes/i.test(q.attributes.AUTOSELECT),q.attributes.LANGUAGE&&(J.language=q.attributes.LANGUAGE),q.attributes.URI&&(J.uri=q.attributes.URI),q.attributes["INSTREAM-ID"]&&(J.instreamId=q.attributes["INSTREAM-ID"]),q.attributes.CHARACTERISTICS&&(J.characteristics=q.attributes.CHARACTERISTICS),q.attributes.FORCED&&(J.forced=/yes/i.test(q.attributes.FORCED)),_e[q.attributes.NAME]=J},discontinuity:function(){U+=1,l.discontinuity=!0,this.manifest.discontinuityStarts.push(r.length)},"program-date-time":function(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=q.dateTimeString,this.manifest.dateTimeObject=q.dateTimeObject),l.dateTimeString=q.dateTimeString,l.dateTimeObject=q.dateTimeObject},targetduration:function(){if(!isFinite(q.duration)||q.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+q.duration});return}this.manifest.targetDuration=q.duration,Lf.call(this,this.manifest)},start:function(){if(!q.attributes||isNaN(q.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:q.attributes["TIME-OFFSET"],precise:q.attributes.PRECISE}},"cue-out":function(){l.cueOut=q.data},"cue-out-cont":function(){l.cueOutCont=q.data},"cue-in":function(){l.cueIn=q.data},skip:function(){this.manifest.skip=Co(q.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",q.attributes,["SKIPPED-SEGMENTS"])},part:function(){var Le=this;v=!0;var ze=this.manifest.segments.length,De=Co(q.attributes);l.parts=l.parts||[],l.parts.push(De),De.byterange&&(De.byterange.hasOwnProperty("offset")||(De.byterange.offset=Y),Y=De.byterange.offset+De.byterange.length);var Ee=l.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+Ee+" for segment #"+ze,q.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(We,Ce){We.hasOwnProperty("lastPart")||Le.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+Ce+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var Le=this.manifest.serverControl=Co(q.attributes);Le.hasOwnProperty("canBlockReload")||(Le.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Lf.call(this,this.manifest),Le.canSkipDateranges&&!Le.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var Le=this.manifest.segments.length,ze=Co(q.attributes),De=ze.type&&ze.type==="PART";l.preloadHints=l.preloadHints||[],l.preloadHints.push(ze),ze.byterange&&(ze.byterange.hasOwnProperty("offset")||(ze.byterange.offset=De?Y:0,De&&(Y=ze.byterange.offset+ze.byterange.length)));var Ee=l.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+Ee+" for segment #"+Le,q.attributes,["TYPE","URI"]),!!ze.type)for(var We=0;We<l.preloadHints.length-1;We++){var Ce=l.preloadHints[We];Ce.type&&Ce.type===ze.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+Ee+" for segment #"+Le+" has the same TYPE "+ze.type+" as preload hint #"+We})}},"rendition-report":function(){var Le=Co(q.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(Le);var ze=this.manifest.renditionReports.length-1,De=["LAST-MSN","URI"];v&&De.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+ze,q.attributes,De)},"part-inf":function(){this.manifest.partInf=Co(q.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",q.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Lf.call(this,this.manifest)}}[q.tagType]||A).call(e)},uri:function(){l.uri=q.uri,r.push(l),this.manifest.targetDuration&&!("duration"in l)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),l.duration=this.manifest.targetDuration),m&&(l.key=m),l.timeline=U,f&&(l.map=f),Y=0,l={}},comment:function(){},custom:function(){q.segment?(l.custom=l.custom||{},l.custom[q.customType]=q.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[q.customType]=q.data)}})[q.type].call(e)}),a}var o=s.prototype;return o.warnOnMissingAttributes_=function(e,r,l){var f=[];l.forEach(function(m){r.hasOwnProperty(m)||f.push(m)}),f.length&&this.trigger("warn",{message:e+" lacks required attribute(s): "+f.join(", ")})},o.push=function(e){this.lineStream.push(e)},o.end=function(){this.lineStream.push(`
`),this.trigger("end")},o.addParser=function(e){this.parseStream.addParser(e)},o.addTagMapper=function(e){this.parseStream.addTagMapper(e)},s}(Sp),Cs={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},ES=["video","audio","text"],uv=["Video","Audio","Text"],A0=function(s){return s&&s.replace(/avc1\.(\d+)\.(\d+)/i,function(o,a,e){var r=("00"+Number(a).toString(16)).slice(-2),l=("00"+Number(e).toString(16)).slice(-2);return"avc1."+r+"00"+l})},Wr=function(s){s===void 0&&(s="");var o=s.split(","),a=[];return o.forEach(function(e){e=e.trim();var r;ES.forEach(function(l){var f=Cs[l].exec(e.toLowerCase());if(!(!f||f.length<=1)){r=l;var m=e.substring(0,f[1].length),v=e.replace(m,"");a.push({type:m,details:v,mediaType:l})}}),r||a.push({type:e,details:"",mediaType:"unknown"})}),a},MS=function(s,o){if(!s.mediaGroups.AUDIO||!o)return null;var a=s.mediaGroups.AUDIO[o];if(!a)return null;for(var e in a){var r=a[e];if(r.default&&r.playlists)return Wr(r.playlists[0].attributes.CODECS)}return null},S0=function(s){return s===void 0&&(s=""),Cs.audio.test(s.trim().toLowerCase())},CS=function(s){return s===void 0&&(s=""),Cs.text.test(s.trim().toLowerCase())},gu=function(s){if(!(!s||typeof s!="string")){var o=s.toLowerCase().split(",").map(function(r){return A0(r.trim())}),a="video";o.length===1&&S0(o[0])?a="audio":o.length===1&&CS(o[0])&&(a="application");var e="mp4";return o.every(function(r){return Cs.mp4.test(r)})?e="mp4":o.every(function(r){return Cs.webm.test(r)})?e="webm":o.every(function(r){return Cs.ogg.test(r)})&&(e="ogg"),a+"/"+e+';codecs="'+s+'"'}},Zc=function(s){return s===void 0&&(s=""),ie.MediaSource&&ie.MediaSource.isTypeSupported&&ie.MediaSource.isTypeSupported(gu(s))||!1},If=function(s){return s===void 0&&(s=""),s.toLowerCase().split(",").every(function(o){o=o.trim();for(var a=0;a<uv.length;a++){var e=uv[a];if(Cs["muxer"+e].test(o))return!0}return!1})},cv="mp4a.40.2",PS="avc1.4d400d",LS=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,IS=/^application\/dash\+xml/i,w0=function(s){return LS.test(s)?"hls":IS.test(s)?"dash":s==="application/vnd.videojs.vhs+json"?"vhs-json":null},DS=function(s){return s.toString(2).length},RS=function(s){return Math.ceil(DS(s)/8)},E0=function(s){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer},OS=function(s){return E0(s)},St=function(s){return s instanceof Uint8Array?s:(!Array.isArray(s)&&!OS(s)&&!(s instanceof ArrayBuffer)&&(typeof s!="number"||typeof s=="number"&&s!==s?s=0:s=[s]),new Uint8Array(s&&s.buffer||s,s&&s.byteOffset||0,s&&s.byteLength||0))},un=ie.BigInt||Number,$f=[un("0x1"),un("0x100"),un("0x10000"),un("0x1000000"),un("0x100000000"),un("0x10000000000"),un("0x1000000000000"),un("0x100000000000000"),un("0x10000000000000000")];(function(){var d=new Uint16Array([65484]),s=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);return s[0]===255?"big":s[0]===204?"little":"unknown"})();var FS=function(s,o){var a=o===void 0?{}:o,e=a.signed,r=e===void 0?!1:e,l=a.le,f=l===void 0?!1:l;s=St(s);var m=f?"reduce":"reduceRight",v=s[m]?s[m]:Array.prototype[m],A=v.call(s,function(P,U,W){var Y=f?W:Math.abs(W+1-s.length);return P+un(U)*$f[Y]},un(0));if(r){var L=$f[s.length]/un(2)-un(1);A=un(A),A>L&&(A-=L,A-=L,A-=un(2))}return Number(A)},kS=function(s,o){var a={},e=a.le,r=e===void 0?!1:e;(typeof s!="bigint"&&typeof s!="number"||typeof s=="number"&&s!==s)&&(s=0),s=un(s);for(var l=RS(s),f=new Uint8Array(new ArrayBuffer(l)),m=0;m<l;m++){var v=r?m:Math.abs(m+1-f.length);f[v]=Number(s/$f[m]&un(255)),s<0&&(f[v]=Math.abs(~f[v]),f[v]-=m===0?1:2)}return f},M0=function(s,o){if(typeof s!="string"&&s&&typeof s.toString=="function"&&(s=s.toString()),typeof s!="string")return new Uint8Array;o||(s=unescape(encodeURIComponent(s)));for(var a=new Uint8Array(s.length),e=0;e<s.length;e++)a[e]=s.charCodeAt(e);return a},BS=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];if(o=o.filter(function(f){return f&&(f.byteLength||f.length)&&typeof f!="string"}),o.length<=1)return St(o[0]);var e=o.reduce(function(f,m,v){return f+(m.byteLength||m.length)},0),r=new Uint8Array(e),l=0;return o.forEach(function(f){f=St(f),r.set(f,l),l+=f.byteLength}),r},Ri=function(s,o,a){var e=a===void 0?{}:a,r=e.offset,l=r===void 0?0:r,f=e.mask,m=f===void 0?[]:f;s=St(s),o=St(o);var v=o.every?o.every:Array.prototype.every;return o.length&&s.length-l>=o.length&&v.call(o,function(A,L){var P=m[L]?m[L]&s[l+L]:s[l+L];return A===P})},NS=function(s,o,a){o.forEach(function(e){for(var r in s.mediaGroups[e])for(var l in s.mediaGroups[e][r]){var f=s.mediaGroups[e][r][l];a(f,e,r,l)}})};/*! @name mpd-parser @version 0.22.1 @license Apache-2.0 */var dv=function(s){return!!s&&typeof s=="object"},An=function d(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return o.reduce(function(e,r){return typeof r!="object"||Object.keys(r).forEach(function(l){Array.isArray(e[l])&&Array.isArray(r[l])?e[l]=e[l].concat(r[l]):dv(e[l])&&dv(r[l])?e[l]=d(e[l],r[l]):e[l]=r[l]}),e},{})},C0=function(s){return Object.keys(s).map(function(o){return s[o]})},US=function(s,o){for(var a=[],e=s;e<o;e++)a.push(e);return a},Td=function(s){return s.reduce(function(o,a){return o.concat(a)},[])},P0=function(s){if(!s.length)return[];for(var o=[],a=0;a<s.length;a++)o.push(s[a]);return o},HS=function(s,o){return s.reduce(function(a,e,r){return e[o]&&a.push(r),a},[])},Jf=function(s,o){for(var a=0;a<s.length;a++)if(o(s[a]))return a;return-1},VS=function(s,o){return C0(s.reduce(function(a,e){return e.forEach(function(r){a[o(r)]=r}),a},{}))},Uo={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"},vu=function(s){var o=s.baseUrl,a=o===void 0?"":o,e=s.source,r=e===void 0?"":e,l=s.range,f=l===void 0?"":l,m=s.indexRange,v=m===void 0?"":m,A={uri:r,resolvedUri:bd(a||"",r)};if(f||v){var L=f||v,P=L.split("-"),U=ie.BigInt?ie.BigInt(P[0]):parseInt(P[0],10),W=ie.BigInt?ie.BigInt(P[1]):parseInt(P[1],10);U<Number.MAX_SAFE_INTEGER&&typeof U=="bigint"&&(U=Number(U)),W<Number.MAX_SAFE_INTEGER&&typeof W=="bigint"&&(W=Number(W));var Y;typeof W=="bigint"||typeof U=="bigint"?Y=ie.BigInt(W)-ie.BigInt(U)+ie.BigInt(1):Y=W-U+1,typeof Y=="bigint"&&Y<Number.MAX_SAFE_INTEGER&&(Y=Number(Y)),A.byterange={length:Y,offset:U}}return A},GS=function(s){var o;return typeof s.offset=="bigint"||typeof s.length=="bigint"?o=ie.BigInt(s.offset)+ie.BigInt(s.length)-ie.BigInt(1):o=s.offset+s.length-1,s.offset+"-"+o},hv=function(s){return s&&typeof s!="number"&&(s=parseInt(s,10)),isNaN(s)?null:s},zS={static:function(s){var o=s.duration,a=s.timescale,e=a===void 0?1:a,r=s.sourceDuration,l=s.periodDuration,f=hv(s.endNumber),m=o/e;return typeof f=="number"?{start:0,end:f}:typeof l=="number"?{start:0,end:l/m}:{start:0,end:r/m}},dynamic:function(s){var o=s.NOW,a=s.clientOffset,e=s.availabilityStartTime,r=s.timescale,l=r===void 0?1:r,f=s.duration,m=s.periodStart,v=m===void 0?0:m,A=s.minimumUpdatePeriod,L=A===void 0?0:A,P=s.timeShiftBufferDepth,U=P===void 0?1/0:P,W=hv(s.endNumber),Y=(o+a)/1e3,q=e+v,_e=Y+L,J=_e-q,at=Math.ceil(J*l/f),Me=Math.floor((Y-q-U)*l/f),Le=Math.floor((Y-q)*l/f);return{start:Math.max(0,Me),end:typeof W=="number"?W:Math.min(at,Le)}}},WS=function(s){return function(o){var a=s.duration,e=s.timescale,r=e===void 0?1:e,l=s.periodStart,f=s.startNumber,m=f===void 0?1:f;return{number:m+o,duration:a/r,timeline:l,time:o*a}}},wp=function(s){var o=s.type,a=s.duration,e=s.timescale,r=e===void 0?1:e,l=s.periodDuration,f=s.sourceDuration,m=zS[o](s),v=m.start,A=m.end,L=US(v,A).map(WS(s));if(o==="static"){var P=L.length-1,U=typeof l=="number"?l:f;L[P].duration=U-a/r*P}return L},L0=function(s){var o=s.baseUrl,a=s.initialization,e=a===void 0?{}:a,r=s.sourceDuration,l=s.indexRange,f=l===void 0?"":l,m=s.periodStart,v=s.presentationTime,A=s.number,L=A===void 0?0:A,P=s.duration;if(!o)throw new Error(Uo.NO_BASE_URL);var U=vu({baseUrl:o,source:e.sourceURL,range:e.range}),W=vu({baseUrl:o,source:o,indexRange:f});if(W.map=U,P){var Y=wp(s);Y.length&&(W.duration=Y[0].duration,W.timeline=Y[0].timeline)}else r&&(W.duration=r,W.timeline=m);return W.presentationTime=v||m,W.number=L,[W]},Ep=function(s,o,a){var e=s.sidx.map?s.sidx.map:null,r=s.sidx.duration,l=s.timeline||0,f=s.sidx.byterange,m=f.offset+f.length,v=o.timescale,A=o.references.filter(function(We){return We.referenceType!==1}),L=[],P=s.endList?"static":"dynamic",U=s.sidx.timeline,W=U,Y=s.mediaSequence||0,q;typeof o.firstOffset=="bigint"?q=ie.BigInt(m)+o.firstOffset:q=m+o.firstOffset;for(var _e=0;_e<A.length;_e++){var J=o.references[_e],at=J.referencedSize,Me=J.subsegmentDuration,Le=void 0;typeof q=="bigint"?Le=q+ie.BigInt(at)-ie.BigInt(1):Le=q+at-1;var ze=q+"-"+Le,De={baseUrl:a,timescale:v,timeline:l,periodStart:U,presentationTime:W,number:Y,duration:Me,sourceDuration:r,indexRange:ze,type:P},Ee=L0(De)[0];e&&(Ee.map=e),L.push(Ee),typeof q=="bigint"?q+=ie.BigInt(at):q+=at,W+=Me/v,Y++}return s.segments=L,s},jS=["AUDIO","SUBTITLES"],qS=1/60,I0=function(s){return VS(s,function(o){var a=o.timeline;return a}).sort(function(o,a){return o.timeline>a.timeline?1:-1})},XS=function(s,o){for(var a=0;a<s.length;a++)if(s[a].attributes.NAME===o)return s[a];return null},fv=function(s){var o=[];return NS(s,jS,function(a,e,r,l){o=o.concat(a.playlists||[])}),o},pv=function(s){var o=s.playlist,a=s.mediaSequence;o.mediaSequence=a,o.segments.forEach(function(e,r){e.number=o.mediaSequence+r})},QS=function(s){var o=s.oldPlaylists,a=s.newPlaylists,e=s.timelineStarts;a.forEach(function(r){r.discontinuitySequence=Jf(e,function(A){var L=A.timeline;return L===r.timeline});var l=XS(o,r.attributes.NAME);if(l&&!r.sidx){var f=r.segments[0],m=Jf(l.segments,function(A){return Math.abs(A.presentationTime-f.presentationTime)<qS});if(m===-1){pv({playlist:r,mediaSequence:l.mediaSequence+l.segments.length}),r.segments[0].discontinuity=!0,r.discontinuityStarts.unshift(0),(!l.segments.length&&r.timeline>l.timeline||l.segments.length&&r.timeline>l.segments[l.segments.length-1].timeline)&&r.discontinuitySequence--;return}var v=l.segments[m];v.discontinuity&&!f.discontinuity&&(f.discontinuity=!0,r.discontinuityStarts.unshift(0),r.discontinuitySequence--),pv({playlist:r,mediaSequence:l.segments[m].number})}})},YS=function(s){var o=s.oldManifest,a=s.newManifest,e=o.playlists.concat(fv(o)),r=a.playlists.concat(fv(a));return a.timelineStarts=I0([o.timelineStarts,a.timelineStarts]),QS({oldPlaylists:e,newPlaylists:r,timelineStarts:a.timelineStarts}),a},Ad=function(s){return s&&s.uri+"-"+GS(s.byterange)},Df=function(s){var o=C0(s.reduce(function(a,e){var r=e.attributes.id+(e.attributes.lang||"");if(!a[r])a[r]=e,a[r].attributes.timelineStarts=[];else{if(e.segments){var l;e.segments[0]&&(e.segments[0].discontinuity=!0),(l=a[r].segments).push.apply(l,e.segments)}e.attributes.contentProtection&&(a[r].attributes.contentProtection=e.attributes.contentProtection)}return a[r].attributes.timelineStarts.push({start:e.attributes.periodStart,timeline:e.attributes.periodStart}),a},{}));return o.map(function(a){return a.discontinuityStarts=HS(a.segments||[],"discontinuity"),a})},Mp=function(s,o){var a=Ad(s.sidx),e=a&&o[a]&&o[a].sidx;return e&&Ep(s,e,s.sidx.resolvedUri),s},KS=function(s,o){if(o===void 0&&(o={}),!Object.keys(o).length)return s;for(var a in s)s[a]=Mp(s[a],o);return s},ZS=function(s,o){var a,e=s.attributes,r=s.segments,l=s.sidx,f=s.mediaSequence,m=s.discontinuitySequence,v=s.discontinuityStarts,A={attributes:(a={NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs},a["PROGRAM-ID"]=1,a),uri:"",endList:e.type==="static",timeline:e.periodStart,resolvedUri:"",targetDuration:e.duration,discontinuitySequence:m,discontinuityStarts:v,timelineStarts:e.timelineStarts,mediaSequence:f,segments:r};return e.contentProtection&&(A.contentProtection=e.contentProtection),l&&(A.sidx=l),o&&(A.attributes.AUDIO="audio",A.attributes.SUBTITLES="subs"),A},$S=function(s){var o,a=s.attributes,e=s.segments,r=s.mediaSequence,l=s.discontinuityStarts,f=s.discontinuitySequence;typeof e>"u"&&(e=[{uri:a.baseUrl,timeline:a.periodStart,resolvedUri:a.baseUrl||"",duration:a.sourceDuration,number:0}],a.duration=a.sourceDuration);var m=(o={NAME:a.id,BANDWIDTH:a.bandwidth},o["PROGRAM-ID"]=1,o);return a.codecs&&(m.CODECS=a.codecs),{attributes:m,uri:"",endList:a.type==="static",timeline:a.periodStart,resolvedUri:a.baseUrl||"",targetDuration:a.duration,timelineStarts:a.timelineStarts,discontinuityStarts:l,discontinuitySequence:f,mediaSequence:r,segments:e}},JS=function(s,o,a){o===void 0&&(o={}),a===void 0&&(a=!1);var e,r=s.reduce(function(f,m){var v=m.attributes.role&&m.attributes.role.value||"",A=m.attributes.lang||"",L=m.attributes.label||"main";if(A&&!m.attributes.label){var P=v?" ("+v+")":"";L=""+m.attributes.lang+P}f[L]||(f[L]={language:A,autoselect:!0,default:v==="main",playlists:[],uri:""});var U=Mp(ZS(m,a),o);return f[L].playlists.push(U),typeof e>"u"&&v==="main"&&(e=m,e.default=!0),f},{});if(!e){var l=Object.keys(r)[0];r[l].default=!0}return r},ew=function(s,o){return o===void 0&&(o={}),s.reduce(function(a,e){var r=e.attributes.lang||"text";return a[r]||(a[r]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),a[r].playlists.push(Mp($S(e),o)),a},{})},tw=function(s){return s.reduce(function(o,a){return a&&a.forEach(function(e){var r=e.channel,l=e.language;o[l]={autoselect:!1,default:!1,instreamId:r,language:l},e.hasOwnProperty("aspectRatio")&&(o[l].aspectRatio=e.aspectRatio),e.hasOwnProperty("easyReader")&&(o[l].easyReader=e.easyReader),e.hasOwnProperty("3D")&&(o[l]["3D"]=e["3D"])}),o},{})},iw=function(s){var o,a=s.attributes,e=s.segments,r=s.sidx,l=s.discontinuityStarts,f={attributes:(o={NAME:a.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:a.width,height:a.height},CODECS:a.codecs,BANDWIDTH:a.bandwidth},o["PROGRAM-ID"]=1,o),uri:"",endList:a.type==="static",timeline:a.periodStart,resolvedUri:"",targetDuration:a.duration,discontinuityStarts:l,timelineStarts:a.timelineStarts,segments:e};return a.frameRate&&(f.attributes["FRAME-RATE"]=a.frameRate),a.contentProtection&&(f.contentProtection=a.contentProtection),r&&(f.sidx=r),f},nw=function(s){var o=s.attributes;return o.mimeType==="video/mp4"||o.mimeType==="video/webm"||o.contentType==="video"},rw=function(s){var o=s.attributes;return o.mimeType==="audio/mp4"||o.mimeType==="audio/webm"||o.contentType==="audio"},aw=function(s){var o=s.attributes;return o.mimeType==="text/vtt"||o.contentType==="text"},sw=function(s,o){s.forEach(function(a){a.mediaSequence=0,a.discontinuitySequence=Jf(o,function(e){var r=e.timeline;return r===a.timeline}),a.segments&&a.segments.forEach(function(e,r){e.number=r})})},mv=function(s){return s?Object.keys(s).reduce(function(o,a){var e=s[a];return o.concat(e.playlists)},[]):[]},ow=function(s){var o,a=s.dashPlaylists,e=s.locations,r=s.sidxMapping,l=r===void 0?{}:r,f=s.previousManifest;if(!a.length)return{};var m=a[0].attributes,v=m.sourceDuration,A=m.type,L=m.suggestedPresentationDelay,P=m.minimumUpdatePeriod,U=Df(a.filter(nw)).map(iw),W=Df(a.filter(rw)),Y=Df(a.filter(aw)),q=a.map(function(De){return De.attributes.captionServices}).filter(Boolean),_e={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(o={AUDIO:{},VIDEO:{}},o["CLOSED-CAPTIONS"]={},o.SUBTITLES={},o),uri:"",duration:v,playlists:KS(U,l)};P>=0&&(_e.minimumUpdatePeriod=P*1e3),e&&(_e.locations=e),A==="dynamic"&&(_e.suggestedPresentationDelay=L);var J=_e.playlists.length===0,at=W.length?JS(W,l,J):null,Me=Y.length?ew(Y,l):null,Le=U.concat(mv(at),mv(Me)),ze=Le.map(function(De){var Ee=De.timelineStarts;return Ee});return _e.timelineStarts=I0(ze),sw(Le,_e.timelineStarts),at&&(_e.mediaGroups.AUDIO.audio=at),Me&&(_e.mediaGroups.SUBTITLES.subs=Me),q.length&&(_e.mediaGroups["CLOSED-CAPTIONS"].cc=tw(q)),f?YS({oldManifest:f,newManifest:_e}):_e},lw=function(s,o,a){var e=s.NOW,r=s.clientOffset,l=s.availabilityStartTime,f=s.timescale,m=f===void 0?1:f,v=s.periodStart,A=v===void 0?0:v,L=s.minimumUpdatePeriod,P=L===void 0?0:L,U=(e+r)/1e3,W=l+A,Y=U+P,q=Y-W;return Math.ceil((q*m-o)/a)},D0=function(s,o){for(var a=s.type,e=s.minimumUpdatePeriod,r=e===void 0?0:e,l=s.media,f=l===void 0?"":l,m=s.sourceDuration,v=s.timescale,A=v===void 0?1:v,L=s.startNumber,P=L===void 0?1:L,U=s.periodStart,W=[],Y=-1,q=0;q<o.length;q++){var _e=o[q],J=_e.d,at=_e.r||0,Me=_e.t||0;Y<0&&(Y=Me),Me&&Me>Y&&(Y=Me);var Le=void 0;if(at<0){var ze=q+1;ze===o.length?a==="dynamic"&&r>0&&f.indexOf("$Number$")>0?Le=lw(s,Y,J):Le=(m*A-Y)/J:Le=(o[ze].t-Y)/J}else Le=at+1;for(var De=P+W.length+Le,Ee=P+W.length;Ee<De;)W.push({number:Ee,duration:J/A,time:Y,timeline:U}),Y+=J,Ee++}return W},uw=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,cw=function(s){return function(o,a,e,r){if(o==="$$")return"$";if(typeof s[a]>"u")return o;var l=""+s[a];return a==="RepresentationID"||(e?r=parseInt(r,10):r=1,l.length>=r)?l:""+new Array(r-l.length+1).join("0")+l}},gv=function(s,o){return s.replace(uw,cw(o))},dw=function(s,o){return!s.duration&&!o?[{number:s.startNumber||1,duration:s.sourceDuration,time:0,timeline:s.periodStart}]:s.duration?wp(s):D0(s,o)},hw=function(s,o){var a={RepresentationID:s.id,Bandwidth:s.bandwidth||0},e=s.initialization,r=e===void 0?{sourceURL:"",range:""}:e,l=vu({baseUrl:s.baseUrl,source:gv(r.sourceURL,a),range:r.range}),f=dw(s,o);return f.map(function(m){a.Number=m.number,a.Time=m.time;var v=gv(s.media||"",a),A=s.timescale||1,L=s.presentationTimeOffset||0,P=s.periodStart+(m.time-L)/A,U={uri:v,timeline:m.timeline,duration:m.duration,resolvedUri:bd(s.baseUrl||"",v),map:l,number:m.number,presentationTime:P};return U})},fw=function(s,o){var a=s.baseUrl,e=s.initialization,r=e===void 0?{}:e,l=vu({baseUrl:a,source:r.sourceURL,range:r.range}),f=vu({baseUrl:a,source:o.media,range:o.mediaRange});return f.map=l,f},pw=function(s,o){var a=s.duration,e=s.segmentUrls,r=e===void 0?[]:e,l=s.periodStart;if(!a&&!o||a&&o)throw new Error(Uo.SEGMENT_TIME_UNSPECIFIED);var f=r.map(function(A){return fw(s,A)}),m;a&&(m=wp(s)),o&&(m=D0(s,o));var v=m.map(function(A,L){if(f[L]){var P=f[L],U=s.timescale||1,W=s.presentationTimeOffset||0;return P.timeline=A.timeline,P.duration=A.duration,P.number=A.number,P.presentationTime=l+(A.time-W)/U,P}}).filter(function(A){return A});return v},mw=function(s){var o=s.attributes,a=s.segmentInfo,e,r;a.template?(r=hw,e=An(o,a.template)):a.base?(r=L0,e=An(o,a.base)):a.list&&(r=pw,e=An(o,a.list));var l={attributes:o};if(!r)return l;var f=r(e,a.segmentTimeline);if(e.duration){var m=e,v=m.duration,A=m.timescale,L=A===void 0?1:A;e.duration=v/L}else f.length?e.duration=f.reduce(function(P,U){return Math.max(P,Math.ceil(U.duration))},0):e.duration=0;return l.attributes=e,l.segments=f,a.base&&e.indexRange&&(l.sidx=f[0],l.segments=[]),l},gw=function(s){return s.map(mw)},Wi=function(s,o){return P0(s.childNodes).filter(function(a){var e=a.tagName;return e===o})},Cp=function(s){return s.textContent.trim()},vw=function(s){return parseFloat(s.split("/").reduce(function(o,a){return o/a}))},Po=function(s){var o=31536e3,a=30*24*60*60,e=24*60*60,r=60*60,l=60,f=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/,m=f.exec(s);if(!m)return 0;var v=m.slice(1),A=v[0],L=v[1],P=v[2],U=v[3],W=v[4],Y=v[5];return parseFloat(A||0)*o+parseFloat(L||0)*a+parseFloat(P||0)*e+parseFloat(U||0)*r+parseFloat(W||0)*l+parseFloat(Y||0)},yw=function(s){var o=/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/;return o.test(s)&&(s+="Z"),Date.parse(s)},vv={mediaPresentationDuration:function(s){return Po(s)},availabilityStartTime:function(s){return yw(s)/1e3},minimumUpdatePeriod:function(s){return Po(s)},suggestedPresentationDelay:function(s){return Po(s)},type:function(s){return s},timeShiftBufferDepth:function(s){return Po(s)},start:function(s){return Po(s)},width:function(s){return parseInt(s,10)},height:function(s){return parseInt(s,10)},bandwidth:function(s){return parseInt(s,10)},frameRate:function(s){return vw(s)},startNumber:function(s){return parseInt(s,10)},timescale:function(s){return parseInt(s,10)},presentationTimeOffset:function(s){return parseInt(s,10)},duration:function(s){var o=parseInt(s,10);return isNaN(o)?Po(s):o},d:function(s){return parseInt(s,10)},t:function(s){return parseInt(s,10)},r:function(s){return parseInt(s,10)},DEFAULT:function(s){return s}},gn=function(s){return s&&s.attributes?P0(s.attributes).reduce(function(o,a){var e=vv[a.name]||vv.DEFAULT;return o[a.name]=e(a.value),o},{}):{}},_w={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Sd=function(s,o){return o.length?Td(s.map(function(a){return o.map(function(e){return bd(a,Cp(e))})})):s},Pp=function(s){var o=Wi(s,"SegmentTemplate")[0],a=Wi(s,"SegmentList")[0],e=a&&Wi(a,"SegmentURL").map(function(P){return An({tag:"SegmentURL"},gn(P))}),r=Wi(s,"SegmentBase")[0],l=a||o,f=l&&Wi(l,"SegmentTimeline")[0],m=a||r||o,v=m&&Wi(m,"Initialization")[0],A=o&&gn(o);A&&v?A.initialization=v&&gn(v):A&&A.initialization&&(A.initialization={sourceURL:A.initialization});var L={template:A,segmentTimeline:f&&Wi(f,"S").map(function(P){return gn(P)}),list:a&&An(gn(a),{segmentUrls:e,initialization:gn(v)}),base:r&&An(gn(r),{initialization:gn(v)})};return Object.keys(L).forEach(function(P){L[P]||delete L[P]}),L},xw=function(s,o,a){return function(e){var r=Wi(e,"BaseURL"),l=Sd(o,r),f=An(s,gn(e)),m=Pp(e);return l.map(function(v){return{segmentInfo:An(a,m),attributes:An(f,{baseUrl:v})}})}},bw=function(s){return s.reduce(function(o,a){var e=gn(a);e.schemeIdUri&&(e.schemeIdUri=e.schemeIdUri.toLowerCase());var r=_w[e.schemeIdUri];if(r){o[r]={attributes:e};var l=Wi(a,"cenc:pssh")[0];if(l){var f=Cp(l);o[r].pssh=f&&T0(f)}}return o},{})},Tw=function(s){if(s.schemeIdUri==="urn:scte:dash:cc:cea-608:2015"){var o=typeof s.value!="string"?[]:s.value.split(";");return o.map(function(e){var r,l;if(l=e,/^CC\d=/.test(e)){var f=e.split("=");r=f[0],l=f[1]}else/^CC\d$/.test(e)&&(r=e);return{channel:r,language:l}})}else if(s.schemeIdUri==="urn:scte:dash:cc:cea-708:2015"){var a=typeof s.value!="string"?[]:s.value.split(";");return a.map(function(e){var r={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){var l=e.split("="),f=l[0],m=l[1],v=m===void 0?"":m;r.channel=f,r.language=e,v.split(",").forEach(function(A){var L=A.split(":"),P=L[0],U=L[1];P==="lang"?r.language=U:P==="er"?r.easyReader=Number(U):P==="war"?r.aspectRatio=Number(U):P==="3D"&&(r["3D"]=Number(U))})}else r.language=e;return r.channel&&(r.channel="SERVICE"+r.channel),r})}},Aw=function(s,o,a){return function(e){var r=gn(e),l=Sd(o,Wi(e,"BaseURL")),f=Wi(e,"Role")[0],m={role:gn(f)},v=An(s,r,m),A=Wi(e,"Accessibility")[0],L=Tw(gn(A));L&&(v=An(v,{captionServices:L}));var P=Wi(e,"Label")[0];if(P&&P.childNodes.length){var U=P.childNodes[0].nodeValue.trim();v=An(v,{label:U})}var W=bw(Wi(e,"ContentProtection"));Object.keys(W).length&&(v=An(v,{contentProtection:W}));var Y=Pp(e),q=Wi(e,"Representation"),_e=An(a,Y);return Td(q.map(xw(v,l,_e)))}},Sw=function(s,o){return function(a,e){var r=Sd(o,Wi(a.node,"BaseURL")),l=An(s,{periodStart:a.attributes.start});typeof a.attributes.duration=="number"&&(l.periodDuration=a.attributes.duration);var f=Wi(a.node,"AdaptationSet"),m=Pp(a.node);return Td(f.map(Aw(l,r,m)))}},ww=function(s){var o=s.attributes,a=s.priorPeriodAttributes,e=s.mpdType;return typeof o.start=="number"?o.start:a&&typeof a.start=="number"&&typeof a.duration=="number"?a.start+a.duration:!a&&e==="static"?0:null},Ew=function(s,o){o===void 0&&(o={});var a=o,e=a.manifestUri,r=e===void 0?"":e,l=a.NOW,f=l===void 0?Date.now():l,m=a.clientOffset,v=m===void 0?0:m,A=Wi(s,"Period");if(!A.length)throw new Error(Uo.INVALID_NUMBER_OF_PERIOD);var L=Wi(s,"Location"),P=gn(s),U=Sd([r],Wi(s,"BaseURL"));P.type=P.type||"static",P.sourceDuration=P.mediaPresentationDuration||0,P.NOW=f,P.clientOffset=v,L.length&&(P.locations=L.map(Cp));var W=[];return A.forEach(function(Y,q){var _e=gn(Y),J=W[q-1];_e.start=ww({attributes:_e,priorPeriodAttributes:J?J.attributes:null,mpdType:P.type}),W.push({node:Y,attributes:_e})}),{locations:P.locations,representationInfo:Td(W.map(Sw(P,U)))}},R0=function(s){if(s==="")throw new Error(Uo.DASH_EMPTY_MANIFEST);var o=new aS.DOMParser,a,e;try{a=o.parseFromString(s,"application/xml"),e=a&&a.documentElement.tagName==="MPD"?a.documentElement:null}catch{}if(!e||e&&e.getElementsByTagName("parsererror").length>0)throw new Error(Uo.DASH_INVALID_XML);return e},Mw=function(s){var o=Wi(s,"UTCTiming")[0];if(!o)return null;var a=gn(o);switch(a.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":a.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":a.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":a.method="DIRECT",a.value=Date.parse(a.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(Uo.UNSUPPORTED_UTC_TIMING_SCHEME)}return a},Cw=function(s,o){o===void 0&&(o={});var a=Ew(R0(s),o),e=gw(a.representationInfo);return ow({dashPlaylists:e,locations:a.locations,sidxMapping:o.sidxMapping,previousManifest:o.previousManifest})},Pw=function(s){return Mw(R0(s))},Rf,yv;function Lw(){if(yv)return Rf;yv=1;var d=Math.pow(2,32),s=function(o){var a=new DataView(o.buffer,o.byteOffset,o.byteLength),e;return a.getBigUint64?(e=a.getBigUint64(0),e<Number.MAX_SAFE_INTEGER?Number(e):e):a.getUint32(0)*d+a.getUint32(4)};return Rf={getUint64:s,MAX_UINT32:d},Rf}var Of,_v;function Iw(){if(_v)return Of;_v=1;var d=Lw().getUint64,s=function(o){var a=new DataView(o.buffer,o.byteOffset,o.byteLength),e={version:o[0],flags:new Uint8Array(o.subarray(1,4)),references:[],referenceId:a.getUint32(4),timescale:a.getUint32(8)},r=12;e.version===0?(e.earliestPresentationTime=a.getUint32(r),e.firstOffset=a.getUint32(r+4),r+=8):(e.earliestPresentationTime=d(o.subarray(r)),e.firstOffset=d(o.subarray(r+8)),r+=16),r+=2;var l=a.getUint16(r);for(r+=2;l>0;r+=12,l--)e.references.push({referenceType:(o[r]&128)>>>7,referencedSize:a.getUint32(r)&2147483647,subsegmentDuration:a.getUint32(r+4),startsWithSap:!!(o[r+8]&128),sapType:(o[r+8]&112)>>>4,sapDeltaTime:a.getUint32(r+8)&268435455});return e};return Of=s,Of}var Dw=Iw();const Rw=Xo(Dw);var Ow=St([73,68,51]),Fw=function(s,o){o===void 0&&(o=0),s=St(s);var a=s[o+5],e=s[o+6]<<21|s[o+7]<<14|s[o+8]<<7|s[o+9],r=(a&16)>>4;return r?e+20:e+10},cu=function d(s,o){return o===void 0&&(o=0),s=St(s),s.length-o<10||!Ri(s,Ow,{offset:o})?o:(o+=Fw(s,o),d(s,o))},xv=function(s){return typeof s=="string"?M0(s):s},kw=function(s){return Array.isArray(s)?s.map(function(o){return xv(o)}):[xv(s)]},Bw=function d(s,o,a){a===void 0&&(a=!1),o=kw(o),s=St(s);var e=[];if(!o.length)return e;for(var r=0;r<s.length;){var l=(s[r]<<24|s[r+1]<<16|s[r+2]<<8|s[r+3])>>>0,f=s.subarray(r+4,r+8);if(l===0)break;var m=r+l;if(m>s.length){if(a)break;m=s.length}var v=s.subarray(r+8,m);Ri(f,o[0])&&(o.length===1?e.push(v):e.push.apply(e,d(v,o.slice(1),a))),r=m}return e},Vc={EBML:St([26,69,223,163]),DocType:St([66,130]),Segment:St([24,83,128,103]),SegmentInfo:St([21,73,169,102]),Tracks:St([22,84,174,107]),Track:St([174]),TrackNumber:St([215]),DefaultDuration:St([35,227,131]),TrackEntry:St([174]),TrackType:St([131]),FlagDefault:St([136]),CodecID:St([134]),CodecPrivate:St([99,162]),VideoTrack:St([224]),AudioTrack:St([225]),Cluster:St([31,67,182,117]),Timestamp:St([231]),TimestampScale:St([42,215,177]),BlockGroup:St([160]),BlockDuration:St([155]),Block:St([161]),SimpleBlock:St([163])},ep=[128,64,32,16,8,4,2,1],Nw=function(s){for(var o=1,a=0;a<ep.length&&!(s&ep[a]);a++)o++;return o},id=function(s,o,a,e){a===void 0&&(a=!0),e===void 0&&(e=!1);var r=Nw(s[o]),l=s.subarray(o,o+r);return a&&(l=Array.prototype.slice.call(s,o,o+r),l[0]^=ep[r-1]),{length:r,value:FS(l,{signed:e}),bytes:l}},bv=function d(s){return typeof s=="string"?s.match(/.{1,2}/g).map(function(o){return d(o)}):typeof s=="number"?kS(s):s},Uw=function(s){return Array.isArray(s)?s.map(function(o){return bv(o)}):[bv(s)]},Hw=function d(s,o,a){if(a>=o.length)return o.length;var e=id(o,a,!1);if(Ri(s.bytes,e.bytes))return a;var r=id(o,a+e.length);return d(s,o,a+r.length+r.value+e.length)},Tv=function d(s,o){o=Uw(o),s=St(s);var a=[];if(!o.length)return a;for(var e=0;e<s.length;){var r=id(s,e,!1),l=id(s,e+r.length),f=e+r.length+l.length;l.value===127&&(l.value=Hw(r,s,f),l.value!==s.length&&(l.value-=f));var m=f+l.value>s.length?s.length:f+l.value,v=s.subarray(f,m);Ri(o[0],r.bytes)&&(o.length===1?a.push(v):a=a.concat(d(v,o.slice(1))));var A=r.length+l.length+v.length;e+=A}return a},Vw=St([0,0,0,1]),Gw=St([0,0,1]),zw=St([0,0,3]),Ww=function(s){for(var o=[],a=1;a<s.length-2;)Ri(s.subarray(a,a+3),zw)&&(o.push(a+2),a++),a++;if(o.length===0)return s;var e=s.length-o.length,r=new Uint8Array(e),l=0;for(a=0;a<e;l++,a++)l===o[0]&&(l++,o.shift()),r[a]=s[l];return r},O0=function(s,o,a,e){s=St(s),a=[].concat(a);for(var r=0,l,f=0;r<s.length&&(f<e||l);){var m=void 0;if(Ri(s.subarray(r),Vw)?m=4:Ri(s.subarray(r),Gw)&&(m=3),!m){r++;continue}if(f++,l)return Ww(s.subarray(l,r));var v=void 0;o==="h264"?v=s[r+m]&31:o==="h265"&&(v=s[r+m]>>1&63),a.indexOf(v)!==-1&&(l=r+m),r+=m+(o==="h264"?1:2)}return s.subarray(0,0)},jw=function(s,o,a){return O0(s,"h264",o,a)},qw=function(s,o,a){return O0(s,"h265",o,a)},bn={webm:St([119,101,98,109]),matroska:St([109,97,116,114,111,115,107,97]),flac:St([102,76,97,67]),ogg:St([79,103,103,83]),ac3:St([11,119]),riff:St([82,73,70,70]),avi:St([65,86,73]),wav:St([87,65,86,69]),"3gp":St([102,116,121,112,51,103]),mp4:St([102,116,121,112]),fmp4:St([115,116,121,112]),mov:St([102,116,121,112,113,116]),moov:St([109,111,111,118]),moof:St([109,111,111,102])},Ho={aac:function(s){var o=cu(s);return Ri(s,[255,16],{offset:o,mask:[255,22]})},mp3:function(s){var o=cu(s);return Ri(s,[255,2],{offset:o,mask:[255,6]})},webm:function(s){var o=Tv(s,[Vc.EBML,Vc.DocType])[0];return Ri(o,bn.webm)},mkv:function(s){var o=Tv(s,[Vc.EBML,Vc.DocType])[0];return Ri(o,bn.matroska)},mp4:function(s){if(Ho["3gp"](s)||Ho.mov(s))return!1;if(Ri(s,bn.mp4,{offset:4})||Ri(s,bn.fmp4,{offset:4})||Ri(s,bn.moof,{offset:4})||Ri(s,bn.moov,{offset:4}))return!0},mov:function(s){return Ri(s,bn.mov,{offset:4})},"3gp":function(s){return Ri(s,bn["3gp"],{offset:4})},ac3:function(s){var o=cu(s);return Ri(s,bn.ac3,{offset:o})},ts:function(s){if(s.length<189&&s.length>=1)return s[0]===71;for(var o=0;o+188<s.length&&o<188;){if(s[o]===71&&s[o+188]===71)return!0;o+=1}return!1},flac:function(s){var o=cu(s);return Ri(s,bn.flac,{offset:o})},ogg:function(s){return Ri(s,bn.ogg)},avi:function(s){return Ri(s,bn.riff)&&Ri(s,bn.avi,{offset:8})},wav:function(s){return Ri(s,bn.riff)&&Ri(s,bn.wav,{offset:8})},h264:function(s){return jw(s,7,3).length},h265:function(s){return qw(s,[32,33],3).length}},tp=Object.keys(Ho).filter(function(d){return d!=="ts"&&d!=="h264"&&d!=="h265"}).concat(["ts","h264","h265"]);tp.forEach(function(d){var s=Ho[d];Ho[d]=function(o){return s(St(o))}});var Xw=Ho,Lp=function(s){s=St(s);for(var o=0;o<tp.length;o++){var a=tp[o];if(Xw[a](s))return a}return""},Qw=function(s){return Bw(s,["moof"]).length>0},Ff,Av;function Yw(){if(Av)return Ff;Av=1;var d=9e4,s,o,a,e,r,l,f;return s=function(m){return m*d},o=function(m,v){return m*v},a=function(m){return m/d},e=function(m,v){return m/v},r=function(m,v){return s(e(m,v))},l=function(m,v){return o(a(m),v)},f=function(m,v,A){return a(A?m:m-v)},Ff={ONE_SECOND_IN_TS:d,secondsToVideoTs:s,secondsToAudioTs:o,videoTsToSeconds:a,audioTsToSeconds:e,audioTsToVideoTs:r,videoTsToAudioTs:l,metadataTsToSeconds:f},Ff}var nd=Yw();function ip(d){return ip=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ip(d)}function Kw(d){try{return Function.toString.call(d).indexOf("[native code]")!==-1}catch{return typeof d=="function"}}function np(d){var s=typeof Map=="function"?new Map:void 0;return np=function(a){if(a===null||!Kw(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(a))return s.get(a);s.set(a,e)}function e(){return b0(a,arguments,ip(this).constructor)}return e.prototype=Object.create(a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),No(e,a)},np(d)}/**
 * @license
 * Video.js 7.21.7 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */var F0="7.21.7",va={},Ja=function(s,o){return va[s]=va[s]||[],o&&(va[s]=va[s].concat(o)),va[s]},Zw=function(s,o){Ja(s,o)},k0=function(s,o){var a=Ja(s).indexOf(o);return a<=-1?!1:(va[s]=va[s].slice(),va[s].splice(a,1),!0)},$w=function(s,o){Ja(s,[].concat(o).map(function(a){var e=function r(){return k0(s,r),a.apply(void 0,arguments)};return e}))},rd={prefixed:!0},$c=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],Sv=$c[0],du;for(var Gc=0;Gc<$c.length;Gc++)if($c[Gc][1]in et){du=$c[Gc];break}if(du){for(var zc=0;zc<du.length;zc++)rd[Sv[zc]]=du[zc];rd.prefixed=du[0]!==Sv[0]}var On=[],Jw=function(s,o){return function(a,e,r){var l=o.levels[e],f=new RegExp("^("+l+")$");if(a!=="log"&&r.unshift(a.toUpperCase()+":"),r.unshift(s+":"),On){On.push([].concat(r));var m=On.length-1e3;On.splice(0,m>0?m:0)}if(ie.console){var v=ie.console[a];!v&&a==="debug"&&(v=ie.console.info||ie.console.log),!(!v||!l||!f.test(a))&&v[Array.isArray(r)?"apply":"call"](ie.console,r)}}};function B0(d){var s="info",o,a=function(){for(var r=arguments.length,l=new Array(r),f=0;f<r;f++)l[f]=arguments[f];o("log",s,l)};return o=Jw(d,a),a.createLogger=function(e){return B0(d+": "+e)},a.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:s},a.level=function(e){if(typeof e=="string"){if(!a.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');s=e}return s},a.history=function(){return On?[].concat(On):[]},a.history.filter=function(e){return(On||[]).filter(function(r){return new RegExp(".*"+e+".*").test(r[0])})},a.history.clear=function(){On&&(On.length=0)},a.history.disable=function(){On!==null&&(On.length=0,On=null)},a.history.enable=function(){On===null&&(On=[])},a.error=function(){for(var e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];return o("error",s,r)},a.warn=function(){for(var e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];return o("warn",s,r)},a.debug=function(){for(var e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];return o("debug",s,r)},a}var Xt=B0("VIDEOJS"),N0=Xt.createLogger,eE=Object.prototype.toString,U0=function(s){return Ta(s)?Object.keys(s):[]};function Fo(d,s){U0(d).forEach(function(o){return s(d[o],o)})}function tE(d,s,o){return o===void 0&&(o=0),U0(d).reduce(function(a,e){return s(a,d[e],e)},o)}function Gi(d){for(var s=arguments.length,o=new Array(s>1?s-1:0),a=1;a<s;a++)o[a-1]=arguments[a];return Object.assign?ba.apply(void 0,[d].concat(o)):(o.forEach(function(e){e&&Fo(e,function(r,l){d[l]=r})}),d)}function Ta(d){return!!d&&typeof d=="object"}function yu(d){return Ta(d)&&eE.call(d)==="[object Object]"&&d.constructor===Object}function _u(d,s){if(!d||!s)return"";if(typeof ie.getComputedStyle=="function"){var o;try{o=ie.getComputedStyle(d)}catch{return""}return o?o.getPropertyValue(s)||o[s]:""}return""}var an=ie.navigator&&ie.navigator.userAgent||"",wv=/AppleWebKit\/([\d.]+)/i.exec(an),iE=wv?parseFloat(wv.pop()):null,H0=/iPod/i.test(an),nE=function(){var d=an.match(/OS (\d+)_/i);return d&&d[1]?d[1]:null}(),Sa=/Android/i.test(an),Ip=function(){var d=an.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!d)return null;var s=d[1]&&parseFloat(d[1]),o=d[2]&&parseFloat(d[2]);return s&&o?parseFloat(d[1]+"."+d[2]):s||null}(),V0=Sa&&Ip<5&&iE<537,G0=/Firefox/i.test(an),Au=/Edg/i.test(an),wa=!Au&&(/Chrome/i.test(an)||/CriOS/i.test(an)),z0=function(){var d=an.match(/(Chrome|CriOS)\/(\d+)/);return d&&d[2]?parseFloat(d[2]):null}(),Su=function(){var d=/MSIE\s(\d+)\.\d/.exec(an),s=d&&parseFloat(d[1]);return!s&&/Trident\/7.0/i.test(an)&&/rv:11.0/.test(an)&&(s=11),s}(),Dp=/Safari/i.test(an)&&!wa&&!Sa&&!Au,W0=/Windows/i.test(an),Vo=!!(Qo()&&("ontouchstart"in ie||ie.navigator.maxTouchPoints||ie.DocumentTouch&&ie.document instanceof ie.DocumentTouch)),Rp=/iPad/i.test(an)||Dp&&Vo&&!/iPhone/i.test(an),Op=/iPhone/i.test(an)&&!Rp,En=Op||Rp||H0,wd=(Dp||En)&&!wa,rE=Object.freeze({__proto__:null,IS_IPOD:H0,IOS_VERSION:nE,IS_ANDROID:Sa,ANDROID_VERSION:Ip,IS_NATIVE_ANDROID:V0,IS_FIREFOX:G0,IS_EDGE:Au,IS_CHROME:wa,CHROME_VERSION:z0,IE_VERSION:Su,IS_SAFARI:Dp,IS_WINDOWS:W0,TOUCH_ENABLED:Vo,IS_IPAD:Rp,IS_IPHONE:Op,IS_IOS:En,IS_ANY_SAFARI:wd});function Ev(d){return typeof d=="string"&&!!d.trim()}function j0(d){if(d.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function aE(d){return new RegExp("(^|\\s)"+d+"($|\\s)")}function Qo(){return et===ie.document}function Yo(d){return Ta(d)&&d.nodeType===1}function q0(){try{return ie.parent!==ie.self}catch{return!0}}function X0(d){return function(s,o){if(!Ev(s))return et[d](null);Ev(o)&&(o=et.querySelector(o));var a=Yo(o)?o:et;return a[d]&&a[d](s)}}function ri(d,s,o,a){d===void 0&&(d="div"),s===void 0&&(s={}),o===void 0&&(o={});var e=et.createElement(d);return Object.getOwnPropertyNames(s).forEach(function(r){var l=s[r];r.indexOf("aria-")!==-1||r==="role"||r==="type"?(Xt.warn(`Setting attributes in the second argument of createEl()
has been deprecated. Use the third argument instead.
`+("createEl(type, properties, attributes). Attempting to set "+r+" to "+l+".")),e.setAttribute(r,l)):r==="textContent"?Ds(e,l):(e[r]!==l||r==="tabIndex")&&(e[r]=l)}),Object.getOwnPropertyNames(o).forEach(function(r){e.setAttribute(r,o[r])}),a&&kp(e,a),e}function Ds(d,s){return typeof d.textContent>"u"?d.innerText=s:d.textContent=s,d}function rp(d,s){s.firstChild?s.insertBefore(d,s.firstChild):s.appendChild(d)}function Ps(d,s){return j0(s),d.classList?d.classList.contains(s):aE(s).test(d.className)}function _a(d,s){return d.classList?d.classList.add(s):Ps(d,s)||(d.className=(d.className+" "+s).trim()),d}function wu(d,s){return d?(d.classList?d.classList.remove(s):(j0(s),d.className=d.className.split(/\s+/).filter(function(o){return o!==s}).join(" ")),d):(Xt.warn("removeClass was called with an element that doesn't exist"),null)}function Q0(d,s,o){var a=Ps(d,s);if(typeof o=="function"&&(o=o(d,s)),typeof o!="boolean"&&(o=!a),o!==a)return o?_a(d,s):wu(d,s),d}function Y0(d,s){Object.getOwnPropertyNames(s).forEach(function(o){var a=s[o];a===null||typeof a>"u"||a===!1?d.removeAttribute(o):d.setAttribute(o,a===!0?"":a)})}function ga(d){var s={},o=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(d&&d.attributes&&d.attributes.length>0)for(var a=d.attributes,e=a.length-1;e>=0;e--){var r=a[e].name,l=a[e].value;(typeof d[r]=="boolean"||o.indexOf(","+r+",")!==-1)&&(l=l!==null),s[r]=l}return s}function K0(d,s){return d.getAttribute(s)}function Go(d,s,o){d.setAttribute(s,o)}function Ed(d,s){d.removeAttribute(s)}function Z0(){et.body.focus(),et.onselectstart=function(){return!1}}function $0(){et.onselectstart=function(){return!0}}function zo(d){if(d&&d.getBoundingClientRect&&d.parentNode){var s=d.getBoundingClientRect(),o={};return["bottom","height","left","right","top","width"].forEach(function(a){s[a]!==void 0&&(o[a]=s[a])}),o.height||(o.height=parseFloat(_u(d,"height"))),o.width||(o.width=parseFloat(_u(d,"width"))),o}}function xu(d){if(!d||d&&!d.offsetParent)return{left:0,top:0,width:0,height:0};for(var s=d.offsetWidth,o=d.offsetHeight,a=0,e=0;d.offsetParent&&d!==et[rd.fullscreenElement];)a+=d.offsetLeft,e+=d.offsetTop,d=d.offsetParent;return{left:a,top:e,width:s,height:o}}function Md(d,s){var o={x:0,y:0};if(En)for(var a=d;a&&a.nodeName.toLowerCase()!=="html";){var e=_u(a,"transform");if(/^matrix/.test(e)){var r=e.slice(7,-1).split(/,\s/).map(Number);o.x+=r[4],o.y+=r[5]}else if(/^matrix3d/.test(e)){var l=e.slice(9,-1).split(/,\s/).map(Number);o.x+=l[12],o.y+=l[13]}a=a.parentNode}var f={},m=xu(s.target),v=xu(d),A=v.width,L=v.height,P=s.offsetY-(v.top-m.top),U=s.offsetX-(v.left-m.left);return s.changedTouches&&(U=s.changedTouches[0].pageX-v.left,P=s.changedTouches[0].pageY+v.top,En&&(U-=o.x,P-=o.y)),f.y=1-Math.max(0,Math.min(1,P/L)),f.x=Math.max(0,Math.min(1,U/A)),f}function J0(d){return Ta(d)&&d.nodeType===3}function Fp(d){for(;d.firstChild;)d.removeChild(d.firstChild);return d}function ey(d){return typeof d=="function"&&(d=d()),(Array.isArray(d)?d:[d]).map(function(s){if(typeof s=="function"&&(s=s()),Yo(s)||J0(s))return s;if(typeof s=="string"&&/\S/.test(s))return et.createTextNode(s)}).filter(function(s){return s})}function kp(d,s){return ey(s).forEach(function(o){return d.appendChild(o)}),d}function ty(d,s){return kp(Fp(d),s)}function bu(d){return d.button===void 0&&d.buttons===void 0||d.button===0&&d.buttons===void 0||d.type==="mouseup"&&d.button===0&&d.buttons===0?!0:!(d.button!==0||d.buttons!==1)}var es=X0("querySelector"),iy=X0("querySelectorAll"),ny=Object.freeze({__proto__:null,isReal:Qo,isEl:Yo,isInFrame:q0,createEl:ri,textContent:Ds,prependTo:rp,hasClass:Ps,addClass:_a,removeClass:wu,toggleClass:Q0,setAttributes:Y0,getAttributes:ga,getAttribute:K0,setAttribute:Go,removeAttribute:Ed,blockTextSelection:Z0,unblockTextSelection:$0,getBoundingClientRect:zo,findPosition:xu,getPointerPosition:Md,isTextNode:J0,emptyEl:Fp,normalizeContent:ey,appendContent:kp,insertContent:ty,isSingleLeftClick:bu,$:es,$$:iy}),ry=!1,ap,sE=function(){if(ap.options.autoSetup!==!1){var s=Array.prototype.slice.call(et.getElementsByTagName("video")),o=Array.prototype.slice.call(et.getElementsByTagName("audio")),a=Array.prototype.slice.call(et.getElementsByTagName("video-js")),e=s.concat(o,a);if(e&&e.length>0)for(var r=0,l=e.length;r<l;r++){var f=e[r];if(f&&f.getAttribute){if(f.player===void 0){var m=f.getAttribute("data-setup");m!==null&&ap(f)}}else{sp(1);break}}else ry||sp(1)}};function sp(d,s){Qo()&&(s&&(ap=s),ie.setTimeout(sE,d))}function op(){ry=!0,ie.removeEventListener("load",op)}Qo()&&(et.readyState==="complete"?op():ie.addEventListener("load",op));var ay=function(s){var o=et.createElement("style");return o.className=s,o},sy=function(s,o){s.styleSheet?s.styleSheet.cssText=o:s.textContent=o},oE=3,lE=oE;function Ea(){return lE++}var oy;ie.WeakMap||(oy=function(){function d(){this.vdata="vdata"+Math.floor(ie.performance&&ie.performance.now()||Date.now()),this.data={}}var s=d.prototype;return s.set=function(a,e){var r=a[this.vdata]||Ea();return a[this.vdata]||(a[this.vdata]=r),this.data[r]=e,this},s.get=function(a){var e=a[this.vdata];if(e)return this.data[e];Xt("We have no data for this element",a)},s.has=function(a){var e=a[this.vdata];return e in this.data},s.delete=function(a){var e=a[this.vdata];e&&(delete this.data[e],delete a[this.vdata])},d}());var Sn=ie.WeakMap?new WeakMap:new oy;function Mv(d,s){if(Sn.has(d)){var o=Sn.get(d);o.handlers[s].length===0&&(delete o.handlers[s],d.removeEventListener?d.removeEventListener(s,o.dispatcher,!1):d.detachEvent&&d.detachEvent("on"+s,o.dispatcher)),Object.getOwnPropertyNames(o.handlers).length<=0&&(delete o.handlers,delete o.dispatcher,delete o.disabled),Object.getOwnPropertyNames(o).length===0&&Sn.delete(d)}}function Bp(d,s,o,a){o.forEach(function(e){d(s,e,a)})}function Cd(d){if(d.fixed_)return d;function s(){return!0}function o(){return!1}if(!d||!d.isPropagationStopped||!d.isImmediatePropagationStopped){var a=d||ie.event;d={};for(var e in a)e!=="layerX"&&e!=="layerY"&&e!=="keyLocation"&&e!=="webkitMovementX"&&e!=="webkitMovementY"&&e!=="path"&&(e==="returnValue"&&a.preventDefault||(d[e]=a[e]));if(d.target||(d.target=d.srcElement||et),d.relatedTarget||(d.relatedTarget=d.fromElement===d.target?d.toElement:d.fromElement),d.preventDefault=function(){a.preventDefault&&a.preventDefault(),d.returnValue=!1,a.returnValue=!1,d.defaultPrevented=!0},d.defaultPrevented=!1,d.stopPropagation=function(){a.stopPropagation&&a.stopPropagation(),d.cancelBubble=!0,a.cancelBubble=!0,d.isPropagationStopped=s},d.isPropagationStopped=o,d.stopImmediatePropagation=function(){a.stopImmediatePropagation&&a.stopImmediatePropagation(),d.isImmediatePropagationStopped=s,d.stopPropagation()},d.isImmediatePropagationStopped=o,d.clientX!==null&&d.clientX!==void 0){var r=et.documentElement,l=et.body;d.pageX=d.clientX+(r&&r.scrollLeft||l&&l.scrollLeft||0)-(r&&r.clientLeft||l&&l.clientLeft||0),d.pageY=d.clientY+(r&&r.scrollTop||l&&l.scrollTop||0)-(r&&r.clientTop||l&&l.clientTop||0)}d.which=d.charCode||d.keyCode,d.button!==null&&d.button!==void 0&&(d.button=d.button&1?0:d.button&4?1:d.button&2?2:0)}return d.fixed_=!0,d}var Wc,uE=function(){if(typeof Wc!="boolean"){Wc=!1;try{var s=Object.defineProperty({},"passive",{get:function(){Wc=!0}});ie.addEventListener("test",null,s),ie.removeEventListener("test",null,s)}catch{}}return Wc},cE=["touchstart","touchmove"];function Kn(d,s,o){if(Array.isArray(s))return Bp(Kn,d,s,o);Sn.has(d)||Sn.set(d,{});var a=Sn.get(d);if(a.handlers||(a.handlers={}),a.handlers[s]||(a.handlers[s]=[]),o.guid||(o.guid=Ea()),a.handlers[s].push(o),a.dispatcher||(a.disabled=!1,a.dispatcher=function(r,l){if(!a.disabled){r=Cd(r);var f=a.handlers[r.type];if(f)for(var m=f.slice(0),v=0,A=m.length;v<A&&!r.isImmediatePropagationStopped();v++)try{m[v].call(d,r,l)}catch(L){Xt.error(L)}}}),a.handlers[s].length===1)if(d.addEventListener){var e=!1;uE()&&cE.indexOf(s)>-1&&(e={passive:!0}),d.addEventListener(s,a.dispatcher,e)}else d.attachEvent&&d.attachEvent("on"+s,a.dispatcher)}function vn(d,s,o){if(Sn.has(d)){var a=Sn.get(d);if(a.handlers){if(Array.isArray(s))return Bp(vn,d,s,o);var e=function(v,A){a.handlers[A]=[],Mv(v,A)};if(s===void 0){for(var r in a.handlers)Object.prototype.hasOwnProperty.call(a.handlers||{},r)&&e(d,r);return}var l=a.handlers[s];if(l){if(!o){e(d,s);return}if(o.guid)for(var f=0;f<l.length;f++)l[f].guid===o.guid&&l.splice(f--,1);Mv(d,s)}}}}function Ko(d,s,o){var a=Sn.has(d)?Sn.get(d):{},e=d.parentNode||d.ownerDocument;if(typeof s=="string"?s={type:s,target:d}:s.target||(s.target=d),s=Cd(s),a.dispatcher&&a.dispatcher.call(d,s,o),e&&!s.isPropagationStopped()&&s.bubbles===!0)Ko.call(null,e,s,o);else if(!e&&!s.defaultPrevented&&s.target&&s.target[s.type]){Sn.has(s.target)||Sn.set(s.target,{});var r=Sn.get(s.target);s.target[s.type]&&(r.disabled=!0,typeof s.target[s.type]=="function"&&s.target[s.type](),r.disabled=!1)}return!s.defaultPrevented}function Pd(d,s,o){if(Array.isArray(s))return Bp(Pd,d,s,o);var a=function e(){vn(d,s,e),o.apply(this,arguments)};a.guid=o.guid=o.guid||Ea(),Kn(d,s,a)}function ly(d,s,o){var a=function e(){vn(d,s,e),o.apply(this,arguments)};a.guid=o.guid=o.guid||Ea(),Kn(d,s,a)}var dE=Object.freeze({__proto__:null,fixEvent:Cd,on:Kn,off:vn,trigger:Ko,one:Pd,any:ly}),wr=30,Pi=function(s,o,a){o.guid||(o.guid=Ea());var e=o.bind(s);return e.guid=a?a+"_"+o.guid:o.guid,e},Aa=function(s,o){var a=ie.performance.now(),e=function(){var l=ie.performance.now();l-a>=o&&(s.apply(void 0,arguments),a=l)};return e},hE=function(s,o,a,e){e===void 0&&(e=ie);var r,l=function(){e.clearTimeout(r),r=null},f=function(){var v=this,A=arguments,L=function(){r=null,L=null,s.apply(v,A)};e.clearTimeout(r),r=e.setTimeout(L,o)};return f.cancel=l,f},sn=function(){};sn.prototype.allowedEvents_={};sn.prototype.on=function(d,s){var o=this.addEventListener;this.addEventListener=function(){},Kn(this,d,s),this.addEventListener=o};sn.prototype.addEventListener=sn.prototype.on;sn.prototype.off=function(d,s){vn(this,d,s)};sn.prototype.removeEventListener=sn.prototype.off;sn.prototype.one=function(d,s){var o=this.addEventListener;this.addEventListener=function(){},Pd(this,d,s),this.addEventListener=o};sn.prototype.any=function(d,s){var o=this.addEventListener;this.addEventListener=function(){},ly(this,d,s),this.addEventListener=o};sn.prototype.trigger=function(d){var s=d.type||d;typeof d=="string"&&(d={type:s}),d=Cd(d),this.allowedEvents_[s]&&this["on"+s]&&this["on"+s](d),Ko(this,d)};sn.prototype.dispatchEvent=sn.prototype.trigger;var ou;sn.prototype.queueTrigger=function(d){var s=this;ou||(ou=new Map);var o=d.type||d,a=ou.get(this);a||(a=new Map,ou.set(this,a));var e=a.get(o);a.delete(o),ie.clearTimeout(e);var r=ie.setTimeout(function(){a.delete(o),a.size===0&&(a=null,ou.delete(s)),s.trigger(d)},0);a.set(o,r)};var Ld=function(s){return typeof s.name=="function"?s.name():typeof s.name=="string"?s.name:s.name_?s.name_:s.constructor&&s.constructor.name?s.constructor.name:typeof s},xa=function(s){return s instanceof sn||!!s.eventBusEl_&&["on","one","off","trigger"].every(function(o){return typeof s[o]=="function"})},fE=function(s,o){xa(s)?o():(s.eventedCallbacks||(s.eventedCallbacks=[]),s.eventedCallbacks.push(o))},lp=function(s){return typeof s=="string"&&/\S/.test(s)||Array.isArray(s)&&!!s.length},ad=function(s,o,a){if(!s||!s.nodeName&&!xa(s))throw new Error("Invalid target for "+Ld(o)+"#"+a+"; must be a DOM node or evented object.")},uy=function(s,o,a){if(!lp(s))throw new Error("Invalid event type for "+Ld(o)+"#"+a+"; must be a non-empty string or array.")},cy=function(s,o,a){if(typeof s!="function")throw new Error("Invalid listener for "+Ld(o)+"#"+a+"; must be a function.")},kf=function(s,o,a){var e=o.length<3||o[0]===s||o[0]===s.eventBusEl_,r,l,f;return e?(r=s.eventBusEl_,o.length>=3&&o.shift(),l=o[0],f=o[1]):(r=o[0],l=o[1],f=o[2]),ad(r,s,a),uy(l,s,a),cy(f,s,a),f=Pi(s,f),{isTargetingSelf:e,target:r,type:l,listener:f}},Ss=function(s,o,a,e){ad(s,s,o),s.nodeName?dE[o](s,a,e):s[o](a,e)},pE={on:function(){for(var s=this,o=arguments.length,a=new Array(o),e=0;e<o;e++)a[e]=arguments[e];var r=kf(this,a,"on"),l=r.isTargetingSelf,f=r.target,m=r.type,v=r.listener;if(Ss(f,"on",m,v),!l){var A=function(){return s.off(f,m,v)};A.guid=v.guid;var L=function(){return s.off("dispose",A)};L.guid=v.guid,Ss(this,"on","dispose",A),Ss(f,"on","dispose",L)}},one:function(){for(var s=this,o=arguments.length,a=new Array(o),e=0;e<o;e++)a[e]=arguments[e];var r=kf(this,a,"one"),l=r.isTargetingSelf,f=r.target,m=r.type,v=r.listener;if(l)Ss(f,"one",m,v);else{var A=function L(){s.off(f,m,L);for(var P=arguments.length,U=new Array(P),W=0;W<P;W++)U[W]=arguments[W];v.apply(null,U)};A.guid=v.guid,Ss(f,"one",m,A)}},any:function(){for(var s=this,o=arguments.length,a=new Array(o),e=0;e<o;e++)a[e]=arguments[e];var r=kf(this,a,"any"),l=r.isTargetingSelf,f=r.target,m=r.type,v=r.listener;if(l)Ss(f,"any",m,v);else{var A=function L(){s.off(f,m,L);for(var P=arguments.length,U=new Array(P),W=0;W<P;W++)U[W]=arguments[W];v.apply(null,U)};A.guid=v.guid,Ss(f,"any",m,A)}},off:function(s,o,a){if(!s||lp(s))vn(this.eventBusEl_,s,o);else{var e=s,r=o;ad(e,this,"off"),uy(r,this,"off"),cy(a,this,"off"),a=Pi(this,a),this.off("dispose",a),e.nodeName?(vn(e,r,a),vn(e,"dispose",a)):xa(e)&&(e.off(r,a),e.off("dispose",a))}},trigger:function(s,o){ad(this.eventBusEl_,this,"trigger");var a=s&&typeof s!="string"?s.type:s;if(!lp(a)){var e="Invalid event type for "+Ld(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(s)(this.log||Xt).error(e);else throw new Error(e)}return Ko(this.eventBusEl_,s,o)}};function Np(d,s){s===void 0&&(s={});var o=s,a=o.eventBusKey;if(a){if(!d[a].nodeName)throw new Error('The eventBusKey "'+a+'" does not refer to an element.');d.eventBusEl_=d[a]}else d.eventBusEl_=ri("span",{className:"vjs-event-bus"});return Gi(d,pE),d.eventedCallbacks&&d.eventedCallbacks.forEach(function(e){e()}),d.on("dispose",function(){d.off(),[d,d.el_,d.eventBusEl_].forEach(function(e){e&&Sn.has(e)&&Sn.delete(e)}),ie.setTimeout(function(){d.eventBusEl_=null},0)}),d}var mE={state:{},setState:function(s){var o=this;typeof s=="function"&&(s=s());var a;return Fo(s,function(e,r){o.state[r]!==e&&(a=a||{},a[r]={from:o.state[r],to:e}),o.state[r]=e}),a&&xa(this)&&this.trigger({changes:a,type:"statechanged"}),a}};function dy(d,s){return Gi(d,mE),d.state=Gi({},d.state,s),typeof d.handleStateChanged=="function"&&xa(d)&&d.on("statechanged",d.handleStateChanged),d}var Jc=function(s){return typeof s!="string"?s:s.replace(/./,function(o){return o.toLowerCase()})},ji=function(s){return typeof s!="string"?s:s.replace(/./,function(o){return o.toUpperCase()})},gE=function(s,o){return ji(s)===ji(o)};function Ci(){for(var d={},s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return o.forEach(function(e){e&&Fo(e,function(r,l){if(!yu(r)){d[l]=r;return}yu(d[l])||(d[l]={}),d[l]=Ci(d[l],r)})}),d}var vE=function(){function d(){this.map_={}}var s=d.prototype;return s.has=function(a){return a in this.map_},s.delete=function(a){var e=this.has(a);return delete this.map_[a],e},s.set=function(a,e){return this.map_[a]=e,this},s.forEach=function(a,e){for(var r in this.map_)a.call(e,this.map_[r],r,this)},d}(),yE=ie.Map?ie.Map:vE,_E=function(){function d(){this.set_={}}var s=d.prototype;return s.has=function(a){return a in this.set_},s.delete=function(a){var e=this.has(a);return delete this.set_[a],e},s.add=function(a){return this.set_[a]=1,this},s.forEach=function(a,e){for(var r in this.set_)a.call(e,r,r,this)},d}(),Bf=ie.Set?ie.Set:_E,qe=function(){function d(o,a,e){var r=this;if(!o&&this.play?this.player_=o=this:this.player_=o,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Ci({},this.options_),a=this.options_=Ci(this.options_,a),this.id_=a.id||a.el&&a.el.id,!this.id_){var l=o&&o.id&&o.id()||"no_player";this.id_=l+"_component_"+Ea()}this.name_=a.name||null,a.el?this.el_=a.el:a.createEl!==!1&&(this.el_=this.createEl()),a.className&&this.el_&&a.className.split(" ").forEach(function(f){return r.addClass(f)}),a.evented!==!1&&(Np(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),dy(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Bf,this.setIntervalIds_=new Bf,this.rafIds_=new Bf,this.namedRafs_=new yE,this.clearingTimersOnDispose_=!1,a.initChildren!==!1&&this.initChildren(),this.ready(e),a.reportTouchActivity!==!1&&this.enableTouchActivity()}var s=d.prototype;return s.dispose=function(a){if(a===void 0&&(a={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(a.restoreEl?this.el_.parentNode.replaceChild(a.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},s.isDisposed=function(){return!!this.isDisposed_},s.player=function(){return this.player_},s.options=function(a){return a?(this.options_=Ci(this.options_,a),this.options_):this.options_},s.el=function(){return this.el_},s.createEl=function(a,e,r){return ri(a,e,r)},s.localize=function(a,e,r){r===void 0&&(r=a);var l=this.player_.language&&this.player_.language(),f=this.player_.languages&&this.player_.languages(),m=f&&f[l],v=l&&l.split("-")[0],A=f&&f[v],L=r;return m&&m[a]?L=m[a]:A&&A[a]&&(L=A[a]),e&&(L=L.replace(/\{(\d+)\}/g,function(P,U){var W=e[U-1],Y=W;return typeof W>"u"&&(Y=P),Y})),L},s.handleLanguagechange=function(){},s.contentEl=function(){return this.contentEl_||this.el_},s.id=function(){return this.id_},s.name=function(){return this.name_},s.children=function(){return this.children_},s.getChildById=function(a){return this.childIndex_[a]},s.getChild=function(a){if(a)return this.childNameIndex_[a]},s.getDescendant=function(){for(var a=arguments.length,e=new Array(a),r=0;r<a;r++)e[r]=arguments[r];e=e.reduce(function(m,v){return m.concat(v)},[]);for(var l=this,f=0;f<e.length;f++)if(l=l.getChild(e[f]),!l||!l.getChild)return;return l},s.addChild=function(a,e,r){e===void 0&&(e={}),r===void 0&&(r=this.children_.length);var l,f;if(typeof a=="string"){f=ji(a);var m=e.componentClass||f;e.name=f;var v=d.getComponent(m);if(!v)throw new Error("Component "+m+" does not exist");if(typeof v!="function")return null;l=new v(this.player_||this,e)}else l=a;if(l.parentComponent_&&l.parentComponent_.removeChild(l),this.children_.splice(r,0,l),l.parentComponent_=this,typeof l.id=="function"&&(this.childIndex_[l.id()]=l),f=f||l.name&&ji(l.name()),f&&(this.childNameIndex_[f]=l,this.childNameIndex_[Jc(f)]=l),typeof l.el=="function"&&l.el()){var A=null;this.children_[r+1]&&(this.children_[r+1].el_?A=this.children_[r+1].el_:Yo(this.children_[r+1])&&(A=this.children_[r+1])),this.contentEl().insertBefore(l.el(),A)}return l},s.removeChild=function(a){if(typeof a=="string"&&(a=this.getChild(a)),!(!a||!this.children_)){for(var e=!1,r=this.children_.length-1;r>=0;r--)if(this.children_[r]===a){e=!0,this.children_.splice(r,1);break}if(e){a.parentComponent_=null,this.childIndex_[a.id()]=null,this.childNameIndex_[ji(a.name())]=null,this.childNameIndex_[Jc(a.name())]=null;var l=a.el();l&&l.parentNode===this.contentEl()&&this.contentEl().removeChild(a.el())}}},s.initChildren=function(){var a=this,e=this.options_.children;if(e){var r=this.options_,l=function(A){var L=A.name,P=A.opts;if(r[L]!==void 0&&(P=r[L]),P!==!1){P===!0&&(P={}),P.playerOptions=a.options_.playerOptions;var U=a.addChild(L,P);U&&(a[L]=U)}},f,m=d.getComponent("Tech");Array.isArray(e)?f=e:f=Object.keys(e),f.concat(Object.keys(this.options_).filter(function(v){return!f.some(function(A){return typeof A=="string"?v===A:v===A.name})})).map(function(v){var A,L;return typeof v=="string"?(A=v,L=e[A]||a.options_[A]||{}):(A=v.name,L=v),{name:A,opts:L}}).filter(function(v){var A=d.getComponent(v.opts.componentClass||ji(v.name));return A&&!m.isTech(A)}).forEach(l)}},s.buildCSSClass=function(){return""},s.ready=function(a,e){if(e===void 0&&(e=!1),!!a){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(a);return}e?a.call(this):this.setTimeout(a,1)}},s.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var a=this.readyQueue_;this.readyQueue_=[],a&&a.length>0&&a.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},s.$=function(a,e){return es(a,e||this.contentEl())},s.$$=function(a,e){return iy(a,e||this.contentEl())},s.hasClass=function(a){return Ps(this.el_,a)},s.addClass=function(a){_a(this.el_,a)},s.removeClass=function(a){wu(this.el_,a)},s.toggleClass=function(a,e){Q0(this.el_,a,e)},s.show=function(){this.removeClass("vjs-hidden")},s.hide=function(){this.addClass("vjs-hidden")},s.lockShowing=function(){this.addClass("vjs-lock-showing")},s.unlockShowing=function(){this.removeClass("vjs-lock-showing")},s.getAttribute=function(a){return K0(this.el_,a)},s.setAttribute=function(a,e){Go(this.el_,a,e)},s.removeAttribute=function(a){Ed(this.el_,a)},s.width=function(a,e){return this.dimension("width",a,e)},s.height=function(a,e){return this.dimension("height",a,e)},s.dimensions=function(a,e){this.width(a,!0),this.height(e)},s.dimension=function(a,e,r){if(e!==void 0){(e===null||e!==e)&&(e=0),(""+e).indexOf("%")!==-1||(""+e).indexOf("px")!==-1?this.el_.style[a]=e:e==="auto"?this.el_.style[a]="":this.el_.style[a]=e+"px",r||this.trigger("componentresize");return}if(!this.el_)return 0;var l=this.el_.style[a],f=l.indexOf("px");return parseInt(f!==-1?l.slice(0,f):this.el_["offset"+ji(a)],10)},s.currentDimension=function(a){var e=0;if(a!=="width"&&a!=="height")throw new Error("currentDimension only accepts width or height value");if(e=_u(this.el_,a),e=parseFloat(e),e===0||isNaN(e)){var r="offset"+ji(a);e=this.el_[r]}return e},s.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},s.currentWidth=function(){return this.currentDimension("width")},s.currentHeight=function(){return this.currentDimension("height")},s.focus=function(){this.el_.focus()},s.blur=function(){this.el_.blur()},s.handleKeyDown=function(a){this.player_&&(Nt.isEventKey(a,"Tab")||a.stopPropagation(),this.player_.handleKeyDown(a))},s.handleKeyPress=function(a){this.handleKeyDown(a)},s.emitTapEvents=function(){var a=0,e=null,r=10,l=200,f;this.on("touchstart",function(v){v.touches.length===1&&(e={pageX:v.touches[0].pageX,pageY:v.touches[0].pageY},a=ie.performance.now(),f=!0)}),this.on("touchmove",function(v){if(v.touches.length>1)f=!1;else if(e){var A=v.touches[0].pageX-e.pageX,L=v.touches[0].pageY-e.pageY,P=Math.sqrt(A*A+L*L);P>r&&(f=!1)}});var m=function(){f=!1};this.on("touchleave",m),this.on("touchcancel",m),this.on("touchend",function(v){if(e=null,f===!0){var A=ie.performance.now()-a;A<l&&(v.preventDefault(),this.trigger("tap"))}})},s.enableTouchActivity=function(){if(!(!this.player()||!this.player().reportUserActivity)){var a=Pi(this.player(),this.player().reportUserActivity),e;this.on("touchstart",function(){a(),this.clearInterval(e),e=this.setInterval(a,250)});var r=function(f){a(),this.clearInterval(e)};this.on("touchmove",a),this.on("touchend",r),this.on("touchcancel",r)}},s.setTimeout=function(a,e){var r=this,l;return a=Pi(this,a),this.clearTimersOnDispose_(),l=ie.setTimeout(function(){r.setTimeoutIds_.has(l)&&r.setTimeoutIds_.delete(l),a()},e),this.setTimeoutIds_.add(l),l},s.clearTimeout=function(a){return this.setTimeoutIds_.has(a)&&(this.setTimeoutIds_.delete(a),ie.clearTimeout(a)),a},s.setInterval=function(a,e){a=Pi(this,a),this.clearTimersOnDispose_();var r=ie.setInterval(a,e);return this.setIntervalIds_.add(r),r},s.clearInterval=function(a){return this.setIntervalIds_.has(a)&&(this.setIntervalIds_.delete(a),ie.clearInterval(a)),a},s.requestAnimationFrame=function(a){var e=this;if(!this.supportsRaf_)return this.setTimeout(a,1e3/60);this.clearTimersOnDispose_();var r;return a=Pi(this,a),r=ie.requestAnimationFrame(function(){e.rafIds_.has(r)&&e.rafIds_.delete(r),a()}),this.rafIds_.add(r),r},s.requestNamedAnimationFrame=function(a,e){var r=this;if(!this.namedRafs_.has(a)){this.clearTimersOnDispose_(),e=Pi(this,e);var l=this.requestAnimationFrame(function(){e(),r.namedRafs_.has(a)&&r.namedRafs_.delete(a)});return this.namedRafs_.set(a,l),a}},s.cancelNamedAnimationFrame=function(a){this.namedRafs_.has(a)&&(this.cancelAnimationFrame(this.namedRafs_.get(a)),this.namedRafs_.delete(a))},s.cancelAnimationFrame=function(a){return this.supportsRaf_?(this.rafIds_.has(a)&&(this.rafIds_.delete(a),ie.cancelAnimationFrame(a)),a):this.clearTimeout(a)},s.clearTimersOnDispose_=function(){var a=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(e){var r=e[0],l=e[1];a[r].forEach(function(f,m){return a[l](m)})}),a.clearingTimersOnDispose_=!1}))},d.registerComponent=function(a,e){if(typeof a!="string"||!a)throw new Error('Illegal component name, "'+a+'"; must be a non-empty string.');var r=d.getComponent("Tech"),l=r&&r.isTech(e),f=d===e||d.prototype.isPrototypeOf(e.prototype);if(l||!f){var m;throw l?m="techs must be registered using Tech.registerTech()":m="must be a Component subclass",new Error('Illegal component, "'+a+'"; '+m+".")}a=ji(a),d.components_||(d.components_={});var v=d.getComponent("Player");if(a==="Player"&&v&&v.players){var A=v.players,L=Object.keys(A);if(A&&L.length>0&&L.map(function(P){return A[P]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return d.components_[a]=e,d.components_[Jc(a)]=e,e},d.getComponent=function(a){if(!(!a||!d.components_))return d.components_[a]},d}();qe.prototype.supportsRaf_=typeof ie.requestAnimationFrame=="function"&&typeof ie.cancelAnimationFrame=="function";qe.registerComponent("Component",qe);function xE(d,s,o){if(typeof s!="number"||s<0||s>o)throw new Error("Failed to execute '"+d+"' on 'TimeRanges': The index provided ("+s+") is non-numeric or out of bounds (0-"+o+").")}function Cv(d,s,o,a){return xE(d,a,o.length-1),o[a][s]}function Nf(d){var s;return d===void 0||d.length===0?s={length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:s={length:d.length,start:Cv.bind(null,"start",0,d),end:Cv.bind(null,"end",1,d)},ie.Symbol&&ie.Symbol.iterator&&(s[ie.Symbol.iterator]=function(){return(d||[]).values()}),s}function Ls(d,s){return Array.isArray(d)?Nf(d):d===void 0||s===void 0?Nf():Nf([[d,s]])}function hy(d,s){var o=0,a,e;if(!s)return 0;(!d||!d.length)&&(d=Ls(0,0));for(var r=0;r<d.length;r++)a=d.start(r),e=d.end(r),e>s&&(e=s),o+=e-a;return o/s}function wn(d){if(d instanceof wn)return d;typeof d=="number"?this.code=d:typeof d=="string"?this.message=d:Ta(d)&&(typeof d.code=="number"&&(this.code=d.code),Gi(this,d)),this.message||(this.message=wn.defaultMessages[this.code]||"")}wn.prototype.code=0;wn.prototype.message="";wn.prototype.status=null;wn.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];wn.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var Lo=0;Lo<wn.errorTypes.length;Lo++)wn[wn.errorTypes[Lo]]=Lo,wn.prototype[wn.errorTypes[Lo]]=Lo;function fu(d){return d!=null&&typeof d.then=="function"}function qr(d){fu(d)&&d.then(null,function(s){})}var up=function(s){var o=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(a,e,r){return s[e]&&(a[e]=s[e]),a},{cues:s.cues&&Array.prototype.map.call(s.cues,function(a){return{startTime:a.startTime,endTime:a.endTime,text:a.text,id:a.id}})});return o},bE=function(s){var o=s.$$("track"),a=Array.prototype.map.call(o,function(r){return r.track}),e=Array.prototype.map.call(o,function(r){var l=up(r.track);return r.src&&(l.src=r.src),l});return e.concat(Array.prototype.filter.call(s.textTracks(),function(r){return a.indexOf(r)===-1}).map(up))},TE=function(s,o){return s.forEach(function(a){var e=o.addRemoteTextTrack(a).track;!a.src&&a.cues&&a.cues.forEach(function(r){return e.addCue(r)})}),o.textTracks()},Pv={textTracksToJson:bE,jsonToTextTracks:TE,trackToJson_:up},Uf="vjs-modal-dialog",Zo=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.handleKeyDown_=function(l){return r.handleKeyDown(l)},r.close_=function(l){return r.close(l)},r.opened_=r.hasBeenOpened_=r.hasBeenFilled_=!1,r.closeable(!r.options_.uncloseable),r.content(r.options_.content),r.contentEl_=ri("div",{className:Uf+"-content"},{role:"document"}),r.descEl_=ri("p",{className:Uf+"-description vjs-control-text",id:r.el().getAttribute("aria-describedby")}),Ds(r.descEl_,r.description()),r.el_.appendChild(r.descEl_),r.el_.appendChild(r.contentEl_),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},o.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,d.prototype.dispose.call(this)},o.buildCSSClass=function(){return Uf+" vjs-hidden "+d.prototype.buildCSSClass.call(this)},o.label=function(){return this.localize(this.options_.label||"Modal Window")},o.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},o.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},o.opened=function(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_},o.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},o.closeable=function(e){if(typeof e=="boolean"){var r=this.closeable_=!!e,l=this.getChild("closeButton");if(r&&!l){var f=this.contentEl_;this.contentEl_=this.el_,l=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=f,this.on(l,"close",this.close_)}!r&&l&&(this.off(l,"close",this.close_),this.removeChild(l),l.dispose())}return this.closeable_},o.fill=function(){this.fillWith(this.content())},o.fillWith=function(e){var r=this.contentEl(),l=r.parentNode,f=r.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,l.removeChild(r),this.empty(),ty(r,e),this.trigger("modalfill"),f?l.insertBefore(r,f):l.appendChild(r);var m=this.getChild("closeButton");m&&l.appendChild(m.el_)},o.empty=function(){this.trigger("beforemodalempty"),Fp(this.contentEl()),this.trigger("modalempty")},o.content=function(e){return typeof e<"u"&&(this.content_=e),this.content_},o.conditionalFocus_=function(){var e=et.activeElement,r=this.player_.el_;this.previouslyActiveEl_=null,(r.contains(e)||r===e)&&(this.previouslyActiveEl_=e,this.focus())},o.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},o.handleKeyDown=function(e){if(e.stopPropagation(),Nt.isEventKey(e,"Escape")&&this.closeable()){e.preventDefault(),this.close();return}if(Nt.isEventKey(e,"Tab")){for(var r=this.focusableEls_(),l=this.el_.querySelector(":focus"),f,m=0;m<r.length;m++)if(l===r[m]){f=m;break}et.activeElement===this.el_&&(f=0),e.shiftKey&&f===0?(r[r.length-1].focus(),e.preventDefault()):!e.shiftKey&&f===r.length-1&&(r[0].focus(),e.preventDefault())}},o.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,function(r){return(r instanceof ie.HTMLAnchorElement||r instanceof ie.HTMLAreaElement)&&r.hasAttribute("href")||(r instanceof ie.HTMLInputElement||r instanceof ie.HTMLSelectElement||r instanceof ie.HTMLTextAreaElement||r instanceof ie.HTMLButtonElement)&&!r.hasAttribute("disabled")||r instanceof ie.HTMLIFrameElement||r instanceof ie.HTMLObjectElement||r instanceof ie.HTMLEmbedElement||r.hasAttribute("tabindex")&&r.getAttribute("tabindex")!==-1||r.hasAttribute("contenteditable")})},s}(qe);Zo.prototype.options_={pauseOnOpen:!0,temporary:!0};qe.registerComponent("ModalDialog",Zo);var Wo=function(d){it(s,d);function s(a){var e;a===void 0&&(a=[]),e=d.call(this)||this,e.tracks_=[],Object.defineProperty(Ft(e),"length",{get:function(){return this.tracks_.length}});for(var r=0;r<a.length;r++)e.addTrack(a[r]);return e}var o=s.prototype;return o.addTrack=function(e){var r=this,l=this.tracks_.length;""+l in this||Object.defineProperty(this,l,{get:function(){return this.tracks_[l]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=function(){r.trigger({track:e,type:"labelchange",target:r})},xa(e)&&e.addEventListener("labelchange",e.labelchange_)},o.removeTrack=function(e){for(var r,l=0,f=this.length;l<f;l++)if(this[l]===e){r=this[l],r.off&&r.off(),this.tracks_.splice(l,1);break}r&&this.trigger({track:r,type:"removetrack",target:this})},o.getTrackById=function(e){for(var r=null,l=0,f=this.length;l<f;l++){var m=this[l];if(m.id===e){r=m;break}}return r},s}(sn);Wo.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(var AE in Wo.prototype.allowedEvents_)Wo.prototype["on"+AE]=null;var Hf=function(s,o){for(var a=0;a<s.length;a++)!Object.keys(s[a]).length||o.id===s[a].id||(s[a].enabled=!1)},SE=function(d){it(s,d);function s(a){var e;a===void 0&&(a=[]);for(var r=a.length-1;r>=0;r--)if(a[r].enabled){Hf(a,a[r]);break}return e=d.call(this,a)||this,e.changing_=!1,e}var o=s.prototype;return o.addTrack=function(e){var r=this;e.enabled&&Hf(this,e),d.prototype.addTrack.call(this,e),e.addEventListener&&(e.enabledChange_=function(){r.changing_||(r.changing_=!0,Hf(r,e),r.changing_=!1,r.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))},o.removeTrack=function(e){d.prototype.removeTrack.call(this,e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)},s}(Wo),Vf=function(s,o){for(var a=0;a<s.length;a++)!Object.keys(s[a]).length||o.id===s[a].id||(s[a].selected=!1)},wE=function(d){it(s,d);function s(a){var e;a===void 0&&(a=[]);for(var r=a.length-1;r>=0;r--)if(a[r].selected){Vf(a,a[r]);break}return e=d.call(this,a)||this,e.changing_=!1,Object.defineProperty(Ft(e),"selectedIndex",{get:function(){for(var f=0;f<this.length;f++)if(this[f].selected)return f;return-1},set:function(){}}),e}var o=s.prototype;return o.addTrack=function(e){var r=this;e.selected&&Vf(this,e),d.prototype.addTrack.call(this,e),e.addEventListener&&(e.selectedChange_=function(){r.changing_||(r.changing_=!0,Vf(r,e),r.changing_=!1,r.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))},o.removeTrack=function(e){d.prototype.removeTrack.call(this,e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)},s}(Wo),fy=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.addTrack=function(e){var r=this;d.prototype.addTrack.call(this,e),this.queueChange_||(this.queueChange_=function(){return r.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return r.trigger("selectedlanguagechange")}),e.addEventListener("modechange",this.queueChange_);var l=["metadata","chapters"];l.indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)},o.removeTrack=function(e){d.prototype.removeTrack.call(this,e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},s}(Wo),EE=function(){function d(o){o===void 0&&(o=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var a=0,e=o.length;a<e;a++)this.addTrackElement_(o[a])}var s=d.prototype;return s.addTrackElement_=function(a){var e=this.trackElements_.length;""+e in this||Object.defineProperty(this,e,{get:function(){return this.trackElements_[e]}}),this.trackElements_.indexOf(a)===-1&&this.trackElements_.push(a)},s.getTrackElementByTrack_=function(a){for(var e,r=0,l=this.trackElements_.length;r<l;r++)if(a===this.trackElements_[r].track){e=this.trackElements_[r];break}return e},s.removeTrackElement_=function(a){for(var e=0,r=this.trackElements_.length;e<r;e++)if(a===this.trackElements_[e]){this.trackElements_[e].track&&typeof this.trackElements_[e].track.off=="function"&&this.trackElements_[e].track.off(),typeof this.trackElements_[e].off=="function"&&this.trackElements_[e].off(),this.trackElements_.splice(e,1);break}},d}(),Lv=function(){function d(o){d.prototype.setCues_.call(this,o),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var s=d.prototype;return s.setCues_=function(a){var e=this.length||0,r=0,l=a.length;this.cues_=a,this.length_=a.length;var f=function(v){""+v in this||Object.defineProperty(this,""+v,{get:function(){return this.cues_[v]}})};if(e<l)for(r=e;r<l;r++)f.call(this,r)},s.getCueById=function(a){for(var e=null,r=0,l=this.length;r<l;r++){var f=this[r];if(f.id===a){e=f;break}}return e},d}(),ME={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},CE={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},PE={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Iv={disabled:"disabled",hidden:"hidden",showing:"showing"},Up=function(d){it(s,d);function s(o){var a;o===void 0&&(o={}),a=d.call(this)||this;var e={id:o.id||"vjs_track_"+Ea(),kind:o.kind||"",language:o.language||""},r=o.label||"",l=function(v){Object.defineProperty(Ft(a),v,{get:function(){return e[v]},set:function(){}})};for(var f in e)l(f);return Object.defineProperty(Ft(a),"label",{get:function(){return r},set:function(v){v!==r&&(r=v,this.trigger("labelchange"))}}),a}return s}(sn),Hp=function(s){var o=["protocol","hostname","port","pathname","search","hash","host"],a=et.createElement("a");a.href=s;for(var e={},r=0;r<o.length;r++)e[o[r]]=a[o[r]];return e.protocol==="http:"&&(e.host=e.host.replace(/:80$/,"")),e.protocol==="https:"&&(e.host=e.host.replace(/:443$/,"")),e.protocol||(e.protocol=ie.location.protocol),e.host||(e.host=ie.location.host),e},py=function(s){if(!s.match(/^https?:\/\//)){var o=et.createElement("a");o.href=s,s=o.href}return s},Vp=function(s){if(typeof s=="string"){var o=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/,a=o.exec(s);if(a)return a.pop().toLowerCase()}return""},Id=function(s,o){o===void 0&&(o=ie.location);var a=Hp(s),e=a.protocol===":"?o.protocol:a.protocol,r=e+a.host!==o.protocol+o.host;return r},LE=Object.freeze({__proto__:null,parseUrl:Hp,getAbsoluteURL:py,getFileExtension:Vp,isCrossOrigin:Id}),Dv=function(s,o){var a=new ie.WebVTT.Parser(ie,ie.vttjs,ie.WebVTT.StringDecoder()),e=[];a.oncue=function(r){o.addCue(r)},a.onparsingerror=function(r){e.push(r)},a.onflush=function(){o.trigger({type:"loadeddata",target:o})},a.parse(s),e.length>0&&(ie.console&&ie.console.groupCollapsed&&ie.console.groupCollapsed("Text Track parsing errors for "+o.src),e.forEach(function(r){return Xt.error(r)}),ie.console&&ie.console.groupEnd&&ie.console.groupEnd()),a.flush()},Rv=function(s,o){var a={uri:s},e=Id(s);e&&(a.cors=e);var r=o.tech_.crossOrigin()==="use-credentials";r&&(a.withCredentials=r),_0(a,Pi(this,function(l,f,m){if(l)return Xt.error(l,f);o.loaded_=!0,typeof ie.WebVTT!="function"?o.tech_&&o.tech_.any(["vttjsloaded","vttjserror"],function(v){if(v.type==="vttjserror"){Xt.error("vttjs failed to load, stopping trying to process "+o.src);return}return Dv(m,o)}):Dv(m,o)}))},Eu=function(d){it(s,d);function s(a){var e;if(a===void 0&&(a={}),!a.tech)throw new Error("A tech was not provided.");var r=Ci(a,{kind:PE[a.kind]||"subtitles",language:a.language||a.srclang||""}),l=Iv[r.mode]||"disabled",f=r.default;(r.kind==="metadata"||r.kind==="chapters")&&(l="hidden"),e=d.call(this,r)||this,e.tech_=r.tech,e.cues_=[],e.activeCues_=[],e.preload_=e.tech_.preloadTextTracks!==!1;var m=new Lv(e.cues_),v=new Lv(e.activeCues_),A=!1;e.timeupdateHandler=Pi(Ft(e),function(P){if(P===void 0&&(P={}),!this.tech_.isDisposed()){if(!this.tech_.isReady_){P.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,A&&(this.trigger("cuechange"),A=!1),P.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});var L=function(){e.stopTracking()};return e.tech_.one("dispose",L),l!=="disabled"&&e.startTracking(),Object.defineProperties(Ft(e),{default:{get:function(){return f},set:function(){}},mode:{get:function(){return l},set:function(U){Iv[U]&&l!==U&&(l=U,!this.preload_&&l!=="disabled"&&this.cues.length===0&&Rv(this.src,this),this.stopTracking(),l!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?m:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(this.cues.length===0)return v;for(var U=this.tech_.currentTime(),W=[],Y=0,q=this.cues.length;Y<q;Y++){var _e=this.cues[Y];(_e.startTime<=U&&_e.endTime>=U||_e.startTime===_e.endTime&&_e.startTime<=U&&_e.startTime+.5>=U)&&W.push(_e)}if(A=!1,W.length!==this.activeCues_.length)A=!0;else for(var J=0;J<W.length;J++)this.activeCues_.indexOf(W[J])===-1&&(A=!0);return this.activeCues_=W,v.setCues_(this.activeCues_),v},set:function(){}}}),r.src?(e.src=r.src,e.preload_||(e.loaded_=!0),(e.preload_||r.kind!=="subtitles"&&r.kind!=="captions")&&Rv(e.src,Ft(e))):e.loaded_=!0,e}var o=s.prototype;return o.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},o.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},o.addCue=function(e){var r=e;if(!("getCueAsHTML"in r)){r=new ie.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(var l in e)l in r||(r[l]=e[l]);r.id=e.id,r.originalCue_=e}for(var f=this.tech_.textTracks(),m=0;m<f.length;m++)f[m]!==this&&f[m].removeCue(r);this.cues_.push(r),this.cues.setCues_(this.cues_)},o.removeCue=function(e){for(var r=this.cues_.length;r--;){var l=this.cues_[r];if(l===e||l.originalCue_&&l.originalCue_===e){this.cues_.splice(r,1),this.cues.setCues_(this.cues_);break}}},s}(Up);Eu.prototype.allowedEvents_={cuechange:"cuechange"};var my=function(d){it(s,d);function s(o){var a;o===void 0&&(o={});var e=Ci(o,{kind:CE[o.kind]||""});a=d.call(this,e)||this;var r=!1;return Object.defineProperty(Ft(a),"enabled",{get:function(){return r},set:function(f){typeof f!="boolean"||f===r||(r=f,this.trigger("enabledchange"))}}),e.enabled&&(a.enabled=e.enabled),a.loaded_=!0,a}return s}(Up),gy=function(d){it(s,d);function s(o){var a;o===void 0&&(o={});var e=Ci(o,{kind:ME[o.kind]||""});a=d.call(this,e)||this;var r=!1;return Object.defineProperty(Ft(a),"selected",{get:function(){return r},set:function(f){typeof f!="boolean"||f===r||(r=f,this.trigger("selectedchange"))}}),e.selected&&(a.selected=e.selected),a}return s}(Up),vy=0,IE=1,yy=2,DE=3,$o=function(d){it(s,d);function s(o){var a;o===void 0&&(o={}),a=d.call(this)||this;var e,r=new Eu(o);return a.kind=r.kind,a.src=r.src,a.srclang=r.language,a.label=r.label,a.default=r.default,Object.defineProperties(Ft(a),{readyState:{get:function(){return e}},track:{get:function(){return r}}}),e=vy,r.addEventListener("loadeddata",function(){e=yy,a.trigger({type:"load",target:Ft(a)})}),a}return s}(sn);$o.prototype.allowedEvents_={load:"load"};$o.NONE=vy;$o.LOADING=IE;$o.LOADED=yy;$o.ERROR=DE;var or={audio:{ListClass:SE,TrackClass:my,capitalName:"Audio"},video:{ListClass:wE,TrackClass:gy,capitalName:"Video"},text:{ListClass:fy,TrackClass:Eu,capitalName:"Text"}};Object.keys(or).forEach(function(d){or[d].getterName=d+"Tracks",or[d].privateName=d+"Tracks_"});var jo={remoteText:{ListClass:fy,TrackClass:Eu,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:EE,TrackClass:$o,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Tn=ba({},or,jo);jo.names=Object.keys(jo);or.names=Object.keys(or);Tn.names=[].concat(jo.names).concat(or.names);function RE(d,s,o,a,e){e===void 0&&(e={});var r=d.textTracks();e.kind=s,o&&(e.label=o),a&&(e.language=a),e.tech=d;var l=new Tn.text.TrackClass(e);return r.addTrack(l),l}var bi=function(d){it(s,d);function s(a,e){var r;return a===void 0&&(a={}),e===void 0&&(e=function(){}),a.reportTouchActivity=!1,r=d.call(this,null,a,e)||this,r.onDurationChange_=function(l){return r.onDurationChange(l)},r.trackProgress_=function(l){return r.trackProgress(l)},r.trackCurrentTime_=function(l){return r.trackCurrentTime(l)},r.stopTrackingCurrentTime_=function(l){return r.stopTrackingCurrentTime(l)},r.disposeSourceHandler_=function(l){return r.disposeSourceHandler(l)},r.queuedHanders_=new Set,r.hasStarted_=!1,r.on("playing",function(){this.hasStarted_=!0}),r.on("loadstart",function(){this.hasStarted_=!1}),Tn.names.forEach(function(l){var f=Tn[l];a&&a[f.getterName]&&(r[f.privateName]=a[f.getterName])}),r.featuresProgressEvents||r.manualProgressOn(),r.featuresTimeupdateEvents||r.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(l){a["native"+l+"Tracks"]===!1&&(r["featuresNative"+l+"Tracks"]=!1)}),a.nativeCaptions===!1||a.nativeTextTracks===!1?r.featuresNativeTextTracks=!1:(a.nativeCaptions===!0||a.nativeTextTracks===!0)&&(r.featuresNativeTextTracks=!0),r.featuresNativeTextTracks||r.emulateTextTracks(),r.preloadTextTracks=a.preloadTextTracks!==!1,r.autoRemoteTextTracks_=new Tn.text.ListClass,r.initTrackListeners(),a.nativeControlsForTouch||r.emitTapEvents(),r.constructor&&(r.name_=r.constructor.name||"Unknown Tech"),r}var o=s.prototype;return o.triggerSourceset=function(e){var r=this;this.isReady_||this.one("ready",function(){return r.setTimeout(function(){return r.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},o.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},o.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},o.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Pi(this,function(){var r=this.bufferedPercent();this.bufferedPercent_!==r&&this.trigger("progress"),this.bufferedPercent_=r,r===1&&this.stopTrackingProgress()}),500)},o.onDurationChange=function(e){this.duration_=this.duration()},o.buffered=function(){return Ls(0,0)},o.bufferedPercent=function(){return hy(this.buffered(),this.duration_)},o.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},o.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},o.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},o.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},o.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},o.dispose=function(){this.clearTracks(or.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),d.prototype.dispose.call(this)},o.clearTracks=function(e){var r=this;e=[].concat(e),e.forEach(function(l){for(var f=r[l+"Tracks"]()||[],m=f.length;m--;){var v=f[m];l==="text"&&r.removeRemoteTextTrack(v),f.removeTrack(v)}})},o.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],r=e.length;r--;){var l=e[r];this.removeRemoteTextTrack(l)}},o.reset=function(){},o.crossOrigin=function(){},o.setCrossOrigin=function(){},o.error=function(e){return e!==void 0&&(this.error_=new wn(e),this.trigger("error")),this.error_},o.played=function(){return this.hasStarted_?Ls(0,0):Ls()},o.play=function(){},o.setScrubbing=function(){},o.scrubbing=function(){},o.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},o.initTrackListeners=function(){var e=this;or.names.forEach(function(r){var l=or[r],f=function(){e.trigger(r+"trackchange")},m=e[l.getterName]();m.addEventListener("removetrack",f),m.addEventListener("addtrack",f),e.on("dispose",function(){m.removeEventListener("removetrack",f),m.removeEventListener("addtrack",f)})})},o.addWebVttScript_=function(){var e=this;if(!ie.WebVTT)if(et.body.contains(this.el())){if(!this.options_["vtt.js"]&&yu(ev)&&Object.keys(ev).length>0){this.trigger("vttjsloaded");return}var r=et.createElement("script");r.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",r.onload=function(){e.trigger("vttjsloaded")},r.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){r.onload=null,r.onerror=null}),ie.WebVTT=!0,this.el().parentNode.appendChild(r)}else this.ready(this.addWebVttScript_)},o.emulateTextTracks=function(){var e=this,r=this.textTracks(),l=this.remoteTextTracks(),f=function(P){return r.addTrack(P.track)},m=function(P){return r.removeTrack(P.track)};l.on("addtrack",f),l.on("removetrack",m),this.addWebVttScript_();var v=function(){return e.trigger("texttrackchange")},A=function(){v();for(var P=0;P<r.length;P++){var U=r[P];U.removeEventListener("cuechange",v),U.mode==="showing"&&U.addEventListener("cuechange",v)}};A(),r.addEventListener("change",A),r.addEventListener("addtrack",A),r.addEventListener("removetrack",A),this.on("dispose",function(){l.off("addtrack",f),l.off("removetrack",m),r.removeEventListener("change",A),r.removeEventListener("addtrack",A),r.removeEventListener("removetrack",A);for(var L=0;L<r.length;L++){var P=r[L];P.removeEventListener("cuechange",v)}})},o.addTextTrack=function(e,r,l){if(!e)throw new Error("TextTrack kind is required but was not provided");return RE(this,e,r,l)},o.createRemoteTextTrack=function(e){var r=Ci(e,{tech:this});return new jo.remoteTextEl.TrackClass(r)},o.addRemoteTextTrack=function(e,r){var l=this;e===void 0&&(e={});var f=this.createRemoteTextTrack(e);return r!==!0&&r!==!1&&(Xt.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),r=!0),this.remoteTextTrackEls().addTrackElement_(f),this.remoteTextTracks().addTrack(f.track),r!==!0&&this.ready(function(){return l.autoRemoteTextTracks_.addTrack(f.track)}),f},o.removeRemoteTextTrack=function(e){var r=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(r),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},o.getVideoPlaybackQuality=function(){return{}},o.requestPictureInPicture=function(){var e=this.options_.Promise||ie.Promise;if(e)return e.reject()},o.disablePictureInPicture=function(){return!0},o.setDisablePictureInPicture=function(){},o.requestVideoFrameCallback=function(e){var r=this,l=Ea();return!this.isReady_||this.paused()?(this.queuedHanders_.add(l),this.one("playing",function(){r.queuedHanders_.has(l)&&(r.queuedHanders_.delete(l),e())})):this.requestNamedAnimationFrame(l,e),l},o.cancelVideoFrameCallback=function(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)},o.setPoster=function(){},o.playsinline=function(){},o.setPlaysinline=function(){},o.overrideNativeAudioTracks=function(){},o.overrideNativeVideoTracks=function(){},o.canPlayType=function(){return""},s.canPlayType=function(){return""},s.canPlaySource=function(e,r){return s.canPlayType(e.type)},s.isTech=function(e){return e.prototype instanceof s||e instanceof s||e===s},s.registerTech=function(e,r){if(s.techs_||(s.techs_={}),!s.isTech(r))throw new Error("Tech "+e+" must be a Tech");if(!s.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!s.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=ji(e),s.techs_[e]=r,s.techs_[Jc(e)]=r,e!=="Tech"&&s.defaultTechOrder_.push(e),r},s.getTech=function(e){if(e){if(s.techs_&&s.techs_[e])return s.techs_[e];if(e=ji(e),ie&&ie.videojs&&ie.videojs[e])return Xt.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),ie.videojs[e]}},s}(qe);Tn.names.forEach(function(d){var s=Tn[d];bi.prototype[s.getterName]=function(){return this[s.privateName]=this[s.privateName]||new s.ListClass,this[s.privateName]}});bi.prototype.featuresVolumeControl=!0;bi.prototype.featuresMuteControl=!0;bi.prototype.featuresFullscreenResize=!1;bi.prototype.featuresPlaybackRate=!1;bi.prototype.featuresProgressEvents=!1;bi.prototype.featuresSourceset=!1;bi.prototype.featuresTimeupdateEvents=!1;bi.prototype.featuresNativeTextTracks=!1;bi.prototype.featuresVideoFrameCallback=!1;bi.withSourceHandlers=function(d){d.registerSourceHandler=function(o,a){var e=d.sourceHandlers;e||(e=d.sourceHandlers=[]),a===void 0&&(a=e.length),e.splice(a,0,o)},d.canPlayType=function(o){for(var a=d.sourceHandlers||[],e,r=0;r<a.length;r++)if(e=a[r].canPlayType(o),e)return e;return""},d.selectSourceHandler=function(o,a){for(var e=d.sourceHandlers||[],r,l=0;l<e.length;l++)if(r=e[l].canHandleSource(o,a),r)return e[l];return null},d.canPlaySource=function(o,a){var e=d.selectSourceHandler(o,a);return e?e.canHandleSource(o,a):""};var s=["seekable","seeking","duration"];s.forEach(function(o){var a=this[o];typeof a=="function"&&(this[o]=function(){return this.sourceHandler_&&this.sourceHandler_[o]?this.sourceHandler_[o].apply(this.sourceHandler_,arguments):a.apply(this,arguments)})},d.prototype),d.prototype.setSource=function(o){var a=d.selectSourceHandler(o,this.options_);a||(d.nativeSourceHandler?a=d.nativeSourceHandler:Xt.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),a!==d.nativeSourceHandler&&(this.currentSource_=o),this.sourceHandler_=a.handleSource(o,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},d.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};qe.registerComponent("Tech",bi);bi.registerTech("Tech",bi);bi.defaultTechOrder_=[];var Is={},cp={},sd={};function OE(d,s){Is[d]=Is[d]||[],Is[d].push(s)}function FE(d,s,o){d.setTimeout(function(){return ws(s,Is[s.type],o,d)},1)}function kE(d,s){d.forEach(function(o){return o.setTech&&o.setTech(s)})}function BE(d,s,o){return d.reduceRight(Gp(o),s[o]())}function NE(d,s,o,a){return s[o](d.reduce(Gp(o),a))}function Ov(d,s,o,a){a===void 0&&(a=null);var e="call"+ji(o),r=d.reduce(Gp(e),a),l=r===sd,f=l?null:s[o](r);return VE(d,o,f,l),f}var UE={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},HE={setCurrentTime:1,setMuted:1,setVolume:1},Fv={play:1,pause:1};function Gp(d){return function(s,o){return s===sd?sd:o[d]?o[d](s):s}}function VE(d,s,o,a){for(var e=d.length-1;e>=0;e--){var r=d[e];r[s]&&r[s](a,o)}}function GE(d){cp[d.id()]=null}function zE(d,s){var o=cp[d.id()],a=null;if(o==null)return a=s(d),cp[d.id()]=[[s,a]],a;for(var e=0;e<o.length;e++){var r=o[e],l=r[0],f=r[1];l===s&&(a=f)}return a===null&&(a=s(d),o.push([s,a])),a}function ws(d,s,o,a,e,r){d===void 0&&(d={}),s===void 0&&(s=[]),e===void 0&&(e=[]),r===void 0&&(r=!1);var l=s,f=l[0],m=l.slice(1);if(typeof f=="string")ws(d,Is[f],o,a,e,r);else if(f){var v=zE(a,f);if(!v.setSource)return e.push(v),ws(d,m,o,a,e,r);v.setSource(Gi({},d),function(A,L){if(A)return ws(d,m,o,a,e,r);e.push(v),ws(L,d.type===L.type?m:Is[L.type],o,a,e,r)})}else m.length?ws(d,m,o,a,e,r):r?o(d,e):ws(d,Is["*"],o,a,e,!0)}var WE={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},od=function(s){s===void 0&&(s="");var o=Vp(s),a=WE[o.toLowerCase()];return a||""},jE=function(s,o){if(!o)return"";if(s.cache_.source.src===o&&s.cache_.source.type)return s.cache_.source.type;var a=s.cache_.sources.filter(function(f){return f.src===o});if(a.length)return a[0].type;for(var e=s.$$("source"),r=0;r<e.length;r++){var l=e[r];if(l.type&&l.src&&l.src===o)return l.type}return od(o)},qE=function d(s){if(Array.isArray(s)){var o=[];s.forEach(function(a){a=d(a),Array.isArray(a)?o=o.concat(a):Ta(a)&&o.push(a)}),s=o}else typeof s=="string"&&s.trim()?s=[kv({src:s})]:Ta(s)&&typeof s.src=="string"&&s.src&&s.src.trim()?s=[kv(s)]:s=[];return s};function kv(d){if(!d.type){var s=od(d.src);s&&(d.type=s)}return d}var XE=function(d){it(s,d);function s(o,a,e){var r,l=Ci({createEl:!1},a);if(r=d.call(this,o,l,e)||this,!a.playerOptions.sources||a.playerOptions.sources.length===0)for(var f=0,m=a.playerOptions.techOrder;f<m.length;f++){var v=ji(m[f]),A=bi.getTech(v);if(v||(A=qe.getComponent(v)),A&&A.isSupported()){o.loadTech_(v);break}}else o.src(a.playerOptions.sources);return r}return s}(qe);qe.registerComponent("MediaLoader",XE);var Dd=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.options_.controlText&&r.controlText(r.options_.controlText),r.handleMouseOver_=function(l){return r.handleMouseOver(l)},r.handleMouseOut_=function(l){return r.handleMouseOut(l)},r.handleClick_=function(l){return r.handleClick(l)},r.handleKeyDown_=function(l){return r.handleKeyDown(l)},r.emitTapEvents(),r.enable(),r}var o=s.prototype;return o.createEl=function(e,r,l){e===void 0&&(e="div"),r===void 0&&(r={}),l===void 0&&(l={}),r=Gi({className:this.buildCSSClass(),tabIndex:0},r),e==="button"&&Xt.error("Creating a ClickableComponent with an HTML element of "+e+" is not supported; use a Button instead."),l=Gi({role:"button"},l),this.tabIndex_=r.tabIndex;var f=ri(e,r,l);return f.appendChild(ri("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(f),f},o.dispose=function(){this.controlTextEl_=null,d.prototype.dispose.call(this)},o.createControlTextEl=function(e){return this.controlTextEl_=ri("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},o.controlText=function(e,r){if(r===void 0&&(r=this.el()),e===void 0)return this.controlText_||"Need Text";var l=this.localize(e);this.controlText_=e,Ds(this.controlTextEl_,l),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&r.setAttribute("title",l)},o.buildCSSClass=function(){return"vjs-control vjs-button "+d.prototype.buildCSSClass.call(this)},o.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},o.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},o.handleLanguagechange=function(){this.controlText(this.controlText_)},o.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},o.handleKeyDown=function(e){Nt.isEventKey(e,"Space")||Nt.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):d.prototype.handleKeyDown.call(this,e)},s}(qe);qe.registerComponent("ClickableComponent",Dd);var QE=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.update(),r.update_=function(l){return r.update(l)},a.on("posterchange",r.update_),r}var o=s.prototype;return o.dispose=function(){this.player().off("posterchange",this.update_),d.prototype.dispose.call(this)},o.createEl=function(){var e=ri("div",{className:"vjs-poster",tabIndex:-1});return e},o.update=function(e){var r=this.player().poster();this.setSrc(r),r?this.show():this.hide()},o.setSrc=function(e){var r="";e&&(r='url("'+e+'")'),this.el_.style.backgroundImage=r},o.handleClick=function(e){if(this.player_.controls()){var r=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((Su||Au)&&r)&&this.player_.tech(!0).focus(),this.player_.paused()?qr(this.player_.play()):this.player_.pause()}},s}(Dd);qe.registerComponent("PosterImage",QE);var sr="#222",Bv="#ccc",YE={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Gf(d,s){var o;if(d.length===4)o=d[1]+d[1]+d[2]+d[2]+d[3]+d[3];else if(d.length===7)o=d.slice(1);else throw new Error("Invalid color code provided, "+d+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(o.slice(0,2),16)+","+parseInt(o.slice(2,4),16)+","+parseInt(o.slice(4,6),16)+","+s+")"}function zf(d,s,o){try{d.style[s]=o}catch{return}}var KE=function(d){it(s,d);function s(a,e,r){var l;l=d.call(this,a,e,r)||this;var f=function(v){return l.updateDisplay(v)};return a.on("loadstart",function(m){return l.toggleDisplay(m)}),a.on("texttrackchange",f),a.on("loadedmetadata",function(m){return l.preselectTrack(m)}),a.ready(Pi(Ft(l),function(){if(a.tech_&&a.tech_.featuresNativeTextTracks){this.hide();return}a.on("fullscreenchange",f),a.on("playerresize",f),ie.addEventListener("orientationchange",f),a.on("dispose",function(){return ie.removeEventListener("orientationchange",f)});for(var m=this.options_.playerOptions.tracks||[],v=0;v<m.length;v++)this.player_.addRemoteTextTrack(m[v],!0);this.preselectTrack()})),l}var o=s.prototype;return o.preselectTrack=function(){for(var e={captions:1,subtitles:1},r=this.player_.textTracks(),l=this.player_.cache_.selectedLanguage,f,m,v,A=0;A<r.length;A++){var L=r[A];l&&l.enabled&&l.language&&l.language===L.language&&L.kind in e?L.kind===l.kind?v=L:v||(v=L):l&&!l.enabled?(v=null,f=null,m=null):L.default&&(L.kind==="descriptions"&&!f?f=L:L.kind in e&&!m&&(m=L))}v?v.mode="showing":m?m.mode="showing":f&&(f.mode="showing")},o.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},o.clearDisplay=function(){typeof ie.WebVTT=="function"&&ie.WebVTT.processCues(ie,[],this.el_)},o.updateDisplay=function(){var e=this.player_.textTracks(),r=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),r){for(var l=[],f=0;f<e.length;++f){var m=e[f];m.mode==="showing"&&l.push(m)}this.updateForTrack(l);return}for(var v=null,A=null,L=e.length;L--;){var P=e[L];P.mode==="showing"&&(P.kind==="descriptions"?v=P:A=P)}A?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(A)):v&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(v))},o.updateDisplayState=function(e){for(var r=this.player_.textTrackSettings.getValues(),l=e.activeCues,f=l.length;f--;){var m=l[f];if(m){var v=m.displayState;if(r.color&&(v.firstChild.style.color=r.color),r.textOpacity&&zf(v.firstChild,"color",Gf(r.color||"#fff",r.textOpacity)),r.backgroundColor&&(v.firstChild.style.backgroundColor=r.backgroundColor),r.backgroundOpacity&&zf(v.firstChild,"backgroundColor",Gf(r.backgroundColor||"#000",r.backgroundOpacity)),r.windowColor&&(r.windowOpacity?zf(v,"backgroundColor",Gf(r.windowColor,r.windowOpacity)):v.style.backgroundColor=r.windowColor),r.edgeStyle&&(r.edgeStyle==="dropshadow"?v.firstChild.style.textShadow="2px 2px 3px "+sr+", 2px 2px 4px "+sr+", 2px 2px 5px "+sr:r.edgeStyle==="raised"?v.firstChild.style.textShadow="1px 1px "+sr+", 2px 2px "+sr+", 3px 3px "+sr:r.edgeStyle==="depressed"?v.firstChild.style.textShadow="1px 1px "+Bv+", 0 1px "+Bv+", -1px -1px "+sr+", 0 -1px "+sr:r.edgeStyle==="uniform"&&(v.firstChild.style.textShadow="0 0 4px "+sr+", 0 0 4px "+sr+", 0 0 4px "+sr+", 0 0 4px "+sr)),r.fontPercent&&r.fontPercent!==1){var A=ie.parseFloat(v.style.fontSize);v.style.fontSize=A*r.fontPercent+"px",v.style.height="auto",v.style.top="auto"}r.fontFamily&&r.fontFamily!=="default"&&(r.fontFamily==="small-caps"?v.firstChild.style.fontVariant="small-caps":v.firstChild.style.fontFamily=YE[r.fontFamily])}}},o.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),!(typeof ie.WebVTT!="function"||e.every(function(U){return!U.activeCues}))){for(var r=[],l=0;l<e.length;++l)for(var f=e[l],m=0;m<f.activeCues.length;++m)r.push(f.activeCues[m]);ie.WebVTT.processCues(ie,r,this.el_);for(var v=0;v<e.length;++v){for(var A=e[v],L=0;L<A.activeCues.length;++L){var P=A.activeCues[L].displayState;_a(P,"vjs-text-track-cue"),_a(P,"vjs-text-track-cue-"+(A.language?A.language:v)),A.language&&Go(P,"lang",A.language)}this.player_.textTrackSettings&&this.updateDisplayState(A)}}},s}(qe);qe.registerComponent("TextTrackDisplay",KE);var ZE=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.createEl=function(){var e=this.player_.isAudio(),r=this.localize(e?"Audio Player":"Video Player"),l=ri("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[r])}),f=d.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return f.appendChild(l),f},s}(qe);qe.registerComponent("LoadingSpinner",ZE);var Sr=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.createEl=function(e,r,l){r===void 0&&(r={}),l===void 0&&(l={}),e="button",r=Gi({className:this.buildCSSClass()},r),l=Gi({type:"button"},l);var f=ri(e,r,l);return f.appendChild(ri("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(f),f},o.addChild=function(e,r){r===void 0&&(r={});var l=this.constructor.name;return Xt.warn("Adding an actionable (user controllable) child to a Button ("+l+") is not supported; use a ClickableComponent instead."),qe.prototype.addChild.call(this,e,r)},o.enable=function(){d.prototype.enable.call(this),this.el_.removeAttribute("disabled")},o.disable=function(){d.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},o.handleKeyDown=function(e){if(Nt.isEventKey(e,"Space")||Nt.isEventKey(e,"Enter")){e.stopPropagation();return}d.prototype.handleKeyDown.call(this,e)},s}(Dd);qe.registerComponent("Button",Sr);var _y=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.mouseused_=!1,r.on("mousedown",function(l){return r.handleMouseDown(l)}),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-big-play-button"},o.handleClick=function(e){var r=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var l=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;qr(r),this.player_.tech(!0)&&!((Su||Au)&&l)&&this.player_.tech(!0).focus();return}var f=this.player_.getChild("controlBar"),m=f&&f.getChild("playToggle");if(!m){this.player_.tech(!0).focus();return}var v=function(){return m.focus()};fu(r)?r.then(v,function(){}):this.setTimeout(v,1)},o.handleKeyDown=function(e){this.mouseused_=!1,d.prototype.handleKeyDown.call(this,e)},o.handleMouseDown=function(e){this.mouseused_=!0},s}(Sr);_y.prototype.controlText_="Play Video";qe.registerComponent("BigPlayButton",_y);var $E=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.controlText(e&&e.controlText||r.localize("Close")),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-close-button "+d.prototype.buildCSSClass.call(this)},o.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},o.handleKeyDown=function(e){Nt.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):d.prototype.handleKeyDown.call(this,e)},s}(Sr);qe.registerComponent("CloseButton",$E);var xy=function(d){it(s,d);function s(a,e){var r;return e===void 0&&(e={}),r=d.call(this,a,e)||this,e.replay=e.replay===void 0||e.replay,r.on(a,"play",function(l){return r.handlePlay(l)}),r.on(a,"pause",function(l){return r.handlePause(l)}),e.replay&&r.on(a,"ended",function(l){return r.handleEnded(l)}),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-play-control "+d.prototype.buildCSSClass.call(this)},o.handleClick=function(e){this.player_.paused()?qr(this.player_.play()):this.player_.pause()},o.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},o.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},o.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},o.handleEnded=function(e){var r=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(l){return r.handleSeeked(l)})},s}(Sr);xy.prototype.controlText_="Play";qe.registerComponent("PlayToggle",xy);var by=function(s,o){s=s<0?0:s;var a=Math.floor(s%60),e=Math.floor(s/60%60),r=Math.floor(s/3600),l=Math.floor(o/60%60),f=Math.floor(o/3600);return(isNaN(s)||s===1/0)&&(r=e=a="-"),r=r>0||f>0?r+":":"",e=((r||l>=10)&&e<10?"0"+e:e)+":",a=a<10?"0"+a:a,r+e+a},zp=by;function JE(d){zp=d}function eM(){zp=by}function qo(d,s){return s===void 0&&(s=d),zp(d,s)}var Jo=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.on(a,["timeupdate","ended"],function(l){return r.updateContent(l)}),r.updateTextNode_(),r}var o=s.prototype;return o.createEl=function(){var e=this.buildCSSClass(),r=d.prototype.createEl.call(this,"div",{className:e+" vjs-time-control vjs-control"}),l=ri("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+" "},{role:"presentation"});return r.appendChild(l),this.contentEl_=ri("span",{className:e+"-display"},{"aria-live":"off",role:"presentation"}),r.appendChild(this.contentEl_),r},o.dispose=function(){this.contentEl_=null,this.textNode_=null,d.prototype.dispose.call(this)},o.updateTextNode_=function(e){var r=this;e===void 0&&(e=0),e=qo(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(r.contentEl_){var l=r.textNode_;l&&r.contentEl_.firstChild!==l&&(l=null,Xt.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),r.textNode_=et.createTextNode(r.formattedTime_),r.textNode_&&(l?r.contentEl_.replaceChild(r.textNode_,l):r.contentEl_.appendChild(r.textNode_))}}))},o.updateContent=function(e){},s}(qe);Jo.prototype.labelText_="Time";Jo.prototype.controlText_="Time";qe.registerComponent("TimeDisplay",Jo);var Wp=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-current-time"},o.updateContent=function(e){var r;this.player_.ended()?r=this.player_.duration():r=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(r)},s}(Jo);Wp.prototype.labelText_="Current Time";Wp.prototype.controlText_="Current Time";qe.registerComponent("CurrentTimeDisplay",Wp);var jp=function(d){it(s,d);function s(a,e){var r;r=d.call(this,a,e)||this;var l=function(m){return r.updateContent(m)};return r.on(a,"durationchange",l),r.on(a,"loadstart",l),r.on(a,"loadedmetadata",l),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-duration"},o.updateContent=function(e){var r=this.player_.duration();this.updateTextNode_(r)},s}(Jo);jp.prototype.labelText_="Duration";jp.prototype.controlText_="Duration";qe.registerComponent("DurationDisplay",jp);var tM=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.createEl=function(){var e=d.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),r=d.prototype.createEl.call(this,"div"),l=d.prototype.createEl.call(this,"span",{textContent:"/"});return r.appendChild(l),e.appendChild(r),e},s}(qe);qe.registerComponent("TimeDivider",tM);var qp=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.on(a,"durationchange",function(l){return r.updateContent(l)}),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-remaining-time"},o.createEl=function(){var e=d.prototype.createEl.call(this);return this.options_.displayNegative!==!1&&e.insertBefore(ri("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e},o.updateContent=function(e){if(typeof this.player_.duration()=="number"){var r;this.player_.ended()?r=0:this.player_.remainingTimeDisplay?r=this.player_.remainingTimeDisplay():r=this.player_.remainingTime(),this.updateTextNode_(r)}},s}(Jo);qp.prototype.labelText_="Remaining Time";qp.prototype.controlText_="Remaining Time";qe.registerComponent("RemainingTimeDisplay",qp);var iM=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.updateShowing(),r.on(r.player(),"durationchange",function(l){return r.updateShowing(l)}),r}var o=s.prototype;return o.createEl=function(){var e=d.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=ri("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(ri("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+" "})),this.contentEl_.appendChild(et.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e},o.dispose=function(){this.contentEl_=null,d.prototype.dispose.call(this)},o.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},s}(qe);qe.registerComponent("LiveDisplay",iM);var Ty=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.updateLiveEdgeStatus(),r.player_.liveTracker&&(r.updateLiveEdgeStatusHandler_=function(l){return r.updateLiveEdgeStatus(l)},r.on(r.player_.liveTracker,"liveedgechange",r.updateLiveEdgeStatusHandler_)),r}var o=s.prototype;return o.createEl=function(){var e=d.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=ri("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e},o.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},o.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},o.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,d.prototype.dispose.call(this)},s}(Sr);Ty.prototype.controlText_="Seek to live, currently playing live";qe.registerComponent("SeekToLive",Ty);var Rd=function(s,o,a){return s=Number(s),Math.min(a,Math.max(o,isNaN(s)?o:s))},Xp=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.handleMouseDown_=function(l){return r.handleMouseDown(l)},r.handleMouseUp_=function(l){return r.handleMouseUp(l)},r.handleKeyDown_=function(l){return r.handleKeyDown(l)},r.handleClick_=function(l){return r.handleClick(l)},r.handleMouseMove_=function(l){return r.handleMouseMove(l)},r.update_=function(l){return r.update(l)},r.bar=r.getChild(r.options_.barName),r.vertical(!!r.options_.vertical),r.enable(),r}var o=s.prototype;return o.enabled=function(){return this.enabled_},o.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},o.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},o.createEl=function(e,r,l){return r===void 0&&(r={}),l===void 0&&(l={}),r.className=r.className+" vjs-slider",r=Gi({tabIndex:0},r),l=Gi({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},l),d.prototype.createEl.call(this,e,r,l)},o.handleMouseDown=function(e){var r=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!wa&&e.preventDefault(),Z0(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(r,"mousemove",this.handleMouseMove_),this.on(r,"mouseup",this.handleMouseUp_),this.on(r,"touchmove",this.handleMouseMove_),this.on(r,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)},o.handleMouseMove=function(e){},o.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;$0(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.update()},o.update=function(){var e=this;if(!(!this.el_||!this.bar)){var r=this.getProgress();return r===this.progress_||(this.progress_=r,this.requestNamedAnimationFrame("Slider#update",function(){var l=e.vertical()?"height":"width";e.bar.el().style[l]=(r*100).toFixed(2)+"%"})),r}},o.getProgress=function(){return Number(Rd(this.getPercent(),0,1).toFixed(4))},o.calculateDistance=function(e){var r=Md(this.el_,e);return this.vertical()?r.y:r.x},o.handleKeyDown=function(e){Nt.isEventKey(e,"Left")||Nt.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):Nt.isEventKey(e,"Right")||Nt.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):d.prototype.handleKeyDown.call(this,e)},o.handleClick=function(e){e.stopPropagation(),e.preventDefault()},o.vertical=function(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},s}(qe);qe.registerComponent("Slider",Xp);var Wf=function(s,o){return Rd(s/o*100,0,100).toFixed(2)+"%"},nM=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.partEls_=[],r.on(a,"progress",function(l){return r.update(l)}),r}var o=s.prototype;return o.createEl=function(){var e=d.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),r=ri("span",{className:"vjs-control-text"}),l=ri("span",{textContent:this.localize("Loaded")}),f=et.createTextNode(": ");return this.percentageEl_=ri("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(r),r.appendChild(l),r.appendChild(f),r.appendChild(this.percentageEl_),e},o.dispose=function(){this.partEls_=null,this.percentageEl_=null,d.prototype.dispose.call(this)},o.update=function(e){var r=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var l=r.player_.liveTracker,f=r.player_.buffered(),m=l&&l.isLive()?l.seekableEnd():r.player_.duration(),v=r.player_.bufferedEnd(),A=r.partEls_,L=Wf(v,m);r.percent_!==L&&(r.el_.style.width=L,Ds(r.percentageEl_,L),r.percent_=L);for(var P=0;P<f.length;P++){var U=f.start(P),W=f.end(P),Y=A[P];Y||(Y=r.el_.appendChild(ri()),A[P]=Y),!(Y.dataset.start===U&&Y.dataset.end===W)&&(Y.dataset.start=U,Y.dataset.end=W,Y.style.left=Wf(U,v),Y.style.width=Wf(W-U,v))}for(var q=A.length;q>f.length;q--)r.el_.removeChild(A[q-1]);A.length=f.length})},s}(qe);qe.registerComponent("LoadProgressBar",nM);var rM=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.update=Aa(Pi(Ft(r),r.update),wr),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},o.update=function(e,r,l){var f=xu(this.el_),m=zo(this.player_.el()),v=e.width*r;if(!(!m||!f)){var A=e.left-m.left+v,L=e.width-v+(m.right-e.right),P=f.width/2;A<P?P+=P-A:L<P&&(P=L),P<0?P=0:P>f.width&&(P=f.width),P=Math.round(P),this.el_.style.right="-"+P+"px",this.write(l)}},o.write=function(e){Ds(this.el_,e)},o.updateTime=function(e,r,l,f){var m=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var v,A=m.player_.duration();if(m.player_.liveTracker&&m.player_.liveTracker.isLive()){var L=m.player_.liveTracker.liveWindow(),P=L-r*L;v=(P<1?"":"-")+qo(P,L)}else v=qo(l,A);m.update(e,r,v),f&&f()})},s}(qe);qe.registerComponent("TimeTooltip",rM);var Qp=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.update=Aa(Pi(Ft(r),r.update),wr),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},o.update=function(e,r){var l=this.getChild("timeTooltip");if(l){var f=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();l.updateTime(e,r,f)}},s}(qe);Qp.prototype.options_={children:[]};!En&&!Sa&&Qp.prototype.options_.children.push("timeTooltip");qe.registerComponent("PlayProgressBar",Qp);var Ay=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.update=Aa(Pi(Ft(r),r.update),wr),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},o.update=function(e,r){var l=this,f=r*this.player_.duration();this.getChild("timeTooltip").updateTime(e,r,f,function(){l.el_.style.left=e.width*r+"px"})},s}(qe);Ay.prototype.options_={children:["timeTooltip"]};qe.registerComponent("MouseTimeDisplay",Ay);var jc=5,Nv=12,Yp=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.setEventHandlers_(),r}var o=s.prototype;return o.setEventHandlers_=function(){var e=this;this.update_=Pi(this,this.update),this.update=Aa(this.update_,wr),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(r){return e.enableInterval_(r)},this.disableIntervalHandler_=function(r){return e.disableInterval_(r)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in et&&"visibilityState"in et&&this.on(et,"visibilitychange",this.toggleVisibility_)},o.toggleVisibility_=function(e){et.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},o.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,wr))},o.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},o.update=function(e){var r=this;if(et.visibilityState!=="hidden"){var l=d.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var f=r.player_.ended()?r.player_.duration():r.getCurrentTime_(),m=r.player_.liveTracker,v=r.player_.duration();m&&m.isLive()&&(v=r.player_.liveTracker.liveCurrentTime()),r.percent_!==l&&(r.el_.setAttribute("aria-valuenow",(l*100).toFixed(2)),r.percent_=l),(r.currentTime_!==f||r.duration_!==v)&&(r.el_.setAttribute("aria-valuetext",r.localize("progress bar timing: currentTime={1} duration={2}",[qo(f,v),qo(v,v)],"{1} of {2}")),r.currentTime_=f,r.duration_=v),r.bar&&r.bar.update(zo(r.el()),r.getProgress())}),l}},o.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},o.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},o.getPercent=function(){var e=this.getCurrentTime_(),r,l=this.player_.liveTracker;return l&&l.isLive()?(r=(e-l.seekableStart())/l.liveWindow(),l.atLiveEdge()&&(r=1)):r=e/this.player_.duration(),r},o.handleMouseDown=function(e){bu(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),d.prototype.handleMouseDown.call(this,e))},o.handleMouseMove=function(e,r){if(r===void 0&&(r=!1),!!bu(e)){!r&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var l,f=this.calculateDistance(e),m=this.player_.liveTracker;if(!m||!m.isLive())l=f*this.player_.duration(),l===this.player_.duration()&&(l=l-.1);else{if(f>=.99){m.seekToLiveEdge();return}var v=m.seekableStart(),A=m.liveCurrentTime();if(l=v+f*m.liveWindow(),l>=A&&(l=A),l<=v&&(l=v+.1),l===1/0)return}this.userSeek_(l)}},o.enable=function(){d.prototype.enable.call(this);var e=this.getChild("mouseTimeDisplay");e&&e.show()},o.disable=function(){d.prototype.disable.call(this);var e=this.getChild("mouseTimeDisplay");e&&e.hide()},o.handleMouseUp=function(e){d.prototype.handleMouseUp.call(this,e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?qr(this.player_.play()):this.update_()},o.stepForward=function(){this.userSeek_(this.player_.currentTime()+jc)},o.stepBack=function(){this.userSeek_(this.player_.currentTime()-jc)},o.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},o.handleKeyDown=function(e){var r=this.player_.liveTracker;if(Nt.isEventKey(e,"Space")||Nt.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(Nt.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(Nt.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),r&&r.isLive()?this.userSeek_(r.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(Nt(e))){e.preventDefault(),e.stopPropagation();var l=(Nt.codes[Nt(e)]-Nt.codes[0])*10/100;r&&r.isLive()?this.userSeek_(r.seekableStart()+r.liveWindow()*l):this.userSeek_(this.player_.duration()*l)}else Nt.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-jc*Nv)):Nt.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+jc*Nv)):d.prototype.handleKeyDown.call(this,e)},o.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in et&&"visibilityState"in et&&this.off(et,"visibilitychange",this.toggleVisibility_),d.prototype.dispose.call(this)},s}(Xp);Yp.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"};!En&&!Sa&&Yp.prototype.options_.children.splice(1,0,"mouseTimeDisplay");qe.registerComponent("SeekBar",Yp);var Sy=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.handleMouseMove=Aa(Pi(Ft(r),r.handleMouseMove),wr),r.throttledHandleMouseSeek=Aa(Pi(Ft(r),r.handleMouseSeek),wr),r.handleMouseUpHandler_=function(l){return r.handleMouseUp(l)},r.handleMouseDownHandler_=function(l){return r.handleMouseDown(l)},r.enable(),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},o.handleMouseMove=function(e){var r=this.getChild("seekBar");if(r){var l=r.getChild("playProgressBar"),f=r.getChild("mouseTimeDisplay");if(!(!l&&!f)){var m=r.el(),v=xu(m),A=Md(m,e).x;A=Rd(A,0,1),f&&f.update(v,A),l&&l.update(v,r.getProgress())}}},o.handleMouseSeek=function(e){var r=this.getChild("seekBar");r&&r.handleMouseMove(e)},o.enabled=function(){return this.enabled_},o.disable=function(){if(this.children().forEach(function(r){return r.disable&&r.disable()}),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&qr(this.player_.play())}},o.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},o.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)},o.handleMouseDown=function(e){var r=this.el_.ownerDocument,l=this.getChild("seekBar");l&&l.handleMouseDown(e),this.on(r,"mousemove",this.throttledHandleMouseSeek),this.on(r,"touchmove",this.throttledHandleMouseSeek),this.on(r,"mouseup",this.handleMouseUpHandler_),this.on(r,"touchend",this.handleMouseUpHandler_)},o.handleMouseUp=function(e){var r=this.getChild("seekBar");r&&r.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},s}(qe);Sy.prototype.options_={children:["seekBar"]};qe.registerComponent("ProgressControl",Sy);var wy=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.on(a,["enterpictureinpicture","leavepictureinpicture"],function(l){return r.handlePictureInPictureChange(l)}),r.on(a,["disablepictureinpicturechanged","loadedmetadata"],function(l){return r.handlePictureInPictureEnabledChange(l)}),r.on(a,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){var l=a.currentType().substring(0,5)==="audio";l||a.audioPosterMode()||a.audioOnlyMode()?(a.isInPictureInPicture()&&a.exitPictureInPicture(),r.hide()):r.show()}),r.disable(),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-picture-in-picture-control "+d.prototype.buildCSSClass.call(this)},o.handlePictureInPictureEnabledChange=function(){et.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1?this.enable():this.disable()},o.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},o.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},s}(Sr);wy.prototype.controlText_="Picture-in-Picture";qe.registerComponent("PictureInPictureToggle",wy);var Ey=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.on(a,"fullscreenchange",function(l){return r.handleFullscreenChange(l)}),et[a.fsApi_.fullscreenEnabled]===!1&&r.disable(),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-fullscreen-control "+d.prototype.buildCSSClass.call(this)},o.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},o.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},s}(Sr);Ey.prototype.controlText_="Fullscreen";qe.registerComponent("FullscreenToggle",Ey);var aM=function(s,o){o.tech_&&!o.tech_.featuresVolumeControl&&s.addClass("vjs-hidden"),s.on(o,"loadstart",function(){o.tech_.featuresVolumeControl?s.removeClass("vjs-hidden"):s.addClass("vjs-hidden")})},sM=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.createEl=function(){var e=d.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return e.appendChild(d.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),e},s}(qe);qe.registerComponent("VolumeLevel",sM);var oM=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.update=Aa(Pi(Ft(r),r.update),wr),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},o.update=function(e,r,l,f){if(!l){var m=zo(this.el_),v=zo(this.player_.el()),A=e.width*r;if(!v||!m)return;var L=e.left-v.left+A,P=e.width-A+(v.right-e.right),U=m.width/2;L<U?U+=U-L:P<U&&(U=P),U<0?U=0:U>m.width&&(U=m.width),this.el_.style.right="-"+U+"px"}this.write(f+"%")},o.write=function(e){Ds(this.el_,e)},o.updateVolume=function(e,r,l,f,m){var v=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){v.update(e,r,l,f.toFixed(0)),m&&m()})},s}(qe);qe.registerComponent("VolumeLevelTooltip",oM);var My=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.update=Aa(Pi(Ft(r),r.update),wr),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},o.update=function(e,r,l){var f=this,m=100*r;this.getChild("volumeLevelTooltip").updateVolume(e,r,l,m,function(){l?f.el_.style.bottom=e.height*r+"px":f.el_.style.left=e.width*r+"px"})},s}(qe);My.prototype.options_={children:["volumeLevelTooltip"]};qe.registerComponent("MouseVolumeLevelDisplay",My);var Od=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.on("slideractive",function(l){return r.updateLastVolume_(l)}),r.on(a,"volumechange",function(l){return r.updateARIAAttributes(l)}),a.ready(function(){return r.updateARIAAttributes()}),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},o.handleMouseDown=function(e){bu(e)&&d.prototype.handleMouseDown.call(this,e)},o.handleMouseMove=function(e){var r=this.getChild("mouseVolumeLevelDisplay");if(r){var l=this.el(),f=zo(l),m=this.vertical(),v=Md(l,e);v=m?v.y:v.x,v=Rd(v,0,1),r.update(f,v,m)}bu(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},o.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},o.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},o.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},o.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},o.updateARIAAttributes=function(e){var r=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",r),this.el_.setAttribute("aria-valuetext",r+"%")},o.volumeAsPercentage_=function(){return Math.round(this.player_.volume()*100)},o.updateLastVolume_=function(){var e=this,r=this.player_.volume();this.one("sliderinactive",function(){e.player_.volume()===0&&e.player_.lastVolume_(r)})},s}(Xp);Od.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!En&&!Sa&&Od.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");Od.prototype.playerEvent="volumechange";qe.registerComponent("VolumeBar",Od);var Cy=function(d){it(s,d);function s(a,e){var r;return e===void 0&&(e={}),e.vertical=e.vertical||!1,(typeof e.volumeBar>"u"||yu(e.volumeBar))&&(e.volumeBar=e.volumeBar||{},e.volumeBar.vertical=e.vertical),r=d.call(this,a,e)||this,aM(Ft(r),a),r.throttledHandleMouseMove=Aa(Pi(Ft(r),r.handleMouseMove),wr),r.handleMouseUpHandler_=function(l){return r.handleMouseUp(l)},r.on("mousedown",function(l){return r.handleMouseDown(l)}),r.on("touchstart",function(l){return r.handleMouseDown(l)}),r.on("mousemove",function(l){return r.handleMouseMove(l)}),r.on(r.volumeBar,["focus","slideractive"],function(){r.volumeBar.addClass("vjs-slider-active"),r.addClass("vjs-slider-active"),r.trigger("slideractive")}),r.on(r.volumeBar,["blur","sliderinactive"],function(){r.volumeBar.removeClass("vjs-slider-active"),r.removeClass("vjs-slider-active"),r.trigger("sliderinactive")}),r}var o=s.prototype;return o.createEl=function(){var e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),d.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+e})},o.handleMouseDown=function(e){var r=this.el_.ownerDocument;this.on(r,"mousemove",this.throttledHandleMouseMove),this.on(r,"touchmove",this.throttledHandleMouseMove),this.on(r,"mouseup",this.handleMouseUpHandler_),this.on(r,"touchend",this.handleMouseUpHandler_)},o.handleMouseUp=function(e){var r=this.el_.ownerDocument;this.off(r,"mousemove",this.throttledHandleMouseMove),this.off(r,"touchmove",this.throttledHandleMouseMove),this.off(r,"mouseup",this.handleMouseUpHandler_),this.off(r,"touchend",this.handleMouseUpHandler_)},o.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},s}(qe);Cy.prototype.options_={children:["volumeBar"]};qe.registerComponent("VolumeControl",Cy);var lM=function(s,o){o.tech_&&!o.tech_.featuresMuteControl&&s.addClass("vjs-hidden"),s.on(o,"loadstart",function(){o.tech_.featuresMuteControl?s.removeClass("vjs-hidden"):s.addClass("vjs-hidden")})},Py=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,lM(Ft(r),a),r.on(a,["loadstart","volumechange"],function(l){return r.update(l)}),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-mute-control "+d.prototype.buildCSSClass.call(this)},o.handleClick=function(e){var r=this.player_.volume(),l=this.player_.lastVolume_();if(r===0){var f=l<.1?.1:l;this.player_.volume(f),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},o.update=function(e){this.updateIcon_(),this.updateControlText_()},o.updateIcon_=function(){var e=this.player_.volume(),r=3;En&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?r=0:e<.33?r=1:e<.67&&(r=2);for(var l=0;l<4;l++)wu(this.el_,"vjs-vol-"+l);_a(this.el_,"vjs-vol-"+r)},o.updateControlText_=function(){var e=this.player_.muted()||this.player_.volume()===0,r=e?"Unmute":"Mute";this.controlText()!==r&&this.controlText(r)},s}(Sr);Py.prototype.controlText_="Mute";qe.registerComponent("MuteToggle",Py);var Ly=function(d){it(s,d);function s(a,e){var r;return e===void 0&&(e={}),typeof e.inline<"u"?e.inline=e.inline:e.inline=!0,(typeof e.volumeControl>"u"||yu(e.volumeControl))&&(e.volumeControl=e.volumeControl||{},e.volumeControl.vertical=!e.inline),r=d.call(this,a,e)||this,r.handleKeyPressHandler_=function(l){return r.handleKeyPress(l)},r.on(a,["loadstart"],function(l){return r.volumePanelState_(l)}),r.on(r.muteToggle,"keyup",function(l){return r.handleKeyPress(l)}),r.on(r.volumeControl,"keyup",function(l){return r.handleVolumeControlKeyUp(l)}),r.on("keydown",function(l){return r.handleKeyPress(l)}),r.on("mouseover",function(l){return r.handleMouseOver(l)}),r.on("mouseout",function(l){return r.handleMouseOut(l)}),r.on(r.volumeControl,["slideractive"],r.sliderActive_),r.on(r.volumeControl,["sliderinactive"],r.sliderInactive_),r}var o=s.prototype;return o.sliderActive_=function(){this.addClass("vjs-slider-active")},o.sliderInactive_=function(){this.removeClass("vjs-slider-active")},o.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},o.createEl=function(){var e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),d.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+e})},o.dispose=function(){this.handleMouseOut(),d.prototype.dispose.call(this)},o.handleVolumeControlKeyUp=function(e){Nt.isEventKey(e,"Esc")&&this.muteToggle.focus()},o.handleMouseOver=function(e){this.addClass("vjs-hover"),Kn(et,"keyup",this.handleKeyPressHandler_)},o.handleMouseOut=function(e){this.removeClass("vjs-hover"),vn(et,"keyup",this.handleKeyPressHandler_)},o.handleKeyPress=function(e){Nt.isEventKey(e,"Esc")&&this.handleMouseOut()},s}(qe);Ly.prototype.options_={children:["muteToggle","volumeControl"]};qe.registerComponent("VolumePanel",Ly);var Iy=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,e&&(r.menuButton_=e.menuButton),r.focusedChild_=-1,r.on("keydown",function(l){return r.handleKeyDown(l)}),r.boundHandleBlur_=function(l){return r.handleBlur(l)},r.boundHandleTapClick_=function(l){return r.handleTapClick(l)},r}var o=s.prototype;return o.addEventListenerForItem=function(e){e instanceof qe&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},o.removeEventListenerForItem=function(e){e instanceof qe&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},o.removeChild=function(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),d.prototype.removeChild.call(this,e)},o.addItem=function(e){var r=this.addChild(e);r&&this.addEventListenerForItem(r)},o.createEl=function(){var e=this.options_.contentElType||"ul";this.contentEl_=ri(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var r=d.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return r.appendChild(this.contentEl_),Kn(r,"click",function(l){l.preventDefault(),l.stopImmediatePropagation()}),r},o.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,d.prototype.dispose.call(this)},o.handleBlur=function(e){var r=e.relatedTarget||et.activeElement;if(!this.children().some(function(f){return f.el()===r})){var l=this.menuButton_;l&&l.buttonPressed_&&r!==l.el().firstChild&&l.unpressButton()}},o.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var r=this.children();if(!Array.isArray(r))return;var l=r.filter(function(f){return f.el()===e.target})[0];if(!l)return;l.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}},o.handleKeyDown=function(e){Nt.isEventKey(e,"Left")||Nt.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(Nt.isEventKey(e,"Right")||Nt.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},o.stepForward=function(){var e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)},o.stepBack=function(){var e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)},o.focus=function(e){e===void 0&&(e=0);var r=this.children().slice(),l=r.length&&r[0].hasClass("vjs-menu-title");l&&r.shift(),r.length>0&&(e<0?e=0:e>=r.length&&(e=r.length-1),this.focusedChild_=e,r[e].el_.focus())},s}(qe);qe.registerComponent("Menu",Iy);var Kp=function(d){it(s,d);function s(a,e){var r;e===void 0&&(e={}),r=d.call(this,a,e)||this,r.menuButton_=new Sr(a,e),r.menuButton_.controlText(r.controlText_),r.menuButton_.el_.setAttribute("aria-haspopup","true");var l=Sr.prototype.buildCSSClass();r.menuButton_.el_.className=r.buildCSSClass()+" "+l,r.menuButton_.removeClass("vjs-control"),r.addChild(r.menuButton_),r.update(),r.enabled_=!0;var f=function(v){return r.handleClick(v)};return r.handleMenuKeyUp_=function(m){return r.handleMenuKeyUp(m)},r.on(r.menuButton_,"tap",f),r.on(r.menuButton_,"click",f),r.on(r.menuButton_,"keydown",function(m){return r.handleKeyDown(m)}),r.on(r.menuButton_,"mouseenter",function(){r.addClass("vjs-hover"),r.menu.show(),Kn(et,"keyup",r.handleMenuKeyUp_)}),r.on("mouseleave",function(m){return r.handleMouseLeave(m)}),r.on("keydown",function(m){return r.handleSubmenuKeyDown(m)}),r}var o=s.prototype;return o.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},o.createMenu=function(){var e=new Iy(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var r=ri("li",{className:"vjs-menu-title",textContent:ji(this.options_.title),tabIndex:-1}),l=new qe(this.player_,{el:r});e.addItem(l)}if(this.items=this.createItems(),this.items)for(var f=0;f<this.items.length;f++)e.addItem(this.items[f]);return e},o.createItems=function(){},o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},o.buildWrapperCSSClass=function(){var e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";var r=Sr.prototype.buildCSSClass();return"vjs-menu-button "+e+" "+r+" "+d.prototype.buildCSSClass.call(this)},o.buildCSSClass=function(){var e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup","vjs-menu-button "+e+" "+d.prototype.buildCSSClass.call(this)},o.controlText=function(e,r){return r===void 0&&(r=this.menuButton_.el()),this.menuButton_.controlText(e,r)},o.dispose=function(){this.handleMouseLeave(),d.prototype.dispose.call(this)},o.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},o.handleMouseLeave=function(e){this.removeClass("vjs-hover"),vn(et,"keyup",this.handleMenuKeyUp_)},o.focus=function(){this.menuButton_.focus()},o.blur=function(){this.menuButton_.blur()},o.handleKeyDown=function(e){Nt.isEventKey(e,"Esc")||Nt.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),Nt.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(Nt.isEventKey(e,"Up")||Nt.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},o.handleMenuKeyUp=function(e){(Nt.isEventKey(e,"Esc")||Nt.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")},o.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},o.handleSubmenuKeyDown=function(e){(Nt.isEventKey(e,"Esc")||Nt.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),Nt.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},o.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),En&&q0())return;this.menu.focus()}},o.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},o.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},o.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},s}(qe);qe.registerComponent("MenuButton",Kp);var Zp=function(d){it(s,d);function s(o,a){var e,r=a.tracks;if(e=d.call(this,o,a)||this,e.items.length<=1&&e.hide(),!r)return Ft(e);var l=Pi(Ft(e),e.update);return r.addEventListener("removetrack",l),r.addEventListener("addtrack",l),r.addEventListener("labelchange",l),e.player_.on("ready",l),e.player_.on("dispose",function(){r.removeEventListener("removetrack",l),r.removeEventListener("addtrack",l),r.removeEventListener("labelchange",l)}),e}return s}(Kp);qe.registerComponent("TrackButton",Zp);var uM=["Tab","Esc","Up","Down","Right","Left"],Mu=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.selectable=e.selectable,r.isSelected_=e.selected||!1,r.multiSelectable=e.multiSelectable,r.selected(r.isSelected_),r.selectable?r.multiSelectable?r.el_.setAttribute("role","menuitemcheckbox"):r.el_.setAttribute("role","menuitemradio"):r.el_.setAttribute("role","menuitem"),r}var o=s.prototype;return o.createEl=function(e,r,l){this.nonIconControl=!0;var f=d.prototype.createEl.call(this,"li",Gi({className:"vjs-menu-item",tabIndex:-1},r),l);return f.replaceChild(ri("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),f.querySelector(".vjs-icon-placeholder")),f},o.handleKeyDown=function(e){uM.some(function(r){return Nt.isEventKey(e,r)})||d.prototype.handleKeyDown.call(this,e)},o.handleClick=function(e){this.selected(!0)},o.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},s}(Dd);qe.registerComponent("MenuItem",Mu);var Cu=function(d){it(s,d);function s(a,e){var r,l=e.track,f=a.textTracks();e.label=l.label||l.language||"Unknown",e.selected=l.mode==="showing",r=d.call(this,a,e)||this,r.track=l,r.kinds=(e.kinds||[e.kind||r.track.kind]).filter(Boolean);var m=function(){for(var P=arguments.length,U=new Array(P),W=0;W<P;W++)U[W]=arguments[W];r.handleTracksChange.apply(Ft(r),U)},v=function(){for(var P=arguments.length,U=new Array(P),W=0;W<P;W++)U[W]=arguments[W];r.handleSelectedLanguageChange.apply(Ft(r),U)};if(a.on(["loadstart","texttrackchange"],m),f.addEventListener("change",m),f.addEventListener("selectedlanguagechange",v),r.on("dispose",function(){a.off(["loadstart","texttrackchange"],m),f.removeEventListener("change",m),f.removeEventListener("selectedlanguagechange",v)}),f.onchange===void 0){var A;r.on(["tap","click"],function(){if(typeof ie.Event!="object")try{A=new ie.Event("change")}catch{}A||(A=et.createEvent("Event"),A.initEvent("change",!0,!0)),f.dispatchEvent(A)})}return r.handleTracksChange(),r}var o=s.prototype;return o.handleClick=function(e){var r=this.track,l=this.player_.textTracks();if(d.prototype.handleClick.call(this,e),!!l)for(var f=0;f<l.length;f++){var m=l[f];this.kinds.indexOf(m.kind)!==-1&&(m===r?m.mode!=="showing"&&(m.mode="showing"):m.mode!=="disabled"&&(m.mode="disabled"))}},o.handleTracksChange=function(e){var r=this.track.mode==="showing";r!==this.isSelected_&&this.selected(r)},o.handleSelectedLanguageChange=function(e){if(this.track.mode==="showing"){var r=this.player_.cache_.selectedLanguage;if(r&&r.enabled&&r.language===this.track.language&&r.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},o.dispose=function(){this.track=null,d.prototype.dispose.call(this)},s}(Mu);qe.registerComponent("TextTrackMenuItem",Cu);var Dy=function(d){it(s,d);function s(a,e){return e.track={player:a,kind:e.kind,kinds:e.kinds,default:!1,mode:"disabled"},e.kinds||(e.kinds=[e.kind]),e.label?e.track.label=e.label:e.track.label=e.kinds.join(" and ")+" off",e.selectable=!0,e.multiSelectable=!1,d.call(this,a,e)||this}var o=s.prototype;return o.handleTracksChange=function(e){for(var r=this.player().textTracks(),l=!0,f=0,m=r.length;f<m;f++){var v=r[f];if(this.options_.kinds.indexOf(v.kind)>-1&&v.mode==="showing"){l=!1;break}}l!==this.isSelected_&&this.selected(l)},o.handleSelectedLanguageChange=function(e){for(var r=this.player().textTracks(),l=!0,f=0,m=r.length;f<m;f++){var v=r[f];if(["captions","descriptions","subtitles"].indexOf(v.kind)>-1&&v.mode==="showing"){l=!1;break}}l&&(this.player_.cache_.selectedLanguage={enabled:!1})},s}(Cu);qe.registerComponent("OffTextTrackMenuItem",Dy);var el=function(d){it(s,d);function s(a,e){return e===void 0&&(e={}),e.tracks=a.textTracks(),d.call(this,a,e)||this}var o=s.prototype;return o.createItems=function(e,r){e===void 0&&(e=[]),r===void 0&&(r=Cu);var l;this.label_&&(l=this.label_+" off"),e.push(new Dy(this.player_,{kinds:this.kinds_,kind:this.kind_,label:l})),this.hideThreshold_+=1;var f=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var m=0;m<f.length;m++){var v=f[m];if(this.kinds_.indexOf(v.kind)>-1){var A=new r(this.player_,{track:v,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});A.addClass("vjs-"+v.kind+"-menu-item"),e.push(A)}}return e},s}(Zp);qe.registerComponent("TextTrackButton",el);var Ry=function(d){it(s,d);function s(a,e){var r,l=e.track,f=e.cue,m=a.currentTime();return e.selectable=!0,e.multiSelectable=!1,e.label=f.text,e.selected=f.startTime<=m&&m<f.endTime,r=d.call(this,a,e)||this,r.track=l,r.cue=f,r}var o=s.prototype;return o.handleClick=function(e){d.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},s}(Mu);qe.registerComponent("ChaptersTrackMenuItem",Ry);var $p=function(d){it(s,d);function s(a,e,r){var l;return l=d.call(this,a,e,r)||this,l.selectCurrentItem_=function(){l.items.forEach(function(f){f.selected(l.track_.activeCues[0]===f.cue)})},l}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-chapters-button "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-chapters-button "+d.prototype.buildWrapperCSSClass.call(this)},o.update=function(e){if(!(e&&e.track&&e.track.kind!=="chapters")){var r=this.findChaptersTrack();r!==this.track_?(this.setTrack(r),d.prototype.update.call(this)):(!this.items||r&&r.cues&&r.cues.length!==this.items.length)&&d.prototype.update.call(this)}},o.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var r=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);r&&r.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var l=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);l&&l.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},o.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],r=e.length-1;r>=0;r--){var l=e[r];if(l.kind===this.kind_)return l}},o.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(ji(this.kind_))},o.createMenu=function(){return this.options_.title=this.getMenuCaption(),d.prototype.createMenu.call(this)},o.createItems=function(){var e=[];if(!this.track_)return e;var r=this.track_.cues;if(!r)return e;for(var l=0,f=r.length;l<f;l++){var m=r[l],v=new Ry(this.player_,{track:this.track_,cue:m});e.push(v)}return e},s}(el);$p.prototype.kind_="chapters";$p.prototype.controlText_="Chapters";qe.registerComponent("ChaptersButton",$p);var Jp=function(d){it(s,d);function s(a,e,r){var l;l=d.call(this,a,e,r)||this;var f=a.textTracks(),m=Pi(Ft(l),l.handleTracksChange);return f.addEventListener("change",m),l.on("dispose",function(){f.removeEventListener("change",m)}),l}var o=s.prototype;return o.handleTracksChange=function(e){for(var r=this.player().textTracks(),l=!1,f=0,m=r.length;f<m;f++){var v=r[f];if(v.kind!==this.kind_&&v.mode==="showing"){l=!0;break}}l?this.disable():this.enable()},o.buildCSSClass=function(){return"vjs-descriptions-button "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+d.prototype.buildWrapperCSSClass.call(this)},s}(el);Jp.prototype.kind_="descriptions";Jp.prototype.controlText_="Descriptions";qe.registerComponent("DescriptionsButton",Jp);var em=function(d){it(s,d);function s(a,e,r){return d.call(this,a,e,r)||this}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-subtitles-button "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+d.prototype.buildWrapperCSSClass.call(this)},s}(el);em.prototype.kind_="subtitles";em.prototype.controlText_="Subtitles";qe.registerComponent("SubtitlesButton",em);var tm=function(d){it(s,d);function s(a,e){var r;return e.track={player:a,kind:e.kind,label:e.kind+" settings",selectable:!1,default:!1,mode:"disabled"},e.selectable=!1,e.name="CaptionSettingsMenuItem",r=d.call(this,a,e)||this,r.addClass("vjs-texttrack-settings"),r.controlText(", opens "+e.kind+" settings dialog"),r}var o=s.prototype;return o.handleClick=function(e){this.player().getChild("textTrackSettings").open()},s}(Cu);qe.registerComponent("CaptionSettingsMenuItem",tm);var im=function(d){it(s,d);function s(a,e,r){return d.call(this,a,e,r)||this}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-captions-button "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-captions-button "+d.prototype.buildWrapperCSSClass.call(this)},o.createItems=function(){var e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new tm(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),d.prototype.createItems.call(this,e)},s}(el);im.prototype.kind_="captions";im.prototype.controlText_="Captions";qe.registerComponent("CaptionsButton",im);var Oy=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.createEl=function(e,r,l){var f=d.prototype.createEl.call(this,e,r,l),m=f.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(m.appendChild(ri("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),m.appendChild(ri("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),f},s}(Cu);qe.registerComponent("SubsCapsMenuItem",Oy);var nm=function(d){it(s,d);function s(a,e){var r;return e===void 0&&(e={}),r=d.call(this,a,e)||this,r.label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(r.player_.language_)>-1&&(r.label_="captions"),r.menuButton_.controlText(ji(r.label_)),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-subs-caps-button "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+d.prototype.buildWrapperCSSClass.call(this)},o.createItems=function(){var e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new tm(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=d.prototype.createItems.call(this,e,Oy),e},s}(el);nm.prototype.kinds_=["captions","subtitles"];nm.prototype.controlText_="Subtitles";qe.registerComponent("SubsCapsButton",nm);var Fy=function(d){it(s,d);function s(a,e){var r,l=e.track,f=a.audioTracks();e.label=l.label||l.language||"Unknown",e.selected=l.enabled,r=d.call(this,a,e)||this,r.track=l,r.addClass("vjs-"+l.kind+"-menu-item");var m=function(){for(var A=arguments.length,L=new Array(A),P=0;P<A;P++)L[P]=arguments[P];r.handleTracksChange.apply(Ft(r),L)};return f.addEventListener("change",m),r.on("dispose",function(){f.removeEventListener("change",m)}),r}var o=s.prototype;return o.createEl=function(e,r,l){var f=d.prototype.createEl.call(this,e,r,l),m=f.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="main-desc"&&(m.appendChild(ri("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),m.appendChild(ri("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),f},o.handleClick=function(e){if(d.prototype.handleClick.call(this,e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var r=this.player_.audioTracks(),l=0;l<r.length;l++){var f=r[l];f!==this.track&&(f.enabled=f===this.track)}},o.handleTracksChange=function(e){this.selected(this.track.enabled)},s}(Mu);qe.registerComponent("AudioTrackMenuItem",Fy);var ky=function(d){it(s,d);function s(a,e){return e===void 0&&(e={}),e.tracks=a.audioTracks(),d.call(this,a,e)||this}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-audio-button "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-audio-button "+d.prototype.buildWrapperCSSClass.call(this)},o.createItems=function(e){e===void 0&&(e=[]),this.hideThreshold_=1;for(var r=this.player_.audioTracks(),l=0;l<r.length;l++){var f=r[l];e.push(new Fy(this.player_,{track:f,selectable:!0,multiSelectable:!1}))}return e},s}(Zp);ky.prototype.controlText_="Audio Track";qe.registerComponent("AudioTrackButton",ky);var rm=function(d){it(s,d);function s(a,e){var r,l=e.rate,f=parseFloat(l,10);return e.label=l,e.selected=f===a.playbackRate(),e.selectable=!0,e.multiSelectable=!1,r=d.call(this,a,e)||this,r.label=l,r.rate=f,r.on(a,"ratechange",function(m){return r.update(m)}),r}var o=s.prototype;return o.handleClick=function(e){d.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},o.update=function(e){this.selected(this.player().playbackRate()===this.rate)},s}(Mu);rm.prototype.contentElType="button";qe.registerComponent("PlaybackRateMenuItem",rm);var By=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.menuButton_.el_.setAttribute("aria-describedby",r.labelElId_),r.updateVisibility(),r.updateLabel(),r.on(a,"loadstart",function(l){return r.updateVisibility(l)}),r.on(a,"ratechange",function(l){return r.updateLabel(l)}),r.on(a,"playbackrateschange",function(l){return r.handlePlaybackRateschange(l)}),r}var o=s.prototype;return o.createEl=function(){var e=d.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=ri("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e},o.dispose=function(){this.labelEl_=null,d.prototype.dispose.call(this)},o.buildCSSClass=function(){return"vjs-playback-rate "+d.prototype.buildCSSClass.call(this)},o.buildWrapperCSSClass=function(){return"vjs-playback-rate "+d.prototype.buildWrapperCSSClass.call(this)},o.createItems=function(){for(var e=this.playbackRates(),r=[],l=e.length-1;l>=0;l--)r.push(new rm(this.player(),{rate:e[l]+"x"}));return r},o.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},o.handleClick=function(e){var r=this.player().playbackRate(),l=this.playbackRates(),f=l.indexOf(r),m=(f+1)%l.length;this.player().playbackRate(l[m])},o.handlePlaybackRateschange=function(e){this.update()},o.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},o.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},o.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},o.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},s}(Kp);By.prototype.controlText_="Playback Rate";qe.registerComponent("PlaybackRateMenuButton",By);var Ny=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-spacer "+d.prototype.buildCSSClass.call(this)},o.createEl=function(e,r,l){return e===void 0&&(e="div"),r===void 0&&(r={}),l===void 0&&(l={}),r.className||(r.className=this.buildCSSClass()),d.prototype.createEl.call(this,e,r,l)},s}(qe);qe.registerComponent("Spacer",Ny);var cM=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-custom-control-spacer "+d.prototype.buildCSSClass.call(this)},o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:" "})},s}(Ny);qe.registerComponent("CustomControlSpacer",cM);var ld=function(d){it(s,d);function s(){return d.apply(this,arguments)||this}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},s}(qe);ld.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]};"exitPictureInPicture"in et&&ld.prototype.options_.children.splice(ld.prototype.options_.children.length-1,0,"pictureInPictureToggle");qe.registerComponent("ControlBar",ld);var Uy=function(d){it(s,d);function s(a,e){var r;return r=d.call(this,a,e)||this,r.on(a,"error",function(l){return r.open(l)}),r}var o=s.prototype;return o.buildCSSClass=function(){return"vjs-error-display "+d.prototype.buildCSSClass.call(this)},o.content=function(){var e=this.player().error();return e?this.localize(e.message):""},s}(Zo);Uy.prototype.options_=ba({},Zo.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});qe.registerComponent("ErrorDisplay",Uy);var jf="vjs-text-track-settings",Uv=["#000","Black"],Hv=["#00F","Blue"],Vv=["#0FF","Cyan"],Gv=["#0F0","Green"],zv=["#F0F","Magenta"],Wv=["#F00","Red"],jv=["#FFF","White"],qv=["#FF0","Yellow"],qf=["1","Opaque"],Xf=["0.5","Semi-Transparent"],Xv=["0","Transparent"],Es={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Uv,jv,Wv,Gv,Hv,qv,zv,Vv]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[qf,Xf,Xv]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[jv,Uv,Wv,Gv,Hv,qv,zv,Vv]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(s){return s==="1.00"?null:Number(s)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[qf,Xf]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[Xv,Xf,qf]}};Es.windowColor.options=Es.backgroundColor.options;function Hy(d,s){if(s&&(d=s(d)),d&&d!=="none")return d}function dM(d,s){var o=d.options[d.options.selectedIndex].value;return Hy(o,s)}function hM(d,s,o){if(s){for(var a=0;a<d.options.length;a++)if(Hy(d.options[a].value,o)===s){d.selectedIndex=a;break}}}var fM=function(d){it(s,d);function s(a,e){var r;return e.temporary=!1,r=d.call(this,a,e)||this,r.updateDisplay=r.updateDisplay.bind(Ft(r)),r.fill(),r.hasBeenOpened_=r.hasBeenFilled_=!0,r.endDialog=ri("p",{className:"vjs-control-text",textContent:r.localize("End of dialog window.")}),r.el().appendChild(r.endDialog),r.setDefaults(),e.persistTextTrackSettings===void 0&&(r.options_.persistTextTrackSettings=r.options_.playerOptions.persistTextTrackSettings),r.on(r.$(".vjs-done-button"),"click",function(){r.saveSettings(),r.close()}),r.on(r.$(".vjs-default-button"),"click",function(){r.setDefaults(),r.updateDisplay()}),Fo(Es,function(l){r.on(r.$(l.selector),"change",r.updateDisplay)}),r.options_.persistTextTrackSettings&&r.restoreSettings(),r}var o=s.prototype;return o.dispose=function(){this.endDialog=null,d.prototype.dispose.call(this)},o.createElSelect_=function(e,r,l){var f=this;r===void 0&&(r=""),l===void 0&&(l="label");var m=Es[e],v=m.id.replace("%s",this.id_),A=[r,v].join(" ").trim();return["<"+l+' id="'+v+'" class="'+(l==="label"?"vjs-label":"")+'">',this.localize(m.label),"</"+l+">",'<select aria-labelledby="'+A+'">'].concat(m.options.map(function(L){var P=v+"-"+L[1].replace(/\W+/g,"");return['<option id="'+P+'" value="'+L[0]+'" ','aria-labelledby="'+A+" "+P+'">',f.localize(L[1]),"</option>"].join("")})).concat("</select>").join("")},o.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},o.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},o.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},o.createElColors_=function(){return ri("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},o.createElFont_=function(){return ri("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},o.createElControls_=function(){var e=this.localize("restore all settings to the default values");return ri("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},o.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},o.label=function(){return this.localize("Caption Settings Dialog")},o.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},o.buildCSSClass=function(){return d.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},o.getValues=function(){var e=this;return tE(Es,function(r,l,f){var m=dM(e.$(l.selector),l.parser);return m!==void 0&&(r[f]=m),r},{})},o.setValues=function(e){var r=this;Fo(Es,function(l,f){hM(r.$(l.selector),e[f],l.parser)})},o.setDefaults=function(){var e=this;Fo(Es,function(r){var l=r.hasOwnProperty("default")?r.default:0;e.$(r.selector).selectedIndex=l})},o.restoreSettings=function(){var e;try{e=JSON.parse(ie.localStorage.getItem(jf))}catch(r){Xt.warn(r)}e&&this.setValues(e)},o.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?ie.localStorage.setItem(jf,JSON.stringify(e)):ie.localStorage.removeItem(jf)}catch(r){Xt.warn(r)}}},o.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},o.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,r=e&&e.subsCapsButton,l=e&&e.captionsButton;r?r.focus():l&&l.focus()},s}(Zo);qe.registerComponent("TextTrackSettings",fM);var pM=function(d){it(s,d);function s(a,e){var r,l=e.ResizeObserver||ie.ResizeObserver;e.ResizeObserver===null&&(l=!1);var f=Ci({createEl:!l,reportTouchActivity:!1},e);return r=d.call(this,a,f)||this,r.ResizeObserver=e.ResizeObserver||ie.ResizeObserver,r.loadListener_=null,r.resizeObserver_=null,r.debouncedHandler_=hE(function(){r.resizeHandler()},100,!1,Ft(r)),l?(r.resizeObserver_=new r.ResizeObserver(r.debouncedHandler_),r.resizeObserver_.observe(a.el())):(r.loadListener_=function(){if(!(!r.el_||!r.el_.contentWindow)){var m=r.debouncedHandler_,v=r.unloadListener_=function(){vn(this,"resize",m),vn(this,"unload",v),v=null};Kn(r.el_.contentWindow,"unload",v),Kn(r.el_.contentWindow,"resize",m)}},r.one("load",r.loadListener_)),r}var o=s.prototype;return o.createEl=function(){return d.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},o.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},o.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,d.prototype.dispose.call(this)},s}(qe);qe.registerComponent("ResizeManager",pM);var mM={trackingThreshold:20,liveTolerance:15},gM=function(d){it(s,d);function s(a,e){var r,l=Ci(mM,e,{createEl:!1});return r=d.call(this,a,l)||this,r.handleVisibilityChange_=function(f){return r.handleVisibilityChange(f)},r.trackLiveHandler_=function(){return r.trackLive_()},r.handlePlay_=function(f){return r.handlePlay(f)},r.handleFirstTimeupdate_=function(f){return r.handleFirstTimeupdate(f)},r.handleSeeked_=function(f){return r.handleSeeked(f)},r.seekToLiveEdge_=function(f){return r.seekToLiveEdge(f)},r.reset_(),r.on(r.player_,"durationchange",function(f){return r.handleDurationchange(f)}),r.on(r.player_,"canplay",function(){return r.toggleTracking()}),Su&&"hidden"in et&&"visibilityState"in et&&r.on(et,"visibilitychange",r.handleVisibilityChange_),r}var o=s.prototype;return o.handleVisibilityChange=function(){this.player_.duration()===1/0&&(et.hidden?this.stopTracking():this.startTracking())},o.trackLive_=function(){var e=this.player_.seekable();if(!(!e||!e.length)){var r=Number(ie.performance.now().toFixed(4)),l=this.lastTime_===-1?0:(r-this.lastTime_)/1e3;this.lastTime_=r,this.pastSeekEnd_=this.pastSeekEnd()+l;var f=this.liveCurrentTime(),m=this.player_.currentTime(),v=this.player_.paused()||this.seekedBehindLive_||Math.abs(f-m)>this.options_.liveTolerance;(!this.timeupdateSeen_||f===1/0)&&(v=!1),v!==this.behindLiveEdge_&&(this.behindLiveEdge_=v,this.trigger("liveedgechange"))}},o.handleDurationchange=function(){this.toggleTracking()},o.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},o.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,wr),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},o.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},o.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()},o.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},o.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},o.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},o.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},o.seekableEnd=function(){for(var e=this.player_.seekable(),r=[],l=e?e.length:0;l--;)r.push(e.end(l));return r.length?r.sort()[r.length-1]:1/0},o.seekableStart=function(){for(var e=this.player_.seekable(),r=[],l=e?e.length:0;l--;)r.push(e.start(l));return r.length?r.sort()[0]:0},o.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},o.isLive=function(){return this.isTracking()},o.atLiveEdge=function(){return!this.behindLiveEdge()},o.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},o.pastSeekEnd=function(){var e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},o.behindLiveEdge=function(){return this.behindLiveEdge_},o.isTracking=function(){return typeof this.trackingInterval_=="number"},o.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},o.dispose=function(){this.off(et,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),d.prototype.dispose.call(this)},s}(qe);qe.registerComponent("LiveTracker",gM);var dp=function(s){var o=s.el();if(o.hasAttribute("src"))return s.triggerSourceset(o.src),!0;var a=s.$$("source"),e=[],r="";if(!a.length)return!1;for(var l=0;l<a.length;l++){var f=a[l].src;f&&e.indexOf(f)===-1&&e.push(f)}return e.length?(e.length===1&&(r=e[0]),s.triggerSourceset(r),!0):!1},vM=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(s){var o=et.createElement(this.nodeName.toLowerCase());o.innerHTML=s;for(var a=et.createDocumentFragment();o.childNodes.length;)a.appendChild(o.childNodes[0]);return this.innerText="",ie.Element.prototype.appendChild.call(this,a),this.innerHTML}}),Vy=function(s,o){for(var a={},e=0;e<s.length&&(a=Object.getOwnPropertyDescriptor(s[e],o),!(a&&a.set&&a.get));e++);return a.enumerable=!0,a.configurable=!0,a},yM=function(s){return Vy([s.el(),ie.HTMLMediaElement.prototype,ie.Element.prototype,vM],"innerHTML")},Qv=function(s){var o=s.el();if(!o.resetSourceWatch_){var a={},e=yM(s),r=function(f){return function(){for(var m=arguments.length,v=new Array(m),A=0;A<m;A++)v[A]=arguments[A];var L=f.apply(o,v);return dp(s),L}};["append","appendChild","insertAdjacentHTML"].forEach(function(l){o[l]&&(a[l]=o[l],o[l]=r(a[l]))}),Object.defineProperty(o,"innerHTML",Ci(e,{set:r(e.set)})),o.resetSourceWatch_=function(){o.resetSourceWatch_=null,Object.keys(a).forEach(function(l){o[l]=a[l]}),Object.defineProperty(o,"innerHTML",e)},s.one("sourceset",o.resetSourceWatch_)}},_M=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?py(ie.Element.prototype.getAttribute.call(this,"src")):""},set:function(s){return ie.Element.prototype.setAttribute.call(this,"src",s),s}}),xM=function(s){return Vy([s.el(),ie.HTMLMediaElement.prototype,_M],"src")},bM=function(s){if(s.featuresSourceset){var o=s.el();if(!o.resetSourceset_){var a=xM(s),e=o.setAttribute,r=o.load;Object.defineProperty(o,"src",Ci(a,{set:function(f){var m=a.set.call(o,f);return s.triggerSourceset(o.src),m}})),o.setAttribute=function(l,f){var m=e.call(o,l,f);return/src/i.test(l)&&s.triggerSourceset(o.src),m},o.load=function(){var l=r.call(o);return dp(s)||(s.triggerSourceset(""),Qv(s)),l},o.currentSrc?s.triggerSourceset(o.currentSrc):dp(s)||Qv(s),o.resetSourceset_=function(){o.resetSourceset_=null,o.load=r,o.setAttribute=e,Object.defineProperty(o,"src",a),o.resetSourceWatch_&&o.resetSourceWatch_()}}}},am=function(s,o,a,e){e===void 0&&(e=!0);var r=function(m){return Object.defineProperty(s,o,{value:m,enumerable:!0,writable:!0})},l={configurable:!0,enumerable:!0,get:function(){var m=a();return r(m),m}};return e&&(l.set=r),Object.defineProperty(s,o,l)},ht=function(d){it(s,d);function s(a,e){var r;r=d.call(this,a,e)||this;var l=a.source,f=!1;if(r.featuresVideoFrameCallback=r.featuresVideoFrameCallback&&r.el_.tagName==="VIDEO",l&&(r.el_.currentSrc!==l.src||a.tag&&a.tag.initNetworkState_===3)?r.setSource(l):r.handleLateInit_(r.el_),a.enableSourceset&&r.setupSourcesetHandling_(),r.isScrubbing_=!1,r.el_.hasChildNodes()){for(var m=r.el_.childNodes,v=m.length,A=[];v--;){var L=m[v],P=L.nodeName.toLowerCase();P==="track"&&(r.featuresNativeTextTracks?(r.remoteTextTrackEls().addTrackElement_(L),r.remoteTextTracks().addTrack(L.track),r.textTracks().addTrack(L.track),!f&&!r.el_.hasAttribute("crossorigin")&&Id(L.src)&&(f=!0)):A.push(L))}for(var U=0;U<A.length;U++)r.el_.removeChild(A[U])}return r.proxyNativeTracks_(),r.featuresNativeTextTracks&&f&&Xt.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),r.restoreMetadataTracksInIOSNativePlayer_(),(Vo||Op||V0)&&a.nativeControlsForTouch===!0&&r.setControls(!0),r.proxyWebkitFullscreen_(),r.triggerReady(),r}var o=s.prototype;return o.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),s.disposeMediaElement(this.el_),this.options_=null,d.prototype.dispose.call(this)},o.setupSourcesetHandling_=function(){bM(this)},o.restoreMetadataTracksInIOSNativePlayer_=function(){var e=this.textTracks(),r,l=function(){r=[];for(var v=0;v<e.length;v++){var A=e[v];A.kind==="metadata"&&r.push({track:A,storedMode:A.mode})}};l(),e.addEventListener("change",l),this.on("dispose",function(){return e.removeEventListener("change",l)});var f=function m(){for(var v=0;v<r.length;v++){var A=r[v];A.track.mode==="disabled"&&A.track.mode!==A.storedMode&&(A.track.mode=A.storedMode)}e.removeEventListener("change",m)};this.on("webkitbeginfullscreen",function(){e.removeEventListener("change",l),e.removeEventListener("change",f),e.addEventListener("change",f)}),this.on("webkitendfullscreen",function(){e.removeEventListener("change",l),e.addEventListener("change",l),e.removeEventListener("change",f)})},o.overrideNative_=function(e,r){var l=this;if(r===this["featuresNative"+e+"Tracks"]){var f=e.toLowerCase();this[f+"TracksListeners_"]&&Object.keys(this[f+"TracksListeners_"]).forEach(function(m){var v=l.el()[f+"Tracks"];v.removeEventListener(m,l[f+"TracksListeners_"][m])}),this["featuresNative"+e+"Tracks"]=!r,this[f+"TracksListeners_"]=null,this.proxyNativeTracksForType_(f)}},o.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},o.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},o.proxyNativeTracksForType_=function(e){var r=this,l=or[e],f=this.el()[l.getterName],m=this[l.getterName]();if(!(!this["featuresNative"+l.capitalName+"Tracks"]||!f||!f.addEventListener)){var v={change:function(P){var U={type:"change",target:m,currentTarget:m,srcElement:m};m.trigger(U),e==="text"&&r[jo.remoteText.getterName]().trigger(U)},addtrack:function(P){m.addTrack(P.track)},removetrack:function(P){m.removeTrack(P.track)}},A=function(){for(var P=[],U=0;U<m.length;U++){for(var W=!1,Y=0;Y<f.length;Y++)if(f[Y]===m[U]){W=!0;break}W||P.push(m[U])}for(;P.length;)m.removeTrack(P.shift())};this[l.getterName+"Listeners_"]=v,Object.keys(v).forEach(function(L){var P=v[L];f.addEventListener(L,P),r.on("dispose",function(U){return f.removeEventListener(L,P)})}),this.on("loadstart",A),this.on("dispose",function(L){return r.off("loadstart",A)})}},o.proxyNativeTracks_=function(){var e=this;or.names.forEach(function(r){e.proxyNativeTracksForType_(r)})},o.createEl=function(){var e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){var r=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(r,e),s.disposeMediaElement(e),e=r}else{e=et.createElement("video");var l=this.options_.tag&&ga(this.options_.tag),f=Ci({},l);(!Vo||this.options_.nativeControlsForTouch!==!0)&&delete f.controls,Y0(e,Gi(f,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&Go(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var m=["loop","muted","playsinline","autoplay"],v=0;v<m.length;v++){var A=m[v],L=this.options_[A];typeof L<"u"&&(L?Go(e,A,A):Ed(e,A),e[A]=L)}return e},o.handleLateInit_=function(e){if(!(e.networkState===0||e.networkState===3)){if(e.readyState===0){var r=!1,l=function(){r=!0};this.on("loadstart",l);var f=function(){r||this.trigger("loadstart")};this.on("loadedmetadata",f),this.ready(function(){this.off("loadstart",l),this.off("loadedmetadata",f),r||this.trigger("loadstart")});return}var m=["loadstart"];m.push("loadedmetadata"),e.readyState>=2&&m.push("loadeddata"),e.readyState>=3&&m.push("canplay"),e.readyState>=4&&m.push("canplaythrough"),this.ready(function(){m.forEach(function(v){this.trigger(v)},this)})}},o.setScrubbing=function(e){this.isScrubbing_=e},o.scrubbing=function(){return this.isScrubbing_},o.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&wd?this.el_.fastSeek(e):this.el_.currentTime=e}catch(r){Xt(r,"Video is not ready. (Video.js)")}},o.duration=function(){var e=this;if(this.el_.duration===1/0&&Sa&&wa&&this.el_.currentTime===0){var r=function l(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",l))};return this.on("timeupdate",r),NaN}return this.el_.duration||NaN},o.width=function(){return this.el_.offsetWidth},o.height=function(){return this.el_.offsetHeight},o.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var r=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},l=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",r),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",l),this.on("dispose",function(){e.off("webkitbeginfullscreen",l),e.off("webkitendfullscreen",r)})}},o.supportsFullScreen=function(){if(typeof this.el_.webkitEnterFullScreen=="function"){var e=ie.navigator&&ie.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},o.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)qr(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(r){this.trigger("fullscreenerror",r)}},0);else try{e.webkitEnterFullScreen()}catch(r){this.trigger("fullscreenerror",r)}},o.exitFullScreen=function(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()},o.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},o.requestVideoFrameCallback=function(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):d.prototype.requestVideoFrameCallback.call(this,e)},o.cancelVideoFrameCallback=function(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):d.prototype.cancelVideoFrameCallback.call(this,e)},o.src=function(e){if(e===void 0)return this.el_.src;this.setSrc(e)},o.reset=function(){s.resetMediaElement(this.el_)},o.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},o.setControls=function(e){this.el_.controls=!!e},o.addTextTrack=function(e,r,l){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,r,l):d.prototype.addTextTrack.call(this,e,r,l)},o.createRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return d.prototype.createRemoteTextTrack.call(this,e);var r=et.createElement("track");return e.kind&&(r.kind=e.kind),e.label&&(r.label=e.label),(e.language||e.srclang)&&(r.srclang=e.language||e.srclang),e.default&&(r.default=e.default),e.id&&(r.id=e.id),e.src&&(r.src=e.src),r},o.addRemoteTextTrack=function(e,r){var l=d.prototype.addRemoteTextTrack.call(this,e,r);return this.featuresNativeTextTracks&&this.el().appendChild(l),l},o.removeRemoteTextTrack=function(e){if(d.prototype.removeRemoteTextTrack.call(this,e),this.featuresNativeTextTracks)for(var r=this.$$("track"),l=r.length;l--;)(e===r[l]||e===r[l].track)&&this.el().removeChild(r[l])},o.getVideoPlaybackQuality=function(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();var e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),ie.performance&&typeof ie.performance.now=="function"?e.creationTime=ie.performance.now():ie.performance&&ie.performance.timing&&typeof ie.performance.timing.navigationStart=="number"&&(e.creationTime=ie.Date.now()-ie.performance.timing.navigationStart),e},s}(bi);am(ht,"TEST_VID",function(){if(Qo()){var d=et.createElement("video"),s=et.createElement("track");return s.kind="captions",s.srclang="en",s.label="English",d.appendChild(s),d}});ht.isSupported=function(){try{ht.TEST_VID.volume=.5}catch{return!1}return!!(ht.TEST_VID&&ht.TEST_VID.canPlayType)};ht.canPlayType=function(d){return ht.TEST_VID.canPlayType(d)};ht.canPlaySource=function(d,s){return ht.canPlayType(d.type)};ht.canControlVolume=function(){try{var d=ht.TEST_VID.volume;ht.TEST_VID.volume=d/2+.1;var s=d!==ht.TEST_VID.volume;return s&&En?(ie.setTimeout(function(){ht&&ht.prototype&&(ht.prototype.featuresVolumeControl=d!==ht.TEST_VID.volume)}),!1):s}catch{return!1}};ht.canMuteVolume=function(){try{var d=ht.TEST_VID.muted;return ht.TEST_VID.muted=!d,ht.TEST_VID.muted?Go(ht.TEST_VID,"muted","muted"):Ed(ht.TEST_VID,"muted","muted"),d!==ht.TEST_VID.muted}catch{return!1}};ht.canControlPlaybackRate=function(){if(Sa&&wa&&z0<58)return!1;try{var d=ht.TEST_VID.playbackRate;return ht.TEST_VID.playbackRate=d/2+.1,d!==ht.TEST_VID.playbackRate}catch{return!1}};ht.canOverrideAttributes=function(){try{var d=function(){};Object.defineProperty(et.createElement("video"),"src",{get:d,set:d}),Object.defineProperty(et.createElement("audio"),"src",{get:d,set:d}),Object.defineProperty(et.createElement("video"),"innerHTML",{get:d,set:d}),Object.defineProperty(et.createElement("audio"),"innerHTML",{get:d,set:d})}catch{return!1}return!0};ht.supportsNativeTextTracks=function(){return wd||En&&wa};ht.supportsNativeVideoTracks=function(){return!!(ht.TEST_VID&&ht.TEST_VID.videoTracks)};ht.supportsNativeAudioTracks=function(){return!!(ht.TEST_VID&&ht.TEST_VID.audioTracks)};ht.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(d){var s=d[0],o=d[1];am(ht.prototype,s,function(){return ht[o]()},!0)});ht.prototype.featuresVolumeControl=ht.canControlVolume();ht.prototype.movingMediaElementInDOM=!En;ht.prototype.featuresFullscreenResize=!0;ht.prototype.featuresProgressEvents=!0;ht.prototype.featuresTimeupdateEvents=!0;ht.prototype.featuresVideoFrameCallback=!!(ht.TEST_VID&&ht.TEST_VID.requestVideoFrameCallback);var ud;ht.patchCanPlayType=function(){Ip>=4&&!G0&&!wa&&(ud=ht.TEST_VID&&ht.TEST_VID.constructor.prototype.canPlayType,ht.TEST_VID.constructor.prototype.canPlayType=function(d){var s=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;return d&&s.test(d)?"maybe":ud.call(this,d)})};ht.unpatchCanPlayType=function(){var d=ht.TEST_VID.constructor.prototype.canPlayType;return ud&&(ht.TEST_VID.constructor.prototype.canPlayType=ud),d};ht.patchCanPlayType();ht.disposeMediaElement=function(d){if(d){for(d.parentNode&&d.parentNode.removeChild(d);d.hasChildNodes();)d.removeChild(d.firstChild);d.removeAttribute("src"),typeof d.load=="function"&&function(){try{d.load()}catch{}}()}};ht.resetMediaElement=function(d){if(d){for(var s=d.querySelectorAll("source"),o=s.length;o--;)d.removeChild(s[o]);d.removeAttribute("src"),typeof d.load=="function"&&function(){try{d.load()}catch{}}()}};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(d){ht.prototype[d]=function(){return this.el_[d]||this.el_.hasAttribute(d)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(d){ht.prototype["set"+ji(d)]=function(s){this.el_[d]=s,s?this.el_.setAttribute(d,d):this.el_.removeAttribute(d)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(d){ht.prototype[d]=function(){return this.el_[d]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(d){ht.prototype["set"+ji(d)]=function(s){this.el_[d]=s}});["pause","load","play"].forEach(function(d){ht.prototype[d]=function(){return this.el_[d]()}});bi.withSourceHandlers(ht);ht.nativeSourceHandler={};ht.nativeSourceHandler.canPlayType=function(d){try{return ht.TEST_VID.canPlayType(d)}catch{return""}};ht.nativeSourceHandler.canHandleSource=function(d,s){if(d.type)return ht.nativeSourceHandler.canPlayType(d.type);if(d.src){var o=Vp(d.src);return ht.nativeSourceHandler.canPlayType("video/"+o)}return""};ht.nativeSourceHandler.handleSource=function(d,s,o){s.setSrc(d.src)};ht.nativeSourceHandler.dispose=function(){};ht.registerSourceHandler(ht.nativeSourceHandler);bi.registerTech("Html5",ht);var Gy=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Qf={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},hp=["tiny","xsmall","small","medium","large","xlarge","huge"],ed={};hp.forEach(function(d){var s=d.charAt(0)==="x"?"x-"+d.substring(1):d;ed[d]="vjs-layout-"+s});var TM={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},Zi=function(d){it(s,d);function s(a,e,r){var l;if(a.id=a.id||e.id||"vjs_video_"+Ea(),e=Gi(s.getTagSettings(a),e),e.initChildren=!1,e.createEl=!1,e.evented=!1,e.reportTouchActivity=!1,!e.language)if(typeof a.closest=="function"){var f=a.closest("[lang]");f&&f.getAttribute&&(e.language=f.getAttribute("lang"))}else for(var m=a;m&&m.nodeType===1;){if(ga(m).hasOwnProperty("lang")){e.language=m.getAttribute("lang");break}m=m.parentNode}if(l=d.call(this,null,e,r)||this,l.boundDocumentFullscreenChange_=function(P){return l.documentFullscreenChange_(P)},l.boundFullWindowOnEscKey_=function(P){return l.fullWindowOnEscKey(P)},l.boundUpdateStyleEl_=function(P){return l.updateStyleEl_(P)},l.boundApplyInitTime_=function(P){return l.applyInitTime_(P)},l.boundUpdateCurrentBreakpoint_=function(P){return l.updateCurrentBreakpoint_(P)},l.boundHandleTechClick_=function(P){return l.handleTechClick_(P)},l.boundHandleTechDoubleClick_=function(P){return l.handleTechDoubleClick_(P)},l.boundHandleTechTouchStart_=function(P){return l.handleTechTouchStart_(P)},l.boundHandleTechTouchMove_=function(P){return l.handleTechTouchMove_(P)},l.boundHandleTechTouchEnd_=function(P){return l.handleTechTouchEnd_(P)},l.boundHandleTechTap_=function(P){return l.handleTechTap_(P)},l.isFullscreen_=!1,l.log=N0(l.id_),l.fsApi_=rd,l.isPosterFromTech_=!1,l.queuedCallbacks_=[],l.isReady_=!1,l.hasStarted_=!1,l.userActive_=!1,l.debugEnabled_=!1,l.audioOnlyMode_=!1,l.audioPosterMode_=!1,l.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!l.options_||!l.options_.techOrder||!l.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(l.tag=a,l.tagAttributes=a&&ga(a),l.language(l.options_.language),e.languages){var v={};Object.getOwnPropertyNames(e.languages).forEach(function(P){v[P.toLowerCase()]=e.languages[P]}),l.languages_=v}else l.languages_=s.prototype.options_.languages;l.resetCache_(),l.poster_=e.poster||"",l.controls_=!!e.controls,a.controls=!1,a.removeAttribute("controls"),l.changingSrc_=!1,l.playCallbacks_=[],l.playTerminatedQueue_=[],a.hasAttribute("autoplay")?l.autoplay(!0):l.autoplay(l.options_.autoplay),e.plugins&&Object.keys(e.plugins).forEach(function(P){if(typeof l[P]!="function")throw new Error('plugin "'+P+'" does not exist')}),l.scrubbing_=!1,l.el_=l.createEl(),Np(Ft(l),{eventBusKey:"el_"}),l.fsApi_.requestFullscreen&&(Kn(et,l.fsApi_.fullscreenchange,l.boundDocumentFullscreenChange_),l.on(l.fsApi_.fullscreenchange,l.boundDocumentFullscreenChange_)),l.fluid_&&l.on(["playerreset","resize"],l.boundUpdateStyleEl_);var A=Ci(l.options_);e.plugins&&Object.keys(e.plugins).forEach(function(P){l[P](e.plugins[P])}),e.debug&&l.debug(!0),l.options_.playerOptions=A,l.middleware_=[],l.playbackRates(e.playbackRates),l.initChildren(),l.isAudio(a.nodeName.toLowerCase()==="audio"),l.controls()?l.addClass("vjs-controls-enabled"):l.addClass("vjs-controls-disabled"),l.el_.setAttribute("role","region"),l.isAudio()?l.el_.setAttribute("aria-label",l.localize("Audio Player")):l.el_.setAttribute("aria-label",l.localize("Video Player")),l.isAudio()&&l.addClass("vjs-audio"),l.flexNotSupported_()&&l.addClass("vjs-no-flex"),Vo&&l.addClass("vjs-touch-enabled"),En||l.addClass("vjs-workinghover"),s.players[l.id_]=Ft(l);var L=F0.split(".")[0];return l.addClass("vjs-v"+L),l.userActive(!0),l.reportUserActivity(),l.one("play",function(P){return l.listenForUserActivity_(P)}),l.on("stageclick",function(P){return l.handleStageClick_(P)}),l.on("keydown",function(P){return l.handleKeyDown(P)}),l.on("languagechange",function(P){return l.handleLanguagechange(P)}),l.breakpoints(l.options_.breakpoints),l.responsive(l.options_.responsive),l.on("ready",function(){l.audioPosterMode(l.options_.audioPosterMode),l.audioOnlyMode(l.options_.audioOnlyMode)}),l}var o=s.prototype;return o.dispose=function(){var e=this;this.trigger("dispose"),this.off("dispose"),vn(et,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),vn(et,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),s.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),GE(this),Tn.names.forEach(function(r){var l=Tn[r],f=e[l.getterName]();f&&f.off&&f.off()}),d.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},o.createEl=function(){var e=this.tag,r,l=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player"),f=this.tag.tagName.toLowerCase()==="video-js";l?r=this.el_=e.parentNode:f||(r=this.el_=d.prototype.createEl.call(this,"div"));var m=ga(e);if(f){for(r=this.el_=e,e=this.tag=et.createElement("video");r.children.length;)e.appendChild(r.firstChild);Ps(r,"video-js")||_a(r,"video-js"),r.appendChild(e),l=this.playerElIngest_=r,Object.keys(r).forEach(function(W){try{e[W]=r[W]}catch{}})}if(e.setAttribute("tabindex","-1"),m.tabindex="-1",(Su||wa&&W0)&&(e.setAttribute("role","application"),m.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in m&&delete m.width,"height"in m&&delete m.height,Object.getOwnPropertyNames(m).forEach(function(W){f&&W==="class"||r.setAttribute(W,m[W]),f&&e.setAttribute(W,m[W])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=r.player=this,this.addClass("vjs-paused"),ie.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=ay("vjs-styles-dimensions");var v=es(".vjs-styles-defaults"),A=es("head");A.insertBefore(this.styleEl_,v?v.nextSibling:A.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var L=e.getElementsByTagName("a"),P=0;P<L.length;P++){var U=L.item(P);_a(U,"vjs-hidden"),U.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!l&&e.parentNode.insertBefore(r,e),rp(e,r),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=r,r},o.crossOrigin=function(e){if(!e)return this.techGet_("crossOrigin");if(e!=="anonymous"&&e!=="use-credentials"){Xt.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+e+'"');return}this.techCall_("setCrossOrigin",e)},o.width=function(e){return this.dimension("width",e)},o.height=function(e){return this.dimension("height",e)},o.dimension=function(e,r){var l=e+"_";if(r===void 0)return this[l]||0;if(r===""||r==="auto"){this[l]=void 0,this.updateStyleEl_();return}var f=parseFloat(r);if(isNaN(f)){Xt.error('Improper value "'+r+'" supplied for for '+e);return}this[l]=f,this.updateStyleEl_()},o.fluid=function(e){var r=this;if(e===void 0)return!!this.fluid_;this.fluid_=!!e,xa(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),fE(this,function(){r.on(["playerreset","resize"],r.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},o.fill=function(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},o.aspectRatio=function(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},o.updateStyleEl_=function(){if(ie.VIDEOJS_NO_DYNAMIC_STYLE===!0){var e=typeof this.width_=="number"?this.width_:this.options_.width,r=typeof this.height_=="number"?this.height_:this.options_.height,l=this.tech_&&this.tech_.el();l&&(e>=0&&(l.width=e),r>=0&&(l.height=r));return}var f,m,v,A;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?v=this.aspectRatio_:this.videoWidth()>0?v=this.videoWidth()+":"+this.videoHeight():v="16:9";var L=v.split(":"),P=L[1]/L[0];this.width_!==void 0?f=this.width_:this.height_!==void 0?f=this.height_/P:f=this.videoWidth()||300,this.height_!==void 0?m=this.height_:m=f*P,/^[^a-zA-Z]/.test(this.id())?A="dimensions-"+this.id():A=this.id()+"-dimensions",this.addClass(A),sy(this.styleEl_,`
      .`+A+` {
        width: `+f+`px;
        height: `+m+`px;
      }

      .`+A+`.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: `+P*100+`%;
      }
    `)},o.loadTech_=function(e,r){var l=this;this.tech_&&this.unloadTech_();var f=ji(e),m=e.charAt(0).toLowerCase()+e.slice(1);f!=="Html5"&&this.tag&&(bi.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=f,this.isReady_=!1;var v=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(v=!1);var A={source:r,autoplay:v,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+m+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};Tn.names.forEach(function(P){var U=Tn[P];A[U.getterName]=l[U.privateName]}),Gi(A,this.options_[f]),Gi(A,this.options_[m]),Gi(A,this.options_[e.toLowerCase()]),this.tag&&(A.tag=this.tag),r&&r.src===this.cache_.src&&this.cache_.currentTime>0&&(A.startTime=this.cache_.currentTime);var L=bi.getTech(e);if(!L)throw new Error("No Tech named '"+f+"' exists! '"+f+"' should be registered using videojs.registerTech()'");this.tech_=new L(A),this.tech_.ready(Pi(this,this.handleTechReady_),!0),Pv.jsonToTextTracks(this.textTracksJson_||[],this.tech_),Gy.forEach(function(P){l.on(l.tech_,P,function(U){return l["handleTech"+ji(P)+"_"](U)})}),Object.keys(Qf).forEach(function(P){l.on(l.tech_,P,function(U){if(l.tech_.playbackRate()===0&&l.tech_.seeking()){l.queuedCallbacks_.push({callback:l["handleTech"+Qf[P]+"_"].bind(l),event:U});return}l["handleTech"+Qf[P]+"_"](U)})}),this.on(this.tech_,"loadstart",function(P){return l.handleTechLoadStart_(P)}),this.on(this.tech_,"sourceset",function(P){return l.handleTechSourceset_(P)}),this.on(this.tech_,"waiting",function(P){return l.handleTechWaiting_(P)}),this.on(this.tech_,"ended",function(P){return l.handleTechEnded_(P)}),this.on(this.tech_,"seeking",function(P){return l.handleTechSeeking_(P)}),this.on(this.tech_,"play",function(P){return l.handleTechPlay_(P)}),this.on(this.tech_,"firstplay",function(P){return l.handleTechFirstPlay_(P)}),this.on(this.tech_,"pause",function(P){return l.handleTechPause_(P)}),this.on(this.tech_,"durationchange",function(P){return l.handleTechDurationChange_(P)}),this.on(this.tech_,"fullscreenchange",function(P,U){return l.handleTechFullscreenChange_(P,U)}),this.on(this.tech_,"fullscreenerror",function(P,U){return l.handleTechFullscreenError_(P,U)}),this.on(this.tech_,"enterpictureinpicture",function(P){return l.handleTechEnterPictureInPicture_(P)}),this.on(this.tech_,"leavepictureinpicture",function(P){return l.handleTechLeavePictureInPicture_(P)}),this.on(this.tech_,"error",function(P){return l.handleTechError_(P)}),this.on(this.tech_,"posterchange",function(P){return l.handleTechPosterChange_(P)}),this.on(this.tech_,"textdata",function(P){return l.handleTechTextData_(P)}),this.on(this.tech_,"ratechange",function(P){return l.handleTechRateChange_(P)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(f!=="Html5"||!this.tag)&&rp(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},o.unloadTech_=function(){var e=this;Tn.names.forEach(function(r){var l=Tn[r];e[l.privateName]=e[l.getterName]()}),this.textTracksJson_=Pv.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},o.tech=function(e){return e===void 0&&Xt.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_},o.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},o.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},o.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},o.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())},o.manualAutoplay_=function(e){var r=this;if(!(!this.tech_||typeof e!="string")){var l=function(){var v=r.muted();r.muted(!0);var A=function(){r.muted(v)};r.playTerminatedQueue_.push(A);var L=r.play();if(fu(L))return L.catch(function(P){throw A(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(P||""))})},f;if(e==="any"&&!this.muted()?(f=this.play(),fu(f)&&(f=f.catch(l))):e==="muted"&&!this.muted()?f=l():f=this.play(),!!fu(f))return f.then(function(){r.trigger({type:"autoplay-success",autoplay:e})}).catch(function(){r.trigger({type:"autoplay-failure",autoplay:e})})}},o.updateSourceCaches_=function(e){e===void 0&&(e="");var r=e,l="";typeof r!="string"&&(r=e.src,l=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],r&&!l&&(l=jE(this,r)),this.cache_.source=Ci({},e,{src:r,type:l});for(var f=this.cache_.sources.filter(function(U){return U.src&&U.src===r}),m=[],v=this.$$("source"),A=[],L=0;L<v.length;L++){var P=ga(v[L]);m.push(P),P.src&&P.src===r&&A.push(P.src)}A.length&&!f.length?this.cache_.sources=m:f.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=r},o.handleTechSourceset_=function(e){var r=this;if(!this.changingSrc_){var l=function(A){return r.updateSourceCaches_(A)},f=this.currentSource().src,m=e.src;f&&!/^blob:/.test(f)&&/^blob:/.test(m)&&(!this.lastSource_||this.lastSource_.tech!==m&&this.lastSource_.player!==f)&&(l=function(){}),l(m),e.src||this.tech_.any(["sourceset","loadstart"],function(v){if(v.type!=="sourceset"){var A=r.techGet("currentSrc");r.lastSource_.tech=A,r.updateSourceCaches_(A)}})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},o.hasStarted=function(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},o.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},o.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},o.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var r=this.currentTime(),l=function f(){r!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",f))};this.on("timeupdate",l)},o.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},o.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},o.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},o.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},o.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},o.handleTechFirstPlay_=function(){this.options_.starttime&&(Xt.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},o.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},o.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},o.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},o.handleTechClick_=function(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?qr(this.play()):this.pause())},o.handleTechDoubleClick_=function(e){if(this.controls_){var r=Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(l){return l.contains(e.target)});r||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}},o.handleTechTap_=function(){this.userActive(!this.userActive())},o.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},o.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},o.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},o.handleStageClick_=function(){this.reportUserActivity()},o.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},o.documentFullscreenChange_=function(e){var r=e.target.player;if(!(r&&r!==this)){var l=this.el(),f=et[this.fsApi_.fullscreenElement]===l;!f&&l.matches?f=l.matches(":"+this.fsApi_.fullscreen):!f&&l.msMatchesSelector&&(f=l.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(f)}},o.handleTechFullscreenChange_=function(e,r){var l=this;r&&(r.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){l.removeClass("vjs-ios-native-fs")})),this.isFullscreen(r.isFullscreen))},o.handleTechFullscreenError_=function(e,r){this.trigger("fullscreenerror",r)},o.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},o.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},o.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},o.handleTechError_=function(){var e=this.tech_.error();this.error(e)},o.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},o.getCache=function(){return this.cache_},o.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},o.techCall_=function(e,r){this.ready(function(){if(e in HE)return NE(this.middleware_,this.tech_,e,r);if(e in Fv)return Ov(this.middleware_,this.tech_,e,r);try{this.tech_&&this.tech_[e](r)}catch(l){throw Xt(l),l}},!0)},o.techGet_=function(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in UE)return BE(this.middleware_,this.tech_,e);if(e in Fv)return Ov(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(r){throw this.tech_[e]===void 0?(Xt("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",r),r):r.name==="TypeError"?(Xt("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",r),this.tech_.isReady_=!1,r):(Xt(r),r)}}},o.play=function(){var e=this,r=this.options_.Promise||ie.Promise;return r?new r(function(l){e.play_(l)}):this.play_()},o.play_=function(e){var r=this;e===void 0&&(e=qr),this.playCallbacks_.push(e);var l=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),f=!!(wd||En);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!l){this.waitToPlay_=function(A){r.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!l&&f&&this.load();return}var m=this.techGet_("play"),v=f&&this.hasClass("vjs-ended");v&&this.resetProgressBar_(),m===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(m)},o.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(r){r()})},o.runPlayCallbacks_=function(e){var r=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],r.forEach(function(l){l(e)})},o.pause=function(){this.techCall_("pause")},o.paused=function(){return this.techGet_("paused")!==!1},o.played=function(){return this.techGet_("played")||Ls(0,0)},o.scrubbing=function(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},o.currentTime=function(e){if(typeof e<"u"){if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0;return}return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime},o.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},o.duration=function(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))},o.remainingTime=function(){return this.duration()-this.currentTime()},o.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},o.buffered=function(){var e=this.techGet_("buffered");return(!e||!e.length)&&(e=Ls(0,0)),e},o.bufferedPercent=function(){return hy(this.buffered(),this.duration())},o.bufferedEnd=function(){var e=this.buffered(),r=this.duration(),l=e.end(e.length-1);return l>r&&(l=r),l},o.volume=function(e){var r;if(e!==void 0){r=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=r,this.techCall_("setVolume",r),r>0&&this.lastVolume_(r);return}return r=parseFloat(this.techGet_("volume")),isNaN(r)?1:r},o.muted=function(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1},o.defaultMuted=function(e){return e!==void 0?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},o.lastVolume_=function(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume},o.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},o.isFullscreen=function(e){if(e!==void 0){var r=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==r&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_},o.requestFullscreen=function(e){var r=this.options_.Promise||ie.Promise;if(r){var l=this;return new r(function(f,m){function v(){l.off("fullscreenerror",L),l.off("fullscreenchange",A)}function A(){v(),f()}function L(U,W){v(),m(W)}l.one("fullscreenchange",A),l.one("fullscreenerror",L);var P=l.requestFullscreenHelper_(e);P&&(P.then(v,v),P.then(f,m))})}return this.requestFullscreenHelper_()},o.requestFullscreenHelper_=function(e){var r=this,l;if(this.fsApi_.prefixed||(l=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(l=e)),this.fsApi_.requestFullscreen){var f=this.el_[this.fsApi_.requestFullscreen](l);return f&&f.then(function(){return r.isFullscreen(!0)},function(){return r.isFullscreen(!1)}),f}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},o.exitFullscreen=function(){var e=this.options_.Promise||ie.Promise;if(e){var r=this;return new e(function(l,f){function m(){r.off("fullscreenerror",A),r.off("fullscreenchange",v)}function v(){m(),l()}function A(P,U){m(),f(U)}r.one("fullscreenchange",v),r.one("fullscreenerror",A);var L=r.exitFullscreenHelper_();L&&(L.then(m,m),L.then(l,f))})}return this.exitFullscreenHelper_()},o.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var r=et[this.fsApi_.exitFullscreen]();return r&&qr(r.then(function(){return e.isFullscreen(!1)})),r}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},o.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=et.documentElement.style.overflow,Kn(et,"keydown",this.boundFullWindowOnEscKey_),et.documentElement.style.overflow="hidden",_a(et.body,"vjs-full-window"),this.trigger("enterFullWindow")},o.fullWindowOnEscKey=function(e){Nt.isEventKey(e,"Esc")&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},o.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,vn(et,"keydown",this.boundFullWindowOnEscKey_),et.documentElement.style.overflow=this.docOrigOverflow,wu(et.body,"vjs-full-window"),this.trigger("exitFullWindow")},o.disablePictureInPicture=function(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")},o.isInPictureInPicture=function(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_},o.requestPictureInPicture=function(){if("pictureInPictureEnabled"in et&&this.disablePictureInPicture()===!1)return this.techGet_("requestPictureInPicture")},o.exitPictureInPicture=function(){if("pictureInPictureEnabled"in et)return et.exitPictureInPicture()},o.handleKeyDown=function(e){var r=this.options_.userActions;if(!(!r||!r.hotkeys)){var l=function(m){var v=m.tagName.toLowerCase();if(m.isContentEditable)return!0;var A=["button","checkbox","hidden","radio","reset","submit"];if(v==="input")return A.indexOf(m.type)===-1;var L=["textarea"];return L.indexOf(v)!==-1};l(this.el_.ownerDocument.activeElement)||(typeof r.hotkeys=="function"?r.hotkeys.call(this,e):this.handleHotkeys(e))}},o.handleHotkeys=function(e){var r=this.options_.userActions?this.options_.userActions.hotkeys:{},l=r.fullscreenKey,f=l===void 0?function(Y){return Nt.isEventKey(Y,"f")}:l,m=r.muteKey,v=m===void 0?function(Y){return Nt.isEventKey(Y,"m")}:m,A=r.playPauseKey,L=A===void 0?function(Y){return Nt.isEventKey(Y,"k")||Nt.isEventKey(Y,"Space")}:A;if(f.call(this,e)){e.preventDefault(),e.stopPropagation();var P=qe.getComponent("FullscreenToggle");et[this.fsApi_.fullscreenEnabled]!==!1&&P.prototype.handleClick.call(this,e)}else if(v.call(this,e)){e.preventDefault(),e.stopPropagation();var U=qe.getComponent("MuteToggle");U.prototype.handleClick.call(this,e)}else if(L.call(this,e)){e.preventDefault(),e.stopPropagation();var W=qe.getComponent("PlayToggle");W.prototype.handleClick.call(this,e)}},o.canPlayType=function(e){for(var r,l=0,f=this.options_.techOrder;l<f.length;l++){var m=f[l],v=bi.getTech(m);if(v||(v=qe.getComponent(m)),!v){Xt.error('The "'+m+'" tech is undefined. Skipped browser support check for that tech.');continue}if(v.isSupported()&&(r=v.canPlayType(e),r))return r}return""},o.selectSource=function(e){var r=this,l=this.options_.techOrder.map(function(L){return[L,bi.getTech(L)]}).filter(function(L){var P=L[0],U=L[1];return U?U.isSupported():(Xt.error('The "'+P+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),f=function(P,U,W){var Y;return P.some(function(q){return U.some(function(_e){if(Y=W(q,_e),Y)return!0})}),Y},m,v=function(P){return function(U,W){return P(W,U)}},A=function(P,U){var W=P[0],Y=P[1];if(Y.canPlaySource(U,r.options_[W.toLowerCase()]))return{source:U,tech:W}};return this.options_.sourceOrder?m=f(e,l,v(A)):m=f(l,e,A),m||!1},o.handleSrc_=function(e,r){var l=this;if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var f=qE(e);if(!f.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,r||(this.cache_.sources=f),this.updateSourceCaches_(f[0]),FE(this,f[0],function(A,L){l.middleware_=L,r||(l.cache_.sources=f),l.updateSourceCaches_(A);var P=l.src_(A);if(P){if(f.length>1)return l.handleSrc_(f.slice(1));l.changingSrc_=!1,l.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),l.triggerReady();return}kE(L,l.tech_)}),this.options_.retryOnError&&f.length>1){var m=function(){l.error(null),l.handleSrc_(f.slice(1),!0)},v=function(){l.off("error",m)};this.one("error",m),this.one("playing",v),this.resetRetryOnError_=function(){l.off("error",m),l.off("playing",v)}}},o.src=function(e){return this.handleSrc_(e,!1)},o.src_=function(e){var r=this,l=this.selectSource([e]);return l?gE(l.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(l.tech,l.source),this.tech_.ready(function(){r.changingSrc_=!1}),!1):!0},o.load=function(){this.techCall_("load")},o.reset=function(){var e=this,r=this.options_.Promise||ie.Promise;if(this.paused()||!r)this.doReset_();else{var l=this.play();qr(l.then(function(){return e.doReset_()}))}},o.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),xa(this)&&this.trigger("playerreset")},o.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},o.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar||{},r=e.durationDisplay,l=e.remainingTimeDisplay;r&&r.updateContent(),l&&l.updateContent()},o.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},o.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},o.currentSources=function(){var e=this.currentSource(),r=[];return Object.keys(e).length!==0&&r.push(e),this.cache_.sources||r},o.currentSource=function(){return this.cache_.source||{}},o.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},o.currentType=function(){return this.currentSource()&&this.currentSource().type||""},o.preload=function(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")},o.autoplay=function(e){if(e===void 0)return this.options_.autoplay||!1;var r;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),r=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,r=typeof r>"u"?this.options_.autoplay:r,this.tech_&&this.techCall_("setAutoplay",r)},o.playsinline=function(e){return e!==void 0?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},o.loop=function(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")},o.poster=function(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},o.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},o.controls=function(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},o.usingNativeControls=function(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},o.error=function(e){var r=this;if(e===void 0)return this.error_||null;if(Ja("beforeerror").forEach(function(f){var m=f(r,e);if(!(Ta(m)&&!Array.isArray(m)||typeof m=="string"||typeof m=="number"||m===null)){r.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=m}),this.options_.suppressNotSupportedError&&e&&e.code===4){var l=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],l),this.one("loadstart",function(){this.off(["click","touchstart"],l)});return}if(e===null){this.error_=e,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new wn(e),this.addClass("vjs-error"),Xt.error("(CODE:"+this.error_.code+" "+wn.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),Ja("error").forEach(function(f){return f(r,r.error_)})},o.reportUserActivity=function(e){this.userActivity_=!0},o.userActive=function(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(r){r.stopPropagation(),r.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},o.listenForUserActivity_=function(){var e,r,l,f=Pi(this,this.reportUserActivity),m=function(W){(W.screenX!==r||W.screenY!==l)&&(r=W.screenX,l=W.screenY,f())},v=function(){f(),this.clearInterval(e),e=this.setInterval(f,250)},A=function(W){f(),this.clearInterval(e)};this.on("mousedown",v),this.on("mousemove",m),this.on("mouseup",A),this.on("mouseleave",A);var L=this.getChild("controlBar");L&&!En&&!Sa&&(L.on("mouseenter",function(U){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),L.on("mouseleave",function(U){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",f),this.on("keyup",f);var P;this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(P);var U=this.options_.inactivityTimeout;U<=0||(P=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},U))}},250)},o.playbackRate=function(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1},o.defaultPlaybackRate=function(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},o.isAudio=function(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_},o.enableAudioOnlyUI_=function(){var e=this;this.addClass("vjs-audio-only-mode");var r=this.children(),l=this.getChild("ControlBar"),f=l&&l.currentHeight();r.forEach(function(m){m!==l&&m.el_&&!m.hasClass("vjs-hidden")&&(m.hide(),e.audioOnlyCache_.hiddenChildren.push(m))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(f),this.trigger("audioonlymodechange")},o.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(e){return e.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},o.audioOnlyMode=function(e){var r=this;if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=e;var l=this.options_.Promise||ie.Promise;if(l){if(e){var f=[];return this.isInPictureInPicture()&&f.push(this.exitPictureInPicture()),this.isFullscreen()&&f.push(this.exitFullscreen()),this.audioPosterMode()&&f.push(this.audioPosterMode(!1)),l.all(f).then(function(){return r.enableAudioOnlyUI_()})}return l.resolve().then(function(){return r.disableAudioOnlyUI_()})}e?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},o.enablePosterModeUI_=function(){var e=this.tech_&&this.tech_;e.hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},o.disablePosterModeUI_=function(){var e=this.tech_&&this.tech_;e.show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},o.audioPosterMode=function(e){var r=this;if(typeof e!="boolean"||e===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=e;var l=this.options_.Promise||ie.Promise;if(l){if(e){if(this.audioOnlyMode()){var f=this.audioOnlyMode(!1);return f.then(function(){r.enablePosterModeUI_()})}return l.resolve().then(function(){r.enablePosterModeUI_()})}return l.resolve().then(function(){r.disablePosterModeUI_()})}if(e){this.audioOnlyMode()&&this.audioOnlyMode(!1),this.enablePosterModeUI_();return}this.disablePosterModeUI_()},o.addTextTrack=function(e,r,l){if(this.tech_)return this.tech_.addTextTrack(e,r,l)},o.addRemoteTextTrack=function(e,r){if(this.tech_)return this.tech_.addRemoteTextTrack(e,r)},o.removeRemoteTextTrack=function(e){e===void 0&&(e={});var r=e,l=r.track;if(l||(l=e),this.tech_)return this.tech_.removeRemoteTextTrack(l)},o.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},o.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},o.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},o.language=function(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),xa(this)&&this.trigger("languagechange"))},o.languages=function(){return Ci(s.prototype.options_.languages,this.languages_)},o.toJSON=function(){var e=Ci(this.options_),r=e.tracks;e.tracks=[];for(var l=0;l<r.length;l++){var f=r[l];f=Ci(f),f.player=void 0,e.tracks[l]=f}return e},o.createModal=function(e,r){var l=this;r=r||{},r.content=e||"";var f=new Zo(this,r);return this.addChild(f),f.on("dispose",function(){l.removeChild(f)}),f.open(),f},o.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),r=this.currentWidth(),l=0;l<hp.length;l++){var f=hp[l],m=this.breakpoints_[f];if(r<=m){if(e===f)return;e&&this.removeClass(ed[e]),this.addClass(ed[f]),this.breakpoint_=f;break}}},o.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},o.breakpoints=function(e){return e===void 0?Gi(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Gi({},TM,e),this.updateCurrentBreakpoint_(),Gi(this.breakpoints_))},o.responsive=function(e){if(e===void 0)return this.responsive_;e=!!e;var r=this.responsive_;if(e!==r)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e},o.currentBreakpoint=function(){return this.breakpoint_},o.currentBreakpointClass=function(){return ed[this.breakpoint_]||""},o.loadMedia=function(e,r){var l=this;if(!(!e||typeof e!="object")){this.reset(),this.cache_.media=Ci(e);var f=this.cache_.media,m=f.artwork,v=f.poster,A=f.src,L=f.textTracks;!m&&v&&(this.cache_.media.artwork=[{src:v,type:od(v)}]),A&&this.src(A),v&&this.poster(v),Array.isArray(L)&&L.forEach(function(P){return l.addRemoteTextTrack(P,!1)}),this.ready(r)}},o.getMedia=function(){if(!this.cache_.media){var e=this.poster(),r=this.currentSources(),l=Array.prototype.map.call(this.remoteTextTracks(),function(m){return{kind:m.kind,label:m.label,language:m.language,src:m.src}}),f={src:r,textTracks:l};return e&&(f.poster=e,f.artwork=[{src:f.poster,type:od(f.poster)}]),f}return Ci(this.cache_.media)},s.getTagSettings=function(e){var r={sources:[],tracks:[]},l=ga(e),f=l["data-setup"];if(Ps(e,"vjs-fill")&&(l.fill=!0),Ps(e,"vjs-fluid")&&(l.fluid=!0),f!==null){var m=hS(f||"{}"),v=m[0],A=m[1];v&&Xt.error(v),Gi(l,A)}if(Gi(r,l),e.hasChildNodes())for(var L=e.childNodes,P=0,U=L.length;P<U;P++){var W=L[P],Y=W.nodeName.toLowerCase();Y==="source"?r.sources.push(ga(W)):Y==="track"&&r.tracks.push(ga(W))}return r},o.flexNotSupported_=function(){var e=et.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},o.debug=function(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},o.playbackRates=function(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(function(r){return typeof r=="number"})&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))},s}(qe);Tn.names.forEach(function(d){var s=Tn[d];Zi.prototype[s.getterName]=function(){return this.tech_?this.tech_[s.getterName]():(this[s.privateName]=this[s.privateName]||new s.ListClass,this[s.privateName])}});Zi.prototype.crossorigin=Zi.prototype.crossOrigin;Zi.players={};var lu=ie.navigator;Zi.prototype.options_={techOrder:bi.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:lu&&(lu.languages&&lu.languages[0]||lu.userLanguage||lu.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1};["ended","seeking","seekable","networkState","readyState"].forEach(function(d){Zi.prototype[d]=function(){return this.techGet_(d)}});Gy.forEach(function(d){Zi.prototype["handleTech"+ji(d)+"_"]=function(){return this.trigger(d)}});qe.registerComponent("Player",Zi);var cd="plugin",ko="activePlugins_",Do={},dd=function(s){return Do.hasOwnProperty(s)},td=function(s){return dd(s)?Do[s]:void 0},zy=function(s,o){s[ko]=s[ko]||{},s[ko][o]=!0},hd=function(s,o,a){var e=(a?"before":"")+"pluginsetup";s.trigger(e,o),s.trigger(e+":"+o.name,o)},AM=function(s,o){var a=function(){hd(this,{name:s,plugin:o,instance:null},!0);var r=o.apply(this,arguments);return zy(this,s),hd(this,{name:s,plugin:o,instance:r}),r};return Object.keys(o).forEach(function(e){a[e]=o[e]}),a},Yv=function(s,o){return o.prototype.name=s,function(){hd(this,{name:s,plugin:o,instance:null},!0);for(var a=arguments.length,e=new Array(a),r=0;r<a;r++)e[r]=arguments[r];var l=b0(o,[this].concat(e));return this[s]=function(){return l},hd(this,l.getEventHash()),l}},Yr=function(){function d(o){if(this.constructor===d)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=o,this.log||(this.log=this.player.log.createLogger(this.name)),Np(this),delete this.trigger,dy(this,this.constructor.defaultState),zy(o,this.name),this.dispose=this.dispose.bind(this),o.on("dispose",this.dispose)}var s=d.prototype;return s.version=function(){return this.constructor.VERSION},s.getEventHash=function(a){return a===void 0&&(a={}),a.name=this.name,a.plugin=this.constructor,a.instance=this,a},s.trigger=function(a,e){return e===void 0&&(e={}),Ko(this.eventBusEl_,a,this.getEventHash(e))},s.handleStateChanged=function(a){},s.dispose=function(){var a=this.name,e=this.player;this.trigger("dispose"),this.off(),e.off("dispose",this.dispose),e[ko][a]=!1,this.player=this.state=null,e[a]=Yv(a,Do[a])},d.isBasic=function(a){var e=typeof a=="string"?td(a):a;return typeof e=="function"&&!d.prototype.isPrototypeOf(e.prototype)},d.registerPlugin=function(a,e){if(typeof a!="string")throw new Error('Illegal plugin name, "'+a+'", must be a string, was '+typeof a+".");if(dd(a))Xt.warn('A plugin named "'+a+'" already exists. You may want to avoid re-registering plugins!');else if(Zi.prototype.hasOwnProperty(a))throw new Error('Illegal plugin name, "'+a+'", cannot share a name with an existing player method!');if(typeof e!="function")throw new Error('Illegal plugin for "'+a+'", must be a function, was '+typeof e+".");return Do[a]=e,a!==cd&&(d.isBasic(e)?Zi.prototype[a]=AM(a,e):Zi.prototype[a]=Yv(a,e)),e},d.deregisterPlugin=function(a){if(a===cd)throw new Error("Cannot de-register base plugin.");dd(a)&&(delete Do[a],delete Zi.prototype[a])},d.getPlugins=function(a){a===void 0&&(a=Object.keys(Do));var e;return a.forEach(function(r){var l=td(r);l&&(e=e||{},e[r]=l)}),e},d.getPluginVersion=function(a){var e=td(a);return e&&e.VERSION||""},d}();Yr.getPlugin=td;Yr.BASE_PLUGIN_NAME=cd;Yr.registerPlugin(cd,Yr);Zi.prototype.usingPlugin=function(d){return!!this[ko]&&this[ko][d]===!0};Zi.prototype.hasPlugin=function(d){return!!dd(d)};var Kv=!1,SM=function(s,o){o===void 0&&(o={}),Kv||(Xt.warn("videojs.extend is deprecated as of Video.js 7.22.0 and will be removed in Video.js 8.0.0"),Kv=!0);var a=function(){s.apply(this,arguments)},e={};typeof o=="object"?(o.constructor!==Object.prototype.constructor&&(a=o.constructor),e=o):typeof o=="function"&&(a=o),gS(a,s),s&&(a.super_=s);for(var r in e)e.hasOwnProperty(r)&&(a.prototype[r]=e[r]);return a},Wy=function(s){return s.indexOf("#")===0?s.slice(1):s};function fe(d,s,o){var a=fe.getPlayer(d);if(a)return s&&Xt.warn('Player "'+d+'" is already initialised. Options will not be applied.'),o&&a.ready(o),a;var e=typeof d=="string"?es("#"+Wy(d)):d;if(!Yo(e))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!e.ownerDocument.defaultView||!e.ownerDocument.body.contains(e))&&Xt.warn("The element supplied is not included in the DOM"),s=s||{},s.restoreEl===!0&&(s.restoreEl=(e.parentNode&&e.parentNode.hasAttribute("data-vjs-player")?e.parentNode:e).cloneNode(!0)),Ja("beforesetup").forEach(function(l){var f=l(e,Ci(s));if(!Ta(f)||Array.isArray(f)){Xt.error("please return an object in beforesetup hooks");return}s=Ci(s,f)});var r=qe.getComponent("Player");return a=new r(e,s,o),Ja("setup").forEach(function(l){return l(a)}),a}fe.hooks_=va;fe.hooks=Ja;fe.hook=Zw;fe.hookOnce=$w;fe.removeHook=k0;if(ie.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&Qo()){var qc=es(".vjs-styles-defaults");if(!qc){qc=ay("vjs-styles-defaults");var Yf=es("head");Yf&&Yf.insertBefore(qc,Yf.firstChild),sy(qc,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}sp(1,fe);fe.VERSION=F0;fe.options=Zi.prototype.options_;fe.getPlayers=function(){return Zi.players};fe.getPlayer=function(d){var s=Zi.players,o;if(typeof d=="string"){var a=Wy(d),e=s[a];if(e)return e;o=es("#"+a)}else o=d;if(Yo(o)){var r=o,l=r.player,f=r.playerId;if(l||s[f])return l||s[f]}};fe.getAllPlayers=function(){return Object.keys(Zi.players).map(function(d){return Zi.players[d]}).filter(Boolean)};fe.players=Zi.players;fe.getComponent=qe.getComponent;fe.registerComponent=function(d,s){bi.isTech(s)&&Xt.warn("The "+d+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),qe.registerComponent.call(qe,d,s)};fe.getTech=bi.getTech;fe.registerTech=bi.registerTech;fe.use=OE;Object.defineProperty(fe,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(fe.middleware,"TERMINATOR",{value:sd,writeable:!1,enumerable:!0});fe.browser=rE;fe.TOUCH_ENABLED=Vo;fe.extend=SM;fe.mergeOptions=Ci;fe.bind=Pi;fe.registerPlugin=Yr.registerPlugin;fe.deregisterPlugin=Yr.deregisterPlugin;fe.plugin=function(d,s){return Xt.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Yr.registerPlugin(d,s)};fe.getPlugins=Yr.getPlugins;fe.getPlugin=Yr.getPlugin;fe.getPluginVersion=Yr.getPluginVersion;fe.addLanguage=function(d,s){var o;return d=(""+d).toLowerCase(),fe.options.languages=Ci(fe.options.languages,(o={},o[d]=s,o)),fe.options.languages[d]};fe.log=Xt;fe.createLogger=N0;fe.createTimeRange=fe.createTimeRanges=Ls;fe.formatTime=qo;fe.setFormatTime=JE;fe.resetFormatTime=eM;fe.parseUrl=Hp;fe.isCrossOrigin=Id;fe.EventTarget=sn;fe.on=Kn;fe.one=Pd;fe.off=vn;fe.trigger=Ko;fe.xhr=_0;fe.TextTrack=Eu;fe.AudioTrack=my;fe.VideoTrack=gy;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(d){fe[d]=function(){return Xt.warn("videojs."+d+"() is deprecated; use videojs.dom."+d+"() instead"),ny[d].apply(null,arguments)}});fe.computedStyle=_u;fe.dom=ny;fe.url=LE;fe.defineLazyProperty=am;fe.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"});/*! @name @videojs/http-streaming @version 2.16.3 @license Apache-2.0 */var Ar=bd,fd=function(s,o,a){return s&&a&&a.responseURL&&o!==a.responseURL?a.responseURL:o},Er=function(s){return fe.log.debug?fe.log.debug.bind(fe,"VHS:",s+" >"):function(){}},ts=1/30,Xr=ts*3,jy=function(s,o){var a=[],e;if(s&&s.length)for(e=0;e<s.length;e++)o(s.start(e),s.end(e))&&a.push([s.start(e),s.end(e)]);return fe.createTimeRanges(a)},Ro=function(s,o){return jy(s,function(a,e){return a-Xr<=o&&e+Xr>=o})},Xc=function(s,o){return jy(s,function(a){return a-ts>=o})},wM=function(s){if(s.length<2)return fe.createTimeRanges();for(var o=[],a=1;a<s.length;a++){var e=s.end(a-1),r=s.start(a);o.push([e,r])}return fe.createTimeRanges(o)},EM=function(s,o){var a=null,e=null,r=0,l=[],f=[];if(!s||!s.length||!o||!o.length)return fe.createTimeRange();for(var m=s.length;m--;)l.push({time:s.start(m),type:"start"}),l.push({time:s.end(m),type:"end"});for(m=o.length;m--;)l.push({time:o.start(m),type:"start"}),l.push({time:o.end(m),type:"end"});for(l.sort(function(v,A){return v.time-A.time}),m=0;m<l.length;m++)l[m].type==="start"?(r++,r===2&&(a=l[m].time)):l[m].type==="end"&&(r--,r===1&&(e=l[m].time)),a!==null&&e!==null&&(f.push([a,e]),a=null,e=null);return fe.createTimeRanges(f)},qy=function(s){var o=[];if(!s||!s.length)return"";for(var a=0;a<s.length;a++)o.push(s.start(a)+" => "+s.end(a));return o.join(", ")},MM=function(s,o,a){a===void 0&&(a=1);var e=s.length?s.end(s.length-1):0;return(e-o)/a},Ms=function(s){for(var o=[],a=0;a<s.length;a++)o.push({start:s.start(a),end:s.end(a)});return o},CM=function(s,o){if(s===o)return!1;if(!s&&o||!o&&s||s.length!==o.length)return!0;for(var a=0;a<s.length;a++)if(s.start(a)!==o.start(a)||s.end(a)!==o.end(a))return!0;return!1},Zv=function(s){if(!(!s||!s.length||!s.end))return s.end(s.length-1)},sm=function(s,o){var a=0;if(!s||!s.length)return a;for(var e=0;e<s.length;e++){var r=s.start(e),l=s.end(e);if(!(o>l)){if(o>r&&o<=l){a+=l-o;continue}a+=l-r}}return a},$v=fe.createTimeRange,om=function(s,o){if(!o.preload)return o.duration;var a=0;return(o.parts||[]).forEach(function(e){a+=e.duration}),(o.preloadHints||[]).forEach(function(e){e.type==="PART"&&(a+=s.partTargetDuration)}),a},fp=function(s){return(s.segments||[]).reduce(function(o,a,e){return a.parts?a.parts.forEach(function(r,l){o.push({duration:r.duration,segmentIndex:e,partIndex:l,part:r,segment:a})}):o.push({duration:a.duration,segmentIndex:e,partIndex:null,segment:a,part:null}),o},[])},Xy=function(s){var o=s.segments&&s.segments.length&&s.segments[s.segments.length-1];return o&&o.parts||[]},Qy=function(s){var o=s.preloadSegment;if(o){var a=o.parts,e=o.preloadHints,r=(e||[]).reduce(function(l,f){return l+(f.type==="PART"?1:0)},0);return r+=a&&a.length?a.length:0,r}},Yy=function(s,o){if(o.endList)return 0;if(s&&s.suggestedPresentationDelay)return s.suggestedPresentationDelay;var a=Xy(o).length>0;return a&&o.serverControl&&o.serverControl.partHoldBack?o.serverControl.partHoldBack:a&&o.partTargetDuration?o.partTargetDuration*3:o.serverControl&&o.serverControl.holdBack?o.serverControl.holdBack:o.targetDuration?o.targetDuration*3:0},PM=function(s,o){var a=0,e=o-s.mediaSequence,r=s.segments[e];if(r){if(typeof r.start<"u")return{result:r.start,precise:!0};if(typeof r.end<"u")return{result:r.end-r.duration,precise:!0}}for(;e--;){if(r=s.segments[e],typeof r.end<"u")return{result:a+r.end,precise:!0};if(a+=om(s,r),typeof r.start<"u")return{result:a+r.start,precise:!0}}return{result:a,precise:!1}},LM=function(s,o){for(var a=0,e,r=o-s.mediaSequence;r<s.segments.length;r++){if(e=s.segments[r],typeof e.start<"u")return{result:e.start-a,precise:!0};if(a+=om(s,e),typeof e.end<"u")return{result:e.end-a,precise:!0}}return{result:-1,precise:!1}},Ky=function(s,o,a){if(typeof o>"u"&&(o=s.mediaSequence+s.segments.length),o<s.mediaSequence)return 0;var e=PM(s,o);if(e.precise)return e.result;var r=LM(s,o);return r.precise?r.result:e.result+a},Zy=function(s,o,a){if(!s)return 0;if(typeof a!="number"&&(a=0),typeof o>"u"){if(s.totalDuration)return s.totalDuration;if(!s.endList)return ie.Infinity}return Ky(s,o,a)},pu=function(s){var o=s.defaultDuration,a=s.durationList,e=s.startIndex,r=s.endIndex,l=0;if(e>r){var f=[r,e];e=f[0],r=f[1]}if(e<0){for(var m=e;m<Math.min(0,r);m++)l+=o;e=0}for(var v=e;v<r;v++)l+=a[v].duration;return l},$y=function(s,o,a,e){if(!s||!s.segments)return null;if(s.endList)return Zy(s);if(o===null)return null;o=o||0;var r=Ky(s,s.mediaSequence+s.segments.length,o);return a&&(e=typeof e=="number"?e:Yy(null,s),r-=e),Math.max(0,r)},IM=function(s,o,a){var e=!0,r=o||0,l=$y(s,o,e,a);return l===null?$v():$v(r,l)},DM=function(s){for(var o=s.playlist,a=s.currentTime,e=s.startingSegmentIndex,r=s.startingPartIndex,l=s.startTime,f=s.experimentalExactManifestTimings,m=a-l,v=fp(o),A=0,L=0;L<v.length;L++){var P=v[L];if(e===P.segmentIndex&&!(typeof r=="number"&&typeof P.partIndex=="number"&&r!==P.partIndex)){A=L;break}}if(m<0){if(A>0)for(var U=A-1;U>=0;U--){var W=v[U];if(m+=W.duration,f){if(m<0)continue}else if(m+ts<=0)continue;return{partIndex:W.partIndex,segmentIndex:W.segmentIndex,startTime:l-pu({defaultDuration:o.targetDuration,durationList:v,startIndex:A,endIndex:U})}}return{partIndex:v[0]&&v[0].partIndex||null,segmentIndex:v[0]&&v[0].segmentIndex||0,startTime:a}}if(A<0){for(var Y=A;Y<0;Y++)if(m-=o.targetDuration,m<0)return{partIndex:v[0]&&v[0].partIndex||null,segmentIndex:v[0]&&v[0].segmentIndex||0,startTime:a};A=0}for(var q=A;q<v.length;q++){var _e=v[q];if(m-=_e.duration,f){if(m>0)continue}else if(m-ts>=0)continue;return{partIndex:_e.partIndex,segmentIndex:_e.segmentIndex,startTime:l+pu({defaultDuration:o.targetDuration,durationList:v,startIndex:A,endIndex:q})}}return{segmentIndex:v[v.length-1].segmentIndex,partIndex:v[v.length-1].partIndex,startTime:a}},Jy=function(s){return s.excludeUntil&&s.excludeUntil>Date.now()},lm=function(s){return s.excludeUntil&&s.excludeUntil===1/0},Fd=function(s){var o=Jy(s);return!s.disabled&&!o},RM=function(s){return s.disabled},OM=function(s){for(var o=0;o<s.segments.length;o++)if(s.segments[o].key)return!0;return!1},e_=function(s,o){return o.attributes&&o.attributes[s]},FM=function(s,o,a,e){if(e===void 0&&(e=0),!e_("BANDWIDTH",a))return NaN;var r=s*a.attributes.BANDWIDTH;return(r-e*8)/o},pp=function(s,o){if(s.playlists.length===1)return!0;var a=o.attributes.BANDWIDTH||Number.MAX_VALUE;return s.playlists.filter(function(e){return Fd(e)?(e.attributes.BANDWIDTH||0)<a:!1}).length===0},um=function(s,o){return!s&&!o||!s&&o||s&&!o?!1:!!(s===o||s.id&&o.id&&s.id===o.id||s.resolvedUri&&o.resolvedUri&&s.resolvedUri===o.resolvedUri||s.uri&&o.uri&&s.uri===o.uri)},Jv=function(s,o){var a=s&&s.mediaGroups&&s.mediaGroups.AUDIO||{},e=!1;for(var r in a){for(var l in a[r])if(e=o(a[r][l]),e)break;if(e)break}return!!e},Pu=function(s){if(!s||!s.playlists||!s.playlists.length){var o=Jv(s,function(l){return l.playlists&&l.playlists.length||l.uri});return o}for(var a=function(f){var m=s.playlists[f],v=m.attributes&&m.attributes.CODECS;if(v&&v.split(",").every(function(L){return S0(L)}))return"continue";var A=Jv(s,function(L){return um(m,L)});return A?"continue":{v:!1}},e=0;e<s.playlists.length;e++){var r=a(e);if(r!=="continue"&&typeof r=="object")return r.v}return!0},Fn={liveEdgeDelay:Yy,duration:Zy,seekable:IM,getMediaInfoForTime:DM,isEnabled:Fd,isDisabled:RM,isBlacklisted:Jy,isIncompatible:lm,playlistEnd:$y,isAes:OM,hasAttribute:e_,estimateSegmentRequestTime:FM,isLowestEnabledRendition:pp,isAudioOnly:Pu,playlistMatch:um,segmentDurationWithParts:om},t_=fe.log,cm=function(s,o){return s+"-"+o},kM=function(s,o,a){return"placeholder-uri-"+s+"-"+o+"-"+a},BM=function(s){var o=s.onwarn,a=s.oninfo,e=s.manifestString,r=s.customTagParsers,l=r===void 0?[]:r,f=s.customTagMappers,m=f===void 0?[]:f,v=s.experimentalLLHLS,A=new wS;o&&A.on("warn",o),a&&A.on("info",a),l.forEach(function(Y){return A.addParser(Y)}),m.forEach(function(Y){return A.addTagMapper(Y)}),A.push(e),A.end();var L=A.manifest;if(v||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(Y){L.hasOwnProperty(Y)&&delete L[Y]}),L.segments&&L.segments.forEach(function(Y){["parts","preloadHints"].forEach(function(q){Y.hasOwnProperty(q)&&delete Y[q]})})),!L.targetDuration){var P=10;L.segments&&L.segments.length&&(P=L.segments.reduce(function(Y,q){return Math.max(Y,q.duration)},0)),o&&o("manifest has no targetDuration defaulting to "+P),L.targetDuration=P}var U=Xy(L);if(U.length&&!L.partTargetDuration){var W=U.reduce(function(Y,q){return Math.max(Y,q.duration)},0);o&&(o("manifest has no partTargetDuration defaulting to "+W),t_.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),L.partTargetDuration=W}return L},tl=function(s,o){s.mediaGroups&&["AUDIO","SUBTITLES"].forEach(function(a){if(s.mediaGroups[a])for(var e in s.mediaGroups[a])for(var r in s.mediaGroups[a][e]){var l=s.mediaGroups[a][e][r];o(l,a,e,r)}})},i_=function(s){var o=s.playlist,a=s.uri,e=s.id;o.id=e,o.playlistErrors_=0,a&&(o.uri=a),o.attributes=o.attributes||{}},NM=function(s){for(var o=s.playlists.length;o--;){var a=s.playlists[o];i_({playlist:a,id:cm(o,a.uri)}),a.resolvedUri=Ar(s.uri,a.uri),s.playlists[a.id]=a,s.playlists[a.uri]=a,a.attributes.BANDWIDTH||t_.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},UM=function(s){tl(s,function(o){o.uri&&(o.resolvedUri=Ar(s.uri,o.uri))})},HM=function(s,o){var a=cm(0,o),e={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:ie.location.href,resolvedUri:ie.location.href,playlists:[{uri:o,id:a,resolvedUri:o,attributes:{}}]};return e.playlists[a]=e.playlists[0],e.playlists[o]=e.playlists[0],e},n_=function(s,o,a){a===void 0&&(a=kM),s.uri=o;for(var e=0;e<s.playlists.length;e++)if(!s.playlists[e].uri){var r="placeholder-uri-"+e;s.playlists[e].uri=r}var l=Pu(s);tl(s,function(f,m,v,A){if(!f.playlists||!f.playlists.length){if(l&&m==="AUDIO"&&!f.uri)for(var L=0;L<s.playlists.length;L++){var P=s.playlists[L];if(P.attributes&&P.attributes.AUDIO&&P.attributes.AUDIO===v)return}f.playlists=[ba({},f)]}f.playlists.forEach(function(U,W){var Y=a(m,v,A,U),q=cm(W,Y);U.uri?U.resolvedUri=U.resolvedUri||Ar(s.uri,U.uri):(U.uri=W===0?Y:q,U.resolvedUri=U.uri),U.id=U.id||q,U.attributes=U.attributes||{},s.playlists[U.id]=U,s.playlists[U.uri]=U})}),NM(s),UM(s)},pd=fe.mergeOptions,VM=fe.EventTarget,GM=function(s,o){if(o.endList||!o.serverControl)return s;var a={};if(o.serverControl.canBlockReload){var e=o.preloadSegment,r=o.mediaSequence+o.segments.length;if(e){var l=e.parts||[],f=Qy(o)-1;f>-1&&f!==l.length-1&&(a._HLS_part=f),(f>-1||l.length)&&r--}a._HLS_msn=r}if(o.serverControl&&o.serverControl.canSkipUntil&&(a._HLS_skip=o.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(a).length){var m=new ie.URL(s);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(v){a.hasOwnProperty(v)&&m.searchParams.set(v,a[v])}),s=m.toString()}return s},zM=function(s,o){if(!s)return o;var a=pd(s,o);if(s.preloadHints&&!o.preloadHints&&delete a.preloadHints,s.parts&&!o.parts)delete a.parts;else if(s.parts&&o.parts)for(var e=0;e<o.parts.length;e++)s.parts&&s.parts[e]&&(a.parts[e]=pd(s.parts[e],o.parts[e]));return!s.skipped&&o.skipped&&(a.skipped=!1),s.preload&&!o.preload&&(a.preload=!1),a},WM=function(s,o,a){var e=s.slice(),r=o.slice();a=a||0;for(var l=[],f,m=0;m<r.length;m++){var v=e[m+a],A=r[m];v?(f=v.map||f,l.push(zM(v,A))):(f&&!A.map&&(A.map=f),l.push(A))}return l},r_=function(s,o){!s.resolvedUri&&s.uri&&(s.resolvedUri=Ar(o,s.uri)),s.key&&!s.key.resolvedUri&&(s.key.resolvedUri=Ar(o,s.key.uri)),s.map&&!s.map.resolvedUri&&(s.map.resolvedUri=Ar(o,s.map.uri)),s.map&&s.map.key&&!s.map.key.resolvedUri&&(s.map.key.resolvedUri=Ar(o,s.map.key.uri)),s.parts&&s.parts.length&&s.parts.forEach(function(a){a.resolvedUri||(a.resolvedUri=Ar(o,a.uri))}),s.preloadHints&&s.preloadHints.length&&s.preloadHints.forEach(function(a){a.resolvedUri||(a.resolvedUri=Ar(o,a.uri))})},a_=function(s){var o=s.segments||[],a=s.preloadSegment;if(a&&a.parts&&a.parts.length){if(a.preloadHints){for(var e=0;e<a.preloadHints.length;e++)if(a.preloadHints[e].type==="MAP")return o}a.duration=s.targetDuration,a.preload=!0,o.push(a)}return o},s_=function(s,o){return s===o||s.segments&&o.segments&&s.segments.length===o.segments.length&&s.endList===o.endList&&s.mediaSequence===o.mediaSequence&&s.preloadSegment===o.preloadSegment},mp=function(s,o,a){a===void 0&&(a=s_);var e=pd(s,{}),r=e.playlists[o.id];if(!r||a(r,o))return null;o.segments=a_(o);var l=pd(r,o);if(l.preloadSegment&&!o.preloadSegment&&delete l.preloadSegment,r.segments){if(o.skip){o.segments=o.segments||[];for(var f=0;f<o.skip.skippedSegments;f++)o.segments.unshift({skipped:!0})}l.segments=WM(r.segments,o.segments,o.mediaSequence-r.mediaSequence)}l.segments.forEach(function(v){r_(v,l.resolvedUri)});for(var m=0;m<e.playlists.length;m++)e.playlists[m].id===o.id&&(e.playlists[m]=l);return e.playlists[o.id]=l,e.playlists[o.uri]=l,tl(s,function(v,A,L,P){if(v.playlists)for(var U=0;U<v.playlists.length;U++)o.id===v.playlists[U].id&&(v.playlists[U]=l)}),e},gp=function(s,o){var a=s.segments||[],e=a[a.length-1],r=e&&e.parts&&e.parts[e.parts.length-1],l=r&&r.duration||e&&e.duration;return o&&l?l*1e3:(s.partTargetDuration||s.targetDuration||10)*500},Oo=function(d){it(s,d);function s(a,e,r){var l;if(r===void 0&&(r={}),l=d.call(this)||this,!a)throw new Error("A non-empty playlist URL or object is required");l.logger_=Er("PlaylistLoader");var f=r,m=f.withCredentials,v=m===void 0?!1:m,A=f.handleManifestRedirects,L=A===void 0?!1:A;l.src=a,l.vhs_=e,l.withCredentials=v,l.handleManifestRedirects=L;var P=e.options_;return l.customTagParsers=P&&P.customTagParsers||[],l.customTagMappers=P&&P.customTagMappers||[],l.experimentalLLHLS=P&&P.experimentalLLHLS||!1,fe.browser.IE_VERSION&&(l.experimentalLLHLS=!1),l.state="HAVE_NOTHING",l.handleMediaupdatetimeout_=l.handleMediaupdatetimeout_.bind(Ft(l)),l.on("mediaupdatetimeout",l.handleMediaupdatetimeout_),l}var o=s.prototype;return o.handleMediaupdatetimeout_=function(){var e=this;if(this.state==="HAVE_METADATA"){var r=this.media(),l=Ar(this.master.uri,r.uri);this.experimentalLLHLS&&(l=GM(l,r)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:l,withCredentials:this.withCredentials},function(f,m){if(e.request){if(f)return e.playlistRequestError(e.request,e.media(),"HAVE_METADATA");e.haveMetadata({playlistString:e.request.responseText,url:e.media().uri,id:e.media().id})}})}},o.playlistRequestError=function(e,r,l){var f=r.uri,m=r.id;this.request=null,l&&(this.state=l),this.error={playlist:this.master.playlists[m],status:e.status,message:"HLS playlist request error at URL: "+f+".",responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")},o.parseManifest_=function(e){var r=this,l=e.url,f=e.manifestString;return BM({onwarn:function(v){var A=v.message;return r.logger_("m3u8-parser warn for "+l+": "+A)},oninfo:function(v){var A=v.message;return r.logger_("m3u8-parser info for "+l+": "+A)},manifestString:f,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,experimentalLLHLS:this.experimentalLLHLS})},o.haveMetadata=function(e){var r=e.playlistString,l=e.playlistObject,f=e.url,m=e.id;this.request=null,this.state="HAVE_METADATA";var v=l||this.parseManifest_({url:f,manifestString:r});v.lastRequest=Date.now(),i_({playlist:v,uri:f,id:m});var A=mp(this.master,v);this.targetDuration=v.partTargetDuration||v.targetDuration,this.pendingMedia_=null,A?(this.master=A,this.media_=this.master.playlists[m]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(gp(this.media(),!!A)),this.trigger("loadedplaylist")},o.dispose=function(){this.trigger("dispose"),this.stopRequest(),ie.clearTimeout(this.mediaUpdateTimeout),ie.clearTimeout(this.finalRenditionTimeout),this.off()},o.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},o.media=function(e,r){var l=this;if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}if(ie.clearTimeout(this.finalRenditionTimeout),r){var f=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=ie.setTimeout(this.media.bind(this,e,!1),f);return}var m=this.state,v=!this.media_||e.id!==this.media_.id,A=this.master.playlists[e.id];if(A&&A.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,v&&(this.trigger("mediachanging"),m==="HAVE_MASTER"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(gp(e,!0)),!!v){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},function(L,P){if(l.request){if(e.lastRequest=Date.now(),e.resolvedUri=fd(l.handleManifestRedirects,e.resolvedUri,P),L)return l.playlistRequestError(l.request,e,m);l.haveMetadata({playlistString:P.responseText,url:e.uri,id:e.id}),m==="HAVE_MASTER"?l.trigger("loadedmetadata"):l.trigger("mediachange")}})}},o.pause=function(){this.mediaUpdateTimeout&&(ie.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")},o.load=function(e){var r=this;this.mediaUpdateTimeout&&(ie.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);var l=this.media();if(e){var f=l?(l.partTargetDuration||l.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=ie.setTimeout(function(){r.mediaUpdateTimeout=null,r.load()},f);return}if(!this.started){this.start();return}l&&!l.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")},o.updateMediaUpdateTimeout_=function(e){var r=this;this.mediaUpdateTimeout&&(ie.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=ie.setTimeout(function(){r.mediaUpdateTimeout=null,r.trigger("mediaupdatetimeout"),r.updateMediaUpdateTimeout_(e)},e))},o.start=function(){var e=this;if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=ie.location.href),this.src.resolvedUri=this.src.uri,setTimeout(function(){e.setupInitialPlaylist(e.src)},0);return}this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},function(r,l){if(e.request){if(e.request=null,r)return e.error={status:l.status,message:"HLS playlist request error at URL: "+e.src+".",responseText:l.responseText,code:2},e.state==="HAVE_NOTHING"&&(e.started=!1),e.trigger("error");e.src=fd(e.handleManifestRedirects,e.src,l);var f=e.parseManifest_({manifestString:l.responseText,url:e.src});e.setupInitialPlaylist(f)}})},o.srcUri=function(){return typeof this.src=="string"?this.src:this.src.uri},o.setupInitialPlaylist=function(e){if(this.state="HAVE_MASTER",e.playlists){this.master=e,n_(this.master,this.srcUri()),e.playlists.forEach(function(l){l.segments=a_(l),l.segments.forEach(function(f){r_(f,l.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.master.playlists[0]);return}var r=this.srcUri()||ie.location.href;this.master=HM(e,r),this.haveMetadata({playlistObject:e,url:r,id:this.master.playlists[0].id}),this.trigger("loadedmetadata")},s}(VM),jM=fe.xhr,qM=fe.mergeOptions,vp=function(s,o,a,e){var r=s.responseType==="arraybuffer"?s.response:s.responseText;!o&&r&&(s.responseTime=Date.now(),s.roundTripTime=s.responseTime-s.requestTime,s.bytesReceived=r.byteLength||r.length,s.bandwidth||(s.bandwidth=Math.floor(s.bytesReceived/s.roundTripTime*8*1e3))),a.headers&&(s.responseHeaders=a.headers),o&&o.code==="ETIMEDOUT"&&(s.timedout=!0),!o&&!s.aborted&&a.statusCode!==200&&a.statusCode!==206&&a.statusCode!==0&&(o=new Error("XHR Failed with a response of: "+(s&&(r||s.responseText)))),e(o,s)},o_=function(){var s=function o(a,e){a=qM({timeout:45e3},a);var r=o.beforeRequest||fe.Vhs.xhr.beforeRequest;if(r&&typeof r=="function"){var l=r(a);l&&(a=l)}var f=fe.Vhs.xhr.original===!0?jM:fe.Vhs.xhr,m=f(a,function(A,L){return vp(m,A,L,e)}),v=m.abort;return m.abort=function(){return m.aborted=!0,v.apply(m,arguments)},m.uri=a.uri,m.requestTime=Date.now(),m};return s.original=!0,s},XM=function(s){var o,a=s.offset;return typeof s.offset=="bigint"||typeof s.length=="bigint"?o=ie.BigInt(s.offset)+ie.BigInt(s.length)-ie.BigInt(1):o=s.offset+s.length-1,"bytes="+a+"-"+o},yp=function(s){var o={};return s.byterange&&(o.Range=XM(s.byterange)),o},QM=function(s,o){return s.start(o)+"-"+s.end(o)},YM=function(s,o){var a=s.toString(16);return"00".substring(0,2-a.length)+a+(o%2?" ":"")},KM=function(s){return s>=32&&s<126?String.fromCharCode(s):"."},l_=function(s){var o={};return Object.keys(s).forEach(function(a){var e=s[a];E0(e)?o[a]={bytes:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}:o[a]=e}),o},md=function(s){var o=s.byterange||{length:1/0,offset:0};return[o.length,o.offset,s.resolvedUri].join(",")},u_=function(s){return s.resolvedUri},c_=function(s){for(var o=Array.prototype.slice.call(s),a=16,e="",r,l,f=0;f<o.length/a;f++)r=o.slice(f*a,f*a+a).map(YM).join(""),l=o.slice(f*a,f*a+a).map(KM).join(""),e+=r+" "+l+`
`;return e},ZM=function(s){var o=s.bytes;return c_(o)},$M=function(s){var o="",a;for(a=0;a<s.length;a++)o+=QM(s,a)+" ";return o},JM=Object.freeze({__proto__:null,createTransferableMessage:l_,initSegmentId:md,segmentKeyId:u_,hexDump:c_,tagDump:ZM,textRanges:$M}),d_=.25,e2=function(s,o){if(!o.dateTimeObject)return null;var a=o.videoTimingInfo.transmuxerPrependedSeconds,e=o.videoTimingInfo.transmuxedPresentationStart,r=e+a,l=s-r;return new Date(o.dateTimeObject.getTime()+l*1e3)},t2=function(s){return s.transmuxedPresentationEnd-s.transmuxedPresentationStart-s.transmuxerPrependedSeconds},i2=function(s,o){var a;try{a=new Date(s)}catch{return null}if(!o||!o.segments||o.segments.length===0)return null;var e=o.segments[0];if(a<e.dateTimeObject)return null;for(var r=0;r<o.segments.length-1;r++){e=o.segments[r];var l=o.segments[r+1].dateTimeObject;if(a<l)break}var f=o.segments[o.segments.length-1],m=f.dateTimeObject,v=f.videoTimingInfo?t2(f.videoTimingInfo):f.duration+f.duration*d_,A=new Date(m.getTime()+v*1e3);return a>A?null:(a>m&&(e=f),{segment:e,estimatedStart:e.videoTimingInfo?e.videoTimingInfo.transmuxedPresentationStart:Fn.duration(o,o.mediaSequence+o.segments.indexOf(e)),type:e.videoTimingInfo?"accurate":"estimate"})},n2=function(s,o){if(!o||!o.segments||o.segments.length===0)return null;for(var a=0,e,r=0;r<o.segments.length&&(e=o.segments[r],a=e.videoTimingInfo?e.videoTimingInfo.transmuxedPresentationEnd:a+e.duration,!(s<=a));r++);var l=o.segments[o.segments.length-1];if(l.videoTimingInfo&&l.videoTimingInfo.transmuxedPresentationEnd<s)return null;if(s>a){if(s>a+l.duration*d_)return null;e=l}return{segment:e,estimatedStart:e.videoTimingInfo?e.videoTimingInfo.transmuxedPresentationStart:a-e.duration,type:e.videoTimingInfo?"accurate":"estimate"}},r2=function(s,o){var a,e;try{a=new Date(s),e=new Date(o)}catch{}var r=a.getTime(),l=e.getTime();return(l-r)/1e3},a2=function(s){if(!s.segments||s.segments.length===0)return!1;for(var o=0;o<s.segments.length;o++){var a=s.segments[o];if(!a.dateTimeObject)return!1}return!0},s2=function(s){var o=s.playlist,a=s.time,e=a===void 0?void 0:a,r=s.callback;if(!r)throw new Error("getProgramTime: callback must be provided");if(!o||e===void 0)return r({message:"getProgramTime: playlist and time must be provided"});var l=n2(e,o);if(!l)return r({message:"valid programTime was not found"});if(l.type==="estimate")return r({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:l.estimatedStart});var f={mediaSeconds:e},m=e2(e,l.segment);return m&&(f.programDateTime=m.toISOString()),r(null,f)},o2=function d(s){var o=s.programTime,a=s.playlist,e=s.retryCount,r=e===void 0?2:e,l=s.seekTo,f=s.pauseAfterSeek,m=f===void 0?!0:f,v=s.tech,A=s.callback;if(!A)throw new Error("seekToProgramTime: callback must be provided");if(typeof o>"u"||!a||!l)return A({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!a.endList&&!v.hasStarted_)return A({message:"player must be playing a live stream to start buffering"});if(!a2(a))return A({message:"programDateTime tags must be provided in the manifest "+a.resolvedUri});var L=i2(o,a);if(!L)return A({message:o+" was not found in the stream"});var P=L.segment,U=r2(P.dateTimeObject,o);if(L.type==="estimate"){if(r===0)return A({message:o+" is not buffered yet. Try again"});l(L.estimatedStart+U),v.one("seeked",function(){d({programTime:o,playlist:a,retryCount:r-1,seekTo:l,pauseAfterSeek:m,tech:v,callback:A})});return}var W=P.start+U,Y=function(){return A(null,v.currentTime())};v.one("seeked",Y),m&&v.pause(),l(W)},Kf=function(s,o){if(s.readyState===4)return o()},l2=function(s,o,a){var e=[],r,l=!1,f=function(P,U,W,Y){return U.abort(),l=!0,a(P,U,W,Y)},m=function(P,U){if(!l){if(P)return f(P,U,"",e);var W=U.responseText.substring(e&&e.byteLength||0,U.responseText.length);if(e=BS(e,M0(W,!0)),r=r||cu(e),e.length<10||r&&e.length<r+2)return Kf(U,function(){return f(P,U,"",e)});var Y=Lp(e);return Y==="ts"&&e.length<188?Kf(U,function(){return f(P,U,"",e)}):!Y&&e.length<376?Kf(U,function(){return f(P,U,"",e)}):f(null,U,Y,e)}},v={uri:s,beforeSend:function(P){P.overrideMimeType("text/plain; charset=x-user-defined"),P.addEventListener("progress",function(U){return U.total,U.loaded,vp(P,null,{statusCode:P.status},m)})}},A=o(v,function(L,P){return vp(A,L,P,m)});return A},u2=fe.EventTarget,h_=fe.mergeOptions,e0=function(s,o){if(!s_(s,o)||s.sidx&&o.sidx&&(s.sidx.offset!==o.sidx.offset||s.sidx.length!==o.sidx.length))return!1;if(!s.sidx&&o.sidx||s.sidx&&!o.sidx||s.segments&&!o.segments||!s.segments&&o.segments)return!1;if(!s.segments&&!o.segments)return!0;for(var a=0;a<s.segments.length;a++){var e=s.segments[a],r=o.segments[a];if(e.uri!==r.uri)return!1;if(!(!e.byterange&&!r.byterange)){var l=e.byterange,f=r.byterange;if(l&&!f||!l&&f||l.offset!==f.offset||l.length!==f.length)return!1}}return!0},c2=function(s,o,a,e){var r=e.attributes.NAME||a;return"placeholder-uri-"+s+"-"+o+"-"+r},d2=function(s){var o=s.masterXml,a=s.srcUrl,e=s.clientOffset,r=s.sidxMapping,l=s.previousManifest,f=Cw(o,{manifestUri:a,clientOffset:e,sidxMapping:r,previousManifest:l});return n_(f,a,c2),f},h2=function(s,o){tl(s,function(a,e,r,l){l in o.mediaGroups[e][r]||delete s.mediaGroups[e][r][l]})},f2=function(s,o,a){for(var e=!0,r=h_(s,{duration:o.duration,minimumUpdatePeriod:o.minimumUpdatePeriod,timelineStarts:o.timelineStarts}),l=0;l<o.playlists.length;l++){var f=o.playlists[l];if(f.sidx){var m=Ad(f.sidx);a&&a[m]&&a[m].sidx&&Ep(f,a[m].sidx,f.sidx.resolvedUri)}var v=mp(r,f,e0);v&&(r=v,e=!1)}return tl(o,function(A,L,P,U){if(A.playlists&&A.playlists.length){var W=A.playlists[0].id,Y=mp(r,A.playlists[0],e0);Y&&(r=Y,U in r.mediaGroups[L][P]||(r.mediaGroups[L][P][U]=A),r.mediaGroups[L][P][U].playlists[0]=r.playlists[W],e=!1)}}),h2(r,o),o.minimumUpdatePeriod!==s.minimumUpdatePeriod&&(e=!1),e?null:r},p2=function(s,o){var a=!s.map&&!o.map,e=a||!!(s.map&&o.map&&s.map.byterange.offset===o.map.byterange.offset&&s.map.byterange.length===o.map.byterange.length);return e&&s.uri===o.uri&&s.byterange.offset===o.byterange.offset&&s.byterange.length===o.byterange.length},t0=function(s,o){var a={};for(var e in s){var r=s[e],l=r.sidx;if(l){var f=Ad(l);if(!o[f])break;var m=o[f].sidxInfo;p2(m,l)&&(a[f]=o[f])}}return a},m2=function(s,o){var a=t0(s.playlists,o),e=a;return tl(s,function(r,l,f,m){if(r.playlists&&r.playlists.length){var v=r.playlists;e=h_(e,t0(v,o))}}),e},_p=function(d){it(s,d);function s(a,e,r,l){var f;r===void 0&&(r={}),f=d.call(this)||this,f.masterPlaylistLoader_=l||Ft(f),l||(f.isMaster_=!0);var m=r,v=m.withCredentials,A=v===void 0?!1:v,L=m.handleManifestRedirects,P=L===void 0?!1:L;if(f.vhs_=e,f.withCredentials=A,f.handleManifestRedirects=P,!a)throw new Error("A non-empty playlist URL or object is required");return f.on("minimumUpdatePeriod",function(){f.refreshXml_()}),f.on("mediaupdatetimeout",function(){f.refreshMedia_(f.media().id)}),f.state="HAVE_NOTHING",f.loadedPlaylists_={},f.logger_=Er("DashPlaylistLoader"),f.isMaster_?(f.masterPlaylistLoader_.srcUrl=a,f.masterPlaylistLoader_.sidxMapping_={}):f.childPlaylist_=a,f}var o=s.prototype;return o.requestErrored_=function(e,r,l){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:r.status,message:"DASH request error at URL: "+r.uri,response:r.response,code:2},l&&(this.state=l),this.trigger("error"),!0},o.addSidxSegments_=function(e,r,l){var f=this,m=e.sidx&&Ad(e.sidx);if(!e.sidx||!m||this.masterPlaylistLoader_.sidxMapping_[m]){this.mediaRequest_=ie.setTimeout(function(){return l(!1)},0);return}var v=fd(this.handleManifestRedirects,e.sidx.resolvedUri),A=function(P,U){if(!f.requestErrored_(P,U,r)){var W=f.masterPlaylistLoader_.sidxMapping_,Y;try{Y=Rw(St(U.response).subarray(8))}catch(q){f.requestErrored_(q,U,r);return}return W[m]={sidxInfo:e.sidx,sidx:Y},Ep(e,Y,e.sidx.resolvedUri),l(!0)}};this.request=l2(v,this.vhs_.xhr,function(L,P,U,W){if(L)return A(L,P);if(!U||U!=="mp4")return A({status:P.status,message:"Unsupported "+(U||"unknown")+" container type for sidx segment at URL: "+v,response:"",playlist:e,internal:!0,blacklistDuration:1/0,code:2},P);var Y=e.sidx.byterange,q=Y.offset,_e=Y.length;if(W.length>=_e+q)return A(L,{response:W.subarray(q,q+_e),status:P.status,uri:P.uri});f.request=f.vhs_.xhr({uri:v,responseType:"arraybuffer",headers:yp({byterange:e.sidx.byterange})},A)})},o.dispose=function(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},ie.clearTimeout(this.minimumUpdatePeriodTimeout_),ie.clearTimeout(this.mediaRequest_),ie.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.off()},o.hasPendingRequest=function(){return this.request||this.mediaRequest_},o.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},o.media=function(e){var r=this;if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);var l=this.state;if(typeof e=="string"){if(!this.masterPlaylistLoader_.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.masterPlaylistLoader_.master.playlists[e]}var f=!this.media_||e.id!==this.media_.id;if(f&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,f&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}f&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,l,function(m){r.haveMetadata({startingState:l,playlist:e})}))},o.haveMetadata=function(e){var r=e.startingState,l=e.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[l.id]=l,this.mediaRequest_=null,this.refreshMedia_(l.id),r==="HAVE_MASTER"?this.trigger("loadedmetadata"):this.trigger("mediachange")},o.pause=function(){this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),ie.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMaster_&&(ie.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_),this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)},o.load=function(e){var r=this;ie.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;var l=this.media();if(e){var f=l?l.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=ie.setTimeout(function(){return r.load()},f);return}if(!this.started){this.start();return}l&&!l.endList?(this.isMaster_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")},o.start=function(){var e=this;if(this.started=!0,!this.isMaster_){this.mediaRequest_=ie.setTimeout(function(){return e.haveMaster_()},0);return}this.requestMaster_(function(r,l){e.haveMaster_(),!e.hasPendingRequest()&&!e.media_&&e.media(e.masterPlaylistLoader_.master.playlists[0])})},o.requestMaster_=function(e){var r=this;this.request=this.vhs_.xhr({uri:this.masterPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},function(l,f){if(r.requestErrored_(l,f)){r.state==="HAVE_NOTHING"&&(r.started=!1);return}var m=f.responseText!==r.masterPlaylistLoader_.masterXml_;if(r.masterPlaylistLoader_.masterXml_=f.responseText,f.responseHeaders&&f.responseHeaders.date?r.masterLoaded_=Date.parse(f.responseHeaders.date):r.masterLoaded_=Date.now(),r.masterPlaylistLoader_.srcUrl=fd(r.handleManifestRedirects,r.masterPlaylistLoader_.srcUrl,f),m){r.handleMaster_(),r.syncClientServerClock_(function(){return e(f,m)});return}return e(f,m)})},o.syncClientServerClock_=function(e){var r=this,l=Pw(this.masterPlaylistLoader_.masterXml_);if(l===null)return this.masterPlaylistLoader_.clientOffset_=this.masterLoaded_-Date.now(),e();if(l.method==="DIRECT")return this.masterPlaylistLoader_.clientOffset_=l.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Ar(this.masterPlaylistLoader_.srcUrl,l.value),method:l.method,withCredentials:this.withCredentials},function(f,m){if(r.request){if(f)return r.masterPlaylistLoader_.clientOffset_=r.masterLoaded_-Date.now(),e();var v;l.method==="HEAD"?!m.responseHeaders||!m.responseHeaders.date?v=r.masterLoaded_:v=Date.parse(m.responseHeaders.date):v=Date.parse(m.responseText),r.masterPlaylistLoader_.clientOffset_=v-Date.now(),e()}})},o.haveMaster_=function(){this.state="HAVE_MASTER",this.isMaster_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)},o.handleMaster_=function(){this.mediaRequest_=null;var e=this.masterPlaylistLoader_.master,r=d2({masterXml:this.masterPlaylistLoader_.masterXml_,srcUrl:this.masterPlaylistLoader_.srcUrl,clientOffset:this.masterPlaylistLoader_.clientOffset_,sidxMapping:this.masterPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(r=f2(e,r,this.masterPlaylistLoader_.sidxMapping_)),this.masterPlaylistLoader_.master=r||e;var l=this.masterPlaylistLoader_.master.locations&&this.masterPlaylistLoader_.master.locations[0];return l&&l!==this.masterPlaylistLoader_.srcUrl&&(this.masterPlaylistLoader_.srcUrl=l),(!e||r&&r.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),!!r},o.updateMinimumUpdatePeriodTimeout_=function(){var e=this.masterPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(ie.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);var r=e.master&&e.master.minimumUpdatePeriod;if(r===0&&(e.media()?r=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof r!="number"||r<=0){r<0&&this.logger_("found invalid minimumUpdatePeriod of "+r+", not setting a timeout");return}this.createMUPTimeout_(r)},o.createMUPTimeout_=function(e){var r=this.masterPlaylistLoader_;r.minimumUpdatePeriodTimeout_=ie.setTimeout(function(){r.minimumUpdatePeriodTimeout_=null,r.trigger("minimumUpdatePeriod"),r.createMUPTimeout_(e)},e)},o.refreshXml_=function(){var e=this;this.requestMaster_(function(r,l){l&&(e.media_&&(e.media_=e.masterPlaylistLoader_.master.playlists[e.media_.id]),e.masterPlaylistLoader_.sidxMapping_=m2(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.sidxMapping_),e.addSidxSegments_(e.media(),e.state,function(f){e.refreshMedia_(e.media().id)}))})},o.refreshMedia_=function(e){var r=this;if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMaster_&&this.handleMaster_();var l=this.masterPlaylistLoader_.master.playlists,f=!this.media_||this.media_!==l[e];if(f?this.media_=l[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){var m=function v(){r.media().endList||(r.mediaUpdateTimeout=ie.setTimeout(function(){r.trigger("mediaupdatetimeout"),v()},gp(r.media(),!!f)))};m()}this.trigger("loadedplaylist")},s}(u2),rn={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30},g2=function(s){for(var o=new Uint8Array(new ArrayBuffer(s.length)),a=0;a<s.length;a++)o[a]=s.charCodeAt(a);return o.buffer},f_=function(s){return s.on=s.addEventListener,s.off=s.removeEventListener,s},v2=function(s){try{return URL.createObjectURL(new Blob([s],{type:"application/javascript"}))}catch{var o=new BlobBuilder;return o.append(s),URL.createObjectURL(o.getBlob())}},p_=function(s){return function(){var o=v2(s),a=f_(new Worker(o));a.objURL=o;var e=a.terminate;return a.on=a.addEventListener,a.off=a.removeEventListener,a.terminate=function(){return URL.revokeObjectURL(o),e.call(this)},a}},m_=function(s){return"var browserWorkerPolyFill = "+f_.toString()+`;
browserWorkerPolyFill(self);
`+s},g_=function(s){return s.toString().replace(/^function.+?{/,"").slice(0,-1)},y2=m_(g_(function(){var d=function(){this.init=function(){var y={};this.on=function(T,b){y[T]||(y[T]=[]),y[T]=y[T].concat(b)},this.off=function(T,b){var w;return y[T]?(w=y[T].indexOf(b),y[T]=y[T].slice(),y[T].splice(w,1),w>-1):!1},this.trigger=function(T){var b,w,R,B;if(b=y[T],!!b)if(arguments.length===2)for(R=b.length,w=0;w<R;++w)b[w].call(this,arguments[1]);else{for(B=[],w=arguments.length,w=1;w<arguments.length;++w)B.push(arguments[w]);for(R=b.length,w=0;w<R;++w)b[w].apply(this,B)}},this.dispose=function(){y={}}}};d.prototype.pipe=function(H){return this.on("data",function(y){H.push(y)}),this.on("done",function(y){H.flush(y)}),this.on("partialdone",function(y){H.partialFlush(y)}),this.on("endedtimeline",function(y){H.endTimeline(y)}),this.on("reset",function(y){H.reset(y)}),H},d.prototype.push=function(H){this.trigger("data",H)},d.prototype.flush=function(H){this.trigger("done",H)},d.prototype.partialFlush=function(H){this.trigger("partialdone",H)},d.prototype.endTimeline=function(H){this.trigger("endedtimeline",H)},d.prototype.reset=function(H){this.trigger("reset",H)};var s=d,o=Math.pow(2,32),a=function(y){var T=new DataView(y.buffer,y.byteOffset,y.byteLength),b;return T.getBigUint64?(b=T.getBigUint64(0),b<Number.MAX_SAFE_INTEGER?Number(b):b):T.getUint32(0)*o+T.getUint32(4)},e={getUint64:a,MAX_UINT32:o},r=e.MAX_UINT32,l,f,m,v,A,L,P,U,W,Y,q,_e,J,at,Me,Le,ze,De,Ee,We,Ce,vt,je,ut,Kt,Jt,hi,Oi,vi,$i,li,lr,Mn,ur,cr,Mr;(function(){var H;if(je={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(H in je)je.hasOwnProperty(H)&&(je[H]=[H.charCodeAt(0),H.charCodeAt(1),H.charCodeAt(2),H.charCodeAt(3)]);ut=new Uint8Array([105,115,111,109]),Jt=new Uint8Array([97,118,99,49]),Kt=new Uint8Array([0,0,0,1]),hi=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Oi=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),vi={video:hi,audio:Oi},lr=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),li=new Uint8Array([0,0,0,0,0,0,0,0]),Mn=new Uint8Array([0,0,0,0,0,0,0,0]),ur=Mn,cr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Mr=Mn,$i=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),l=function(y){var T=[],b=0,w,R,B;for(w=1;w<arguments.length;w++)T.push(arguments[w]);for(w=T.length;w--;)b+=T[w].byteLength;for(R=new Uint8Array(b+8),B=new DataView(R.buffer,R.byteOffset,R.byteLength),B.setUint32(0,R.byteLength),R.set(y,4),w=0,b=8;w<T.length;w++)R.set(T[w],b),b+=T[w].byteLength;return R},f=function(){return l(je.dinf,l(je.dref,lr))},m=function(y){return l(je.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,y.audioobjecttype<<3|y.samplingfrequencyindex>>>1,y.samplingfrequencyindex<<7|y.channelcount<<3,6,1,2]))},v=function(){return l(je.ftyp,ut,Kt,ut,Jt)},Le=function(y){return l(je.hdlr,vi[y])},A=function(y){return l(je.mdat,y)},Me=function(y){var T=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,y.duration>>>24&255,y.duration>>>16&255,y.duration>>>8&255,y.duration&255,85,196,0,0]);return y.samplerate&&(T[12]=y.samplerate>>>24&255,T[13]=y.samplerate>>>16&255,T[14]=y.samplerate>>>8&255,T[15]=y.samplerate&255),l(je.mdhd,T)},at=function(y){return l(je.mdia,Me(y),Le(y.type),P(y))},L=function(y){return l(je.mfhd,new Uint8Array([0,0,0,0,(y&4278190080)>>24,(y&16711680)>>16,(y&65280)>>8,y&255]))},P=function(y){return l(je.minf,y.type==="video"?l(je.vmhd,$i):l(je.smhd,li),f(),De(y))},U=function(y,T){for(var b=[],w=T.length;w--;)b[w]=We(T[w]);return l.apply(null,[je.moof,L(y)].concat(b))},W=function(y){for(var T=y.length,b=[];T--;)b[T]=_e(y[T]);return l.apply(null,[je.moov,q(4294967295)].concat(b).concat(Y(y)))},Y=function(y){for(var T=y.length,b=[];T--;)b[T]=Ce(y[T]);return l.apply(null,[je.mvex].concat(b))},q=function(y){var T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(y&4278190080)>>24,(y&16711680)>>16,(y&65280)>>8,y&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return l(je.mvhd,T)},ze=function(y){var T=y.samples||[],b=new Uint8Array(4+T.length),w,R;for(R=0;R<T.length;R++)w=T[R].flags,b[R+4]=w.dependsOn<<4|w.isDependedOn<<2|w.hasRedundancy;return l(je.sdtp,b)},De=function(y){return l(je.stbl,Ee(y),l(je.stts,Mr),l(je.stsc,ur),l(je.stsz,cr),l(je.stco,Mn))},function(){var H,y;Ee=function(b){return l(je.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),b.type==="video"?H(b):y(b))},H=function(b){var w=b.sps||[],R=b.pps||[],B=[],j=[],Z,ae;for(Z=0;Z<w.length;Z++)B.push((w[Z].byteLength&65280)>>>8),B.push(w[Z].byteLength&255),B=B.concat(Array.prototype.slice.call(w[Z]));for(Z=0;Z<R.length;Z++)j.push((R[Z].byteLength&65280)>>>8),j.push(R[Z].byteLength&255),j=j.concat(Array.prototype.slice.call(R[Z]));if(ae=[je.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(b.width&65280)>>8,b.width&255,(b.height&65280)>>8,b.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l(je.avcC,new Uint8Array([1,b.profileIdc,b.profileCompatibility,b.levelIdc,255].concat([w.length],B,[R.length],j))),l(je.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],b.sarRatio){var ne=b.sarRatio[0],de=b.sarRatio[1];ae.push(l(je.pasp,new Uint8Array([(ne&4278190080)>>24,(ne&16711680)>>16,(ne&65280)>>8,ne&255,(de&4278190080)>>24,(de&16711680)>>16,(de&65280)>>8,de&255])))}return l.apply(null,ae)},y=function(b){return l(je.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(b.channelcount&65280)>>8,b.channelcount&255,(b.samplesize&65280)>>8,b.samplesize&255,0,0,0,0,(b.samplerate&65280)>>8,b.samplerate&255,0,0]),m(b))}}(),J=function(y){var T=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(y.id&4278190080)>>24,(y.id&16711680)>>16,(y.id&65280)>>8,y.id&255,0,0,0,0,(y.duration&4278190080)>>24,(y.duration&16711680)>>16,(y.duration&65280)>>8,y.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(y.width&65280)>>8,y.width&255,0,0,(y.height&65280)>>8,y.height&255,0,0]);return l(je.tkhd,T)},We=function(y){var T,b,w,R,B,j,Z;return T=l(je.tfhd,new Uint8Array([0,0,0,58,(y.id&4278190080)>>24,(y.id&16711680)>>16,(y.id&65280)>>8,y.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),j=Math.floor(y.baseMediaDecodeTime/r),Z=Math.floor(y.baseMediaDecodeTime%r),b=l(je.tfdt,new Uint8Array([1,0,0,0,j>>>24&255,j>>>16&255,j>>>8&255,j&255,Z>>>24&255,Z>>>16&255,Z>>>8&255,Z&255])),B=92,y.type==="audio"?(w=vt(y,B),l(je.traf,T,b,w)):(R=ze(y),w=vt(y,R.length+B),l(je.traf,T,b,w,R))},_e=function(y){return y.duration=y.duration||4294967295,l(je.trak,J(y),at(y))},Ce=function(y){var T=new Uint8Array([0,0,0,0,(y.id&4278190080)>>24,(y.id&16711680)>>16,(y.id&65280)>>8,y.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return y.type!=="video"&&(T[T.length-1]=0),l(je.trex,T)},function(){var H,y,T;T=function(w,R){var B=0,j=0,Z=0,ae=0;return w.length&&(w[0].duration!==void 0&&(B=1),w[0].size!==void 0&&(j=2),w[0].flags!==void 0&&(Z=4),w[0].compositionTimeOffset!==void 0&&(ae=8)),[0,0,B|j|Z|ae,1,(w.length&4278190080)>>>24,(w.length&16711680)>>>16,(w.length&65280)>>>8,w.length&255,(R&4278190080)>>>24,(R&16711680)>>>16,(R&65280)>>>8,R&255]},y=function(w,R){var B,j,Z,ae,ne,de;for(ae=w.samples||[],R+=20+16*ae.length,Z=T(ae,R),j=new Uint8Array(Z.length+ae.length*16),j.set(Z),B=Z.length,de=0;de<ae.length;de++)ne=ae[de],j[B++]=(ne.duration&4278190080)>>>24,j[B++]=(ne.duration&16711680)>>>16,j[B++]=(ne.duration&65280)>>>8,j[B++]=ne.duration&255,j[B++]=(ne.size&4278190080)>>>24,j[B++]=(ne.size&16711680)>>>16,j[B++]=(ne.size&65280)>>>8,j[B++]=ne.size&255,j[B++]=ne.flags.isLeading<<2|ne.flags.dependsOn,j[B++]=ne.flags.isDependedOn<<6|ne.flags.hasRedundancy<<4|ne.flags.paddingValue<<1|ne.flags.isNonSyncSample,j[B++]=ne.flags.degradationPriority&61440,j[B++]=ne.flags.degradationPriority&15,j[B++]=(ne.compositionTimeOffset&4278190080)>>>24,j[B++]=(ne.compositionTimeOffset&16711680)>>>16,j[B++]=(ne.compositionTimeOffset&65280)>>>8,j[B++]=ne.compositionTimeOffset&255;return l(je.trun,j)},H=function(w,R){var B,j,Z,ae,ne,de;for(ae=w.samples||[],R+=20+8*ae.length,Z=T(ae,R),B=new Uint8Array(Z.length+ae.length*8),B.set(Z),j=Z.length,de=0;de<ae.length;de++)ne=ae[de],B[j++]=(ne.duration&4278190080)>>>24,B[j++]=(ne.duration&16711680)>>>16,B[j++]=(ne.duration&65280)>>>8,B[j++]=ne.duration&255,B[j++]=(ne.size&4278190080)>>>24,B[j++]=(ne.size&16711680)>>>16,B[j++]=(ne.size&65280)>>>8,B[j++]=ne.size&255;return l(je.trun,B)},vt=function(w,R){return w.type==="audio"?H(w,R):y(w,R)}}();var Zn={ftyp:v,mdat:A,moof:U,moov:W,initSegment:function(y){var T=v(),b=W(y),w;return w=new Uint8Array(T.byteLength+b.byteLength),w.set(T),w.set(b,T.byteLength),w}},Ma=function(y){var T,b,w=[],R=[];for(R.byteLength=0,R.nalCount=0,R.duration=0,w.byteLength=0,T=0;T<y.length;T++)b=y[T],b.nalUnitType==="access_unit_delimiter_rbsp"?(w.length&&(w.duration=b.dts-w.dts,R.byteLength+=w.byteLength,R.nalCount+=w.length,R.duration+=w.duration,R.push(w)),w=[b],w.byteLength=b.data.byteLength,w.pts=b.pts,w.dts=b.dts):(b.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(w.keyFrame=!0),w.duration=b.dts-w.dts,w.byteLength+=b.data.byteLength,w.push(b));return R.length&&(!w.duration||w.duration<=0)&&(w.duration=R[R.length-1].duration),R.byteLength+=w.byteLength,R.nalCount+=w.length,R.duration+=w.duration,R.push(w),R},Ca=function(y){var T,b,w=[],R=[];for(w.byteLength=0,w.nalCount=0,w.duration=0,w.pts=y[0].pts,w.dts=y[0].dts,R.byteLength=0,R.nalCount=0,R.duration=0,R.pts=y[0].pts,R.dts=y[0].dts,T=0;T<y.length;T++)b=y[T],b.keyFrame?(w.length&&(R.push(w),R.byteLength+=w.byteLength,R.nalCount+=w.nalCount,R.duration+=w.duration),w=[b],w.nalCount=b.length,w.byteLength=b.byteLength,w.pts=b.pts,w.dts=b.dts,w.duration=b.duration):(w.duration+=b.duration,w.nalCount+=b.length,w.byteLength+=b.byteLength,w.push(b));return R.length&&w.duration<=0&&(w.duration=R[R.length-1].duration),R.byteLength+=w.byteLength,R.nalCount+=w.nalCount,R.duration+=w.duration,R.push(w),R},Pa=function(y){var T;return!y[0][0].keyFrame&&y.length>1&&(T=y.shift(),y.byteLength-=T.byteLength,y.nalCount-=T.nalCount,y[0][0].dts=T.dts,y[0][0].pts=T.pts,y[0][0].duration+=T.duration),y},Lu=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},il=function(y,T){var b=Lu();return b.dataOffset=T,b.compositionTimeOffset=y.pts-y.dts,b.duration=y.duration,b.size=4*y.length,b.size+=y.byteLength,y.keyFrame&&(b.flags.dependsOn=2,b.flags.isNonSyncSample=0),b},kd=function(y,T){var b,w,R,B,j,Z=T||0,ae=[];for(b=0;b<y.length;b++)for(B=y[b],w=0;w<B.length;w++)j=B[w],R=il(j,Z),Z+=R.size,ae.push(R);return ae},Bd=function(y){var T,b,w,R,B,j,Z=0,ae=y.byteLength,ne=y.nalCount,de=ae+4*ne,Pe=new Uint8Array(de),tt=new DataView(Pe.buffer);for(T=0;T<y.length;T++)for(R=y[T],b=0;b<R.length;b++)for(B=R[b],w=0;w<B.length;w++)j=B[w],tt.setUint32(Z,j.data.byteLength),Z+=4,Pe.set(j.data,Z),Z+=j.data.byteLength;return Pe},Nd=function(y,T){var b,w=T||0,R=[];return b=il(y,w),R.push(b),R},Ud=function(y){var T,b,w=0,R=y.byteLength,B=y.length,j=R+4*B,Z=new Uint8Array(j),ae=new DataView(Z.buffer);for(T=0;T<y.length;T++)b=y[T],ae.setUint32(w,b.data.byteLength),w+=4,Z.set(b.data,w),w+=b.data.byteLength;return Z},is={groupNalsIntoFrames:Ma,groupFramesIntoGops:Ca,extendFirstKeyFrame:Pa,generateSampleTable:kd,concatenateNalData:Bd,generateSampleTableForFrame:Nd,concatenateNalDataForFrame:Ud},Cr=[33,16,5,32,164,27],nl=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ui=function(y){for(var T=[];y--;)T.push(0);return T},rl=function(y){return Object.keys(y).reduce(function(T,b){return T[b]=new Uint8Array(y[b].reduce(function(w,R){return w.concat(R)},[])),T},{})},al,Hd=function(){if(!al){var y={96e3:[Cr,[227,64],ui(154),[56]],88200:[Cr,[231],ui(170),[56]],64e3:[Cr,[248,192],ui(240),[56]],48e3:[Cr,[255,192],ui(268),[55,148,128],ui(54),[112]],44100:[Cr,[255,192],ui(268),[55,163,128],ui(84),[112]],32e3:[Cr,[255,192],ui(268),[55,234],ui(226),[112]],24e3:[Cr,[255,192],ui(268),[55,255,128],ui(268),[111,112],ui(126),[224]],16e3:[Cr,[255,192],ui(268),[55,255,128],ui(268),[111,255],ui(269),[223,108],ui(195),[1,192]],12e3:[nl,ui(268),[3,127,248],ui(268),[6,255,240],ui(268),[13,255,224],ui(268),[27,253,128],ui(259),[56]],11025:[nl,ui(268),[3,127,248],ui(268),[6,255,240],ui(268),[13,255,224],ui(268),[27,255,192],ui(268),[55,175,128],ui(108),[112]],8e3:[nl,ui(268),[3,121,16],ui(47),[7]]};al=rl(y)}return al},sl=9e4,ol,La,Rs,ll,Ia,Iu,Du;ol=function(y){return y*sl},La=function(y,T){return y*T},Rs=function(y){return y/sl},ll=function(y,T){return y/T},Ia=function(y,T){return ol(ll(y,T))},Iu=function(y,T){return La(Rs(y),T)},Du=function(y,T,b){return Rs(b?y:y-T)};var ai={ONE_SECOND_IN_TS:sl,secondsToVideoTs:ol,secondsToAudioTs:La,videoTsToSeconds:Rs,audioTsToSeconds:ll,audioTsToVideoTs:Ia,videoTsToAudioTs:Iu,metadataTsToSeconds:Du},Vd=function(y){var T,b,w=0;for(T=0;T<y.length;T++)b=y[T],w+=b.data.byteLength;return w},Gd=function(y,T,b,w){var R,B=0,j=0,Z=0,ae=0,ne,de,Pe;if(T.length&&(R=ai.audioTsToVideoTs(y.baseMediaDecodeTime,y.samplerate),B=Math.ceil(ai.ONE_SECOND_IN_TS/(y.samplerate/1024)),b&&w&&(j=R-Math.max(b,w),Z=Math.floor(j/B),ae=Z*B),!(Z<1||ae>ai.ONE_SECOND_IN_TS/2))){for(ne=Hd()[y.samplerate],ne||(ne=T[0].data),de=0;de<Z;de++)Pe=T[0],T.splice(0,0,{data:ne,dts:Pe.dts-B,pts:Pe.pts-B});return y.baseMediaDecodeTime-=Math.floor(ai.videoTsToAudioTs(ae,y.samplerate)),ae}},Ru=function(y,T,b){return T.minSegmentDts>=b?y:(T.minSegmentDts=1/0,y.filter(function(w){return w.dts>=b?(T.minSegmentDts=Math.min(T.minSegmentDts,w.dts),T.minSegmentPts=T.minSegmentDts,!0):!1}))},ul=function(y){var T,b,w=[];for(T=0;T<y.length;T++)b=y[T],w.push({size:b.data.byteLength,duration:1024});return w},cl=function(y){var T,b,w=0,R=new Uint8Array(Vd(y));for(T=0;T<y.length;T++)b=y[T],R.set(b.data,w),w+=b.data.byteLength;return R},ns={prefixWithSilence:Gd,trimAdtsFramesByEarliestDts:Ru,generateSampleTable:ul,concatenateFrameData:cl},Ou=ai.ONE_SECOND_IN_TS,dl=function(y,T){typeof T.pts=="number"&&(y.timelineStartInfo.pts===void 0&&(y.timelineStartInfo.pts=T.pts),y.minSegmentPts===void 0?y.minSegmentPts=T.pts:y.minSegmentPts=Math.min(y.minSegmentPts,T.pts),y.maxSegmentPts===void 0?y.maxSegmentPts=T.pts:y.maxSegmentPts=Math.max(y.maxSegmentPts,T.pts)),typeof T.dts=="number"&&(y.timelineStartInfo.dts===void 0&&(y.timelineStartInfo.dts=T.dts),y.minSegmentDts===void 0?y.minSegmentDts=T.dts:y.minSegmentDts=Math.min(y.minSegmentDts,T.dts),y.maxSegmentDts===void 0?y.maxSegmentDts=T.dts:y.maxSegmentDts=Math.max(y.maxSegmentDts,T.dts))},hl=function(y){delete y.minSegmentDts,delete y.maxSegmentDts,delete y.minSegmentPts,delete y.maxSegmentPts},fl=function(y,T){var b,w,R=y.minSegmentDts;return T||(R-=y.timelineStartInfo.dts),b=y.timelineStartInfo.baseMediaDecodeTime,b+=R,b=Math.max(0,b),y.type==="audio"&&(w=y.samplerate/Ou,b*=w,b=Math.floor(b)),b},Ai={clearDtsInfo:hl,calculateTrackBaseMediaDecodeTime:fl,collectDtsInfo:dl},Os=4,on=128,Fu=function(y){for(var T=0,b={payloadType:-1,payloadSize:0},w=0,R=0;T<y.byteLength&&y[T]!==on;){for(;y[T]===255;)w+=255,T++;for(w+=y[T++];y[T]===255;)R+=255,T++;if(R+=y[T++],!b.payload&&w===Os){var B=String.fromCharCode(y[T+3],y[T+4],y[T+5],y[T+6]);if(B==="GA94"){b.payloadType=w,b.payloadSize=R,b.payload=y.subarray(T,T+R);break}else b.payload=void 0}T+=R,w=0,R=0}return b},ku=function(y){return y.payload[0]!==181||(y.payload[1]<<8|y.payload[2])!==49||String.fromCharCode(y.payload[3],y.payload[4],y.payload[5],y.payload[6])!=="GA94"||y.payload[7]!==3?null:y.payload.subarray(8,y.payload.length-1)},qi=function(y,T){var b=[],w,R,B,j;if(!(T[0]&64))return b;for(R=T[0]&31,w=0;w<R;w++)B=w*3,j={type:T[B+2]&3,pts:y},T[B+2]&4&&(j.ccData=T[B+3]<<8|T[B+4],b.push(j));return b},zd=function(y){for(var T=y.byteLength,b=[],w=1,R,B;w<T-2;)y[w]===0&&y[w+1]===0&&y[w+2]===3?(b.push(w+2),w+=2):w++;if(b.length===0)return y;R=T-b.length,B=new Uint8Array(R);var j=0;for(w=0;w<R;j++,w++)j===b[0]&&(j++,b.shift()),B[w]=y[j];return B},Pr={parseSei:Fu,parseUserData:ku,parseCaptionPackets:qi,discardEmulationPreventionBytes:zd,USER_DATA_REGISTERED_ITU_T_T35:Os},ln=function H(y){y=y||{},H.prototype.init.call(this),this.parse708captions_=typeof y.parse708captions=="boolean"?y.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Si(0,0),new Si(0,1),new Si(1,0),new Si(1,1)],this.parse708captions_&&(this.cc708Stream_=new ei({captionServices:y.captionServices})),this.reset(),this.ccStreams_.forEach(function(T){T.on("data",this.trigger.bind(this,"data")),T.on("partialdone",this.trigger.bind(this,"partialdone")),T.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ln.prototype=new s,ln.prototype.push=function(H){var y,T,b;if(H.nalUnitType==="sei_rbsp"&&(y=Pr.parseSei(H.escapedRBSP),!!y.payload&&y.payloadType===Pr.USER_DATA_REGISTERED_ITU_T_T35&&(T=Pr.parseUserData(y),!!T))){if(H.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(H.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}b=Pr.parseCaptionPackets(H.pts,T),this.captionPackets_=this.captionPackets_.concat(b),this.latestDts_!==H.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=H.dts}},ln.prototype.flushCCStreams=function(H){this.ccStreams_.forEach(function(y){return H==="flush"?y.flush():y.partialFlush()},this)},ln.prototype.flushStream=function(H){if(!this.captionPackets_.length){this.flushCCStreams(H);return}this.captionPackets_.forEach(function(y,T){y.presortIndex=T}),this.captionPackets_.sort(function(y,T){return y.pts===T.pts?y.presortIndex-T.presortIndex:y.pts-T.pts}),this.captionPackets_.forEach(function(y){y.type<2?this.dispatchCea608Packet(y):this.dispatchCea708Packet(y)},this),this.captionPackets_.length=0,this.flushCCStreams(H)},ln.prototype.flush=function(){return this.flushStream("flush")},ln.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ln.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(H){H.reset()})},ln.prototype.dispatchCea608Packet=function(H){this.setsTextOrXDSActive(H)?this.activeCea608Channel_[H.type]=null:this.setsChannel1Active(H)?this.activeCea608Channel_[H.type]=0:this.setsChannel2Active(H)&&(this.activeCea608Channel_[H.type]=1),this.activeCea608Channel_[H.type]!==null&&this.ccStreams_[(H.type<<1)+this.activeCea608Channel_[H.type]].push(H)},ln.prototype.setsChannel1Active=function(H){return(H.ccData&30720)===4096},ln.prototype.setsChannel2Active=function(H){return(H.ccData&30720)===6144},ln.prototype.setsTextOrXDSActive=function(H){return(H.ccData&28928)===256||(H.ccData&30974)===4138||(H.ccData&30974)===6186},ln.prototype.dispatchCea708Packet=function(H){this.parse708captions_&&this.cc708Stream_.push(H)};var Wd={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},jd=function(y){var T=Wd[y]||y;return y&4096&&y===T?"":String.fromCharCode(T)},Kr=function(y){return 32<=y&&y<=127||160<=y&&y<=255},dr=function(y){this.windowNum=y,this.reset()};dr.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},dr.prototype.getText=function(){return this.rows.join(`
`)},dr.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},dr.prototype.newLine=function(H){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(H),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},dr.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},dr.prototype.addText=function(H){this.rows[this.rowIdx]+=H},dr.prototype.backspace=function(){if(!this.isEmpty()){var H=this.rows[this.rowIdx];this.rows[this.rowIdx]=H.substr(0,H.length-1)}};var Zr=function(y,T,b){this.serviceNum=y,this.text="",this.currentWindow=new dr(-1),this.windows=[],this.stream=b,typeof T=="string"&&this.createTextDecoder(T)};Zr.prototype.init=function(H,y){this.startPts=H;for(var T=0;T<8;T++)this.windows[T]=new dr(T),typeof y=="function"&&(this.windows[T].beforeRowOverflow=y)},Zr.prototype.setCurrentWindow=function(H){this.currentWindow=this.windows[H]},Zr.prototype.createTextDecoder=function(H){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(H)}catch(y){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+H+" encoding. "+y})}};var ei=function H(y){y=y||{},H.prototype.init.call(this);var T=this,b=y.captionServices||{},w={},R;Object.keys(b).forEach(function(B){R=b[B],/^SERVICE/.test(B)&&(w[B]=R.encoding)}),this.serviceEncodings=w,this.current708Packet=null,this.services={},this.push=function(B){B.type===3?(T.new708Packet(),T.add708Bytes(B)):(T.current708Packet===null&&T.new708Packet(),T.add708Bytes(B))}};ei.prototype=new s,ei.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},ei.prototype.add708Bytes=function(H){var y=H.ccData,T=y>>>8,b=y&255;this.current708Packet.ptsVals.push(H.pts),this.current708Packet.data.push(T),this.current708Packet.data.push(b)},ei.prototype.push708Packet=function(){var H=this.current708Packet,y=H.data,T=null,b=null,w=0,R=y[w++];for(H.seq=R>>6,H.sizeCode=R&63;w<y.length;w++)R=y[w++],T=R>>5,b=R&31,T===7&&b>0&&(R=y[w++],T=R),this.pushServiceBlock(T,w,b),b>0&&(w+=b-1)},ei.prototype.pushServiceBlock=function(H,y,T){var b,w=y,R=this.current708Packet.data,B=this.services[H];for(B||(B=this.initService(H,w));w<y+T&&w<R.length;w++)b=R[w],Kr(b)?w=this.handleText(w,B):b===24?w=this.multiByteCharacter(w,B):b===16?w=this.extendedCommands(w,B):128<=b&&b<=135?w=this.setCurrentWindow(w,B):152<=b&&b<=159?w=this.defineWindow(w,B):b===136?w=this.clearWindows(w,B):b===140?w=this.deleteWindows(w,B):b===137?w=this.displayWindows(w,B):b===138?w=this.hideWindows(w,B):b===139?w=this.toggleWindows(w,B):b===151?w=this.setWindowAttributes(w,B):b===144?w=this.setPenAttributes(w,B):b===145?w=this.setPenColor(w,B):b===146?w=this.setPenLocation(w,B):b===143?B=this.reset(w,B):b===8?B.currentWindow.backspace():b===12?B.currentWindow.clearText():b===13?B.currentWindow.pendingNewLine=!0:b===14?B.currentWindow.clearText():b===141&&w++},ei.prototype.extendedCommands=function(H,y){var T=this.current708Packet.data,b=T[++H];return Kr(b)&&(H=this.handleText(H,y,{isExtended:!0})),H},ei.prototype.getPts=function(H){return this.current708Packet.ptsVals[Math.floor(H/2)]},ei.prototype.initService=function(H,y){var b="SERVICE"+H,T=this,b,w;return b in this.serviceEncodings&&(w=this.serviceEncodings[b]),this.services[H]=new Zr(H,w,T),this.services[H].init(this.getPts(y),function(R){T.flushDisplayed(R,T.services[H])}),this.services[H]},ei.prototype.handleText=function(H,y,T){var b=T&&T.isExtended,w=T&&T.isMultiByte,R=this.current708Packet.data,B=b?4096:0,j=R[H],Z=R[H+1],ae=y.currentWindow,ne,de;return y.textDecoder_&&!b?(w?(de=[j,Z],H++):de=[j],ne=y.textDecoder_.decode(new Uint8Array(de))):ne=jd(B|j),ae.pendingNewLine&&!ae.isEmpty()&&ae.newLine(this.getPts(H)),ae.pendingNewLine=!1,ae.addText(ne),H},ei.prototype.multiByteCharacter=function(H,y){var T=this.current708Packet.data,b=T[H+1],w=T[H+2];return Kr(b)&&Kr(w)&&(H=this.handleText(++H,y,{isMultiByte:!0})),H},ei.prototype.setCurrentWindow=function(H,y){var T=this.current708Packet.data,b=T[H],w=b&7;return y.setCurrentWindow(w),H},ei.prototype.defineWindow=function(H,y){var T=this.current708Packet.data,b=T[H],w=b&7;y.setCurrentWindow(w);var R=y.currentWindow;return b=T[++H],R.visible=(b&32)>>5,R.rowLock=(b&16)>>4,R.columnLock=(b&8)>>3,R.priority=b&7,b=T[++H],R.relativePositioning=(b&128)>>7,R.anchorVertical=b&127,b=T[++H],R.anchorHorizontal=b,b=T[++H],R.anchorPoint=(b&240)>>4,R.rowCount=b&15,b=T[++H],R.columnCount=b&63,b=T[++H],R.windowStyle=(b&56)>>3,R.penStyle=b&7,R.virtualRowCount=R.rowCount+1,H},ei.prototype.setWindowAttributes=function(H,y){var T=this.current708Packet.data,b=T[H],w=y.currentWindow.winAttr;return b=T[++H],w.fillOpacity=(b&192)>>6,w.fillRed=(b&48)>>4,w.fillGreen=(b&12)>>2,w.fillBlue=b&3,b=T[++H],w.borderType=(b&192)>>6,w.borderRed=(b&48)>>4,w.borderGreen=(b&12)>>2,w.borderBlue=b&3,b=T[++H],w.borderType+=(b&128)>>5,w.wordWrap=(b&64)>>6,w.printDirection=(b&48)>>4,w.scrollDirection=(b&12)>>2,w.justify=b&3,b=T[++H],w.effectSpeed=(b&240)>>4,w.effectDirection=(b&12)>>2,w.displayEffect=b&3,H},ei.prototype.flushDisplayed=function(H,y){for(var T=[],b=0;b<8;b++)y.windows[b].visible&&!y.windows[b].isEmpty()&&T.push(y.windows[b].getText());y.endPts=H,y.text=T.join(`

`),this.pushCaption(y),y.startPts=H},ei.prototype.pushCaption=function(H){H.text!==""&&(this.trigger("data",{startPts:H.startPts,endPts:H.endPts,text:H.text,stream:"cc708_"+H.serviceNum}),H.text="",H.startPts=H.endPts)},ei.prototype.displayWindows=function(H,y){var T=this.current708Packet.data,b=T[++H],w=this.getPts(H);this.flushDisplayed(w,y);for(var R=0;R<8;R++)b&1<<R&&(y.windows[R].visible=1);return H},ei.prototype.hideWindows=function(H,y){var T=this.current708Packet.data,b=T[++H],w=this.getPts(H);this.flushDisplayed(w,y);for(var R=0;R<8;R++)b&1<<R&&(y.windows[R].visible=0);return H},ei.prototype.toggleWindows=function(H,y){var T=this.current708Packet.data,b=T[++H],w=this.getPts(H);this.flushDisplayed(w,y);for(var R=0;R<8;R++)b&1<<R&&(y.windows[R].visible^=1);return H},ei.prototype.clearWindows=function(H,y){var T=this.current708Packet.data,b=T[++H],w=this.getPts(H);this.flushDisplayed(w,y);for(var R=0;R<8;R++)b&1<<R&&y.windows[R].clearText();return H},ei.prototype.deleteWindows=function(H,y){var T=this.current708Packet.data,b=T[++H],w=this.getPts(H);this.flushDisplayed(w,y);for(var R=0;R<8;R++)b&1<<R&&y.windows[R].reset();return H},ei.prototype.setPenAttributes=function(H,y){var T=this.current708Packet.data,b=T[H],w=y.currentWindow.penAttr;return b=T[++H],w.textTag=(b&240)>>4,w.offset=(b&12)>>2,w.penSize=b&3,b=T[++H],w.italics=(b&128)>>7,w.underline=(b&64)>>6,w.edgeType=(b&56)>>3,w.fontStyle=b&7,H},ei.prototype.setPenColor=function(H,y){var T=this.current708Packet.data,b=T[H],w=y.currentWindow.penColor;return b=T[++H],w.fgOpacity=(b&192)>>6,w.fgRed=(b&48)>>4,w.fgGreen=(b&12)>>2,w.fgBlue=b&3,b=T[++H],w.bgOpacity=(b&192)>>6,w.bgRed=(b&48)>>4,w.bgGreen=(b&12)>>2,w.bgBlue=b&3,b=T[++H],w.edgeRed=(b&48)>>4,w.edgeGreen=(b&12)>>2,w.edgeBlue=b&3,H},ei.prototype.setPenLocation=function(H,y){var T=this.current708Packet.data,b=T[H],w=y.currentWindow.penLoc;return y.currentWindow.pendingNewLine=!0,b=T[++H],w.row=b&15,b=T[++H],w.column=b&63,H},ei.prototype.reset=function(H,y){var T=this.getPts(H);return this.flushDisplayed(T,y),this.initService(y.serviceNum,H)};var Fs={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ks=function(y){return y===null?"":(y=Fs[y]||y,String.fromCharCode(y))},Bs=14,qd=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],kn=function(){for(var y=[],T=Bs+1;T--;)y.push("");return y},Si=function H(y,T){H.prototype.init.call(this),this.field_=y||0,this.dataChannel_=T||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(b){var w,R,B,j,Z;if(w=b.ccData&32639,w===this.lastControlCode_){this.lastControlCode_=null;return}if((w&61440)===4096?this.lastControlCode_=w:w!==this.PADDING_&&(this.lastControlCode_=null),B=w>>>8,j=w&255,w!==this.PADDING_)if(w===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(w===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(b.pts),this.flushDisplayed(b.pts),R=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=R,this.startPts_=b.pts;else if(w===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(b.pts);else if(w===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(b.pts);else if(w===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(b.pts);else if(w===this.CARRIAGE_RETURN_)this.clearFormatting(b.pts),this.flushDisplayed(b.pts),this.shiftRowsUp_(),this.startPts_=b.pts;else if(w===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(w===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(b.pts),this.displayed_=kn();else if(w===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=kn();else if(w===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(b.pts),this.displayed_=kn()),this.mode_="paintOn",this.startPts_=b.pts;else if(this.isSpecialCharacter(B,j))B=(B&3)<<8,Z=ks(B|j),this[this.mode_](b.pts,Z),this.column_++;else if(this.isExtCharacter(B,j))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),B=(B&3)<<8,Z=ks(B|j),this[this.mode_](b.pts,Z),this.column_++;else if(this.isMidRowCode(B,j))this.clearFormatting(b.pts),this[this.mode_](b.pts," "),this.column_++,(j&14)===14&&this.addFormatting(b.pts,["i"]),(j&1)===1&&this.addFormatting(b.pts,["u"]);else if(this.isOffsetControlCode(B,j))this.column_+=j&3;else if(this.isPAC(B,j)){var ae=qd.indexOf(w&7968);this.mode_==="rollUp"&&(ae-this.rollUpRows_+1<0&&(ae=this.rollUpRows_-1),this.setRollUp(b.pts,ae)),ae!==this.row_&&(this.clearFormatting(b.pts),this.row_=ae),j&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(b.pts,["u"]),(w&16)===16&&(this.column_=((w&14)>>1)*4),this.isColorPAC(j)&&(j&14)===14&&this.addFormatting(b.pts,["i"])}else this.isNormalChar(B)&&(j===0&&(j=null),Z=ks(B),Z+=ks(j),this[this.mode_](b.pts,Z),this.column_+=Z.length)}};Si.prototype=new s,Si.prototype.flushDisplayed=function(H){var y=this.displayed_.map(function(T,b){try{return T.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+b+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");y.length&&this.trigger("data",{startPts:this.startPts_,endPts:H,text:y,stream:this.name_})},Si.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=kn(),this.nonDisplayed_=kn(),this.lastControlCode_=null,this.column_=0,this.row_=Bs,this.rollUpRows_=2,this.formatting_=[]},Si.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Si.prototype.isSpecialCharacter=function(H,y){return H===this.EXT_&&y>=48&&y<=63},Si.prototype.isExtCharacter=function(H,y){return(H===this.EXT_+1||H===this.EXT_+2)&&y>=32&&y<=63},Si.prototype.isMidRowCode=function(H,y){return H===this.EXT_&&y>=32&&y<=47},Si.prototype.isOffsetControlCode=function(H,y){return H===this.OFFSET_&&y>=33&&y<=35},Si.prototype.isPAC=function(H,y){return H>=this.BASE_&&H<this.BASE_+8&&y>=64&&y<=127},Si.prototype.isColorPAC=function(H){return H>=64&&H<=79||H>=96&&H<=127},Si.prototype.isNormalChar=function(H){return H>=32&&H<=127},Si.prototype.setRollUp=function(H,y){if(this.mode_!=="rollUp"&&(this.row_=Bs,this.mode_="rollUp",this.flushDisplayed(H),this.nonDisplayed_=kn(),this.displayed_=kn()),y!==void 0&&y!==this.row_)for(var T=0;T<this.rollUpRows_;T++)this.displayed_[y-T]=this.displayed_[this.row_-T],this.displayed_[this.row_-T]="";y===void 0&&(y=this.row_),this.topRow_=y-this.rollUpRows_+1},Si.prototype.addFormatting=function(H,y){this.formatting_=this.formatting_.concat(y);var T=y.reduce(function(b,w){return b+"<"+w+">"},"");this[this.mode_](H,T)},Si.prototype.clearFormatting=function(H){if(this.formatting_.length){var y=this.formatting_.reverse().reduce(function(T,b){return T+"</"+b+">"},"");this.formatting_=[],this[this.mode_](H,y)}},Si.prototype.popOn=function(H,y){var T=this.nonDisplayed_[this.row_];T+=y,this.nonDisplayed_[this.row_]=T},Si.prototype.rollUp=function(H,y){var T=this.displayed_[this.row_];T+=y,this.displayed_[this.row_]=T},Si.prototype.shiftRowsUp_=function(){var H;for(H=0;H<this.topRow_;H++)this.displayed_[H]="";for(H=this.row_+1;H<Bs+1;H++)this.displayed_[H]="";for(H=this.topRow_;H<this.row_;H++)this.displayed_[H]=this.displayed_[H+1];this.displayed_[this.row_]=""},Si.prototype.paintOn=function(H,y){var T=this.displayed_[this.row_];T+=y,this.displayed_[this.row_]=T};var Bn={CaptionStream:ln,Cea608Stream:Si,Cea708Stream:ei},fi={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Xd=8589934592,Qd=4294967296,$r="shared",Jr=function(y,T){var b=1;for(y>T&&(b=-1);Math.abs(T-y)>Qd;)y+=b*Xd;return y},Bu=function H(y){var T,b;H.prototype.init.call(this),this.type_=y||$r,this.push=function(w){this.type_!==$r&&w.type!==this.type_||(b===void 0&&(b=w.dts),w.dts=Jr(w.dts,b),w.pts=Jr(w.pts,b),T=w.dts,this.trigger("data",w))},this.flush=function(){b=T,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){b=void 0,T=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Bu.prototype=new s;var Nu={TimestampRolloverStream:Bu,handleRollover:Jr},Uu=function(y,T,b){var w,R="";for(w=T;w<b;w++)R+="%"+("00"+y[w].toString(16)).slice(-2);return R},Ns=function(y,T,b){return decodeURIComponent(Uu(y,T,b))},Yd=function(y,T,b){return unescape(Uu(y,T,b))},Us=function(y){return y[0]<<21|y[1]<<14|y[2]<<7|y[3]},pl={TXXX:function(y){var T;if(y.data[0]===3){for(T=1;T<y.data.length;T++)if(y.data[T]===0){y.description=Ns(y.data,1,T),y.value=Ns(y.data,T+1,y.data.length).replace(/\0*$/,"");break}y.data=y.value}},WXXX:function(y){var T;if(y.data[0]===3){for(T=1;T<y.data.length;T++)if(y.data[T]===0){y.description=Ns(y.data,1,T),y.url=Ns(y.data,T+1,y.data.length);break}}},PRIV:function(y){var T;for(T=0;T<y.data.length;T++)if(y.data[T]===0){y.owner=Yd(y.data,0,T);break}y.privateData=y.data.subarray(T+1),y.data=y.privateData}},rs;rs=function(y){var T={descriptor:y&&y.descriptor},b=0,w=[],R=0,B;if(rs.prototype.init.call(this),this.dispatchType=fi.METADATA_STREAM_TYPE.toString(16),T.descriptor)for(B=0;B<T.descriptor.length;B++)this.dispatchType+=("00"+T.descriptor[B].toString(16)).slice(-2);this.push=function(j){var Z,ae,ne,de,Pe,tt;if(j.type==="timed-metadata"){if(j.dataAlignmentIndicator&&(R=0,w.length=0),w.length===0&&(j.data.length<10||j.data[0]!==73||j.data[1]!==68||j.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(w.push(j),R+=j.data.byteLength,w.length===1&&(b=Us(j.data.subarray(6,10)),b+=10),!(R<b)){for(Z={data:new Uint8Array(b),frames:[],pts:w[0].pts,dts:w[0].dts},Pe=0;Pe<b;)Z.data.set(w[0].data.subarray(0,b-Pe),Pe),Pe+=w[0].data.byteLength,R-=w[0].data.byteLength,w.shift();ae=10,Z.data[5]&64&&(ae+=4,ae+=Us(Z.data.subarray(10,14)),b-=Us(Z.data.subarray(16,20)));do{if(ne=Us(Z.data.subarray(ae+4,ae+8)),ne<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});return}if(tt=String.fromCharCode(Z.data[ae],Z.data[ae+1],Z.data[ae+2],Z.data[ae+3]),de={id:tt,data:Z.data.subarray(ae+10,ae+ne+10)},de.key=de.id,pl[de.id]&&(pl[de.id](de),de.owner==="com.apple.streaming.transportStreamTimestamp")){var ft=de.data,Ke=(ft[3]&1)<<30|ft[4]<<22|ft[5]<<14|ft[6]<<6|ft[7]>>>2;Ke*=4,Ke+=ft[7]&3,de.timeStamp=Ke,Z.pts===void 0&&Z.dts===void 0&&(Z.pts=de.timeStamp,Z.dts=de.timeStamp),this.trigger("timestamp",de)}Z.frames.push(de),ae+=10,ae+=ne}while(ae<b);this.trigger("data",Z)}}}},rs.prototype=new s;var Hu=rs,Vu=Nu.TimestampRolloverStream,as,Da,ss,ea=188,ml=71;as=function(){var y=new Uint8Array(ea),T=0;as.prototype.init.call(this),this.push=function(b){var w=0,R=ea,B;for(T?(B=new Uint8Array(b.byteLength+T),B.set(y.subarray(0,T)),B.set(b,T),T=0):B=b;R<B.byteLength;){if(B[w]===ml&&B[R]===ml){this.trigger("data",B.subarray(w,R)),w+=ea,R+=ea;continue}w++,R++}w<B.byteLength&&(y.set(B.subarray(w),0),T=B.byteLength-w)},this.flush=function(){T===ea&&y[0]===ml&&(this.trigger("data",y),T=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){T=0,this.trigger("reset")}},as.prototype=new s,Da=function(){var y,T,b,w;Da.prototype.init.call(this),w=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,y=function(B,j){var Z=0;j.payloadUnitStartIndicator&&(Z+=B[Z]+1),j.type==="pat"?T(B.subarray(Z),j):b(B.subarray(Z),j)},T=function(B,j){j.section_number=B[7],j.last_section_number=B[8],w.pmtPid=(B[10]&31)<<8|B[11],j.pmtPid=w.pmtPid},b=function(B,j){var Z,ae,ne,de;if(B[5]&1){for(w.programMapTable={video:null,audio:null,"timed-metadata":{}},Z=(B[1]&15)<<8|B[2],ae=3+Z-4,ne=(B[10]&15)<<8|B[11],de=12+ne;de<ae;){var Pe=B[de],tt=(B[de+1]&31)<<8|B[de+2];Pe===fi.H264_STREAM_TYPE&&w.programMapTable.video===null?w.programMapTable.video=tt:Pe===fi.ADTS_STREAM_TYPE&&w.programMapTable.audio===null?w.programMapTable.audio=tt:Pe===fi.METADATA_STREAM_TYPE&&(w.programMapTable["timed-metadata"][tt]=Pe),de+=((B[de+3]&15)<<8|B[de+4])+5}j.programMapTable=w.programMapTable}},this.push=function(R){var B={},j=4;if(B.payloadUnitStartIndicator=!!(R[1]&64),B.pid=R[1]&31,B.pid<<=8,B.pid|=R[2],(R[3]&48)>>>4>1&&(j+=R[j]+1),B.pid===0)B.type="pat",y(R.subarray(j),B),this.trigger("data",B);else if(B.pid===this.pmtPid)for(B.type="pmt",y(R.subarray(j),B),this.trigger("data",B);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([R,j,B]):this.processPes_(R,j,B)},this.processPes_=function(R,B,j){j.pid===this.programMapTable.video?j.streamType=fi.H264_STREAM_TYPE:j.pid===this.programMapTable.audio?j.streamType=fi.ADTS_STREAM_TYPE:j.streamType=this.programMapTable["timed-metadata"][j.pid],j.type="pes",j.data=R.subarray(B),this.trigger("data",j)}},Da.prototype=new s,Da.STREAM_TYPES={h264:27,adts:15},ss=function(){var y=this,T=!1,b={data:[],size:0},w={data:[],size:0},R={data:[],size:0},B,j=function(ne,de){var Pe,tt=ne[0]<<16|ne[1]<<8|ne[2];de.data=new Uint8Array,tt===1&&(de.packetLength=6+(ne[4]<<8|ne[5]),de.dataAlignmentIndicator=(ne[6]&4)!==0,Pe=ne[7],Pe&192&&(de.pts=(ne[9]&14)<<27|(ne[10]&255)<<20|(ne[11]&254)<<12|(ne[12]&255)<<5|(ne[13]&254)>>>3,de.pts*=4,de.pts+=(ne[13]&6)>>>1,de.dts=de.pts,Pe&64&&(de.dts=(ne[14]&14)<<27|(ne[15]&255)<<20|(ne[16]&254)<<12|(ne[17]&255)<<5|(ne[18]&254)>>>3,de.dts*=4,de.dts+=(ne[18]&6)>>>1)),de.data=ne.subarray(9+ne[8]))},Z=function(ne,de,Pe){var tt=new Uint8Array(ne.size),ft={type:de},Ke=0,Pt=0,Ui=!1,gt;if(!(!ne.data.length||ne.size<9)){for(ft.trackId=ne.data[0].pid,Ke=0;Ke<ne.data.length;Ke++)gt=ne.data[Ke],tt.set(gt.data,Pt),Pt+=gt.data.byteLength;j(tt,ft),Ui=de==="video"||ft.packetLength<=ne.size,(Pe||Ui)&&(ne.size=0,ne.data.length=0),Ui&&y.trigger("data",ft)}};ss.prototype.init.call(this),this.push=function(ae){({pat:function(){},pes:function(){var de,Pe;switch(ae.streamType){case fi.H264_STREAM_TYPE:de=b,Pe="video";break;case fi.ADTS_STREAM_TYPE:de=w,Pe="audio";break;case fi.METADATA_STREAM_TYPE:de=R,Pe="timed-metadata";break;default:return}ae.payloadUnitStartIndicator&&Z(de,Pe,!0),de.data.push(ae),de.size+=ae.data.byteLength},pmt:function(){var de={type:"metadata",tracks:[]};B=ae.programMapTable,B.video!==null&&de.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+B.video,codec:"avc",type:"video"}),B.audio!==null&&de.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+B.audio,codec:"adts",type:"audio"}),T=!0,y.trigger("data",de)}})[ae.type]()},this.reset=function(){b.size=0,b.data.length=0,w.size=0,w.data.length=0,this.trigger("reset")},this.flushStreams_=function(){Z(b,"video"),Z(w,"audio"),Z(R,"timed-metadata")},this.flush=function(){if(!T&&B){var ae={type:"metadata",tracks:[]};B.video!==null&&ae.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+B.video,codec:"avc",type:"video"}),B.audio!==null&&ae.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+B.audio,codec:"adts",type:"audio"}),y.trigger("data",ae)}T=!1,this.flushStreams_(),this.trigger("done")}},ss.prototype=new s;var gl={PAT_PID:0,MP2T_PACKET_LENGTH:ea,TransportPacketStream:as,TransportParseStream:Da,ElementaryStream:ss,TimestampRolloverStream:Vu,CaptionStream:Bn.CaptionStream,Cea608Stream:Bn.Cea608Stream,Cea708Stream:Bn.Cea708Stream,MetadataStream:Hu};for(var Hs in fi)fi.hasOwnProperty(Hs)&&(gl[Hs]=fi[Hs]);var hr=gl,Kd=ai.ONE_SECOND_IN_TS,Vs,Gu=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Vs=function(y){var T,b=0;Vs.prototype.init.call(this),this.skipWarn_=function(w,R){this.trigger("log",{level:"warn",message:"adts skiping bytes "+w+" to "+R+" in frame "+b+" outside syncword"})},this.push=function(w){var R=0,B,j,Z,ae,ne;if(y||(b=0),w.type==="audio"){T&&T.length?(Z=T,T=new Uint8Array(Z.byteLength+w.data.byteLength),T.set(Z),T.set(w.data,Z.byteLength)):T=w.data;for(var de;R+7<T.length;){if(T[R]!==255||(T[R+1]&246)!==240){typeof de!="number"&&(de=R),R++;continue}if(typeof de=="number"&&(this.skipWarn_(de,R),de=null),j=(~T[R+1]&1)*2,B=(T[R+3]&3)<<11|T[R+4]<<3|(T[R+5]&224)>>5,ae=((T[R+6]&3)+1)*1024,ne=ae*Kd/Gu[(T[R+2]&60)>>>2],T.byteLength-R<B)break;this.trigger("data",{pts:w.pts+b*ne,dts:w.dts+b*ne,sampleCount:ae,audioobjecttype:(T[R+2]>>>6&3)+1,channelcount:(T[R+2]&1)<<2|(T[R+3]&192)>>>6,samplerate:Gu[(T[R+2]&60)>>>2],samplingfrequencyindex:(T[R+2]&60)>>>2,samplesize:16,data:T.subarray(R+7+j,R+B)}),b++,R+=B}typeof de=="number"&&(this.skipWarn_(de,R),de=null),T=T.subarray(R)}},this.flush=function(){b=0,this.trigger("done")},this.reset=function(){T=void 0,this.trigger("reset")},this.endTimeline=function(){T=void 0,this.trigger("endedtimeline")}},Vs.prototype=new s;var zu=Vs,Wu;Wu=function(y){var T=y.byteLength,b=0,w=0;this.length=function(){return 8*T},this.bitsAvailable=function(){return 8*T+w},this.loadWord=function(){var R=y.byteLength-T,B=new Uint8Array(4),j=Math.min(4,T);if(j===0)throw new Error("no bytes available");B.set(y.subarray(R,R+j)),b=new DataView(B.buffer).getUint32(0),w=j*8,T-=j},this.skipBits=function(R){var B;w>R?(b<<=R,w-=R):(R-=w,B=Math.floor(R/8),R-=B*8,T-=B,this.loadWord(),b<<=R,w-=R)},this.readBits=function(R){var B=Math.min(w,R),j=b>>>32-B;return w-=B,w>0?b<<=B:T>0&&this.loadWord(),B=R-B,B>0?j<<B|this.readBits(B):j},this.skipLeadingZeros=function(){var R;for(R=0;R<w;++R)if((b&2147483648>>>R)!==0)return b<<=R,w-=R,R;return this.loadWord(),R+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var R=this.skipLeadingZeros();return this.readBits(R+1)-1},this.readExpGolomb=function(){var R=this.readUnsignedExpGolomb();return 1&R?1+R>>>1:-1*(R>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var Zd=Wu,Gs,zs,ju;zs=function(){var y=0,T,b;zs.prototype.init.call(this),this.push=function(w){var R;b?(R=new Uint8Array(b.byteLength+w.data.byteLength),R.set(b),R.set(w.data,b.byteLength),b=R):b=w.data;for(var B=b.byteLength;y<B-3;y++)if(b[y+2]===1){T=y+5;break}for(;T<B;)switch(b[T]){case 0:if(b[T-1]!==0){T+=2;break}else if(b[T-2]!==0){T++;break}y+3!==T-2&&this.trigger("data",b.subarray(y+3,T-2));do T++;while(b[T]!==1&&T<B);y=T-2,T+=3;break;case 1:if(b[T-1]!==0||b[T-2]!==0){T+=3;break}this.trigger("data",b.subarray(y+3,T-2)),y=T-2,T+=3;break;default:T+=3;break}b=b.subarray(y),T-=y,y=0},this.reset=function(){b=null,y=0,this.trigger("reset")},this.flush=function(){b&&b.byteLength>3&&this.trigger("data",b.subarray(y+3)),b=null,y=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},zs.prototype=new s,ju={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Gs=function(){var y=new zs,T,b,w,R,B,j,Z;Gs.prototype.init.call(this),T=this,this.push=function(ae){ae.type==="video"&&(b=ae.trackId,w=ae.pts,R=ae.dts,y.push(ae))},y.on("data",function(ae){var ne={trackId:b,pts:w,dts:R,data:ae,nalUnitTypeCode:ae[0]&31};switch(ne.nalUnitTypeCode){case 5:ne.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:ne.nalUnitType="sei_rbsp",ne.escapedRBSP=B(ae.subarray(1));break;case 7:ne.nalUnitType="seq_parameter_set_rbsp",ne.escapedRBSP=B(ae.subarray(1)),ne.config=j(ne.escapedRBSP);break;case 8:ne.nalUnitType="pic_parameter_set_rbsp";break;case 9:ne.nalUnitType="access_unit_delimiter_rbsp";break}T.trigger("data",ne)}),y.on("done",function(){T.trigger("done")}),y.on("partialdone",function(){T.trigger("partialdone")}),y.on("reset",function(){T.trigger("reset")}),y.on("endedtimeline",function(){T.trigger("endedtimeline")}),this.flush=function(){y.flush()},this.partialFlush=function(){y.partialFlush()},this.reset=function(){y.reset()},this.endTimeline=function(){y.endTimeline()},Z=function(ne,de){var Pe=8,tt=8,ft,Ke;for(ft=0;ft<ne;ft++)tt!==0&&(Ke=de.readExpGolomb(),tt=(Pe+Ke+256)%256),Pe=tt===0?Pe:tt},B=function(ne){for(var de=ne.byteLength,Pe=[],tt=1,ft,Ke;tt<de-2;)ne[tt]===0&&ne[tt+1]===0&&ne[tt+2]===3?(Pe.push(tt+2),tt+=2):tt++;if(Pe.length===0)return ne;ft=de-Pe.length,Ke=new Uint8Array(ft);var Pt=0;for(tt=0;tt<ft;Pt++,tt++)Pt===Pe[0]&&(Pt++,Pe.shift()),Ke[tt]=ne[Pt];return Ke},j=function(ne){var de=0,Pe=0,tt=0,ft=0,Ke,Pt,Ui,gt,mr,Tl,ec,tr,Ln,Hn,eo,ci=[1,1],oa,In;if(Ke=new Zd(ne),Pt=Ke.readUnsignedByte(),gt=Ke.readUnsignedByte(),Ui=Ke.readUnsignedByte(),Ke.skipUnsignedExpGolomb(),ju[Pt]&&(mr=Ke.readUnsignedExpGolomb(),mr===3&&Ke.skipBits(1),Ke.skipUnsignedExpGolomb(),Ke.skipUnsignedExpGolomb(),Ke.skipBits(1),Ke.readBoolean()))for(eo=mr!==3?8:12,In=0;In<eo;In++)Ke.readBoolean()&&(In<6?Z(16,Ke):Z(64,Ke));if(Ke.skipUnsignedExpGolomb(),Tl=Ke.readUnsignedExpGolomb(),Tl===0)Ke.readUnsignedExpGolomb();else if(Tl===1)for(Ke.skipBits(1),Ke.skipExpGolomb(),Ke.skipExpGolomb(),ec=Ke.readUnsignedExpGolomb(),In=0;In<ec;In++)Ke.skipExpGolomb();if(Ke.skipUnsignedExpGolomb(),Ke.skipBits(1),tr=Ke.readUnsignedExpGolomb(),Ln=Ke.readUnsignedExpGolomb(),Hn=Ke.readBits(1),Hn===0&&Ke.skipBits(1),Ke.skipBits(1),Ke.readBoolean()&&(de=Ke.readUnsignedExpGolomb(),Pe=Ke.readUnsignedExpGolomb(),tt=Ke.readUnsignedExpGolomb(),ft=Ke.readUnsignedExpGolomb()),Ke.readBoolean()&&Ke.readBoolean()){switch(oa=Ke.readUnsignedByte(),oa){case 1:ci=[1,1];break;case 2:ci=[12,11];break;case 3:ci=[10,11];break;case 4:ci=[16,11];break;case 5:ci=[40,33];break;case 6:ci=[24,11];break;case 7:ci=[20,11];break;case 8:ci=[32,11];break;case 9:ci=[80,33];break;case 10:ci=[18,11];break;case 11:ci=[15,11];break;case 12:ci=[64,33];break;case 13:ci=[160,99];break;case 14:ci=[4,3];break;case 15:ci=[3,2];break;case 16:ci=[2,1];break;case 255:{ci=[Ke.readUnsignedByte()<<8|Ke.readUnsignedByte(),Ke.readUnsignedByte()<<8|Ke.readUnsignedByte()];break}}ci&&ci[0]/ci[1]}return{profileIdc:Pt,levelIdc:Ui,profileCompatibility:gt,width:(tr+1)*16-de*2-Pe*2,height:(2-Hn)*(Ln+1)*16-tt*2-ft*2,sarRatio:ci}}},Gs.prototype=new s;var $d={H264Stream:Gs},Jd=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],qu=function(y,T){var b=y[T+6]<<21|y[T+7]<<14|y[T+8]<<7|y[T+9],w=y[T+5],R=(w&16)>>4;return b=b>=0?b:0,R?b+20:b+10},eh=function H(y,T){return y.length-T<10||y[T]!==73||y[T+1]!==68||y[T+2]!==51?T:(T+=qu(y,T),H(y,T))},th=function(y){var T=eh(y,0);return y.length>=T+2&&(y[T]&255)===255&&(y[T+1]&240)===240&&(y[T+1]&22)===16},Xu=function(y){return y[0]<<21|y[1]<<14|y[2]<<7|y[3]},ih=function(y,T,b){var w,R="";for(w=T;w<b;w++)R+="%"+("00"+y[w].toString(16)).slice(-2);return R},nh=function(y,T,b){return unescape(ih(y,T,b))},rh=function(y,T){var b=(y[T+5]&224)>>5,w=y[T+4]<<3,R=y[T+3]&6144;return R|w|b},ah=function(y,T){return y[T]===73&&y[T+1]===68&&y[T+2]===51?"timed-metadata":y[T]&!0&&(y[T+1]&240)===240?"audio":null},sh=function(y){for(var T=0;T+5<y.length;){if(y[T]!==255||(y[T+1]&246)!==240){T++;continue}return Jd[(y[T+2]&60)>>>2]}return null},oh=function(y){var T,b,w,R;T=10,y[5]&64&&(T+=4,T+=Xu(y.subarray(10,14)));do{if(b=Xu(y.subarray(T+4,T+8)),b<1)return null;if(R=String.fromCharCode(y[T],y[T+1],y[T+2],y[T+3]),R==="PRIV"){w=y.subarray(T+10,T+b+10);for(var B=0;B<w.byteLength;B++)if(w[B]===0){var j=nh(w,0,B);if(j==="com.apple.streaming.transportStreamTimestamp"){var Z=w.subarray(B+1),ae=(Z[3]&1)<<30|Z[4]<<22|Z[5]<<14|Z[6]<<6|Z[7]>>>2;return ae*=4,ae+=Z[7]&3,ae}break}}T+=10,T+=b}while(T<y.byteLength);return null},Ws={isLikelyAacData:th,parseId3TagSize:qu,parseAdtsSize:rh,parseType:ah,parseSampleRate:sh,parseAacTimestamp:oh},js;js=function(){var y=new Uint8Array,T=0;js.prototype.init.call(this),this.setTimestamp=function(b){T=b},this.push=function(b){var w=0,R=0,B,j,Z,ae;for(y.length?(ae=y.length,y=new Uint8Array(b.byteLength+ae),y.set(y.subarray(0,ae)),y.set(b,ae)):y=b;y.length-R>=3;){if(y[R]===73&&y[R+1]===68&&y[R+2]===51){if(y.length-R<10||(w=Ws.parseId3TagSize(y,R),R+w>y.length))break;j={type:"timed-metadata",data:y.subarray(R,R+w)},this.trigger("data",j),R+=w;continue}else if((y[R]&255)===255&&(y[R+1]&240)===240){if(y.length-R<7||(w=Ws.parseAdtsSize(y,R),R+w>y.length))break;Z={type:"audio",data:y.subarray(R,R+w),pts:T,dts:T},this.trigger("data",Z),R+=w;continue}R++}B=y.length-R,B>0?y=y.subarray(R):y=new Uint8Array},this.reset=function(){y=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){y=new Uint8Array,this.trigger("endedtimeline")}},js.prototype=new s;var lh=js,uh=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Qu=uh,ch=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Yu=ch,dh=$d.H264Stream,hh=Ws.isLikelyAacData,fh=ai.ONE_SECOND_IN_TS,ta,Lr,Ra,Cn,Oa=function(y,T){T.stream=y,this.trigger("log",T)},os=function(y,T){for(var b=Object.keys(T),w=0;w<b.length;w++){var R=b[w];R==="headOfPipeline"||!T[R].on||T[R].on("log",Oa.bind(y,R))}},qs=function(y,T){var b;if(y.length!==T.length)return!1;for(b=0;b<y.length;b++)if(y[b]!==T[b])return!1;return!0},vl=function(y,T,b,w,R,B){var j=b-T,Z=w-T,ae=R-b;return{start:{dts:y,pts:y+j},end:{dts:y+Z,pts:y+ae},prependedContentDuration:B,baseMediaDecodeTime:y}};Lr=function(y,T){var b=[],w,R=0,B=0,j=1/0;T=T||{},w=T.firstSequenceNumber||0,Lr.prototype.init.call(this),this.push=function(Z){Ai.collectDtsInfo(y,Z),y&&Qu.forEach(function(ae){y[ae]=Z[ae]}),b.push(Z)},this.setEarliestDts=function(Z){R=Z},this.setVideoBaseMediaDecodeTime=function(Z){j=Z},this.setAudioAppendStart=function(Z){B=Z},this.flush=function(){var Z,ae,ne,de,Pe,tt,ft;if(b.length===0){this.trigger("done","AudioSegmentStream");return}Z=ns.trimAdtsFramesByEarliestDts(b,y,R),y.baseMediaDecodeTime=Ai.calculateTrackBaseMediaDecodeTime(y,T.keepOriginalTimestamps),ft=ns.prefixWithSilence(y,Z,B,j),y.samples=ns.generateSampleTable(Z),ne=Zn.mdat(ns.concatenateFrameData(Z)),b=[],ae=Zn.moof(w,[y]),de=new Uint8Array(ae.byteLength+ne.byteLength),w++,de.set(ae),de.set(ne,ae.byteLength),Ai.clearDtsInfo(y),Pe=Math.ceil(fh*1024/y.samplerate),Z.length&&(tt=Z.length*Pe,this.trigger("segmentTimingInfo",vl(ai.audioTsToVideoTs(y.baseMediaDecodeTime,y.samplerate),Z[0].dts,Z[0].pts,Z[0].dts+tt,Z[0].pts+tt,ft||0)),this.trigger("timingInfo",{start:Z[0].pts,end:Z[0].pts+tt})),this.trigger("data",{track:y,boxes:de}),this.trigger("done","AudioSegmentStream")},this.reset=function(){Ai.clearDtsInfo(y),b=[],this.trigger("reset")}},Lr.prototype=new s,ta=function(y,T){var b,w=[],R=[],B,j;T=T||{},b=T.firstSequenceNumber||0,ta.prototype.init.call(this),delete y.minPTS,this.gopCache_=[],this.push=function(Z){Ai.collectDtsInfo(y,Z),Z.nalUnitType==="seq_parameter_set_rbsp"&&!B&&(B=Z.config,y.sps=[Z.data],Yu.forEach(function(ae){y[ae]=B[ae]},this)),Z.nalUnitType==="pic_parameter_set_rbsp"&&!j&&(j=Z.data,y.pps=[Z.data]),w.push(Z)},this.flush=function(){for(var Z,ae,ne,de,Pe,tt,ft=0,Ke,Pt;w.length&&w[0].nalUnitType!=="access_unit_delimiter_rbsp";)w.shift();if(w.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(Z=is.groupNalsIntoFrames(w),ne=is.groupFramesIntoGops(Z),ne[0][0].keyFrame||(ae=this.getGopForFusion_(w[0],y),ae?(ft=ae.duration,ne.unshift(ae),ne.byteLength+=ae.byteLength,ne.nalCount+=ae.nalCount,ne.pts=ae.pts,ne.dts=ae.dts,ne.duration+=ae.duration):ne=is.extendFirstKeyFrame(ne)),R.length){var Ui;if(T.alignGopsAtEnd?Ui=this.alignGopsAtEnd_(ne):Ui=this.alignGopsAtStart_(ne),!Ui){this.gopCache_.unshift({gop:ne.pop(),pps:y.pps,sps:y.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),w=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}Ai.clearDtsInfo(y),ne=Ui}Ai.collectDtsInfo(y,ne),y.samples=is.generateSampleTable(ne),Pe=Zn.mdat(is.concatenateNalData(ne)),y.baseMediaDecodeTime=Ai.calculateTrackBaseMediaDecodeTime(y,T.keepOriginalTimestamps),this.trigger("processedGopsInfo",ne.map(function(gt){return{pts:gt.pts,dts:gt.dts,byteLength:gt.byteLength}})),Ke=ne[0],Pt=ne[ne.length-1],this.trigger("segmentTimingInfo",vl(y.baseMediaDecodeTime,Ke.dts,Ke.pts,Pt.dts+Pt.duration,Pt.pts+Pt.duration,ft)),this.trigger("timingInfo",{start:ne[0].pts,end:ne[ne.length-1].pts+ne[ne.length-1].duration}),this.gopCache_.unshift({gop:ne.pop(),pps:y.pps,sps:y.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),w=[],this.trigger("baseMediaDecodeTime",y.baseMediaDecodeTime),this.trigger("timelineStartInfo",y.timelineStartInfo),de=Zn.moof(b,[y]),tt=new Uint8Array(de.byteLength+Pe.byteLength),b++,tt.set(de),tt.set(Pe,de.byteLength),this.trigger("data",{track:y,boxes:tt}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),w=[],this.gopCache_.length=0,R.length=0,this.trigger("reset")},this.resetStream_=function(){Ai.clearDtsInfo(y),B=void 0,j=void 0},this.getGopForFusion_=function(Z){var ae=45e3,ne=1/0,de,Pe,tt,ft,Ke;for(Ke=0;Ke<this.gopCache_.length;Ke++)ft=this.gopCache_[Ke],tt=ft.gop,!(!(y.pps&&qs(y.pps[0],ft.pps[0]))||!(y.sps&&qs(y.sps[0],ft.sps[0])))&&(tt.dts<y.timelineStartInfo.dts||(de=Z.dts-tt.dts-tt.duration,de>=-1e4&&de<=ae&&(!Pe||ne>de)&&(Pe=ft,ne=de)));return Pe?Pe.gop:null},this.alignGopsAtStart_=function(Z){var ae,ne,de,Pe,tt,ft,Ke,Pt;for(tt=Z.byteLength,ft=Z.nalCount,Ke=Z.duration,ae=ne=0;ae<R.length&&ne<Z.length&&(de=R[ae],Pe=Z[ne],de.pts!==Pe.pts);){if(Pe.pts>de.pts){ae++;continue}ne++,tt-=Pe.byteLength,ft-=Pe.nalCount,Ke-=Pe.duration}return ne===0?Z:ne===Z.length?null:(Pt=Z.slice(ne),Pt.byteLength=tt,Pt.duration=Ke,Pt.nalCount=ft,Pt.pts=Pt[0].pts,Pt.dts=Pt[0].dts,Pt)},this.alignGopsAtEnd_=function(Z){var ae,ne,de,Pe,tt,ft;for(ae=R.length-1,ne=Z.length-1,tt=null,ft=!1;ae>=0&&ne>=0;){if(de=R[ae],Pe=Z[ne],de.pts===Pe.pts){ft=!0;break}if(de.pts>Pe.pts){ae--;continue}ae===R.length-1&&(tt=ne),ne--}if(!ft&&tt===null)return null;var Ke;if(ft?Ke=ne:Ke=tt,Ke===0)return Z;var Pt=Z.slice(Ke),Ui=Pt.reduce(function(gt,mr){return gt.byteLength+=mr.byteLength,gt.duration+=mr.duration,gt.nalCount+=mr.nalCount,gt},{byteLength:0,duration:0,nalCount:0});return Pt.byteLength=Ui.byteLength,Pt.duration=Ui.duration,Pt.nalCount=Ui.nalCount,Pt.pts=Pt[0].pts,Pt.dts=Pt[0].dts,Pt},this.alignGopsWith=function(Z){R=Z}},ta.prototype=new s,Cn=function(y,T){this.numberOfTracks=0,this.metadataStream=T,y=y||{},typeof y.remux<"u"?this.remuxTracks=!!y.remux:this.remuxTracks=!0,typeof y.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=y.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Cn.prototype.init.call(this),this.push=function(b){if(b.text)return this.pendingCaptions.push(b);if(b.frames)return this.pendingMetadata.push(b);this.pendingTracks.push(b.track),this.pendingBytes+=b.boxes.byteLength,b.track.type==="video"&&(this.videoTrack=b.track,this.pendingBoxes.push(b.boxes)),b.track.type==="audio"&&(this.audioTrack=b.track,this.pendingBoxes.unshift(b.boxes))}},Cn.prototype=new s,Cn.prototype.flush=function(H){var y=0,T={captions:[],captionStreams:{},metadata:[],info:{}},b,w,R,B=0,j;if(this.pendingTracks.length<this.numberOfTracks){if(H!=="VideoSegmentStream"&&H!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(B=this.videoTrack.timelineStartInfo.pts,Yu.forEach(function(Z){T.info[Z]=this.videoTrack[Z]},this)):this.audioTrack&&(B=this.audioTrack.timelineStartInfo.pts,Qu.forEach(function(Z){T.info[Z]=this.audioTrack[Z]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?T.type=this.pendingTracks[0].type:T.type="combined",this.emittedTracks+=this.pendingTracks.length,R=Zn.initSegment(this.pendingTracks),T.initSegment=new Uint8Array(R.byteLength),T.initSegment.set(R),T.data=new Uint8Array(this.pendingBytes),j=0;j<this.pendingBoxes.length;j++)T.data.set(this.pendingBoxes[j],y),y+=this.pendingBoxes[j].byteLength;for(j=0;j<this.pendingCaptions.length;j++)b=this.pendingCaptions[j],b.startTime=ai.metadataTsToSeconds(b.startPts,B,this.keepOriginalTimestamps),b.endTime=ai.metadataTsToSeconds(b.endPts,B,this.keepOriginalTimestamps),T.captionStreams[b.stream]=!0,T.captions.push(b);for(j=0;j<this.pendingMetadata.length;j++)w=this.pendingMetadata[j],w.cueTime=ai.metadataTsToSeconds(w.pts,B,this.keepOriginalTimestamps),T.metadata.push(w);for(T.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",T),j=0;j<T.captions.length;j++)b=T.captions[j],this.trigger("caption",b);for(j=0;j<T.metadata.length;j++)w=T.metadata[j],this.trigger("id3Frame",w)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Cn.prototype.setRemux=function(H){this.remuxTracks=H},Ra=function(y){var T=this,b=!0,w,R;Ra.prototype.init.call(this),y=y||{},this.baseMediaDecodeTime=y.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var B={};this.transmuxPipeline_=B,B.type="aac",B.metadataStream=new hr.MetadataStream,B.aacStream=new lh,B.audioTimestampRolloverStream=new hr.TimestampRolloverStream("audio"),B.timedMetadataTimestampRolloverStream=new hr.TimestampRolloverStream("timed-metadata"),B.adtsStream=new zu,B.coalesceStream=new Cn(y,B.metadataStream),B.headOfPipeline=B.aacStream,B.aacStream.pipe(B.audioTimestampRolloverStream).pipe(B.adtsStream),B.aacStream.pipe(B.timedMetadataTimestampRolloverStream).pipe(B.metadataStream).pipe(B.coalesceStream),B.metadataStream.on("timestamp",function(j){B.aacStream.setTimestamp(j.timeStamp)}),B.aacStream.on("data",function(j){j.type!=="timed-metadata"&&j.type!=="audio"||B.audioSegmentStream||(R=R||{timelineStartInfo:{baseMediaDecodeTime:T.baseMediaDecodeTime},codec:"adts",type:"audio"},B.coalesceStream.numberOfTracks++,B.audioSegmentStream=new Lr(R,y),B.audioSegmentStream.on("log",T.getLogTrigger_("audioSegmentStream")),B.audioSegmentStream.on("timingInfo",T.trigger.bind(T,"audioTimingInfo")),B.adtsStream.pipe(B.audioSegmentStream).pipe(B.coalesceStream),T.trigger("trackinfo",{hasAudio:!!R,hasVideo:!!w}))}),B.coalesceStream.on("data",this.trigger.bind(this,"data")),B.coalesceStream.on("done",this.trigger.bind(this,"done")),os(this,B)},this.setupTsPipeline=function(){var B={};this.transmuxPipeline_=B,B.type="ts",B.metadataStream=new hr.MetadataStream,B.packetStream=new hr.TransportPacketStream,B.parseStream=new hr.TransportParseStream,B.elementaryStream=new hr.ElementaryStream,B.timestampRolloverStream=new hr.TimestampRolloverStream,B.adtsStream=new zu,B.h264Stream=new dh,B.captionStream=new hr.CaptionStream(y),B.coalesceStream=new Cn(y,B.metadataStream),B.headOfPipeline=B.packetStream,B.packetStream.pipe(B.parseStream).pipe(B.elementaryStream).pipe(B.timestampRolloverStream),B.timestampRolloverStream.pipe(B.h264Stream),B.timestampRolloverStream.pipe(B.adtsStream),B.timestampRolloverStream.pipe(B.metadataStream).pipe(B.coalesceStream),B.h264Stream.pipe(B.captionStream).pipe(B.coalesceStream),B.elementaryStream.on("data",function(j){var Z;if(j.type==="metadata"){for(Z=j.tracks.length;Z--;)!w&&j.tracks[Z].type==="video"?(w=j.tracks[Z],w.timelineStartInfo.baseMediaDecodeTime=T.baseMediaDecodeTime):!R&&j.tracks[Z].type==="audio"&&(R=j.tracks[Z],R.timelineStartInfo.baseMediaDecodeTime=T.baseMediaDecodeTime);w&&!B.videoSegmentStream&&(B.coalesceStream.numberOfTracks++,B.videoSegmentStream=new ta(w,y),B.videoSegmentStream.on("log",T.getLogTrigger_("videoSegmentStream")),B.videoSegmentStream.on("timelineStartInfo",function(ae){R&&!y.keepOriginalTimestamps&&(R.timelineStartInfo=ae,B.audioSegmentStream.setEarliestDts(ae.dts-T.baseMediaDecodeTime))}),B.videoSegmentStream.on("processedGopsInfo",T.trigger.bind(T,"gopInfo")),B.videoSegmentStream.on("segmentTimingInfo",T.trigger.bind(T,"videoSegmentTimingInfo")),B.videoSegmentStream.on("baseMediaDecodeTime",function(ae){R&&B.audioSegmentStream.setVideoBaseMediaDecodeTime(ae)}),B.videoSegmentStream.on("timingInfo",T.trigger.bind(T,"videoTimingInfo")),B.h264Stream.pipe(B.videoSegmentStream).pipe(B.coalesceStream)),R&&!B.audioSegmentStream&&(B.coalesceStream.numberOfTracks++,B.audioSegmentStream=new Lr(R,y),B.audioSegmentStream.on("log",T.getLogTrigger_("audioSegmentStream")),B.audioSegmentStream.on("timingInfo",T.trigger.bind(T,"audioTimingInfo")),B.audioSegmentStream.on("segmentTimingInfo",T.trigger.bind(T,"audioSegmentTimingInfo")),B.adtsStream.pipe(B.audioSegmentStream).pipe(B.coalesceStream)),T.trigger("trackinfo",{hasAudio:!!R,hasVideo:!!w})}}),B.coalesceStream.on("data",this.trigger.bind(this,"data")),B.coalesceStream.on("id3Frame",function(j){j.dispatchType=B.metadataStream.dispatchType,T.trigger("id3Frame",j)}),B.coalesceStream.on("caption",this.trigger.bind(this,"caption")),B.coalesceStream.on("done",this.trigger.bind(this,"done")),os(this,B)},this.setBaseMediaDecodeTime=function(B){var j=this.transmuxPipeline_;y.keepOriginalTimestamps||(this.baseMediaDecodeTime=B),R&&(R.timelineStartInfo.dts=void 0,R.timelineStartInfo.pts=void 0,Ai.clearDtsInfo(R),j.audioTimestampRolloverStream&&j.audioTimestampRolloverStream.discontinuity()),w&&(j.videoSegmentStream&&(j.videoSegmentStream.gopCache_=[]),w.timelineStartInfo.dts=void 0,w.timelineStartInfo.pts=void 0,Ai.clearDtsInfo(w),j.captionStream.reset()),j.timestampRolloverStream&&j.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(B){R&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(B)},this.setRemux=function(B){var j=this.transmuxPipeline_;y.remux=B,j&&j.coalesceStream&&j.coalesceStream.setRemux(B)},this.alignGopsWith=function(B){w&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(B)},this.getLogTrigger_=function(B){var j=this;return function(Z){Z.stream=B,j.trigger("log",Z)}},this.push=function(B){if(b){var j=hh(B);j&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!j&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),b=!1}this.transmuxPipeline_.headOfPipeline.push(B)},this.flush=function(){b=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Ra.prototype=new s;var ph={Transmuxer:Ra},ls=function(y){return y>>>0},Ku=function(y){return("00"+y.toString(16)).slice(-2)},Xs={toUnsigned:ls,toHexString:Ku},mh=function(y){var T="";return T+=String.fromCharCode(y[0]),T+=String.fromCharCode(y[1]),T+=String.fromCharCode(y[2]),T+=String.fromCharCode(y[3]),T},ia=mh,gh=Xs.toUnsigned,vh=function H(y,T){var b=[],w,R,B,j,Z;if(!T.length)return null;for(w=0;w<y.byteLength;)R=gh(y[w]<<24|y[w+1]<<16|y[w+2]<<8|y[w+3]),B=ia(y.subarray(w+4,w+8)),j=R>1?w+R:y.byteLength,B===T[0]&&(T.length===1?b.push(y.subarray(w+8,j)):(Z=H(y.subarray(w+8,j),T.slice(1)),Z.length&&(b=b.concat(Z)))),w=j;return b},yi=vh,yh=Xs.toUnsigned,_h=e.getUint64,Fa=function(y){var T={version:y[0],flags:new Uint8Array(y.subarray(1,4))};return T.version===1?T.baseMediaDecodeTime=_h(y.subarray(4)):T.baseMediaDecodeTime=yh(y[4]<<24|y[5]<<16|y[6]<<8|y[7]),T},Zu=Fa,yl=function(y){return{isLeading:(y[0]&12)>>>2,dependsOn:y[0]&3,isDependedOn:(y[1]&192)>>>6,hasRedundancy:(y[1]&48)>>>4,paddingValue:(y[1]&14)>>>1,isNonSyncSample:y[1]&1,degradationPriority:y[2]<<8|y[3]}},$u=yl,Qs=function(y){var T={version:y[0],flags:new Uint8Array(y.subarray(1,4)),samples:[]},b=new DataView(y.buffer,y.byteOffset,y.byteLength),w=T.flags[2]&1,R=T.flags[2]&4,B=T.flags[1]&1,j=T.flags[1]&2,Z=T.flags[1]&4,ae=T.flags[1]&8,ne=b.getUint32(4),de=8,Pe;for(w&&(T.dataOffset=b.getInt32(de),de+=4),R&&ne&&(Pe={flags:$u(y.subarray(de,de+4))},de+=4,B&&(Pe.duration=b.getUint32(de),de+=4),j&&(Pe.size=b.getUint32(de),de+=4),ae&&(T.version===1?Pe.compositionTimeOffset=b.getInt32(de):Pe.compositionTimeOffset=b.getUint32(de),de+=4),T.samples.push(Pe),ne--);ne--;)Pe={},B&&(Pe.duration=b.getUint32(de),de+=4),j&&(Pe.size=b.getUint32(de),de+=4),Z&&(Pe.flags=$u(y.subarray(de,de+4)),de+=4),ae&&(T.version===1?Pe.compositionTimeOffset=b.getInt32(de):Pe.compositionTimeOffset=b.getUint32(de),de+=4),T.samples.push(Pe);return T},ka=Qs,Ju=function(y){var T=new DataView(y.buffer,y.byteOffset,y.byteLength),b={version:y[0],flags:new Uint8Array(y.subarray(1,4)),trackId:T.getUint32(4)},w=b.flags[2]&1,R=b.flags[2]&2,B=b.flags[2]&8,j=b.flags[2]&16,Z=b.flags[2]&32,ae=b.flags[0]&65536,ne=b.flags[0]&131072,de;return de=8,w&&(de+=4,b.baseDataOffset=T.getUint32(12),de+=4),R&&(b.sampleDescriptionIndex=T.getUint32(de),de+=4),B&&(b.defaultSampleDuration=T.getUint32(de),de+=4),j&&(b.defaultSampleSize=T.getUint32(de),de+=4),Z&&(b.defaultSampleFlags=T.getUint32(de)),ae&&(b.durationIsEmpty=!0),!w&&ne&&(b.baseDataOffsetIsMoof=!0),b},$n=Ju,Xi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ir;typeof window<"u"?Ir=window:typeof Xi<"u"?Ir=Xi:typeof self<"u"?Ir=self:Ir={};var At=Ir,be=Pr.discardEmulationPreventionBytes,Ji=Bn.CaptionStream,Ba=function(y,T){for(var b=y,w=0;w<T.length;w++){var R=T[w];if(b<R.size)return R;b-=R.size}return null},Na=function(y,T,b){var w=new DataView(y.buffer,y.byteOffset,y.byteLength),R={logs:[],seiNals:[]},B,j,Z,ae;for(j=0;j+4<y.length;j+=Z)if(Z=w.getUint32(j),j+=4,!(Z<=0))switch(y[j]&31){case 6:var ne=y.subarray(j+1,j+1+Z),de=Ba(j,T);if(B={nalUnitType:"sei_rbsp",size:Z,data:ne,escapedRBSP:be(ne),trackId:b},de)B.pts=de.pts,B.dts=de.dts,ae=de;else if(ae)B.pts=ae.pts,B.dts=ae.dts;else{R.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+j+" for trackId "+b+". See mux.js#223."});break}R.seiNals.push(B);break}return R},xh=function(y,T,b){var w=T,R=b.defaultSampleDuration||0,B=b.defaultSampleSize||0,j=b.trackId,Z=[];return y.forEach(function(ae){var ne=ka(ae),de=ne.samples;de.forEach(function(Pe){Pe.duration===void 0&&(Pe.duration=R),Pe.size===void 0&&(Pe.size=B),Pe.trackId=j,Pe.dts=w,Pe.compositionTimeOffset===void 0&&(Pe.compositionTimeOffset=0),typeof w=="bigint"?(Pe.pts=w+At.BigInt(Pe.compositionTimeOffset),w+=At.BigInt(Pe.duration)):(Pe.pts=w+Pe.compositionTimeOffset,w+=Pe.duration)}),Z=Z.concat(de)}),Z},gi=function(y,T){var b=yi(y,["moof","traf"]),w=yi(y,["mdat"]),R={},B=[];return w.forEach(function(j,Z){var ae=b[Z];B.push({mdat:j,traf:ae})}),B.forEach(function(j){var Z=j.mdat,ae=j.traf,ne=yi(ae,["tfhd"]),de=$n(ne[0]),Pe=de.trackId,tt=yi(ae,["tfdt"]),ft=tt.length>0?Zu(tt[0]).baseMediaDecodeTime:0,Ke=yi(ae,["trun"]),Pt,Ui;T===Pe&&Ke.length>0&&(Pt=xh(Ke,ft,de),Ui=Na(Z,Pt,Pe),R[Pe]||(R[Pe]={seiNals:[],logs:[]}),R[Pe].seiNals=R[Pe].seiNals.concat(Ui.seiNals),R[Pe].logs=R[Pe].logs.concat(Ui.logs))}),R},_l=function(y,T,b){var w;if(T===null)return null;w=gi(y,T);var R=w[T]||{};return{seiNals:R.seiNals,logs:R.logs,timescale:b}},pi=function(){var y=!1,T,b,w,R,B,j;this.isInitialized=function(){return y},this.init=function(Z){T=new Ji,y=!0,j=Z?Z.isPartial:!1,T.on("data",function(ae){ae.startTime=ae.startPts/R,ae.endTime=ae.endPts/R,B.captions.push(ae),B.captionStreams[ae.stream]=!0}),T.on("log",function(ae){B.logs.push(ae)})},this.isNewInit=function(Z,ae){return Z&&Z.length===0||ae&&typeof ae=="object"&&Object.keys(ae).length===0?!1:w!==Z[0]||R!==ae[w]},this.parse=function(Z,ae,ne){var de;if(this.isInitialized()){if(!ae||!ne)return null;if(this.isNewInit(ae,ne))w=ae[0],R=ne[w];else if(w===null||!R)return b.push(Z),null}else return null;for(;b.length>0;){var Pe=b.shift();this.parse(Pe,ae,ne)}return de=_l(Z,w,R),de&&de.logs&&(B.logs=B.logs.concat(de.logs)),de===null||!de.seiNals?B.logs.length?{logs:B.logs,captions:[],captionStreams:[]}:null:(this.pushNals(de.seiNals),this.flushStream(),B)},this.pushNals=function(Z){if(!this.isInitialized()||!Z||Z.length===0)return null;Z.forEach(function(ae){T.push(ae)})},this.flushStream=function(){if(!this.isInitialized())return null;j?T.partialFlush():T.flush()},this.clearParsedCaptions=function(){B.captions=[],B.captionStreams={},B.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;T.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){b=[],w=null,R=null,B?this.clearParsedCaptions():B={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},us=pi,Fi=Xs.toUnsigned,te=Xs.toHexString,xl=e.getUint64,bl,Dr,Ys,Jn,Ua,cs;bl=function(y){var T={},b=yi(y,["moov","trak"]);return b.reduce(function(w,R){var B,j,Z,ae,ne;return B=yi(R,["tkhd"])[0],!B||(j=B[0],Z=j===0?12:20,ae=Fi(B[Z]<<24|B[Z+1]<<16|B[Z+2]<<8|B[Z+3]),ne=yi(R,["mdia","mdhd"])[0],!ne)?null:(j=ne[0],Z=j===0?12:20,w[ae]=Fi(ne[Z]<<24|ne[Z+1]<<16|ne[Z+2]<<8|ne[Z+3]),w)},T)},Dr=function(y,T){var b;b=yi(T,["moof","traf"]);var w=b.reduce(function(R,B){var j=yi(B,["tfhd"])[0],Z=Fi(j[4]<<24|j[5]<<16|j[6]<<8|j[7]),ae=y[Z]||9e4,ne=yi(B,["tfdt"])[0],de=new DataView(ne.buffer,ne.byteOffset,ne.byteLength),Pe;ne[0]===1?Pe=xl(ne.subarray(4,12)):Pe=de.getUint32(4);var tt;return typeof Pe=="bigint"?tt=Pe/At.BigInt(ae):typeof Pe=="number"&&!isNaN(Pe)&&(tt=Pe/ae),tt<Number.MAX_SAFE_INTEGER&&(tt=Number(tt)),tt<R&&(R=tt),R},1/0);return typeof w=="bigint"||isFinite(w)?w:0},Ys=function(y,T){var b=yi(T,["moof","traf"]),w=0,R=0,B;if(b&&b.length){var j=yi(b[0],["tfhd"])[0],Z=yi(b[0],["trun"])[0],ae=yi(b[0],["tfdt"])[0];if(j){var ne=$n(j);B=ne.trackId}if(ae){var de=Zu(ae);w=de.baseMediaDecodeTime}if(Z){var Pe=ka(Z);Pe.samples&&Pe.samples.length&&(R=Pe.samples[0].compositionTimeOffset||0)}}var tt=y[B]||9e4;typeof w=="bigint"&&(R=At.BigInt(R),tt=At.BigInt(tt));var ft=(w+R)/tt;return typeof ft=="bigint"&&ft<Number.MAX_SAFE_INTEGER&&(ft=Number(ft)),ft},Jn=function(y){var T=yi(y,["moov","trak"]),b=[];return T.forEach(function(w){var R=yi(w,["mdia","hdlr"]),B=yi(w,["tkhd"]);R.forEach(function(j,Z){var ae=ia(j.subarray(8,12)),ne=B[Z],de,Pe,tt;ae==="vide"&&(de=new DataView(ne.buffer,ne.byteOffset,ne.byteLength),Pe=de.getUint8(0),tt=Pe===0?de.getUint32(12):de.getUint32(20),b.push(tt))})}),b},cs=function(y){var T=y[0],b=T===0?12:20;return Fi(y[b]<<24|y[b+1]<<16|y[b+2]<<8|y[b+3])},Ua=function(y){var T=yi(y,["moov","trak"]),b=[];return T.forEach(function(w){var R={},B=yi(w,["tkhd"])[0],j,Z;B&&(j=new DataView(B.buffer,B.byteOffset,B.byteLength),Z=j.getUint8(0),R.id=Z===0?j.getUint32(12):j.getUint32(20));var ae=yi(w,["mdia","hdlr"])[0];if(ae){var ne=ia(ae.subarray(8,12));ne==="vide"?R.type="video":ne==="soun"?R.type="audio":R.type=ne}var de=yi(w,["mdia","minf","stbl","stsd"])[0];if(de){var Pe=de.subarray(8);R.codec=ia(Pe.subarray(4,8));var tt=yi(Pe,[R.codec])[0],ft,Ke;tt&&(/^[asm]vc[1-9]$/i.test(R.codec)?(ft=tt.subarray(78),Ke=ia(ft.subarray(4,8)),Ke==="avcC"&&ft.length>11?(R.codec+=".",R.codec+=te(ft[9]),R.codec+=te(ft[10]),R.codec+=te(ft[11])):R.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(R.codec)?(ft=tt.subarray(28),Ke=ia(ft.subarray(4,8)),Ke==="esds"&&ft.length>20&&ft[19]!==0?(R.codec+="."+te(ft[19]),R.codec+="."+te(ft[20]>>>2&63).replace(/^0/,"")):R.codec="mp4a.40.2"):R.codec=R.codec.toLowerCase())}var Pt=yi(w,["mdia","mdhd"])[0];Pt&&(R.timescale=cs(Pt)),b.push(R)}),b};var na={findBox:yi,parseType:ia,timescale:bl,startTime:Dr,compositionStartTime:Ys,videoTrackIds:Jn,tracks:Ua,getTimescaleFromMediaHeader:cs},ra=function(y){var T=y[1]&31;return T<<=8,T|=y[2],T},fr=function(y){return!!(y[1]&64)},Nn=function(y){var T=0;return(y[3]&48)>>>4>1&&(T+=y[4]+1),T},Rr=function(y,T){var b=ra(y);return b===0?"pat":b===T?"pmt":T?"pes":null},aa=function(y){var T=fr(y),b=4+Nn(y);return T&&(b+=y[b]+1),(y[b+10]&31)<<8|y[b+11]},ds=function(y){var T={},b=fr(y),w=4+Nn(y);if(b&&(w+=y[w]+1),!!(y[w+5]&1)){var R,B,j;R=(y[w+1]&15)<<8|y[w+2],B=3+R-4,j=(y[w+10]&15)<<8|y[w+11];for(var Z=12+j;Z<B;){var ae=w+Z;T[(y[ae+1]&31)<<8|y[ae+2]]=y[ae],Z+=((y[ae+3]&15)<<8|y[ae+4])+5}return T}},Ks=function(y,T){var b=ra(y),w=T[b];switch(w){case fi.H264_STREAM_TYPE:return"video";case fi.ADTS_STREAM_TYPE:return"audio";case fi.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Zs=function(y){var T=fr(y);if(!T)return null;var b=4+Nn(y);if(b>=y.byteLength)return null;var w=null,R;return R=y[b+7],R&192&&(w={},w.pts=(y[b+9]&14)<<27|(y[b+10]&255)<<20|(y[b+11]&254)<<12|(y[b+12]&255)<<5|(y[b+13]&254)>>>3,w.pts*=4,w.pts+=(y[b+13]&6)>>>1,w.dts=w.pts,R&64&&(w.dts=(y[b+14]&14)<<27|(y[b+15]&255)<<20|(y[b+16]&254)<<12|(y[b+17]&255)<<5|(y[b+18]&254)>>>3,w.dts*=4,w.dts+=(y[b+18]&6)>>>1)),w},pr=function(y){switch(y){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},bh=function(y){for(var T=4+Nn(y),b=y.subarray(T),w=0,R=0,B=!1,j;R<b.byteLength-3;R++)if(b[R+2]===1){w=R+5;break}for(;w<b.byteLength;)switch(b[w]){case 0:if(b[w-1]!==0){w+=2;break}else if(b[w-2]!==0){w++;break}R+3!==w-2&&(j=pr(b[R+3]&31),j==="slice_layer_without_partitioning_rbsp_idr"&&(B=!0));do w++;while(b[w]!==1&&w<b.length);R=w-2,w+=3;break;case 1:if(b[w-1]!==0||b[w-2]!==0){w+=3;break}j=pr(b[R+3]&31),j==="slice_layer_without_partitioning_rbsp_idr"&&(B=!0),R=w-2,w+=3;break;default:w+=3;break}return b=b.subarray(R),w-=R,R=0,b&&b.byteLength>3&&(j=pr(b[R+3]&31),j==="slice_layer_without_partitioning_rbsp_idr"&&(B=!0)),B},sa={parseType:Rr,parsePat:aa,parsePmt:ds,parsePayloadUnitStartIndicator:fr,parsePesType:Ks,parsePesTime:Zs,videoPacketContainsKeyFrame:bh},dn=Nu.handleRollover,si={};si.ts=sa,si.aac=Ws;var er=ai.ONE_SECOND_IN_TS,Li=188,Pn=71,$s=function(y,T){for(var b=0,w=Li,R,B;w<y.byteLength;){if(y[b]===Pn&&y[w]===Pn){switch(R=y.subarray(b,w),B=si.ts.parseType(R,T.pid),B){case"pat":T.pid=si.ts.parsePat(R);break;case"pmt":var j=si.ts.parsePmt(R);T.table=T.table||{},Object.keys(j).forEach(function(Z){T.table[Z]=j[Z]});break}b+=Li,w+=Li;continue}b++,w++}},Js=function(y,T,b){for(var w=0,R=Li,B,j,Z,ae,ne,de=!1;R<=y.byteLength;){if(y[w]===Pn&&(y[R]===Pn||R===y.byteLength)){switch(B=y.subarray(w,R),j=si.ts.parseType(B,T.pid),j){case"pes":Z=si.ts.parsePesType(B,T.table),ae=si.ts.parsePayloadUnitStartIndicator(B),Z==="audio"&&ae&&(ne=si.ts.parsePesTime(B),ne&&(ne.type="audio",b.audio.push(ne),de=!0));break}if(de)break;w+=Li,R+=Li;continue}w++,R++}for(R=y.byteLength,w=R-Li,de=!1;w>=0;){if(y[w]===Pn&&(y[R]===Pn||R===y.byteLength)){switch(B=y.subarray(w,R),j=si.ts.parseType(B,T.pid),j){case"pes":Z=si.ts.parsePesType(B,T.table),ae=si.ts.parsePayloadUnitStartIndicator(B),Z==="audio"&&ae&&(ne=si.ts.parsePesTime(B),ne&&(ne.type="audio",b.audio.push(ne),de=!0));break}if(de)break;w-=Li,R-=Li;continue}w--,R--}},hs=function(y,T,b){for(var w=0,R=Li,B,j,Z,ae,ne,de,Pe,tt,ft=!1,Ke={data:[],size:0};R<y.byteLength;){if(y[w]===Pn&&y[R]===Pn){switch(B=y.subarray(w,R),j=si.ts.parseType(B,T.pid),j){case"pes":if(Z=si.ts.parsePesType(B,T.table),ae=si.ts.parsePayloadUnitStartIndicator(B),Z==="video"&&(ae&&!ft&&(ne=si.ts.parsePesTime(B),ne&&(ne.type="video",b.video.push(ne),ft=!0)),!b.firstKeyFrame)){if(ae&&Ke.size!==0){for(de=new Uint8Array(Ke.size),Pe=0;Ke.data.length;)tt=Ke.data.shift(),de.set(tt,Pe),Pe+=tt.byteLength;if(si.ts.videoPacketContainsKeyFrame(de)){var Pt=si.ts.parsePesTime(de);Pt?(b.firstKeyFrame=Pt,b.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Ke.size=0}Ke.data.push(B),Ke.size+=B.byteLength}break}if(ft&&b.firstKeyFrame)break;w+=Li,R+=Li;continue}w++,R++}for(R=y.byteLength,w=R-Li,ft=!1;w>=0;){if(y[w]===Pn&&y[R]===Pn){switch(B=y.subarray(w,R),j=si.ts.parseType(B,T.pid),j){case"pes":Z=si.ts.parsePesType(B,T.table),ae=si.ts.parsePayloadUnitStartIndicator(B),Z==="video"&&ae&&(ne=si.ts.parsePesTime(B),ne&&(ne.type="video",b.video.push(ne),ft=!0));break}if(ft)break;w-=Li,R-=Li;continue}w--,R--}},Ut=function(y,T){if(y.audio&&y.audio.length){var b=T;(typeof b>"u"||isNaN(b))&&(b=y.audio[0].dts),y.audio.forEach(function(B){B.dts=dn(B.dts,b),B.pts=dn(B.pts,b),B.dtsTime=B.dts/er,B.ptsTime=B.pts/er})}if(y.video&&y.video.length){var w=T;if((typeof w>"u"||isNaN(w))&&(w=y.video[0].dts),y.video.forEach(function(B){B.dts=dn(B.dts,w),B.pts=dn(B.pts,w),B.dtsTime=B.dts/er,B.ptsTime=B.pts/er}),y.firstKeyFrame){var R=y.firstKeyFrame;R.dts=dn(R.dts,w),R.pts=dn(R.pts,w),R.dtsTime=R.dts/er,R.ptsTime=R.pts/er}}},Ha=function(y){for(var T=!1,b=0,w=null,R=null,B=0,j=0,Z;y.length-j>=3;){var ae=si.aac.parseType(y,j);switch(ae){case"timed-metadata":if(y.length-j<10){T=!0;break}if(B=si.aac.parseId3TagSize(y,j),B>y.length){T=!0;break}R===null&&(Z=y.subarray(j,j+B),R=si.aac.parseAacTimestamp(Z)),j+=B;break;case"audio":if(y.length-j<7){T=!0;break}if(B=si.aac.parseAdtsSize(y,j),B>y.length){T=!0;break}w===null&&(Z=y.subarray(j,j+B),w=si.aac.parseSampleRate(Z)),b++,j+=B;break;default:j++;break}if(T)return null}if(w===null||R===null)return null;var ne=er/w,de={audio:[{type:"audio",dts:R,pts:R},{type:"audio",dts:R+b*1024*ne,pts:R+b*1024*ne}]};return de},Un=function(y){var T={pid:null,table:null},b={};$s(y,T);for(var w in T.table)if(T.table.hasOwnProperty(w)){var R=T.table[w];switch(R){case fi.H264_STREAM_TYPE:b.video=[],hs(y,T,b),b.video.length===0&&delete b.video;break;case fi.ADTS_STREAM_TYPE:b.audio=[],Js(y,T,b),b.audio.length===0&&delete b.audio;break}}return b},Th=function(y,T){var b=si.aac.isLikelyAacData(y),w;return b?w=Ha(y):w=Un(y),!w||!w.audio&&!w.video?null:(Ut(w,T),w)},Ah={inspect:Th,parseAudioPes_:Js},Or=function(y,T){T.on("data",function(b){var w=b.initSegment;b.initSegment={data:w.buffer,byteOffset:w.byteOffset,byteLength:w.byteLength};var R=b.data;b.data=R.buffer,y.postMessage({action:"data",segment:b,byteOffset:R.byteOffset,byteLength:R.byteLength},[b.data])}),T.on("done",function(b){y.postMessage({action:"done"})}),T.on("gopInfo",function(b){y.postMessage({action:"gopInfo",gopInfo:b})}),T.on("videoSegmentTimingInfo",function(b){var w={start:{decode:ai.videoTsToSeconds(b.start.dts),presentation:ai.videoTsToSeconds(b.start.pts)},end:{decode:ai.videoTsToSeconds(b.end.dts),presentation:ai.videoTsToSeconds(b.end.pts)},baseMediaDecodeTime:ai.videoTsToSeconds(b.baseMediaDecodeTime)};b.prependedContentDuration&&(w.prependedContentDuration=ai.videoTsToSeconds(b.prependedContentDuration)),y.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:w})}),T.on("audioSegmentTimingInfo",function(b){var w={start:{decode:ai.videoTsToSeconds(b.start.dts),presentation:ai.videoTsToSeconds(b.start.pts)},end:{decode:ai.videoTsToSeconds(b.end.dts),presentation:ai.videoTsToSeconds(b.end.pts)},baseMediaDecodeTime:ai.videoTsToSeconds(b.baseMediaDecodeTime)};b.prependedContentDuration&&(w.prependedContentDuration=ai.videoTsToSeconds(b.prependedContentDuration)),y.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:w})}),T.on("id3Frame",function(b){y.postMessage({action:"id3Frame",id3Frame:b})}),T.on("caption",function(b){y.postMessage({action:"caption",caption:b})}),T.on("trackinfo",function(b){y.postMessage({action:"trackinfo",trackInfo:b})}),T.on("audioTimingInfo",function(b){y.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:ai.videoTsToSeconds(b.start),end:ai.videoTsToSeconds(b.end)}})}),T.on("videoTimingInfo",function(b){y.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:ai.videoTsToSeconds(b.start),end:ai.videoTsToSeconds(b.end)}})}),T.on("log",function(b){y.postMessage({action:"log",log:b})})},fs=function(){function H(T,b){this.options=b||{},this.self=T,this.init()}var y=H.prototype;return y.init=function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new ph.Transmuxer(this.options),Or(this.self,this.transmuxer)},y.pushMp4Captions=function(b){this.captionParser||(this.captionParser=new us,this.captionParser.init());var w=new Uint8Array(b.data,b.byteOffset,b.byteLength),R=this.captionParser.parse(w,b.trackIds,b.timescales);this.self.postMessage({action:"mp4Captions",captions:R&&R.captions||[],logs:R&&R.logs||[],data:w.buffer},[w.buffer])},y.probeMp4StartTime=function(b){var w=b.timescales,R=b.data,B=na.startTime(w,R);this.self.postMessage({action:"probeMp4StartTime",startTime:B,data:R},[R.buffer])},y.probeMp4Tracks=function(b){var w=b.data,R=na.tracks(w);this.self.postMessage({action:"probeMp4Tracks",tracks:R,data:w},[w.buffer])},y.probeTs=function(b){var w=b.data,R=b.baseStartTime,B=typeof R=="number"&&!isNaN(R)?R*ai.ONE_SECOND_IN_TS:void 0,j=Ah.inspect(w,B),Z=null;j&&(Z={hasVideo:j.video&&j.video.length===2||!1,hasAudio:j.audio&&j.audio.length===2||!1},Z.hasVideo&&(Z.videoStart=j.video[0].ptsTime),Z.hasAudio&&(Z.audioStart=j.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:Z,data:w},[w.buffer])},y.clearAllMp4Captions=function(){this.captionParser&&this.captionParser.clearAllCaptions()},y.clearParsedMp4Captions=function(){this.captionParser&&this.captionParser.clearParsedCaptions()},y.push=function(b){var w=new Uint8Array(b.data,b.byteOffset,b.byteLength);this.transmuxer.push(w)},y.reset=function(){this.transmuxer.reset()},y.setTimestampOffset=function(b){var w=b.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(ai.secondsToVideoTs(w)))},y.setAudioAppendStart=function(b){this.transmuxer.setAudioAppendStart(Math.ceil(ai.secondsToVideoTs(b.appendStart)))},y.setRemux=function(b){this.transmuxer.setRemux(b.remux)},y.flush=function(b){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})},y.endTimeline=function(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})},y.alignGopsWith=function(b){this.transmuxer.alignGopsWith(b.gopsToAlignWith.slice())},H}();self.onmessage=function(H){if(H.data.action==="init"&&H.data.options){this.messageHandlers=new fs(self,H.data.options);return}this.messageHandlers||(this.messageHandlers=new fs(self)),H.data&&H.data.action&&H.data.action!=="init"&&this.messageHandlers[H.data.action]&&this.messageHandlers[H.data.action](H.data)}})),_2=p_(y2),x2=function(s,o,a){var e=s.data.segment,r=e.type,l=e.initSegment,f=e.captions,m=e.captionStreams,v=e.metadata,A=e.videoFrameDtsTime,L=e.videoFramePtsTime;o.buffer.push({captions:f,captionStreams:m,metadata:v});var P=s.data.segment.boxes||{data:s.data.segment.data},U={type:r,data:new Uint8Array(P.data,P.data.byteOffset,P.data.byteLength),initSegment:new Uint8Array(l.data,l.byteOffset,l.byteLength)};typeof A<"u"&&(U.videoFrameDtsTime=A),typeof L<"u"&&(U.videoFramePtsTime=L),a(U)},b2=function(s){var o=s.transmuxedData,a=s.callback;o.buffer=[],a(o)},T2=function(s,o){o.gopInfo=s.data.gopInfo},v_=function(s){var o=s.transmuxer,a=s.bytes,e=s.audioAppendStart,r=s.gopsToAlignWith,l=s.remux,f=s.onData,m=s.onTrackInfo,v=s.onAudioTimingInfo,A=s.onVideoTimingInfo,L=s.onVideoSegmentTimingInfo,P=s.onAudioSegmentTimingInfo,U=s.onId3,W=s.onCaptions,Y=s.onDone,q=s.onEndedTimeline,_e=s.onTransmuxerLog,J=s.isEndOfTimeline,at={buffer:[]},Me=J,Le=function(We){o.currentTransmux===s&&(We.data.action==="data"&&x2(We,at,f),We.data.action==="trackinfo"&&m(We.data.trackInfo),We.data.action==="gopInfo"&&T2(We,at),We.data.action==="audioTimingInfo"&&v(We.data.audioTimingInfo),We.data.action==="videoTimingInfo"&&A(We.data.videoTimingInfo),We.data.action==="videoSegmentTimingInfo"&&L(We.data.videoSegmentTimingInfo),We.data.action==="audioSegmentTimingInfo"&&P(We.data.audioSegmentTimingInfo),We.data.action==="id3Frame"&&U([We.data.id3Frame],We.data.id3Frame.dispatchType),We.data.action==="caption"&&W(We.data.caption),We.data.action==="endedtimeline"&&(Me=!1,q()),We.data.action==="log"&&_e(We.data.log),We.data.type==="transmuxed"&&(Me||(o.onmessage=null,b2({transmuxedData:at,callback:Y}),y_(o))))};if(o.onmessage=Le,e&&o.postMessage({action:"setAudioAppendStart",appendStart:e}),Array.isArray(r)&&o.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),typeof l<"u"&&o.postMessage({action:"setRemux",remux:l}),a.byteLength){var ze=a instanceof ArrayBuffer?a:a.buffer,De=a instanceof ArrayBuffer?0:a.byteOffset;o.postMessage({action:"push",data:ze,byteOffset:De,byteLength:a.byteLength},[ze])}J&&o.postMessage({action:"endTimeline"}),o.postMessage({action:"flush"})},y_=function(s){s.currentTransmux=null,s.transmuxQueue.length&&(s.currentTransmux=s.transmuxQueue.shift(),typeof s.currentTransmux=="function"?s.currentTransmux():v_(s.currentTransmux))},i0=function(s,o){s.postMessage({action:o}),y_(s)},__=function(s,o){if(!o.currentTransmux){o.currentTransmux=s,i0(o,s);return}o.transmuxQueue.push(i0.bind(null,o,s))},A2=function(s){__("reset",s)},S2=function(s){__("endTimeline",s)},x_=function(s){if(!s.transmuxer.currentTransmux){s.transmuxer.currentTransmux=s,v_(s);return}s.transmuxer.transmuxQueue.push(s)},w2=function(s){var o=new _2;o.currentTransmux=null,o.transmuxQueue=[];var a=o.terminate;return o.terminate=function(){return o.currentTransmux=null,o.transmuxQueue.length=0,a.call(o)},o.postMessage({action:"init",options:s}),o},Zf={reset:A2,endTimeline:S2,transmux:x_,createTransmuxer:w2},gd=function(s){var o=s.transmuxer,a=s.endAction||s.action,e=s.callback,r=ba({},s,{endAction:null,transmuxer:null,callback:null}),l=function v(A){A.data.action===a&&(o.removeEventListener("message",v),A.data.data&&(A.data.data=new Uint8Array(A.data.data,s.byteOffset||0,s.byteLength||A.data.data.byteLength),s.data&&(s.data=A.data.data)),e(A.data))};if(o.addEventListener("message",l),s.data){var f=s.data instanceof ArrayBuffer;r.byteOffset=f?0:s.data.byteOffset,r.byteLength=s.data.byteLength;var m=[f?s.data:s.data.buffer];o.postMessage(r,m)}else o.postMessage(r)},Qr={FAILURE:2,TIMEOUT:-101,ABORTED:-102},xp=function(s){s.forEach(function(o){o.abort()})},E2=function(s){return{bandwidth:s.bandwidth,bytesReceived:s.bytesReceived||0,roundTripTime:s.roundTripTime||0}},M2=function(s){var o=s.target,a=Date.now()-o.requestTime,e={bandwidth:1/0,bytesReceived:0,roundTripTime:a||0};return e.bytesReceived=s.loaded,e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3),e},dm=function(s,o){return o.timedout?{status:o.status,message:"HLS request timed-out at URL: "+o.uri,code:Qr.TIMEOUT,xhr:o}:o.aborted?{status:o.status,message:"HLS request aborted at URL: "+o.uri,code:Qr.ABORTED,xhr:o}:s?{status:o.status,message:"HLS request errored at URL: "+o.uri,code:Qr.FAILURE,xhr:o}:o.responseType==="arraybuffer"&&o.response.byteLength===0?{status:o.status,message:"Empty HLS response at URL: "+o.uri,code:Qr.FAILURE,xhr:o}:null},n0=function(s,o,a){return function(e,r){var l=r.response,f=dm(e,r);if(f)return a(f,s);if(l.byteLength!==16)return a({status:r.status,message:"Invalid HLS key at URL: "+r.uri,code:Qr.FAILURE,xhr:r},s);for(var m=new DataView(l),v=new Uint32Array([m.getUint32(0),m.getUint32(4),m.getUint32(8),m.getUint32(12)]),A=0;A<o.length;A++)o[A].bytes=v;return a(null,s)}},b_=function(s,o){var a=Lp(s.map.bytes);if(a!=="mp4"){var e=s.map.resolvedUri||s.map.uri;return o({internal:!0,message:"Found unsupported "+(a||"unknown")+" container for initialization segment at URL: "+e,code:Qr.FAILURE})}gd({action:"probeMp4Tracks",data:s.map.bytes,transmuxer:s.transmuxer,callback:function(l){var f=l.tracks,m=l.data;return s.map.bytes=m,f.forEach(function(v){s.map.tracks=s.map.tracks||{},!s.map.tracks[v.type]&&(s.map.tracks[v.type]=v,typeof v.id=="number"&&v.timescale&&(s.map.timescales=s.map.timescales||{},s.map.timescales[v.id]=v.timescale))}),o(null)}})},C2=function(s){var o=s.segment,a=s.finishProcessingFn;return function(e,r){var l=dm(e,r);if(l)return a(l,o);var f=new Uint8Array(r.response);if(o.map.key)return o.map.encryptedBytes=f,a(null,o);o.map.bytes=f,b_(o,function(m){if(m)return m.xhr=r,m.status=r.status,a(m,o);a(null,o)})}},P2=function(s){var o=s.segment,a=s.finishProcessingFn,e=s.responseType;return function(r,l){var f=dm(r,l);if(f)return a(f,o);var m=e==="arraybuffer"||!l.responseText?l.response:g2(l.responseText.substring(o.lastReachedChar||0));return o.stats=E2(l),o.key?o.encryptedBytes=new Uint8Array(m):o.bytes=new Uint8Array(m),a(null,o)}},L2=function(s){var o=s.segment,a=s.bytes,e=s.trackInfoFn,r=s.timingInfoFn,l=s.videoSegmentTimingInfoFn,f=s.audioSegmentTimingInfoFn,m=s.id3Fn,v=s.captionsFn,A=s.isEndOfTimeline,L=s.endedTimelineFn,P=s.dataFn,U=s.doneFn,W=s.onTransmuxerLog,Y=o.map&&o.map.tracks||{},q=!!(Y.audio&&Y.video),_e=r.bind(null,o,"audio","start"),J=r.bind(null,o,"audio","end"),at=r.bind(null,o,"video","start"),Me=r.bind(null,o,"video","end"),Le=function(){return x_({bytes:a,transmuxer:o.transmuxer,audioAppendStart:o.audioAppendStart,gopsToAlignWith:o.gopsToAlignWith,remux:q,onData:function(Ee){Ee.type=Ee.type==="combined"?"video":Ee.type,P(o,Ee)},onTrackInfo:function(Ee){e&&(q&&(Ee.isMuxed=!0),e(o,Ee))},onAudioTimingInfo:function(Ee){_e&&typeof Ee.start<"u"&&(_e(Ee.start),_e=null),J&&typeof Ee.end<"u"&&J(Ee.end)},onVideoTimingInfo:function(Ee){at&&typeof Ee.start<"u"&&(at(Ee.start),at=null),Me&&typeof Ee.end<"u"&&Me(Ee.end)},onVideoSegmentTimingInfo:function(Ee){l(Ee)},onAudioSegmentTimingInfo:function(Ee){f(Ee)},onId3:function(Ee,We){m(o,Ee,We)},onCaptions:function(Ee){v(o,[Ee])},isEndOfTimeline:A,onEndedTimeline:function(){L()},onTransmuxerLog:W,onDone:function(Ee){U&&(Ee.type=Ee.type==="combined"?"video":Ee.type,U(null,o,Ee))}})};gd({action:"probeTs",transmuxer:o.transmuxer,data:a,baseStartTime:o.baseStartTime,callback:function(De){o.bytes=a=De.data;var Ee=De.result;Ee&&(e(o,{hasAudio:Ee.hasAudio,hasVideo:Ee.hasVideo,isMuxed:q}),e=null,Ee.hasAudio&&!q&&_e(Ee.audioStart),Ee.hasVideo&&at(Ee.videoStart),_e=null,at=null),Le()}})},T_=function(s){var o=s.segment,a=s.bytes,e=s.trackInfoFn,r=s.timingInfoFn,l=s.videoSegmentTimingInfoFn,f=s.audioSegmentTimingInfoFn,m=s.id3Fn,v=s.captionsFn,A=s.isEndOfTimeline,L=s.endedTimelineFn,P=s.dataFn,U=s.doneFn,W=s.onTransmuxerLog,Y=new Uint8Array(a);if(Qw(Y)){o.isFmp4=!0;var q=o.map.tracks,_e={isFmp4:!0,hasVideo:!!q.video,hasAudio:!!q.audio};q.audio&&q.audio.codec&&q.audio.codec!=="enca"&&(_e.audioCodec=q.audio.codec),q.video&&q.video.codec&&q.video.codec!=="encv"&&(_e.videoCodec=q.video.codec),q.video&&q.audio&&(_e.isMuxed=!0),e(o,_e);var J=function(Me){P(o,{data:Y,type:_e.hasAudio&&!_e.isMuxed?"audio":"video"}),Me&&Me.length&&v(o,Me),U(null,o,{})};gd({action:"probeMp4StartTime",timescales:o.map.timescales,data:Y,transmuxer:o.transmuxer,callback:function(Me){var Le=Me.data,ze=Me.startTime;if(a=Le.buffer,o.bytes=Y=Le,_e.hasAudio&&!_e.isMuxed&&r(o,"audio","start",ze),_e.hasVideo&&r(o,"video","start",ze),!q.video||!Le.byteLength||!o.transmuxer){J();return}gd({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:o.transmuxer,data:Y,timescales:o.map.timescales,trackIds:[q.video.id],callback:function(Ee){a=Ee.data.buffer,o.bytes=Y=Ee.data,Ee.logs.forEach(function(We){W(fe.mergeOptions(We,{stream:"mp4CaptionParser"}))}),J(Ee.captions)}})}});return}if(!o.transmuxer){U(null,o,{});return}if(typeof o.container>"u"&&(o.container=Lp(Y)),o.container!=="ts"&&o.container!=="aac"){e(o,{hasAudio:!1,hasVideo:!1}),U(null,o,{});return}L2({segment:o,bytes:a,trackInfoFn:e,timingInfoFn:r,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:v,isEndOfTimeline:A,endedTimelineFn:L,dataFn:P,doneFn:U,onTransmuxerLog:W})},A_=function(s,o){var a=s.id,e=s.key,r=s.encryptedBytes,l=s.decryptionWorker,f=function v(A){if(A.data.source===a){l.removeEventListener("message",v);var L=A.data.decrypted;o(new Uint8Array(L.bytes,L.byteOffset,L.byteLength))}};l.addEventListener("message",f);var m;e.bytes.slice?m=e.bytes.slice():m=new Uint32Array(Array.prototype.slice.call(e.bytes)),l.postMessage(l_({source:a,encrypted:r,key:m,iv:e.iv}),[r.buffer,m.buffer])},I2=function(s){var o=s.decryptionWorker,a=s.segment,e=s.trackInfoFn,r=s.timingInfoFn,l=s.videoSegmentTimingInfoFn,f=s.audioSegmentTimingInfoFn,m=s.id3Fn,v=s.captionsFn,A=s.isEndOfTimeline,L=s.endedTimelineFn,P=s.dataFn,U=s.doneFn,W=s.onTransmuxerLog;A_({id:a.requestId,key:a.key,encryptedBytes:a.encryptedBytes,decryptionWorker:o},function(Y){a.bytes=Y,T_({segment:a,bytes:a.bytes,trackInfoFn:e,timingInfoFn:r,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:v,isEndOfTimeline:A,endedTimelineFn:L,dataFn:P,doneFn:U,onTransmuxerLog:W})})},D2=function(s){var o=s.activeXhrs,a=s.decryptionWorker,e=s.trackInfoFn,r=s.timingInfoFn,l=s.videoSegmentTimingInfoFn,f=s.audioSegmentTimingInfoFn,m=s.id3Fn,v=s.captionsFn,A=s.isEndOfTimeline,L=s.endedTimelineFn,P=s.dataFn,U=s.doneFn,W=s.onTransmuxerLog,Y=0,q=!1;return function(_e,J){if(!q){if(_e)return q=!0,xp(o),U(_e,J);if(Y+=1,Y===o.length){var at=function(){if(J.encryptedBytes)return I2({decryptionWorker:a,segment:J,trackInfoFn:e,timingInfoFn:r,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:v,isEndOfTimeline:A,endedTimelineFn:L,dataFn:P,doneFn:U,onTransmuxerLog:W});T_({segment:J,bytes:J.bytes,trackInfoFn:e,timingInfoFn:r,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:f,id3Fn:m,captionsFn:v,isEndOfTimeline:A,endedTimelineFn:L,dataFn:P,doneFn:U,onTransmuxerLog:W})};if(J.endOfAllRequests=Date.now(),J.map&&J.map.encryptedBytes&&!J.map.bytes)return A_({decryptionWorker:a,id:J.requestId+"-init",encryptedBytes:J.map.encryptedBytes,key:J.map.key},function(Me){J.map.bytes=Me,b_(J,function(Le){if(Le)return xp(o),U(Le,J);at()})});at()}}}},R2=function(s){var o=s.loadendState,a=s.abortFn;return function(e){var r=e.target;r.aborted&&a&&!o.calledAbortFn&&(a(),o.calledAbortFn=!0)}},O2=function(s){var o=s.segment,a=s.progressFn;return function(e){var r=e.target;if(!r.aborted)return o.stats=fe.mergeOptions(o.stats,M2(e)),!o.stats.firstBytesReceivedAt&&o.stats.bytesReceived&&(o.stats.firstBytesReceivedAt=Date.now()),a(e,o)}},F2=function(s){var o=s.xhr,a=s.xhrOptions,e=s.decryptionWorker,r=s.segment,l=s.abortFn,f=s.progressFn,m=s.trackInfoFn,v=s.timingInfoFn,A=s.videoSegmentTimingInfoFn,L=s.audioSegmentTimingInfoFn,P=s.id3Fn,U=s.captionsFn,W=s.isEndOfTimeline,Y=s.endedTimelineFn,q=s.dataFn,_e=s.doneFn,J=s.onTransmuxerLog,at=[],Me=D2({activeXhrs:at,decryptionWorker:e,trackInfoFn:m,timingInfoFn:v,videoSegmentTimingInfoFn:A,audioSegmentTimingInfoFn:L,id3Fn:P,captionsFn:U,isEndOfTimeline:W,endedTimelineFn:Y,dataFn:q,doneFn:_e,onTransmuxerLog:J});if(r.key&&!r.key.bytes){var Le=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&Le.push(r.map.key);var ze=fe.mergeOptions(a,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),De=n0(r,Le,Me),Ee=o(ze,De);at.push(Ee)}if(r.map&&!r.map.bytes){var We=r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri);if(We){var Ce=fe.mergeOptions(a,{uri:r.map.key.resolvedUri,responseType:"arraybuffer"}),vt=n0(r,[r.map.key],Me),je=o(Ce,vt);at.push(je)}var ut=fe.mergeOptions(a,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:yp(r.map)}),Kt=C2({segment:r,finishProcessingFn:Me}),Jt=o(ut,Kt);at.push(Jt)}var hi=fe.mergeOptions(a,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:yp(r)}),Oi=P2({segment:r,finishProcessingFn:Me,responseType:hi.responseType}),vi=o(hi,Oi);vi.addEventListener("progress",O2({segment:r,progressFn:f})),at.push(vi);var $i={};return at.forEach(function(li){li.addEventListener("loadend",R2({loadendState:$i,abortFn:l}))}),function(){return xp(at)}},k2=Er("CodecUtils"),B2=function(s){var o=s.attributes||{};if(o.CODECS)return Wr(o.CODECS)},S_=function(s,o){var a=o.attributes||{};return s&&s.mediaGroups&&s.mediaGroups.AUDIO&&a.AUDIO&&s.mediaGroups.AUDIO[a.AUDIO]},N2=function(s,o){if(!S_(s,o))return!0;var a=o.attributes||{},e=s.mediaGroups.AUDIO[a.AUDIO];for(var r in e)if(!e[r].uri&&!e[r].playlists)return!0;return!1},vd=function(s){var o={};return s.forEach(function(a){var e=a.mediaType,r=a.type,l=a.details;o[e]=o[e]||[],o[e].push(A0(""+r+l))}),Object.keys(o).forEach(function(a){if(o[a].length>1){k2("multiple "+a+" codecs found as attributes: "+o[a].join(", ")+". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs."),o[a]=null;return}o[a]=o[a][0]}),o},r0=function(s){var o=0;return s.audio&&o++,s.video&&o++,o},mu=function(s,o){var a=o.attributes||{},e=vd(B2(o)||[]);if(S_(s,o)&&!e.audio&&!N2(s,o)){var r=vd(MS(s,a.AUDIO)||[]);r.audio&&(e.audio=r.audio)}return e},Qc=Er("PlaylistSelector"),a0=function(s){if(!(!s||!s.playlist)){var o=s.playlist;return JSON.stringify({id:o.id,bandwidth:s.bandwidth,width:s.width,height:s.height,codecs:o.attributes&&o.attributes.CODECS||""})}},yd=function(s,o){if(!s)return"";var a=ie.getComputedStyle(s);return a?a[o]:""},Bo=function(s,o){var a=s.slice();s.sort(function(e,r){var l=o(e,r);return l===0?a.indexOf(e)-a.indexOf(r):l})},hm=function(s,o){var a,e;return s.attributes.BANDWIDTH&&(a=s.attributes.BANDWIDTH),a=a||ie.Number.MAX_VALUE,o.attributes.BANDWIDTH&&(e=o.attributes.BANDWIDTH),e=e||ie.Number.MAX_VALUE,a-e},U2=function(s,o){var a,e;return s.attributes.RESOLUTION&&s.attributes.RESOLUTION.width&&(a=s.attributes.RESOLUTION.width),a=a||ie.Number.MAX_VALUE,o.attributes.RESOLUTION&&o.attributes.RESOLUTION.width&&(e=o.attributes.RESOLUTION.width),e=e||ie.Number.MAX_VALUE,a===e&&s.attributes.BANDWIDTH&&o.attributes.BANDWIDTH?s.attributes.BANDWIDTH-o.attributes.BANDWIDTH:a-e},w_=function(s,o,a,e,r,l){if(s){var f={bandwidth:o,width:a,height:e,limitRenditionByPlayerDimensions:r},m=s.playlists;Fn.isAudioOnly(s)&&(m=l.getAudioTrackPlaylists_(),f.audioOnly=!0);var v=m.map(function(Ce){var vt,je=Ce.attributes&&Ce.attributes.RESOLUTION&&Ce.attributes.RESOLUTION.width,ut=Ce.attributes&&Ce.attributes.RESOLUTION&&Ce.attributes.RESOLUTION.height;return vt=Ce.attributes&&Ce.attributes.BANDWIDTH,vt=vt||ie.Number.MAX_VALUE,{bandwidth:vt,width:je,height:ut,playlist:Ce}});Bo(v,function(Ce,vt){return Ce.bandwidth-vt.bandwidth}),v=v.filter(function(Ce){return!Fn.isIncompatible(Ce.playlist)});var A=v.filter(function(Ce){return Fn.isEnabled(Ce.playlist)});A.length||(A=v.filter(function(Ce){return!Fn.isDisabled(Ce.playlist)}));var L=A.filter(function(Ce){return Ce.bandwidth*rn.BANDWIDTH_VARIANCE<o}),P=L[L.length-1],U=L.filter(function(Ce){return Ce.bandwidth===P.bandwidth})[0];if(r===!1){var W=U||A[0]||v[0];if(W&&W.playlist){var Y="sortedPlaylistReps";return U&&(Y="bandwidthBestRep"),A[0]&&(Y="enabledPlaylistReps"),Qc("choosing "+a0(W)+" using "+Y+" with options",f),W.playlist}return Qc("could not choose a playlist with options",f),null}var q=L.filter(function(Ce){return Ce.width&&Ce.height});Bo(q,function(Ce,vt){return Ce.width-vt.width});var _e=q.filter(function(Ce){return Ce.width===a&&Ce.height===e});P=_e[_e.length-1];var J=_e.filter(function(Ce){return Ce.bandwidth===P.bandwidth})[0],at,Me,Le;J||(at=q.filter(function(Ce){return Ce.width>a||Ce.height>e}),Me=at.filter(function(Ce){return Ce.width===at[0].width&&Ce.height===at[0].height}),P=Me[Me.length-1],Le=Me.filter(function(Ce){return Ce.bandwidth===P.bandwidth})[0]);var ze;if(l.experimentalLeastPixelDiffSelector){var De=q.map(function(Ce){return Ce.pixelDiff=Math.abs(Ce.width-a)+Math.abs(Ce.height-e),Ce});Bo(De,function(Ce,vt){return Ce.pixelDiff===vt.pixelDiff?vt.bandwidth-Ce.bandwidth:Ce.pixelDiff-vt.pixelDiff}),ze=De[0]}var Ee=ze||Le||J||U||A[0]||v[0];if(Ee&&Ee.playlist){var We="sortedPlaylistReps";return ze?We="leastPixelDiffRep":Le?We="resolutionPlusOneRep":J?We="resolutionBestRep":U?We="bandwidthBestRep":A[0]&&(We="enabledPlaylistReps"),Qc("choosing "+a0(Ee)+" using "+We+" with options",f),Ee.playlist}return Qc("could not choose a playlist with options",f),null}},s0=function(){var s=this.useDevicePixelRatio&&ie.devicePixelRatio||1;return w_(this.playlists.master,this.systemBandwidth,parseInt(yd(this.tech_.el(),"width"),10)*s,parseInt(yd(this.tech_.el(),"height"),10)*s,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)},H2=function(s){var o=-1,a=-1;if(s<0||s>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){var e=this.useDevicePixelRatio&&ie.devicePixelRatio||1;return o<0&&(o=this.systemBandwidth,a=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==a&&(o=s*this.systemBandwidth+(1-s)*o,a=this.systemBandwidth),w_(this.playlists.master,o,parseInt(yd(this.tech_.el(),"width"),10)*e,parseInt(yd(this.tech_.el(),"height"),10)*e,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)}},V2=function(s){var o=s.master,a=s.currentTime,e=s.bandwidth,r=s.duration,l=s.segmentDuration,f=s.timeUntilRebuffer,m=s.currentTimeline,v=s.syncController,A=o.playlists.filter(function(Y){return!Fn.isIncompatible(Y)}),L=A.filter(Fn.isEnabled);L.length||(L=A.filter(function(Y){return!Fn.isDisabled(Y)}));var P=L.filter(Fn.hasAttribute.bind(null,"BANDWIDTH")),U=P.map(function(Y){var q=v.getSyncPoint(Y,r,m,a),_e=q?1:2,J=Fn.estimateSegmentRequestTime(l,e,Y),at=J*_e-f;return{playlist:Y,rebufferingImpact:at}}),W=U.filter(function(Y){return Y.rebufferingImpact<=0});return Bo(W,function(Y,q){return hm(q.playlist,Y.playlist)}),W.length?W[0]:(Bo(U,function(Y,q){return Y.rebufferingImpact-q.rebufferingImpact}),U[0]||null)},G2=function(){var s=this,o=this.playlists.master.playlists.filter(Fn.isEnabled);Bo(o,function(e,r){return hm(e,r)});var a=o.filter(function(e){return!!mu(s.playlists.master,e).video});return a[0]||null},z2=function(s){var o=0,a;return s.bytes&&(a=new Uint8Array(s.bytes),s.segments.forEach(function(e){a.set(e,o),o+=e.byteLength})),a},W2=function(s,o,a){if(!s[a]){o.trigger({type:"usage",name:"vhs-608"}),o.trigger({type:"usage",name:"hls-608"});var e=a;/^cc708_/.test(a)&&(e="SERVICE"+a.split("_")[1]);var r=o.textTracks().getTrackById(e);if(r)s[a]=r;else{var l=o.options_.vhs&&o.options_.vhs.captionServices||{},f=a,m=a,v=!1,A=l[e];A&&(f=A.label,m=A.language,v=A.default),s[a]=o.addRemoteTextTrack({kind:"captions",id:e,default:v,label:f,language:m},!1).track}}},j2=function(s){var o=s.inbandTextTracks,a=s.captionArray,e=s.timestampOffset;if(a){var r=ie.WebKitDataCue||ie.VTTCue;a.forEach(function(l){var f=l.stream;o[f].addCue(new r(l.startTime+e,l.endTime+e,l.text))})}},q2=function(s){Object.defineProperties(s.frame,{id:{get:function(){return fe.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),s.value.key}},value:{get:function(){return fe.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),s.value.data}},privateData:{get:function(){return fe.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),s.value.data}}})},X2=function(s){var o=s.inbandTextTracks,a=s.metadataArray,e=s.timestampOffset,r=s.videoDuration;if(a){var l=ie.WebKitDataCue||ie.VTTCue,f=o.metadataTrack_;if(f&&(a.forEach(function(U){var W=U.cueTime+e;typeof W!="number"||ie.isNaN(W)||W<0||!(W<1/0)||U.frames.forEach(function(Y){var q=new l(W,W,Y.value||Y.url||Y.data||"");q.frame=Y,q.value=Y,q2(q),f.addCue(q)})}),!(!f.cues||!f.cues.length))){for(var m=f.cues,v=[],A=0;A<m.length;A++)m[A]&&v.push(m[A]);var L=v.reduce(function(U,W){var Y=U[W.startTime]||[];return Y.push(W),U[W.startTime]=Y,U},{}),P=Object.keys(L).sort(function(U,W){return Number(U)-Number(W)});P.forEach(function(U,W){var Y=L[U],q=Number(P[W+1])||r;Y.forEach(function(_e){_e.endTime=q})})}}},Q2=function(s,o,a){s.metadataTrack_||(s.metadataTrack_=a.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,s.metadataTrack_.inBandMetadataTrackDispatchType=o)},hu=function(s,o,a){var e,r;if(a&&a.cues)for(e=a.cues.length;e--;)r=a.cues[e],r.startTime>=s&&r.endTime<=o&&a.removeCue(r)},Y2=function(s){var o=s.cues;if(o)for(var a=0;a<o.length;a++){for(var e=[],r=0,l=0;l<o.length;l++)o[a].startTime===o[l].startTime&&o[a].endTime===o[l].endTime&&o[a].text===o[l].text&&(r++,r>1&&e.push(o[l]));e.length&&e.forEach(function(f){return s.removeCue(f)})}},K2=function(s,o,a){if(typeof o>"u"||o===null||!s.length)return[];var e=Math.ceil((o-a+3)*nd.ONE_SECOND_IN_TS),r;for(r=0;r<s.length&&!(s[r].pts>e);r++);return s.slice(r)},Z2=function(s,o,a){if(!o.length)return s;if(a)return o.slice();var e=o[0].pts,r=0;for(r;r<s.length&&!(s[r].pts>=e);r++);return s.slice(0,r).concat(o)},$2=function(s,o,a,e){for(var r=Math.ceil((o-e)*nd.ONE_SECOND_IN_TS),l=Math.ceil((a-e)*nd.ONE_SECOND_IN_TS),f=s.slice(),m=s.length;m--&&!(s[m].pts<=l););if(m===-1)return f;for(var v=m+1;v--&&!(s[v].pts<=r););return v=Math.max(v,0),f.splice(v,m-v+1),f},J2=function(s,o){if(!s&&!o||!s&&o||s&&!o)return!1;if(s===o)return!0;var a=Object.keys(s).sort(),e=Object.keys(o).sort();if(a.length!==e.length)return!1;for(var r=0;r<a.length;r++){var l=a[r];if(l!==e[r]||s[l]!==o[l])return!1}return!0},E_=22,eC=function(s,o,a){o=o||[];for(var e=[],r=0,l=0;l<o.length;l++){var f=o[l];if(s===f.timeline&&(e.push(l),r+=f.duration,r>a))return l}return e.length===0?0:e[e.length-1]},uu=1,tC=500,o0=function(s){return typeof s=="number"&&isFinite(s)},Yc=1/60,iC=function(s,o,a){return s!=="main"||!o||!a?null:!a.hasAudio&&!a.hasVideo?"Neither audio nor video found in segment.":o.hasVideo&&!a.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!o.hasVideo&&a.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null},nC=function(s,o,a){var e=o-rn.BACK_BUFFER_LENGTH;s.length&&(e=Math.max(e,s.start(0)));var r=o-a;return Math.min(r,e)},Io=function(s){var o=s.startOfSegment,a=s.duration,e=s.segment,r=s.part,l=s.playlist,f=l.mediaSequence,m=l.id,v=l.segments,A=v===void 0?[]:v,L=s.mediaIndex,P=s.partIndex,U=s.timeline,W=A.length-1,Y="mediaIndex/partIndex increment";s.getMediaInfoForTime?Y="getMediaInfoForTime ("+s.getMediaInfoForTime+")":s.isSyncRequest&&(Y="getSyncSegmentCandidate (isSyncRequest)"),s.independent&&(Y+=" with independent "+s.independent);var q=typeof P=="number",_e=s.segment.uri?"segment":"pre-segment",J=q?Qy({preloadSegment:e})-1:0;return _e+" ["+(f+L)+"/"+(f+W)+"]"+(q?" part ["+P+"/"+J+"]":"")+(" segment start/end ["+e.start+" => "+e.end+"]")+(q?" part start/end ["+r.start+" => "+r.end+"]":"")+(" startOfSegment ["+o+"]")+(" duration ["+a+"]")+(" timeline ["+U+"]")+(" selected by ["+Y+"]")+(" playlist ["+m+"]")},l0=function(s){return s+"TimingInfo"},rC=function(s){var o=s.segmentTimeline,a=s.currentTimeline,e=s.startOfSegment,r=s.buffered,l=s.overrideCheck;return!l&&o===a?null:o<a?e:r.length?r.end(r.length-1):e},u0=function(s){var o=s.timelineChangeController,a=s.currentTimeline,e=s.segmentTimeline,r=s.loaderType,l=s.audioDisabled;if(a===e)return!1;if(r==="audio"){var f=o.lastTimelineChange({type:"main"});return!f||f.to!==e}if(r==="main"&&l){var m=o.pendingTimelineChange({type:"audio"});return!(m&&m.to===e)}return!1},aC=function(s){var o=0;return["video","audio"].forEach(function(a){var e=s[a+"TimingInfo"];if(e){var r=e.start,l=e.end,f;typeof r=="bigint"||typeof l=="bigint"?f=ie.BigInt(l)-ie.BigInt(r):typeof r=="number"&&typeof l=="number"&&(f=l-r),typeof f<"u"&&f>o&&(o=f)}}),typeof o=="bigint"&&o<Number.MAX_SAFE_INTEGER&&(o=Number(o)),o},c0=function(s){var o=s.segmentDuration,a=s.maxDuration;return o?Math.round(o)>a+ts:!1},sC=function(s,o){if(o!=="hls")return null;var a=aC({audioTimingInfo:s.audioTimingInfo,videoTimingInfo:s.videoTimingInfo});if(!a)return null;var e=s.playlist.targetDuration,r=c0({segmentDuration:a,maxDuration:e*2}),l=c0({segmentDuration:a,maxDuration:e}),f="Segment with index "+s.mediaIndex+" "+("from playlist "+s.playlist.id+" ")+("has a duration of "+a+" ")+("when the reported duration is "+s.duration+" ")+("and the target duration is "+e+". ")+"For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1";return r||l?{severity:r?"warn":"info",message:f}:null},bp=function(d){it(s,d);function s(a,e){var r;if(r=d.call(this)||this,!a)throw new TypeError("Initialization settings are required");if(typeof a.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!a.mediaSource)throw new TypeError("No MediaSource specified");return r.bandwidth=a.bandwidth,r.throughput={rate:0,count:0},r.roundTrip=NaN,r.resetStats_(),r.mediaIndex=null,r.partIndex=null,r.hasPlayed_=a.hasPlayed,r.currentTime_=a.currentTime,r.seekable_=a.seekable,r.seeking_=a.seeking,r.duration_=a.duration,r.mediaSource_=a.mediaSource,r.vhs_=a.vhs,r.loaderType_=a.loaderType,r.currentMediaInfo_=void 0,r.startingMediaInfo_=void 0,r.segmentMetadataTrack_=a.segmentMetadataTrack,r.goalBufferLength_=a.goalBufferLength,r.sourceType_=a.sourceType,r.sourceUpdater_=a.sourceUpdater,r.inbandTextTracks_=a.inbandTextTracks,r.state_="INIT",r.timelineChangeController_=a.timelineChangeController,r.shouldSaveSegmentTimingInfo_=!0,r.parse708captions_=a.parse708captions,r.useDtsForTimestampOffset_=a.useDtsForTimestampOffset,r.captionServices_=a.captionServices,r.experimentalExactManifestTimings=a.experimentalExactManifestTimings,r.checkBufferTimeout_=null,r.error_=void 0,r.currentTimeline_=-1,r.pendingSegment_=null,r.xhrOptions_=null,r.pendingSegments_=[],r.audioDisabled_=!1,r.isPendingTimestampOffset_=!1,r.gopBuffer_=[],r.timeMapping_=0,r.safeAppend_=fe.browser.IE_VERSION>=11,r.appendInitSegment_={audio:!0,video:!0},r.playlistOfLastInitSegment_={audio:null,video:null},r.callQueue_=[],r.loadQueue_=[],r.metadataQueue_={id3:[],caption:[]},r.waitingOnRemove_=!1,r.quotaExceededErrorRetryTimeout_=null,r.activeInitSegmentId_=null,r.initSegments_={},r.cacheEncryptionKeys_=a.cacheEncryptionKeys,r.keyCache_={},r.decrypter_=a.decrypter,r.syncController_=a.syncController,r.syncPoint_={segmentIndex:0,time:0},r.transmuxer_=r.createTransmuxer_(),r.triggerSyncInfoUpdate_=function(){return r.trigger("syncinfoupdate")},r.syncController_.on("syncinfoupdate",r.triggerSyncInfoUpdate_),r.mediaSource_.addEventListener("sourceopen",function(){r.isEndOfStream_()||(r.ended_=!1)}),r.fetchAtBuffer_=!1,r.logger_=Er("SegmentLoader["+r.loaderType_+"]"),Object.defineProperty(Ft(r),"state",{get:function(){return this.state_},set:function(f){f!==this.state_&&(this.logger_(this.state_+" -> "+f),this.state_=f,this.trigger("statechange"))}}),r.sourceUpdater_.on("ready",function(){r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),r.loaderType_==="main"&&r.timelineChangeController_.on("pendingtimelinechange",function(){r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),r.loaderType_==="audio"&&r.timelineChangeController_.on("timelinechange",function(){r.hasEnoughInfoToLoad_()&&r.processLoadQueue_(),r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),r}var o=s.prototype;return o.createTransmuxer_=function(){return Zf.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})},o.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0},o.dispose=function(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&ie.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()},o.setAudio=function(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())},o.abort=function(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()},o.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,ie.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null},o.checkForAbort_=function(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e},o.error=function(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_},o.endOfStream=function(){this.ended_=!0,this.transmuxer_&&Zf.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},o.buffered_=function(){var e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return fe.createTimeRanges();if(this.loaderType_==="main"){var r=e.hasAudio,l=e.hasVideo,f=e.isMuxed;if(l&&r&&!this.audioDisabled_&&!f)return this.sourceUpdater_.buffered();if(l)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()},o.initSegmentForMap=function(e,r){if(r===void 0&&(r=!1),!e)return null;var l=md(e),f=this.initSegments_[l];return r&&!f&&e.bytes&&(this.initSegments_[l]=f={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),f||e},o.segmentKey=function(e,r){if(r===void 0&&(r=!1),!e)return null;var l=u_(e),f=this.keyCache_[l];this.cacheEncryptionKeys_&&r&&!f&&e.bytes&&(this.keyCache_[l]=f={resolvedUri:e.resolvedUri,bytes:e.bytes});var m={resolvedUri:(f||e).resolvedUri};return f&&(m.bytes=f.bytes),m},o.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},o.load=function(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}},o.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},o.playlist=function(e,r){if(r===void 0&&(r={}),!!e){var l=this.playlist_,f=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=r,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));var m=null;if(l&&(l.id?m=l.id:l.uri&&(m=l.uri)),this.logger_("playlist update ["+m+" => "+(e.id||e.uri)+"]"),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!l||l.uri!==e.uri){this.mediaIndex!==null&&(e.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}var v=e.mediaSequence-l.mediaSequence;if(this.logger_("live window shift ["+v+"]"),this.mediaIndex!==null)if(this.mediaIndex-=v,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{var A=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!A.parts||!A.parts.length||!A.parts[this.partIndex])){var L=this.mediaIndex;this.logger_("currently processing part (index "+this.partIndex+") no longer exists."),this.resetLoader(),this.mediaIndex=L}}f&&(f.mediaIndex-=v,f.mediaIndex<0?(f.mediaIndex=null,f.partIndex=null):(f.mediaIndex>=0&&(f.segment=e.segments[f.mediaIndex]),f.partIndex>=0&&f.segment.parts&&(f.part=f.segment.parts[f.partIndex]))),this.syncController_.saveExpiredSegmentInfo(l,e)}},o.pause=function(){this.checkBufferTimeout_&&(ie.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},o.paused=function(){return this.checkBufferTimeout_===null},o.resetEverything=function(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))},o.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},o.resyncLoader=function(){this.transmuxer_&&Zf.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})},o.remove=function(e,r,l,f){if(l===void 0&&(l=function(){}),f===void 0&&(f=!1),r===1/0&&(r=this.duration_()),r<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}var m=1,v=function(){m--,m===0&&l()};(f||!this.audioDisabled_)&&(m++,this.sourceUpdater_.removeAudio(e,r,v)),(f||this.loaderType_==="main")&&(this.gopBuffer_=$2(this.gopBuffer_,e,r,this.timeMapping_),m++,this.sourceUpdater_.removeVideo(e,r,v));for(var A in this.inbandTextTracks_)hu(e,r,this.inbandTextTracks_[A]);hu(e,r,this.segmentMetadataTrack_),v()},o.monitorBuffer_=function(){this.checkBufferTimeout_&&ie.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=ie.setTimeout(this.monitorBufferTick_.bind(this),1)},o.monitorBufferTick_=function(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&ie.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=ie.setTimeout(this.monitorBufferTick_.bind(this),tC)},o.fillBuffer_=function(){if(!this.sourceUpdater_.updating()){var e=this.chooseNextRequest_();e&&(typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}},o.isEndOfStream_=function(e,r,l){if(e===void 0&&(e=this.mediaIndex),r===void 0&&(r=this.playlist_),l===void 0&&(l=this.partIndex),!r||!this.mediaSource_)return!1;var f=typeof e=="number"&&r.segments[e],m=e+1===r.segments.length,v=!f||!f.parts||l+1===f.parts.length;return r.endList&&this.mediaSource_.readyState==="open"&&m&&v},o.chooseNextRequest_=function(){var e=this.buffered_(),r=Zv(e)||0,l=sm(e,this.currentTime_()),f=!this.hasPlayed_()&&l>=1,m=l>=this.goalBufferLength_(),v=this.playlist_.segments;if(!v.length||f||m)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());var A={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(A.isSyncRequest)A.mediaIndex=eC(this.currentTimeline_,v,r);else if(this.mediaIndex!==null){var L=v[this.mediaIndex],P=typeof this.partIndex=="number"?this.partIndex:-1;A.startOfSegment=L.end?L.end:r,L.parts&&L.parts[P+1]?(A.mediaIndex=this.mediaIndex,A.partIndex=P+1):A.mediaIndex=this.mediaIndex+1}else{var U=Fn.getMediaInfoForTime({experimentalExactManifestTimings:this.experimentalExactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?r:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time}),W=U.segmentIndex,Y=U.startTime,q=U.partIndex;A.getMediaInfoForTime=this.fetchAtBuffer_?"bufferedEnd "+r:"currentTime "+this.currentTime_(),A.mediaIndex=W,A.startOfSegment=Y,A.partIndex=q}var _e=v[A.mediaIndex],J=_e&&typeof A.partIndex=="number"&&_e.parts&&_e.parts[A.partIndex];if(!_e||typeof A.partIndex=="number"&&!J)return null;if(typeof A.partIndex!="number"&&_e.parts&&(A.partIndex=0,J=_e.parts[0]),!l&&J&&!J.independent)if(A.partIndex===0){var at=v[A.mediaIndex-1],Me=at.parts&&at.parts.length&&at.parts[at.parts.length-1];Me&&Me.independent&&(A.mediaIndex-=1,A.partIndex=at.parts.length-1,A.independent="previous segment")}else _e.parts[A.partIndex-1].independent&&(A.partIndex-=1,A.independent="previous part");var Le=this.mediaSource_&&this.mediaSource_.readyState==="ended";return A.mediaIndex>=v.length-1&&Le&&!this.seeking_()?null:this.generateSegmentInfo_(A)},o.generateSegmentInfo_=function(e){var r=e.independent,l=e.playlist,f=e.mediaIndex,m=e.startOfSegment,v=e.isSyncRequest,A=e.partIndex,L=e.forceTimestampOffset,P=e.getMediaInfoForTime,U=l.segments[f],W=typeof A=="number"&&U.parts[A],Y={requestId:"segment-loader-"+Math.random(),uri:W&&W.resolvedUri||U.resolvedUri,mediaIndex:f,partIndex:W?A:null,isSyncRequest:v,startOfSegment:m,playlist:l,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:U.timeline,duration:W&&W.duration||U.duration,segment:U,part:W,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:P,independent:r},q=typeof L<"u"?L:this.isPendingTimestampOffset_;Y.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:U.timeline,currentTimeline:this.currentTimeline_,startOfSegment:m,buffered:this.buffered_(),overrideCheck:q});var _e=Zv(this.sourceUpdater_.audioBuffered());return typeof _e=="number"&&(Y.audioAppendStart=_e-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(Y.gopsToAlignWith=K2(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),Y},o.timestampOffsetForSegment_=function(e){return rC(e)},o.earlyAbortWhenNeeded_=function(e){if(!(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)&&!(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)){var r=this.currentTime_(),l=e.bandwidth,f=this.pendingSegment_.duration,m=Fn.estimateSegmentRequestTime(f,l,this.playlist_,e.bytesReceived),v=MM(this.buffered_(),r,this.vhs_.tech_.playbackRate())-1;if(!(m<=v)){var A=V2({master:this.vhs_.playlists.master,currentTime:r,bandwidth:l,duration:this.duration_(),segmentDuration:f,timeUntilRebuffer:v,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(A){var L=m-v,P=L-A.rebufferingImpact,U=.5;v<=ts&&(U=1),!(!A.playlist||A.playlist.uri===this.playlist_.uri||P<U)&&(this.bandwidth=A.playlist.attributes.BANDWIDTH*rn.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}}}},o.handleAbort_=function(e){this.logger_("Aborting "+Io(e)),this.mediaRequestsAborted+=1},o.handleProgress_=function(e,r){this.earlyAbortWhenNeeded_(r.stats),!this.checkForAbort_(r.requestId)&&this.trigger("progress")},o.handleTrackInfo_=function(e,r){this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(r)||(r=r||{},J2(this.currentMediaInfo_,r)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=r,this.currentMediaInfo_=r,this.logger_("trackinfo update",r),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=r,this.hasEnoughInfoToAppend_()&&this.processCallQueue_())))},o.handleTimingInfo_=function(e,r,l,f){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){var m=this.pendingSegment_,v=l0(r);m[v]=m[v]||{},m[v][l]=f,this.logger_("timinginfo: "+r+" - "+l+" - "+f),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}},o.handleCaptions_=function(e,r){var l=this;if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){if(r.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}var f=this.pendingSegment_;if(!f.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,r));return}var m=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),v={};r.forEach(function(A){v[A.stream]=v[A.stream]||{startTime:1/0,captions:[],endTime:0};var L=v[A.stream];L.startTime=Math.min(L.startTime,A.startTime+m),L.endTime=Math.max(L.endTime,A.endTime+m),L.captions.push(A)}),Object.keys(v).forEach(function(A){var L=v[A],P=L.startTime,U=L.endTime,W=L.captions,Y=l.inbandTextTracks_;l.logger_("adding cues from "+P+" -> "+U+" for "+A),W2(Y,l.vhs_.tech_,A),hu(P,U,Y[A]),j2({captionArray:W,inbandTextTracks:Y,timestampOffset:m})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}},o.handleId3_=function(e,r,l){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){var f=this.pendingSegment_;if(!f.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,r,l));return}var m=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();Q2(this.inbandTextTracks_,l,this.vhs_.tech_),X2({inbandTextTracks:this.inbandTextTracks_,metadataArray:r,timestampOffset:m,videoDuration:this.duration_()})}},o.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(e){return e()}),this.metadataQueue_.caption.forEach(function(e){return e()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},o.processCallQueue_=function(){var e=this.callQueue_;this.callQueue_=[],e.forEach(function(r){return r()})},o.processLoadQueue_=function(){var e=this.loadQueue_;this.loadQueue_=[],e.forEach(function(r){return r()})},o.hasEnoughInfoToLoad_=function(){if(this.loaderType_!=="audio")return!0;var e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!u0({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1},o.getCurrentMediaInfo_=function(e){return e===void 0&&(e=this.pendingSegment_),e&&e.trackInfo||this.currentMediaInfo_},o.getMediaInfo_=function(e){return e===void 0&&(e=this.pendingSegment_),this.getCurrentMediaInfo_(e)||this.startingMediaInfo_},o.getPendingSegmentPlaylist=function(){return this.pendingSegment_?this.pendingSegment_.playlist:null},o.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;var e=this.pendingSegment_,r=this.getCurrentMediaInfo_();if(!e||!r)return!1;var l=r.hasAudio,f=r.hasVideo,m=r.isMuxed;return!(f&&!e.videoTimingInfo||l&&!this.audioDisabled_&&!m&&!e.audioTimingInfo||u0({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},o.handleData_=function(e,r){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){this.callQueue_.push(this.handleData_.bind(this,e,r));return}var l=this.pendingSegment_;if(this.setTimeMapping_(l.timeline),this.updateMediaSecondsLoaded_(l.part||l.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),l.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),l.isFmp4=e.isFmp4,l.timingInfo=l.timingInfo||{},l.isFmp4)this.trigger("fmp4"),l.timingInfo.start=l[l0(r.type)].start;else{var f=this.getCurrentMediaInfo_(),m=this.loaderType_==="main"&&f&&f.hasVideo,v;m&&(v=l.videoTimingInfo.start),l.timingInfo.start=this.trueSegmentStart_({currentStart:l.timingInfo.start,playlist:l.playlist,mediaIndex:l.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:m,firstVideoFrameTimeForData:v,videoTimingInfo:l.videoTimingInfo,audioTimingInfo:l.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(l,r.type),this.updateSourceBufferTimestampOffset_(l),l.isSyncRequest){this.updateTimingInfoEnd_(l),this.syncController_.saveSegmentTimingInfo({segmentInfo:l,shouldSaveTimelineMapping:this.loaderType_==="main"});var A=this.chooseNextRequest_();if(A.mediaIndex!==l.mediaIndex||A.partIndex!==l.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}l.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(l,r)}}},o.updateAppendInitSegmentStatus=function(e,r){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[r]!==e.playlist&&(this.appendInitSegment_[r]=!0)},o.getInitSegmentAndUpdateState_=function(e){var r=e.type,l=e.initSegment,f=e.map,m=e.playlist;if(f){var v=md(f);if(this.activeInitSegmentId_===v)return null;l=this.initSegmentForMap(f,!0).bytes,this.activeInitSegmentId_=v}return l&&this.appendInitSegment_[r]?(this.playlistOfLastInitSegment_[r]=m,this.appendInitSegment_[r]=!1,this.activeInitSegmentId_=null,l):null},o.handleQuotaExceededError_=function(e,r){var l=this,f=e.segmentInfo,m=e.type,v=e.bytes,A=this.sourceUpdater_.audioBuffered(),L=this.sourceUpdater_.videoBuffered();A.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Ms(A).join(", ")),L.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Ms(L).join(", "));var P=A.length?A.start(0):0,U=A.length?A.end(A.length-1):0,W=L.length?L.start(0):0,Y=L.length?L.end(L.length-1):0;if(U-P<=uu&&Y-W<=uu){this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. "+("Appended byte length: "+v.byteLength+", ")+("audio buffer: "+Ms(A).join(", ")+", ")+("video buffer: "+Ms(L).join(", ")+", ")),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:f,type:m,bytes:v}));var q=this.currentTime_(),_e=q-uu;this.logger_("On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to "+_e),this.remove(0,_e,function(){l.logger_("On QUOTA_EXCEEDED_ERR, retrying append in "+uu+"s"),l.waitingOnRemove_=!1,l.quotaExceededErrorRetryTimeout_=ie.setTimeout(function(){l.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),l.quotaExceededErrorRetryTimeout_=null,l.processCallQueue_()},uu*1e3)},!0)},o.handleAppendError_=function(e,r){var l=e.segmentInfo,f=e.type,m=e.bytes;if(r){if(r.code===E_){this.handleQuotaExceededError_({segmentInfo:l,type:f,bytes:m});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error(f+" append of "+m.length+"b failed for segment "+("#"+l.mediaIndex+" in playlist "+l.playlist.id)),this.trigger("appenderror")}},o.appendToSourceBuffer_=function(e){var r=e.segmentInfo,l=e.type,f=e.initSegment,m=e.data,v=e.bytes;if(!v){var A=[m],L=m.byteLength;f&&(A.unshift(f),L+=f.byteLength),v=z2({bytes:L,segments:A})}this.sourceUpdater_.appendBuffer({segmentInfo:r,type:l,bytes:v},this.handleAppendError_.bind(this,{segmentInfo:r,type:l,bytes:v}))},o.handleSegmentTimingInfo_=function(e,r,l){if(!(!this.pendingSegment_||r!==this.pendingSegment_.requestId)){var f=this.pendingSegment_.segment,m=e+"TimingInfo";f[m]||(f[m]={}),f[m].transmuxerPrependedSeconds=l.prependedContentDuration||0,f[m].transmuxedPresentationStart=l.start.presentation,f[m].transmuxedDecodeStart=l.start.decode,f[m].transmuxedPresentationEnd=l.end.presentation,f[m].transmuxedDecodeEnd=l.end.decode,f[m].baseMediaDecodeTime=l.baseMediaDecodeTime}},o.appendData_=function(e,r){var l=r.type,f=r.data;if(!(!f||!f.byteLength)&&!(l==="audio"&&this.audioDisabled_)){var m=this.getInitSegmentAndUpdateState_({type:l,initSegment:r.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:l,initSegment:m,data:f})}},o.loadSegment_=function(e){var r=this;if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){this.loadQueue_.push(function(){var l=ba({},e,{forceTimestampOffset:!0});ba(e,r.generateSegmentInfo_(l)),r.isPendingTimestampOffset_=!1,r.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)},o.updateTransmuxerAndRequestSegment_=function(e){var r=this;this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));var l=this.createSimplifiedSegmentObj_(e),f=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),m=this.mediaIndex!==null,v=e.timeline!==this.currentTimeline_&&e.timeline>0,A=f||m&&v;this.logger_("Requesting "+Io(e)),l.map&&!l.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=F2({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:l,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:A,endedTimelineFn:function(){r.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:function(P){var U=P.message,W=P.level,Y=P.stream;r.logger_(Io(e)+" logged from transmuxer stream "+Y+" as a "+W+": "+U)}})},o.trimBackBuffer_=function(e){var r=nC(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);r>0&&this.remove(0,r)},o.createSimplifiedSegmentObj_=function(e){var r=e.segment,l=e.part,f={resolvedUri:l?l.resolvedUri:r.resolvedUri,byterange:l?l.byterange:r.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},m=e.playlist.segments[e.mediaIndex-1];if(m&&m.timeline===r.timeline&&(m.videoTimingInfo?f.baseStartTime=m.videoTimingInfo.transmuxedDecodeEnd:m.audioTimingInfo&&(f.baseStartTime=m.audioTimingInfo.transmuxedDecodeEnd)),r.key){var v=r.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);f.key=this.segmentKey(r.key),f.key.iv=v}return r.map&&(f.map=this.initSegmentForMap(r.map)),f},o.saveTransferStats_=function(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)},o.saveBandwidthRelatedStats_=function(e,r){if(this.pendingSegment_.byteLength=r.bytesReceived,e<Yc){this.logger_("Ignoring segment's bandwidth because its duration of "+e+(" is less than the min to record "+Yc));return}this.bandwidth=r.bandwidth,this.roundTrip=r.roundTripTime},o.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")},o.segmentRequestFinished_=function(e,r,l){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,r,l));return}if(this.saveTransferStats_(r.stats),!!this.pendingSegment_&&r.requestId===this.pendingSegment_.requestId){if(e){if(this.pendingSegment_=null,this.state="READY",e.code===Qr.ABORTED)return;if(this.pause(),e.code===Qr.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}var f=this.pendingSegment_;this.saveBandwidthRelatedStats_(f.duration,r.stats),f.endOfAllRequests=r.endOfAllRequests,l.gopInfo&&(this.gopBuffer_=Z2(this.gopBuffer_,l.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(f)}},o.setTimeMapping_=function(e){var r=this.syncController_.mappingForTimeline(e);r!==null&&(this.timeMapping_=r)},o.updateMediaSecondsLoaded_=function(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration},o.shouldUpdateTransmuxerTimestampOffset_=function(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()},o.trueSegmentStart_=function(e){var r=e.currentStart,l=e.playlist,f=e.mediaIndex,m=e.firstVideoFrameTimeForData,v=e.currentVideoTimestampOffset,A=e.useVideoTimingInfo,L=e.videoTimingInfo,P=e.audioTimingInfo;if(typeof r<"u")return r;if(!A)return P.start;var U=l.segments[f-1];return f===0||!U||typeof U.start>"u"||U.end!==m+v?m:L.start},o.waitForAppendsToComplete_=function(e){var r=this.getCurrentMediaInfo_(e);if(!r){this.error({message:"No starting media returned, likely due to an unsupported media format.",blacklistDuration:1/0}),this.trigger("error");return}var l=r.hasAudio,f=r.hasVideo,m=r.isMuxed,v=this.loaderType_==="main"&&f,A=!this.audioDisabled_&&l&&!m;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}v&&e.waitingOnAppends++,A&&e.waitingOnAppends++,v&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),A&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))},o.checkAppendsDone_=function(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())},o.checkForIllegalMediaSwitch=function(e){var r=iC(this.loaderType_,this.getCurrentMediaInfo_(),e);return r?(this.error({message:r,blacklistDuration:1/0}),this.trigger("error"),!0):!1},o.updateSourceBufferTimestampOffset_=function(e){if(!(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")){var r=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),r=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),r=!0),r&&this.trigger("timestampoffset")}},o.getSegmentStartTimeForTimestampOffsetCalculation_=function(e){var r=e.videoTimingInfo,l=e.audioTimingInfo,f=e.timingInfo;return this.useDtsForTimestampOffset_?r&&typeof r.transmuxedDecodeStart=="number"?r.transmuxedDecodeStart:l&&typeof l.transmuxedDecodeStart=="number"?l.transmuxedDecodeStart:f.start:f.start},o.updateTimingInfoEnd_=function(e){e.timingInfo=e.timingInfo||{};var r=this.getMediaInfo_(),l=this.loaderType_==="main"&&r&&r.hasVideo,f=l&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;f&&(e.timingInfo.end=typeof f.end=="number"?f.end:f.start+e.duration)},o.handleAppendsDone_=function(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}var e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});var r=sC(e,this.sourceType_);if(r&&(r.severity==="warn"?fe.log.warn(r.message):this.logger_(r.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_("Throwing away un-appended sync request "+Io(e));return}this.logger_("Appended "+Io(e)),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");var l=e.segment,f=e.part,m=l.end&&this.currentTime_()-l.end>e.playlist.targetDuration*3,v=f&&f.end&&this.currentTime_()-f.end>e.playlist.partTargetDuration*3;if(m||v){this.logger_("bad "+(m?"segment":"part")+" "+Io(e)),this.resetEverything();return}var A=this.mediaIndex!==null;A&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()},o.recordThroughput_=function(e){if(e.duration<Yc){this.logger_("Ignoring segment's throughput because its duration of "+e.duration+(" is less than the min to record "+Yc));return}var r=this.throughput.rate,l=Date.now()-e.endOfAllRequests+1,f=Math.floor(e.byteLength/l*8*1e3);this.throughput.rate+=(f-r)/++this.throughput.count},o.addSegmentMetadataCue_=function(e){if(this.segmentMetadataTrack_){var r=e.segment,l=r.start,f=r.end;if(!(!o0(l)||!o0(f))){hu(l,f,this.segmentMetadataTrack_);var m=ie.WebKitDataCue||ie.VTTCue,v={custom:r.custom,dateTimeObject:r.dateTimeObject,dateTimeString:r.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:l,end:f},A=JSON.stringify(v),L=new m(l,f,A);L.value=v,this.segmentMetadataTrack_.addCue(L)}}},s}(fe.EventTarget);function ya(){}var M_=function(s){return typeof s!="string"?s:s.replace(/./,function(o){return o.toUpperCase()})},oC=["video","audio"],Tp=function(s,o){var a=o[s+"Buffer"];return a&&a.updating||o.queuePending[s]},lC=function(s,o){for(var a=0;a<o.length;a++){var e=o[a];if(e.type==="mediaSource")return null;if(e.type===s)return a}return null},fm=function d(s,o){if(o.queue.length!==0){var a=0,e=o.queue[a];if(e.type==="mediaSource"){!o.updating()&&o.mediaSource.readyState!=="closed"&&(o.queue.shift(),e.action(o),e.doneFn&&e.doneFn(),d("audio",o),d("video",o));return}if(s!=="mediaSource"&&!(!o.ready()||o.mediaSource.readyState==="closed"||Tp(s,o))){if(e.type!==s){if(a=lC(s,o.queue),a===null)return;e=o.queue[a]}if(o.queue.splice(a,1),o.queuePending[s]=e,e.action(s,o),!e.doneFn){o.queuePending[s]=null,d(s,o);return}}}},C_=function(s,o){var a=o[s+"Buffer"],e=M_(s);a&&(a.removeEventListener("updateend",o["on"+e+"UpdateEnd_"]),a.removeEventListener("error",o["on"+e+"Error_"]),o.codecs[s]=null,o[s+"Buffer"]=null)},jr=function(s,o){return s&&o&&Array.prototype.indexOf.call(s.sourceBuffers,o)!==-1},Qn={appendBuffer:function(s,o,a){return function(e,r){var l=r[e+"Buffer"];if(jr(r.mediaSource,l)){r.logger_("Appending segment "+o.mediaIndex+"'s "+s.length+" bytes to "+e+"Buffer");try{l.appendBuffer(s)}catch(f){r.logger_("Error with code "+f.code+" "+(f.code===E_?"(QUOTA_EXCEEDED_ERR) ":"")+("when appending segment "+o.mediaIndex+" to "+e+"Buffer")),r.queuePending[e]=null,a(f)}}}},remove:function(s,o){return function(a,e){var r=e[a+"Buffer"];if(jr(e.mediaSource,r)){e.logger_("Removing "+s+" to "+o+" from "+a+"Buffer");try{r.remove(s,o)}catch{e.logger_("Remove "+s+" to "+o+" from "+a+"Buffer failed")}}}},timestampOffset:function(s){return function(o,a){var e=a[o+"Buffer"];jr(a.mediaSource,e)&&(a.logger_("Setting "+o+"timestampOffset to "+s),e.timestampOffset=s)}},callback:function(s){return function(o,a){s()}},endOfStream:function(s){return function(o){if(o.mediaSource.readyState==="open"){o.logger_("Calling mediaSource endOfStream("+(s||"")+")");try{o.mediaSource.endOfStream(s)}catch(a){fe.log.warn("Failed to call media source endOfStream",a)}}}},duration:function(s){return function(o){o.logger_("Setting mediaSource duration to "+s);try{o.mediaSource.duration=s}catch(a){fe.log.warn("Failed to set media source duration",a)}}},abort:function(){return function(s,o){if(o.mediaSource.readyState==="open"){var a=o[s+"Buffer"];if(jr(o.mediaSource,a)){o.logger_("calling abort on "+s+"Buffer");try{a.abort()}catch(e){fe.log.warn("Failed to abort on "+s+"Buffer",e)}}}}},addSourceBuffer:function(s,o){return function(a){var e=M_(s),r=gu(o);a.logger_("Adding "+s+"Buffer with codec "+o+" to mediaSource");var l=a.mediaSource.addSourceBuffer(r);l.addEventListener("updateend",a["on"+e+"UpdateEnd_"]),l.addEventListener("error",a["on"+e+"Error_"]),a.codecs[s]=o,a[s+"Buffer"]=l}},removeSourceBuffer:function(s){return function(o){var a=o[s+"Buffer"];if(C_(s,o),!!jr(o.mediaSource,a)){o.logger_("Removing "+s+"Buffer with codec "+o.codecs[s]+" from mediaSource");try{o.mediaSource.removeSourceBuffer(a)}catch(e){fe.log.warn("Failed to removeSourceBuffer "+s+"Buffer",e)}}}},changeType:function(s){return function(o,a){var e=a[o+"Buffer"],r=gu(s);if(jr(a.mediaSource,e)&&a.codecs[o]!==s){a.logger_("changing "+o+"Buffer codec from "+a.codecs[o]+" to "+s);try{e.changeType(r),a.codecs[o]=s}catch(l){fe.log.warn("Failed to changeType on "+o+"Buffer",l)}}}}},Yn=function(s){var o=s.type,a=s.sourceUpdater,e=s.action,r=s.doneFn,l=s.name;a.queue.push({type:o,action:e,doneFn:r,name:l}),fm(o,a)},d0=function(s,o){return function(a){if(o.queuePending[s]){var e=o.queuePending[s].doneFn;o.queuePending[s]=null,e&&e(o[s+"Error_"])}fm(s,o)}},P_=function(d){it(s,d);function s(a){var e;return e=d.call(this)||this,e.mediaSource=a,e.sourceopenListener_=function(){return fm("mediaSource",Ft(e))},e.mediaSource.addEventListener("sourceopen",e.sourceopenListener_),e.logger_=Er("SourceUpdater"),e.audioTimestampOffset_=0,e.videoTimestampOffset_=0,e.queue=[],e.queuePending={audio:null,video:null},e.delayedAudioAppendQueue_=[],e.videoAppendQueued_=!1,e.codecs={},e.onVideoUpdateEnd_=d0("video",Ft(e)),e.onAudioUpdateEnd_=d0("audio",Ft(e)),e.onVideoError_=function(r){e.videoError_=r},e.onAudioError_=function(r){e.audioError_=r},e.createdSourceBuffers_=!1,e.initializedEme_=!1,e.triggeredReady_=!1,e}var o=s.prototype;return o.initializedEme=function(){this.initializedEme_=!0,this.triggerReady()},o.hasCreatedSourceBuffers=function(){return this.createdSourceBuffers_},o.hasInitializedAnyEme=function(){return this.initializedEme_},o.ready=function(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()},o.createSourceBuffers=function(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())},o.triggerReady=function(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))},o.addSourceBuffer=function(e,r){Yn({type:"mediaSource",sourceUpdater:this,action:Qn.addSourceBuffer(e,r),name:"addSourceBuffer"})},o.abort=function(e){Yn({type:e,sourceUpdater:this,action:Qn.abort(e),name:"abort"})},o.removeSourceBuffer=function(e){if(!this.canRemoveSourceBuffer()){fe.log.error("removeSourceBuffer is not supported!");return}Yn({type:"mediaSource",sourceUpdater:this,action:Qn.removeSourceBuffer(e),name:"removeSourceBuffer"})},o.canRemoveSourceBuffer=function(){return!fe.browser.IE_VERSION&&!fe.browser.IS_FIREFOX&&ie.MediaSource&&ie.MediaSource.prototype&&typeof ie.MediaSource.prototype.removeSourceBuffer=="function"},s.canChangeType=function(){return ie.SourceBuffer&&ie.SourceBuffer.prototype&&typeof ie.SourceBuffer.prototype.changeType=="function"},o.canChangeType=function(){return this.constructor.canChangeType()},o.changeType=function(e,r){if(!this.canChangeType()){fe.log.error("changeType is not supported!");return}Yn({type:e,sourceUpdater:this,action:Qn.changeType(r),name:"changeType"})},o.addOrChangeSourceBuffers=function(e){var r=this;if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(function(l){var f=e[l];if(!r.hasCreatedSourceBuffers())return r.addSourceBuffer(l,f);r.canChangeType()&&r.changeType(l,f)})},o.appendBuffer=function(e,r){var l=this,f=e.segmentInfo,m=e.type,v=e.bytes;if(this.processedAppend_=!0,m==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,r]),this.logger_("delayed audio append of "+v.length+" until video append");return}var A=r;if(Yn({type:m,sourceUpdater:this,action:Qn.appendBuffer(v,f||{mediaIndex:-1},A),doneFn:r,name:"appendBuffer"}),m==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;var L=this.delayedAudioAppendQueue_.slice();this.logger_("queuing delayed audio "+L.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,L.forEach(function(P){l.appendBuffer.apply(l,P)})}},o.audioBuffered=function(){return jr(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:fe.createTimeRange()},o.videoBuffered=function(){return jr(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:fe.createTimeRange()},o.buffered=function(){var e=jr(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,r=jr(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return r&&!e?this.audioBuffered():e&&!r?this.videoBuffered():EM(this.audioBuffered(),this.videoBuffered())},o.setDuration=function(e,r){r===void 0&&(r=ya),Yn({type:"mediaSource",sourceUpdater:this,action:Qn.duration(e),name:"duration",doneFn:r})},o.endOfStream=function(e,r){e===void 0&&(e=null),r===void 0&&(r=ya),typeof e!="string"&&(e=void 0),Yn({type:"mediaSource",sourceUpdater:this,action:Qn.endOfStream(e),name:"endOfStream",doneFn:r})},o.removeAudio=function(e,r,l){if(l===void 0&&(l=ya),!this.audioBuffered().length||this.audioBuffered().end(0)===0){l();return}Yn({type:"audio",sourceUpdater:this,action:Qn.remove(e,r),doneFn:l,name:"remove"})},o.removeVideo=function(e,r,l){if(l===void 0&&(l=ya),!this.videoBuffered().length||this.videoBuffered().end(0)===0){l();return}Yn({type:"video",sourceUpdater:this,action:Qn.remove(e,r),doneFn:l,name:"remove"})},o.updating=function(){return!!(Tp("audio",this)||Tp("video",this))},o.audioTimestampOffset=function(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Yn({type:"audio",sourceUpdater:this,action:Qn.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_},o.videoTimestampOffset=function(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset!==e&&(Yn({type:"video",sourceUpdater:this,action:Qn.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_},o.audioQueueCallback=function(e){this.audioBuffer&&Yn({type:"audio",sourceUpdater:this,action:Qn.callback(e),name:"callback"})},o.videoQueueCallback=function(e){this.videoBuffer&&Yn({type:"video",sourceUpdater:this,action:Qn.callback(e),name:"callback"})},o.dispose=function(){var e=this;this.trigger("dispose"),oC.forEach(function(r){e.abort(r),e.canRemoveSourceBuffer()?e.removeSourceBuffer(r):e[r+"QueueCallback"](function(){return C_(r,e)})}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()},s}(fe.EventTarget),h0=function(s){return decodeURIComponent(escape(String.fromCharCode.apply(null,s)))},f0=new Uint8Array(`

`.split("").map(function(d){return d.charCodeAt(0)})),uC=function(d){it(s,d);function s(){return d.call(this,"Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")||this}return s}(np(Error)),cC=function(d){it(s,d);function s(a,e){var r;return e===void 0&&(e={}),r=d.call(this,a,e)||this,r.mediaSource_=null,r.subtitlesTrack_=null,r.loaderType_="subtitle",r.featuresNativeTextTracks_=a.featuresNativeTextTracks,r.loadVttJs=a.loadVttJs,r.shouldSaveSegmentTimingInfo_=!1,r}var o=s.prototype;return o.createTransmuxer_=function(){return null},o.buffered_=function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return fe.createTimeRanges();var e=this.subtitlesTrack_.cues,r=e[0].startTime,l=e[e.length-1].startTime;return fe.createTimeRanges([[r,l]])},o.initSegmentForMap=function(e,r){if(r===void 0&&(r=!1),!e)return null;var l=md(e),f=this.initSegments_[l];if(r&&!f&&e.bytes){var m=f0.byteLength+e.bytes.byteLength,v=new Uint8Array(m);v.set(e.bytes),v.set(f0,e.bytes.byteLength),this.initSegments_[l]=f={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:v}}return f||e},o.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},o.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},o.track=function(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)},o.remove=function(e,r){hu(e,r,this.subtitlesTrack_)},o.fillBuffer_=function(){var e=this,r=this.chooseNextRequest_();if(r){if(this.syncController_.timestampOffsetForTimeline(r.timeline)===null){var l=function(){e.state="READY",e.paused()||e.monitorBuffer_()};this.syncController_.one("timestampoffset",l),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(r)}},o.timestampOffsetForSegment_=function(){return null},o.chooseNextRequest_=function(){return this.skipEmptySegments_(d.prototype.chooseNextRequest_.call(this))},o.skipEmptySegments_=function(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e},o.stopForError=function(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")},o.segmentRequestFinished_=function(e,r,l){var f=this;if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(r.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===Qr.TIMEOUT&&this.handleTimeout_(),e.code===Qr.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}var m=this.pendingSegment_;this.saveBandwidthRelatedStats_(m.duration,r.stats),r.key&&this.segmentKey(r.key,!0),this.state="APPENDING",this.trigger("appending");var v=m.segment;if(v.map&&(v.map.bytes=r.map.bytes),m.bytes=r.bytes,typeof ie.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(function(){return f.segmentRequestFinished_(e,r,l)},function(){return f.stopForError({message:"Error loading vtt.js"})});return}v.requested=!0;try{this.parseVTTCues_(m)}catch(A){this.stopForError({message:A.message});return}if(this.updateTimeMapping_(m,this.syncController_.timelines[m.timeline],this.playlist_),m.cues.length?m.timingInfo={start:m.cues[0].startTime,end:m.cues[m.cues.length-1].endTime}:m.timingInfo={start:m.startOfSegment,end:m.startOfSegment+m.duration},m.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}m.byteLength=m.bytes.byteLength,this.mediaSecondsLoaded+=v.duration,m.cues.forEach(function(A){f.subtitlesTrack_.addCue(f.featuresNativeTextTracks_?new ie.VTTCue(A.startTime,A.endTime,A.text):A)}),Y2(this.subtitlesTrack_),this.handleAppendsDone_()},o.handleData_=function(){},o.updateTimingInfoEnd_=function(){},o.parseVTTCues_=function(e){var r,l=!1;if(typeof ie.WebVTT!="function")throw new uC;typeof ie.TextDecoder=="function"?r=new ie.TextDecoder("utf8"):(r=ie.WebVTT.StringDecoder(),l=!0);var f=new ie.WebVTT.Parser(ie,ie.vttjs,r);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},f.oncue=e.cues.push.bind(e.cues),f.ontimestampmap=function(A){e.timestampmap=A},f.onparsingerror=function(A){fe.log.warn("Error encountered when parsing cues: "+A.message)},e.segment.map){var m=e.segment.map.bytes;l&&(m=h0(m)),f.parse(m)}var v=e.bytes;l&&(v=h0(v)),f.parse(v),f.flush()},o.updateTimeMapping_=function(e,r,l){var f=e.segment;if(r){if(!e.cues.length){f.empty=!0;return}var m=e.timestampmap,v=m.MPEGTS/nd.ONE_SECOND_IN_TS-m.LOCAL+r.mapping;if(e.cues.forEach(function(P){P.startTime+=v,P.endTime+=v}),!l.syncInfo){var A=e.cues[0].startTime,L=e.cues[e.cues.length-1].startTime;l.syncInfo={mediaSequence:l.mediaSequence+e.mediaIndex,time:Math.min(A,L-f.duration)}}}},s}(bp),dC=function(s,o){for(var a=s.cues,e=0;e<a.length;e++){var r=a[e];if(o>=r.adStartTime&&o<=r.adEndTime)return r}return null},hC=function(s,o,a){if(a===void 0&&(a=0),!!s.segments)for(var e=a,r,l=0;l<s.segments.length;l++){var f=s.segments[l];if(r||(r=dC(o,e+f.duration/2)),r){if("cueIn"in f){r.endTime=e,r.adEndTime=e,e+=f.duration,r=null;continue}if(e<r.endTime){e+=f.duration;continue}r.endTime+=f.duration}else if("cueOut"in f&&(r=new ie.VTTCue(e,e+f.duration,f.cueOut),r.adStartTime=e,r.adEndTime=e+parseFloat(f.cueOut),o.addCue(r)),"cueOutCont"in f){var m=f.cueOutCont.split("/").map(parseFloat),v=m[0],A=m[1];r=new ie.VTTCue(e,e+f.duration,""),r.adStartTime=e-v,r.adEndTime=r.adStartTime+A,o.addCue(r)}e+=f.duration}},fC=86400,p0=[{name:"VOD",run:function(s,o,a,e,r){if(a!==1/0){var l={time:0,segmentIndex:0,partIndex:null};return l}return null}},{name:"ProgramDateTime",run:function(s,o,a,e,r){if(!Object.keys(s.timelineToDatetimeMappings).length)return null;var l=null,f=null,m=fp(o);r=r||0;for(var v=0;v<m.length;v++){var A=o.endList||r===0?v:m.length-(v+1),L=m[A],P=L.segment,U=s.timelineToDatetimeMappings[P.timeline];if(!(!U||!P.dateTimeObject)){var W=P.dateTimeObject.getTime()/1e3,Y=W+U;if(P.parts&&typeof L.partIndex=="number")for(var q=0;q<L.partIndex;q++)Y+=P.parts[q].duration;var _e=Math.abs(r-Y);if(f!==null&&(_e===0||f<_e))break;f=_e,l={time:Y,segmentIndex:L.segmentIndex,partIndex:L.partIndex}}}return l}},{name:"Segment",run:function(s,o,a,e,r){var l=null,f=null;r=r||0;for(var m=fp(o),v=0;v<m.length;v++){var A=o.endList||r===0?v:m.length-(v+1),L=m[A],P=L.segment,U=L.part&&L.part.start||P&&P.start;if(P.timeline===e&&typeof U<"u"){var W=Math.abs(r-U);if(f!==null&&f<W)break;(!l||f===null||f>=W)&&(f=W,l={time:U,segmentIndex:L.segmentIndex,partIndex:L.partIndex})}}return l}},{name:"Discontinuity",run:function(s,o,a,e,r){var l=null;if(r=r||0,o.discontinuityStarts&&o.discontinuityStarts.length)for(var f=null,m=0;m<o.discontinuityStarts.length;m++){var v=o.discontinuityStarts[m],A=o.discontinuitySequence+m+1,L=s.discontinuities[A];if(L){var P=Math.abs(r-L.time);if(f!==null&&f<P)break;(!l||f===null||f>=P)&&(f=P,l={time:L.time,segmentIndex:v,partIndex:null})}}return l}},{name:"Playlist",run:function(s,o,a,e,r){if(o.syncInfo){var l={time:o.syncInfo.time,segmentIndex:o.syncInfo.mediaSequence-o.mediaSequence,partIndex:null};return l}return null}}],pC=function(d){it(s,d);function s(a){var e;return e=d.call(this)||this,e.timelines=[],e.discontinuities=[],e.timelineToDatetimeMappings={},e.logger_=Er("SyncController"),e}var o=s.prototype;return o.getSyncPoint=function(e,r,l,f){var m=this.runStrategies_(e,r,l,f);return m.length?this.selectSyncPoint_(m,{key:"time",value:f}):null},o.getExpiredTime=function(e,r){if(!e||!e.segments)return null;var l=this.runStrategies_(e,r,e.discontinuitySequence,0);if(!l.length)return null;var f=this.selectSyncPoint_(l,{key:"segmentIndex",value:0});return f.segmentIndex>0&&(f.time*=-1),Math.abs(f.time+pu({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:f.segmentIndex,endIndex:0}))},o.runStrategies_=function(e,r,l,f){for(var m=[],v=0;v<p0.length;v++){var A=p0[v],L=A.run(this,e,r,l,f);L&&(L.strategy=A.name,m.push({strategy:A.name,syncPoint:L}))}return m},o.selectSyncPoint_=function(e,r){for(var l=e[0].syncPoint,f=Math.abs(e[0].syncPoint[r.key]-r.value),m=e[0].strategy,v=1;v<e.length;v++){var A=Math.abs(e[v].syncPoint[r.key]-r.value);A<f&&(f=A,l=e[v].syncPoint,m=e[v].strategy)}return this.logger_("syncPoint for ["+r.key+": "+r.value+"] chosen with strategy"+(" ["+m+"]: [time:"+l.time+",")+(" segmentIndex:"+l.segmentIndex)+(typeof l.partIndex=="number"?",partIndex:"+l.partIndex:"")+"]"),l},o.saveExpiredSegmentInfo=function(e,r){var l=r.mediaSequence-e.mediaSequence;if(l>fC){fe.log.warn("Not saving expired segment info. Media sequence gap "+l+" is too large.");return}for(var f=l-1;f>=0;f--){var m=e.segments[f];if(m&&typeof m.start<"u"){r.syncInfo={mediaSequence:e.mediaSequence+f,time:m.start},this.logger_("playlist refresh sync: [time:"+r.syncInfo.time+","+(" mediaSequence: "+r.syncInfo.mediaSequence+"]")),this.trigger("syncinfoupdate");break}}},o.setDateTimeMappingForStart=function(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var r=e.segments[0],l=r.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[r.timeline]=-l}},o.saveSegmentTimingInfo=function(e){var r=e.segmentInfo,l=e.shouldSaveTimelineMapping,f=this.calculateSegmentTimeMapping_(r,r.timingInfo,l),m=r.segment;f&&(this.saveDiscontinuitySyncInfo_(r),r.playlist.syncInfo||(r.playlist.syncInfo={mediaSequence:r.playlist.mediaSequence+r.mediaIndex,time:m.start}));var v=m.dateTimeObject;m.discontinuity&&l&&v&&(this.timelineToDatetimeMappings[m.timeline]=-(v.getTime()/1e3))},o.timestampOffsetForTimeline=function(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time},o.mappingForTimeline=function(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping},o.calculateSegmentTimeMapping_=function(e,r,l){var f=e.segment,m=e.part,v=this.timelines[e.timeline],A,L;if(typeof e.timestampOffset=="number")v={time:e.startOfSegment,mapping:e.startOfSegment-r.start},l&&(this.timelines[e.timeline]=v,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": "+("[time: "+v.time+"] [mapping: "+v.mapping+"]"))),A=e.startOfSegment,L=r.end+v.mapping;else if(v)A=r.start+v.mapping,L=r.end+v.mapping;else return!1;return m&&(m.start=A,m.end=L),(!f.start||A<f.start)&&(f.start=A),f.end=L,!0},o.saveDiscontinuitySyncInfo_=function(e){var r=e.playlist,l=e.segment;if(l.discontinuity)this.discontinuities[l.timeline]={time:l.start,accuracy:0};else if(r.discontinuityStarts&&r.discontinuityStarts.length)for(var f=0;f<r.discontinuityStarts.length;f++){var m=r.discontinuityStarts[f],v=r.discontinuitySequence+f+1,A=m-e.mediaIndex,L=Math.abs(A);if(!this.discontinuities[v]||this.discontinuities[v].accuracy>L){var P=void 0;A<0?P=l.start-pu({defaultDuration:r.targetDuration,durationList:r.segments,startIndex:e.mediaIndex,endIndex:m}):P=l.end+pu({defaultDuration:r.targetDuration,durationList:r.segments,startIndex:e.mediaIndex+1,endIndex:m}),this.discontinuities[v]={time:P,accuracy:L}}}},o.dispose=function(){this.trigger("dispose"),this.off()},s}(fe.EventTarget),mC=function(d){it(s,d);function s(){var a;return a=d.call(this)||this,a.pendingTimelineChanges_={},a.lastTimelineChanges_={},a}var o=s.prototype;return o.clearPendingTimelineChange=function(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")},o.pendingTimelineChange=function(e){var r=e.type,l=e.from,f=e.to;return typeof l=="number"&&typeof f=="number"&&(this.pendingTimelineChanges_[r]={type:r,from:l,to:f},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[r]},o.lastTimelineChange=function(e){var r=e.type,l=e.from,f=e.to;return typeof l=="number"&&typeof f=="number"&&(this.lastTimelineChanges_[r]={type:r,from:l,to:f},delete this.pendingTimelineChanges_[r],this.trigger("timelinechange")),this.lastTimelineChanges_[r]},o.dispose=function(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()},s}(fe.EventTarget),gC=m_(g_(function(){var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function s(Me,Le,ze){return ze={path:Le,exports:{},require:function(Ee,We){return o(Ee,We??ze.path)}},Me(ze,ze.exports),ze.exports}function o(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var a=s(function(Me){function Le(De,Ee){for(var We=0;We<Ee.length;We++){var Ce=Ee[We];Ce.enumerable=Ce.enumerable||!1,Ce.configurable=!0,"value"in Ce&&(Ce.writable=!0),Object.defineProperty(De,Ce.key,Ce)}}function ze(De,Ee,We){return Ee&&Le(De.prototype,Ee),We&&Le(De,We),De}Me.exports=ze,Me.exports.default=Me.exports,Me.exports.__esModule=!0}),e=s(function(Me){function Le(ze,De){return Me.exports=Le=Object.setPrototypeOf||function(We,Ce){return We.__proto__=Ce,We},Me.exports.default=Me.exports,Me.exports.__esModule=!0,Le(ze,De)}Me.exports=Le,Me.exports.default=Me.exports,Me.exports.__esModule=!0}),r=s(function(Me){function Le(ze,De){ze.prototype=Object.create(De.prototype),ze.prototype.constructor=ze,e(ze,De)}Me.exports=Le,Me.exports.default=Me.exports,Me.exports.__esModule=!0}),l=function(){function Me(){this.listeners={}}var Le=Me.prototype;return Le.on=function(De,Ee){this.listeners[De]||(this.listeners[De]=[]),this.listeners[De].push(Ee)},Le.off=function(De,Ee){if(!this.listeners[De])return!1;var We=this.listeners[De].indexOf(Ee);return this.listeners[De]=this.listeners[De].slice(0),this.listeners[De].splice(We,1),We>-1},Le.trigger=function(De){var Ee=this.listeners[De];if(Ee)if(arguments.length===2)for(var We=Ee.length,Ce=0;Ce<We;++Ce)Ee[Ce].call(this,arguments[1]);else for(var vt=Array.prototype.slice.call(arguments,1),je=Ee.length,ut=0;ut<je;++ut)Ee[ut].apply(this,vt)},Le.dispose=function(){this.listeners={}},Le.pipe=function(De){this.on("data",function(Ee){De.push(Ee)})},Me}();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function f(Me){return Me.subarray(0,Me.byteLength-Me[Me.byteLength-1])}/*! @name aes-decrypter @version 3.1.3 @license Apache-2.0 */var m=function(){var Le=[[[],[],[],[],[]],[[],[],[],[],[]]],ze=Le[0],De=Le[1],Ee=ze[4],We=De[4],Ce,vt,je,ut=[],Kt=[],Jt,hi,Oi,vi,$i,li;for(Ce=0;Ce<256;Ce++)Kt[(ut[Ce]=Ce<<1^(Ce>>7)*283)^Ce]=Ce;for(vt=je=0;!Ee[vt];vt^=Jt||1,je=Kt[je]||1)for(vi=je^je<<1^je<<2^je<<3^je<<4,vi=vi>>8^vi&255^99,Ee[vt]=vi,We[vi]=vt,Oi=ut[hi=ut[Jt=ut[vt]]],li=Oi*16843009^hi*65537^Jt*257^vt*16843008,$i=ut[vi]*257^vi*16843008,Ce=0;Ce<4;Ce++)ze[Ce][vt]=$i=$i<<24^$i>>>8,De[Ce][vi]=li=li<<24^li>>>8;for(Ce=0;Ce<5;Ce++)ze[Ce]=ze[Ce].slice(0),De[Ce]=De[Ce].slice(0);return Le},v=null,A=function(){function Me(ze){v||(v=m()),this._tables=[[v[0][0].slice(),v[0][1].slice(),v[0][2].slice(),v[0][3].slice(),v[0][4].slice()],[v[1][0].slice(),v[1][1].slice(),v[1][2].slice(),v[1][3].slice(),v[1][4].slice()]];var De,Ee,We,Ce=this._tables[0][4],vt=this._tables[1],je=ze.length,ut=1;if(je!==4&&je!==6&&je!==8)throw new Error("Invalid aes key size");var Kt=ze.slice(0),Jt=[];for(this._key=[Kt,Jt],De=je;De<4*je+28;De++)We=Kt[De-1],(De%je===0||je===8&&De%je===4)&&(We=Ce[We>>>24]<<24^Ce[We>>16&255]<<16^Ce[We>>8&255]<<8^Ce[We&255],De%je===0&&(We=We<<8^We>>>24^ut<<24,ut=ut<<1^(ut>>7)*283)),Kt[De]=Kt[De-je]^We;for(Ee=0;De;Ee++,De--)We=Kt[Ee&3?De:De-4],De<=4||Ee<4?Jt[Ee]=We:Jt[Ee]=vt[0][Ce[We>>>24]]^vt[1][Ce[We>>16&255]]^vt[2][Ce[We>>8&255]]^vt[3][Ce[We&255]]}var Le=Me.prototype;return Le.decrypt=function(De,Ee,We,Ce,vt,je){var ut=this._key[1],Kt=De^ut[0],Jt=Ce^ut[1],hi=We^ut[2],Oi=Ee^ut[3],vi,$i,li,lr=ut.length/4-2,Mn,ur=4,cr=this._tables[1],Mr=cr[0],Zn=cr[1],Ma=cr[2],Ca=cr[3],Pa=cr[4];for(Mn=0;Mn<lr;Mn++)vi=Mr[Kt>>>24]^Zn[Jt>>16&255]^Ma[hi>>8&255]^Ca[Oi&255]^ut[ur],$i=Mr[Jt>>>24]^Zn[hi>>16&255]^Ma[Oi>>8&255]^Ca[Kt&255]^ut[ur+1],li=Mr[hi>>>24]^Zn[Oi>>16&255]^Ma[Kt>>8&255]^Ca[Jt&255]^ut[ur+2],Oi=Mr[Oi>>>24]^Zn[Kt>>16&255]^Ma[Jt>>8&255]^Ca[hi&255]^ut[ur+3],ur+=4,Kt=vi,Jt=$i,hi=li;for(Mn=0;Mn<4;Mn++)vt[(3&-Mn)+je]=Pa[Kt>>>24]<<24^Pa[Jt>>16&255]<<16^Pa[hi>>8&255]<<8^Pa[Oi&255]^ut[ur++],vi=Kt,Kt=Jt,Jt=hi,hi=Oi,Oi=vi},Me}(),L=function(Me){r(Le,Me);function Le(){var De;return De=Me.call(this,l)||this,De.jobs=[],De.delay=1,De.timeout_=null,De}var ze=Le.prototype;return ze.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},ze.push=function(Ee){this.jobs.push(Ee),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},Le}(l),P=function(Le){return Le<<24|(Le&65280)<<8|(Le&16711680)>>8|Le>>>24},U=function(Le,ze,De){var Ee=new Int32Array(Le.buffer,Le.byteOffset,Le.byteLength>>2),We=new A(Array.prototype.slice.call(ze)),Ce=new Uint8Array(Le.byteLength),vt=new Int32Array(Ce.buffer),je,ut,Kt,Jt,hi,Oi,vi,$i,li;for(je=De[0],ut=De[1],Kt=De[2],Jt=De[3],li=0;li<Ee.length;li+=4)hi=P(Ee[li]),Oi=P(Ee[li+1]),vi=P(Ee[li+2]),$i=P(Ee[li+3]),We.decrypt(hi,Oi,vi,$i,vt,li),vt[li]=P(vt[li]^je),vt[li+1]=P(vt[li+1]^ut),vt[li+2]=P(vt[li+2]^Kt),vt[li+3]=P(vt[li+3]^Jt),je=hi,ut=Oi,Kt=vi,Jt=$i;return Ce},W=function(){function Me(ze,De,Ee,We){var Ce=Me.STEP,vt=new Int32Array(ze.buffer),je=new Uint8Array(ze.byteLength),ut=0;for(this.asyncStream_=new L,this.asyncStream_.push(this.decryptChunk_(vt.subarray(ut,ut+Ce),De,Ee,je)),ut=Ce;ut<vt.length;ut+=Ce)Ee=new Uint32Array([P(vt[ut-4]),P(vt[ut-3]),P(vt[ut-2]),P(vt[ut-1])]),this.asyncStream_.push(this.decryptChunk_(vt.subarray(ut,ut+Ce),De,Ee,je));this.asyncStream_.push(function(){We(null,f(je))})}var Le=Me.prototype;return Le.decryptChunk_=function(De,Ee,We,Ce){return function(){var vt=U(De,Ee,We);Ce.set(vt,De.byteOffset)}},a(Me,null,[{key:"STEP",get:function(){return 32e3}}]),Me}(),Y;typeof window<"u"?Y=window:typeof d<"u"?Y=d:typeof self<"u"?Y=self:Y={};var q=Y,_e=function(Le){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(Le):Le&&Le.buffer instanceof ArrayBuffer},J=q.BigInt||Number;J("0x1"),J("0x100"),J("0x10000"),J("0x1000000"),J("0x100000000"),J("0x10000000000"),J("0x1000000000000"),J("0x100000000000000"),J("0x10000000000000000");var at=function(Le){var ze={};return Object.keys(Le).forEach(function(De){var Ee=Le[De];_e(Ee)?ze[De]={bytes:Ee.buffer,byteOffset:Ee.byteOffset,byteLength:Ee.byteLength}:ze[De]=Ee}),ze};self.onmessage=function(Me){var Le=Me.data,ze=new Uint8Array(Le.encrypted.bytes,Le.encrypted.byteOffset,Le.encrypted.byteLength),De=new Uint32Array(Le.key.bytes,Le.key.byteOffset,Le.key.byteLength/4),Ee=new Uint32Array(Le.iv.bytes,Le.iv.byteOffset,Le.iv.byteLength/4);new W(ze,De,Ee,function(We,Ce){self.postMessage(at({source:Le.source,decrypted:Ce}),[Ce.buffer])})}})),vC=p_(gC),yC=function(s){var o=s.default?"main":"alternative";return s.characteristics&&s.characteristics.indexOf("public.accessibility.describes-video")>=0&&(o="main-desc"),o},_d=function(s,o){s.abort(),s.pause(),o&&o.activePlaylistLoader&&(o.activePlaylistLoader.pause(),o.activePlaylistLoader=null)},Ap=function(s,o){o.activePlaylistLoader=s,s.load()},_C=function(s,o){return function(){var a=o.segmentLoaders,e=a[s],r=a.main,l=o.mediaTypes[s],f=l.activeTrack(),m=l.getActiveGroup(),v=l.activePlaylistLoader,A=l.lastGroup_;if(!(m&&A&&m.id===A.id)&&(l.lastGroup_=m,l.lastTrack_=f,_d(e,l),!(!m||m.isMasterPlaylist))){if(!m.playlistLoader){v&&r.resetEverything();return}e.resyncLoader(),Ap(m.playlistLoader,l)}}},xC=function(s,o){return function(){var a=o.segmentLoaders[s],e=o.mediaTypes[s];e.lastGroup_=null,a.abort(),a.pause()}},bC=function(s,o){return function(){var a=o.masterPlaylistLoader,e=o.segmentLoaders,r=e[s],l=e.main,f=o.mediaTypes[s],m=f.activeTrack(),v=f.getActiveGroup(),A=f.activePlaylistLoader,L=f.lastTrack_;if(!(L&&m&&L.id===m.id)&&(f.lastGroup_=v,f.lastTrack_=m,_d(r,f),!!v)){if(v.isMasterPlaylist){if(!m||!L||m.id===L.id)return;var P=o.vhs.masterPlaylistController_,U=P.selectPlaylist();if(P.media()===U)return;f.logger_("track change. Switching master audio from "+L.id+" to "+m.id),a.pause(),l.resetEverything(),P.fastQualityChange_(U);return}if(s==="AUDIO"){if(!v.playlistLoader){l.setAudio(!0),l.resetEverything();return}r.setAudio(!0),l.setAudio(!1)}if(A===v.playlistLoader){Ap(v.playlistLoader,f);return}r.track&&r.track(m),r.resetEverything(),Ap(v.playlistLoader,f)}}},xd={AUDIO:function(s,o){return function(){var a=o.segmentLoaders[s],e=o.mediaTypes[s],r=o.blacklistCurrentPlaylist;_d(a,e);var l=e.activeTrack(),f=e.activeGroup(),m=(f.filter(function(L){return L.default})[0]||f[0]).id,v=e.tracks[m];if(l===v){r({message:"Problem encountered loading the default audio track."});return}fe.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(var A in e.tracks)e.tracks[A].enabled=e.tracks[A]===v;e.onTrackChanged()}},SUBTITLES:function(s,o){return function(){var a=o.segmentLoaders[s],e=o.mediaTypes[s];fe.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),_d(a,e);var r=e.activeTrack();r&&(r.mode="disabled"),e.onTrackChanged()}}},m0={AUDIO:function(s,o,a){if(o){var e=a.tech,r=a.requestOptions,l=a.segmentLoaders[s];o.on("loadedmetadata",function(){var f=o.media();l.playlist(f,r),(!e.paused()||f.endList&&e.preload()!=="none")&&l.load()}),o.on("loadedplaylist",function(){l.playlist(o.media(),r),e.paused()||l.load()}),o.on("error",xd[s](s,a))}},SUBTITLES:function(s,o,a){var e=a.tech,r=a.requestOptions,l=a.segmentLoaders[s],f=a.mediaTypes[s];o.on("loadedmetadata",function(){var m=o.media();l.playlist(m,r),l.track(f.activeTrack()),(!e.paused()||m.endList&&e.preload()!=="none")&&l.load()}),o.on("loadedplaylist",function(){l.playlist(o.media(),r),e.paused()||l.load()}),o.on("error",xd[s](s,a))}},TC={AUDIO:function(s,o){var a=o.vhs,e=o.sourceType,r=o.segmentLoaders[s],l=o.requestOptions,f=o.master.mediaGroups,m=o.mediaTypes[s],v=m.groups,A=m.tracks,L=m.logger_,P=o.masterPlaylistLoader,U=Pu(P.master);(!f[s]||Object.keys(f[s]).length===0)&&(f[s]={main:{default:{default:!0}}},U&&(f[s].main.default.playlists=P.master.playlists));for(var W in f[s]){v[W]||(v[W]=[]);for(var Y in f[s][W]){var q=f[s][W][Y],_e=void 0;if(U?(L("AUDIO group '"+W+"' label '"+Y+"' is a master playlist"),q.isMasterPlaylist=!0,_e=null):e==="vhs-json"&&q.playlists?_e=new Oo(q.playlists[0],a,l):q.resolvedUri?_e=new Oo(q.resolvedUri,a,l):q.playlists&&e==="dash"?_e=new _p(q.playlists[0],a,l,P):_e=null,q=fe.mergeOptions({id:Y,playlistLoader:_e},q),m0[s](s,q.playlistLoader,o),v[W].push(q),typeof A[Y]>"u"){var J=new fe.AudioTrack({id:Y,kind:yC(q),enabled:!1,language:q.language,default:q.default,label:Y});A[Y]=J}}}r.on("error",xd[s](s,o))},SUBTITLES:function(s,o){var a=o.tech,e=o.vhs,r=o.sourceType,l=o.segmentLoaders[s],f=o.requestOptions,m=o.master.mediaGroups,v=o.mediaTypes[s],A=v.groups,L=v.tracks,P=o.masterPlaylistLoader;for(var U in m[s]){A[U]||(A[U]=[]);for(var W in m[s][U])if(!m[s][U][W].forced){var Y=m[s][U][W],q=void 0;if(r==="hls")q=new Oo(Y.resolvedUri,e,f);else if(r==="dash"){var _e=Y.playlists.filter(function(at){return at.excludeUntil!==1/0});if(!_e.length)return;q=new _p(Y.playlists[0],e,f,P)}else r==="vhs-json"&&(q=new Oo(Y.playlists?Y.playlists[0]:Y.resolvedUri,e,f));if(Y=fe.mergeOptions({id:W,playlistLoader:q},Y),m0[s](s,Y.playlistLoader,o),A[U].push(Y),typeof L[W]>"u"){var J=a.addRemoteTextTrack({id:W,kind:"subtitles",default:Y.default&&Y.autoselect,language:Y.language,label:W},!1).track;L[W]=J}}}l.on("error",xd[s](s,o))},"CLOSED-CAPTIONS":function(s,o){var a=o.tech,e=o.master.mediaGroups,r=o.mediaTypes[s],l=r.groups,f=r.tracks;for(var m in e[s]){l[m]||(l[m]=[]);for(var v in e[s][m]){var A=e[s][m][v];if(/^(?:CC|SERVICE)/.test(A.instreamId)){var L=a.options_.vhs&&a.options_.vhs.captionServices||{},P={label:v,language:A.language,instreamId:A.instreamId,default:A.default&&A.autoselect};if(L[P.instreamId]&&(P=fe.mergeOptions(P,L[P.instreamId])),P.default===void 0&&delete P.default,l[m].push(fe.mergeOptions({id:v},A)),typeof f[v]>"u"){var U=a.addRemoteTextTrack({id:P.instreamId,kind:"captions",default:P.default,language:P.language,label:P.label},!1).track;f[v]=U}}}}}},AC=function d(s,o){for(var a=0;a<s.length;a++)if(um(o,s[a])||s[a].playlists&&d(s[a].playlists,o))return!0;return!1},SC=function(s,o){return function(a){var e=o.masterPlaylistLoader,r=o.mediaTypes[s].groups,l=e.media();if(!l)return null;var f=null;l.attributes[s]&&(f=r[l.attributes[s]]);var m=Object.keys(r);if(!f)if(s==="AUDIO"&&m.length>1&&Pu(o.master))for(var v=0;v<m.length;v++){var A=r[m[v]];if(AC(A,l)){f=A;break}}else r.main?f=r.main:m.length===1&&(f=r[m[0]]);return typeof a>"u"?f:a===null||!f?null:f.filter(function(L){return L.id===a.id})[0]||null}},wC={AUDIO:function(s,o){return function(){var a=o.mediaTypes[s].tracks;for(var e in a)if(a[e].enabled)return a[e];return null}},SUBTITLES:function(s,o){return function(){var a=o.mediaTypes[s].tracks;for(var e in a)if(a[e].mode==="showing"||a[e].mode==="hidden")return a[e];return null}}},EC=function(s,o){var a=o.mediaTypes;return function(){var e=a[s].activeTrack();return e?a[s].activeGroup(e):null}},MC=function(s){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(W){TC[W](W,s)});var o=s.mediaTypes,a=s.masterPlaylistLoader,e=s.tech,r=s.vhs,l=s.segmentLoaders,f=l.AUDIO,m=l.main;["AUDIO","SUBTITLES"].forEach(function(W){o[W].activeGroup=SC(W,s),o[W].activeTrack=wC[W](W,s),o[W].onGroupChanged=_C(W,s),o[W].onGroupChanging=xC(W,s),o[W].onTrackChanged=bC(W,s),o[W].getActiveGroup=EC(W,s)});var v=o.AUDIO.activeGroup();if(v){var A=(v.filter(function(W){return W.default})[0]||v[0]).id;o.AUDIO.tracks[A].enabled=!0,o.AUDIO.onGroupChanged(),o.AUDIO.onTrackChanged();var L=o.AUDIO.getActiveGroup();L.playlistLoader?(m.setAudio(!1),f.setAudio(!0)):m.setAudio(!0)}a.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(W){return o[W].onGroupChanged()})}),a.on("mediachanging",function(){["AUDIO","SUBTITLES"].forEach(function(W){return o[W].onGroupChanging()})});var P=function(){o.AUDIO.onTrackChanged(),e.trigger({type:"usage",name:"vhs-audio-change"}),e.trigger({type:"usage",name:"hls-audio-change"})};e.audioTracks().addEventListener("change",P),e.remoteTextTracks().addEventListener("change",o.SUBTITLES.onTrackChanged),r.on("dispose",function(){e.audioTracks().removeEventListener("change",P),e.remoteTextTracks().removeEventListener("change",o.SUBTITLES.onTrackChanged)}),e.clearTracks("audio");for(var U in o.AUDIO.tracks)e.audioTracks().addTrack(o.AUDIO.tracks[U])},CC=function(){var s={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(o){s[o]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:ya,activeTrack:ya,getActiveGroup:ya,onGroupChanged:ya,onTrackChanged:ya,lastTrack_:null,logger_:Er("MediaGroups["+o+"]")}}),s},PC=60*2,ma,LC=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],IC=function(s){return this.audioSegmentLoader_[s]+this.mainSegmentLoader_[s]},DC=function(s){var o=s.currentPlaylist,a=s.buffered,e=s.currentTime,r=s.nextPlaylist,l=s.bufferLowWaterLine,f=s.bufferHighWaterLine,m=s.duration,v=s.experimentalBufferBasedABR,A=s.log;if(!r)return fe.log.warn("We received no playlist to switch to. Please check your stream."),!1;var L="allowing switch "+(o&&o.id||"null")+" -> "+r.id;if(!o)return A(L+" as current playlist is not set"),!0;if(r.id===o.id)return!1;var P=!!Ro(a,e).length;if(!o.endList)return!P&&typeof o.partTargetDuration=="number"?(A("not "+L+" as current playlist is live llhls, but currentTime isn't in buffered."),!1):(A(L+" as current playlist is live"),!0);var U=sm(a,e),W=v?rn.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:rn.MAX_BUFFER_LOW_WATER_LINE;if(m<W)return A(L+" as duration < max low water line ("+m+" < "+W+")"),!0;var Y=r.attributes.BANDWIDTH,q=o.attributes.BANDWIDTH;if(Y<q&&(!v||U<f)){var _e=L+" as next bandwidth < current bandwidth ("+Y+" < "+q+")";return v&&(_e+=" and forwardBuffer < bufferHighWaterLine ("+U+" < "+f+")"),A(_e),!0}if((!v||Y>q)&&U>=l){var J=L+" as forwardBuffer >= bufferLowWaterLine ("+U+" >= "+l+")";return v&&(J+=" and next bandwidth > current bandwidth ("+Y+" > "+q+")"),A(J),!0}return A("not "+L+" as no switching criteria met"),!1},RC=function(d){it(s,d);function s(a){var e;e=d.call(this)||this;var r=a.src,l=a.handleManifestRedirects,f=a.withCredentials,m=a.tech,v=a.bandwidth,A=a.externVhs,L=a.useCueTags,P=a.blacklistDuration,U=a.enableLowInitialPlaylist,W=a.sourceType,Y=a.cacheEncryptionKeys,q=a.experimentalBufferBasedABR,_e=a.experimentalLeastPixelDiffSelector,J=a.captionServices;if(!r)throw new Error("A non-empty playlist URL or JSON manifest string is required");var at=a.maxPlaylistRetries;(at===null||typeof at>"u")&&(at=1/0),ma=A,e.experimentalBufferBasedABR=!!q,e.experimentalLeastPixelDiffSelector=!!_e,e.withCredentials=f,e.tech_=m,e.vhs_=m.vhs,e.sourceType_=W,e.useCueTags_=L,e.blacklistDuration=P,e.maxPlaylistRetries=at,e.enableLowInitialPlaylist=U,e.useCueTags_&&(e.cueTagsTrack_=e.tech_.addTextTrack("metadata","ad-cues"),e.cueTagsTrack_.inBandMetadataTrackDispatchType=""),e.requestOptions_={withCredentials:f,handleManifestRedirects:l,maxPlaylistRetries:at,timeout:null},e.on("error",e.pauseLoading),e.mediaTypes_=CC(),e.mediaSource=new ie.MediaSource,e.handleDurationChange_=e.handleDurationChange_.bind(Ft(e)),e.handleSourceOpen_=e.handleSourceOpen_.bind(Ft(e)),e.handleSourceEnded_=e.handleSourceEnded_.bind(Ft(e)),e.mediaSource.addEventListener("durationchange",e.handleDurationChange_),e.mediaSource.addEventListener("sourceopen",e.handleSourceOpen_),e.mediaSource.addEventListener("sourceended",e.handleSourceEnded_),e.seekable_=fe.createTimeRanges(),e.hasPlayed_=!1,e.syncController_=new pC(a),e.segmentMetadataTrack_=m.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,e.decrypter_=new vC,e.sourceUpdater_=new P_(e.mediaSource),e.inbandTextTracks_={},e.timelineChangeController_=new mC;var Me={vhs:e.vhs_,parse708captions:a.parse708captions,useDtsForTimestampOffset:a.useDtsForTimestampOffset,captionServices:J,mediaSource:e.mediaSource,currentTime:e.tech_.currentTime.bind(e.tech_),seekable:function(){return e.seekable()},seeking:function(){return e.tech_.seeking()},duration:function(){return e.duration()},hasPlayed:function(){return e.hasPlayed_},goalBufferLength:function(){return e.goalBufferLength()},bandwidth:v,syncController:e.syncController_,decrypter:e.decrypter_,sourceType:e.sourceType_,inbandTextTracks:e.inbandTextTracks_,cacheEncryptionKeys:Y,sourceUpdater:e.sourceUpdater_,timelineChangeController:e.timelineChangeController_,experimentalExactManifestTimings:a.experimentalExactManifestTimings};e.masterPlaylistLoader_=e.sourceType_==="dash"?new _p(r,e.vhs_,e.requestOptions_):new Oo(r,e.vhs_,e.requestOptions_),e.setupMasterPlaylistLoaderListeners_(),e.mainSegmentLoader_=new bp(fe.mergeOptions(Me,{segmentMetadataTrack:e.segmentMetadataTrack_,loaderType:"main"}),a),e.audioSegmentLoader_=new bp(fe.mergeOptions(Me,{loaderType:"audio"}),a),e.subtitleSegmentLoader_=new cC(fe.mergeOptions(Me,{loaderType:"vtt",featuresNativeTextTracks:e.tech_.featuresNativeTextTracks,loadVttJs:function(){return new Promise(function(De,Ee){function We(){m.off("vttjserror",Ce),De()}function Ce(){m.off("vttjsloaded",We),Ee()}m.one("vttjsloaded",We),m.one("vttjserror",Ce),m.addWebVttScript_()})}}),a),e.setupSegmentLoaderListeners_(),e.experimentalBufferBasedABR&&(e.masterPlaylistLoader_.one("loadedplaylist",function(){return e.startABRTimer_()}),e.tech_.on("pause",function(){return e.stopABRTimer_()}),e.tech_.on("play",function(){return e.startABRTimer_()})),LC.forEach(function(ze){e[ze+"_"]=IC.bind(Ft(e),ze)}),e.logger_=Er("MPC"),e.triggeredFmp4Usage=!1,e.tech_.preload()==="none"?(e.loadOnPlay_=function(){e.loadOnPlay_=null,e.masterPlaylistLoader_.load()},e.tech_.one("play",e.loadOnPlay_)):e.masterPlaylistLoader_.load(),e.timeToLoadedData__=-1,e.mainAppendsToLoadedData__=-1,e.audioAppendsToLoadedData__=-1;var Le=e.tech_.preload()==="none"?"play":"loadstart";return e.tech_.one(Le,function(){var ze=Date.now();e.tech_.one("loadeddata",function(){e.timeToLoadedData__=Date.now()-ze,e.mainAppendsToLoadedData__=e.mainSegmentLoader_.mediaAppends,e.audioAppendsToLoadedData__=e.audioSegmentLoader_.mediaAppends})}),e}var o=s.prototype;return o.mainAppendsToLoadedData_=function(){return this.mainAppendsToLoadedData__},o.audioAppendsToLoadedData_=function(){return this.audioAppendsToLoadedData__},o.appendsToLoadedData_=function(){var e=this.mainAppendsToLoadedData_(),r=this.audioAppendsToLoadedData_();return e===-1||r===-1?-1:e+r},o.timeToLoadedData_=function(){return this.timeToLoadedData__},o.checkABR_=function(e){e===void 0&&(e="abr");var r=this.selectPlaylist();r&&this.shouldSwitchToMedia_(r)&&this.switchMedia_(r,e)},o.switchMedia_=function(e,r,l){var f=this.media(),m=f&&(f.id||f.uri),v=e.id||e.uri;m&&m!==v&&(this.logger_("switch media "+m+" -> "+v+" from "+r),this.tech_.trigger({type:"usage",name:"vhs-rendition-change-"+r})),this.masterPlaylistLoader_.media(e,l)},o.startABRTimer_=function(){var e=this;this.stopABRTimer_(),this.abrTimer_=ie.setInterval(function(){return e.checkABR_()},250)},o.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(ie.clearInterval(this.abrTimer_),this.abrTimer_=null)},o.getAudioTrackPlaylists_=function(){var e=this.master(),r=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return r;var l=e.mediaGroups.AUDIO,f=Object.keys(l),m;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)m=this.mediaTypes_.AUDIO.activeTrack();else{var v=l.main||f.length&&l[f[0]];for(var A in v)if(v[A].default){m={label:A};break}}if(!m)return r;var L=[];for(var P in l)if(l[P][m.label]){var U=l[P][m.label];if(U.playlists&&U.playlists.length)L.push.apply(L,U.playlists);else if(U.uri)L.push(U);else if(e.playlists.length)for(var W=0;W<e.playlists.length;W++){var Y=e.playlists[W];Y.attributes&&Y.attributes.AUDIO&&Y.attributes.AUDIO===P&&L.push(Y)}}return L.length?L:r},o.setupMasterPlaylistLoaderListeners_=function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var r=e.masterPlaylistLoader_.media(),l=r.targetDuration*1.5*1e3;pp(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=l,r.endList&&e.tech_.preload()!=="none"&&(e.mainSegmentLoader_.playlist(r,e.requestOptions_),e.mainSegmentLoader_.load()),MC({sourceType:e.sourceType_,segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,vhs:e.vhs_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),r),e.setupFirstPlay(),!e.mediaTypes_.AUDIO.activePlaylistLoader||e.mediaTypes_.AUDIO.activePlaylistLoader.media()?e.trigger("selectedinitialmedia"):e.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){e.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){e.loadOnPlay_&&e.tech_.off("play",e.loadOnPlay_);var r=e.masterPlaylistLoader_.media();if(!r){e.excludeUnsupportedVariants_();var l;if(e.enableLowInitialPlaylist&&(l=e.selectInitialPlaylist()),l||(l=e.selectPlaylist()),!l||!e.shouldSwitchToMedia_(l))return;e.initialMedia_=l,e.switchMedia_(e.initialMedia_,"initial");var f=e.sourceType_==="vhs-json"&&e.initialMedia_.segments;if(!f)return;r=e.initialMedia_}e.handleUpdatedMediaPlaylist(r)}),this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var r=e.masterPlaylistLoader_.media(),l=r.targetDuration*1.5*1e3;pp(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=l,e.masterPlaylistLoader_.load(),e.mainSegmentLoader_.playlist(r,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var r=e.masterPlaylistLoader_.media();if(r.lastExcludeReason_!=="playlist-unchanged"){var l=e.stuckAtPlaylistEnd_(r);l&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating.",reason:"playlist-unchanged"}),e.tech_.trigger("playliststuck"))}}),this.masterPlaylistLoader_.on("renditiondisabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},o.handleUpdatedMediaPlaylist=function(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},o.triggerPresenceUsage_=function(e,r){var l=e.mediaGroups||{},f=!0,m=Object.keys(l.AUDIO);for(var v in l.AUDIO)for(var A in l.AUDIO[v]){var L=l.AUDIO[v][A];L.uri||(f=!1)}f&&(this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),this.tech_.trigger({type:"usage",name:"hls-demuxed"})),Object.keys(l.SUBTITLES).length&&(this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),this.tech_.trigger({type:"usage",name:"hls-webvtt"})),ma.Playlist.isAes(r)&&(this.tech_.trigger({type:"usage",name:"vhs-aes"}),this.tech_.trigger({type:"usage",name:"hls-aes"})),m.length&&Object.keys(l.AUDIO[m[0]]).length>1&&(this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})),this.useCueTags_&&(this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"}),this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"}))},o.shouldSwitchToMedia_=function(e){var r=this.masterPlaylistLoader_.media()||this.masterPlaylistLoader_.pendingMedia_,l=this.tech_.currentTime(),f=this.bufferLowWaterLine(),m=this.bufferHighWaterLine(),v=this.tech_.buffered();return DC({buffered:v,currentTime:l,currentPlaylist:r,nextPlaylist:e,bufferLowWaterLine:f,bufferHighWaterLine:m,duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},o.setupSegmentLoaderListeners_=function(){var e=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){e.checkABR_("bandwidthupdate"),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",function(){e.experimentalBufferBasedABR&&e.mainSegmentLoader_.load()}),this.experimentalBufferBasedABR||this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")}),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){e.error=e.mainSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"}),e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){e.error=e.audioSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){e.logger_("main segment loader ended"),e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(l){e.experimentalBufferBasedABR||(e.delegateLoaders_("all",["abort"]),e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},PC))});var r=function(){if(!e.sourceUpdater_.hasCreatedSourceBuffers())return e.tryToCreateSourceBuffers_();var f=e.getCodecsOrExclude_();f&&e.sourceUpdater_.addOrChangeSourceBuffers(f)};this.mainSegmentLoader_.on("trackinfo",r),this.audioSegmentLoader_.on("trackinfo",r),this.mainSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){e.logger_("audioSegmentLoader ended"),e.onEndOfStream()})},o.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},o.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},o.smoothQualityChange_=function(e){e===void 0&&(e=this.selectPlaylist()),this.fastQualityChange_(e)},o.fastQualityChange_=function(e){var r=this;if(e===void 0&&(e=this.selectPlaylist()),e===this.masterPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything(function(){fe.browser.IE_VERSION||fe.browser.IS_EDGE?r.tech_.setCurrentTime(r.tech_.currentTime()+.04):r.tech_.setCurrentTime(r.tech_.currentTime())})},o.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}},o.setupFirstPlay=function(){var e=this,r=this.masterPlaylistLoader_.media();if(!r||this.tech_.paused()||this.hasPlayed_)return!1;if(!r.endList){var l=this.seekable();if(!l.length)return!1;if(fe.browser.IE_VERSION&&this.tech_.readyState()===0)return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.tech_.setCurrentTime(l.end(0)),e.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(l.end(0))}return this.hasPlayed_=!0,this.load(),!0},o.handleSourceOpen_=function(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){var e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,function(r){})}this.trigger("sourceopen")},o.handleSourceEnded_=function(){if(this.inbandTextTracks_.metadataTrack_){var e=this.inbandTextTracks_.metadataTrack_.cues;if(!(!e||!e.length)){var r=this.duration();e[e.length-1].endTime=isNaN(r)||Math.abs(r)===1/0?Number.MAX_VALUE:r}}},o.handleDurationChange_=function(){this.tech_.trigger("durationchange")},o.onEndOfStream=function(){var e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){var r=this.mainSegmentLoader_.getCurrentMediaInfo_();!r||r.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},o.stuckAtPlaylistEnd_=function(e){var r=this.seekable();if(!r.length)return!1;var l=this.syncController_.getExpiredTime(e,this.duration());if(l===null)return!1;var f=ma.Playlist.playlistEnd(e,l),m=this.tech_.currentTime(),v=this.tech_.buffered();if(!v.length)return f-m<=Xr;var A=v.end(v.length-1);return A-m<=Xr&&f-A<=Xr},o.blacklistCurrentPlaylist=function(e,r){e===void 0&&(e={});var l=e.playlist||this.masterPlaylistLoader_.media();if(r=r||e.blacklistDuration||this.blacklistDuration,!l){this.error=e,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}l.playlistErrors_++;var f=this.masterPlaylistLoader_.master.playlists,m=f.filter(Fd),v=m.length===1&&m[0]===l;if(f.length===1&&r!==1/0)return fe.log.warn("Problem encountered with playlist "+l.id+". Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(v);if(v){var A=!1;f.forEach(function(_e){if(_e!==l){var J=_e.excludeUntil;typeof J<"u"&&J!==1/0&&(A=!0,delete _e.excludeUntil)}}),A&&(fe.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}var L;l.playlistErrors_>this.maxPlaylistRetries?L=1/0:L=Date.now()+r*1e3,l.excludeUntil=L,e.reason&&(l.lastExcludeReason_=e.reason),this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-blacklisted"}),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});var P=this.selectPlaylist();if(!P){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}var U=e.internal?this.logger_:fe.log.warn,W=e.message?" "+e.message:"";U((e.internal?"Internal problem":"Problem")+" encountered with playlist "+l.id+"."+(W+" Switching to playlist "+P.id+".")),P.attributes.AUDIO!==l.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),P.attributes.SUBTITLES!==l.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);var Y=P.targetDuration/2*1e3||5*1e3,q=typeof P.lastRequest=="number"&&Date.now()-P.lastRequest<=Y;return this.switchMedia_(P,"exclude",v||q)},o.pauseLoading=function(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()},o.delegateLoaders_=function(e,r){var l=this,f=[],m=e==="all";(m||e==="main")&&f.push(this.masterPlaylistLoader_);var v=[];(m||e==="audio")&&v.push("AUDIO"),(m||e==="subtitle")&&(v.push("CLOSED-CAPTIONS"),v.push("SUBTITLES")),v.forEach(function(A){var L=l.mediaTypes_[A]&&l.mediaTypes_[A].activePlaylistLoader;L&&f.push(L)}),["main","audio","subtitle"].forEach(function(A){var L=l[A+"SegmentLoader_"];L&&(e===A||e==="all")&&f.push(L)}),f.forEach(function(A){return r.forEach(function(L){typeof A[L]=="function"&&A[L]()})})},o.setCurrentTime=function(e){var r=Ro(this.tech_.buffered(),e);if(!(this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media())||!this.masterPlaylistLoader_.media().segments)return 0;if(r&&r.length)return e;this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),this.load()},o.duration=function(){if(!this.masterPlaylistLoader_)return 0;var e=this.masterPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:ma.Playlist.duration(e):1/0:0},o.seekable=function(){return this.seekable_},o.onSyncInfoUpdate_=function(){var e;if(this.masterPlaylistLoader_){var r=this.masterPlaylistLoader_.media();if(r){var l=this.syncController_.getExpiredTime(r,this.duration());if(l!==null){var f=this.masterPlaylistLoader_.master,m=ma.Playlist.seekable(r,l,ma.Playlist.liveEdgeDelay(f,r));if(m.length!==0&&!(this.mediaTypes_.AUDIO.activePlaylistLoader&&(r=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),l=this.syncController_.getExpiredTime(r,this.duration()),l===null||(e=ma.Playlist.seekable(r,l,ma.Playlist.liveEdgeDelay(f,r)),e.length===0)))){var v,A;this.seekable_&&this.seekable_.length&&(v=this.seekable_.end(0),A=this.seekable_.start(0)),e?e.start(0)>m.end(0)||m.start(0)>e.end(0)?this.seekable_=m:this.seekable_=fe.createTimeRanges([[e.start(0)>m.start(0)?e.start(0):m.start(0),e.end(0)<m.end(0)?e.end(0):m.end(0)]]):this.seekable_=m,!(this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===v&&this.seekable_.start(0)===A)&&(this.logger_("seekable updated ["+qy(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},o.updateDuration=function(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){var r=this.seekable();if(!r.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<r.end(r.length-1))&&this.sourceUpdater_.setDuration(r.end(r.length-1));return}var l=this.tech_.buffered(),f=ma.Playlist.duration(this.masterPlaylistLoader_.media());l.length>0&&(f=Math.max(f,l.end(l.length-1))),this.mediaSource.duration!==f&&this.sourceUpdater_.setDuration(f)},o.dispose=function(){var e=this;this.trigger("dispose"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(function(r){var l=e.mediaTypes_[r].groups;for(var f in l)l[f].forEach(function(m){m.playlistLoader&&m.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()},o.master=function(){return this.masterPlaylistLoader_.master},o.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},o.areMediaTypesKnown_=function(){var e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,r=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),l=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!r||!l)},o.getCodecsOrExclude_=function(){var e=this,r={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},l=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();r.video=r.main;var f=mu(this.master(),l),m={},v=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(r.main.hasVideo&&(m.video=f.video||r.main.videoCodec||PS),r.main.isMuxed&&(m.video+=","+(f.audio||r.main.audioCodec||cv)),(r.main.hasAudio&&!r.main.isMuxed||r.audio.hasAudio||v)&&(m.audio=f.audio||r.main.audioCodec||r.audio.audioCodec||cv,r.audio.isFmp4=r.main.hasAudio&&!r.main.isMuxed?r.main.isFmp4:r.audio.isFmp4),!m.audio&&!m.video){this.blacklistCurrentPlaylist({playlist:l,message:"Could not determine codecs for playlist.",blacklistDuration:1/0});return}var A=function(_e,J){return _e?Zc(J):If(J)},L={},P;if(["video","audio"].forEach(function(q){if(m.hasOwnProperty(q)&&!A(r[q].isFmp4,m[q])){var _e=r[q].isFmp4?"browser":"muxer";L[_e]=L[_e]||[],L[_e].push(m[q]),q==="audio"&&(P=_e)}}),v&&P&&l.attributes.AUDIO){var U=l.attributes.AUDIO;this.master().playlists.forEach(function(q){var _e=q.attributes&&q.attributes.AUDIO;_e===U&&q!==l&&(q.excludeUntil=1/0)}),this.logger_("excluding audio group "+U+" as "+P+' does not support codec(s): "'+m.audio+'"')}if(Object.keys(L).length){var W=Object.keys(L).reduce(function(q,_e){return q&&(q+=", "),q+=_e+' does not support codec(s): "'+L[_e].join(",")+'"',q},"")+".";this.blacklistCurrentPlaylist({playlist:l,internal:!0,message:W,blacklistDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var Y=[];if(["video","audio"].forEach(function(q){var _e=(Wr(e.sourceUpdater_.codecs[q]||"")[0]||{}).type,J=(Wr(m[q]||"")[0]||{}).type;_e&&J&&_e.toLowerCase()!==J.toLowerCase()&&Y.push('"'+e.sourceUpdater_.codecs[q]+'" -> "'+m[q]+'"')}),Y.length){this.blacklistCurrentPlaylist({playlist:l,message:"Codec switching not supported: "+Y.join(", ")+".",blacklistDuration:1/0,internal:!0});return}}return m},o.tryToCreateSourceBuffers_=function(){if(!(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers())&&this.areMediaTypesKnown_()){var e=this.getCodecsOrExclude_();if(e){this.sourceUpdater_.createSourceBuffers(e);var r=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(r)}}},o.excludeUnsupportedVariants_=function(){var e=this,r=this.master().playlists,l=[];Object.keys(r).forEach(function(f){var m=r[f];if(l.indexOf(m.id)===-1){l.push(m.id);var v=mu(e.master,m),A=[];v.audio&&!If(v.audio)&&!Zc(v.audio)&&A.push("audio codec "+v.audio),v.video&&!If(v.video)&&!Zc(v.video)&&A.push("video codec "+v.video),v.text&&v.text==="stpp.ttml.im1t"&&A.push("text codec "+v.text),A.length&&(m.excludeUntil=1/0,e.logger_("excluding "+m.id+" for unsupported: "+A.join(", ")))}})},o.excludeIncompatibleVariants_=function(e){var r=this,l=[],f=this.master().playlists,m=vd(Wr(e)),v=r0(m),A=m.video&&Wr(m.video)[0]||null,L=m.audio&&Wr(m.audio)[0]||null;Object.keys(f).forEach(function(P){var U=f[P];if(!(l.indexOf(U.id)!==-1||U.excludeUntil===1/0)){l.push(U.id);var W=[],Y=mu(r.masterPlaylistLoader_.master,U),q=r0(Y);if(!(!Y.audio&&!Y.video)){if(q!==v&&W.push('codec count "'+q+'" !== "'+v+'"'),!r.sourceUpdater_.canChangeType()){var _e=Y.video&&Wr(Y.video)[0]||null,J=Y.audio&&Wr(Y.audio)[0]||null;_e&&A&&_e.type.toLowerCase()!==A.type.toLowerCase()&&W.push('video codec "'+_e.type+'" !== "'+A.type+'"'),J&&L&&J.type.toLowerCase()!==L.type.toLowerCase()&&W.push('audio codec "'+J.type+'" !== "'+L.type+'"')}W.length&&(U.excludeUntil=1/0,r.logger_("blacklisting "+U.id+": "+W.join(" && ")))}}})},o.updateAdCues_=function(e){var r=0,l=this.seekable();l.length&&(r=l.start(0)),hC(e,this.cueTagsTrack_,r)},o.goalBufferLength=function(){var e=this.tech_.currentTime(),r=rn.GOAL_BUFFER_LENGTH,l=rn.GOAL_BUFFER_LENGTH_RATE,f=Math.max(r,rn.MAX_GOAL_BUFFER_LENGTH);return Math.min(r+e*l,f)},o.bufferLowWaterLine=function(){var e=this.tech_.currentTime(),r=rn.BUFFER_LOW_WATER_LINE,l=rn.BUFFER_LOW_WATER_LINE_RATE,f=Math.max(r,rn.MAX_BUFFER_LOW_WATER_LINE),m=Math.max(r,rn.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(r+e*l,this.experimentalBufferBasedABR?m:f)},o.bufferHighWaterLine=function(){return rn.BUFFER_HIGH_WATER_LINE},s}(fe.EventTarget),OC=function(s,o,a){return function(e){var r=s.master.playlists[o],l=lm(r),f=Fd(r);return typeof e>"u"?f:(e?delete r.disabled:r.disabled=!0,e!==f&&!l&&(a(),e?s.trigger("renditionenabled"):s.trigger("renditiondisabled")),e)}},FC=function(s,o,a){var e=s.masterPlaylistController_,r=s.options_.smoothQualityChange,l=r?"smooth":"fast",f=e[l+"QualityChange_"].bind(e);if(o.attributes){var m=o.attributes.RESOLUTION;this.width=m&&m.width,this.height=m&&m.height,this.bandwidth=o.attributes.BANDWIDTH,this.frameRate=o.attributes["FRAME-RATE"]}this.codecs=mu(e.master(),o),this.playlist=o,this.id=a,this.enabled=OC(s.playlists,o.id,f)},kC=function(s){s.representations=function(){var o=s.masterPlaylistController_.master(),a=Pu(o)?s.masterPlaylistController_.getAudioTrackPlaylists_():o.playlists;return a?a.filter(function(e){return!lm(e)}).map(function(e,r){return new FC(s,e,e.id)}):[]}},g0=["seeking","seeked","pause","playing","error"],BC=function(){function d(o){var a=this;this.masterPlaylistController_=o.masterPlaylistController,this.tech_=o.tech,this.seekable=o.seekable,this.allowSeeksWithinUnsafeLiveWindow=o.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=o.liveRangeSafeTimeDelta,this.media=o.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=Er("PlaybackWatcher"),this.logger_("initialize");var e=function(){return a.monitorCurrentTime_()},r=function(){return a.monitorCurrentTime_()},l=function(){return a.techWaiting_()},f=function(){return a.cancelTimer_()},m=this.masterPlaylistController_,v=["main","subtitle","audio"],A={};v.forEach(function(P){A[P]={reset:function(){return a.resetSegmentDownloads_(P)},updateend:function(){return a.checkSegmentDownloads_(P)}},m[P+"SegmentLoader_"].on("appendsdone",A[P].updateend),m[P+"SegmentLoader_"].on("playlistupdate",A[P].reset),a.tech_.on(["seeked","seeking"],A[P].reset)});var L=function(U){["main","audio"].forEach(function(W){m[W+"SegmentLoader_"][U]("appended",a.seekingAppendCheck_)})};this.seekingAppendCheck_=function(){a.fixesBadSeeks_()&&(a.consecutiveUpdates=0,a.lastRecordedTime=a.tech_.currentTime(),L("off"))},this.clearSeekingAppendCheck_=function(){return L("off")},this.watchForBadSeeking_=function(){a.clearSeekingAppendCheck_(),L("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",l),this.tech_.on(g0,f),this.tech_.on("canplay",r),this.tech_.one("play",e),this.dispose=function(){a.clearSeekingAppendCheck_(),a.logger_("dispose"),a.tech_.off("waiting",l),a.tech_.off(g0,f),a.tech_.off("canplay",r),a.tech_.off("play",e),a.tech_.off("seeking",a.watchForBadSeeking_),a.tech_.off("seeked",a.clearSeekingAppendCheck_),v.forEach(function(P){m[P+"SegmentLoader_"].off("appendsdone",A[P].updateend),m[P+"SegmentLoader_"].off("playlistupdate",A[P].reset),a.tech_.off(["seeked","seeking"],A[P].reset)}),a.checkCurrentTimeTimeout_&&ie.clearTimeout(a.checkCurrentTimeTimeout_),a.cancelTimer_()}}var s=d.prototype;return s.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&ie.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=ie.setTimeout(this.monitorCurrentTime_.bind(this),250)},s.resetSegmentDownloads_=function(a){var e=this.masterPlaylistController_[a+"SegmentLoader_"];this[a+"StalledDownloads_"]>0&&this.logger_("resetting possible stalled download count for "+a+" loader"),this[a+"StalledDownloads_"]=0,this[a+"Buffered_"]=e.buffered_()},s.checkSegmentDownloads_=function(a){var e=this.masterPlaylistController_,r=e[a+"SegmentLoader_"],l=r.buffered_(),f=CM(this[a+"Buffered_"],l);if(this[a+"Buffered_"]=l,f){this.resetSegmentDownloads_(a);return}this[a+"StalledDownloads_"]++,this.logger_("found #"+this[a+"StalledDownloads_"]+" "+a+" appends that did not increase buffer (possible stalled download)",{playlistId:r.playlist_&&r.playlist_.id,buffered:Ms(l)}),!(this[a+"StalledDownloads_"]<10)&&(this.logger_(a+" loader stalled download exclusion"),this.resetSegmentDownloads_(a),this.tech_.trigger({type:"usage",name:"vhs-"+a+"-download-exclusion"}),a!=="subtitle"&&e.blacklistCurrentPlaylist({message:"Excessive "+a+" segment downloading detected."},1/0))},s.checkCurrentTime_=function(){if(!(this.tech_.paused()||this.tech_.seeking())){var a=this.tech_.currentTime(),e=this.tech_.buffered();if(this.lastRecordedTime===a&&(!e.length||a+Xr>=e.end(e.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&a===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):a===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=a)}},s.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},s.fixesBadSeeks_=function(){var a=this.tech_.seeking();if(!a)return!1;var e=this.seekable(),r=this.tech_.currentTime(),l=this.afterSeekableWindow_(e,r,this.media(),this.allowSeeksWithinUnsafeLiveWindow),f;if(l){var m=e.end(e.length-1);f=m}if(this.beforeSeekableWindow_(e,r)){var v=e.start(0);f=v+(v===e.end(0)?0:Xr)}if(typeof f<"u")return this.logger_("Trying to seek outside of seekable at time "+r+" with "+("seekable range "+qy(e)+". Seeking to ")+(f+".")),this.tech_.setCurrentTime(f),!0;for(var A=this.masterPlaylistController_.sourceUpdater_,L=this.tech_.buffered(),P=A.audioBuffer?A.audioBuffered():null,U=A.videoBuffer?A.videoBuffered():null,W=this.media(),Y=W.partTargetDuration?W.partTargetDuration:(W.targetDuration-ts)*2,q=[P,U],_e=0;_e<q.length;_e++)if(q[_e]){var J=sm(q[_e],r);if(J<Y)return!1}var at=Xc(L,r);return at.length===0?!1:(f=at.start(0)+Xr,this.logger_("Buffered region starts ("+at.start(0)+") "+(" just beyond seek point ("+r+"). Seeking to "+f+".")),this.tech_.setCurrentTime(f),!0)},s.waiting_=function(){if(!this.techWaiting_()){var a=this.tech_.currentTime(),e=this.tech_.buffered(),r=Ro(e,a);if(r.length&&a+3<=r.end(0)){this.cancelTimer_(),this.tech_.setCurrentTime(a),this.logger_("Stopped at "+a+" while inside a buffered region "+("["+r.start(0)+" -> "+r.end(0)+"]. Attempting to resume ")+"playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"}),this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"});return}}},s.techWaiting_=function(){var a=this.seekable(),e=this.tech_.currentTime();if(this.tech_.seeking()||this.timer_!==null)return!0;if(this.beforeSeekableWindow_(a,e)){var r=a.end(a.length-1);return this.logger_("Fell out of live window at time "+e+". Seeking to "+("live point (seekable end) "+r)),this.cancelTimer_(),this.tech_.setCurrentTime(r),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var l=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,f=this.tech_.buffered(),m=this.videoUnderflow_({audioBuffered:l.audioBuffered(),videoBuffered:l.videoBuffered(),currentTime:e});if(m)return this.cancelTimer_(),this.tech_.setCurrentTime(e),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;var v=Xc(f,e);if(v.length>0){var A=v.start(0)-e;return this.logger_("Stopped at "+e+", setting timer for "+A+", seeking "+("to "+v.start(0))),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),A*1e3,e),!0}return!1},s.afterSeekableWindow_=function(a,e,r,l){if(l===void 0&&(l=!1),!a.length)return!1;var f=a.end(a.length-1)+Xr,m=!r.endList;return m&&l&&(f=a.end(a.length-1)+r.targetDuration*3),e>f},s.beforeSeekableWindow_=function(a,e){return!!(a.length&&a.start(0)>0&&e<a.start(0)-this.liveRangeSafeTimeDelta)},s.videoUnderflow_=function(a){var e=a.videoBuffered,r=a.audioBuffered,l=a.currentTime;if(e){var f;if(e.length&&r.length){var m=Ro(e,l-3),v=Ro(e,l),A=Ro(r,l);A.length&&!v.length&&m.length&&(f={start:m.end(0),end:A.end(0)})}else{var L=Xc(e,l);L.length||(f=this.gapFromVideoUnderflow_(e,l))}return f?(this.logger_("Encountered a gap in video from "+f.start+" to "+f.end+". "+("Seeking to current time "+l)),!0):!1}},s.skipTheGap_=function(a){var e=this.tech_.buffered(),r=this.tech_.currentTime(),l=Xc(e,r);this.cancelTimer_(),!(l.length===0||r!==a)&&(this.logger_("skipTheGap_:","currentTime:",r,"scheduled currentTime:",a,"nextRange start:",l.start(0)),this.tech_.setCurrentTime(l.start(0)+ts),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},s.gapFromVideoUnderflow_=function(a,e){for(var r=wM(a),l=0;l<r.length;l++){var f=r.start(l),m=r.end(l);if(e-f<4&&e-f>2)return{start:f,end:m}}return null},d}(),NC={errorInterval:30,getSource:function(s){var o=this.tech({IWillNotUseThisInPlugins:!0}),a=o.currentSource_||this.currentSource();return s(a)}},UC=function d(s,o){var a=0,e=0,r=fe.mergeOptions(NC,o);s.ready(function(){s.trigger({type:"usage",name:"vhs-error-reload-initialized"}),s.trigger({type:"usage",name:"hls-error-reload-initialized"})});var l=function(){e&&s.currentTime(e)},f=function(P){P!=null&&(e=s.duration()!==1/0&&s.currentTime()||0,s.one("loadedmetadata",l),s.src(P),s.trigger({type:"usage",name:"vhs-error-reload"}),s.trigger({type:"usage",name:"hls-error-reload"}),s.play())},m=function(){if(Date.now()-a<r.errorInterval*1e3){s.trigger({type:"usage",name:"vhs-error-reload-canceled"}),s.trigger({type:"usage",name:"hls-error-reload-canceled"});return}if(!r.getSource||typeof r.getSource!="function"){fe.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return a=Date.now(),r.getSource.call(s,f)},v=function L(){s.off("loadedmetadata",l),s.off("error",m),s.off("dispose",L)},A=function(P){v(),d(s,P)};s.on("error",m),s.on("dispose",v),s.reloadSourceOnError=A},HC=function(s){UC(this,s)},L_="2.16.3",VC="6.0.1",GC="0.22.1",zC="4.8.0",WC="3.1.3",cn={PlaylistLoader:Oo,Playlist:Fn,utils:JM,STANDARD_PLAYLIST_SELECTOR:s0,INITIAL_PLAYLIST_SELECTOR:G2,lastBandwidthSelector:s0,movingAverageBandwidthSelector:H2,comparePlaylistBandwidth:hm,comparePlaylistResolution:U2,xhr:o_()};Object.keys(rn).forEach(function(d){Object.defineProperty(cn,d,{get:function(){return fe.log.warn("using Vhs."+d+" is UNSAFE be sure you know what you are doing"),rn[d]},set:function(o){if(fe.log.warn("using Vhs."+d+" is UNSAFE be sure you know what you are doing"),typeof o!="number"||o<0){fe.log.warn("value of Vhs."+d+" must be greater than or equal to 0");return}rn[d]=o}})});var I_="videojs-vhs",D_=function(s,o){for(var a=o.media(),e=-1,r=0;r<s.length;r++)if(s[r].id===a.id){e=r;break}s.selectedIndex_=e,s.trigger({selectedIndex:e,type:"change"})},jC=function(s,o){o.representations().forEach(function(a){s.addQualityLevel(a)}),D_(s,o.playlists)};cn.canPlaySource=function(){return fe.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var qC=function(s,o,a){if(!s)return s;var e={};o&&o.attributes&&o.attributes.CODECS&&(e=vd(Wr(o.attributes.CODECS))),a&&a.attributes&&a.attributes.CODECS&&(e.audio=a.attributes.CODECS);var r=gu(e.video),l=gu(e.audio),f={};for(var m in s)f[m]={},l&&(f[m].audioContentType=l),r&&(f[m].videoContentType=r),o.contentProtection&&o.contentProtection[m]&&o.contentProtection[m].pssh&&(f[m].pssh=o.contentProtection[m].pssh),typeof s[m]=="string"&&(f[m].url=s[m]);return fe.mergeOptions(s,f)},XC=function(s,o){return s.reduce(function(a,e){if(!e.contentProtection)return a;var r=o.reduce(function(l,f){var m=e.contentProtection[f];return m&&m.pssh&&(l[f]={pssh:m.pssh}),l},{});return Object.keys(r).length&&a.push(r),a},[])},QC=function(s){var o=s.player,a=s.sourceKeySystems,e=s.audioMedia,r=s.mainPlaylists;if(!o.eme.initializeMediaKeys)return Promise.resolve();var l=e?r.concat([e]):r,f=XC(l,Object.keys(a)),m=[],v=[];return f.forEach(function(A){v.push(new Promise(function(L,P){o.tech_.one("keysessioncreated",L)})),m.push(new Promise(function(L,P){o.eme.initializeMediaKeys({keySystems:A},function(U){if(U){P(U);return}L()})}))}),Promise.race([Promise.all(m),Promise.race(v)])},YC=function(s){var o=s.player,a=s.sourceKeySystems,e=s.media,r=s.audioMedia,l=qC(a,e,r);return l?(o.currentSource().keySystems=l,l&&!o.eme?(fe.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},R_=function(){if(!ie.localStorage)return null;var s=ie.localStorage.getItem(I_);if(!s)return null;try{return JSON.parse(s)}catch{return null}},KC=function(s){if(!ie.localStorage)return!1;var o=R_();o=o?fe.mergeOptions(o,s):s;try{ie.localStorage.setItem(I_,JSON.stringify(o))}catch{return!1}return o},ZC=function(s){return s.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(s.substring(s.indexOf(",")+1)):s};cn.supportsNativeHls=function(){if(!et||!et.createElement)return!1;var d=et.createElement("video");if(!fe.getTech("Html5").isSupported())return!1;var s=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"];return s.some(function(o){return/maybe|probably/i.test(d.canPlayType(o))})}();cn.supportsNativeDash=function(){return!et||!et.createElement||!fe.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(et.createElement("video").canPlayType("application/dash+xml"))}();cn.supportsTypeNatively=function(d){return d==="hls"?cn.supportsNativeHls:d==="dash"?cn.supportsNativeDash:!1};cn.isSupported=function(){return fe.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var $C=fe.getComponent("Component"),pm=function(d){it(s,d);function s(a,e,r){var l;if(l=d.call(this,e,fe.mergeOptions(r.hls,r.vhs))||this,r.hls&&Object.keys(r.hls).length&&fe.log.warn("Using hls options is deprecated. Please rename `hls` to `vhs` in your options object."),typeof r.initialBandwidth=="number"&&(l.options_.bandwidth=r.initialBandwidth),l.logger_=Er("VhsHandler"),e.options_&&e.options_.playerId){var f=fe(e.options_.playerId);f.hasOwnProperty("hls")||Object.defineProperty(f,"hls",{get:function(){return fe.log.warn("player.hls is deprecated. Use player.tech().vhs instead."),e.trigger({type:"usage",name:"hls-player-access"}),Ft(l)},configurable:!0}),f.hasOwnProperty("vhs")||Object.defineProperty(f,"vhs",{get:function(){return fe.log.warn("player.vhs is deprecated. Use player.tech().vhs instead."),e.trigger({type:"usage",name:"vhs-player-access"}),Ft(l)},configurable:!0}),f.hasOwnProperty("dash")||Object.defineProperty(f,"dash",{get:function(){return fe.log.warn("player.dash is deprecated. Use player.tech().vhs instead."),Ft(l)},configurable:!0}),l.player_=f}if(l.tech_=e,l.source_=a,l.stats={},l.ignoreNextSeekingEvent_=!1,l.setOptions_(),l.options_.overrideNative&&e.overrideNativeAudioTracks&&e.overrideNativeVideoTracks)e.overrideNativeAudioTracks(!0),e.overrideNativeVideoTracks(!0);else if(l.options_.overrideNative&&(e.featuresNativeVideoTracks||e.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return l.on(et,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(m){var v=et.fullscreenElement||et.webkitFullscreenElement||et.mozFullScreenElement||et.msFullscreenElement;v&&v.contains(l.tech_.el())?l.masterPlaylistController_.fastQualityChange_():l.masterPlaylistController_.checkABR_()}),l.on(l.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),l.on(l.tech_,"error",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),l.on(l.tech_,"play",l.play),l}var o=s.prototype;return o.setOptions_=function(){var e=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=this.options_.handleManifestRedirects!==!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,typeof this.options_.blacklistDuration!="number"&&(this.options_.blacklistDuration=5*60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){var r=R_();r&&r.bandwidth&&(this.options_.bandwidth=r.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),r&&r.throughput&&(this.options_.throughput=r.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=rn.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===rn.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","experimentalBufferBasedABR","liveRangeSafeTimeDelta","experimentalLLHLS","useNetworkInformationApi","useDtsForTimestampOffset","experimentalExactManifestTimings","experimentalLeastPixelDiffSelector"].forEach(function(l){typeof e.source_[l]<"u"&&(e.options_[l]=e.source_[l])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},o.src=function(e,r){var l=this;if(e){this.setOptions_(),this.options_.src=ZC(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=cn,this.options_.sourceType=w0(r),this.options_.seekTo=function(v){l.tech_.setCurrentTime(v)},this.options_.smoothQualityChange&&fe.log.warn("smoothQualityChange is deprecated and will be removed in the next major version"),this.masterPlaylistController_=new RC(this.options_);var f=fe.mergeOptions({liveRangeSafeTimeDelta:Xr},this.options_,{seekable:function(){return l.seekable()},media:function(){return l.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_});this.playbackWatcher_=new BC(f),this.masterPlaylistController_.on("error",function(){var v=fe.players[l.tech_.options_.playerId],A=l.masterPlaylistController_.error;typeof A=="object"&&!A.code?A.code=3:typeof A=="string"&&(A={message:A,code:3}),v.error(A)});var m=this.options_.experimentalBufferBasedABR?cn.movingAverageBandwidthSelector(.55):cn.STANDARD_PLAYLIST_SELECTOR;this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):m.bind(this),this.masterPlaylistController_.selectInitialPlaylist=cn.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(A){this.masterPlaylistController_.selectPlaylist=A.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(A){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=A,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){var A=this.masterPlaylistController_.mainSegmentLoader_.bandwidth,L=ie.navigator.connection||ie.navigator.mozConnection||ie.navigator.webkitConnection,P=1e7;if(this.options_.useNetworkInformationApi&&L){var U=L.downlink*1e3*1e3;U>=P&&A>=P?A=Math.max(A,U):A=U}return A},set:function(A){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=A,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var A=1/(this.bandwidth||1),L;this.throughput>0?L=1/this.throughput:L=0;var P=Math.floor(1/(A+L));return P},set:function(){fe.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return l.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return l.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return l.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return l.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return l.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return l.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return l.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return l.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},mediaAppends:{get:function(){return l.masterPlaylistController_.mediaAppends_()||0},enumerable:!0},mainAppendsToLoadedData:{get:function(){return l.masterPlaylistController_.mainAppendsToLoadedData_()||0},enumerable:!0},audioAppendsToLoadedData:{get:function(){return l.masterPlaylistController_.audioAppendsToLoadedData_()||0},enumerable:!0},appendsToLoadedData:{get:function(){return l.masterPlaylistController_.appendsToLoadedData_()||0},enumerable:!0},timeToLoadedData:{get:function(){return l.masterPlaylistController_.timeToLoadedData_()||0},enumerable:!0},buffered:{get:function(){return Ms(l.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return l.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return l.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return l.tech_.name_},enumerable:!0},duration:{get:function(){return l.tech_.duration()},enumerable:!0},master:{get:function(){return l.playlists.master},enumerable:!0},playerDimensions:{get:function(){return l.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Ms(l.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return l.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){l.options_.useBandwidthFromLocalStorage&&KC({bandwidth:l.bandwidth,throughput:Math.round(l.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){kC(l)}),this.masterPlaylistController_.sourceUpdater_.on("createdsourcebuffers",function(){l.setupEme_()}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=ie.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}},o.createKeySessions_=function(){var e=this,r=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),QC({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:r&&r.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){e.logger_("created EME key session"),e.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(l){e.logger_("error while creating EME key session",l),e.player_.error({message:"Failed to initialize media keys for EME",code:3})})},o.handleWaitingForKey_=function(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()},o.setupEme_=function(){var e=this,r=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,l=YC({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:r&&r.media()});if(this.player_.tech_.on("keystatuschange",function(f){if(f.status==="output-restricted"){var m=e.masterPlaylistController_.master();if(!(!m||!m.playlists)){var v=[];if(m.playlists.forEach(function(L){L&&L.attributes&&L.attributes.RESOLUTION&&L.attributes.RESOLUTION.height>=720&&(!L.excludeUntil||L.excludeUntil<1/0)&&(L.excludeUntil=1/0,v.push(L))}),v.length){var A;(A=fe.log).warn.apply(A,['DRM keystatus changed to "output-restricted." Removing the following HD playlists that will most likely fail to play and clearing the buffer. This may be due to HDCP restrictions on the stream and the capabilities of the current device.'].concat(v)),e.masterPlaylistController_.fastQualityChange_()}}}}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),fe.browser.IE_VERSION===11||!l){this.masterPlaylistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()},o.setupQualityLevels_=function(){var e=this,r=fe.players[this.tech_.options_.playerId];!r||!r.qualityLevels||this.qualityLevels_||(this.qualityLevels_=r.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){jC(e.qualityLevels_,e)}),this.playlists.on("mediachange",function(){D_(e.qualityLevels_,e.playlists)}))},s.version=function(){return{"@videojs/http-streaming":L_,"mux.js":VC,"mpd-parser":GC,"m3u8-parser":zC,"aes-decrypter":WC}},o.version=function(){return this.constructor.version()},o.canChangeType=function(){return P_.canChangeType()},o.play=function(){this.masterPlaylistController_.play()},o.setCurrentTime=function(e){this.masterPlaylistController_.setCurrentTime(e)},o.duration=function(){return this.masterPlaylistController_.duration()},o.seekable=function(){return this.masterPlaylistController_.seekable()},o.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&ie.URL.revokeObjectURL&&(ie.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),d.prototype.dispose.call(this)},o.convertToProgramTime=function(e,r){return s2({playlist:this.masterPlaylistController_.media(),time:e,callback:r})},o.seekToProgramTime=function(e,r,l,f){return l===void 0&&(l=!0),f===void 0&&(f=2),o2({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:f,pauseAfterSeek:l,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:r})},s}($C),Tu={name:"videojs-http-streaming",VERSION:L_,canHandleSource:function(s,o){o===void 0&&(o={});var a=fe.mergeOptions(fe.options,o);return Tu.canPlayType(s.type,a)},handleSource:function(s,o,a){a===void 0&&(a={});var e=fe.mergeOptions(fe.options,a);return o.vhs=new pm(s,o,e),fe.hasOwnProperty("hls")||Object.defineProperty(o,"hls",{get:function(){return fe.log.warn("player.tech().hls is deprecated. Use player.tech().vhs instead."),o.vhs},configurable:!0}),o.vhs.xhr=o_(),o.vhs.src(s.src,s.type),o.vhs},canPlayType:function(s,o){var a=w0(s);if(!a)return"";var e=Tu.getOverrideNative(o),r=cn.supportsTypeNatively(a),l=!r||e;return l?"maybe":""},getOverrideNative:function(s){s===void 0&&(s={});var o=s,a=o.vhs,e=a===void 0?{}:a,r=o.hls,l=r===void 0?{}:r,f=!(fe.browser.IS_ANY_SAFARI||fe.browser.IS_IOS),m=e.overrideNative,v=m===void 0?f:m,A=l.overrideNative,L=A===void 0?!1:A;return L||v}},JC=function(){return Zc("avc1.4d400d,mp4a.40.2")};JC()&&fe.getTech("Html5").registerSourceHandler(Tu,0);fe.VhsHandler=pm;Object.defineProperty(fe,"HlsHandler",{get:function(){return fe.log.warn("videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead."),pm},configurable:!0});fe.VhsSourceHandler=Tu;Object.defineProperty(fe,"HlsSourceHandler",{get:function(){return fe.log.warn("videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead."),Tu},configurable:!0});fe.Vhs=cn;Object.defineProperty(fe,"Hls",{get:function(){return fe.log.warn("videojs.Hls is deprecated. Use videojs.Vhs instead."),cn},configurable:!0});fe.use||(fe.registerComponent("Hls",cn),fe.registerComponent("Vhs",cn));fe.options.vhs=fe.options.vhs||{};fe.options.hls=fe.options.hls||{};if(!fe.getPlugin||!fe.getPlugin("reloadSourceOnError")){var e3=fe.registerPlugin||fe.plugin;e3("reloadSourceOnError",HC)}const t3=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),i3=sS(t3);/*! @name videojs-vr @version 2.0.0 @license MIT */var n3=Kc.exports,v0;function r3(){return v0||(v0=1,function(d,s){(function(o,a){d.exports=a(i3)})(n3,function(o){function a(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var e=a(o),r="2.0.0";const l=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},f=function(i,t){for(var n=0,u=i.length;n<u;n++)t[n]=i[n]},m=function(i,t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);return i};var v=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof tv<"u"?tv:typeof self<"u"?self:{};function A(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var L={exports:{}};/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(i,t){/**
 * @license
 * gl-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *//**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(n,u){i.exports=u()})(v,function(){var n=function(M,D){if(!(M instanceof D))throw new TypeError("Cannot call a class as a function")},u=function(){function M(D,N){for(var V=0;V<N.length;V++){var K=N[V];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(D,K.key,K)}}return function(D,N,V){return N&&M(D.prototype,N),V&&M(D,V),D}}(),c=function(){function M(D,N){var V=[],K=!0,ue=!1,ge=void 0;try{for(var Ye=D[Symbol.iterator](),Ge;!(K=(Ge=Ye.next()).done)&&(V.push(Ge.value),!(N&&V.length===N));K=!0);}catch(ye){ue=!0,ge=ye}finally{try{!K&&Ye.return&&Ye.return()}finally{if(ue)throw ge}}return V}return function(D,N){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return M(D,N);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=.001,p=1,g=function(D,N){return"data:"+D+","+encodeURIComponent(N)},_=function(D,N,V){return D+(N-D)*V},x=function(){var M=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return M}}(),E=function(){var M=navigator.userAgent.indexOf("Version")!==-1&&navigator.userAgent.indexOf("Android")!==-1&&navigator.userAgent.indexOf("Chrome")!==-1;return function(){return M}}(),S=function(){var M=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return M}}(),C=function(){var M=navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return M}}(),I=function(){var M=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),D=M?parseInt(M[1],10):null;return function(){return D}}(),F=function(){var M=!1;return M=x()&&S()&&navigator.userAgent.indexOf("13_4")!==-1,function(){return M}}(),z=function(){var M=!1;if(I()===65){var D=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(D){var N=D[1].split("."),V=c(N,4);V[0],V[1];var K=V[2],ue=V[3];M=parseInt(K,10)===3325&&parseInt(ue,10)<148}}return function(){return M}}(),G=function(){var M=navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return M}}(),k=function(){var D=window.orientation==90||window.orientation==-90;return G()?!D:D},O=function(D){return!(isNaN(D)||D<=h||D>p)},se=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},oe=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},re=function(D){if(E())return!1;if(D.requestFullscreen)D.requestFullscreen();else if(D.webkitRequestFullscreen)D.webkitRequestFullscreen();else if(D.mozRequestFullScreen)D.mozRequestFullScreen();else if(D.msRequestFullscreen)D.msRequestFullscreen();else return!1;return!0},X=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},me=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},ke=function(D,N,V,K){var ue=D.createShader(D.VERTEX_SHADER);D.shaderSource(ue,N),D.compileShader(ue);var ge=D.createShader(D.FRAGMENT_SHADER);D.shaderSource(ge,V),D.compileShader(ge);var Ye=D.createProgram();D.attachShader(Ye,ue),D.attachShader(Ye,ge);for(var Ge in K)D.bindAttribLocation(Ye,K[Ge],Ge);return D.linkProgram(Ye),D.deleteShader(ue),D.deleteShader(ge),Ye},xe=function(D,N){for(var V={},K=D.getProgramParameter(N,D.ACTIVE_UNIFORMS),ue="",ge=0;ge<K;ge++){var Ye=D.getActiveUniform(N,ge);ue=Ye.name.replace("[0]",""),V[ue]=D.getUniformLocation(N,ue)}return V},Se=function(D,N,V,K,ue,ge,Ye){var Ge=1/(N-V),ye=1/(K-ue),Ie=1/(ge-Ye);return D[0]=-2*Ge,D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[5]=-2*ye,D[6]=0,D[7]=0,D[8]=0,D[9]=0,D[10]=2*Ie,D[11]=0,D[12]=(N+V)*Ge,D[13]=(ue+K)*ye,D[14]=(Ye+ge)*Ie,D[15]=1,D},we=function(){var D=!1;return function(N){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(N)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(N.substr(0,4)))&&(D=!0)}(navigator.userAgent||navigator.vendor||window.opera),D},Re=function(D,N){for(var V in N)N.hasOwnProperty(V)&&(D[V]=N[V]);return D},he=function(D){if(x()){var N=D.style.width,V=D.style.height;D.style.width=parseInt(N)+1+"px",D.style.height=parseInt(V)+"px",setTimeout(function(){D.style.width=N,D.style.height=V},100)}window.canvas=D},ce=function(){var M=Math.PI/180,D=Math.PI*.25;function N(ye,Ie,Je,xt){var wt=Math.tan(Ie?Ie.upDegrees*M:D),Ot=Math.tan(Ie?Ie.downDegrees*M:D),ii=Math.tan(Ie?Ie.leftDegrees*M:D),jt=Math.tan(Ie?Ie.rightDegrees*M:D),Gt=2/(ii+jt),Mi=2/(wt+Ot);return ye[0]=Gt,ye[1]=0,ye[2]=0,ye[3]=0,ye[4]=0,ye[5]=Mi,ye[6]=0,ye[7]=0,ye[8]=-((ii-jt)*Gt*.5),ye[9]=(wt-Ot)*Mi*.5,ye[10]=xt/(Je-xt),ye[11]=-1,ye[12]=0,ye[13]=0,ye[14]=xt*Je/(Je-xt),ye[15]=0,ye}function V(ye,Ie,Je){var xt=Ie[0],wt=Ie[1],Ot=Ie[2],ii=Ie[3],jt=xt+xt,Gt=wt+wt,Mi=Ot+Ot,Ki=xt*jt,nn=xt*Gt,Vi=xt*Mi,mn=wt*Gt,Wn=wt*Mi,jn=Ot*Mi,qn=ii*jt,Xn=ii*Gt,$a=ii*Mi;return ye[0]=1-(mn+jn),ye[1]=nn+$a,ye[2]=Vi-Xn,ye[3]=0,ye[4]=nn-$a,ye[5]=1-(Ki+jn),ye[6]=Wn+qn,ye[7]=0,ye[8]=Vi+Xn,ye[9]=Wn-qn,ye[10]=1-(Ki+mn),ye[11]=0,ye[12]=Je[0],ye[13]=Je[1],ye[14]=Je[2],ye[15]=1,ye}function K(ye,Ie,Je){var xt=Je[0],wt=Je[1],Ot=Je[2],ii,jt,Gt,Mi,Ki,nn,Vi,mn,Wn,jn,qn,Xn;return Ie===ye?(ye[12]=Ie[0]*xt+Ie[4]*wt+Ie[8]*Ot+Ie[12],ye[13]=Ie[1]*xt+Ie[5]*wt+Ie[9]*Ot+Ie[13],ye[14]=Ie[2]*xt+Ie[6]*wt+Ie[10]*Ot+Ie[14],ye[15]=Ie[3]*xt+Ie[7]*wt+Ie[11]*Ot+Ie[15]):(ii=Ie[0],jt=Ie[1],Gt=Ie[2],Mi=Ie[3],Ki=Ie[4],nn=Ie[5],Vi=Ie[6],mn=Ie[7],Wn=Ie[8],jn=Ie[9],qn=Ie[10],Xn=Ie[11],ye[0]=ii,ye[1]=jt,ye[2]=Gt,ye[3]=Mi,ye[4]=Ki,ye[5]=nn,ye[6]=Vi,ye[7]=mn,ye[8]=Wn,ye[9]=jn,ye[10]=qn,ye[11]=Xn,ye[12]=ii*xt+Ki*wt+Wn*Ot+Ie[12],ye[13]=jt*xt+nn*wt+jn*Ot+Ie[13],ye[14]=Gt*xt+Vi*wt+qn*Ot+Ie[14],ye[15]=Mi*xt+mn*wt+Xn*Ot+Ie[15]),ye}function ue(ye,Ie){var Je=Ie[0],xt=Ie[1],wt=Ie[2],Ot=Ie[3],ii=Ie[4],jt=Ie[5],Gt=Ie[6],Mi=Ie[7],Ki=Ie[8],nn=Ie[9],Vi=Ie[10],mn=Ie[11],Wn=Ie[12],jn=Ie[13],qn=Ie[14],Xn=Ie[15],$a=Je*jt-xt*ii,Kl=Je*Gt-wt*ii,Zl=Je*Mi-Ot*ii,$l=xt*Gt-wt*jt,Jl=xt*Mi-Ot*jt,eu=wt*Mi-Ot*Gt,tu=Ki*jn-nn*Wn,iu=Ki*qn-Vi*Wn,nu=Ki*Xn-mn*Wn,ru=nn*qn-Vi*jn,au=nn*Xn-mn*jn,su=Vi*Xn-mn*qn,en=$a*su-Kl*au+Zl*ru+$l*nu-Jl*iu+eu*tu;return en?(en=1/en,ye[0]=(jt*su-Gt*au+Mi*ru)*en,ye[1]=(wt*au-xt*su-Ot*ru)*en,ye[2]=(jn*eu-qn*Jl+Xn*$l)*en,ye[3]=(Vi*Jl-nn*eu-mn*$l)*en,ye[4]=(Gt*nu-ii*su-Mi*iu)*en,ye[5]=(Je*su-wt*nu+Ot*iu)*en,ye[6]=(qn*Zl-Wn*eu-Xn*Kl)*en,ye[7]=(Ki*eu-Vi*Zl+mn*Kl)*en,ye[8]=(ii*au-jt*nu+Mi*tu)*en,ye[9]=(xt*nu-Je*au-Ot*tu)*en,ye[10]=(Wn*Jl-jn*Zl+Xn*$a)*en,ye[11]=(nn*Zl-Ki*Jl-mn*$a)*en,ye[12]=(jt*iu-ii*ru-Gt*tu)*en,ye[13]=(Je*ru-xt*iu+wt*tu)*en,ye[14]=(jn*Kl-Wn*$l-qn*$a)*en,ye[15]=(Ki*$l-nn*Kl+Vi*$a)*en,ye):null}var ge=new Float32Array([0,0,0,1]),Ye=new Float32Array([0,0,0]);function Ge(ye,Ie,Je,xt,wt,Ot){N(ye,xt||null,Ot.depthNear,Ot.depthFar);var ii=Je.orientation||ge,jt=Je.position||Ye;V(Ie,ii,jt),wt&&K(Ie,Ie,wt),ue(Ie,Ie)}return function(ye,Ie,Je){return!ye||!Ie?!1:(ye.pose=Ie,ye.timestamp=Ie.timestamp,Ge(ye.leftProjectionMatrix,ye.leftViewMatrix,Ie,Je._getFieldOfView("left"),Je._getEyeOffset("left"),Je),Ge(ye.rightProjectionMatrix,ye.rightViewMatrix,Ie,Je._getFieldOfView("right"),Je._getEyeOffset("right"),Je),!0)}}(),pe=function(){var D=window.self!==window.top,N=Te(document.referrer),V=Te(window.location.href);return D&&N!==V},Te=function(D){var N,V=D.indexOf("://");V!==-1?N=V+3:N=0;var K=D.indexOf("/",N);return K===-1&&(K=D.length),D.substring(0,K)},He=function(D){if(D.w>1)return console.warn("getQuaternionAngle: w > 1"),0;var N=2*Math.acos(D.w);return N},Xe=function(){var M={};return function(D,N){M[D]===void 0&&(console.warn("webvr-polyfill: "+N),M[D]=!0)}}(),Qe=function(D,N){var V=N?"Please use "+N+" instead.":"";Xe(D,D+" has been deprecated. This may not work on native WebVR displays. "+V)};function lt(M,D,N){if(!D){N(M);return}for(var V=[],K=null,ue=0;ue<D.length;++ue){var ge=D[ue];switch(ge){case M.TEXTURE_BINDING_2D:case M.TEXTURE_BINDING_CUBE_MAP:var Ye=D[++ue];if(Ye<M.TEXTURE0||Ye>M.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),V.push(null,null);break}K||(K=M.getParameter(M.ACTIVE_TEXTURE)),M.activeTexture(Ye),V.push(M.getParameter(ge),null);break;case M.ACTIVE_TEXTURE:K=M.getParameter(M.ACTIVE_TEXTURE),V.push(null);break;default:V.push(M.getParameter(ge));break}}N(M);for(var ue=0;ue<D.length;++ue){var ge=D[ue],Ge=V[ue];switch(ge){case M.ACTIVE_TEXTURE:break;case M.ARRAY_BUFFER_BINDING:M.bindBuffer(M.ARRAY_BUFFER,Ge);break;case M.COLOR_CLEAR_VALUE:M.clearColor(Ge[0],Ge[1],Ge[2],Ge[3]);break;case M.COLOR_WRITEMASK:M.colorMask(Ge[0],Ge[1],Ge[2],Ge[3]);break;case M.CURRENT_PROGRAM:M.useProgram(Ge);break;case M.ELEMENT_ARRAY_BUFFER_BINDING:M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,Ge);break;case M.FRAMEBUFFER_BINDING:M.bindFramebuffer(M.FRAMEBUFFER,Ge);break;case M.RENDERBUFFER_BINDING:M.bindRenderbuffer(M.RENDERBUFFER,Ge);break;case M.TEXTURE_BINDING_2D:var Ye=D[++ue];if(Ye<M.TEXTURE0||Ye>M.TEXTURE31)break;M.activeTexture(Ye),M.bindTexture(M.TEXTURE_2D,Ge);break;case M.TEXTURE_BINDING_CUBE_MAP:var Ye=D[++ue];if(Ye<M.TEXTURE0||Ye>M.TEXTURE31)break;M.activeTexture(Ye),M.bindTexture(M.TEXTURE_CUBE_MAP,Ge);break;case M.VIEWPORT:M.viewport(Ge[0],Ge[1],Ge[2],Ge[3]);break;case M.BLEND:case M.CULL_FACE:case M.DEPTH_TEST:case M.SCISSOR_TEST:case M.STENCIL_TEST:Ge?M.enable(ge):M.disable(ge);break;default:console.log("No GL restore behavior for 0x"+ge.toString(16));break}K&&M.activeTexture(K)}}var rt=lt,Et=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join(`
`),Dt=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join(`
`);function Ht(M,D,N,V){this.gl=M,this.cardboardUI=D,this.bufferScale=N,this.dirtySubmitFrameBindings=V,this.ctxAttribs=M.getContextAttributes(),this.instanceExt=M.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=M.drawingBufferWidth,this.bufferHeight=M.drawingBufferHeight,this.realBindFramebuffer=M.bindFramebuffer,this.realEnable=M.enable,this.realDisable=M.disable,this.realColorMask=M.colorMask,this.realClearColor=M.clearColor,this.realViewport=M.viewport,x()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(M.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(M.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=ke(M,Et,Dt,this.attribs),this.uniforms=xe(M,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=M.createBuffer(),this.indexBuffer=M.createBuffer(),this.indexCount=0,this.renderTarget=M.createTexture(),this.framebuffer=M.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=M.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=M.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=M.createRenderbuffer()),this.patch(),this.onResize()}Ht.prototype.destroy=function(){var M=this.gl;this.unpatch(),M.deleteProgram(this.program),M.deleteBuffer(this.vertexBuffer),M.deleteBuffer(this.indexBuffer),M.deleteTexture(this.renderTarget),M.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&M.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&M.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&M.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},Ht.prototype.onResize=function(){var M=this.gl,D=this,N=[M.RENDERBUFFER_BINDING,M.TEXTURE_BINDING_2D,M.TEXTURE0];rt(M,N,function(V){D.realBindFramebuffer.call(V,V.FRAMEBUFFER,null),D.scissorTest&&D.realDisable.call(V,V.SCISSOR_TEST),D.realColorMask.call(V,!0,!0,!0,!0),D.realViewport.call(V,0,0,V.drawingBufferWidth,V.drawingBufferHeight),D.realClearColor.call(V,0,0,0,1),V.clear(V.COLOR_BUFFER_BIT),D.realBindFramebuffer.call(V,V.FRAMEBUFFER,D.framebuffer),V.bindTexture(V.TEXTURE_2D,D.renderTarget),V.texImage2D(V.TEXTURE_2D,0,D.ctxAttribs.alpha?V.RGBA:V.RGB,D.bufferWidth,D.bufferHeight,0,D.ctxAttribs.alpha?V.RGBA:V.RGB,V.UNSIGNED_BYTE,null),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.framebufferTexture2D(V.FRAMEBUFFER,V.COLOR_ATTACHMENT0,V.TEXTURE_2D,D.renderTarget,0),D.ctxAttribs.depth&&D.ctxAttribs.stencil?(V.bindRenderbuffer(V.RENDERBUFFER,D.depthStencilBuffer),V.renderbufferStorage(V.RENDERBUFFER,V.DEPTH_STENCIL,D.bufferWidth,D.bufferHeight),V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_STENCIL_ATTACHMENT,V.RENDERBUFFER,D.depthStencilBuffer)):D.ctxAttribs.depth?(V.bindRenderbuffer(V.RENDERBUFFER,D.depthBuffer),V.renderbufferStorage(V.RENDERBUFFER,V.DEPTH_COMPONENT16,D.bufferWidth,D.bufferHeight),V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_ATTACHMENT,V.RENDERBUFFER,D.depthBuffer)):D.ctxAttribs.stencil&&(V.bindRenderbuffer(V.RENDERBUFFER,D.stencilBuffer),V.renderbufferStorage(V.RENDERBUFFER,V.STENCIL_INDEX8,D.bufferWidth,D.bufferHeight),V.framebufferRenderbuffer(V.FRAMEBUFFER,V.STENCIL_ATTACHMENT,V.RENDERBUFFER,D.stencilBuffer)),!V.checkFramebufferStatus(V.FRAMEBUFFER)===V.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),D.realBindFramebuffer.call(V,V.FRAMEBUFFER,D.lastBoundFramebuffer),D.scissorTest&&D.realEnable.call(V,V.SCISSOR_TEST),D.realColorMask.apply(V,D.colorMask),D.realViewport.apply(V,D.viewport),D.realClearColor.apply(V,D.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},Ht.prototype.patch=function(){if(!this.isPatched){var M=this,D=this.gl.canvas,N=this.gl;x()||(D.width=se()*this.bufferScale,D.height=oe()*this.bufferScale,Object.defineProperty(D,"width",{configurable:!0,enumerable:!0,get:function(){return M.bufferWidth},set:function(K){M.bufferWidth=K,M.realCanvasWidth.set.call(D,K),M.onResize()}}),Object.defineProperty(D,"height",{configurable:!0,enumerable:!0,get:function(){return M.bufferHeight},set:function(K){M.bufferHeight=K,M.realCanvasHeight.set.call(D,K),M.onResize()}})),this.lastBoundFramebuffer=N.getParameter(N.FRAMEBUFFER_BINDING),this.lastBoundFramebuffer==null&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(N.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(V,K){M.lastBoundFramebuffer=K||M.framebuffer,M.realBindFramebuffer.call(N,V,M.lastBoundFramebuffer)},this.cullFace=N.getParameter(N.CULL_FACE),this.depthTest=N.getParameter(N.DEPTH_TEST),this.blend=N.getParameter(N.BLEND),this.scissorTest=N.getParameter(N.SCISSOR_TEST),this.stencilTest=N.getParameter(N.STENCIL_TEST),N.enable=function(V){switch(V){case N.CULL_FACE:M.cullFace=!0;break;case N.DEPTH_TEST:M.depthTest=!0;break;case N.BLEND:M.blend=!0;break;case N.SCISSOR_TEST:M.scissorTest=!0;break;case N.STENCIL_TEST:M.stencilTest=!0;break}M.realEnable.call(N,V)},N.disable=function(V){switch(V){case N.CULL_FACE:M.cullFace=!1;break;case N.DEPTH_TEST:M.depthTest=!1;break;case N.BLEND:M.blend=!1;break;case N.SCISSOR_TEST:M.scissorTest=!1;break;case N.STENCIL_TEST:M.stencilTest=!1;break}M.realDisable.call(N,V)},this.colorMask=N.getParameter(N.COLOR_WRITEMASK),N.colorMask=function(V,K,ue,ge){M.colorMask[0]=V,M.colorMask[1]=K,M.colorMask[2]=ue,M.colorMask[3]=ge,M.realColorMask.call(N,V,K,ue,ge)},this.clearColor=N.getParameter(N.COLOR_CLEAR_VALUE),N.clearColor=function(V,K,ue,ge){M.clearColor[0]=V,M.clearColor[1]=K,M.clearColor[2]=ue,M.clearColor[3]=ge,M.realClearColor.call(N,V,K,ue,ge)},this.viewport=N.getParameter(N.VIEWPORT),N.viewport=function(V,K,ue,ge){M.viewport[0]=V,M.viewport[1]=K,M.viewport[2]=ue,M.viewport[3]=ge,M.realViewport.call(N,V,K,ue,ge)},this.isPatched=!0,he(D)}},Ht.prototype.unpatch=function(){if(this.isPatched){var M=this.gl,D=this.gl.canvas;x()||(Object.defineProperty(D,"width",this.realCanvasWidth),Object.defineProperty(D,"height",this.realCanvasHeight)),D.width=this.bufferWidth,D.height=this.bufferHeight,M.bindFramebuffer=this.realBindFramebuffer,M.enable=this.realEnable,M.disable=this.realDisable,M.colorMask=this.realColorMask,M.clearColor=this.realClearColor,M.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&M.bindFramebuffer(M.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){he(D)},1)}},Ht.prototype.setTextureBounds=function(M,D){M||(M=[0,0,.5,1]),D||(D=[.5,0,.5,1]),this.viewportOffsetScale[0]=M[0],this.viewportOffsetScale[1]=M[1],this.viewportOffsetScale[2]=M[2],this.viewportOffsetScale[3]=M[3],this.viewportOffsetScale[4]=D[0],this.viewportOffsetScale[5]=D[1],this.viewportOffsetScale[6]=D[2],this.viewportOffsetScale[7]=D[3]},Ht.prototype.submitFrame=function(){var M=this.gl,D=this,N=[];if(this.dirtySubmitFrameBindings||N.push(M.CURRENT_PROGRAM,M.ARRAY_BUFFER_BINDING,M.ELEMENT_ARRAY_BUFFER_BINDING,M.TEXTURE_BINDING_2D,M.TEXTURE0),rt(M,N,function(K){D.realBindFramebuffer.call(K,K.FRAMEBUFFER,null);var ue=0,ge=0;D.instanceExt&&(ue=K.getVertexAttrib(D.attribs.position,D.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),ge=K.getVertexAttrib(D.attribs.texCoord,D.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),D.cullFace&&D.realDisable.call(K,K.CULL_FACE),D.depthTest&&D.realDisable.call(K,K.DEPTH_TEST),D.blend&&D.realDisable.call(K,K.BLEND),D.scissorTest&&D.realDisable.call(K,K.SCISSOR_TEST),D.stencilTest&&D.realDisable.call(K,K.STENCIL_TEST),D.realColorMask.call(K,!0,!0,!0,!0),D.realViewport.call(K,0,0,K.drawingBufferWidth,K.drawingBufferHeight),(D.ctxAttribs.alpha||x())&&(D.realClearColor.call(K,0,0,0,1),K.clear(K.COLOR_BUFFER_BIT)),K.useProgram(D.program),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,D.indexBuffer),K.bindBuffer(K.ARRAY_BUFFER,D.vertexBuffer),K.enableVertexAttribArray(D.attribs.position),K.enableVertexAttribArray(D.attribs.texCoord),K.vertexAttribPointer(D.attribs.position,2,K.FLOAT,!1,20,0),K.vertexAttribPointer(D.attribs.texCoord,3,K.FLOAT,!1,20,8),D.instanceExt&&(ue!=0&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.position,0),ge!=0&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.texCoord,0)),K.activeTexture(K.TEXTURE0),K.uniform1i(D.uniforms.diffuse,0),K.bindTexture(K.TEXTURE_2D,D.renderTarget),K.uniform4fv(D.uniforms.viewportOffsetScale,D.viewportOffsetScale),K.drawElements(K.TRIANGLES,D.indexCount,K.UNSIGNED_SHORT,0),D.cardboardUI&&D.cardboardUI.renderNoState(),D.realBindFramebuffer.call(D.gl,K.FRAMEBUFFER,D.framebuffer),D.ctxAttribs.preserveDrawingBuffer||(D.realClearColor.call(K,0,0,0,0),K.clear(K.COLOR_BUFFER_BIT)),D.dirtySubmitFrameBindings||D.realBindFramebuffer.call(K,K.FRAMEBUFFER,D.lastBoundFramebuffer),D.cullFace&&D.realEnable.call(K,K.CULL_FACE),D.depthTest&&D.realEnable.call(K,K.DEPTH_TEST),D.blend&&D.realEnable.call(K,K.BLEND),D.scissorTest&&D.realEnable.call(K,K.SCISSOR_TEST),D.stencilTest&&D.realEnable.call(K,K.STENCIL_TEST),D.realColorMask.apply(K,D.colorMask),D.realViewport.apply(K,D.viewport),(D.ctxAttribs.alpha||!D.ctxAttribs.preserveDrawingBuffer)&&D.realClearColor.apply(K,D.clearColor),D.instanceExt&&(ue!=0&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.position,ue),ge!=0&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.texCoord,ge))}),x()){var V=M.canvas;(V.width!=D.bufferWidth||V.height!=D.bufferHeight)&&(D.bufferWidth=V.width,D.bufferHeight=V.height,D.onResize())}},Ht.prototype.updateDeviceInfo=function(M){var D=this.gl,N=this,V=[D.ARRAY_BUFFER_BINDING,D.ELEMENT_ARRAY_BUFFER_BINDING];rt(D,V,function(K){var ue=N.computeMeshVertices_(N.meshWidth,N.meshHeight,M);if(K.bindBuffer(K.ARRAY_BUFFER,N.vertexBuffer),K.bufferData(K.ARRAY_BUFFER,ue,K.STATIC_DRAW),!N.indexCount){var ge=N.computeMeshIndices_(N.meshWidth,N.meshHeight);K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,N.indexBuffer),K.bufferData(K.ELEMENT_ARRAY_BUFFER,ge,K.STATIC_DRAW),N.indexCount=ge.length}})},Ht.prototype.computeMeshVertices_=function(M,D,N){for(var V=new Float32Array(2*M*D*5),K=N.getLeftEyeVisibleTanAngles(),ue=N.getLeftEyeNoLensTanAngles(),ge=N.getLeftEyeVisibleScreenRect(ue),Ye=0,Ge=0;Ge<2;Ge++){for(var ye=0;ye<D;ye++)for(var Ie=0;Ie<M;Ie++,Ye++){var Je=Ie/(M-1),xt=ye/(D-1),wt=Je,Ot=xt,ii=_(K[0],K[2],Je),jt=_(K[3],K[1],xt),Gt=Math.sqrt(ii*ii+jt*jt),Mi=N.distortion.distortInverse(Gt),Ki=ii*Mi/Gt,nn=jt*Mi/Gt;Je=(Ki-ue[0])/(ue[2]-ue[0]),xt=(nn-ue[3])/(ue[1]-ue[3]),Je=(ge.x+Je*ge.width-.5)*2,xt=(ge.y+xt*ge.height-.5)*2,V[Ye*5+0]=Je,V[Ye*5+1]=xt,V[Ye*5+2]=wt,V[Ye*5+3]=Ot,V[Ye*5+4]=Ge}var Vi=K[2]-K[0];K[0]=-(Vi+K[0]),K[2]=Vi-K[2],Vi=ue[2]-ue[0],ue[0]=-(Vi+ue[0]),ue[2]=Vi-ue[2],ge.x=1-(ge.x+ge.width)}return V},Ht.prototype.computeMeshIndices_=function(M,D){for(var N=new Uint16Array(2*(M-1)*(D-1)*6),V=M/2,K=D/2,ue=0,ge=0,Ye=0;Ye<2;Ye++)for(var Ge=0;Ge<D;Ge++)for(var ye=0;ye<M;ye++,ue++)ye==0||Ge==0||(ye<=V==Ge<=K?(N[ge++]=ue,N[ge++]=ue-M-1,N[ge++]=ue-M,N[ge++]=ue-M-1,N[ge++]=ue,N[ge++]=ue-1):(N[ge++]=ue-1,N[ge++]=ue-M,N[ge++]=ue,N[ge++]=ue-M,N[ge++]=ue-1,N[ge++]=ue-M-1));return N},Ht.prototype.getOwnPropertyDescriptor_=function(M,D){var N=Object.getOwnPropertyDescriptor(M,D);return(N.get===void 0||N.set===void 0)&&(N.configurable=!0,N.enumerable=!0,N.get=function(){return this.getAttribute(D)},N.set=function(V){this.setAttribute(D,V)}),N};var Ve=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join(`
`),zi=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join(`
`),It=Math.PI/180,qt=60,Rt=12,ti=20,kt=1,$e=.75,nt=.3125,st=4,ve=28,Ze=1.5;function $(M){this.gl=M,this.attribs={position:0},this.program=ke(M,Ve,zi,this.attribs),this.uniforms=xe(M,this.program),this.vertexBuffer=M.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}$.prototype.destroy=function(){var M=this.gl;this.listener&&M.canvas.removeEventListener("click",this.listener,!1),M.deleteProgram(this.program),M.deleteBuffer(this.vertexBuffer)},$.prototype.listen=function(M,D){var N=this.gl.canvas;this.listener=function(V){var K=N.clientWidth/2,ue=ve*Ze;V.clientX>K-ue&&V.clientX<K+ue&&V.clientY>N.clientHeight-ue?M(V):V.clientX<ue&&V.clientY<ue&&D(V)},N.addEventListener("click",this.listener,!1)},$.prototype.onResize=function(){var M=this.gl,D=this,N=[M.ARRAY_BUFFER_BINDING];rt(M,N,function(V){var K=[],ue=V.drawingBufferWidth/2,ge=Math.max(screen.width,screen.height)*window.devicePixelRatio,Ye=V.drawingBufferWidth/ge,Ge=Ye*window.devicePixelRatio,ye=st*Ge/2,Ie=ve*Ze*Ge,Je=ve*Ge/2,xt=(ve*Ze-ve)*Ge;K.push(ue-ye,Ie),K.push(ue-ye,V.drawingBufferHeight),K.push(ue+ye,Ie),K.push(ue+ye,V.drawingBufferHeight),D.gearOffset=K.length/2;function wt(Mi,Ki){var nn=(90-Mi)*It,Vi=Math.cos(nn),mn=Math.sin(nn);K.push(nt*Vi*Je+ue,nt*mn*Je+Je),K.push(Ki*Vi*Je+ue,Ki*mn*Je+Je)}for(var Ot=0;Ot<=6;Ot++){var ii=Ot*qt;wt(ii,kt),wt(ii+Rt,kt),wt(ii+ti,$e),wt(ii+(qt-ti),$e),wt(ii+(qt-Rt),kt)}D.gearVertexCount=K.length/2-D.gearOffset,D.arrowOffset=K.length/2;function jt(Mi,Ki){K.push(xt+Mi,V.drawingBufferHeight-xt-Ki)}var Gt=ye/Math.sin(45*It);jt(0,Je),jt(Je,0),jt(Je+Gt,Gt),jt(Gt,Je+Gt),jt(Gt,Je-Gt),jt(0,Je),jt(Je,Je*2),jt(Je+Gt,Je*2-Gt),jt(Gt,Je-Gt),jt(0,Je),jt(Gt,Je-ye),jt(ve*Ge,Je-ye),jt(Gt,Je+ye),jt(ve*Ge,Je+ye),D.arrowVertexCount=K.length/2-D.arrowOffset,V.bindBuffer(V.ARRAY_BUFFER,D.vertexBuffer),V.bufferData(V.ARRAY_BUFFER,new Float32Array(K),V.STATIC_DRAW)})},$.prototype.render=function(){var M=this.gl,D=this,N=[M.CULL_FACE,M.DEPTH_TEST,M.BLEND,M.SCISSOR_TEST,M.STENCIL_TEST,M.COLOR_WRITEMASK,M.VIEWPORT,M.CURRENT_PROGRAM,M.ARRAY_BUFFER_BINDING];rt(M,N,function(V){V.disable(V.CULL_FACE),V.disable(V.DEPTH_TEST),V.disable(V.BLEND),V.disable(V.SCISSOR_TEST),V.disable(V.STENCIL_TEST),V.colorMask(!0,!0,!0,!0),V.viewport(0,0,V.drawingBufferWidth,V.drawingBufferHeight),D.renderNoState()})},$.prototype.renderNoState=function(){var M=this.gl;M.useProgram(this.program),M.bindBuffer(M.ARRAY_BUFFER,this.vertexBuffer),M.enableVertexAttribArray(this.attribs.position),M.vertexAttribPointer(this.attribs.position,2,M.FLOAT,!1,8,0),M.uniform4f(this.uniforms.color,1,1,1,1),Se(this.projMat,0,M.drawingBufferWidth,0,M.drawingBufferHeight,.1,1024),M.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),M.drawArrays(M.TRIANGLE_STRIP,0,4),M.drawArrays(M.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),M.drawArrays(M.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Q(M){this.coefficients=M}Q.prototype.distortInverse=function(M){for(var D=0,N=1,V=M-this.distort(D);Math.abs(N-D)>1e-4;){var K=M-this.distort(N),ue=N-K*((N-D)/(K-V));D=N,N=ue,V=K}return N},Q.prototype.distort=function(M){for(var D=M*M,N=0,V=0;V<this.coefficients.length;V++)N=D*(N+this.coefficients[V]);return(N+1)*M};var Ue=Math.PI/180,Be=180/Math.PI,le=function(D,N,V){this.x=D||0,this.y=N||0,this.z=V||0};le.prototype={constructor:le,set:function(D,N,V){return this.x=D,this.y=N,this.z=V,this},copy:function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var D=this.length();if(D!==0){var N=1/D;this.multiplyScalar(N)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(D){this.x*=D,this.y*=D,this.z*=D},applyQuaternion:function(D){var N=this.x,V=this.y,K=this.z,ue=D.x,ge=D.y,Ye=D.z,Ge=D.w,ye=Ge*N+ge*K-Ye*V,Ie=Ge*V+Ye*N-ue*K,Je=Ge*K+ue*V-ge*N,xt=-ue*N-ge*V-Ye*K;return this.x=ye*Ge+xt*-ue+Ie*-Ye-Je*-ge,this.y=Ie*Ge+xt*-ge+Je*-ue-ye*-Ye,this.z=Je*Ge+xt*-Ye+ye*-ge-Ie*-ue,this},dot:function(D){return this.x*D.x+this.y*D.y+this.z*D.z},crossVectors:function(D,N){var V=D.x,K=D.y,ue=D.z,ge=N.x,Ye=N.y,Ge=N.z;return this.x=K*Ge-ue*Ye,this.y=ue*ge-V*Ge,this.z=V*Ye-K*ge,this}};var Fe=function(D,N,V,K){this.x=D||0,this.y=N||0,this.z=V||0,this.w=K!==void 0?K:1};Fe.prototype={constructor:Fe,set:function(D,N,V,K){return this.x=D,this.y=N,this.z=V,this.w=K,this},copy:function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this.w=D.w,this},setFromEulerXYZ:function(D,N,V){var K=Math.cos(D/2),ue=Math.cos(N/2),ge=Math.cos(V/2),Ye=Math.sin(D/2),Ge=Math.sin(N/2),ye=Math.sin(V/2);return this.x=Ye*ue*ge+K*Ge*ye,this.y=K*Ge*ge-Ye*ue*ye,this.z=K*ue*ye+Ye*Ge*ge,this.w=K*ue*ge-Ye*Ge*ye,this},setFromEulerYXZ:function(D,N,V){var K=Math.cos(D/2),ue=Math.cos(N/2),ge=Math.cos(V/2),Ye=Math.sin(D/2),Ge=Math.sin(N/2),ye=Math.sin(V/2);return this.x=Ye*ue*ge+K*Ge*ye,this.y=K*Ge*ge-Ye*ue*ye,this.z=K*ue*ye-Ye*Ge*ge,this.w=K*ue*ge+Ye*Ge*ye,this},setFromAxisAngle:function(D,N){var V=N/2,K=Math.sin(V);return this.x=D.x*K,this.y=D.y*K,this.z=D.z*K,this.w=Math.cos(V),this},multiply:function(D){return this.multiplyQuaternions(this,D)},multiplyQuaternions:function(D,N){var V=D.x,K=D.y,ue=D.z,ge=D.w,Ye=N.x,Ge=N.y,ye=N.z,Ie=N.w;return this.x=V*Ie+ge*Ye+K*ye-ue*Ge,this.y=K*Ie+ge*Ge+ue*Ye-V*ye,this.z=ue*Ie+ge*ye+V*Ge-K*Ye,this.w=ge*Ie-V*Ye-K*Ge-ue*ye,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var D=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return D===0?(this.x=0,this.y=0,this.z=0,this.w=1):(D=1/D,this.x=this.x*D,this.y=this.y*D,this.z=this.z*D,this.w=this.w*D),this},slerp:function(D,N){if(N===0)return this;if(N===1)return this.copy(D);var V=this.x,K=this.y,ue=this.z,ge=this.w,Ye=ge*D.w+V*D.x+K*D.y+ue*D.z;if(Ye<0?(this.w=-D.w,this.x=-D.x,this.y=-D.y,this.z=-D.z,Ye=-Ye):this.copy(D),Ye>=1)return this.w=ge,this.x=V,this.y=K,this.z=ue,this;var Ge=Math.acos(Ye),ye=Math.sqrt(1-Ye*Ye);if(Math.abs(ye)<.001)return this.w=.5*(ge+this.w),this.x=.5*(V+this.x),this.y=.5*(K+this.y),this.z=.5*(ue+this.z),this;var Ie=Math.sin((1-N)*Ge)/ye,Je=Math.sin(N*Ge)/ye;return this.w=ge*Ie+this.w*Je,this.x=V*Ie+this.x*Je,this.y=K*Ie+this.y*Je,this.z=ue*Ie+this.z*Je,this},setFromUnitVectors:function(){var M,D,N=1e-6;return function(V,K){return M===void 0&&(M=new le),D=V.dot(K)+1,D<N?(D=0,Math.abs(V.x)>Math.abs(V.z)?M.set(-V.y,V.x,0):M.set(0,-V.z,V.y)):M.crossVectors(V,K),this.x=M.x,this.y=M.y,this.z=M.z,this.w=D,this.normalize(),this}}()};function dt(M){this.width=M.width||se(),this.height=M.height||oe(),this.widthMeters=M.widthMeters,this.heightMeters=M.heightMeters,this.bevelMeters=M.bevelMeters}var bt=new dt({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ot=new dt({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),yt={CardboardV1:new Bt({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Bt({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function mt(M,D){this.viewer=yt.CardboardV2,this.updateDeviceParams(M),this.distortion=new Q(this.viewer.distortionCoefficients);for(var N=0;N<D.length;N++){var V=D[N];yt[V.id]=new Bt(V)}}mt.prototype.updateDeviceParams=function(M){this.device=this.determineDevice_(M)||this.device},mt.prototype.getDevice=function(){return this.device},mt.prototype.setViewer=function(M){this.viewer=M,this.distortion=new Q(this.viewer.distortionCoefficients)},mt.prototype.determineDevice_=function(M){if(!M)return x()?(console.warn("Using fallback iOS device measurements."),ot):(console.warn("Using fallback Android device measurements."),bt);var D=.0254,N=D/M.xdpi,V=D/M.ydpi,K=se(),ue=oe();return new dt({widthMeters:N*K,heightMeters:V*ue,bevelMeters:M.bevelMm*.001})},mt.prototype.getDistortedFieldOfViewLeftEye=function(){var M=this.viewer,D=this.device,N=this.distortion,V=M.screenLensDistance,K=(D.widthMeters-M.interLensDistance)/2,ue=M.interLensDistance/2,ge=M.baselineLensDistance-D.bevelMeters,Ye=D.heightMeters-ge,Ge=Be*Math.atan(N.distort(K/V)),ye=Be*Math.atan(N.distort(ue/V)),Ie=Be*Math.atan(N.distort(ge/V)),Je=Be*Math.atan(N.distort(Ye/V));return{leftDegrees:Math.min(Ge,M.fov),rightDegrees:Math.min(ye,M.fov),downDegrees:Math.min(Ie,M.fov),upDegrees:Math.min(Je,M.fov)}},mt.prototype.getLeftEyeVisibleTanAngles=function(){var M=this.viewer,D=this.device,N=this.distortion,V=Math.tan(-Ue*M.fov),K=Math.tan(Ue*M.fov),ue=Math.tan(Ue*M.fov),ge=Math.tan(-Ue*M.fov),Ye=D.widthMeters/4,Ge=D.heightMeters/2,ye=M.baselineLensDistance-D.bevelMeters-Ge,Ie=M.interLensDistance/2-Ye,Je=-ye,xt=M.screenLensDistance,wt=N.distort((Ie-Ye)/xt),Ot=N.distort((Je+Ge)/xt),ii=N.distort((Ie+Ye)/xt),jt=N.distort((Je-Ge)/xt),Gt=new Float32Array(4);return Gt[0]=Math.max(V,wt),Gt[1]=Math.min(K,Ot),Gt[2]=Math.min(ue,ii),Gt[3]=Math.max(ge,jt),Gt},mt.prototype.getLeftEyeNoLensTanAngles=function(){var M=this.viewer,D=this.device,N=this.distortion,V=new Float32Array(4),K=N.distortInverse(Math.tan(-Ue*M.fov)),ue=N.distortInverse(Math.tan(Ue*M.fov)),ge=N.distortInverse(Math.tan(Ue*M.fov)),Ye=N.distortInverse(Math.tan(-Ue*M.fov)),Ge=D.widthMeters/4,ye=D.heightMeters/2,Ie=M.baselineLensDistance-D.bevelMeters-ye,Je=M.interLensDistance/2-Ge,xt=-Ie,wt=M.screenLensDistance,Ot=(Je-Ge)/wt,ii=(xt+ye)/wt,jt=(Je+Ge)/wt,Gt=(xt-ye)/wt;return V[0]=Math.max(K,Ot),V[1]=Math.min(ue,ii),V[2]=Math.min(ge,jt),V[3]=Math.max(Ye,Gt),V},mt.prototype.getLeftEyeVisibleScreenRect=function(M){var D=this.viewer,N=this.device,V=D.screenLensDistance,K=(N.widthMeters-D.interLensDistance)/2,ue=D.baselineLensDistance-N.bevelMeters,ge=(M[0]*V+K)/N.widthMeters,Ye=(M[1]*V+ue)/N.heightMeters,Ge=(M[2]*V+K)/N.widthMeters,ye=(M[3]*V+ue)/N.heightMeters;return{x:ge,y:ye,width:Ge-ge,height:Ye-ye}},mt.prototype.getFieldOfViewLeftEye=function(M){return M?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},mt.prototype.getFieldOfViewRightEye=function(M){var D=this.getFieldOfViewLeftEye(M);return{leftDegrees:D.rightDegrees,rightDegrees:D.leftDegrees,upDegrees:D.upDegrees,downDegrees:D.downDegrees}},mt.prototype.getUndistortedFieldOfViewLeftEye=function(){var M=this.getUndistortedParams_();return{leftDegrees:Be*Math.atan(M.outerDist),rightDegrees:Be*Math.atan(M.innerDist),downDegrees:Be*Math.atan(M.bottomDist),upDegrees:Be*Math.atan(M.topDist)}},mt.prototype.getUndistortedViewportLeftEye=function(){var M=this.getUndistortedParams_(),D=this.viewer,N=this.device,V=D.screenLensDistance,K=N.widthMeters/V,ue=N.heightMeters/V,ge=N.width/K,Ye=N.height/ue,Ge=Math.round((M.eyePosX-M.outerDist)*ge),ye=Math.round((M.eyePosY-M.bottomDist)*Ye);return{x:Ge,y:ye,width:Math.round((M.eyePosX+M.innerDist)*ge)-Ge,height:Math.round((M.eyePosY+M.topDist)*Ye)-ye}},mt.prototype.getUndistortedParams_=function(){var M=this.viewer,D=this.device,N=this.distortion,V=M.screenLensDistance,K=M.interLensDistance/2/V,ue=D.widthMeters/V,ge=D.heightMeters/V,Ye=ue/2-K,Ge=(M.baselineLensDistance-D.bevelMeters)/V,ye=M.fov,Ie=N.distortInverse(Math.tan(Ue*ye)),Je=Math.min(Ye,Ie),xt=Math.min(K,Ie),wt=Math.min(Ge,Ie),Ot=Math.min(ge-Ge,Ie);return{outerDist:Je,innerDist:xt,topDist:Ot,bottomDist:wt,eyePosX:Ye,eyePosY:Ge}};function Bt(M){this.id=M.id,this.label=M.label,this.fov=M.fov,this.interLensDistance=M.interLensDistance,this.baselineLensDistance=M.baselineLensDistance,this.screenLensDistance=M.screenLensDistance,this.distortionCoefficients=M.distortionCoefficients,this.inverseCoefficients=M.inverseCoefficients}mt.Viewers=yt;var _t=1,Ct="2019-11-09T17:36:14Z",Ei=[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}],pn={format:_t,last_updated:Ct,devices:Ei};function Ya(M,D){if(this.dpdb=pn,this.recalculateDeviceParams_(),M){this.onDeviceParamsUpdated=D;var N=new XMLHttpRequest,V=this;N.open("GET",M,!0),N.addEventListener("load",function(){V.loading=!1,N.status>=200&&N.status<=299?(V.dpdb=JSON.parse(N.response),V.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),N.send()}}Ya.prototype.getDeviceParams=function(){return this.deviceParams},Ya.prototype.recalculateDeviceParams_=function(){var M=this.calcDeviceParams_();M?(this.deviceParams=M,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Ya.prototype.calcDeviceParams_=function(){var M=this.dpdb;if(!M)return console.error("DPDB not available."),null;if(M.format!=1)return console.error("DPDB has unexpected format version."),null;if(!M.devices||!M.devices.length)return console.error("DPDB does not have a devices section."),null;var D=navigator.userAgent||navigator.vendor||window.opera,N=se(),V=oe();if(!M.devices)return console.error("DPDB has no devices section."),null;for(var K=0;K<M.devices.length;K++){var ue=M.devices[K];if(!ue.rules){console.warn("Device["+K+"] has no rules section.");continue}if(ue.type!="ios"&&ue.type!="android"){console.warn("Device["+K+"] has invalid type.");continue}if(x()==(ue.type=="ios")){for(var ge=!1,Ye=0;Ye<ue.rules.length;Ye++){var Ge=ue.rules[Ye];if(this.ruleMatches_(Ge,D,N,V)){ge=!0;break}}if(ge){var ye=ue.dpi[0]||ue.dpi,Ie=ue.dpi[1]||ue.dpi;return new Sf({xdpi:ye,ydpi:Ie,bevelMm:ue.bw})}}}return console.warn("No DPDB device match."),null},Ya.prototype.ruleMatches_=function(M,D,N,V){if(!M.ua&&!M.res||(M.ua&&M.ua.substring(0,2)==="SM"&&(M.ua=M.ua.substring(0,7)),M.ua&&D.indexOf(M.ua)<0))return!1;if(M.res){if(!M.res[0]||!M.res[1])return!1;var K=M.res[0],ue=M.res[1];if(Math.min(N,V)!=Math.min(K,ue)||Math.max(N,V)!=Math.max(K,ue))return!1}return!0};function Sf(M){this.xdpi=M.xdpi,this.ydpi=M.ydpi,this.bevelMm=M.bevelMm}function Ka(M,D){this.set(M,D)}Ka.prototype.set=function(M,D){this.sample=M,this.timestampS=D},Ka.prototype.copy=function(M){this.set(M.sample,M.timestampS)};function fa(M,D){this.kFilter=M,this.isDebug=D,this.currentAccelMeasurement=new Ka,this.currentGyroMeasurement=new Ka,this.previousGyroMeasurement=new Ka,x()?this.filterQ=new Fe(-1,0,0,1):this.filterQ=new Fe(1,0,0,1),this.previousFilterQ=new Fe,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Fe,this.isOrientationInitialized=!1,this.estimatedGravity=new le,this.measuredGravity=new le,this.gyroIntegralQ=new Fe}fa.prototype.addAccelMeasurement=function(M,D){this.currentAccelMeasurement.set(M,D)},fa.prototype.addGyroMeasurement=function(M,D){this.currentGyroMeasurement.set(M,D);var N=D-this.previousGyroMeasurement.timestampS;O(N)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},fa.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var M=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,D=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,M);this.gyroIntegralQ.multiply(D),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(D);var N=new Fe;N.copy(this.filterQ),N.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(N),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var V=new Fe;V.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),V.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Be*He(V),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var K=new Fe;K.copy(this.filterQ),K.multiply(V),this.filterQ.slerp(K,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},fa.prototype.getOrientation=function(){return this.filterQ},fa.prototype.accelToQuaternion_=function(M){var D=new le;D.copy(M),D.normalize();var N=new Fe;return N.setFromUnitVectors(new le(0,0,-1),D),N.inverse(),N},fa.prototype.gyroToQuaternionDelta_=function(M,D){var N=new Fe,V=new le;return V.copy(M),V.normalize(),N.setFromAxisAngle(V,M.length()*D),N};function Eo(M,D){this.predictionTimeS=M,this.isDebug=D,this.previousQ=new Fe,this.previousTimestampS=null,this.deltaQ=new Fe,this.outQ=new Fe}Eo.prototype.getPrediction=function(M,D,N){if(!this.previousTimestampS)return this.previousQ.copy(M),this.previousTimestampS=N,M;var V=new le;V.copy(D),V.normalize();var K=D.length();if(K<Ue*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Be*K).toFixed(1)),this.outQ.copy(M),this.previousQ.copy(M),this.outQ;var ue=K*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(V,ue),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(M),this.previousTimestampS=N,this.outQ};function Rn(M,D,N,V){this.yawOnly=N,this.accelerometer=new le,this.gyroscope=new le,this.filter=new fa(M,V),this.posePredictor=new Eo(D,V),this.isFirefoxAndroid=C(),this.isIOS=x();var K=I();this.isDeviceMotionInRadians=!this.isIOS&&K&&K<66,this.isWithoutDeviceMotion=z()||F(),this.filterToWorldQ=new Fe,x()?this.filterToWorldQ.setFromAxisAngle(new le(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new le(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Fe,this.worldToScreenQ=new Fe,this.originalPoseAdjustQ=new Fe,this.originalPoseAdjustQ.setFromAxisAngle(new le(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),k()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Fe,this.orientationOut_=new Float32Array(4),this.start()}Rn.prototype.getPosition=function(){return null},Rn.prototype.getOrientation=function(){var M=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var K=new Fe().setFromAxisAngle(new le(0,0,-1),0),ue=new Fe;return window.orientation===-90?ue.setFromAxisAngle(new le(0,1,0),Math.PI/-2):ue.setFromAxisAngle(new le(0,1,0),Math.PI/2),K.multiply(ue)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var K=new Fe;return K.setFromAxisAngle(new le(1,0,0),-Math.PI/2),K}(),M=this._deviceOrientationQ;var N=new Fe;return N.copy(M),N.multiply(this.deviceOrientationFilterToWorldQ),N.multiply(this.resetQ),N.multiply(this.worldToScreenQ),N.multiplyQuaternions(this.deviceOrientationFixQ,N),this.yawOnly&&(N.x=0,N.z=0,N.normalize()),this.orientationOut_[0]=N.x,this.orientationOut_[1]=N.y,this.orientationOut_[2]=N.z,this.orientationOut_[3]=N.w,this.orientationOut_}else{var D=this.filter.getOrientation();M=this.posePredictor.getPrediction(D,this.gyroscope,this.previousTimestampS)}var N=new Fe;return N.copy(this.filterToWorldQ),N.multiply(this.resetQ),N.multiply(M),N.multiply(this.worldToScreenQ),this.yawOnly&&(N.x=0,N.z=0,N.normalize()),this.orientationOut_[0]=N.x,this.orientationOut_[1]=N.y,this.orientationOut_[2]=N.z,this.orientationOut_[3]=N.w,this.orientationOut_},Rn.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),k()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Rn.prototype.onDeviceOrientation_=function(M){this._deviceOrientationQ=this._deviceOrientationQ||new Fe;var D=M.alpha,N=M.beta,V=M.gamma;D=(D||0)*Math.PI/180,N=(N||0)*Math.PI/180,V=(V||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(N,D,-V)},Rn.prototype.onDeviceMotion_=function(M){this.updateDeviceMotion_(M)},Rn.prototype.updateDeviceMotion_=function(M){var D=M.accelerationIncludingGravity,N=M.rotationRate,V=M.timeStamp/1e3,K=V-this.previousTimestampS;if(K<0){Xe("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=V;return}else if(K<=h||K>p){Xe("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=V;return}this.accelerometer.set(-D.x,-D.y,-D.z),N&&(G()?this.gyroscope.set(-N.beta,N.alpha,N.gamma):this.gyroscope.set(N.alpha,N.beta,N.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,V)),this.filter.addAccelMeasurement(this.accelerometer,V),this.previousTimestampS=V},Rn.prototype.onOrientationChange_=function(M){this.setScreenTransform_()},Rn.prototype.onMessage_=function(M){var D=M.data;if(!(!D||!D.type)){var N=D.type.toLowerCase();N==="devicemotion"&&this.updateDeviceMotion_(D.deviceMotionEvent)}},Rn.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new le(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new le(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Rn.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),x()&&pe()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Rn.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var As=60,kc=new le(1,0,0),Bc=new le(0,0,1),Mo=new Fe;Mo.setFromAxisAngle(kc,-Math.PI/2),Mo.multiply(new Fe().setFromAxisAngle(Bc,Math.PI/2));var xr=function(){function M(D){n(this,M),this.config=D,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Fe,this._outQ=new Fe,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return u(M,[{key:"init",value:function(){var N=null;try{N=new RelativeOrientationSensor({frequency:As,referenceFrame:"screen"}),N.addEventListener("error",this._onSensorError)}catch(V){this.errors.push(V),V.name==="SecurityError"?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):V.name==="ReferenceError"?this.useDeviceMotion():console.error(V)}N&&(this.api="sensor",this.sensor=N,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Rn(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var N=this.sensor.quaternion;this._sensorQ.set(N[0],N[1],N[2],N[3]);var V=this._outQ;return V.copy(Mo),V.multiply(this._sensorQ),this.config.YAW_ONLY&&(V.x=V.z=0,V.normalize()),this._out[0]=V.x,this._out[1]=V.y,this._out[2]=V.z,this._out[3]=V.w,this._out}},{key:"_onSensorError",value:function(N){this.errors.push(N.error),N.error.name==="NotAllowedError"?console.error("Permission to access sensor was denied"):N.error.name==="NotReadableError"?console.error("Sensor could not be read"):console.error(N.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),M}(),Nc="<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>";function pa(){this.loadIcon_();var M=document.createElement("div"),ge=M.style;ge.position="fixed",ge.top=0,ge.right=0,ge.bottom=0,ge.left=0,ge.backgroundColor="gray",ge.fontFamily="sans-serif",ge.zIndex=1e6;var D=document.createElement("img");D.src=this.icon;var ge=D.style;ge.marginLeft="25%",ge.marginTop="25%",ge.width="50%",M.appendChild(D);var N=document.createElement("div"),ge=N.style;ge.textAlign="center",ge.fontSize="16px",ge.lineHeight="24px",ge.margin="24px 25%",ge.width="50%",N.innerHTML="Place your phone into your Cardboard viewer.",M.appendChild(N);var V=document.createElement("div"),ge=V.style;ge.backgroundColor="#CFD8DC",ge.position="fixed",ge.bottom=0,ge.width="100%",ge.height="48px",ge.padding="14px 24px",ge.boxSizing="border-box",ge.color="#656A6B",M.appendChild(V);var K=document.createElement("div");K.style.float="left",K.innerHTML="No Cardboard viewer?";var ue=document.createElement("a");ue.href="https://www.google.com/get/cardboard/get-cardboard/",ue.innerHTML="get one",ue.target="_blank";var ge=ue.style;ge.float="right",ge.fontWeight=600,ge.textTransform="uppercase",ge.borderLeft="1px solid gray",ge.paddingLeft="24px",ge.textDecoration="none",ge.color="#656A6B",V.appendChild(K),V.appendChild(ue),this.overlay=M,this.text=N,this.hide()}pa.prototype.show=function(M){!M&&!this.overlay.parentElement?document.body.appendChild(this.overlay):M&&(this.overlay.parentElement&&this.overlay.parentElement!=M&&this.overlay.parentElement.removeChild(this.overlay),M.appendChild(this.overlay)),this.overlay.style.display="block";var D=this.overlay.querySelector("img"),N=D.style;k()?(N.width="20%",N.marginLeft="40%",N.marginTop="3%"):(N.width="50%",N.marginLeft="25%",N.marginTop="25%")},pa.prototype.hide=function(){this.overlay.style.display="none"},pa.prototype.showTemporarily=function(M,D){this.show(D),this.timer=setTimeout(this.hide.bind(this),M)},pa.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},pa.prototype.update=function(){this.disableShowTemporarily(),!k()&&we()?this.show():this.hide()},pa.prototype.loadIcon_=function(){this.icon=g("image/svg+xml",Nc)};var wf="CardboardV1",ee="WEBVR_CARDBOARD_VIEWER",Oe="webvr-polyfill-viewer-selector";function Ae(M){try{this.selectedKey=localStorage.getItem(ee)}catch(D){console.error("Failed to load viewer profile: %s",D)}this.selectedKey||(this.selectedKey=M||wf),this.dialog=this.createDialog_(mt.Viewers),this.root=null,this.onChangeCallbacks_=[]}Ae.prototype.show=function(M){this.root=M,M.appendChild(this.dialog);var D=this.dialog.querySelector("#"+this.selectedKey);D.checked=!0,this.dialog.style.display="block"},Ae.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},Ae.prototype.getCurrentViewer=function(){return mt.Viewers[this.selectedKey]},Ae.prototype.getSelectedKey_=function(){var M=this.dialog.querySelector("input[name=field]:checked");return M?M.id:null},Ae.prototype.onChange=function(M){this.onChangeCallbacks_.push(M)},Ae.prototype.fireOnChange_=function(M){for(var D=0;D<this.onChangeCallbacks_.length;D++)this.onChangeCallbacks_[D](M)},Ae.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!mt.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(mt.Viewers[this.selectedKey]);try{localStorage.setItem(ee,this.selectedKey)}catch(M){console.error("Failed to save viewer profile: %s",M)}this.hide()},Ae.prototype.createDialog_=function(M){var D=document.createElement("div");D.classList.add(Oe),D.style.display="none";var N=document.createElement("div"),ue=N.style;ue.position="fixed",ue.left=0,ue.top=0,ue.width="100%",ue.height="100%",ue.background="rgba(0, 0, 0, 0.3)",N.addEventListener("click",this.hide.bind(this));var V=280,K=document.createElement("div"),ue=K.style;ue.boxSizing="border-box",ue.position="fixed",ue.top="24px",ue.left="50%",ue.marginLeft=-V/2+"px",ue.width=V+"px",ue.padding="24px",ue.overflow="hidden",ue.background="#fafafa",ue.fontFamily="'Roboto', sans-serif",ue.boxShadow="0px 5px 20px #666",K.appendChild(this.createH1_("Select your viewer"));for(var ge in M)K.appendChild(this.createChoice_(ge,M[ge].label));return K.appendChild(this.createButton_("Save",this.onSave_.bind(this))),D.appendChild(N),D.appendChild(K),D},Ae.prototype.createH1_=function(M){var D=document.createElement("h1"),N=D.style;return N.color="black",N.fontSize="20px",N.fontWeight="bold",N.marginTop=0,N.marginBottom="24px",D.innerHTML=M,D},Ae.prototype.createChoice_=function(M,D){var N=document.createElement("div");N.style.marginTop="8px",N.style.color="black";var V=document.createElement("input");V.style.fontSize="30px",V.setAttribute("id",M),V.setAttribute("type","radio"),V.setAttribute("value",M),V.setAttribute("name","field");var K=document.createElement("label");return K.style.marginLeft="4px",K.setAttribute("for",M),K.innerHTML=D,N.appendChild(V),N.appendChild(K),N},Ae.prototype.createButton_=function(M,D){var N=document.createElement("button");N.innerHTML=M;var V=N.style;return V.float="right",V.textTransform="uppercase",V.color="#1094f7",V.fontSize="14px",V.letterSpacing=0,V.border=0,V.background="none",V.marginTop="16px",N.addEventListener("click",D),N};var Ne=typeof window<"u"?window:typeof v<"u"?v:typeof self<"u"?self:{};function pt(M){return M&&M.__esModule&&Object.prototype.hasOwnProperty.call(M,"default")?M.default:M}function Yt(M,D){return D={exports:{}},M(D,D.exports),D.exports}var zt=Yt(function(M,D){(function(V,K){M.exports=K()})(Ne,function(){return function(N){var V={};function K(ue){if(V[ue])return V[ue].exports;var ge=V[ue]={i:ue,l:!1,exports:{}};return N[ue].call(ge.exports,ge,ge.exports,K),ge.l=!0,ge.exports}return K.m=N,K.c=V,K.d=function(ue,ge,Ye){K.o(ue,ge)||Object.defineProperty(ue,ge,{configurable:!1,enumerable:!0,get:Ye})},K.n=function(ue){var ge=ue&&ue.__esModule?function(){return ue.default}:function(){return ue};return K.d(ge,"a",ge),ge},K.o=function(ue,ge){return Object.prototype.hasOwnProperty.call(ue,ge)},K.p="",K(K.s=0)}([function(N,V,K){var ue=function(){function Ie(Je,xt){for(var wt=0;wt<xt.length;wt++){var Ot=xt[wt];Ot.enumerable=Ot.enumerable||!1,Ot.configurable=!0,"value"in Ot&&(Ot.writable=!0),Object.defineProperty(Je,Ot.key,Ot)}}return function(Je,xt,wt){return xt&&Ie(Je.prototype,xt),wt&&Ie(Je,wt),Je}}();function ge(Ie,Je){if(!(Ie instanceof Je))throw new TypeError("Cannot call a class as a function")}var Ye=K(1),Ge=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,ye=function(){function Ie(){ge(this,Ie),Ge?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",Ye),this.noSleepVideo.addEventListener("timeupdate",(function(Je){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return ue(Ie,[{key:"enable",value:function(){Ge?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Ge?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),Ie}();N.exports=ye},function(N,V,K){N.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),$t=pt(zt),Wt=1e3,Hi=[0,0,.5,1],Ni=[.5,0,.5,1],Vt=window.requestAnimationFrame,di=window.cancelAnimationFrame;function br(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null}function xi(M){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:M.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:M.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:M.canPresent},maxLayers:{writable:!1,enumerable:!0,value:M.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Qe("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),M.hasOrientation}}})}function oi(M){M=M||{};var D="wakelock"in M?M.wakelock:!0;this.isPolyfilled=!0,this.displayId=Wt++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Qe("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new xi({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,D&&we()&&(this.wakelock_=new $t)}oi.prototype.getFrameData=function(M){return ce(M,this._getPose(),this)},oi.prototype.getPose=function(){return Qe("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},oi.prototype.resetPose=function(){return Qe("VRDisplay.prototype.resetPose"),this._resetPose()},oi.prototype.getImmediatePose=function(){return Qe("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},oi.prototype.requestAnimationFrame=function(M){return Vt(M)},oi.prototype.cancelAnimationFrame=function(M){return di(M)},oi.prototype.wrapForFullscreen=function(M){if(x())return M;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var D=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",D.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==M)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=M,this.originalParent_=M.parentElement,this.originalParent_||document.body.appendChild(M),!this.fullscreenWrapper_.parentElement){var N=this.fullscreenElement_.parentElement;N.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),N.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var V=this;function K(){if(V.fullscreenElement_){var ue=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];V.fullscreenElement_.setAttribute("style",ue.join("; ")+";")}}return K(),this.fullscreenWrapper_},oi.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var M=this.fullscreenElement_;this.fullscreenElementCachedStyle_?M.setAttribute("style",this.fullscreenElementCachedStyle_):M.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var D=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(M),this.originalParent_===D?D.insertBefore(M,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(M),D.removeChild(this.fullscreenWrapper_),M}},oi.prototype.requestPresent=function(M){var D=this.isPresenting,N=this;return M instanceof Array||(Qe("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),M=[M]),new Promise(function(V,K){if(!N.capabilities.canPresent){K(new Error("VRDisplay is not capable of presenting."));return}if(M.length==0||M.length>N.capabilities.maxLayers){K(new Error("Invalid number of layers."));return}var ue=M[0];if(!ue.source){V();return}var ge=ue.leftBounds||Hi,Ye=ue.rightBounds||Ni;if(D){var Ge=N.layer_;Ge.source!==ue.source&&(Ge.source=ue.source);for(var ye=0;ye<4;ye++)Ge.leftBounds[ye]=ge[ye],Ge.rightBounds[ye]=Ye[ye];N.wrapForFullscreen(N.layer_.source),N.updatePresent_(),V();return}if(N.layer_={predistorted:ue.predistorted,source:ue.source,leftBounds:ge.slice(0),rightBounds:Ye.slice(0)},N.waitingForPresent_=!1,N.layer_&&N.layer_.source){var Ie=N.wrapForFullscreen(N.layer_.source),Je=function(){var Ot=me();N.isPresenting=Ie===Ot,N.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(ii){console.error("screen.orientation.lock() failed due to",ii.message)}),N.waitingForPresent_=!1,N.beginPresent_(),V()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),N.removeFullscreenWrapper(),N.disableWakeLock(),N.endPresent_(),N.removeFullscreenListeners_()),N.fireVRDisplayPresentChange_()},xt=function(){N.waitingForPresent_&&(N.removeFullscreenWrapper(),N.removeFullscreenListeners_(),N.disableWakeLock(),N.waitingForPresent_=!1,N.isPresenting=!1,K(new Error("Unable to present.")))};N.addFullscreenListeners_(Ie,Je,xt),re(Ie)?(N.enableWakeLock(),N.waitingForPresent_=!0):(x()||E())&&(N.enableWakeLock(),N.isPresenting=!0,N.beginPresent_(),N.fireVRDisplayPresentChange_(),V())}!N.waitingForPresent_&&!x()&&(X(),K(new Error("Unable to present.")))})},oi.prototype.exitPresent=function(){var M=this.isPresenting,D=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(N,V){M?(!X()&&x()&&(D.endPresent_(),D.fireVRDisplayPresentChange_()),E()&&(D.removeFullscreenWrapper(),D.removeFullscreenListeners_(),D.endPresent_(),D.fireVRDisplayPresentChange_()),N()):V(new Error("Was not presenting to VRDisplay."))})},oi.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},oi.prototype.fireVRDisplayPresentChange_=function(){var M=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(M)},oi.prototype.fireVRDisplayConnect_=function(){var M=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(M)},oi.prototype.addFullscreenListeners_=function(M,D,N){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=M,this.fullscreenChangeHandler_=D,this.fullscreenErrorHandler_=N,D&&(document.fullscreenEnabled?M.addEventListener("fullscreenchange",D,!1):document.webkitFullscreenEnabled?M.addEventListener("webkitfullscreenchange",D,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",D,!1):document.msFullscreenEnabled&&M.addEventListener("msfullscreenchange",D,!1)),N&&(document.fullscreenEnabled?M.addEventListener("fullscreenerror",N,!1):document.webkitFullscreenEnabled?M.addEventListener("webkitfullscreenerror",N,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",N,!1):document.msFullscreenEnabled&&M.addEventListener("msfullscreenerror",N,!1))},oi.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var M=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var D=this.fullscreenChangeHandler_;M.removeEventListener("fullscreenchange",D,!1),M.removeEventListener("webkitfullscreenchange",D,!1),document.removeEventListener("mozfullscreenchange",D,!1),M.removeEventListener("msfullscreenchange",D,!1)}if(this.fullscreenErrorHandler_){var N=this.fullscreenErrorHandler_;M.removeEventListener("fullscreenerror",N,!1),M.removeEventListener("webkitfullscreenerror",N,!1),document.removeEventListener("mozfullscreenerror",N,!1),M.removeEventListener("msfullscreenerror",N,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},oi.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},oi.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},oi.prototype.beginPresent_=function(){},oi.prototype.endPresent_=function(){},oi.prototype.submitFrame=function(M){},oi.prototype.getEyeParameters=function(M){return null};var Yi={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Za={LEFT:"left",RIGHT:"right"};function ni(M){var D=Re({},Yi);M=Re(D,M||{}),oi.call(this,{wakelock:M.MOBILE_WAKE_LOCK}),this.config=M,this.displayName="Cardboard VRDisplay",this.capabilities=new xi({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new xr(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Ya(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new mt(this.dpdb_.getDeviceParams(),M.ADDITIONAL_VIEWERS),this.viewerSelector_=new Ae(M.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new pa),x()&&window.addEventListener("resize",this.onResize_.bind(this))}return ni.prototype=Object.create(oi.prototype),ni.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},ni.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},ni.prototype._getFieldOfView=function(M){var D;if(M==Za.LEFT)D=this.deviceInfo_.getFieldOfViewLeftEye();else if(M==Za.RIGHT)D=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",M),null;return D},ni.prototype._getEyeOffset=function(M){var D;if(M==Za.LEFT)D=[-this.deviceInfo_.viewer.interLensDistance*.5,0,0];else if(M==Za.RIGHT)D=[this.deviceInfo_.viewer.interLensDistance*.5,0,0];else return console.error("Invalid eye provided: %s",M),null;return D},ni.prototype.getEyeParameters=function(M){var D=this._getEyeOffset(M),N=this._getFieldOfView(M),V={offset:D,renderWidth:this.deviceInfo_.device.width*.5*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(V,"fieldOfView",{enumerable:!0,get:function(){return Qe("VRFieldOfView","VRFrameData's projection matrices"),N}}),V},ni.prototype.onDeviceParamsUpdated_=function(M){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(M),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},ni.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},ni.prototype.beginPresent_=function(){var M=this.layer_.source.getContext("webgl");M||(M=this.layer_.source.getContext("experimental-webgl")),M||(M=this.layer_.source.getContext("webgl2")),M&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(M.canvas.width=se()*this.bufferScale_,M.canvas.height=oe()*this.bufferScale_,this.cardboardUI_=new $(M)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new $(M)),this.distorter_=new Ht(M,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(D){this.viewerSelector_.show(this.layer_.source.parentElement),D.stopPropagation(),D.preventDefault()}).bind(this),(function(D){this.exitPresent(),D.stopPropagation(),D.preventDefault()}).bind(this)),this.rotateInstructions_&&(k()&&we()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},ni.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},ni.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},ni.prototype.submitFrame=function(M){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var D=this.layer_.source.getContext("webgl");D||(D=this.layer_.source.getContext("experimental-webgl")),D||(D=this.layer_.source.getContext("webgl2"));var N=D.canvas;(N.width!=this.lastWidth||N.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=N.width,this.lastHeight=N.height,this.cardboardUI_.render()}},ni.prototype.onOrientationChange_=function(M){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},ni.prototype.onResize_=function(M){if(this.layer_){var D=this.layer_.source.getContext("webgl");D||(D=this.layer_.source.getContext("experimental-webgl")),D||(D=this.layer_.source.getContext("webgl2"));var N=["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"];D.canvas.setAttribute("style",N.join("; ")+";"),he(D.canvas)}},ni.prototype.onViewerChanged_=function(M){this.deviceInfo_.setViewer(M),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},ni.prototype.fireVRDisplayDeviceParamsChange_=function(){var M=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(M)},ni.VRFrameData=br,ni.VRDisplay=oi,ni})})(L);var P=A(L.exports),U="0.10.12",W={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function Y(i){this.config=m(m({},W),i),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&l())&&(this.enable(),this.getVRDisplays().then(function(t){t&&t[0]&&t[0].fireVRDisplayConnect_&&t[0].fireVRDisplayConnect_()}))}Y.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(l()){var i=new P({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(i)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},Y.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var i=this.native.VRFrameData,t=new this.native.VRFrameData,n=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(u){if(u instanceof i){n.call(this,u);return}n.call(this,t),u.pose=t.pose,f(t.leftProjectionMatrix,u.leftProjectionMatrix),f(t.rightProjectionMatrix,u.rightProjectionMatrix),f(t.leftViewMatrix,u.leftViewMatrix),f(t.rightViewMatrix,u.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=P.VRDisplay,window.VRFrameData=P.VRFrameData},Y.prototype.getVRDisplays=function(){return this.config,this.hasNative?this.native.getVRDisplays.call(navigator).then(i=>i.length>0?i:this.getPolyfillDisplays()):Promise.resolve(this.getPolyfillDisplays())},Y.version=U,Y.VRFrameData=P.VRFrameData,Y.VRDisplay=P.VRDisplay;function q(i,t,n,u,c,h,p){try{var g=i[h](p),_=g.value}catch(x){n(x);return}g.done?t(_):Promise.resolve(_).then(u,c)}function _e(i){return function(){var t=this,n=arguments;return new Promise(function(u,c){var h=i.apply(t,n);function p(_){q(h,u,c,p,g,"next",_)}function g(_){q(h,u,c,p,g,"throw",_)}p(void 0)})}}function J(){return J=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(i[u]=n[u])}return i},J.apply(this,arguments)}const at="125",Me={LEFT:0,MIDDLE:1,RIGHT:2},Le=0,ze=1,De=2,Ee=1,We=2,Ce=3,vt=0,je=1,ut=2,Kt=1,Jt=0,hi=1,Oi=2,vi=3,$i=4,li=5,lr=100,Mn=101,ur=102,cr=103,Mr=104,Zn=200,Ma=201,Ca=202,Pa=203,Lu=204,il=205,kd=206,Bd=207,Nd=208,Ud=209,is=210,Cr=0,nl=1,ui=2,rl=3,al=4,Hd=5,sl=6,ol=7,La=0,Rs=1,ll=2,Ia=0,Iu=1,Du=2,ai=3,Vd=4,Gd=5,Ru=300,ul=301,cl=302,ns=303,Ou=304,dl=306,hl=307,fl=1e3,Ai=1001,Os=1002,on=1003,Fu=1004,ku=1005,qi=1006,zd=1007,Pr=1008,ln=1009,Wd=1010,jd=1011,Kr=1012,dr=1013,Zr=1014,ei=1015,Fs=1016,ks=1017,Bs=1018,qd=1019,kn=1020,Si=1021,Bn=1022,fi=1023,Xd=1024,Qd=1025,$r=1026,Jr=1027,Bu=1028,Nu=1029,Uu=1030,Ns=1031,Yd=1032,Us=1033,pl=33776,rs=33777,Hu=33778,Vu=33779,as=35840,Da=35841,ss=35842,ea=35843,ml=36196,gl=37492,Hs=37496,hr=37808,Kd=37809,Vs=37810,Gu=37811,zu=37812,Wu=37813,Zd=37814,Gs=37815,zs=37816,ju=37817,$d=37818,Jd=37819,qu=37820,eh=37821,th=36492,Xu=37840,ih=37841,nh=37842,rh=37843,ah=37844,sh=37845,oh=37846,Ws=37847,js=37848,lh=37849,uh=37850,Qu=37851,ch=37852,Yu=37853,dh=2200,hh=2201,fh=2202,ta=2300,Lr=2301,Ra=2302,Cn=2400,Oa=2401,os=2402,qs=2500,vl=2501,ph=0,ls=3e3,Ku=3001,Xs=3007,mh=3002,ia=3003,gh=3004,vh=3005,yi=3006,yh=3200,_h=3201,Fa=0,Zu=1,yl=7680,$u=519,Qs=35044,ka=35048,Ju="300 es";function $n(){}J($n.prototype,{addEventListener:function(i,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[i]===void 0&&(n[i]=[]),n[i].indexOf(t)===-1&&n[i].push(t)},hasEventListener:function(i,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[i]!==void 0&&n[i].indexOf(t)!==-1},removeEventListener:function(i,t){if(this._listeners===void 0)return;const u=this._listeners[i];if(u!==void 0){const c=u.indexOf(t);c!==-1&&u.splice(c,1)}},dispatchEvent:function(i){if(this._listeners===void 0)return;const n=this._listeners[i.type];if(n!==void 0){i.target=this;const u=n.slice(0);for(let c=0,h=u.length;c<h;c++)u[c].call(this,i)}}});const Xi=[];for(let i=0;i<256;i++)Xi[i]=(i<16?"0":"")+i.toString(16);let Ir=1234567;const At={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const i=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Xi[i&255]+Xi[i>>8&255]+Xi[i>>16&255]+Xi[i>>24&255]+"-"+Xi[t&255]+Xi[t>>8&255]+"-"+Xi[t>>16&15|64]+Xi[t>>24&255]+"-"+Xi[n&63|128]+Xi[n>>8&255]+"-"+Xi[n>>16&255]+Xi[n>>24&255]+Xi[u&255]+Xi[u>>8&255]+Xi[u>>16&255]+Xi[u>>24&255]).toUpperCase()},clamp:function(i,t,n){return Math.max(t,Math.min(n,i))},euclideanModulo:function(i,t){return(i%t+t)%t},mapLinear:function(i,t,n,u,c){return u+(i-t)*(c-u)/(n-t)},lerp:function(i,t,n){return(1-n)*i+n*t},damp:function(i,t,n,u){return At.lerp(i,t,1-Math.exp(-n*u))},pingpong:function(i,t=1){return t-Math.abs(At.euclideanModulo(i,t*2)-t)},smoothstep:function(i,t,n){return i<=t?0:i>=n?1:(i=(i-t)/(n-t),i*i*(3-2*i))},smootherstep:function(i,t,n){return i<=t?0:i>=n?1:(i=(i-t)/(n-t),i*i*i*(i*(i*6-15)+10))},randInt:function(i,t){return i+Math.floor(Math.random()*(t-i+1))},randFloat:function(i,t){return i+Math.random()*(t-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return i!==void 0&&(Ir=i%2147483647),Ir=Ir*16807%2147483647,(Ir-1)/2147483646},degToRad:function(i){return i*At.DEG2RAD},radToDeg:function(i){return i*At.RAD2DEG},isPowerOfTwo:function(i){return(i&i-1)===0&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,t,n,u,c){const h=Math.cos,p=Math.sin,g=h(n/2),_=p(n/2),x=h((t+u)/2),E=p((t+u)/2),S=h((t-u)/2),C=p((t-u)/2),I=h((u-t)/2),F=p((u-t)/2);switch(c){case"XYX":i.set(g*E,_*S,_*C,g*x);break;case"YZY":i.set(_*C,g*E,_*S,g*x);break;case"ZXZ":i.set(_*S,_*C,g*E,g*x);break;case"XZX":i.set(g*E,_*F,_*I,g*x);break;case"YXY":i.set(_*I,g*E,_*F,g*x);break;case"ZYZ":i.set(_*F,_*I,g*E,g*x);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+c)}}};class be{constructor(t=0,n=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,n){return n!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t,n){return n!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,u=this.y,c=t.elements;return this.x=c[0]*n+c[3]*u+c[6],this.y=c[1]*n+c[4]*u+c[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(t,Math.min(n,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,u=this.y-t.y;return n*n+u*u}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,u){return this.x=t.x+(n.x-t.x)*u,this.y=t.y+(n.y-t.y)*u,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n,u){return u!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const u=Math.cos(n),c=Math.sin(n),h=this.x-t.x,p=this.y-t.y;return this.x=h*u-p*c+t.x,this.y=h*c+p*u+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Ji{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,n,u,c,h,p,g,_,x){const E=this.elements;return E[0]=t,E[1]=c,E[2]=g,E[3]=n,E[4]=h,E[5]=_,E[6]=u,E[7]=p,E[8]=x,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return new this.constructor().fromArray(this.elements)}copy(t){const n=this.elements,u=t.elements;return n[0]=u[0],n[1]=u[1],n[2]=u[2],n[3]=u[3],n[4]=u[4],n[5]=u[5],n[6]=u[6],n[7]=u[7],n[8]=u[8],this}extractBasis(t,n,u){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),u.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const u=t.elements,c=n.elements,h=this.elements,p=u[0],g=u[3],_=u[6],x=u[1],E=u[4],S=u[7],C=u[2],I=u[5],F=u[8],z=c[0],G=c[3],k=c[6],O=c[1],se=c[4],oe=c[7],re=c[2],X=c[5],me=c[8];return h[0]=p*z+g*O+_*re,h[3]=p*G+g*se+_*X,h[6]=p*k+g*oe+_*me,h[1]=x*z+E*O+S*re,h[4]=x*G+E*se+S*X,h[7]=x*k+E*oe+S*me,h[2]=C*z+I*O+F*re,h[5]=C*G+I*se+F*X,h[8]=C*k+I*oe+F*me,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],u=t[1],c=t[2],h=t[3],p=t[4],g=t[5],_=t[6],x=t[7],E=t[8];return n*p*E-n*g*x-u*h*E+u*g*_+c*h*x-c*p*_}invert(){const t=this.elements,n=t[0],u=t[1],c=t[2],h=t[3],p=t[4],g=t[5],_=t[6],x=t[7],E=t[8],S=E*p-g*x,C=g*_-E*h,I=x*h-p*_,F=n*S+u*C+c*I;if(F===0)return this.set(0,0,0,0,0,0,0,0,0);const z=1/F;return t[0]=S*z,t[1]=(c*x-E*u)*z,t[2]=(g*u-c*p)*z,t[3]=C*z,t[4]=(E*n-c*_)*z,t[5]=(c*h-g*n)*z,t[6]=I*z,t[7]=(u*_-x*n)*z,t[8]=(p*n-u*h)*z,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,u,c,h,p,g){const _=Math.cos(h),x=Math.sin(h);return this.set(u*_,u*x,-u*(_*p+x*g)+p+t,-c*x,c*_,-c*(-x*p+_*g)+g+n,0,0,1),this}scale(t,n){const u=this.elements;return u[0]*=t,u[3]*=t,u[6]*=t,u[1]*=n,u[4]*=n,u[7]*=n,this}rotate(t){const n=Math.cos(t),u=Math.sin(t),c=this.elements,h=c[0],p=c[3],g=c[6],_=c[1],x=c[4],E=c[7];return c[0]=n*h+u*_,c[3]=n*p+u*x,c[6]=n*g+u*E,c[1]=-u*h+n*_,c[4]=-u*p+n*x,c[7]=-u*g+n*E,this}translate(t,n){const u=this.elements;return u[0]+=t*u[2],u[3]+=t*u[5],u[6]+=t*u[8],u[1]+=n*u[2],u[4]+=n*u[5],u[7]+=n*u[8],this}equals(t){const n=this.elements,u=t.elements;for(let c=0;c<9;c++)if(n[c]!==u[c])return!1;return!0}fromArray(t,n=0){for(let u=0;u<9;u++)this.elements[u]=t[u+n];return this}toArray(t=[],n=0){const u=this.elements;return t[n]=u[0],t[n+1]=u[1],t[n+2]=u[2],t[n+3]=u[3],t[n+4]=u[4],t[n+5]=u[5],t[n+6]=u[6],t[n+7]=u[7],t[n+8]=u[8],t}}let Ba;const Na={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let t;if(i instanceof HTMLCanvasElement)t=i;else{Ba===void 0&&(Ba=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ba.width=i.width,Ba.height=i.height;const n=Ba.getContext("2d");i instanceof ImageData?n.putImageData(i,0,0):n.drawImage(i,0,0,i.width,i.height),t=Ba}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let xh=0;function gi(i=gi.DEFAULT_IMAGE,t=gi.DEFAULT_MAPPING,n=Ai,u=Ai,c=qi,h=Pr,p=fi,g=ln,_=1,x=ls){Object.defineProperty(this,"id",{value:xh++}),this.uuid=At.generateUUID(),this.name="",this.image=i,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=u,this.magFilter=c,this.minFilter=h,this.anisotropy=_,this.format=p,this.internalFormat=null,this.type=g,this.offset=new be(0,0),this.repeat=new be(1,1),this.center=new be(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ji,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=x,this.version=0,this.onUpdate=null}gi.DEFAULT_IMAGE=void 0,gi.DEFAULT_MAPPING=Ru,gi.prototype=J(Object.create($n.prototype),{constructor:gi,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.name=i.name,this.image=i.image,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this},toJSON:function(i){const t=i===void 0||typeof i=="string";if(!t&&i.textures[this.uuid]!==void 0)return i.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const u=this.image;if(u.uuid===void 0&&(u.uuid=At.generateUUID()),!t&&i.images[u.uuid]===void 0){let c;if(Array.isArray(u)){c=[];for(let h=0,p=u.length;h<p;h++)u[h].isDataTexture?c.push(_l(u[h].image)):c.push(_l(u[h]))}else c=_l(u);i.images[u.uuid]={uuid:u.uuid,url:c}}n.image=u.uuid}return t||(i.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(i){if(this.mapping!==Ru)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case fl:i.x=i.x-Math.floor(i.x);break;case Ai:i.x=i.x<0?0:1;break;case Os:Math.abs(Math.floor(i.x)%2)===1?i.x=Math.ceil(i.x)-i.x:i.x=i.x-Math.floor(i.x);break}if(i.y<0||i.y>1)switch(this.wrapT){case fl:i.y=i.y-Math.floor(i.y);break;case Ai:i.y=i.y<0?0:1;break;case Os:Math.abs(Math.floor(i.y)%2)===1?i.y=Math.ceil(i.y)-i.y:i.y=i.y-Math.floor(i.y);break}return this.flipY&&(i.y=1-i.y),i}}),Object.defineProperty(gi.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});function _l(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?Na.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class pi{constructor(t=0,n=0,u=0,c=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=n,this.z=u,this.w=c}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,n,u,c){return this.x=t,this.y=n,this.z=u,this.w=c,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,n){return n!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this.w=t.w+n.w,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this.w+=t.w*n,this}sub(t,n){return n!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this.w=t.w-n.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const n=this.x,u=this.y,c=this.z,h=this.w,p=t.elements;return this.x=p[0]*n+p[4]*u+p[8]*c+p[12]*h,this.y=p[1]*n+p[5]*u+p[9]*c+p[13]*h,this.z=p[2]*n+p[6]*u+p[10]*c+p[14]*h,this.w=p[3]*n+p[7]*u+p[11]*c+p[15]*h,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const n=Math.sqrt(1-t.w*t.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/n,this.y=t.y/n,this.z=t.z/n),this}setAxisAngleFromRotationMatrix(t){let n,u,c,h;const _=t.elements,x=_[0],E=_[4],S=_[8],C=_[1],I=_[5],F=_[9],z=_[2],G=_[6],k=_[10];if(Math.abs(E-C)<.01&&Math.abs(S-z)<.01&&Math.abs(F-G)<.01){if(Math.abs(E+C)<.1&&Math.abs(S+z)<.1&&Math.abs(F+G)<.1&&Math.abs(x+I+k-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const se=(x+1)/2,oe=(I+1)/2,re=(k+1)/2,X=(E+C)/4,me=(S+z)/4,ke=(F+G)/4;return se>oe&&se>re?se<.01?(u=0,c=.707106781,h=.707106781):(u=Math.sqrt(se),c=X/u,h=me/u):oe>re?oe<.01?(u=.707106781,c=0,h=.707106781):(c=Math.sqrt(oe),u=X/c,h=ke/c):re<.01?(u=.707106781,c=.707106781,h=0):(h=Math.sqrt(re),u=me/h,c=ke/h),this.set(u,c,h,n),this}let O=Math.sqrt((G-F)*(G-F)+(S-z)*(S-z)+(C-E)*(C-E));return Math.abs(O)<.001&&(O=1),this.x=(G-F)/O,this.y=(S-z)/O,this.z=(C-E)/O,this.w=Math.acos((x+I+k-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this.w=Math.max(t.w,Math.min(n.w,this.w)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this.w=Math.max(t,Math.min(n,this.w)),this}clampLength(t,n){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(t,Math.min(n,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this.w+=(t.w-this.w)*n,this}lerpVectors(t,n,u){return this.x=t.x+(n.x-t.x)*u,this.y=t.y+(n.y-t.y)*u,this.z=t.z+(n.z-t.z)*u,this.w=t.w+(n.w-t.w)*u,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this.w=t[n+3],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t[n+3]=this.w,t}fromBufferAttribute(t,n,u){return u!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this.w=t.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}class us extends $n{constructor(t,n,u){super(),Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=t,this.height=n,this.scissor=new pi(0,0,t,n),this.scissorTest=!1,this.viewport=new pi(0,0,t,n),u=u||{},this.texture=new gi(void 0,u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=n,this.texture.generateMipmaps=u.generateMipmaps!==void 0?u.generateMipmaps:!1,this.texture.minFilter=u.minFilter!==void 0?u.minFilter:qi,this.depthBuffer=u.depthBuffer!==void 0?u.depthBuffer:!0,this.stencilBuffer=u.stencilBuffer!==void 0?u.stencilBuffer:!1,this.depthTexture=u.depthTexture!==void 0?u.depthTexture:null}setSize(t,n){(this.width!==t||this.height!==n)&&(this.width=t,this.height=n,this.texture.image.width=t,this.texture.image.height=n,this.dispose()),this.viewport.set(0,0,t,n),this.scissor.set(0,0,t,n)}clone(){return new this.constructor().copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Fi{constructor(t=0,n=0,u=0,c=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=n,this._z=u,this._w=c}static slerp(t,n,u,c){return u.copy(t).slerp(n,c)}static slerpFlat(t,n,u,c,h,p,g){let _=u[c+0],x=u[c+1],E=u[c+2],S=u[c+3];const C=h[p+0],I=h[p+1],F=h[p+2],z=h[p+3];if(S!==z||_!==C||x!==I||E!==F){let G=1-g;const k=_*C+x*I+E*F+S*z,O=k>=0?1:-1,se=1-k*k;if(se>Number.EPSILON){const re=Math.sqrt(se),X=Math.atan2(re,k*O);G=Math.sin(G*X)/re,g=Math.sin(g*X)/re}const oe=g*O;if(_=_*G+C*oe,x=x*G+I*oe,E=E*G+F*oe,S=S*G+z*oe,G===1-g){const re=1/Math.sqrt(_*_+x*x+E*E+S*S);_*=re,x*=re,E*=re,S*=re}}t[n]=_,t[n+1]=x,t[n+2]=E,t[n+3]=S}static multiplyQuaternionsFlat(t,n,u,c,h,p){const g=u[c],_=u[c+1],x=u[c+2],E=u[c+3],S=h[p],C=h[p+1],I=h[p+2],F=h[p+3];return t[n]=g*F+E*S+_*I-x*C,t[n+1]=_*F+E*C+x*S-g*I,t[n+2]=x*F+E*I+g*C-_*S,t[n+3]=E*F-g*S-_*C-x*I,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,n,u,c){return this._x=t,this._y=n,this._z=u,this._w=c,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,n){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const u=t._x,c=t._y,h=t._z,p=t._order,g=Math.cos,_=Math.sin,x=g(u/2),E=g(c/2),S=g(h/2),C=_(u/2),I=_(c/2),F=_(h/2);switch(p){case"XYZ":this._x=C*E*S+x*I*F,this._y=x*I*S-C*E*F,this._z=x*E*F+C*I*S,this._w=x*E*S-C*I*F;break;case"YXZ":this._x=C*E*S+x*I*F,this._y=x*I*S-C*E*F,this._z=x*E*F-C*I*S,this._w=x*E*S+C*I*F;break;case"ZXY":this._x=C*E*S-x*I*F,this._y=x*I*S+C*E*F,this._z=x*E*F+C*I*S,this._w=x*E*S-C*I*F;break;case"ZYX":this._x=C*E*S-x*I*F,this._y=x*I*S+C*E*F,this._z=x*E*F-C*I*S,this._w=x*E*S+C*I*F;break;case"YZX":this._x=C*E*S+x*I*F,this._y=x*I*S+C*E*F,this._z=x*E*F-C*I*S,this._w=x*E*S-C*I*F;break;case"XZY":this._x=C*E*S-x*I*F,this._y=x*I*S-C*E*F,this._z=x*E*F+C*I*S,this._w=x*E*S+C*I*F;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+p)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,n){const u=n/2,c=Math.sin(u);return this._x=t.x*c,this._y=t.y*c,this._z=t.z*c,this._w=Math.cos(u),this._onChangeCallback(),this}setFromRotationMatrix(t){const n=t.elements,u=n[0],c=n[4],h=n[8],p=n[1],g=n[5],_=n[9],x=n[2],E=n[6],S=n[10],C=u+g+S;if(C>0){const I=.5/Math.sqrt(C+1);this._w=.25/I,this._x=(E-_)*I,this._y=(h-x)*I,this._z=(p-c)*I}else if(u>g&&u>S){const I=2*Math.sqrt(1+u-g-S);this._w=(E-_)/I,this._x=.25*I,this._y=(c+p)/I,this._z=(h+x)/I}else if(g>S){const I=2*Math.sqrt(1+g-u-S);this._w=(h-x)/I,this._x=(c+p)/I,this._y=.25*I,this._z=(_+E)/I}else{const I=2*Math.sqrt(1+S-u-g);this._w=(p-c)/I,this._x=(h+x)/I,this._y=(_+E)/I,this._z=.25*I}return this._onChangeCallback(),this}setFromUnitVectors(t,n){let c=t.dot(n)+1;return c<1e-6?(c=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=c):(this._x=0,this._y=-t.z,this._z=t.y,this._w=c)):(this._x=t.y*n.z-t.z*n.y,this._y=t.z*n.x-t.x*n.z,this._z=t.x*n.y-t.y*n.x,this._w=c),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(At.clamp(this.dot(t),-1,1)))}rotateTowards(t,n){const u=this.angleTo(t);if(u===0)return this;const c=Math.min(1,n/u);return this.slerp(t,c),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,n){return n!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,n)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,n){const u=t._x,c=t._y,h=t._z,p=t._w,g=n._x,_=n._y,x=n._z,E=n._w;return this._x=u*E+p*g+c*x-h*_,this._y=c*E+p*_+h*g-u*x,this._z=h*E+p*x+u*_-c*g,this._w=p*E-u*g-c*_-h*x,this._onChangeCallback(),this}slerp(t,n){if(n===0)return this;if(n===1)return this.copy(t);const u=this._x,c=this._y,h=this._z,p=this._w;let g=p*t._w+u*t._x+c*t._y+h*t._z;if(g<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,g=-g):this.copy(t),g>=1)return this._w=p,this._x=u,this._y=c,this._z=h,this;const _=1-g*g;if(_<=Number.EPSILON){const I=1-n;return this._w=I*p+n*this._w,this._x=I*u+n*this._x,this._y=I*c+n*this._y,this._z=I*h+n*this._z,this.normalize(),this._onChangeCallback(),this}const x=Math.sqrt(_),E=Math.atan2(x,g),S=Math.sin((1-n)*E)/x,C=Math.sin(n*E)/x;return this._w=p*S+this._w*C,this._x=u*S+this._x*C,this._y=c*S+this._y*C,this._z=h*S+this._z*C,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,n=0){return this._x=t[n],this._y=t[n+1],this._z=t[n+2],this._w=t[n+3],this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._w,t}fromBufferAttribute(t,n){return this._x=t.getX(n),this._y=t.getY(n),this._z=t.getZ(n),this._w=t.getW(n),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class te{constructor(t=0,n=0,u=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=n,this.z=u}set(t,n,u){return u===void 0&&(u=this.z),this.x=t,this.y=n,this.z=u,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,n){return n!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this}sub(t,n){return n!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}multiply(t,n){return n!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,n)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,n){return this.x=t.x*n.x,this.y=t.y*n.y,this.z=t.z*n.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(bl.setFromEuler(t))}applyAxisAngle(t,n){return this.applyQuaternion(bl.setFromAxisAngle(t,n))}applyMatrix3(t){const n=this.x,u=this.y,c=this.z,h=t.elements;return this.x=h[0]*n+h[3]*u+h[6]*c,this.y=h[1]*n+h[4]*u+h[7]*c,this.z=h[2]*n+h[5]*u+h[8]*c,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const n=this.x,u=this.y,c=this.z,h=t.elements,p=1/(h[3]*n+h[7]*u+h[11]*c+h[15]);return this.x=(h[0]*n+h[4]*u+h[8]*c+h[12])*p,this.y=(h[1]*n+h[5]*u+h[9]*c+h[13])*p,this.z=(h[2]*n+h[6]*u+h[10]*c+h[14])*p,this}applyQuaternion(t){const n=this.x,u=this.y,c=this.z,h=t.x,p=t.y,g=t.z,_=t.w,x=_*n+p*c-g*u,E=_*u+g*n-h*c,S=_*c+h*u-p*n,C=-h*n-p*u-g*c;return this.x=x*_+C*-h+E*-g-S*-p,this.y=E*_+C*-p+S*-h-x*-g,this.z=S*_+C*-g+x*-p-E*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const n=this.x,u=this.y,c=this.z,h=t.elements;return this.x=h[0]*n+h[4]*u+h[8]*c,this.y=h[1]*n+h[5]*u+h[9]*c,this.z=h[2]*n+h[6]*u+h[10]*c,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this}clampLength(t,n){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(t,Math.min(n,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this}lerpVectors(t,n,u){return this.x=t.x+(n.x-t.x)*u,this.y=t.y+(n.y-t.y)*u,this.z=t.z+(n.z-t.z)*u,this}cross(t,n){return n!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,n)):this.crossVectors(this,t)}crossVectors(t,n){const u=t.x,c=t.y,h=t.z,p=n.x,g=n.y,_=n.z;return this.x=c*_-h*g,this.y=h*p-u*_,this.z=u*g-c*p,this}projectOnVector(t){const n=t.lengthSq();if(n===0)return this.set(0,0,0);const u=t.dot(this)/n;return this.copy(t).multiplyScalar(u)}projectOnPlane(t){return xl.copy(this).projectOnVector(t),this.sub(xl)}reflect(t){return this.sub(xl.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const u=this.dot(t)/n;return Math.acos(At.clamp(u,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,u=this.y-t.y,c=this.z-t.z;return n*n+u*u+c*c}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,n,u){const c=Math.sin(n)*t;return this.x=c*Math.sin(u),this.y=Math.cos(n)*t,this.z=c*Math.cos(u),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,n,u){return this.x=t*Math.sin(n),this.y=u,this.z=t*Math.cos(n),this}setFromMatrixPosition(t){const n=t.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(t){const n=this.setFromMatrixColumn(t,0).length(),u=this.setFromMatrixColumn(t,1).length(),c=this.setFromMatrixColumn(t,2).length();return this.x=n,this.y=u,this.z=c,this}setFromMatrixColumn(t,n){return this.fromArray(t.elements,n*4)}setFromMatrix3Column(t,n){return this.fromArray(t.elements,n*3)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t}fromBufferAttribute(t,n,u){return u!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const xl=new te,bl=new Fi;class Dr{constructor(t,n){Object.defineProperty(this,"isBox3",{value:!0}),this.min=t!==void 0?t:new te(1/0,1/0,1/0),this.max=n!==void 0?n:new te(-1/0,-1/0,-1/0)}set(t,n){return this.min.copy(t),this.max.copy(n),this}setFromArray(t){let n=1/0,u=1/0,c=1/0,h=-1/0,p=-1/0,g=-1/0;for(let _=0,x=t.length;_<x;_+=3){const E=t[_],S=t[_+1],C=t[_+2];E<n&&(n=E),S<u&&(u=S),C<c&&(c=C),E>h&&(h=E),S>p&&(p=S),C>g&&(g=C)}return this.min.set(n,u,c),this.max.set(h,p,g),this}setFromBufferAttribute(t){let n=1/0,u=1/0,c=1/0,h=-1/0,p=-1/0,g=-1/0;for(let _=0,x=t.count;_<x;_++){const E=t.getX(_),S=t.getY(_),C=t.getZ(_);E<n&&(n=E),S<u&&(u=S),C<c&&(c=C),E>h&&(h=E),S>p&&(p=S),C>g&&(g=C)}return this.min.set(n,u,c),this.max.set(h,p,g),this}setFromPoints(t){this.makeEmpty();for(let n=0,u=t.length;n<u;n++)this.expandByPoint(t[n]);return this}setFromCenterAndSize(t,n){const u=Ua.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(u),this.max.copy(t).add(u),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new te),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new te),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const n=t.geometry;n!==void 0&&(n.boundingBox===null&&n.computeBoundingBox(),cs.copy(n.boundingBox),cs.applyMatrix4(t.matrixWorld),this.union(cs));const u=t.children;for(let c=0,h=u.length;c<h;c++)this.expandByObject(u[c]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,n){return n===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),n=new te),n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ua),Ua.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let n,u;return t.normal.x>0?(n=t.normal.x*this.min.x,u=t.normal.x*this.max.x):(n=t.normal.x*this.max.x,u=t.normal.x*this.min.x),t.normal.y>0?(n+=t.normal.y*this.min.y,u+=t.normal.y*this.max.y):(n+=t.normal.y*this.max.y,u+=t.normal.y*this.min.y),t.normal.z>0?(n+=t.normal.z*this.min.z,u+=t.normal.z*this.max.z):(n+=t.normal.z*this.max.z,u+=t.normal.z*this.min.z),n<=-t.constant&&u>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ds),Ks.subVectors(this.max,ds),na.subVectors(t.a,ds),ra.subVectors(t.b,ds),fr.subVectors(t.c,ds),Nn.subVectors(ra,na),Rr.subVectors(fr,ra),aa.subVectors(na,fr);let n=[0,-Nn.z,Nn.y,0,-Rr.z,Rr.y,0,-aa.z,aa.y,Nn.z,0,-Nn.x,Rr.z,0,-Rr.x,aa.z,0,-aa.x,-Nn.y,Nn.x,0,-Rr.y,Rr.x,0,-aa.y,aa.x,0];return!Ys(n,na,ra,fr,Ks)||(n=[1,0,0,0,1,0,0,0,1],!Ys(n,na,ra,fr,Ks))?!1:(Zs.crossVectors(Nn,Rr),n=[Zs.x,Zs.y,Zs.z],Ys(n,na,ra,fr,Ks))}clampPoint(t,n){return n===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),n=new te),n.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ua.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=this.getSize(Ua).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Jn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Jn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Jn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Jn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Jn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Jn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Jn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Jn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Jn),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function Ys(i,t,n,u,c){for(let h=0,p=i.length-3;h<=p;h+=3){pr.fromArray(i,h);const g=c.x*Math.abs(pr.x)+c.y*Math.abs(pr.y)+c.z*Math.abs(pr.z),_=t.dot(pr),x=n.dot(pr),E=u.dot(pr);if(Math.max(-Math.max(_,x,E),Math.min(_,x,E))>g)return!1}return!0}const Jn=[new te,new te,new te,new te,new te,new te,new te,new te],Ua=new te,cs=new Dr,na=new te,ra=new te,fr=new te,Nn=new te,Rr=new te,aa=new te,ds=new te,Ks=new te,Zs=new te,pr=new te,bh=new Dr;class sa{constructor(t,n){this.center=t!==void 0?t:new te,this.radius=n!==void 0?n:-1}set(t,n){return this.center.copy(t),this.radius=n,this}setFromPoints(t,n){const u=this.center;n!==void 0?u.copy(n):bh.setFromPoints(t).getCenter(u);let c=0;for(let h=0,p=t.length;h<p;h++)c=Math.max(c,u.distanceToSquared(t[h]));return this.radius=Math.sqrt(c),this}clone(){return new this.constructor().copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const n=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=n*n}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,n){const u=this.center.distanceToSquared(t);return n===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),n=new te),n.copy(t),u>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Dr),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const dn=new te,si=new te,er=new te,Li=new te,Pn=new te,$s=new te,Js=new te;class hs{constructor(t,n){this.origin=t!==void 0?t:new te,this.direction=n!==void 0?n:new te(0,0,-1)}set(t,n){return this.origin.copy(t),this.direction.copy(n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,n){return n===void 0&&(console.warn("THREE.Ray: .at() target is now required"),n=new te),n.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,dn)),this}closestPointToPoint(t,n){n===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),n=new te),n.subVectors(t,this.origin);const u=n.dot(this.direction);return u<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(u).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const n=dn.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(dn.copy(this.direction).multiplyScalar(n).add(this.origin),dn.distanceToSquared(t))}distanceSqToSegment(t,n,u,c){si.copy(t).add(n).multiplyScalar(.5),er.copy(n).sub(t).normalize(),Li.copy(this.origin).sub(si);const h=t.distanceTo(n)*.5,p=-this.direction.dot(er),g=Li.dot(this.direction),_=-Li.dot(er),x=Li.lengthSq(),E=Math.abs(1-p*p);let S,C,I,F;if(E>0)if(S=p*_-g,C=p*g-_,F=h*E,S>=0)if(C>=-F)if(C<=F){const z=1/E;S*=z,C*=z,I=S*(S+p*C+2*g)+C*(p*S+C+2*_)+x}else C=h,S=Math.max(0,-(p*C+g)),I=-S*S+C*(C+2*_)+x;else C=-h,S=Math.max(0,-(p*C+g)),I=-S*S+C*(C+2*_)+x;else C<=-F?(S=Math.max(0,-(-p*h+g)),C=S>0?-h:Math.min(Math.max(-h,-_),h),I=-S*S+C*(C+2*_)+x):C<=F?(S=0,C=Math.min(Math.max(-h,-_),h),I=C*(C+2*_)+x):(S=Math.max(0,-(p*h+g)),C=S>0?h:Math.min(Math.max(-h,-_),h),I=-S*S+C*(C+2*_)+x);else C=p>0?-h:h,S=Math.max(0,-(p*C+g)),I=-S*S+C*(C+2*_)+x;return u&&u.copy(this.direction).multiplyScalar(S).add(this.origin),c&&c.copy(er).multiplyScalar(C).add(si),I}intersectSphere(t,n){dn.subVectors(t.center,this.origin);const u=dn.dot(this.direction),c=dn.dot(dn)-u*u,h=t.radius*t.radius;if(c>h)return null;const p=Math.sqrt(h-c),g=u-p,_=u+p;return g<0&&_<0?null:g<0?this.at(_,n):this.at(g,n)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const n=t.normal.dot(this.direction);if(n===0)return t.distanceToPoint(this.origin)===0?0:null;const u=-(this.origin.dot(t.normal)+t.constant)/n;return u>=0?u:null}intersectPlane(t,n){const u=this.distanceToPlane(t);return u===null?null:this.at(u,n)}intersectsPlane(t){const n=t.distanceToPoint(this.origin);return n===0||t.normal.dot(this.direction)*n<0}intersectBox(t,n){let u,c,h,p,g,_;const x=1/this.direction.x,E=1/this.direction.y,S=1/this.direction.z,C=this.origin;return x>=0?(u=(t.min.x-C.x)*x,c=(t.max.x-C.x)*x):(u=(t.max.x-C.x)*x,c=(t.min.x-C.x)*x),E>=0?(h=(t.min.y-C.y)*E,p=(t.max.y-C.y)*E):(h=(t.max.y-C.y)*E,p=(t.min.y-C.y)*E),u>p||h>c||((h>u||u!==u)&&(u=h),(p<c||c!==c)&&(c=p),S>=0?(g=(t.min.z-C.z)*S,_=(t.max.z-C.z)*S):(g=(t.max.z-C.z)*S,_=(t.min.z-C.z)*S),u>_||g>c)||((g>u||u!==u)&&(u=g),(_<c||c!==c)&&(c=_),c<0)?null:this.at(u>=0?u:c,n)}intersectsBox(t){return this.intersectBox(t,dn)!==null}intersectTriangle(t,n,u,c,h){Pn.subVectors(n,t),$s.subVectors(u,t),Js.crossVectors(Pn,$s);let p=this.direction.dot(Js),g;if(p>0){if(c)return null;g=1}else if(p<0)g=-1,p=-p;else return null;Li.subVectors(this.origin,t);const _=g*this.direction.dot($s.crossVectors(Li,$s));if(_<0)return null;const x=g*this.direction.dot(Pn.cross(Li));if(x<0||_+x>p)return null;const E=-g*Li.dot(Js);return E<0?null:this.at(E/p,h)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Ut{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,n,u,c,h,p,g,_,x,E,S,C,I,F,z,G){const k=this.elements;return k[0]=t,k[4]=n,k[8]=u,k[12]=c,k[1]=h,k[5]=p,k[9]=g,k[13]=_,k[2]=x,k[6]=E,k[10]=S,k[14]=C,k[3]=I,k[7]=F,k[11]=z,k[15]=G,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ut().fromArray(this.elements)}copy(t){const n=this.elements,u=t.elements;return n[0]=u[0],n[1]=u[1],n[2]=u[2],n[3]=u[3],n[4]=u[4],n[5]=u[5],n[6]=u[6],n[7]=u[7],n[8]=u[8],n[9]=u[9],n[10]=u[10],n[11]=u[11],n[12]=u[12],n[13]=u[13],n[14]=u[14],n[15]=u[15],this}copyPosition(t){const n=this.elements,u=t.elements;return n[12]=u[12],n[13]=u[13],n[14]=u[14],this}setFromMatrix3(t){const n=t.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(t,n,u){return t.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),u.setFromMatrixColumn(this,2),this}makeBasis(t,n,u){return this.set(t.x,n.x,u.x,0,t.y,n.y,u.y,0,t.z,n.z,u.z,0,0,0,0,1),this}extractRotation(t){const n=this.elements,u=t.elements,c=1/Ha.setFromMatrixColumn(t,0).length(),h=1/Ha.setFromMatrixColumn(t,1).length(),p=1/Ha.setFromMatrixColumn(t,2).length();return n[0]=u[0]*c,n[1]=u[1]*c,n[2]=u[2]*c,n[3]=0,n[4]=u[4]*h,n[5]=u[5]*h,n[6]=u[6]*h,n[7]=0,n[8]=u[8]*p,n[9]=u[9]*p,n[10]=u[10]*p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const n=this.elements,u=t.x,c=t.y,h=t.z,p=Math.cos(u),g=Math.sin(u),_=Math.cos(c),x=Math.sin(c),E=Math.cos(h),S=Math.sin(h);if(t.order==="XYZ"){const C=p*E,I=p*S,F=g*E,z=g*S;n[0]=_*E,n[4]=-_*S,n[8]=x,n[1]=I+F*x,n[5]=C-z*x,n[9]=-g*_,n[2]=z-C*x,n[6]=F+I*x,n[10]=p*_}else if(t.order==="YXZ"){const C=_*E,I=_*S,F=x*E,z=x*S;n[0]=C+z*g,n[4]=F*g-I,n[8]=p*x,n[1]=p*S,n[5]=p*E,n[9]=-g,n[2]=I*g-F,n[6]=z+C*g,n[10]=p*_}else if(t.order==="ZXY"){const C=_*E,I=_*S,F=x*E,z=x*S;n[0]=C-z*g,n[4]=-p*S,n[8]=F+I*g,n[1]=I+F*g,n[5]=p*E,n[9]=z-C*g,n[2]=-p*x,n[6]=g,n[10]=p*_}else if(t.order==="ZYX"){const C=p*E,I=p*S,F=g*E,z=g*S;n[0]=_*E,n[4]=F*x-I,n[8]=C*x+z,n[1]=_*S,n[5]=z*x+C,n[9]=I*x-F,n[2]=-x,n[6]=g*_,n[10]=p*_}else if(t.order==="YZX"){const C=p*_,I=p*x,F=g*_,z=g*x;n[0]=_*E,n[4]=z-C*S,n[8]=F*S+I,n[1]=S,n[5]=p*E,n[9]=-g*E,n[2]=-x*E,n[6]=I*S+F,n[10]=C-z*S}else if(t.order==="XZY"){const C=p*_,I=p*x,F=g*_,z=g*x;n[0]=_*E,n[4]=-S,n[8]=x*E,n[1]=C*S+z,n[5]=p*E,n[9]=I*S-F,n[2]=F*S-I,n[6]=g*E,n[10]=z*S+C}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Th,t,Ah)}lookAt(t,n,u){const c=this.elements;return H.subVectors(t,n),H.lengthSq()===0&&(H.z=1),H.normalize(),Or.crossVectors(u,H),Or.lengthSq()===0&&(Math.abs(u.z)===1?H.x+=1e-4:H.z+=1e-4,H.normalize(),Or.crossVectors(u,H)),Or.normalize(),fs.crossVectors(H,Or),c[0]=Or.x,c[4]=fs.x,c[8]=H.x,c[1]=Or.y,c[5]=fs.y,c[9]=H.y,c[2]=Or.z,c[6]=fs.z,c[10]=H.z,this}multiply(t,n){return n!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,n)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const u=t.elements,c=n.elements,h=this.elements,p=u[0],g=u[4],_=u[8],x=u[12],E=u[1],S=u[5],C=u[9],I=u[13],F=u[2],z=u[6],G=u[10],k=u[14],O=u[3],se=u[7],oe=u[11],re=u[15],X=c[0],me=c[4],ke=c[8],xe=c[12],Se=c[1],we=c[5],Re=c[9],he=c[13],ce=c[2],pe=c[6],Te=c[10],He=c[14],Xe=c[3],Qe=c[7],lt=c[11],rt=c[15];return h[0]=p*X+g*Se+_*ce+x*Xe,h[4]=p*me+g*we+_*pe+x*Qe,h[8]=p*ke+g*Re+_*Te+x*lt,h[12]=p*xe+g*he+_*He+x*rt,h[1]=E*X+S*Se+C*ce+I*Xe,h[5]=E*me+S*we+C*pe+I*Qe,h[9]=E*ke+S*Re+C*Te+I*lt,h[13]=E*xe+S*he+C*He+I*rt,h[2]=F*X+z*Se+G*ce+k*Xe,h[6]=F*me+z*we+G*pe+k*Qe,h[10]=F*ke+z*Re+G*Te+k*lt,h[14]=F*xe+z*he+G*He+k*rt,h[3]=O*X+se*Se+oe*ce+re*Xe,h[7]=O*me+se*we+oe*pe+re*Qe,h[11]=O*ke+se*Re+oe*Te+re*lt,h[15]=O*xe+se*he+oe*He+re*rt,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[4]*=t,n[8]*=t,n[12]*=t,n[1]*=t,n[5]*=t,n[9]*=t,n[13]*=t,n[2]*=t,n[6]*=t,n[10]*=t,n[14]*=t,n[3]*=t,n[7]*=t,n[11]*=t,n[15]*=t,this}determinant(){const t=this.elements,n=t[0],u=t[4],c=t[8],h=t[12],p=t[1],g=t[5],_=t[9],x=t[13],E=t[2],S=t[6],C=t[10],I=t[14],F=t[3],z=t[7],G=t[11],k=t[15];return F*(+h*_*S-c*x*S-h*g*C+u*x*C+c*g*I-u*_*I)+z*(+n*_*I-n*x*C+h*p*C-c*p*I+c*x*E-h*_*E)+G*(+n*x*S-n*g*I-h*p*S+u*p*I+h*g*E-u*x*E)+k*(-c*g*E-n*_*S+n*g*C+c*p*S-u*p*C+u*_*E)}transpose(){const t=this.elements;let n;return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,this}setPosition(t,n,u){const c=this.elements;return t.isVector3?(c[12]=t.x,c[13]=t.y,c[14]=t.z):(c[12]=t,c[13]=n,c[14]=u),this}invert(){const t=this.elements,n=t[0],u=t[1],c=t[2],h=t[3],p=t[4],g=t[5],_=t[6],x=t[7],E=t[8],S=t[9],C=t[10],I=t[11],F=t[12],z=t[13],G=t[14],k=t[15],O=S*G*x-z*C*x+z*_*I-g*G*I-S*_*k+g*C*k,se=F*C*x-E*G*x-F*_*I+p*G*I+E*_*k-p*C*k,oe=E*z*x-F*S*x+F*g*I-p*z*I-E*g*k+p*S*k,re=F*S*_-E*z*_-F*g*C+p*z*C+E*g*G-p*S*G,X=n*O+u*se+c*oe+h*re;if(X===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const me=1/X;return t[0]=O*me,t[1]=(z*C*h-S*G*h-z*c*I+u*G*I+S*c*k-u*C*k)*me,t[2]=(g*G*h-z*_*h+z*c*x-u*G*x-g*c*k+u*_*k)*me,t[3]=(S*_*h-g*C*h-S*c*x+u*C*x+g*c*I-u*_*I)*me,t[4]=se*me,t[5]=(E*G*h-F*C*h+F*c*I-n*G*I-E*c*k+n*C*k)*me,t[6]=(F*_*h-p*G*h-F*c*x+n*G*x+p*c*k-n*_*k)*me,t[7]=(p*C*h-E*_*h+E*c*x-n*C*x-p*c*I+n*_*I)*me,t[8]=oe*me,t[9]=(F*S*h-E*z*h-F*u*I+n*z*I+E*u*k-n*S*k)*me,t[10]=(p*z*h-F*g*h+F*u*x-n*z*x-p*u*k+n*g*k)*me,t[11]=(E*g*h-p*S*h-E*u*x+n*S*x+p*u*I-n*g*I)*me,t[12]=re*me,t[13]=(E*z*c-F*S*c+F*u*C-n*z*C-E*u*G+n*S*G)*me,t[14]=(F*g*c-p*z*c-F*u*_+n*z*_+p*u*G-n*g*G)*me,t[15]=(p*S*c-E*g*c+E*u*_-n*S*_-p*u*C+n*g*C)*me,this}scale(t){const n=this.elements,u=t.x,c=t.y,h=t.z;return n[0]*=u,n[4]*=c,n[8]*=h,n[1]*=u,n[5]*=c,n[9]*=h,n[2]*=u,n[6]*=c,n[10]*=h,n[3]*=u,n[7]*=c,n[11]*=h,this}getMaxScaleOnAxis(){const t=this.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],u=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],c=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(n,u,c))}makeTranslation(t,n,u){return this.set(1,0,0,t,0,1,0,n,0,0,1,u,0,0,0,1),this}makeRotationX(t){const n=Math.cos(t),u=Math.sin(t);return this.set(1,0,0,0,0,n,-u,0,0,u,n,0,0,0,0,1),this}makeRotationY(t){const n=Math.cos(t),u=Math.sin(t);return this.set(n,0,u,0,0,1,0,0,-u,0,n,0,0,0,0,1),this}makeRotationZ(t){const n=Math.cos(t),u=Math.sin(t);return this.set(n,-u,0,0,u,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,n){const u=Math.cos(n),c=Math.sin(n),h=1-u,p=t.x,g=t.y,_=t.z,x=h*p,E=h*g;return this.set(x*p+u,x*g-c*_,x*_+c*g,0,x*g+c*_,E*g+u,E*_-c*p,0,x*_-c*g,E*_+c*p,h*_*_+u,0,0,0,0,1),this}makeScale(t,n,u){return this.set(t,0,0,0,0,n,0,0,0,0,u,0,0,0,0,1),this}makeShear(t,n,u){return this.set(1,n,u,0,t,1,u,0,t,n,1,0,0,0,0,1),this}compose(t,n,u){const c=this.elements,h=n._x,p=n._y,g=n._z,_=n._w,x=h+h,E=p+p,S=g+g,C=h*x,I=h*E,F=h*S,z=p*E,G=p*S,k=g*S,O=_*x,se=_*E,oe=_*S,re=u.x,X=u.y,me=u.z;return c[0]=(1-(z+k))*re,c[1]=(I+oe)*re,c[2]=(F-se)*re,c[3]=0,c[4]=(I-oe)*X,c[5]=(1-(C+k))*X,c[6]=(G+O)*X,c[7]=0,c[8]=(F+se)*me,c[9]=(G-O)*me,c[10]=(1-(C+z))*me,c[11]=0,c[12]=t.x,c[13]=t.y,c[14]=t.z,c[15]=1,this}decompose(t,n,u){const c=this.elements;let h=Ha.set(c[0],c[1],c[2]).length();const p=Ha.set(c[4],c[5],c[6]).length(),g=Ha.set(c[8],c[9],c[10]).length();this.determinant()<0&&(h=-h),t.x=c[12],t.y=c[13],t.z=c[14],Un.copy(this);const x=1/h,E=1/p,S=1/g;return Un.elements[0]*=x,Un.elements[1]*=x,Un.elements[2]*=x,Un.elements[4]*=E,Un.elements[5]*=E,Un.elements[6]*=E,Un.elements[8]*=S,Un.elements[9]*=S,Un.elements[10]*=S,n.setFromRotationMatrix(Un),u.x=h,u.y=p,u.z=g,this}makePerspective(t,n,u,c,h,p){p===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const g=this.elements,_=2*h/(n-t),x=2*h/(u-c),E=(n+t)/(n-t),S=(u+c)/(u-c),C=-(p+h)/(p-h),I=-2*p*h/(p-h);return g[0]=_,g[4]=0,g[8]=E,g[12]=0,g[1]=0,g[5]=x,g[9]=S,g[13]=0,g[2]=0,g[6]=0,g[10]=C,g[14]=I,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(t,n,u,c,h,p){const g=this.elements,_=1/(n-t),x=1/(u-c),E=1/(p-h),S=(n+t)*_,C=(u+c)*x,I=(p+h)*E;return g[0]=2*_,g[4]=0,g[8]=0,g[12]=-S,g[1]=0,g[5]=2*x,g[9]=0,g[13]=-C,g[2]=0,g[6]=0,g[10]=-2*E,g[14]=-I,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(t){const n=this.elements,u=t.elements;for(let c=0;c<16;c++)if(n[c]!==u[c])return!1;return!0}fromArray(t,n=0){for(let u=0;u<16;u++)this.elements[u]=t[u+n];return this}toArray(t=[],n=0){const u=this.elements;return t[n]=u[0],t[n+1]=u[1],t[n+2]=u[2],t[n+3]=u[3],t[n+4]=u[4],t[n+5]=u[5],t[n+6]=u[6],t[n+7]=u[7],t[n+8]=u[8],t[n+9]=u[9],t[n+10]=u[10],t[n+11]=u[11],t[n+12]=u[12],t[n+13]=u[13],t[n+14]=u[14],t[n+15]=u[15],t}}const Ha=new te,Un=new Ut,Th=new te(0,0,0),Ah=new te(1,1,1),Or=new te,fs=new te,H=new te;class y{constructor(t=0,n=0,u=0,c=y.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=n,this._z=u,this._order=c}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,n,u,c){return this._x=t,this._y=n,this._z=u,this._order=c||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,n,u){const c=At.clamp,h=t.elements,p=h[0],g=h[4],_=h[8],x=h[1],E=h[5],S=h[9],C=h[2],I=h[6],F=h[10];switch(n=n||this._order,n){case"XYZ":this._y=Math.asin(c(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-S,F),this._z=Math.atan2(-g,p)):(this._x=Math.atan2(I,E),this._z=0);break;case"YXZ":this._x=Math.asin(-c(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(_,F),this._z=Math.atan2(x,E)):(this._y=Math.atan2(-C,p),this._z=0);break;case"ZXY":this._x=Math.asin(c(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-C,F),this._z=Math.atan2(-g,E)):(this._y=0,this._z=Math.atan2(x,p));break;case"ZYX":this._y=Math.asin(-c(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(I,F),this._z=Math.atan2(x,p)):(this._x=0,this._z=Math.atan2(-g,E));break;case"YZX":this._z=Math.asin(c(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(-S,E),this._y=Math.atan2(-C,p)):(this._x=0,this._y=Math.atan2(_,F));break;case"XZY":this._z=Math.asin(-c(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(I,E),this._y=Math.atan2(_,p)):(this._x=Math.atan2(-S,F),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,u!==!1&&this._onChangeCallback(),this}setFromQuaternion(t,n,u){return T.makeRotationFromQuaternion(t),this.setFromRotationMatrix(T,n,u)}setFromVector3(t,n){return this.set(t.x,t.y,t.z,n||this._order)}reorder(t){return b.setFromEuler(this),this.setFromQuaternion(b,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new te(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}y.DefaultOrder="XYZ",y.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const T=new Ut,b=new Fi;class w{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}}let R=0;const B=new te,j=new Fi,Z=new Ut,ae=new te,ne=new te,de=new te,Pe=new Fi,tt=new te(1,0,0),ft=new te(0,1,0),Ke=new te(0,0,1),Pt={type:"added"},Ui={type:"removed"};function gt(){Object.defineProperty(this,"id",{value:R++}),this.uuid=At.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=gt.DefaultUp.clone();const i=new te,t=new y,n=new Fi,u=new te(1,1,1);function c(){n.setFromEuler(t,!1)}function h(){t.setFromQuaternion(n,void 0,!1)}t._onChange(c),n._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:u},modelViewMatrix:{value:new Ut},normalMatrix:{value:new Ji}}),this.matrix=new Ut,this.matrixWorld=new Ut,this.matrixAutoUpdate=gt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new w,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}gt.DefaultUp=new te(0,1,0),gt.DefaultMatrixAutoUpdate=!0,gt.prototype=J(Object.create($n.prototype),{constructor:gt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,t){this.quaternion.setFromAxisAngle(i,t)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,t){return j.setFromAxisAngle(i,t),this.quaternion.multiply(j),this},rotateOnWorldAxis:function(i,t){return j.setFromAxisAngle(i,t),this.quaternion.premultiply(j),this},rotateX:function(i){return this.rotateOnAxis(tt,i)},rotateY:function(i){return this.rotateOnAxis(ft,i)},rotateZ:function(i){return this.rotateOnAxis(Ke,i)},translateOnAxis:function(i,t){return B.copy(i).applyQuaternion(this.quaternion),this.position.add(B.multiplyScalar(t)),this},translateX:function(i){return this.translateOnAxis(tt,i)},translateY:function(i){return this.translateOnAxis(ft,i)},translateZ:function(i){return this.translateOnAxis(Ke,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Z.copy(this.matrixWorld).invert())},lookAt:function(i,t,n){i.isVector3?ae.copy(i):ae.set(i,t,n);const u=this.parent;this.updateWorldMatrix(!0,!1),ne.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Z.lookAt(ne,ae,this.up):Z.lookAt(ae,ne,this.up),this.quaternion.setFromRotationMatrix(Z),u&&(Z.extractRotation(u.matrixWorld),j.setFromRotationMatrix(Z),this.quaternion.premultiply(j.invert()))},add:function(i){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(Pt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(i);return t!==-1&&(i.parent=null,this.children.splice(t,1),i.dispatchEvent(Ui)),this},clear:function(){for(let i=0;i<this.children.length;i++){const t=this.children[i];t.parent=null,t.dispatchEvent(Ui)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Z.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),Z.multiply(i.parent.matrixWorld)),i.applyMatrix4(Z),i.updateWorldMatrix(!1,!1),this.add(i),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,t){if(this[i]===t)return this;for(let n=0,u=this.children.length;n<u;n++){const h=this.children[n].getObjectByProperty(i,t);if(h!==void 0)return h}},getWorldPosition:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new te),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new Fi),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ne,i,de),i},getWorldScale:function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new te),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ne,Pe,i),i},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new te),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return i.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(i){i(this);const t=this.children;for(let n=0,u=t.length;n<u;n++)t[n].traverse(i)},traverseVisible:function(i){if(this.visible===!1)return;i(this);const t=this.children;for(let n=0,u=t.length;n<u;n++)t[n].traverseVisible(i)},traverseAncestors:function(i){const t=this.parent;t!==null&&(i(t),t.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const t=this.children;for(let n=0,u=t.length;n<u;n++)t[n].updateMatrixWorld(i)},updateWorldMatrix:function(i,t){const n=this.parent;if(i===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const u=this.children;for(let c=0,h=u.length;c<h;c++)u[c].updateWorldMatrix(!1,!0)}},toJSON:function(i){const t=i===void 0||typeof i=="string",n={};t&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const u={};u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.castShadow===!0&&(u.castShadow=!0),this.receiveShadow===!0&&(u.receiveShadow=!0),this.visible===!1&&(u.visible=!1),this.frustumCulled===!1&&(u.frustumCulled=!1),this.renderOrder!==0&&(u.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(u.userData=this.userData),u.layers=this.layers.mask,u.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(u.matrixAutoUpdate=!1),this.isInstancedMesh&&(u.type="InstancedMesh",u.count=this.count,u.instanceMatrix=this.instanceMatrix.toJSON());function c(p,g){return p[g.uuid]===void 0&&(p[g.uuid]=g.toJSON(i)),g.uuid}if(this.isMesh||this.isLine||this.isPoints){u.geometry=c(i.geometries,this.geometry);const p=this.geometry.parameters;if(p!==void 0&&p.shapes!==void 0){const g=p.shapes;if(Array.isArray(g))for(let _=0,x=g.length;_<x;_++){const E=g[_];c(i.shapes,E)}else c(i.shapes,g)}}if(this.isSkinnedMesh&&(u.bindMode=this.bindMode,u.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(i.skeletons,this.skeleton),u.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const p=[];for(let g=0,_=this.material.length;g<_;g++)p.push(c(i.materials,this.material[g]));u.material=p}else u.material=c(i.materials,this.material);if(this.children.length>0){u.children=[];for(let p=0;p<this.children.length;p++)u.children.push(this.children[p].toJSON(i).object)}if(this.animations.length>0){u.animations=[];for(let p=0;p<this.animations.length;p++){const g=this.animations[p];u.animations.push(c(i.animations,g))}}if(t){const p=h(i.geometries),g=h(i.materials),_=h(i.textures),x=h(i.images),E=h(i.shapes),S=h(i.skeletons),C=h(i.animations);p.length>0&&(n.geometries=p),g.length>0&&(n.materials=g),_.length>0&&(n.textures=_),x.length>0&&(n.images=x),E.length>0&&(n.shapes=E),S.length>0&&(n.skeletons=S),C.length>0&&(n.animations=C)}return n.object=u,n;function h(p){const g=[];for(const _ in p){const x=p[_];delete x.metadata,g.push(x)}return g}},clone:function(i){return new this.constructor().copy(this,i)},copy:function(i,t=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),t===!0)for(let n=0;n<i.children.length;n++){const u=i.children[n];this.add(u.clone())}return this}});const mr=new te,Tl=new te,ec=new Ji;class tr{constructor(t,n){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=t!==void 0?t:new te(1,0,0),this.constant=n!==void 0?n:0}set(t,n){return this.normal.copy(t),this.constant=n,this}setComponents(t,n,u,c){return this.normal.set(t,n,u),this.constant=c,this}setFromNormalAndCoplanarPoint(t,n){return this.normal.copy(t),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(t,n,u){const c=mr.subVectors(u,n).cross(Tl.subVectors(t,n)).normalize();return this.setFromNormalAndCoplanarPoint(c,t),this}clone(){return new this.constructor().copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,n){return n===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),n=new te),n.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,n){n===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new te);const u=t.delta(mr),c=this.normal.dot(u);if(c===0)return this.distanceToPoint(t.start)===0?n.copy(t.start):void 0;const h=-(t.start.dot(this.normal)+this.constant)/c;if(!(h<0||h>1))return n.copy(u).multiplyScalar(h).add(t.start)}intersectsLine(t){const n=this.distanceToPoint(t.start),u=this.distanceToPoint(t.end);return n<0&&u>0||u<0&&n>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new te),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,n){const u=n||ec.getNormalMatrix(t),c=this.coplanarPoint(mr).applyMatrix4(t),h=this.normal.applyMatrix3(u).normalize();return this.constant=-c.dot(h),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const Ln=new te,Hn=new te,eo=new te,ci=new te,oa=new te,In=new te,mm=new te,Sh=new te,wh=new te,Eh=new te;class yn{constructor(t,n,u){this.a=t!==void 0?t:new te,this.b=n!==void 0?n:new te,this.c=u!==void 0?u:new te}static getNormal(t,n,u,c){c===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),c=new te),c.subVectors(u,n),Ln.subVectors(t,n),c.cross(Ln);const h=c.lengthSq();return h>0?c.multiplyScalar(1/Math.sqrt(h)):c.set(0,0,0)}static getBarycoord(t,n,u,c,h){Ln.subVectors(c,n),Hn.subVectors(u,n),eo.subVectors(t,n);const p=Ln.dot(Ln),g=Ln.dot(Hn),_=Ln.dot(eo),x=Hn.dot(Hn),E=Hn.dot(eo),S=p*x-g*g;if(h===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),h=new te),S===0)return h.set(-2,-1,-1);const C=1/S,I=(x*_-g*E)*C,F=(p*E-g*_)*C;return h.set(1-I-F,F,I)}static containsPoint(t,n,u,c){return this.getBarycoord(t,n,u,c,ci),ci.x>=0&&ci.y>=0&&ci.x+ci.y<=1}static getUV(t,n,u,c,h,p,g,_){return this.getBarycoord(t,n,u,c,ci),_.set(0,0),_.addScaledVector(h,ci.x),_.addScaledVector(p,ci.y),_.addScaledVector(g,ci.z),_}static isFrontFacing(t,n,u,c){return Ln.subVectors(u,n),Hn.subVectors(t,n),Ln.cross(Hn).dot(c)<0}set(t,n,u){return this.a.copy(t),this.b.copy(n),this.c.copy(u),this}setFromPointsAndIndices(t,n,u,c){return this.a.copy(t[n]),this.b.copy(t[u]),this.c.copy(t[c]),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ln.subVectors(this.c,this.b),Hn.subVectors(this.a,this.b),Ln.cross(Hn).length()*.5}getMidpoint(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new te),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return yn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new tr),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,n){return yn.getBarycoord(t,this.a,this.b,this.c,n)}getUV(t,n,u,c,h){return yn.getUV(t,this.a,this.b,this.c,n,u,c,h)}containsPoint(t){return yn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return yn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,n){n===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),n=new te);const u=this.a,c=this.b,h=this.c;let p,g;oa.subVectors(c,u),In.subVectors(h,u),Sh.subVectors(t,u);const _=oa.dot(Sh),x=In.dot(Sh);if(_<=0&&x<=0)return n.copy(u);wh.subVectors(t,c);const E=oa.dot(wh),S=In.dot(wh);if(E>=0&&S<=E)return n.copy(c);const C=_*S-E*x;if(C<=0&&_>=0&&E<=0)return p=_/(_-E),n.copy(u).addScaledVector(oa,p);Eh.subVectors(t,h);const I=oa.dot(Eh),F=In.dot(Eh);if(F>=0&&I<=F)return n.copy(h);const z=I*x-_*F;if(z<=0&&x>=0&&F<=0)return g=x/(x-F),n.copy(u).addScaledVector(In,g);const G=E*F-I*S;if(G<=0&&S-E>=0&&I-F>=0)return mm.subVectors(h,c),g=(S-E)/(S-E+(I-F)),n.copy(c).addScaledVector(mm,g);const k=1/(G+z+C);return p=z*k,g=C*k,n.copy(u).addScaledVector(oa,p).addScaledVector(In,g)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const gm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gr={h:0,s:0,l:0},tc={h:0,s:0,l:0};function Mh(i,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?i+(t-i)*6*n:n<1/2?t:n<2/3?i+(t-i)*6*(2/3-n):i}function Ch(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Ph(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}class Mt{constructor(t,n,u){return Object.defineProperty(this,"isColor",{value:!0}),n===void 0&&u===void 0?this.set(t):this.setRGB(t,n,u)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this}setRGB(t,n,u){return this.r=t,this.g=n,this.b=u,this}setHSL(t,n,u){if(t=At.euclideanModulo(t,1),n=At.clamp(n,0,1),u=At.clamp(u,0,1),n===0)this.r=this.g=this.b=u;else{const c=u<=.5?u*(1+n):u+n-u*n,h=2*u-c;this.r=Mh(h,c,t+1/3),this.g=Mh(h,c,t),this.b=Mh(h,c,t-1/3)}return this}setStyle(t){function n(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let u;if(u=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let c;const h=u[1],p=u[2];switch(h){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,n(c[4]),this;if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,n(c[4]),this;break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p)){const g=parseFloat(c[1])/360,_=parseInt(c[2],10)/100,x=parseInt(c[3],10)/100;return n(c[4]),this.setHSL(g,_,x)}break}}else if(u=/^\#([A-Fa-f\d]+)$/.exec(t)){const c=u[1],h=c.length;if(h===3)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(h===6)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const n=gm[t];return n!==void 0?this.setHex(n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,n=2){return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}copyLinearToGamma(t,n=2){const u=n>0?1/n:1;return this.r=Math.pow(t.r,u),this.g=Math.pow(t.g,u),this.b=Math.pow(t.b,u),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Ch(t.r),this.g=Ch(t.g),this.b=Ch(t.b),this}copyLinearToSRGB(t){return this.r=Ph(t.r),this.g=Ph(t.g),this.b=Ph(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const n=this.r,u=this.g,c=this.b,h=Math.max(n,u,c),p=Math.min(n,u,c);let g,_;const x=(p+h)/2;if(p===h)g=0,_=0;else{const E=h-p;switch(_=x<=.5?E/(h+p):E/(2-h-p),h){case n:g=(u-c)/E+(u<c?6:0);break;case u:g=(c-n)/E+2;break;case c:g=(n-u)/E+4;break}g/=6}return t.h=g,t.s=_,t.l=x,t}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(t,n,u){return this.getHSL(gr),gr.h+=t,gr.s+=n,gr.l+=u,this.setHSL(gr.h,gr.s,gr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,u){return this.r=t.r+(n.r-t.r)*u,this.g=t.g+(n.g-t.g)*u,this.b=t.b+(n.b-t.b)*u,this}lerpHSL(t,n){this.getHSL(gr),t.getHSL(tc);const u=At.lerp(gr.h,tc.h,n),c=At.lerp(gr.s,tc.s,n),h=At.lerp(gr.l,tc.l,n);return this.setHSL(u,c,h),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Mt.NAMES=gm,Mt.prototype.r=1,Mt.prototype.g=1,Mt.prototype.b=1;class F_{constructor(t,n,u,c,h,p=0){this.a=t,this.b=n,this.c=u,this.normal=c&&c.isVector3?c:new te,this.vertexNormals=Array.isArray(c)?c:[],this.color=h&&h.isColor?h:new Mt,this.vertexColors=Array.isArray(h)?h:[],this.materialIndex=p}clone(){return new this.constructor().copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let n=0,u=t.vertexNormals.length;n<u;n++)this.vertexNormals[n]=t.vertexNormals[n].clone();for(let n=0,u=t.vertexColors.length;n<u;n++)this.vertexColors[n]=t.vertexColors[n].clone();return this}}let k_=0;function Lt(){Object.defineProperty(this,"id",{value:k_++}),this.uuid=At.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=hi,this.side=vt,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Lu,this.blendDst=il,this.blendEquation=lr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=rl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=$u,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=yl,this.stencilZFail=yl,this.stencilZPass=yl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Lt.prototype=J(Object.create($n.prototype),{constructor:Lt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(i!==void 0)for(const t in i){const n=i[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Kt;continue}const u=this[t];if(u===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}u&&u.isColor?u.set(n):u&&u.isVector3&&n&&n.isVector3?u.copy(n):this[t]=n}},toJSON:function(i){const t=i===void 0||typeof i=="string";t&&(i={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(i).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(i).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(i).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(i).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(i).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(i).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,this.combine!==void 0&&(n.combine=this.combine),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(i).uuid),this.size!==void 0&&(n.size=this.size),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==hi&&(n.blending=this.blending),this.flatShading===!0&&(n.flatShading=this.flatShading),this.side!==vt&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.skinning===!0&&(n.skinning=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function u(c){const h=[];for(const p in c){const g=c[p];delete g.metadata,h.push(g)}return h}if(t){const c=u(i.textures),h=u(i.images);c.length>0&&(n.textures=c),h.length>0&&(n.images=h)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.flatShading=i.flatShading,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const t=i.clippingPlanes;let n=null;if(t!==null){const u=t.length;n=new Array(u);for(let c=0;c!==u;++c)n[c]=t[c].clone()}return this.clippingPlanes=n,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Lt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}});function Dn(i){Lt.call(this),this.type="MeshBasicMaterial",this.color=new Mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=La,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(i)}Dn.prototype=Object.create(Lt.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isMeshBasicMaterial=!0,Dn.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this};const Ti=new te,ic=new be;function Qt(i,t,n){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=i,this.itemSize=t,this.count=i!==void 0?i.length/t:0,this.normalized=n===!0,this.usage=Qs,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Qt.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),J(Qt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,t,n){i*=this.itemSize,n*=t.itemSize;for(let u=0,c=this.itemSize;u<c;u++)this.array[i+u]=t.array[n+u];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){const t=this.array;let n=0;for(let u=0,c=i.length;u<c;u++){let h=i[u];h===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",u),h=new Mt),t[n++]=h.r,t[n++]=h.g,t[n++]=h.b}return this},copyVector2sArray:function(i){const t=this.array;let n=0;for(let u=0,c=i.length;u<c;u++){let h=i[u];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",u),h=new be),t[n++]=h.x,t[n++]=h.y}return this},copyVector3sArray:function(i){const t=this.array;let n=0;for(let u=0,c=i.length;u<c;u++){let h=i[u];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",u),h=new te),t[n++]=h.x,t[n++]=h.y,t[n++]=h.z}return this},copyVector4sArray:function(i){const t=this.array;let n=0;for(let u=0,c=i.length;u<c;u++){let h=i[u];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",u),h=new pi),t[n++]=h.x,t[n++]=h.y,t[n++]=h.z,t[n++]=h.w}return this},applyMatrix3:function(i){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)ic.fromBufferAttribute(this,t),ic.applyMatrix3(i),this.setXY(t,ic.x,ic.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ti.fromBufferAttribute(this,t),Ti.applyMatrix3(i),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this},applyMatrix4:function(i){for(let t=0,n=this.count;t<n;t++)Ti.x=this.getX(t),Ti.y=this.getY(t),Ti.z=this.getZ(t),Ti.applyMatrix4(i),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this},applyNormalMatrix:function(i){for(let t=0,n=this.count;t<n;t++)Ti.x=this.getX(t),Ti.y=this.getY(t),Ti.z=this.getZ(t),Ti.applyNormalMatrix(i),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this},transformDirection:function(i){for(let t=0,n=this.count;t<n;t++)Ti.x=this.getX(t),Ti.y=this.getY(t),Ti.z=this.getZ(t),Ti.transformDirection(i),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this},set:function(i,t=0){return this.array.set(i,t),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,t){return this.array[i*this.itemSize]=t,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,t){return this.array[i*this.itemSize+1]=t,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,t){return this.array[i*this.itemSize+2]=t,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,t){return this.array[i*this.itemSize+3]=t,this},setXY:function(i,t,n){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=n,this},setXYZ:function(i,t,n,u){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=n,this.array[i+2]=u,this},setXYZW:function(i,t,n,u,c){return i*=this.itemSize,this.array[i+0]=t,this.array[i+1]=n,this.array[i+2]=u,this.array[i+3]=c,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function Lh(i,t,n){Qt.call(this,new Int8Array(i),t,n)}Lh.prototype=Object.create(Qt.prototype),Lh.prototype.constructor=Lh;function Ih(i,t,n){Qt.call(this,new Uint8Array(i),t,n)}Ih.prototype=Object.create(Qt.prototype),Ih.prototype.constructor=Ih;function Dh(i,t,n){Qt.call(this,new Uint8ClampedArray(i),t,n)}Dh.prototype=Object.create(Qt.prototype),Dh.prototype.constructor=Dh;function Rh(i,t,n){Qt.call(this,new Int16Array(i),t,n)}Rh.prototype=Object.create(Qt.prototype),Rh.prototype.constructor=Rh;function Al(i,t,n){Qt.call(this,new Uint16Array(i),t,n)}Al.prototype=Object.create(Qt.prototype),Al.prototype.constructor=Al;function Oh(i,t,n){Qt.call(this,new Int32Array(i),t,n)}Oh.prototype=Object.create(Qt.prototype),Oh.prototype.constructor=Oh;function Sl(i,t,n){Qt.call(this,new Uint32Array(i),t,n)}Sl.prototype=Object.create(Qt.prototype),Sl.prototype.constructor=Sl;function nc(i,t,n){Qt.call(this,new Uint16Array(i),t,n)}nc.prototype=Object.create(Qt.prototype),nc.prototype.constructor=nc,nc.prototype.isFloat16BufferAttribute=!0;function ki(i,t,n){Qt.call(this,new Float32Array(i),t,n)}ki.prototype=Object.create(Qt.prototype),ki.prototype.constructor=ki;function Fh(i,t,n){Qt.call(this,new Float64Array(i),t,n)}Fh.prototype=Object.create(Qt.prototype),Fh.prototype.constructor=Fh;function vm(i){if(i.length===0)return-1/0;let t=i[0];for(let n=1,u=i.length;n<u;++n)i[n]>t&&(t=i[n]);return t}const B_={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function rc(i,t){return new B_[i](t)}let N_=0;const Fr=new Ut,kh=new gt,to=new te,Vn=new Dr,wl=new Dr,tn=new te;function mi(){Object.defineProperty(this,"id",{value:N_++}),this.uuid=At.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}mi.prototype=J(Object.create($n.prototype),{constructor:mi,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return Array.isArray(i)?this.index=new(vm(i)>65535?Sl:Al)(i,1):this.index=i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,t){return this.attributes[i]=t,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return this.attributes[i]!==void 0},addGroup:function(i,t,n=0){this.groups.push({start:i,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,t){this.drawRange.start=i,this.drawRange.count=t},applyMatrix4:function(i){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(i),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const c=new Ji().getNormalMatrix(i);n.applyNormalMatrix(c),n.needsUpdate=!0}const u=this.attributes.tangent;return u!==void 0&&(u.transformDirection(i),u.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(i){return Fr.makeRotationX(i),this.applyMatrix4(Fr),this},rotateY:function(i){return Fr.makeRotationY(i),this.applyMatrix4(Fr),this},rotateZ:function(i){return Fr.makeRotationZ(i),this.applyMatrix4(Fr),this},translate:function(i,t,n){return Fr.makeTranslation(i,t,n),this.applyMatrix4(Fr),this},scale:function(i,t,n){return Fr.makeScale(i,t,n),this.applyMatrix4(Fr),this},lookAt:function(i){return kh.lookAt(i),kh.updateMatrix(),this.applyMatrix4(kh.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(to).negate(),this.translate(to.x,to.y,to.z),this},setFromPoints:function(i){const t=[];for(let n=0,u=i.length;n<u;n++){const c=i[n];t.push(c.x,c.y,c.z||0)}return this.setAttribute("position",new ki(t,3)),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Dr);const i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new te(-1/0,-1/0,-1/0),new te(1/0,1/0,1/0));return}if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),t)for(let n=0,u=t.length;n<u;n++){const c=t[n];Vn.setFromBufferAttribute(c),this.morphTargetsRelative?(tn.addVectors(this.boundingBox.min,Vn.min),this.boundingBox.expandByPoint(tn),tn.addVectors(this.boundingBox.max,Vn.max),this.boundingBox.expandByPoint(tn)):(this.boundingBox.expandByPoint(Vn.min),this.boundingBox.expandByPoint(Vn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new sa);const i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new te,1/0);return}if(i){const n=this.boundingSphere.center;if(Vn.setFromBufferAttribute(i),t)for(let c=0,h=t.length;c<h;c++){const p=t[c];wl.setFromBufferAttribute(p),this.morphTargetsRelative?(tn.addVectors(Vn.min,wl.min),Vn.expandByPoint(tn),tn.addVectors(Vn.max,wl.max),Vn.expandByPoint(tn)):(Vn.expandByPoint(wl.min),Vn.expandByPoint(wl.max))}Vn.getCenter(n);let u=0;for(let c=0,h=i.count;c<h;c++)tn.fromBufferAttribute(i,c),u=Math.max(u,n.distanceToSquared(tn));if(t)for(let c=0,h=t.length;c<h;c++){const p=t[c],g=this.morphTargetsRelative;for(let _=0,x=p.count;_<x;_++)tn.fromBufferAttribute(p,_),g&&(to.fromBufferAttribute(i,_),tn.add(to)),u=Math.max(u,n.distanceToSquared(tn))}this.boundingSphere.radius=Math.sqrt(u),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const i=this.index,t=this.attributes;if(i===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.array,u=t.position.array,c=t.normal.array,h=t.uv.array,p=u.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Qt(new Float32Array(4*p),4));const g=t.tangent.array,_=[],x=[];for(let xe=0;xe<p;xe++)_[xe]=new te,x[xe]=new te;const E=new te,S=new te,C=new te,I=new be,F=new be,z=new be,G=new te,k=new te;function O(xe,Se,we){E.fromArray(u,xe*3),S.fromArray(u,Se*3),C.fromArray(u,we*3),I.fromArray(h,xe*2),F.fromArray(h,Se*2),z.fromArray(h,we*2),S.sub(E),C.sub(E),F.sub(I),z.sub(I);const Re=1/(F.x*z.y-z.x*F.y);isFinite(Re)&&(G.copy(S).multiplyScalar(z.y).addScaledVector(C,-F.y).multiplyScalar(Re),k.copy(C).multiplyScalar(F.x).addScaledVector(S,-z.x).multiplyScalar(Re),_[xe].add(G),_[Se].add(G),_[we].add(G),x[xe].add(k),x[Se].add(k),x[we].add(k))}let se=this.groups;se.length===0&&(se=[{start:0,count:n.length}]);for(let xe=0,Se=se.length;xe<Se;++xe){const we=se[xe],Re=we.start,he=we.count;for(let ce=Re,pe=Re+he;ce<pe;ce+=3)O(n[ce+0],n[ce+1],n[ce+2])}const oe=new te,re=new te,X=new te,me=new te;function ke(xe){X.fromArray(c,xe*3),me.copy(X);const Se=_[xe];oe.copy(Se),oe.sub(X.multiplyScalar(X.dot(Se))).normalize(),re.crossVectors(me,Se);const Re=re.dot(x[xe])<0?-1:1;g[xe*4]=oe.x,g[xe*4+1]=oe.y,g[xe*4+2]=oe.z,g[xe*4+3]=Re}for(let xe=0,Se=se.length;xe<Se;++xe){const we=se[xe],Re=we.start,he=we.count;for(let ce=Re,pe=Re+he;ce<pe;ce+=3)ke(n[ce+0]),ke(n[ce+1]),ke(n[ce+2])}},computeVertexNormals:function(){const i=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Qt(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let S=0,C=n.count;S<C;S++)n.setXYZ(S,0,0,0);const u=new te,c=new te,h=new te,p=new te,g=new te,_=new te,x=new te,E=new te;if(i)for(let S=0,C=i.count;S<C;S+=3){const I=i.getX(S+0),F=i.getX(S+1),z=i.getX(S+2);u.fromBufferAttribute(t,I),c.fromBufferAttribute(t,F),h.fromBufferAttribute(t,z),x.subVectors(h,c),E.subVectors(u,c),x.cross(E),p.fromBufferAttribute(n,I),g.fromBufferAttribute(n,F),_.fromBufferAttribute(n,z),p.add(x),g.add(x),_.add(x),n.setXYZ(I,p.x,p.y,p.z),n.setXYZ(F,g.x,g.y,g.z),n.setXYZ(z,_.x,_.y,_.z)}else for(let S=0,C=t.count;S<C;S+=3)u.fromBufferAttribute(t,S+0),c.fromBufferAttribute(t,S+1),h.fromBufferAttribute(t,S+2),x.subVectors(h,c),E.subVectors(u,c),x.cross(E),n.setXYZ(S+0,x.x,x.y,x.z),n.setXYZ(S+1,x.x,x.y,x.z),n.setXYZ(S+2,x.x,x.y,x.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(i,t){if(!(i&&i.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const u in n){if(i.attributes[u]===void 0)continue;const h=n[u].array,p=i.attributes[u],g=p.array,_=p.itemSize*t,x=Math.min(g.length,h.length-_);for(let E=0,S=_;E<x;E++,S++)h[S]=g[E]}return this},normalizeNormals:function(){const i=this.attributes.normal;for(let t=0,n=i.count;t<n;t++)tn.fromBufferAttribute(i,t),tn.normalize(),i.setXYZ(t,tn.x,tn.y,tn.z)},toNonIndexed:function(){function i(p,g){const _=p.array,x=p.itemSize,E=p.normalized,S=new _.constructor(g.length*x);let C=0,I=0;for(let F=0,z=g.length;F<z;F++){C=g[F]*x;for(let G=0;G<x;G++)S[I++]=_[C++]}return new Qt(S,x,E)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new mi,n=this.index.array,u=this.attributes;for(const p in u){const g=u[p],_=i(g,n);t.setAttribute(p,_)}const c=this.morphAttributes;for(const p in c){const g=[],_=c[p];for(let x=0,E=_.length;x<E;x++){const S=_[x],C=i(S,n);g.push(C)}t.morphAttributes[p]=g}t.morphTargetsRelative=this.morphTargetsRelative;const h=this.groups;for(let p=0,g=h.length;p<g;p++){const _=h[p];t.addGroup(_.start,_.count,_.materialIndex)}return t},toJSON:function(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const g=this.parameters;for(const _ in g)g[_]!==void 0&&(i[_]=g[_]);return i}i.data={attributes:{}};const t=this.index;t!==null&&(i.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const g in n){const _=n[g],x=_.toJSON(i.data);_.name!==""&&(x.name=_.name),i.data.attributes[g]=x}const u={};let c=!1;for(const g in this.morphAttributes){const _=this.morphAttributes[g],x=[];for(let E=0,S=_.length;E<S;E++){const C=_[E],I=C.toJSON(i.data);C.name!==""&&(I.name=C.name),x.push(I)}x.length>0&&(u[g]=x,c=!0)}c&&(i.data.morphAttributes=u,i.data.morphTargetsRelative=this.morphTargetsRelative);const h=this.groups;h.length>0&&(i.data.groups=JSON.parse(JSON.stringify(h)));const p=this.boundingSphere;return p!==null&&(i.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),i},clone:function(){return new mi().copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=i.name;const n=i.index;n!==null&&this.setIndex(n.clone(t));const u=i.attributes;for(const _ in u){const x=u[_];this.setAttribute(_,x.clone(t))}const c=i.morphAttributes;for(const _ in c){const x=[],E=c[_];for(let S=0,C=E.length;S<C;S++)x.push(E[S].clone(t));this.morphAttributes[_]=x}this.morphTargetsRelative=i.morphTargetsRelative;const h=i.groups;for(let _=0,x=h.length;_<x;_++){const E=h[_];this.addGroup(E.start,E.count,E.materialIndex)}const p=i.boundingBox;p!==null&&(this.boundingBox=p.clone());const g=i.boundingSphere;return g!==null&&(this.boundingSphere=g.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const ym=new Ut,io=new hs,Bh=new sa,Va=new te,Ga=new te,za=new te,Nh=new te,Uh=new te,Hh=new te,ac=new te,sc=new te,oc=new te,lc=new be,uc=new be,cc=new be,Vh=new te,dc=new te;function Ii(i=new mi,t=new Dn){gt.call(this),this.type="Mesh",this.geometry=i,this.material=t,this.updateMorphTargets()}Ii.prototype=J(Object.create(gt.prototype),{constructor:Ii,isMesh:!0,copy:function(i){return gt.prototype.copy.call(this,i),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=J({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const t=i.morphAttributes,n=Object.keys(t);if(n.length>0){const u=t[n[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,h=u.length;c<h;c++){const p=u[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=c}}}}else{const t=i.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,t){const n=this.geometry,u=this.material,c=this.matrixWorld;if(u===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),Bh.copy(n.boundingSphere),Bh.applyMatrix4(c),i.ray.intersectsSphere(Bh)===!1)||(ym.copy(c).invert(),io.copy(i.ray).applyMatrix4(ym),n.boundingBox!==null&&io.intersectsBox(n.boundingBox)===!1))return;let h;if(n.isBufferGeometry){const p=n.index,g=n.attributes.position,_=n.morphAttributes.position,x=n.morphTargetsRelative,E=n.attributes.uv,S=n.attributes.uv2,C=n.groups,I=n.drawRange;if(p!==null)if(Array.isArray(u))for(let F=0,z=C.length;F<z;F++){const G=C[F],k=u[G.materialIndex],O=Math.max(G.start,I.start),se=Math.min(G.start+G.count,I.start+I.count);for(let oe=O,re=se;oe<re;oe+=3){const X=p.getX(oe),me=p.getX(oe+1),ke=p.getX(oe+2);h=hc(this,k,i,io,g,_,x,E,S,X,me,ke),h&&(h.faceIndex=Math.floor(oe/3),h.face.materialIndex=G.materialIndex,t.push(h))}}else{const F=Math.max(0,I.start),z=Math.min(p.count,I.start+I.count);for(let G=F,k=z;G<k;G+=3){const O=p.getX(G),se=p.getX(G+1),oe=p.getX(G+2);h=hc(this,u,i,io,g,_,x,E,S,O,se,oe),h&&(h.faceIndex=Math.floor(G/3),t.push(h))}}else if(g!==void 0)if(Array.isArray(u))for(let F=0,z=C.length;F<z;F++){const G=C[F],k=u[G.materialIndex],O=Math.max(G.start,I.start),se=Math.min(G.start+G.count,I.start+I.count);for(let oe=O,re=se;oe<re;oe+=3){const X=oe,me=oe+1,ke=oe+2;h=hc(this,k,i,io,g,_,x,E,S,X,me,ke),h&&(h.faceIndex=Math.floor(oe/3),h.face.materialIndex=G.materialIndex,t.push(h))}}else{const F=Math.max(0,I.start),z=Math.min(g.count,I.start+I.count);for(let G=F,k=z;G<k;G+=3){const O=G,se=G+1,oe=G+2;h=hc(this,u,i,io,g,_,x,E,S,O,se,oe),h&&(h.faceIndex=Math.floor(G/3),t.push(h))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});function U_(i,t,n,u,c,h,p,g){let _;if(t.side===je?_=u.intersectTriangle(p,h,c,!0,g):_=u.intersectTriangle(c,h,p,t.side!==ut,g),_===null)return null;dc.copy(g),dc.applyMatrix4(i.matrixWorld);const x=n.ray.origin.distanceTo(dc);return x<n.near||x>n.far?null:{distance:x,point:dc.clone(),object:i}}function hc(i,t,n,u,c,h,p,g,_,x,E,S){Va.fromBufferAttribute(c,x),Ga.fromBufferAttribute(c,E),za.fromBufferAttribute(c,S);const C=i.morphTargetInfluences;if(t.morphTargets&&h&&C){ac.set(0,0,0),sc.set(0,0,0),oc.set(0,0,0);for(let F=0,z=h.length;F<z;F++){const G=C[F],k=h[F];G!==0&&(Nh.fromBufferAttribute(k,x),Uh.fromBufferAttribute(k,E),Hh.fromBufferAttribute(k,S),p?(ac.addScaledVector(Nh,G),sc.addScaledVector(Uh,G),oc.addScaledVector(Hh,G)):(ac.addScaledVector(Nh.sub(Va),G),sc.addScaledVector(Uh.sub(Ga),G),oc.addScaledVector(Hh.sub(za),G)))}Va.add(ac),Ga.add(sc),za.add(oc)}i.isSkinnedMesh&&(i.boneTransform(x,Va),i.boneTransform(E,Ga),i.boneTransform(S,za));const I=U_(i,t,n,u,Va,Ga,za,Vh);if(I){g&&(lc.fromBufferAttribute(g,x),uc.fromBufferAttribute(g,E),cc.fromBufferAttribute(g,S),I.uv=yn.getUV(Vh,Va,Ga,za,lc,uc,cc,new be)),_&&(lc.fromBufferAttribute(_,x),uc.fromBufferAttribute(_,E),cc.fromBufferAttribute(_,S),I.uv2=yn.getUV(Vh,Va,Ga,za,lc,uc,cc,new be));const F=new F_(x,E,S);yn.getNormal(Va,Ga,za,F.normal),I.face=F}return I}class El extends mi{constructor(t=1,n=1,u=1,c=1,h=1,p=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:n,depth:u,widthSegments:c,heightSegments:h,depthSegments:p};const g=this;c=Math.floor(c),h=Math.floor(h),p=Math.floor(p);const _=[],x=[],E=[],S=[];let C=0,I=0;F("z","y","x",-1,-1,u,n,t,p,h,0),F("z","y","x",1,-1,u,n,-t,p,h,1),F("x","z","y",1,1,t,u,n,c,p,2),F("x","z","y",1,-1,t,u,-n,c,p,3),F("x","y","z",1,-1,t,n,u,c,h,4),F("x","y","z",-1,-1,t,n,-u,c,h,5),this.setIndex(_),this.setAttribute("position",new ki(x,3)),this.setAttribute("normal",new ki(E,3)),this.setAttribute("uv",new ki(S,2));function F(z,G,k,O,se,oe,re,X,me,ke,xe){const Se=oe/me,we=re/ke,Re=oe/2,he=re/2,ce=X/2,pe=me+1,Te=ke+1;let He=0,Xe=0;const Qe=new te;for(let lt=0;lt<Te;lt++){const rt=lt*we-he;for(let Et=0;Et<pe;Et++){const Dt=Et*Se-Re;Qe[z]=Dt*O,Qe[G]=rt*se,Qe[k]=ce,x.push(Qe.x,Qe.y,Qe.z),Qe[z]=0,Qe[G]=0,Qe[k]=X>0?1:-1,E.push(Qe.x,Qe.y,Qe.z),S.push(Et/me),S.push(1-lt/ke),He+=1}}for(let lt=0;lt<ke;lt++)for(let rt=0;rt<me;rt++){const Et=C+rt+pe*lt,Dt=C+rt+pe*(lt+1),Ht=C+(rt+1)+pe*(lt+1),Ve=C+(rt+1)+pe*lt;_.push(Et,Dt,Ve),_.push(Dt,Ht,Ve),Xe+=6}g.addGroup(I,Xe,xe),I+=Xe,C+=He}}}function no(i){const t={};for(const n in i){t[n]={};for(const u in i[n]){const c=i[n][u];c&&(c.isColor||c.isMatrix3||c.isMatrix4||c.isVector2||c.isVector3||c.isVector4||c.isTexture)?t[n][u]=c.clone():Array.isArray(c)?t[n][u]=c.slice():t[n][u]=c}}return t}function hn(i){const t={};for(let n=0;n<i.length;n++){const u=no(i[n]);for(const c in u)t[c]=u[c]}return t}const H_={clone:no,merge:hn};var V_=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,G_=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function _n(i){Lt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=V_,this.fragmentShader=G_,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&(i.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(i))}_n.prototype=Object.create(Lt.prototype),_n.prototype.constructor=_n,_n.prototype.isShaderMaterial=!0,_n.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=no(i.uniforms),this.defines=J({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.lights=i.lights,this.clipping=i.clipping,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.extensions=J({},i.extensions),this.glslVersion=i.glslVersion,this},_n.prototype.toJSON=function(i){const t=Lt.prototype.toJSON.call(this,i);t.glslVersion=this.glslVersion,t.uniforms={};for(const u in this.uniforms){const h=this.uniforms[u].value;h&&h.isTexture?t.uniforms[u]={type:"t",value:h.toJSON(i).uuid}:h&&h.isColor?t.uniforms[u]={type:"c",value:h.getHex()}:h&&h.isVector2?t.uniforms[u]={type:"v2",value:h.toArray()}:h&&h.isVector3?t.uniforms[u]={type:"v3",value:h.toArray()}:h&&h.isVector4?t.uniforms[u]={type:"v4",value:h.toArray()}:h&&h.isMatrix3?t.uniforms[u]={type:"m3",value:h.toArray()}:h&&h.isMatrix4?t.uniforms[u]={type:"m4",value:h.toArray()}:t.uniforms[u]={value:h}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const u in this.extensions)this.extensions[u]===!0&&(n[u]=!0);return Object.keys(n).length>0&&(t.extensions=n),t};function Wa(){gt.call(this),this.type="Camera",this.matrixWorldInverse=new Ut,this.projectionMatrix=new Ut,this.projectionMatrixInverse=new Ut}Wa.prototype=J(Object.create(gt.prototype),{constructor:Wa,isCamera:!0,copy:function(i,t){return gt.prototype.copy.call(this,i,t),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){i===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new te),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return i.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(i){gt.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,t){gt.prototype.updateWorldMatrix.call(this,i,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return new this.constructor().copy(this)}});function Qi(i=50,t=1,n=.1,u=2e3){Wa.call(this),this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=n,this.far=u,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Qi.prototype=J(Object.create(Wa.prototype),{constructor:Qi,isPerspectiveCamera:!0,copy:function(i,t){return Wa.prototype.copy.call(this,i,t),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:J({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){const t=.5*this.getFilmHeight()/i;this.fov=At.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const i=Math.tan(At.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/i},getEffectiveFOV:function(){return At.RAD2DEG*2*Math.atan(Math.tan(At.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,t,n,u,c,h){this.aspect=i/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=u,this.view.width=c,this.view.height=h,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=this.near;let t=i*Math.tan(At.DEG2RAD*.5*this.fov)/this.zoom,n=2*t,u=this.aspect*n,c=-.5*u;const h=this.view;if(this.view!==null&&this.view.enabled){const g=h.fullWidth,_=h.fullHeight;c+=h.offsetX*u/g,t-=h.offsetY*n/_,u*=h.width/g,n*=h.height/_}const p=this.filmOffset;p!==0&&(c+=i*p/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+u,t,t-n,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const t=gt.prototype.toJSON.call(this,i);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=J({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const ro=90,ao=1;function so(i,t,n){if(gt.call(this),this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const u=new Qi(ro,ao,i,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new te(1,0,0)),this.add(u);const c=new Qi(ro,ao,i,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new te(-1,0,0)),this.add(c);const h=new Qi(ro,ao,i,t);h.layers=this.layers,h.up.set(0,0,1),h.lookAt(new te(0,1,0)),this.add(h);const p=new Qi(ro,ao,i,t);p.layers=this.layers,p.up.set(0,0,-1),p.lookAt(new te(0,-1,0)),this.add(p);const g=new Qi(ro,ao,i,t);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new te(0,0,1)),this.add(g);const _=new Qi(ro,ao,i,t);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new te(0,0,-1)),this.add(_),this.update=function(x,E){this.parent===null&&this.updateMatrixWorld();const S=x.xr.enabled,C=x.getRenderTarget();x.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,x.setRenderTarget(n,0),x.render(E,u),x.setRenderTarget(n,1),x.render(E,c),x.setRenderTarget(n,2),x.render(E,h),x.setRenderTarget(n,3),x.render(E,p),x.setRenderTarget(n,4),x.render(E,g),n.texture.generateMipmaps=I,x.setRenderTarget(n,5),x.render(E,_),x.setRenderTarget(C),x.xr.enabled=S}}so.prototype=Object.create(gt.prototype),so.prototype.constructor=so;function ja(i,t,n,u,c,h,p,g,_,x){i=i!==void 0?i:[],t=t!==void 0?t:ul,p=p!==void 0?p:Bn,gi.call(this,i,t,n,u,c,h,p,g,_,x),this.flipY=!1,this._needsFlipEnvMap=!0}ja.prototype=Object.create(gi.prototype),ja.prototype.constructor=ja,ja.prototype.isCubeTexture=!0,Object.defineProperty(ja.prototype,"images",{get:function(){return this.image},set:function(i){this.image=i}});class z_ extends us{constructor(t,n,u){Number.isInteger(n)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),n=u),super(t,t,n),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),n=n||{},this.texture=new ja(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,n){this.texture.type=n.type,this.texture.format=fi,this.texture.encoding=n.encoding,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const u={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},c=new El(5,5,5),h=new _n({name:"CubemapFromEquirect",uniforms:no(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,side:je,blending:Jt});h.uniforms.tEquirect.value=n;const p=new Ii(c,h),g=n.minFilter;return n.minFilter===Pr&&(n.minFilter=qi),new so(1,10,this).update(t,p),n.minFilter=g,p.geometry.dispose(),p.material.dispose(),this}clear(t,n,u,c){const h=t.getRenderTarget();for(let p=0;p<6;p++)t.setRenderTarget(this,p),t.clear(n,u,c);t.setRenderTarget(h)}}function oo(i,t,n,u,c,h,p,g,_,x,E,S){gi.call(this,null,h,p,g,_,x,u,c,E,S),this.image={data:i||null,width:t||1,height:n||1},this.magFilter=_!==void 0?_:on,this.minFilter=x!==void 0?x:on,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}oo.prototype=Object.create(gi.prototype),oo.prototype.constructor=oo,oo.prototype.isDataTexture=!0;const lo=new sa,fc=new te;class pc{constructor(t,n,u,c,h,p){this.planes=[t!==void 0?t:new tr,n!==void 0?n:new tr,u!==void 0?u:new tr,c!==void 0?c:new tr,h!==void 0?h:new tr,p!==void 0?p:new tr]}set(t,n,u,c,h,p){const g=this.planes;return g[0].copy(t),g[1].copy(n),g[2].copy(u),g[3].copy(c),g[4].copy(h),g[5].copy(p),this}clone(){return new this.constructor().copy(this)}copy(t){const n=this.planes;for(let u=0;u<6;u++)n[u].copy(t.planes[u]);return this}setFromProjectionMatrix(t){const n=this.planes,u=t.elements,c=u[0],h=u[1],p=u[2],g=u[3],_=u[4],x=u[5],E=u[6],S=u[7],C=u[8],I=u[9],F=u[10],z=u[11],G=u[12],k=u[13],O=u[14],se=u[15];return n[0].setComponents(g-c,S-_,z-C,se-G).normalize(),n[1].setComponents(g+c,S+_,z+C,se+G).normalize(),n[2].setComponents(g+h,S+x,z+I,se+k).normalize(),n[3].setComponents(g-h,S-x,z-I,se-k).normalize(),n[4].setComponents(g-p,S-E,z-F,se-O).normalize(),n[5].setComponents(g+p,S+E,z+F,se+O).normalize(),this}intersectsObject(t){const n=t.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),lo.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(lo)}intersectsSprite(t){return lo.center.set(0,0,0),lo.radius=.7071067811865476,lo.applyMatrix4(t.matrixWorld),this.intersectsSphere(lo)}intersectsSphere(t){const n=this.planes,u=t.center,c=-t.radius;for(let h=0;h<6;h++)if(n[h].distanceToPoint(u)<c)return!1;return!0}intersectsBox(t){const n=this.planes;for(let u=0;u<6;u++){const c=n[u];if(fc.x=c.normal.x>0?t.max.x:t.min.x,fc.y=c.normal.y>0?t.max.y:t.min.y,fc.z=c.normal.z>0?t.max.z:t.min.z,c.distanceToPoint(fc)<0)return!1}return!0}containsPoint(t){const n=this.planes;for(let u=0;u<6;u++)if(n[u].distanceToPoint(t)<0)return!1;return!0}}function _m(){let i=null,t=!1,n=null,u=null;function c(h,p){n(h,p),u=i.requestAnimationFrame(c)}return{start:function(){t!==!0&&n!==null&&(u=i.requestAnimationFrame(c),t=!0)},stop:function(){i.cancelAnimationFrame(u),t=!1},setAnimationLoop:function(h){n=h},setContext:function(h){i=h}}}function W_(i,t){const n=t.isWebGL2,u=new WeakMap;function c(x,E){const S=x.array,C=x.usage,I=i.createBuffer();i.bindBuffer(E,I),i.bufferData(E,S,C),x.onUploadCallback();let F=5126;return S instanceof Float32Array?F=5126:S instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):S instanceof Uint16Array?x.isFloat16BufferAttribute?n?F=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):F=5123:S instanceof Int16Array?F=5122:S instanceof Uint32Array?F=5125:S instanceof Int32Array?F=5124:S instanceof Int8Array?F=5120:S instanceof Uint8Array&&(F=5121),{buffer:I,type:F,bytesPerElement:S.BYTES_PER_ELEMENT,version:x.version}}function h(x,E,S){const C=E.array,I=E.updateRange;i.bindBuffer(S,x),I.count===-1?i.bufferSubData(S,0,C):(n?i.bufferSubData(S,I.offset*C.BYTES_PER_ELEMENT,C,I.offset,I.count):i.bufferSubData(S,I.offset*C.BYTES_PER_ELEMENT,C.subarray(I.offset,I.offset+I.count)),I.count=-1)}function p(x){return x.isInterleavedBufferAttribute&&(x=x.data),u.get(x)}function g(x){x.isInterleavedBufferAttribute&&(x=x.data);const E=u.get(x);E&&(i.deleteBuffer(E.buffer),u.delete(x))}function _(x,E){if(x.isGLBufferAttribute){const C=u.get(x);(!C||C.version<x.version)&&u.set(x,{buffer:x.buffer,type:x.type,bytesPerElement:x.elementSize,version:x.version});return}x.isInterleavedBufferAttribute&&(x=x.data);const S=u.get(x);S===void 0?u.set(x,c(x,E)):S.version<x.version&&(h(S.buffer,x,E),S.version=x.version)}return{get:p,remove:g,update:_}}class j_ extends mi{constructor(t=1,n=1,u=1,c=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:n,widthSegments:u,heightSegments:c};const h=t/2,p=n/2,g=Math.floor(u),_=Math.floor(c),x=g+1,E=_+1,S=t/g,C=n/_,I=[],F=[],z=[],G=[];for(let k=0;k<E;k++){const O=k*C-p;for(let se=0;se<x;se++){const oe=se*S-h;F.push(oe,-O,0),z.push(0,0,1),G.push(se/g),G.push(1-k/_)}}for(let k=0;k<_;k++)for(let O=0;O<g;O++){const se=O+x*k,oe=O+x*(k+1),re=O+1+x*(k+1),X=O+1+x*k;I.push(se,oe,X),I.push(oe,re,X)}this.setIndex(I),this.setAttribute("position",new ki(F,3)),this.setAttribute("normal",new ki(z,3)),this.setAttribute("uv",new ki(G,2))}}var q_=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,X_=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Q_=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,Y_=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,K_=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Z_="vec3 transformed = vec3( position );",$_=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,J_=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,ex=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,tx=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,ix=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,nx=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,rx=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,ax=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,sx=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,ox=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,lx=`#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor.xyz *= color.xyz;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,ux=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cx=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,dx=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,hx=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,fx=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,px=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,mx=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,gx="gl_FragColor = linearToOutputTexel( gl_FragColor );",vx=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,yx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,_x=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,xx=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,bx=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Tx=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ax=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,Sx=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,wx=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Ex=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Mx=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Cx=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,Px=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Lx=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Ix=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,Dx=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,Rx=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Ox=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Fx=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,kx=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Bx=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,Nx=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Ux=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Hx=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,Vx=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Gx=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,zx=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Wx=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,jx=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,qx=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,Xx=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Qx=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Yx=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Kx=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Zx=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,$x=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,Jx=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,eb=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,tb=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,ib=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,nb=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,rb=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,ab=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,sb=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,ob=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,lb=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ub=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,cb=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,db=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,hb=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,fb=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,pb=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,mb=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,gb=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,vb=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,yb=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,_b=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,xb=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,bb=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Tb=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Ab=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Sb=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,wb=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Eb=`#ifdef USE_TRANSMISSIONMAP
	totalTransmission *= texture2D( transmissionMap, vUv ).r;
#endif`,Mb=`#ifdef USE_TRANSMISSIONMAP
	uniform sampler2D transmissionMap;
#endif`,Cb=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Pb=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Lb=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Ib=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Db=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Rb=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Ob=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,Fb=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,kb=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Bb=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Nb=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Ub=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Hb=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Vb=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Gb=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,zb=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Wb=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,jb=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,qb=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Xb=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Qb=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Yb=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Kb=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Zb=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$b=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Jb=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eT=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,tT=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iT=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nT=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSMISSION
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSMISSION
	uniform float transmission;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <transmissionmap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef TRANSMISSION
		float totalTransmission = transmission;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <transmissionmap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSMISSION
		diffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rT=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,aT=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,sT=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,oT=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lT=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,uT=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,cT=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dT=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,hT=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const Zt={alphamap_fragment:q_,alphamap_pars_fragment:X_,alphatest_fragment:Q_,aomap_fragment:Y_,aomap_pars_fragment:K_,begin_vertex:Z_,beginnormal_vertex:$_,bsdfs:J_,bumpmap_pars_fragment:ex,clipping_planes_fragment:tx,clipping_planes_pars_fragment:ix,clipping_planes_pars_vertex:nx,clipping_planes_vertex:rx,color_fragment:ax,color_pars_fragment:sx,color_pars_vertex:ox,color_vertex:lx,common:ux,cube_uv_reflection_fragment:cx,defaultnormal_vertex:dx,displacementmap_pars_vertex:hx,displacementmap_vertex:fx,emissivemap_fragment:px,emissivemap_pars_fragment:mx,encodings_fragment:gx,encodings_pars_fragment:vx,envmap_fragment:yx,envmap_common_pars_fragment:_x,envmap_pars_fragment:xx,envmap_pars_vertex:bx,envmap_physical_pars_fragment:Dx,envmap_vertex:Tx,fog_vertex:Ax,fog_pars_vertex:Sx,fog_fragment:wx,fog_pars_fragment:Ex,gradientmap_pars_fragment:Mx,lightmap_fragment:Cx,lightmap_pars_fragment:Px,lights_lambert_vertex:Lx,lights_pars_begin:Ix,lights_toon_fragment:Rx,lights_toon_pars_fragment:Ox,lights_phong_fragment:Fx,lights_phong_pars_fragment:kx,lights_physical_fragment:Bx,lights_physical_pars_fragment:Nx,lights_fragment_begin:Ux,lights_fragment_maps:Hx,lights_fragment_end:Vx,logdepthbuf_fragment:Gx,logdepthbuf_pars_fragment:zx,logdepthbuf_pars_vertex:Wx,logdepthbuf_vertex:jx,map_fragment:qx,map_pars_fragment:Xx,map_particle_fragment:Qx,map_particle_pars_fragment:Yx,metalnessmap_fragment:Kx,metalnessmap_pars_fragment:Zx,morphnormal_vertex:$x,morphtarget_pars_vertex:Jx,morphtarget_vertex:eb,normal_fragment_begin:tb,normal_fragment_maps:ib,normalmap_pars_fragment:nb,clearcoat_normal_fragment_begin:rb,clearcoat_normal_fragment_maps:ab,clearcoat_pars_fragment:sb,packing:ob,premultiplied_alpha_fragment:lb,project_vertex:ub,dithering_fragment:cb,dithering_pars_fragment:db,roughnessmap_fragment:hb,roughnessmap_pars_fragment:fb,shadowmap_pars_fragment:pb,shadowmap_pars_vertex:mb,shadowmap_vertex:gb,shadowmask_pars_fragment:vb,skinbase_vertex:yb,skinning_pars_vertex:_b,skinning_vertex:xb,skinnormal_vertex:bb,specularmap_fragment:Tb,specularmap_pars_fragment:Ab,tonemapping_fragment:Sb,tonemapping_pars_fragment:wb,transmissionmap_fragment:Eb,transmissionmap_pars_fragment:Mb,uv_pars_fragment:Cb,uv_pars_vertex:Pb,uv_vertex:Lb,uv2_pars_fragment:Ib,uv2_pars_vertex:Db,uv2_vertex:Rb,worldpos_vertex:Ob,background_frag:Fb,background_vert:kb,cube_frag:Bb,cube_vert:Nb,depth_frag:Ub,depth_vert:Hb,distanceRGBA_frag:Vb,distanceRGBA_vert:Gb,equirect_frag:zb,equirect_vert:Wb,linedashed_frag:jb,linedashed_vert:qb,meshbasic_frag:Xb,meshbasic_vert:Qb,meshlambert_frag:Yb,meshlambert_vert:Kb,meshmatcap_frag:Zb,meshmatcap_vert:$b,meshtoon_frag:Jb,meshtoon_vert:eT,meshphong_frag:tT,meshphong_vert:iT,meshphysical_frag:nT,meshphysical_vert:rT,normal_frag:aT,normal_vert:sT,points_frag:oT,points_vert:lT,shadow_frag:uT,shadow_vert:cT,sprite_frag:dT,sprite_vert:hT},ct={common:{diffuse:{value:new Mt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ji},uv2Transform:{value:new Ji},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new be(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Mt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Mt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ji}},sprite:{diffuse:{value:new Mt(15658734)},opacity:{value:1},center:{value:new be(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ji}}},kr={basic:{uniforms:hn([ct.common,ct.specularmap,ct.envmap,ct.aomap,ct.lightmap,ct.fog]),vertexShader:Zt.meshbasic_vert,fragmentShader:Zt.meshbasic_frag},lambert:{uniforms:hn([ct.common,ct.specularmap,ct.envmap,ct.aomap,ct.lightmap,ct.emissivemap,ct.fog,ct.lights,{emissive:{value:new Mt(0)}}]),vertexShader:Zt.meshlambert_vert,fragmentShader:Zt.meshlambert_frag},phong:{uniforms:hn([ct.common,ct.specularmap,ct.envmap,ct.aomap,ct.lightmap,ct.emissivemap,ct.bumpmap,ct.normalmap,ct.displacementmap,ct.fog,ct.lights,{emissive:{value:new Mt(0)},specular:{value:new Mt(1118481)},shininess:{value:30}}]),vertexShader:Zt.meshphong_vert,fragmentShader:Zt.meshphong_frag},standard:{uniforms:hn([ct.common,ct.envmap,ct.aomap,ct.lightmap,ct.emissivemap,ct.bumpmap,ct.normalmap,ct.displacementmap,ct.roughnessmap,ct.metalnessmap,ct.fog,ct.lights,{emissive:{value:new Mt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Zt.meshphysical_vert,fragmentShader:Zt.meshphysical_frag},toon:{uniforms:hn([ct.common,ct.aomap,ct.lightmap,ct.emissivemap,ct.bumpmap,ct.normalmap,ct.displacementmap,ct.gradientmap,ct.fog,ct.lights,{emissive:{value:new Mt(0)}}]),vertexShader:Zt.meshtoon_vert,fragmentShader:Zt.meshtoon_frag},matcap:{uniforms:hn([ct.common,ct.bumpmap,ct.normalmap,ct.displacementmap,ct.fog,{matcap:{value:null}}]),vertexShader:Zt.meshmatcap_vert,fragmentShader:Zt.meshmatcap_frag},points:{uniforms:hn([ct.points,ct.fog]),vertexShader:Zt.points_vert,fragmentShader:Zt.points_frag},dashed:{uniforms:hn([ct.common,ct.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zt.linedashed_vert,fragmentShader:Zt.linedashed_frag},depth:{uniforms:hn([ct.common,ct.displacementmap]),vertexShader:Zt.depth_vert,fragmentShader:Zt.depth_frag},normal:{uniforms:hn([ct.common,ct.bumpmap,ct.normalmap,ct.displacementmap,{opacity:{value:1}}]),vertexShader:Zt.normal_vert,fragmentShader:Zt.normal_frag},sprite:{uniforms:hn([ct.sprite,ct.fog]),vertexShader:Zt.sprite_vert,fragmentShader:Zt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ji},t2D:{value:null}},vertexShader:Zt.background_vert,fragmentShader:Zt.background_frag},cube:{uniforms:hn([ct.envmap,{opacity:{value:1}}]),vertexShader:Zt.cube_vert,fragmentShader:Zt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zt.equirect_vert,fragmentShader:Zt.equirect_frag},distanceRGBA:{uniforms:hn([ct.common,ct.displacementmap,{referencePosition:{value:new te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zt.distanceRGBA_vert,fragmentShader:Zt.distanceRGBA_frag},shadow:{uniforms:hn([ct.lights,ct.fog,{color:{value:new Mt(0)},opacity:{value:1}}]),vertexShader:Zt.shadow_vert,fragmentShader:Zt.shadow_frag}};kr.physical={uniforms:hn([kr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new be(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Mt(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Zt.meshphysical_vert,fragmentShader:Zt.meshphysical_frag};function fT(i,t,n,u,c){const h=new Mt(0);let p=0,g,_,x=null,E=0,S=null;function C(F,z,G,k){let O=z.isScene===!0?z.background:null;O&&O.isTexture&&(O=t.get(O));const se=i.xr,oe=se.getSession&&se.getSession();oe&&oe.environmentBlendMode==="additive"&&(O=null),O===null?I(h,p):O&&O.isColor&&(I(O,1),k=!0),(i.autoClear||k)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),O&&(O.isCubeTexture||O.isWebGLCubeRenderTarget||O.mapping===dl)?(_===void 0&&(_=new Ii(new El(1,1,1),new _n({name:"BackgroundCubeMaterial",uniforms:no(kr.cube.uniforms),vertexShader:kr.cube.vertexShader,fragmentShader:kr.cube.fragmentShader,side:je,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),_.geometry.deleteAttribute("uv"),_.onBeforeRender=function(re,X,me){this.matrixWorld.copyPosition(me.matrixWorld)},Object.defineProperty(_.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),u.update(_)),O.isWebGLCubeRenderTarget&&(O=O.texture),_.material.uniforms.envMap.value=O,_.material.uniforms.flipEnvMap.value=O.isCubeTexture&&O._needsFlipEnvMap?-1:1,(x!==O||E!==O.version||S!==i.toneMapping)&&(_.material.needsUpdate=!0,x=O,E=O.version,S=i.toneMapping),F.unshift(_,_.geometry,_.material,0,0,null)):O&&O.isTexture&&(g===void 0&&(g=new Ii(new j_(2,2),new _n({name:"BackgroundMaterial",uniforms:no(kr.background.uniforms),vertexShader:kr.background.vertexShader,fragmentShader:kr.background.fragmentShader,side:vt,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),u.update(g)),g.material.uniforms.t2D.value=O,O.matrixAutoUpdate===!0&&O.updateMatrix(),g.material.uniforms.uvTransform.value.copy(O.matrix),(x!==O||E!==O.version||S!==i.toneMapping)&&(g.material.needsUpdate=!0,x=O,E=O.version,S=i.toneMapping),F.unshift(g,g.geometry,g.material,0,0,null))}function I(F,z){n.buffers.color.setClear(F.r,F.g,F.b,z,c)}return{getClearColor:function(){return h},setClearColor:function(F,z=1){h.set(F),p=z,I(h,p)},getClearAlpha:function(){return p},setClearAlpha:function(F){p=F,I(h,p)},render:C}}function pT(i,t,n,u){const c=i.getParameter(34921),h=u.isWebGL2?null:t.get("OES_vertex_array_object"),p=u.isWebGL2||h!==null,g={},_=z(null);let x=_;function E(he,ce,pe,Te,He){let Xe=!1;if(p){const Qe=F(Te,pe,ce);x!==Qe&&(x=Qe,C(x.object)),Xe=G(Te,He),Xe&&k(Te,He)}else{const Qe=ce.wireframe===!0;(x.geometry!==Te.id||x.program!==pe.id||x.wireframe!==Qe)&&(x.geometry=Te.id,x.program=pe.id,x.wireframe=Qe,Xe=!0)}he.isInstancedMesh===!0&&(Xe=!0),He!==null&&n.update(He,34963),Xe&&(me(he,ce,pe,Te),He!==null&&i.bindBuffer(34963,n.get(He).buffer))}function S(){return u.isWebGL2?i.createVertexArray():h.createVertexArrayOES()}function C(he){return u.isWebGL2?i.bindVertexArray(he):h.bindVertexArrayOES(he)}function I(he){return u.isWebGL2?i.deleteVertexArray(he):h.deleteVertexArrayOES(he)}function F(he,ce,pe){const Te=pe.wireframe===!0;let He=g[he.id];He===void 0&&(He={},g[he.id]=He);let Xe=He[ce.id];Xe===void 0&&(Xe={},He[ce.id]=Xe);let Qe=Xe[Te];return Qe===void 0&&(Qe=z(S()),Xe[Te]=Qe),Qe}function z(he){const ce=[],pe=[],Te=[];for(let He=0;He<c;He++)ce[He]=0,pe[He]=0,Te[He]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ce,enabledAttributes:pe,attributeDivisors:Te,object:he,attributes:{},index:null}}function G(he,ce){const pe=x.attributes,Te=he.attributes;let He=0;for(const Xe in Te){const Qe=pe[Xe],lt=Te[Xe];if(Qe===void 0||Qe.attribute!==lt||Qe.data!==lt.data)return!0;He++}return x.attributesNum!==He||x.index!==ce}function k(he,ce){const pe={},Te=he.attributes;let He=0;for(const Xe in Te){const Qe=Te[Xe],lt={};lt.attribute=Qe,Qe.data&&(lt.data=Qe.data),pe[Xe]=lt,He++}x.attributes=pe,x.attributesNum=He,x.index=ce}function O(){const he=x.newAttributes;for(let ce=0,pe=he.length;ce<pe;ce++)he[ce]=0}function se(he){oe(he,0)}function oe(he,ce){const pe=x.newAttributes,Te=x.enabledAttributes,He=x.attributeDivisors;pe[he]=1,Te[he]===0&&(i.enableVertexAttribArray(he),Te[he]=1),He[he]!==ce&&((u.isWebGL2?i:t.get("ANGLE_instanced_arrays"))[u.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](he,ce),He[he]=ce)}function re(){const he=x.newAttributes,ce=x.enabledAttributes;for(let pe=0,Te=ce.length;pe<Te;pe++)ce[pe]!==he[pe]&&(i.disableVertexAttribArray(pe),ce[pe]=0)}function X(he,ce,pe,Te,He,Xe){u.isWebGL2===!0&&(pe===5124||pe===5125)?i.vertexAttribIPointer(he,ce,pe,He,Xe):i.vertexAttribPointer(he,ce,pe,Te,He,Xe)}function me(he,ce,pe,Te){if(u.isWebGL2===!1&&(he.isInstancedMesh||Te.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;O();const He=Te.attributes,Xe=pe.getAttributes(),Qe=ce.defaultAttributeValues;for(const lt in Xe){const rt=Xe[lt];if(rt>=0){const Et=He[lt];if(Et!==void 0){const Dt=Et.normalized,Ht=Et.itemSize,Ve=n.get(Et);if(Ve===void 0)continue;const zi=Ve.buffer,It=Ve.type,qt=Ve.bytesPerElement;if(Et.isInterleavedBufferAttribute){const Rt=Et.data,ti=Rt.stride,kt=Et.offset;Rt&&Rt.isInstancedInterleavedBuffer?(oe(rt,Rt.meshPerAttribute),Te._maxInstanceCount===void 0&&(Te._maxInstanceCount=Rt.meshPerAttribute*Rt.count)):se(rt),i.bindBuffer(34962,zi),X(rt,Ht,It,Dt,ti*qt,kt*qt)}else Et.isInstancedBufferAttribute?(oe(rt,Et.meshPerAttribute),Te._maxInstanceCount===void 0&&(Te._maxInstanceCount=Et.meshPerAttribute*Et.count)):se(rt),i.bindBuffer(34962,zi),X(rt,Ht,It,Dt,0,0)}else if(lt==="instanceMatrix"){const Dt=n.get(he.instanceMatrix);if(Dt===void 0)continue;const Ht=Dt.buffer,Ve=Dt.type;oe(rt+0,1),oe(rt+1,1),oe(rt+2,1),oe(rt+3,1),i.bindBuffer(34962,Ht),i.vertexAttribPointer(rt+0,4,Ve,!1,64,0),i.vertexAttribPointer(rt+1,4,Ve,!1,64,16),i.vertexAttribPointer(rt+2,4,Ve,!1,64,32),i.vertexAttribPointer(rt+3,4,Ve,!1,64,48)}else if(lt==="instanceColor"){const Dt=n.get(he.instanceColor);if(Dt===void 0)continue;const Ht=Dt.buffer,Ve=Dt.type;oe(rt,1),i.bindBuffer(34962,Ht),i.vertexAttribPointer(rt,3,Ve,!1,12,0)}else if(Qe!==void 0){const Dt=Qe[lt];if(Dt!==void 0)switch(Dt.length){case 2:i.vertexAttrib2fv(rt,Dt);break;case 3:i.vertexAttrib3fv(rt,Dt);break;case 4:i.vertexAttrib4fv(rt,Dt);break;default:i.vertexAttrib1fv(rt,Dt)}}}}re()}function ke(){we();for(const he in g){const ce=g[he];for(const pe in ce){const Te=ce[pe];for(const He in Te)I(Te[He].object),delete Te[He];delete ce[pe]}delete g[he]}}function xe(he){if(g[he.id]===void 0)return;const ce=g[he.id];for(const pe in ce){const Te=ce[pe];for(const He in Te)I(Te[He].object),delete Te[He];delete ce[pe]}delete g[he.id]}function Se(he){for(const ce in g){const pe=g[ce];if(pe[he.id]===void 0)continue;const Te=pe[he.id];for(const He in Te)I(Te[He].object),delete Te[He];delete pe[he.id]}}function we(){Re(),x!==_&&(x=_,C(x.object))}function Re(){_.geometry=null,_.program=null,_.wireframe=!1}return{setup:E,reset:we,resetDefaultState:Re,dispose:ke,releaseStatesOfGeometry:xe,releaseStatesOfProgram:Se,initAttributes:O,enableAttribute:se,disableUnusedAttributes:re}}function mT(i,t,n,u){const c=u.isWebGL2;let h;function p(x){h=x}function g(x,E){i.drawArrays(h,x,E),n.update(E,h,1)}function _(x,E,S){if(S===0)return;let C,I;if(c)C=i,I="drawArraysInstanced";else if(C=t.get("ANGLE_instanced_arrays"),I="drawArraysInstancedANGLE",C===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}C[I](h,x,E,S),n.update(E,h,S)}this.setMode=p,this.render=g,this.renderInstances=_}function gT(i,t,n){let u;function c(){if(u!==void 0)return u;const X=t.get("EXT_texture_filter_anisotropic");return X!==null?u=i.getParameter(X.MAX_TEXTURE_MAX_ANISOTROPY_EXT):u=0,u}function h(X){if(X==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";X="mediump"}return X==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const p=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let g=n.precision!==void 0?n.precision:"highp";const _=h(g);_!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",_,"instead."),g=_);const x=n.logarithmicDepthBuffer===!0,E=i.getParameter(34930),S=i.getParameter(35660),C=i.getParameter(3379),I=i.getParameter(34076),F=i.getParameter(34921),z=i.getParameter(36347),G=i.getParameter(36348),k=i.getParameter(36349),O=S>0,se=p||!!t.get("OES_texture_float"),oe=O&&se,re=p?i.getParameter(36183):0;return{isWebGL2:p,getMaxAnisotropy:c,getMaxPrecision:h,precision:g,logarithmicDepthBuffer:x,maxTextures:E,maxVertexTextures:S,maxTextureSize:C,maxCubemapSize:I,maxAttributes:F,maxVertexUniforms:z,maxVaryings:G,maxFragmentUniforms:k,vertexTextures:O,floatFragmentTextures:se,floatVertexTextures:oe,maxSamples:re}}function vT(i){const t=this;let n=null,u=0,c=!1,h=!1;const p=new tr,g=new Ji,_={value:null,needsUpdate:!1};this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(S,C,I){const F=S.length!==0||C||u!==0||c;return c=C,n=E(S,I,0),u=S.length,F},this.beginShadows=function(){h=!0,E(null)},this.endShadows=function(){h=!1,x()},this.setState=function(S,C,I){const F=S.clippingPlanes,z=S.clipIntersection,G=S.clipShadows,k=i.get(S);if(!c||F===null||F.length===0||h&&!G)h?E(null):x();else{const O=h?0:u,se=O*4;let oe=k.clippingState||null;_.value=oe,oe=E(F,C,se,I);for(let re=0;re!==se;++re)oe[re]=n[re];k.clippingState=oe,this.numIntersection=z?this.numPlanes:0,this.numPlanes+=O}};function x(){_.value!==n&&(_.value=n,_.needsUpdate=u>0),t.numPlanes=u,t.numIntersection=0}function E(S,C,I,F){const z=S!==null?S.length:0;let G=null;if(z!==0){if(G=_.value,F!==!0||G===null){const k=I+z*4,O=C.matrixWorldInverse;g.getNormalMatrix(O),(G===null||G.length<k)&&(G=new Float32Array(k));for(let se=0,oe=I;se!==z;++se,oe+=4)p.copy(S[se]).applyMatrix4(O,g),p.normal.toArray(G,oe),G[oe+3]=p.constant}_.value=G,_.needsUpdate=!0}return t.numPlanes=z,t.numIntersection=0,G}}function yT(i){let t=new WeakMap;function n(p,g){return g===ns?p.mapping=ul:g===Ou&&(p.mapping=cl),p}function u(p){if(p&&p.isTexture){const g=p.mapping;if(g===ns||g===Ou)if(t.has(p)){const _=t.get(p).texture;return n(_,p.mapping)}else{const _=p.image;if(_&&_.height>0){const x=i.getRenderList(),E=i.getRenderTarget(),S=new z_(_.height/2);return S.fromEquirectangularTexture(i,p),t.set(p,S),i.setRenderTarget(E),i.setRenderList(x),p.addEventListener("dispose",c),n(S.texture,p.mapping)}else return null}}return p}function c(p){const g=p.target;g.removeEventListener("dispose",c);const _=t.get(g);_!==void 0&&(t.delete(g),_.dispose())}function h(){t=new WeakMap}return{get:u,dispose:h}}function _T(i){const t={};function n(u){if(t[u]!==void 0)return t[u];let c;switch(u){case"WEBGL_depth_texture":c=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":c=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":c=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":c=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:c=i.getExtension(u)}return t[u]=c,c}return{has:function(u){return n(u)!==null},init:function(u){u.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(u){const c=n(u);return c===null&&console.warn("THREE.WebGLRenderer: "+u+" extension not supported."),c}}}function xT(i,t,n,u){const c={},h=new WeakMap;function p(S){const C=S.target;C.index!==null&&t.remove(C.index);for(const F in C.attributes)t.remove(C.attributes[F]);C.removeEventListener("dispose",p),delete c[C.id];const I=h.get(C);I&&(t.remove(I),h.delete(C)),u.releaseStatesOfGeometry(C),C.isInstancedBufferGeometry===!0&&delete C._maxInstanceCount,n.memory.geometries--}function g(S,C){return c[C.id]===!0||(C.addEventListener("dispose",p),c[C.id]=!0,n.memory.geometries++),C}function _(S){const C=S.attributes;for(const F in C)t.update(C[F],34962);const I=S.morphAttributes;for(const F in I){const z=I[F];for(let G=0,k=z.length;G<k;G++)t.update(z[G],34962)}}function x(S){const C=[],I=S.index,F=S.attributes.position;let z=0;if(I!==null){const O=I.array;z=I.version;for(let se=0,oe=O.length;se<oe;se+=3){const re=O[se+0],X=O[se+1],me=O[se+2];C.push(re,X,X,me,me,re)}}else{const O=F.array;z=F.version;for(let se=0,oe=O.length/3-1;se<oe;se+=3){const re=se+0,X=se+1,me=se+2;C.push(re,X,X,me,me,re)}}const G=new(vm(C)>65535?Sl:Al)(C,1);G.version=z;const k=h.get(S);k&&t.remove(k),h.set(S,G)}function E(S){const C=h.get(S);if(C){const I=S.index;I!==null&&C.version<I.version&&x(S)}else x(S);return h.get(S)}return{get:g,update:_,getWireframeAttribute:E}}function bT(i,t,n,u){const c=u.isWebGL2;let h;function p(C){h=C}let g,_;function x(C){g=C.type,_=C.bytesPerElement}function E(C,I){i.drawElements(h,I,g,C*_),n.update(I,h,1)}function S(C,I,F){if(F===0)return;let z,G;if(c)z=i,G="drawElementsInstanced";else if(z=t.get("ANGLE_instanced_arrays"),G="drawElementsInstancedANGLE",z===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}z[G](h,I,g,C*_,F),n.update(I,h,F)}this.setMode=p,this.setIndex=x,this.render=E,this.renderInstances=S}function TT(i){const t={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function u(h,p,g){switch(n.calls++,p){case 4:n.triangles+=g*(h/3);break;case 1:n.lines+=g*(h/2);break;case 3:n.lines+=g*(h-1);break;case 2:n.lines+=g*h;break;case 0:n.points+=g*h;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",p);break}}function c(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:t,render:n,programs:null,autoReset:!0,reset:c,update:u}}function AT(i,t){return i[0]-t[0]}function ST(i,t){return Math.abs(t[1])-Math.abs(i[1])}function wT(i){const t={},n=new Float32Array(8),u=[];for(let h=0;h<8;h++)u[h]=[h,0];function c(h,p,g,_){const x=h.morphTargetInfluences,E=x===void 0?0:x.length;let S=t[p.id];if(S===void 0){S=[];for(let G=0;G<E;G++)S[G]=[G,0];t[p.id]=S}for(let G=0;G<E;G++){const k=S[G];k[0]=G,k[1]=x[G]}S.sort(ST);for(let G=0;G<8;G++)G<E&&S[G][1]?(u[G][0]=S[G][0],u[G][1]=S[G][1]):(u[G][0]=Number.MAX_SAFE_INTEGER,u[G][1]=0);u.sort(AT);const C=g.morphTargets&&p.morphAttributes.position,I=g.morphNormals&&p.morphAttributes.normal;let F=0;for(let G=0;G<8;G++){const k=u[G],O=k[0],se=k[1];O!==Number.MAX_SAFE_INTEGER&&se?(C&&p.getAttribute("morphTarget"+G)!==C[O]&&p.setAttribute("morphTarget"+G,C[O]),I&&p.getAttribute("morphNormal"+G)!==I[O]&&p.setAttribute("morphNormal"+G,I[O]),n[G]=se,F+=se):(C&&p.hasAttribute("morphTarget"+G)===!0&&p.deleteAttribute("morphTarget"+G),I&&p.hasAttribute("morphNormal"+G)===!0&&p.deleteAttribute("morphNormal"+G),n[G]=0)}const z=p.morphTargetsRelative?1:1-F;_.getUniforms().setValue(i,"morphTargetBaseInfluence",z),_.getUniforms().setValue(i,"morphTargetInfluences",n)}return{update:c}}function ET(i,t,n,u){let c=new WeakMap;function h(_){const x=u.render.frame,E=_.geometry,S=t.get(_,E);return c.get(S)!==x&&(t.update(S),c.set(S,x)),_.isInstancedMesh&&(_.hasEventListener("dispose",g)===!1&&_.addEventListener("dispose",g),n.update(_.instanceMatrix,34962),_.instanceColor!==null&&n.update(_.instanceColor,34962)),S}function p(){c=new WeakMap}function g(_){const x=_.target;x.removeEventListener("dispose",g),n.remove(x.instanceMatrix),x.instanceColor!==null&&n.remove(x.instanceColor)}return{update:h,dispose:p}}function Ml(i=null,t=1,n=1,u=1){gi.call(this,null),this.image={data:i,width:t,height:n,depth:u},this.magFilter=on,this.minFilter=on,this.wrapR=Ai,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Ml.prototype=Object.create(gi.prototype),Ml.prototype.constructor=Ml,Ml.prototype.isDataTexture2DArray=!0;function Cl(i=null,t=1,n=1,u=1){gi.call(this,null),this.image={data:i,width:t,height:n,depth:u},this.magFilter=on,this.minFilter=on,this.wrapR=Ai,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Cl.prototype=Object.create(gi.prototype),Cl.prototype.constructor=Cl,Cl.prototype.isDataTexture3D=!0;const xm=new gi,MT=new Ml,CT=new Cl,bm=new ja,Tm=[],Am=[],Sm=new Float32Array(16),wm=new Float32Array(9),Em=new Float32Array(4);function uo(i,t,n){const u=i[0];if(u<=0||u>0)return i;const c=t*n;let h=Tm[c];if(h===void 0&&(h=new Float32Array(c),Tm[c]=h),t!==0){u.toArray(h,0);for(let p=1,g=0;p!==t;++p)g+=n,i[p].toArray(h,g)}return h}function ir(i,t){if(i.length!==t.length)return!1;for(let n=0,u=i.length;n<u;n++)if(i[n]!==t[n])return!1;return!0}function Gn(i,t){for(let n=0,u=t.length;n<u;n++)i[n]=t[n]}function Mm(i,t){let n=Am[t];n===void 0&&(n=new Int32Array(t),Am[t]=n);for(let u=0;u!==t;++u)n[u]=i.allocateTextureUnit();return n}function PT(i,t){const n=this.cache;n[0]!==t&&(i.uniform1f(this.addr,t),n[0]=t)}function LT(i,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y)&&(i.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(ir(n,t))return;i.uniform2fv(this.addr,t),Gn(n,t)}}function IT(i,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(i.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(t.r!==void 0)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(i.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(ir(n,t))return;i.uniform3fv(this.addr,t),Gn(n,t)}}function DT(i,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(i.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(ir(n,t))return;i.uniform4fv(this.addr,t),Gn(n,t)}}function RT(i,t){const n=this.cache,u=t.elements;if(u===void 0){if(ir(n,t))return;i.uniformMatrix2fv(this.addr,!1,t),Gn(n,t)}else{if(ir(n,u))return;Em.set(u),i.uniformMatrix2fv(this.addr,!1,Em),Gn(n,u)}}function OT(i,t){const n=this.cache,u=t.elements;if(u===void 0){if(ir(n,t))return;i.uniformMatrix3fv(this.addr,!1,t),Gn(n,t)}else{if(ir(n,u))return;wm.set(u),i.uniformMatrix3fv(this.addr,!1,wm),Gn(n,u)}}function FT(i,t){const n=this.cache,u=t.elements;if(u===void 0){if(ir(n,t))return;i.uniformMatrix4fv(this.addr,!1,t),Gn(n,t)}else{if(ir(n,u))return;Sm.set(u),i.uniformMatrix4fv(this.addr,!1,Sm),Gn(n,u)}}function kT(i,t,n){const u=this.cache,c=n.allocateTextureUnit();u[0]!==c&&(i.uniform1i(this.addr,c),u[0]=c),n.safeSetTexture2D(t||xm,c)}function BT(i,t,n){const u=this.cache,c=n.allocateTextureUnit();u[0]!==c&&(i.uniform1i(this.addr,c),u[0]=c),n.setTexture2DArray(t||MT,c)}function NT(i,t,n){const u=this.cache,c=n.allocateTextureUnit();u[0]!==c&&(i.uniform1i(this.addr,c),u[0]=c),n.setTexture3D(t||CT,c)}function UT(i,t,n){const u=this.cache,c=n.allocateTextureUnit();u[0]!==c&&(i.uniform1i(this.addr,c),u[0]=c),n.safeSetTextureCube(t||bm,c)}function HT(i,t){const n=this.cache;n[0]!==t&&(i.uniform1i(this.addr,t),n[0]=t)}function VT(i,t){const n=this.cache;ir(n,t)||(i.uniform2iv(this.addr,t),Gn(n,t))}function GT(i,t){const n=this.cache;ir(n,t)||(i.uniform3iv(this.addr,t),Gn(n,t))}function zT(i,t){const n=this.cache;ir(n,t)||(i.uniform4iv(this.addr,t),Gn(n,t))}function WT(i,t){const n=this.cache;n[0]!==t&&(i.uniform1ui(this.addr,t),n[0]=t)}function jT(i){switch(i){case 5126:return PT;case 35664:return LT;case 35665:return IT;case 35666:return DT;case 35674:return RT;case 35675:return OT;case 35676:return FT;case 5124:case 35670:return HT;case 35667:case 35671:return VT;case 35668:case 35672:return GT;case 35669:case 35673:return zT;case 5125:return WT;case 35678:case 36198:case 36298:case 36306:case 35682:return kT;case 35679:case 36299:case 36307:return NT;case 35680:case 36300:case 36308:case 36293:return UT;case 36289:case 36303:case 36311:case 36292:return BT}}function qT(i,t){i.uniform1fv(this.addr,t)}function XT(i,t){i.uniform1iv(this.addr,t)}function QT(i,t){i.uniform2iv(this.addr,t)}function YT(i,t){i.uniform3iv(this.addr,t)}function KT(i,t){i.uniform4iv(this.addr,t)}function ZT(i,t){const n=uo(t,this.size,2);i.uniform2fv(this.addr,n)}function $T(i,t){const n=uo(t,this.size,3);i.uniform3fv(this.addr,n)}function JT(i,t){const n=uo(t,this.size,4);i.uniform4fv(this.addr,n)}function eA(i,t){const n=uo(t,this.size,4);i.uniformMatrix2fv(this.addr,!1,n)}function tA(i,t){const n=uo(t,this.size,9);i.uniformMatrix3fv(this.addr,!1,n)}function iA(i,t){const n=uo(t,this.size,16);i.uniformMatrix4fv(this.addr,!1,n)}function nA(i,t,n){const u=t.length,c=Mm(n,u);i.uniform1iv(this.addr,c);for(let h=0;h!==u;++h)n.safeSetTexture2D(t[h]||xm,c[h])}function rA(i,t,n){const u=t.length,c=Mm(n,u);i.uniform1iv(this.addr,c);for(let h=0;h!==u;++h)n.safeSetTextureCube(t[h]||bm,c[h])}function aA(i){switch(i){case 5126:return qT;case 35664:return ZT;case 35665:return $T;case 35666:return JT;case 35674:return eA;case 35675:return tA;case 35676:return iA;case 5124:case 35670:return XT;case 35667:case 35671:return QT;case 35668:case 35672:return YT;case 35669:case 35673:return KT;case 35678:case 36198:case 36298:case 36306:case 35682:return nA;case 35680:case 36300:case 36308:case 36293:return rA}}function sA(i,t,n){this.id=i,this.addr=n,this.cache=[],this.setValue=jT(t.type)}function Cm(i,t,n){this.id=i,this.addr=n,this.cache=[],this.size=t.size,this.setValue=aA(t.type)}Cm.prototype.updateCache=function(i){const t=this.cache;i instanceof Float32Array&&t.length!==i.length&&(this.cache=new Float32Array(i.length)),Gn(t,i)};function Pm(i){this.id=i,this.seq=[],this.map={}}Pm.prototype.setValue=function(i,t,n){const u=this.seq;for(let c=0,h=u.length;c!==h;++c){const p=u[c];p.setValue(i,t[p.id],n)}};const Gh=/(\w+)(\])?(\[|\.)?/g;function Lm(i,t){i.seq.push(t),i.map[t.id]=t}function oA(i,t,n){const u=i.name,c=u.length;for(Gh.lastIndex=0;;){const h=Gh.exec(u),p=Gh.lastIndex;let g=h[1];const _=h[2]==="]",x=h[3];if(_&&(g=g|0),x===void 0||x==="["&&p+2===c){Lm(n,x===void 0?new sA(g,i,t):new Cm(g,i,t));break}else{let S=n.map[g];S===void 0&&(S=new Pm(g),Lm(n,S)),n=S}}}function qa(i,t){this.seq=[],this.map={};const n=i.getProgramParameter(t,35718);for(let u=0;u<n;++u){const c=i.getActiveUniform(t,u),h=i.getUniformLocation(t,c.name);oA(c,h,this)}}qa.prototype.setValue=function(i,t,n,u){const c=this.map[t];c!==void 0&&c.setValue(i,n,u)},qa.prototype.setOptional=function(i,t,n){const u=t[n];u!==void 0&&this.setValue(i,n,u)},qa.upload=function(i,t,n,u){for(let c=0,h=t.length;c!==h;++c){const p=t[c],g=n[p.id];g.needsUpdate!==!1&&p.setValue(i,g.value,u)}},qa.seqWithValue=function(i,t){const n=[];for(let u=0,c=i.length;u!==c;++u){const h=i[u];h.id in t&&n.push(h)}return n};function Im(i,t,n){const u=i.createShader(t);return i.shaderSource(u,n),i.compileShader(u),u}let lA=0;function uA(i){const t=i.split(`
`);for(let n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join(`
`)}function Dm(i){switch(i){case ls:return["Linear","( value )"];case Ku:return["sRGB","( value )"];case mh:return["RGBE","( value )"];case gh:return["RGBM","( value, 7.0 )"];case vh:return["RGBM","( value, 16.0 )"];case yi:return["RGBD","( value, 256.0 )"];case Xs:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ia:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function Rm(i,t,n){const u=i.getShaderParameter(t,35713),c=i.getShaderInfoLog(t).trim();if(u&&c==="")return"";const h=i.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+`
`+c+uA(h)}function Pl(i,t){const n=Dm(t);return"vec4 "+i+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function cA(i,t){const n=Dm(t);return"vec4 "+i+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function dA(i,t){let n;switch(t){case Iu:n="Linear";break;case Du:n="Reinhard";break;case ai:n="OptimizedCineon";break;case Vd:n="ACESFilmic";break;case Gd:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+i+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function hA(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ll).join(`
`)}function fA(i){const t=[];for(const n in i){const u=i[n];u!==!1&&t.push("#define "+n+" "+u)}return t.join(`
`)}function pA(i,t){const n={},u=i.getProgramParameter(t,35721);for(let c=0;c<u;c++){const p=i.getActiveAttrib(t,c).name;n[p]=i.getAttribLocation(t,p)}return n}function Ll(i){return i!==""}function Om(i,t){return i.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Fm(i,t){return i.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const mA=/^[ \t]*#include +<([\w\d./]+)>/gm;function zh(i){return i.replace(mA,gA)}function gA(i,t){const n=Zt[t];if(n===void 0)throw new Error("Can not resolve #include <"+t+">");return zh(n)}const vA=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,yA=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function km(i){return i.replace(yA,Bm).replace(vA,_A)}function _A(i,t,n,u){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Bm(i,t,n,u)}function Bm(i,t,n,u){let c="";for(let h=parseInt(t);h<parseInt(n);h++)c+=u.replace(/\[\s*i\s*\]/g,"[ "+h+" ]").replace(/UNROLLED_LOOP_INDEX/g,h);return c}function Nm(i){let t="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?t+=`
#define HIGH_PRECISION`:i.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function xA(i){let t="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Ee?t="SHADOWMAP_TYPE_PCF":i.shadowMapType===We?t="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Ce&&(t="SHADOWMAP_TYPE_VSM"),t}function bA(i){let t="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case ul:case cl:t="ENVMAP_TYPE_CUBE";break;case dl:case hl:t="ENVMAP_TYPE_CUBE_UV";break}return t}function TA(i){let t="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case cl:case hl:t="ENVMAP_MODE_REFRACTION";break}return t}function AA(i){let t="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case La:t="ENVMAP_BLENDING_MULTIPLY";break;case Rs:t="ENVMAP_BLENDING_MIX";break;case ll:t="ENVMAP_BLENDING_ADD";break}return t}function SA(i,t,n,u){const c=i.getContext(),h=n.defines;let p=n.vertexShader,g=n.fragmentShader;const _=xA(n),x=bA(n),E=TA(n),S=AA(n),C=i.gammaFactor>0?i.gammaFactor:1,I=n.isWebGL2?"":hA(n),F=fA(h),z=c.createProgram();let G,k,O=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(G=[F].filter(Ll).join(`
`),G.length>0&&(G+=`
`),k=[I,F].filter(Ll).join(`
`),k.length>0&&(k+=`
`)):(G=[Nm(n),"#define SHADER_NAME "+n.shaderName,F,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+C,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+E:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+_:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ll).join(`
`),k=[I,Nm(n),"#define SHADER_NAME "+n.shaderName,F,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+C,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+x:"",n.envMap?"#define "+E:"",n.envMap?"#define "+S:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+_:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ia?"#define TONE_MAPPING":"",n.toneMapping!==Ia?Zt.tonemapping_pars_fragment:"",n.toneMapping!==Ia?dA("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Zt.encodings_pars_fragment,n.map?Pl("mapTexelToLinear",n.mapEncoding):"",n.matcap?Pl("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Pl("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Pl("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Pl("lightMapTexelToLinear",n.lightMapEncoding):"",cA("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Ll).join(`
`)),p=zh(p),p=Om(p,n),p=Fm(p,n),g=zh(g),g=Om(g,n),g=Fm(g,n),p=km(p),g=km(g),n.isWebGL2&&n.isRawShaderMaterial!==!0&&(O=`#version 300 es
`,G=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+G,k=["#define varying in",n.glslVersion===Ju?"":"out highp vec4 pc_fragColor;",n.glslVersion===Ju?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+k);const se=O+G+p,oe=O+k+g,re=Im(c,35633,se),X=Im(c,35632,oe);if(c.attachShader(z,re),c.attachShader(z,X),n.index0AttributeName!==void 0?c.bindAttribLocation(z,0,n.index0AttributeName):n.morphTargets===!0&&c.bindAttribLocation(z,0,"position"),c.linkProgram(z),i.debug.checkShaderErrors){const xe=c.getProgramInfoLog(z).trim(),Se=c.getShaderInfoLog(re).trim(),we=c.getShaderInfoLog(X).trim();let Re=!0,he=!0;if(c.getProgramParameter(z,35714)===!1){Re=!1;const ce=Rm(c,re,"vertex"),pe=Rm(c,X,"fragment");console.error("THREE.WebGLProgram: shader error: ",c.getError(),"35715",c.getProgramParameter(z,35715),"gl.getProgramInfoLog",xe,ce,pe)}else xe!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",xe):(Se===""||we==="")&&(he=!1);he&&(this.diagnostics={runnable:Re,programLog:xe,vertexShader:{log:Se,prefix:G},fragmentShader:{log:we,prefix:k}})}c.deleteShader(re),c.deleteShader(X);let me;this.getUniforms=function(){return me===void 0&&(me=new qa(c,z)),me};let ke;return this.getAttributes=function(){return ke===void 0&&(ke=pA(c,z)),ke},this.destroy=function(){u.releaseStatesOfProgram(this),c.deleteProgram(z),this.program=void 0},this.name=n.shaderName,this.id=lA++,this.cacheKey=t,this.usedTimes=1,this.program=z,this.vertexShader=re,this.fragmentShader=X,this}function wA(i,t,n,u,c,h){const p=[],g=u.isWebGL2,_=u.logarithmicDepthBuffer,x=u.floatVertexTextures,E=u.maxVertexUniforms,S=u.vertexTextures;let C=u.precision;const I={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},F=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function z(X){const ke=X.skeleton.bones;if(x)return 1024;{const Se=Math.floor((E-20)/4),we=Math.min(Se,ke.length);return we<ke.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ke.length+" bones. This GPU supports "+we+"."),0):we}}function G(X){let me;return X&&X.isTexture?me=X.encoding:X&&X.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),me=X.texture.encoding):me=ls,me}function k(X,me,ke,xe,Se){const we=xe.fog,Re=X.isMeshStandardMaterial?xe.environment:null,he=t.get(X.envMap||Re),ce=I[X.type],pe=Se.isSkinnedMesh?z(Se):0;X.precision!==null&&(C=u.getMaxPrecision(X.precision),C!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",C,"instead."));let Te,He;if(ce){const lt=kr[ce];Te=lt.vertexShader,He=lt.fragmentShader}else Te=X.vertexShader,He=X.fragmentShader;const Xe=i.getRenderTarget();return{isWebGL2:g,shaderID:ce,shaderName:X.type,vertexShader:Te,fragmentShader:He,defines:X.defines,isRawShaderMaterial:X.isRawShaderMaterial===!0,glslVersion:X.glslVersion,precision:C,instancing:Se.isInstancedMesh===!0,instancingColor:Se.isInstancedMesh===!0&&Se.instanceColor!==null,supportsVertexTextures:S,outputEncoding:Xe!==null?G(Xe.texture):i.outputEncoding,map:!!X.map,mapEncoding:G(X.map),matcap:!!X.matcap,matcapEncoding:G(X.matcap),envMap:!!he,envMapMode:he&&he.mapping,envMapEncoding:G(he),envMapCubeUV:!!he&&(he.mapping===dl||he.mapping===hl),lightMap:!!X.lightMap,lightMapEncoding:G(X.lightMap),aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,emissiveMapEncoding:G(X.emissiveMap),bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:X.normalMapType===Zu,tangentSpaceNormalMap:X.normalMapType===Fa,clearcoatMap:!!X.clearcoatMap,clearcoatRoughnessMap:!!X.clearcoatRoughnessMap,clearcoatNormalMap:!!X.clearcoatNormalMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,alphaMap:!!X.alphaMap,gradientMap:!!X.gradientMap,sheen:!!X.sheen,transmissionMap:!!X.transmissionMap,combine:X.combine,vertexTangents:X.normalMap&&X.vertexTangents,vertexColors:X.vertexColors,vertexUvs:!!X.map||!!X.bumpMap||!!X.normalMap||!!X.specularMap||!!X.alphaMap||!!X.emissiveMap||!!X.roughnessMap||!!X.metalnessMap||!!X.clearcoatMap||!!X.clearcoatRoughnessMap||!!X.clearcoatNormalMap||!!X.displacementMap||!!X.transmissionMap,uvsVertexOnly:!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatNormalMap||X.transmissionMap)&&!!X.displacementMap,fog:!!we,useFog:X.fog,fogExp2:we&&we.isFogExp2,flatShading:X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:_,skinning:X.skinning&&pe>0,maxBones:pe,useVertexTexture:x,morphTargets:X.morphTargets,morphNormals:X.morphNormals,maxMorphTargets:i.maxMorphTargets,maxMorphNormals:i.maxMorphNormals,numDirLights:me.directional.length,numPointLights:me.point.length,numSpotLights:me.spot.length,numRectAreaLights:me.rectArea.length,numHemiLights:me.hemi.length,numDirLightShadows:me.directionalShadowMap.length,numPointLightShadows:me.pointShadowMap.length,numSpotLightShadows:me.spotShadowMap.length,numClippingPlanes:h.numPlanes,numClipIntersection:h.numIntersection,dithering:X.dithering,shadowMapEnabled:i.shadowMap.enabled&&ke.length>0,shadowMapType:i.shadowMap.type,toneMapping:X.toneMapped?i.toneMapping:Ia,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,alphaTest:X.alphaTest,doubleSided:X.side===ut,flipSided:X.side===je,depthPacking:X.depthPacking!==void 0?X.depthPacking:!1,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||n.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}}function O(X){const me=[];if(X.shaderID?me.push(X.shaderID):(me.push(X.fragmentShader),me.push(X.vertexShader)),X.defines!==void 0)for(const ke in X.defines)me.push(ke),me.push(X.defines[ke]);if(X.isRawShaderMaterial===!1){for(let ke=0;ke<F.length;ke++)me.push(X[F[ke]]);me.push(i.outputEncoding),me.push(i.gammaFactor)}return me.push(X.customProgramCacheKey),me.join()}function se(X){const me=I[X.type];let ke;if(me){const xe=kr[me];ke=H_.clone(xe.uniforms)}else ke=X.uniforms;return ke}function oe(X,me){let ke;for(let xe=0,Se=p.length;xe<Se;xe++){const we=p[xe];if(we.cacheKey===me){ke=we,++ke.usedTimes;break}}return ke===void 0&&(ke=new SA(i,me,X,c),p.push(ke)),ke}function re(X){if(--X.usedTimes===0){const me=p.indexOf(X);p[me]=p[p.length-1],p.pop(),X.destroy()}}return{getParameters:k,getProgramCacheKey:O,getUniforms:se,acquireProgram:oe,releaseProgram:re,programs:p}}function EA(){let i=new WeakMap;function t(h){let p=i.get(h);return p===void 0&&(p={},i.set(h,p)),p}function n(h){i.delete(h)}function u(h,p,g){i.get(h)[p]=g}function c(){i=new WeakMap}return{get:t,remove:n,update:u,dispose:c}}function MA(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.program!==t.program?i.program.id-t.program.id:i.material.id!==t.material.id?i.material.id-t.material.id:i.z!==t.z?i.z-t.z:i.id-t.id}function CA(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.z!==t.z?t.z-i.z:i.id-t.id}function Um(i){const t=[];let n=0;const u=[],c=[],h={id:-1};function p(){n=0,u.length=0,c.length=0}function g(C,I,F,z,G,k){let O=t[n];const se=i.get(F);return O===void 0?(O={id:C.id,object:C,geometry:I,material:F,program:se.program||h,groupOrder:z,renderOrder:C.renderOrder,z:G,group:k},t[n]=O):(O.id=C.id,O.object=C,O.geometry=I,O.material=F,O.program=se.program||h,O.groupOrder=z,O.renderOrder=C.renderOrder,O.z=G,O.group=k),n++,O}function _(C,I,F,z,G,k){const O=g(C,I,F,z,G,k);(F.transparent===!0?c:u).push(O)}function x(C,I,F,z,G,k){const O=g(C,I,F,z,G,k);(F.transparent===!0?c:u).unshift(O)}function E(C,I){u.length>1&&u.sort(C||MA),c.length>1&&c.sort(I||CA)}function S(){for(let C=n,I=t.length;C<I;C++){const F=t[C];if(F.id===null)break;F.id=null,F.object=null,F.geometry=null,F.material=null,F.program=null,F.group=null}}return{opaque:u,transparent:c,init:p,push:_,unshift:x,finish:S,sort:E}}function PA(i){let t=new WeakMap;function n(c,h){const p=t.get(c);let g;return p===void 0?(g=new Um(i),t.set(c,new WeakMap),t.get(c).set(h,g)):(g=p.get(h),g===void 0&&(g=new Um(i),p.set(h,g))),g}function u(){t=new WeakMap}return{get:n,dispose:u}}function LA(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new te,color:new Mt};break;case"SpotLight":n={position:new te,direction:new te,color:new Mt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new te,color:new Mt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new te,skyColor:new Mt,groundColor:new Mt};break;case"RectAreaLight":n={color:new Mt,position:new te,halfWidth:new te,halfHeight:new te};break}return i[t.id]=n,n}}}function IA(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let n;switch(t.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new be};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new be};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new be,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[t.id]=n,n}}}let DA=0;function RA(i,t){return(t.castShadow?1:0)-(i.castShadow?1:0)}function OA(i,t){const n=new LA,u=IA(),c={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let E=0;E<9;E++)c.probe.push(new te);const h=new te,p=new Ut,g=new Ut;function _(E){let S=0,C=0,I=0;for(let me=0;me<9;me++)c.probe[me].set(0,0,0);let F=0,z=0,G=0,k=0,O=0,se=0,oe=0,re=0;E.sort(RA);for(let me=0,ke=E.length;me<ke;me++){const xe=E[me],Se=xe.color,we=xe.intensity,Re=xe.distance,he=xe.shadow&&xe.shadow.map?xe.shadow.map.texture:null;if(xe.isAmbientLight)S+=Se.r*we,C+=Se.g*we,I+=Se.b*we;else if(xe.isLightProbe)for(let ce=0;ce<9;ce++)c.probe[ce].addScaledVector(xe.sh.coefficients[ce],we);else if(xe.isDirectionalLight){const ce=n.get(xe);if(ce.color.copy(xe.color).multiplyScalar(xe.intensity),xe.castShadow){const pe=xe.shadow,Te=u.get(xe);Te.shadowBias=pe.bias,Te.shadowNormalBias=pe.normalBias,Te.shadowRadius=pe.radius,Te.shadowMapSize=pe.mapSize,c.directionalShadow[F]=Te,c.directionalShadowMap[F]=he,c.directionalShadowMatrix[F]=xe.shadow.matrix,se++}c.directional[F]=ce,F++}else if(xe.isSpotLight){const ce=n.get(xe);if(ce.position.setFromMatrixPosition(xe.matrixWorld),ce.color.copy(Se).multiplyScalar(we),ce.distance=Re,ce.coneCos=Math.cos(xe.angle),ce.penumbraCos=Math.cos(xe.angle*(1-xe.penumbra)),ce.decay=xe.decay,xe.castShadow){const pe=xe.shadow,Te=u.get(xe);Te.shadowBias=pe.bias,Te.shadowNormalBias=pe.normalBias,Te.shadowRadius=pe.radius,Te.shadowMapSize=pe.mapSize,c.spotShadow[G]=Te,c.spotShadowMap[G]=he,c.spotShadowMatrix[G]=xe.shadow.matrix,re++}c.spot[G]=ce,G++}else if(xe.isRectAreaLight){const ce=n.get(xe);ce.color.copy(Se).multiplyScalar(we),ce.halfWidth.set(xe.width*.5,0,0),ce.halfHeight.set(0,xe.height*.5,0),c.rectArea[k]=ce,k++}else if(xe.isPointLight){const ce=n.get(xe);if(ce.color.copy(xe.color).multiplyScalar(xe.intensity),ce.distance=xe.distance,ce.decay=xe.decay,xe.castShadow){const pe=xe.shadow,Te=u.get(xe);Te.shadowBias=pe.bias,Te.shadowNormalBias=pe.normalBias,Te.shadowRadius=pe.radius,Te.shadowMapSize=pe.mapSize,Te.shadowCameraNear=pe.camera.near,Te.shadowCameraFar=pe.camera.far,c.pointShadow[z]=Te,c.pointShadowMap[z]=he,c.pointShadowMatrix[z]=xe.shadow.matrix,oe++}c.point[z]=ce,z++}else if(xe.isHemisphereLight){const ce=n.get(xe);ce.skyColor.copy(xe.color).multiplyScalar(we),ce.groundColor.copy(xe.groundColor).multiplyScalar(we),c.hemi[O]=ce,O++}}k>0&&(t.isWebGL2||i.has("OES_texture_float_linear")===!0?(c.rectAreaLTC1=ct.LTC_FLOAT_1,c.rectAreaLTC2=ct.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(c.rectAreaLTC1=ct.LTC_HALF_1,c.rectAreaLTC2=ct.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),c.ambient[0]=S,c.ambient[1]=C,c.ambient[2]=I;const X=c.hash;(X.directionalLength!==F||X.pointLength!==z||X.spotLength!==G||X.rectAreaLength!==k||X.hemiLength!==O||X.numDirectionalShadows!==se||X.numPointShadows!==oe||X.numSpotShadows!==re)&&(c.directional.length=F,c.spot.length=G,c.rectArea.length=k,c.point.length=z,c.hemi.length=O,c.directionalShadow.length=se,c.directionalShadowMap.length=se,c.pointShadow.length=oe,c.pointShadowMap.length=oe,c.spotShadow.length=re,c.spotShadowMap.length=re,c.directionalShadowMatrix.length=se,c.pointShadowMatrix.length=oe,c.spotShadowMatrix.length=re,X.directionalLength=F,X.pointLength=z,X.spotLength=G,X.rectAreaLength=k,X.hemiLength=O,X.numDirectionalShadows=se,X.numPointShadows=oe,X.numSpotShadows=re,c.version=DA++)}function x(E,S){let C=0,I=0,F=0,z=0,G=0;const k=S.matrixWorldInverse;for(let O=0,se=E.length;O<se;O++){const oe=E[O];if(oe.isDirectionalLight){const re=c.directional[C];re.direction.setFromMatrixPosition(oe.matrixWorld),h.setFromMatrixPosition(oe.target.matrixWorld),re.direction.sub(h),re.direction.transformDirection(k),C++}else if(oe.isSpotLight){const re=c.spot[F];re.position.setFromMatrixPosition(oe.matrixWorld),re.position.applyMatrix4(k),re.direction.setFromMatrixPosition(oe.matrixWorld),h.setFromMatrixPosition(oe.target.matrixWorld),re.direction.sub(h),re.direction.transformDirection(k),F++}else if(oe.isRectAreaLight){const re=c.rectArea[z];re.position.setFromMatrixPosition(oe.matrixWorld),re.position.applyMatrix4(k),g.identity(),p.copy(oe.matrixWorld),p.premultiply(k),g.extractRotation(p),re.halfWidth.set(oe.width*.5,0,0),re.halfHeight.set(0,oe.height*.5,0),re.halfWidth.applyMatrix4(g),re.halfHeight.applyMatrix4(g),z++}else if(oe.isPointLight){const re=c.point[I];re.position.setFromMatrixPosition(oe.matrixWorld),re.position.applyMatrix4(k),I++}else if(oe.isHemisphereLight){const re=c.hemi[G];re.direction.setFromMatrixPosition(oe.matrixWorld),re.direction.transformDirection(k),re.direction.normalize(),G++}}}return{setup:_,setupView:x,state:c}}function Hm(i,t){const n=new OA(i,t),u=[],c=[];function h(){u.length=0,c.length=0}function p(S){u.push(S)}function g(S){c.push(S)}function _(){n.setup(u)}function x(S){n.setupView(u,S)}return{init:h,state:{lightsArray:u,shadowsArray:c,lights:n},setupLights:_,setupLightsView:x,pushLight:p,pushShadow:g}}function FA(i,t){let n=new WeakMap;function u(h,p=0){let g;return n.has(h)===!1?(g=new Hm(i,t),n.set(h,[]),n.get(h).push(g)):p>=n.get(h).length?(g=new Hm(i,t),n.get(h).push(g)):g=n.get(h)[p],g}function c(){n=new WeakMap}return{get:u,dispose:c}}function ps(i){Lt.call(this),this.type="MeshDepthMaterial",this.depthPacking=yh,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(i)}ps.prototype=Object.create(Lt.prototype),ps.prototype.constructor=ps,ps.prototype.isMeshDepthMaterial=!0,ps.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.depthPacking=i.depthPacking,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this};function ms(i){Lt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new te,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(i)}ms.prototype=Object.create(Lt.prototype),ms.prototype.constructor=ms,ms.prototype.isMeshDistanceMaterial=!0,ms.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.referencePosition.copy(i.referencePosition),this.nearDistance=i.nearDistance,this.farDistance=i.farDistance,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this};var kA=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,BA=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function Vm(i,t,n){let u=new pc;const c=new be,h=new be,p=new pi,g=[],_=[],x={},E={0:je,1:vt,2:ut},S=new _n({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new be},radius:{value:4}},vertexShader:BA,fragmentShader:kA}),C=S.clone();C.defines.HORIZONTAL_PASS=1;const I=new mi;I.setAttribute("position",new Qt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const F=new Ii(I,S),z=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ee,this.render=function(re,X,me){if(z.enabled===!1||z.autoUpdate===!1&&z.needsUpdate===!1||re.length===0)return;const ke=i.getRenderTarget(),xe=i.getActiveCubeFace(),Se=i.getActiveMipmapLevel(),we=i.state;we.setBlending(Jt),we.buffers.color.setClear(1,1,1,1),we.buffers.depth.setTest(!0),we.setScissorTest(!1);for(let Re=0,he=re.length;Re<he;Re++){const ce=re[Re],pe=ce.shadow;if(pe===void 0){console.warn("THREE.WebGLShadowMap:",ce,"has no shadow.");continue}if(pe.autoUpdate===!1&&pe.needsUpdate===!1)continue;c.copy(pe.mapSize);const Te=pe.getFrameExtents();if(c.multiply(Te),h.copy(pe.mapSize),(c.x>n||c.y>n)&&(c.x>n&&(h.x=Math.floor(n/Te.x),c.x=h.x*Te.x,pe.mapSize.x=h.x),c.y>n&&(h.y=Math.floor(n/Te.y),c.y=h.y*Te.y,pe.mapSize.y=h.y)),pe.map===null&&!pe.isPointLightShadow&&this.type===Ce){const Xe={minFilter:qi,magFilter:qi,format:fi};pe.map=new us(c.x,c.y,Xe),pe.map.texture.name=ce.name+".shadowMap",pe.mapPass=new us(c.x,c.y,Xe),pe.camera.updateProjectionMatrix()}if(pe.map===null){const Xe={minFilter:on,magFilter:on,format:fi};pe.map=new us(c.x,c.y,Xe),pe.map.texture.name=ce.name+".shadowMap",pe.camera.updateProjectionMatrix()}i.setRenderTarget(pe.map),i.clear();const He=pe.getViewportCount();for(let Xe=0;Xe<He;Xe++){const Qe=pe.getViewport(Xe);p.set(h.x*Qe.x,h.y*Qe.y,h.x*Qe.z,h.y*Qe.w),we.viewport(p),pe.updateMatrices(ce,Xe),u=pe.getFrustum(),oe(X,me,pe.camera,ce,this.type)}!pe.isPointLightShadow&&this.type===Ce&&G(pe,me),pe.needsUpdate=!1}z.needsUpdate=!1,i.setRenderTarget(ke,xe,Se)};function G(re,X){const me=t.update(F);S.uniforms.shadow_pass.value=re.map.texture,S.uniforms.resolution.value=re.mapSize,S.uniforms.radius.value=re.radius,i.setRenderTarget(re.mapPass),i.clear(),i.renderBufferDirect(X,null,me,S,F,null),C.uniforms.shadow_pass.value=re.mapPass.texture,C.uniforms.resolution.value=re.mapSize,C.uniforms.radius.value=re.radius,i.setRenderTarget(re.map),i.clear(),i.renderBufferDirect(X,null,me,C,F,null)}function k(re,X,me){const ke=re<<0|X<<1|me<<2;let xe=g[ke];return xe===void 0&&(xe=new ps({depthPacking:_h,morphTargets:re,skinning:X}),g[ke]=xe),xe}function O(re,X,me){const ke=re<<0|X<<1|me<<2;let xe=_[ke];return xe===void 0&&(xe=new ms({morphTargets:re,skinning:X}),_[ke]=xe),xe}function se(re,X,me,ke,xe,Se,we){let Re=null,he=k,ce=re.customDepthMaterial;if(ke.isPointLight===!0&&(he=O,ce=re.customDistanceMaterial),ce===void 0){let pe=!1;me.morphTargets===!0&&(pe=X.morphAttributes&&X.morphAttributes.position&&X.morphAttributes.position.length>0);let Te=!1;re.isSkinnedMesh===!0&&(me.skinning===!0?Te=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",re));const He=re.isInstancedMesh===!0;Re=he(pe,Te,He)}else Re=ce;if(i.localClippingEnabled&&me.clipShadows===!0&&me.clippingPlanes.length!==0){const pe=Re.uuid,Te=me.uuid;let He=x[pe];He===void 0&&(He={},x[pe]=He);let Xe=He[Te];Xe===void 0&&(Xe=Re.clone(),He[Te]=Xe),Re=Xe}return Re.visible=me.visible,Re.wireframe=me.wireframe,we===Ce?Re.side=me.shadowSide!==null?me.shadowSide:me.side:Re.side=me.shadowSide!==null?me.shadowSide:E[me.side],Re.clipShadows=me.clipShadows,Re.clippingPlanes=me.clippingPlanes,Re.clipIntersection=me.clipIntersection,Re.wireframeLinewidth=me.wireframeLinewidth,Re.linewidth=me.linewidth,ke.isPointLight===!0&&Re.isMeshDistanceMaterial===!0&&(Re.referencePosition.setFromMatrixPosition(ke.matrixWorld),Re.nearDistance=xe,Re.farDistance=Se),Re}function oe(re,X,me,ke,xe){if(re.visible===!1)return;if(re.layers.test(X.layers)&&(re.isMesh||re.isLine||re.isPoints)&&(re.castShadow||re.receiveShadow&&xe===Ce)&&(!re.frustumCulled||u.intersectsObject(re))){re.modelViewMatrix.multiplyMatrices(me.matrixWorldInverse,re.matrixWorld);const Re=t.update(re),he=re.material;if(Array.isArray(he)){const ce=Re.groups;for(let pe=0,Te=ce.length;pe<Te;pe++){const He=ce[pe],Xe=he[He.materialIndex];if(Xe&&Xe.visible){const Qe=se(re,Re,Xe,ke,me.near,me.far,xe);i.renderBufferDirect(me,null,Re,Qe,re,He)}}}else if(he.visible){const ce=se(re,Re,he,ke,me.near,me.far,xe);i.renderBufferDirect(me,null,Re,ce,re,null)}}const we=re.children;for(let Re=0,he=we.length;Re<he;Re++)oe(we[Re],X,me,ke,xe)}}function NA(i,t,n){const u=n.isWebGL2;function c(){let le=!1;const Fe=new pi;let dt=null;const bt=new pi(0,0,0,0);return{setMask:function(ot){dt!==ot&&!le&&(i.colorMask(ot,ot,ot,ot),dt=ot)},setLocked:function(ot){le=ot},setClear:function(ot,yt,mt,Bt,_t){_t===!0&&(ot*=Bt,yt*=Bt,mt*=Bt),Fe.set(ot,yt,mt,Bt),bt.equals(Fe)===!1&&(i.clearColor(ot,yt,mt,Bt),bt.copy(Fe))},reset:function(){le=!1,dt=null,bt.set(-1,0,0,0)}}}function h(){let le=!1,Fe=null,dt=null,bt=null;return{setTest:function(ot){ot?lt(2929):rt(2929)},setMask:function(ot){Fe!==ot&&!le&&(i.depthMask(ot),Fe=ot)},setFunc:function(ot){if(dt!==ot){if(ot)switch(ot){case Cr:i.depthFunc(512);break;case nl:i.depthFunc(519);break;case ui:i.depthFunc(513);break;case rl:i.depthFunc(515);break;case al:i.depthFunc(514);break;case Hd:i.depthFunc(518);break;case sl:i.depthFunc(516);break;case ol:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);dt=ot}},setLocked:function(ot){le=ot},setClear:function(ot){bt!==ot&&(i.clearDepth(ot),bt=ot)},reset:function(){le=!1,Fe=null,dt=null,bt=null}}}function p(){let le=!1,Fe=null,dt=null,bt=null,ot=null,yt=null,mt=null,Bt=null,_t=null;return{setTest:function(Ct){le||(Ct?lt(2960):rt(2960))},setMask:function(Ct){Fe!==Ct&&!le&&(i.stencilMask(Ct),Fe=Ct)},setFunc:function(Ct,Ei,pn){(dt!==Ct||bt!==Ei||ot!==pn)&&(i.stencilFunc(Ct,Ei,pn),dt=Ct,bt=Ei,ot=pn)},setOp:function(Ct,Ei,pn){(yt!==Ct||mt!==Ei||Bt!==pn)&&(i.stencilOp(Ct,Ei,pn),yt=Ct,mt=Ei,Bt=pn)},setLocked:function(Ct){le=Ct},setClear:function(Ct){_t!==Ct&&(i.clearStencil(Ct),_t=Ct)},reset:function(){le=!1,Fe=null,dt=null,bt=null,ot=null,yt=null,mt=null,Bt=null,_t=null}}}const g=new c,_=new h,x=new p;let E={},S=null,C=null,I=null,F=null,z=null,G=null,k=null,O=null,se=null,oe=!1,re=null,X=null,me=null,ke=null,xe=null;const Se=i.getParameter(35661);let we=!1,Re=0;const he=i.getParameter(7938);he.indexOf("WebGL")!==-1?(Re=parseFloat(/^WebGL (\d)/.exec(he)[1]),we=Re>=1):he.indexOf("OpenGL ES")!==-1&&(Re=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),we=Re>=2);let ce=null,pe={};const Te=new pi,He=new pi;function Xe(le,Fe,dt){const bt=new Uint8Array(4),ot=i.createTexture();i.bindTexture(le,ot),i.texParameteri(le,10241,9728),i.texParameteri(le,10240,9728);for(let yt=0;yt<dt;yt++)i.texImage2D(Fe+yt,0,6408,1,1,0,6408,5121,bt);return ot}const Qe={};Qe[3553]=Xe(3553,3553,1),Qe[34067]=Xe(34067,34069,6),g.setClear(0,0,0,1),_.setClear(1),x.setClear(0),lt(2929),_.setFunc(rl),It(!1),qt(ze),lt(2884),Ve(Jt);function lt(le){E[le]!==!0&&(i.enable(le),E[le]=!0)}function rt(le){E[le]!==!1&&(i.disable(le),E[le]=!1)}function Et(le){return S!==le?(i.useProgram(le),S=le,!0):!1}const Dt={[lr]:32774,[Mn]:32778,[ur]:32779};if(u)Dt[cr]=32775,Dt[Mr]=32776;else{const le=t.get("EXT_blend_minmax");le!==null&&(Dt[cr]=le.MIN_EXT,Dt[Mr]=le.MAX_EXT)}const Ht={[Zn]:0,[Ma]:1,[Ca]:768,[Lu]:770,[is]:776,[Nd]:774,[kd]:772,[Pa]:769,[il]:771,[Ud]:775,[Bd]:773};function Ve(le,Fe,dt,bt,ot,yt,mt,Bt){if(le===Jt){C&&(rt(3042),C=!1);return}if(C||(lt(3042),C=!0),le!==li){if(le!==I||Bt!==oe){if((F!==lr||k!==lr)&&(i.blendEquation(32774),F=lr,k=lr),Bt)switch(le){case hi:i.blendFuncSeparate(1,771,1,771);break;case Oi:i.blendFunc(1,1);break;case vi:i.blendFuncSeparate(0,0,769,771);break;case $i:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}else switch(le){case hi:i.blendFuncSeparate(770,771,1,771);break;case Oi:i.blendFunc(770,1);break;case vi:i.blendFunc(0,769);break;case $i:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",le);break}z=null,G=null,O=null,se=null,I=le,oe=Bt}return}ot=ot||Fe,yt=yt||dt,mt=mt||bt,(Fe!==F||ot!==k)&&(i.blendEquationSeparate(Dt[Fe],Dt[ot]),F=Fe,k=ot),(dt!==z||bt!==G||yt!==O||mt!==se)&&(i.blendFuncSeparate(Ht[dt],Ht[bt],Ht[yt],Ht[mt]),z=dt,G=bt,O=yt,se=mt),I=le,oe=null}function zi(le,Fe){le.side===ut?rt(2884):lt(2884);let dt=le.side===je;Fe&&(dt=!dt),It(dt),le.blending===hi&&le.transparent===!1?Ve(Jt):Ve(le.blending,le.blendEquation,le.blendSrc,le.blendDst,le.blendEquationAlpha,le.blendSrcAlpha,le.blendDstAlpha,le.premultipliedAlpha),_.setFunc(le.depthFunc),_.setTest(le.depthTest),_.setMask(le.depthWrite),g.setMask(le.colorWrite);const bt=le.stencilWrite;x.setTest(bt),bt&&(x.setMask(le.stencilWriteMask),x.setFunc(le.stencilFunc,le.stencilRef,le.stencilFuncMask),x.setOp(le.stencilFail,le.stencilZFail,le.stencilZPass)),ti(le.polygonOffset,le.polygonOffsetFactor,le.polygonOffsetUnits)}function It(le){re!==le&&(le?i.frontFace(2304):i.frontFace(2305),re=le)}function qt(le){le!==Le?(lt(2884),le!==X&&(le===ze?i.cullFace(1029):le===De?i.cullFace(1028):i.cullFace(1032))):rt(2884),X=le}function Rt(le){le!==me&&(we&&i.lineWidth(le),me=le)}function ti(le,Fe,dt){le?(lt(32823),(ke!==Fe||xe!==dt)&&(i.polygonOffset(Fe,dt),ke=Fe,xe=dt)):rt(32823)}function kt(le){le?lt(3089):rt(3089)}function $e(le){le===void 0&&(le=33984+Se-1),ce!==le&&(i.activeTexture(le),ce=le)}function nt(le,Fe){ce===null&&$e();let dt=pe[ce];dt===void 0&&(dt={type:void 0,texture:void 0},pe[ce]=dt),(dt.type!==le||dt.texture!==Fe)&&(i.bindTexture(le,Fe||Qe[le]),dt.type=le,dt.texture=Fe)}function st(){const le=pe[ce];le!==void 0&&le.type!==void 0&&(i.bindTexture(le.type,null),le.type=void 0,le.texture=void 0)}function ve(){try{i.compressedTexImage2D.apply(i,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Ze(){try{i.texImage2D.apply(i,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function $(){try{i.texImage3D.apply(i,arguments)}catch(le){console.error("THREE.WebGLState:",le)}}function Q(le){Te.equals(le)===!1&&(i.scissor(le.x,le.y,le.z,le.w),Te.copy(le))}function Ue(le){He.equals(le)===!1&&(i.viewport(le.x,le.y,le.z,le.w),He.copy(le))}function Be(){E={},ce=null,pe={},S=null,C=null,I=null,F=null,z=null,G=null,k=null,O=null,se=null,oe=!1,re=null,X=null,me=null,ke=null,xe=null,g.reset(),_.reset(),x.reset()}return{buffers:{color:g,depth:_,stencil:x},enable:lt,disable:rt,useProgram:Et,setBlending:Ve,setMaterial:zi,setFlipSided:It,setCullFace:qt,setLineWidth:Rt,setPolygonOffset:ti,setScissorTest:kt,activeTexture:$e,bindTexture:nt,unbindTexture:st,compressedTexImage2D:ve,texImage2D:Ze,texImage3D:$,scissor:Q,viewport:Ue,reset:Be}}function UA(i,t,n,u,c,h,p){const g=c.isWebGL2,_=c.maxTextures,x=c.maxCubemapSize,E=c.maxTextureSize,S=c.maxSamples,C=new WeakMap;let I,F=!1;try{F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function z($,Q){return F?new OffscreenCanvas($,Q):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function G($,Q,Ue,Be){let le=1;if(($.width>Be||$.height>Be)&&(le=Be/Math.max($.width,$.height)),le<1||Q===!0)if(typeof HTMLImageElement<"u"&&$ instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&$ instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&$ instanceof ImageBitmap){const Fe=Q?At.floorPowerOfTwo:Math.floor,dt=Fe(le*$.width),bt=Fe(le*$.height);I===void 0&&(I=z(dt,bt));const ot=Ue?z(dt,bt):I;return ot.width=dt,ot.height=bt,ot.getContext("2d").drawImage($,0,0,dt,bt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$.width+"x"+$.height+") to ("+dt+"x"+bt+")."),ot}else return"data"in $&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$.width+"x"+$.height+")."),$;return $}function k($){return At.isPowerOfTwo($.width)&&At.isPowerOfTwo($.height)}function O($){return g?!1:$.wrapS!==Ai||$.wrapT!==Ai||$.minFilter!==on&&$.minFilter!==qi}function se($,Q){return $.generateMipmaps&&Q&&$.minFilter!==on&&$.minFilter!==qi}function oe($,Q,Ue,Be){i.generateMipmap($);const le=u.get(Q);le.__maxMipLevel=Math.log(Math.max(Ue,Be))*Math.LOG2E}function re($,Q,Ue){if(g===!1)return Q;if($!==null){if(i[$]!==void 0)return i[$];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+$+"'")}let Be=Q;return Q===6403&&(Ue===5126&&(Be=33326),Ue===5131&&(Be=33325),Ue===5121&&(Be=33321)),Q===6407&&(Ue===5126&&(Be=34837),Ue===5131&&(Be=34843),Ue===5121&&(Be=32849)),Q===6408&&(Ue===5126&&(Be=34836),Ue===5131&&(Be=34842),Ue===5121&&(Be=32856)),(Be===33325||Be===33326||Be===34842||Be===34836)&&t.get("EXT_color_buffer_float"),Be}function X($){return $===on||$===Fu||$===ku?9728:9729}function me($){const Q=$.target;Q.removeEventListener("dispose",me),xe(Q),Q.isVideoTexture&&C.delete(Q),p.memory.textures--}function ke($){const Q=$.target;Q.removeEventListener("dispose",ke),Se(Q),p.memory.textures--}function xe($){const Q=u.get($);Q.__webglInit!==void 0&&(i.deleteTexture(Q.__webglTexture),u.remove($))}function Se($){const Q=u.get($),Ue=u.get($.texture);if($){if(Ue.__webglTexture!==void 0&&i.deleteTexture(Ue.__webglTexture),$.depthTexture&&$.depthTexture.dispose(),$.isWebGLCubeRenderTarget)for(let Be=0;Be<6;Be++)i.deleteFramebuffer(Q.__webglFramebuffer[Be]),Q.__webglDepthbuffer&&i.deleteRenderbuffer(Q.__webglDepthbuffer[Be]);else i.deleteFramebuffer(Q.__webglFramebuffer),Q.__webglDepthbuffer&&i.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&i.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer&&i.deleteRenderbuffer(Q.__webglColorRenderbuffer),Q.__webglDepthRenderbuffer&&i.deleteRenderbuffer(Q.__webglDepthRenderbuffer);u.remove($.texture),u.remove($)}}let we=0;function Re(){we=0}function he(){const $=we;return $>=_&&console.warn("THREE.WebGLTextures: Trying to use "+$+" texture units while this GPU supports only "+_),we+=1,$}function ce($,Q){const Ue=u.get($);if($.isVideoTexture&&$e($),$.version>0&&Ue.__version!==$.version){const Be=$.image;if(Be===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Be.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Et(Ue,$,Q);return}}n.activeTexture(33984+Q),n.bindTexture(3553,Ue.__webglTexture)}function pe($,Q){const Ue=u.get($);if($.version>0&&Ue.__version!==$.version){Et(Ue,$,Q);return}n.activeTexture(33984+Q),n.bindTexture(35866,Ue.__webglTexture)}function Te($,Q){const Ue=u.get($);if($.version>0&&Ue.__version!==$.version){Et(Ue,$,Q);return}n.activeTexture(33984+Q),n.bindTexture(32879,Ue.__webglTexture)}function He($,Q){const Ue=u.get($);if($.version>0&&Ue.__version!==$.version){Dt(Ue,$,Q);return}n.activeTexture(33984+Q),n.bindTexture(34067,Ue.__webglTexture)}const Xe={[fl]:10497,[Ai]:33071,[Os]:33648},Qe={[on]:9728,[Fu]:9984,[ku]:9986,[qi]:9729,[zd]:9985,[Pr]:9987};function lt($,Q,Ue){Ue?(i.texParameteri($,10242,Xe[Q.wrapS]),i.texParameteri($,10243,Xe[Q.wrapT]),($===32879||$===35866)&&i.texParameteri($,32882,Xe[Q.wrapR]),i.texParameteri($,10240,Qe[Q.magFilter]),i.texParameteri($,10241,Qe[Q.minFilter])):(i.texParameteri($,10242,33071),i.texParameteri($,10243,33071),($===32879||$===35866)&&i.texParameteri($,32882,33071),(Q.wrapS!==Ai||Q.wrapT!==Ai)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri($,10240,X(Q.magFilter)),i.texParameteri($,10241,X(Q.minFilter)),Q.minFilter!==on&&Q.minFilter!==qi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const Be=t.get("EXT_texture_filter_anisotropic");if(Be){if(Q.type===ei&&t.get("OES_texture_float_linear")===null||Q.type===Fs&&(g||t.get("OES_texture_half_float_linear"))===null)return;(Q.anisotropy>1||u.get(Q).__currentAnisotropy)&&(i.texParameterf($,Be.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,c.getMaxAnisotropy())),u.get(Q).__currentAnisotropy=Q.anisotropy)}}function rt($,Q){$.__webglInit===void 0&&($.__webglInit=!0,Q.addEventListener("dispose",me),$.__webglTexture=i.createTexture(),p.memory.textures++)}function Et($,Q,Ue){let Be=3553;Q.isDataTexture2DArray&&(Be=35866),Q.isDataTexture3D&&(Be=32879),rt($,Q),n.activeTexture(33984+Ue),n.bindTexture(Be,$.__webglTexture),i.pixelStorei(37440,Q.flipY),i.pixelStorei(37441,Q.premultiplyAlpha),i.pixelStorei(3317,Q.unpackAlignment);const le=O(Q)&&k(Q.image)===!1,Fe=G(Q.image,le,!1,E),dt=k(Fe)||g,bt=h.convert(Q.format);let ot=h.convert(Q.type),yt=re(Q.internalFormat,bt,ot);lt(Be,Q,dt);let mt;const Bt=Q.mipmaps;if(Q.isDepthTexture)yt=6402,g?Q.type===ei?yt=36012:Q.type===Zr?yt=33190:Q.type===kn?yt=35056:yt=33189:Q.type===ei&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Q.format===$r&&yt===6402&&Q.type!==Kr&&Q.type!==Zr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Q.type=Kr,ot=h.convert(Q.type)),Q.format===Jr&&yt===6402&&(yt=34041,Q.type!==kn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Q.type=kn,ot=h.convert(Q.type))),n.texImage2D(3553,0,yt,Fe.width,Fe.height,0,bt,ot,null);else if(Q.isDataTexture)if(Bt.length>0&&dt){for(let _t=0,Ct=Bt.length;_t<Ct;_t++)mt=Bt[_t],n.texImage2D(3553,_t,yt,mt.width,mt.height,0,bt,ot,mt.data);Q.generateMipmaps=!1,$.__maxMipLevel=Bt.length-1}else n.texImage2D(3553,0,yt,Fe.width,Fe.height,0,bt,ot,Fe.data),$.__maxMipLevel=0;else if(Q.isCompressedTexture){for(let _t=0,Ct=Bt.length;_t<Ct;_t++)mt=Bt[_t],Q.format!==fi&&Q.format!==Bn?bt!==null?n.compressedTexImage2D(3553,_t,yt,mt.width,mt.height,0,mt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,_t,yt,mt.width,mt.height,0,bt,ot,mt.data);$.__maxMipLevel=Bt.length-1}else if(Q.isDataTexture2DArray)n.texImage3D(35866,0,yt,Fe.width,Fe.height,Fe.depth,0,bt,ot,Fe.data),$.__maxMipLevel=0;else if(Q.isDataTexture3D)n.texImage3D(32879,0,yt,Fe.width,Fe.height,Fe.depth,0,bt,ot,Fe.data),$.__maxMipLevel=0;else if(Bt.length>0&&dt){for(let _t=0,Ct=Bt.length;_t<Ct;_t++)mt=Bt[_t],n.texImage2D(3553,_t,yt,bt,ot,mt);Q.generateMipmaps=!1,$.__maxMipLevel=Bt.length-1}else n.texImage2D(3553,0,yt,bt,ot,Fe),$.__maxMipLevel=0;se(Q,dt)&&oe(Be,Q,Fe.width,Fe.height),$.__version=Q.version,Q.onUpdate&&Q.onUpdate(Q)}function Dt($,Q,Ue){if(Q.image.length!==6)return;rt($,Q),n.activeTexture(33984+Ue),n.bindTexture(34067,$.__webglTexture),i.pixelStorei(37440,Q.flipY),i.pixelStorei(37441,Q.premultiplyAlpha),i.pixelStorei(3317,Q.unpackAlignment);const Be=Q&&(Q.isCompressedTexture||Q.image[0].isCompressedTexture),le=Q.image[0]&&Q.image[0].isDataTexture,Fe=[];for(let _t=0;_t<6;_t++)!Be&&!le?Fe[_t]=G(Q.image[_t],!1,!0,x):Fe[_t]=le?Q.image[_t].image:Q.image[_t];const dt=Fe[0],bt=k(dt)||g,ot=h.convert(Q.format),yt=h.convert(Q.type),mt=re(Q.internalFormat,ot,yt);lt(34067,Q,bt);let Bt;if(Be){for(let _t=0;_t<6;_t++){Bt=Fe[_t].mipmaps;for(let Ct=0;Ct<Bt.length;Ct++){const Ei=Bt[Ct];Q.format!==fi&&Q.format!==Bn?ot!==null?n.compressedTexImage2D(34069+_t,Ct,mt,Ei.width,Ei.height,0,Ei.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+_t,Ct,mt,Ei.width,Ei.height,0,ot,yt,Ei.data)}}$.__maxMipLevel=Bt.length-1}else{Bt=Q.mipmaps;for(let _t=0;_t<6;_t++)if(le){n.texImage2D(34069+_t,0,mt,Fe[_t].width,Fe[_t].height,0,ot,yt,Fe[_t].data);for(let Ct=0;Ct<Bt.length;Ct++){const pn=Bt[Ct].image[_t].image;n.texImage2D(34069+_t,Ct+1,mt,pn.width,pn.height,0,ot,yt,pn.data)}}else{n.texImage2D(34069+_t,0,mt,ot,yt,Fe[_t]);for(let Ct=0;Ct<Bt.length;Ct++){const Ei=Bt[Ct];n.texImage2D(34069+_t,Ct+1,mt,ot,yt,Ei.image[_t])}}$.__maxMipLevel=Bt.length}se(Q,bt)&&oe(34067,Q,dt.width,dt.height),$.__version=Q.version,Q.onUpdate&&Q.onUpdate(Q)}function Ht($,Q,Ue,Be){const le=h.convert(Q.texture.format),Fe=h.convert(Q.texture.type),dt=re(Q.texture.internalFormat,le,Fe);n.texImage2D(Be,0,dt,Q.width,Q.height,0,le,Fe,null),i.bindFramebuffer(36160,$),i.framebufferTexture2D(36160,Ue,Be,u.get(Q.texture).__webglTexture,0),i.bindFramebuffer(36160,null)}function Ve($,Q,Ue){if(i.bindRenderbuffer(36161,$),Q.depthBuffer&&!Q.stencilBuffer){let Be=33189;if(Ue){const le=Q.depthTexture;le&&le.isDepthTexture&&(le.type===ei?Be=36012:le.type===Zr&&(Be=33190));const Fe=kt(Q);i.renderbufferStorageMultisample(36161,Fe,Be,Q.width,Q.height)}else i.renderbufferStorage(36161,Be,Q.width,Q.height);i.framebufferRenderbuffer(36160,36096,36161,$)}else if(Q.depthBuffer&&Q.stencilBuffer){if(Ue){const Be=kt(Q);i.renderbufferStorageMultisample(36161,Be,35056,Q.width,Q.height)}else i.renderbufferStorage(36161,34041,Q.width,Q.height);i.framebufferRenderbuffer(36160,33306,36161,$)}else{const Be=h.convert(Q.texture.format),le=h.convert(Q.texture.type),Fe=re(Q.texture.internalFormat,Be,le);if(Ue){const dt=kt(Q);i.renderbufferStorageMultisample(36161,dt,Fe,Q.width,Q.height)}else i.renderbufferStorage(36161,Fe,Q.width,Q.height)}i.bindRenderbuffer(36161,null)}function zi($,Q){if(Q&&Q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,$),!(Q.depthTexture&&Q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!u.get(Q.depthTexture).__webglTexture||Q.depthTexture.image.width!==Q.width||Q.depthTexture.image.height!==Q.height)&&(Q.depthTexture.image.width=Q.width,Q.depthTexture.image.height=Q.height,Q.depthTexture.needsUpdate=!0),ce(Q.depthTexture,0);const Be=u.get(Q.depthTexture).__webglTexture;if(Q.depthTexture.format===$r)i.framebufferTexture2D(36160,36096,3553,Be,0);else if(Q.depthTexture.format===Jr)i.framebufferTexture2D(36160,33306,3553,Be,0);else throw new Error("Unknown depthTexture format")}function It($){const Q=u.get($),Ue=$.isWebGLCubeRenderTarget===!0;if($.depthTexture){if(Ue)throw new Error("target.depthTexture not supported in Cube render targets");zi(Q.__webglFramebuffer,$)}else if(Ue){Q.__webglDepthbuffer=[];for(let Be=0;Be<6;Be++)i.bindFramebuffer(36160,Q.__webglFramebuffer[Be]),Q.__webglDepthbuffer[Be]=i.createRenderbuffer(),Ve(Q.__webglDepthbuffer[Be],$,!1)}else i.bindFramebuffer(36160,Q.__webglFramebuffer),Q.__webglDepthbuffer=i.createRenderbuffer(),Ve(Q.__webglDepthbuffer,$,!1);i.bindFramebuffer(36160,null)}function qt($){const Q=u.get($),Ue=u.get($.texture);$.addEventListener("dispose",ke),Ue.__webglTexture=i.createTexture(),p.memory.textures++;const Be=$.isWebGLCubeRenderTarget===!0,le=$.isWebGLMultisampleRenderTarget===!0,Fe=k($)||g;if(g&&$.texture.format===Bn&&($.texture.type===ei||$.texture.type===Fs)&&($.texture.format=fi,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Be){Q.__webglFramebuffer=[];for(let dt=0;dt<6;dt++)Q.__webglFramebuffer[dt]=i.createFramebuffer()}else if(Q.__webglFramebuffer=i.createFramebuffer(),le)if(g){Q.__webglMultisampledFramebuffer=i.createFramebuffer(),Q.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,Q.__webglColorRenderbuffer);const dt=h.convert($.texture.format),bt=h.convert($.texture.type),ot=re($.texture.internalFormat,dt,bt),yt=kt($);i.renderbufferStorageMultisample(36161,yt,ot,$.width,$.height),i.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,Q.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),$.depthBuffer&&(Q.__webglDepthRenderbuffer=i.createRenderbuffer(),Ve(Q.__webglDepthRenderbuffer,$,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Be){n.bindTexture(34067,Ue.__webglTexture),lt(34067,$.texture,Fe);for(let dt=0;dt<6;dt++)Ht(Q.__webglFramebuffer[dt],$,36064,34069+dt);se($.texture,Fe)&&oe(34067,$.texture,$.width,$.height),n.bindTexture(34067,null)}else n.bindTexture(3553,Ue.__webglTexture),lt(3553,$.texture,Fe),Ht(Q.__webglFramebuffer,$,36064,3553),se($.texture,Fe)&&oe(3553,$.texture,$.width,$.height),n.bindTexture(3553,null);$.depthBuffer&&It($)}function Rt($){const Q=$.texture,Ue=k($)||g;if(se(Q,Ue)){const Be=$.isWebGLCubeRenderTarget?34067:3553,le=u.get(Q).__webglTexture;n.bindTexture(Be,le),oe(Be,Q,$.width,$.height),n.bindTexture(Be,null)}}function ti($){if($.isWebGLMultisampleRenderTarget)if(g){const Q=u.get($);i.bindFramebuffer(36008,Q.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Q.__webglFramebuffer);const Ue=$.width,Be=$.height;let le=16384;$.depthBuffer&&(le|=256),$.stencilBuffer&&(le|=1024),i.blitFramebuffer(0,0,Ue,Be,0,0,Ue,Be,le,9728),i.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function kt($){return g&&$.isWebGLMultisampleRenderTarget?Math.min(S,$.samples):0}function $e($){const Q=p.render.frame;C.get($)!==Q&&(C.set($,Q),$.update())}let nt=!1,st=!1;function ve($,Q){$&&$.isWebGLRenderTarget&&(nt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),nt=!0),$=$.texture),ce($,Q)}function Ze($,Q){$&&$.isWebGLCubeRenderTarget&&(st===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),st=!0),$=$.texture),He($,Q)}this.allocateTextureUnit=he,this.resetTextureUnits=Re,this.setTexture2D=ce,this.setTexture2DArray=pe,this.setTexture3D=Te,this.setTextureCube=He,this.setupRenderTarget=qt,this.updateRenderTargetMipmap=Rt,this.updateMultisampleRenderTarget=ti,this.safeSetTexture2D=ve,this.safeSetTextureCube=Ze}function HA(i,t,n){const u=n.isWebGL2;function c(h){let p;if(h===ln)return 5121;if(h===ks)return 32819;if(h===Bs)return 32820;if(h===qd)return 33635;if(h===Wd)return 5120;if(h===jd)return 5122;if(h===Kr)return 5123;if(h===dr)return 5124;if(h===Zr)return 5125;if(h===ei)return 5126;if(h===Fs)return u?5131:(p=t.get("OES_texture_half_float"),p!==null?p.HALF_FLOAT_OES:null);if(h===Si)return 6406;if(h===Bn)return 6407;if(h===fi)return 6408;if(h===Xd)return 6409;if(h===Qd)return 6410;if(h===$r)return 6402;if(h===Jr)return 34041;if(h===Bu)return 6403;if(h===Nu)return 36244;if(h===Uu)return 33319;if(h===Ns)return 33320;if(h===Yd)return 36248;if(h===Us)return 36249;if(h===pl||h===rs||h===Hu||h===Vu)if(p=t.get("WEBGL_compressed_texture_s3tc"),p!==null){if(h===pl)return p.COMPRESSED_RGB_S3TC_DXT1_EXT;if(h===rs)return p.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(h===Hu)return p.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(h===Vu)return p.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(h===as||h===Da||h===ss||h===ea)if(p=t.get("WEBGL_compressed_texture_pvrtc"),p!==null){if(h===as)return p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(h===Da)return p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(h===ss)return p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(h===ea)return p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(h===ml)return p=t.get("WEBGL_compressed_texture_etc1"),p!==null?p.COMPRESSED_RGB_ETC1_WEBGL:null;if((h===gl||h===Hs)&&(p=t.get("WEBGL_compressed_texture_etc"),p!==null)){if(h===gl)return p.COMPRESSED_RGB8_ETC2;if(h===Hs)return p.COMPRESSED_RGBA8_ETC2_EAC}if(h===hr||h===Kd||h===Vs||h===Gu||h===zu||h===Wu||h===Zd||h===Gs||h===zs||h===ju||h===$d||h===Jd||h===qu||h===eh||h===Xu||h===ih||h===nh||h===rh||h===ah||h===sh||h===oh||h===Ws||h===js||h===lh||h===uh||h===Qu||h===ch||h===Yu)return p=t.get("WEBGL_compressed_texture_astc"),p!==null?h:null;if(h===th)return p=t.get("EXT_texture_compression_bptc"),p!==null?h:null;if(h===kn)return u?34042:(p=t.get("WEBGL_depth_texture"),p!==null?p.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:c}}function Wh(i=[]){Qi.call(this),this.cameras=i}Wh.prototype=J(Object.create(Qi.prototype),{constructor:Wh,isArrayCamera:!0});function co(){gt.call(this),this.type="Group"}co.prototype=J(Object.create(gt.prototype),{constructor:co,isGroup:!0});function Il(){this._targetRay=null,this._grip=null,this._hand=null}J(Il.prototype,{constructor:Il,getHandSpace:function(){return this._hand===null&&(this._hand=new co,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new co,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new co,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},update:function(i,t,n){let u=null,c=null,h=null;const p=this._targetRay,g=this._grip,_=this._hand;if(i&&t.session.visibilityState!=="visible-blurred")if(_&&i.hand){h=!0;for(const F of i.hand.values()){const z=t.getJointPose(F,n);if(_.joints[F.jointName]===void 0){const k=new co;k.matrixAutoUpdate=!1,k.visible=!1,_.joints[F.jointName]=k,_.add(k)}const G=_.joints[F.jointName];z!==null&&(G.matrix.fromArray(z.transform.matrix),G.matrix.decompose(G.position,G.rotation,G.scale),G.jointRadius=z.radius),G.visible=z!==null}const x=_.joints["index-finger-tip"],E=_.joints["thumb-tip"],S=x.position.distanceTo(E.position),C=.02,I=.005;_.inputState.pinching&&S>C+I?(_.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!_.inputState.pinching&&S<=C-I&&(_.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else p!==null&&(u=t.getPose(i.targetRaySpace,n),u!==null&&(p.matrix.fromArray(u.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale))),g!==null&&i.gripSpace&&(c=t.getPose(i.gripSpace,n),c!==null&&(g.matrix.fromArray(c.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale)));return p!==null&&(p.visible=u!==null),g!==null&&(g.visible=c!==null),_!==null&&(_.visible=h!==null),this}});function Gm(i,t){const n=this;let u=null,c=1,h=null,p="local-floor",g=null;const _=[],x=new Map,E=new Qi;E.layers.enable(1),E.viewport=new pi;const S=new Qi;S.layers.enable(2),S.viewport=new pi;const C=[E,S],I=new Wh;I.layers.enable(1),I.layers.enable(2);let F=null,z=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(Se){let we=_[Se];return we===void 0&&(we=new Il,_[Se]=we),we.getTargetRaySpace()},this.getControllerGrip=function(Se){let we=_[Se];return we===void 0&&(we=new Il,_[Se]=we),we.getGripSpace()},this.getHand=function(Se){let we=_[Se];return we===void 0&&(we=new Il,_[Se]=we),we.getHandSpace()};function G(Se){const we=x.get(Se.inputSource);we&&we.dispatchEvent({type:Se.type,data:Se.inputSource})}function k(){x.forEach(function(Se,we){Se.disconnect(we)}),x.clear(),F=null,z=null,i.setFramebuffer(null),i.setRenderTarget(i.getRenderTarget()),xe.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Se){c=Se,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Se){p=Se,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h},this.getSession=function(){return u},this.setSession=function(){var Se=_e(function*(we){if(u=we,u!==null){u.addEventListener("select",G),u.addEventListener("selectstart",G),u.addEventListener("selectend",G),u.addEventListener("squeeze",G),u.addEventListener("squeezestart",G),u.addEventListener("squeezeend",G),u.addEventListener("end",k),u.addEventListener("inputsourceschange",O);const Re=t.getContextAttributes();Re.xrCompatible!==!0&&(yield t.makeXRCompatible());const he={antialias:Re.antialias,alpha:Re.alpha,depth:Re.depth,stencil:Re.stencil,framebufferScaleFactor:c},ce=new XRWebGLLayer(u,t,he);u.updateRenderState({baseLayer:ce}),h=yield u.requestReferenceSpace(p),xe.setContext(u),xe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}});return function(we){return Se.apply(this,arguments)}}();function O(Se){const we=u.inputSources;for(let Re=0;Re<_.length;Re++)x.set(we[Re],_[Re]);for(let Re=0;Re<Se.removed.length;Re++){const he=Se.removed[Re],ce=x.get(he);ce&&(ce.dispatchEvent({type:"disconnected",data:he}),x.delete(he))}for(let Re=0;Re<Se.added.length;Re++){const he=Se.added[Re],ce=x.get(he);ce&&ce.dispatchEvent({type:"connected",data:he})}}const se=new te,oe=new te;function re(Se,we,Re){se.setFromMatrixPosition(we.matrixWorld),oe.setFromMatrixPosition(Re.matrixWorld);const he=se.distanceTo(oe),ce=we.projectionMatrix.elements,pe=Re.projectionMatrix.elements,Te=ce[14]/(ce[10]-1),He=ce[14]/(ce[10]+1),Xe=(ce[9]+1)/ce[5],Qe=(ce[9]-1)/ce[5],lt=(ce[8]-1)/ce[0],rt=(pe[8]+1)/pe[0],Et=Te*lt,Dt=Te*rt,Ht=he/(-lt+rt),Ve=Ht*-lt;we.matrixWorld.decompose(Se.position,Se.quaternion,Se.scale),Se.translateX(Ve),Se.translateZ(Ht),Se.matrixWorld.compose(Se.position,Se.quaternion,Se.scale),Se.matrixWorldInverse.copy(Se.matrixWorld).invert();const zi=Te+Ht,It=He+Ht,qt=Et-Ve,Rt=Dt+(he-Ve),ti=Xe*He/It*zi,kt=Qe*He/It*zi;Se.projectionMatrix.makePerspective(qt,Rt,ti,kt,zi,It)}function X(Se,we){we===null?Se.matrixWorld.copy(Se.matrix):Se.matrixWorld.multiplyMatrices(we.matrixWorld,Se.matrix),Se.matrixWorldInverse.copy(Se.matrixWorld).invert()}this.getCamera=function(Se){I.near=S.near=E.near=Se.near,I.far=S.far=E.far=Se.far,(F!==I.near||z!==I.far)&&(u.updateRenderState({depthNear:I.near,depthFar:I.far}),F=I.near,z=I.far);const we=Se.parent,Re=I.cameras;X(I,we);for(let ce=0;ce<Re.length;ce++)X(Re[ce],we);Se.matrixWorld.copy(I.matrixWorld),Se.matrix.copy(I.matrix),Se.matrix.decompose(Se.position,Se.quaternion,Se.scale);const he=Se.children;for(let ce=0,pe=he.length;ce<pe;ce++)he[ce].updateMatrixWorld(!0);return Re.length===2?re(I,E,S):I.projectionMatrix.copy(E.projectionMatrix),I};let me=null;function ke(Se,we){if(g=we.getViewerPose(h),g!==null){const he=g.views,ce=u.renderState.baseLayer;i.setFramebuffer(ce.framebuffer);let pe=!1;he.length!==I.cameras.length&&(I.cameras.length=0,pe=!0);for(let Te=0;Te<he.length;Te++){const He=he[Te],Xe=ce.getViewport(He),Qe=C[Te];Qe.matrix.fromArray(He.transform.matrix),Qe.projectionMatrix.fromArray(He.projectionMatrix),Qe.viewport.set(Xe.x,Xe.y,Xe.width,Xe.height),Te===0&&I.matrix.copy(Qe.matrix),pe===!0&&I.cameras.push(Qe)}}const Re=u.inputSources;for(let he=0;he<_.length;he++){const ce=_[he],pe=Re[he];ce.update(pe,we,h)}me&&me(Se,we)}const xe=new _m;xe.setAnimationLoop(ke),this.setAnimationLoop=function(Se){me=Se},this.dispose=function(){}}J(Gm.prototype,$n.prototype);function VA(i){function t(k,O){k.fogColor.value.copy(O.color),O.isFog?(k.fogNear.value=O.near,k.fogFar.value=O.far):O.isFogExp2&&(k.fogDensity.value=O.density)}function n(k,O,se,oe){O.isMeshBasicMaterial?u(k,O):O.isMeshLambertMaterial?(u(k,O),_(k,O)):O.isMeshToonMaterial?(u(k,O),E(k,O)):O.isMeshPhongMaterial?(u(k,O),x(k,O)):O.isMeshStandardMaterial?(u(k,O),O.isMeshPhysicalMaterial?C(k,O):S(k,O)):O.isMeshMatcapMaterial?(u(k,O),I(k,O)):O.isMeshDepthMaterial?(u(k,O),F(k,O)):O.isMeshDistanceMaterial?(u(k,O),z(k,O)):O.isMeshNormalMaterial?(u(k,O),G(k,O)):O.isLineBasicMaterial?(c(k,O),O.isLineDashedMaterial&&h(k,O)):O.isPointsMaterial?p(k,O,se,oe):O.isSpriteMaterial?g(k,O):O.isShadowMaterial?(k.color.value.copy(O.color),k.opacity.value=O.opacity):O.isShaderMaterial&&(O.uniformsNeedUpdate=!1)}function u(k,O){k.opacity.value=O.opacity,O.color&&k.diffuse.value.copy(O.color),O.emissive&&k.emissive.value.copy(O.emissive).multiplyScalar(O.emissiveIntensity),O.map&&(k.map.value=O.map),O.alphaMap&&(k.alphaMap.value=O.alphaMap),O.specularMap&&(k.specularMap.value=O.specularMap);const se=i.get(O).envMap;if(se){k.envMap.value=se,k.flipEnvMap.value=se.isCubeTexture&&se._needsFlipEnvMap?-1:1,k.reflectivity.value=O.reflectivity,k.refractionRatio.value=O.refractionRatio;const X=i.get(se).__maxMipLevel;X!==void 0&&(k.maxMipLevel.value=X)}O.lightMap&&(k.lightMap.value=O.lightMap,k.lightMapIntensity.value=O.lightMapIntensity),O.aoMap&&(k.aoMap.value=O.aoMap,k.aoMapIntensity.value=O.aoMapIntensity);let oe;O.map?oe=O.map:O.specularMap?oe=O.specularMap:O.displacementMap?oe=O.displacementMap:O.normalMap?oe=O.normalMap:O.bumpMap?oe=O.bumpMap:O.roughnessMap?oe=O.roughnessMap:O.metalnessMap?oe=O.metalnessMap:O.alphaMap?oe=O.alphaMap:O.emissiveMap?oe=O.emissiveMap:O.clearcoatMap?oe=O.clearcoatMap:O.clearcoatNormalMap?oe=O.clearcoatNormalMap:O.clearcoatRoughnessMap&&(oe=O.clearcoatRoughnessMap),oe!==void 0&&(oe.isWebGLRenderTarget&&(oe=oe.texture),oe.matrixAutoUpdate===!0&&oe.updateMatrix(),k.uvTransform.value.copy(oe.matrix));let re;O.aoMap?re=O.aoMap:O.lightMap&&(re=O.lightMap),re!==void 0&&(re.isWebGLRenderTarget&&(re=re.texture),re.matrixAutoUpdate===!0&&re.updateMatrix(),k.uv2Transform.value.copy(re.matrix))}function c(k,O){k.diffuse.value.copy(O.color),k.opacity.value=O.opacity}function h(k,O){k.dashSize.value=O.dashSize,k.totalSize.value=O.dashSize+O.gapSize,k.scale.value=O.scale}function p(k,O,se,oe){k.diffuse.value.copy(O.color),k.opacity.value=O.opacity,k.size.value=O.size*se,k.scale.value=oe*.5,O.map&&(k.map.value=O.map),O.alphaMap&&(k.alphaMap.value=O.alphaMap);let re;O.map?re=O.map:O.alphaMap&&(re=O.alphaMap),re!==void 0&&(re.matrixAutoUpdate===!0&&re.updateMatrix(),k.uvTransform.value.copy(re.matrix))}function g(k,O){k.diffuse.value.copy(O.color),k.opacity.value=O.opacity,k.rotation.value=O.rotation,O.map&&(k.map.value=O.map),O.alphaMap&&(k.alphaMap.value=O.alphaMap);let se;O.map?se=O.map:O.alphaMap&&(se=O.alphaMap),se!==void 0&&(se.matrixAutoUpdate===!0&&se.updateMatrix(),k.uvTransform.value.copy(se.matrix))}function _(k,O){O.emissiveMap&&(k.emissiveMap.value=O.emissiveMap)}function x(k,O){k.specular.value.copy(O.specular),k.shininess.value=Math.max(O.shininess,1e-4),O.emissiveMap&&(k.emissiveMap.value=O.emissiveMap),O.bumpMap&&(k.bumpMap.value=O.bumpMap,k.bumpScale.value=O.bumpScale,O.side===je&&(k.bumpScale.value*=-1)),O.normalMap&&(k.normalMap.value=O.normalMap,k.normalScale.value.copy(O.normalScale),O.side===je&&k.normalScale.value.negate()),O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias)}function E(k,O){O.gradientMap&&(k.gradientMap.value=O.gradientMap),O.emissiveMap&&(k.emissiveMap.value=O.emissiveMap),O.bumpMap&&(k.bumpMap.value=O.bumpMap,k.bumpScale.value=O.bumpScale,O.side===je&&(k.bumpScale.value*=-1)),O.normalMap&&(k.normalMap.value=O.normalMap,k.normalScale.value.copy(O.normalScale),O.side===je&&k.normalScale.value.negate()),O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias)}function S(k,O){k.roughness.value=O.roughness,k.metalness.value=O.metalness,O.roughnessMap&&(k.roughnessMap.value=O.roughnessMap),O.metalnessMap&&(k.metalnessMap.value=O.metalnessMap),O.emissiveMap&&(k.emissiveMap.value=O.emissiveMap),O.bumpMap&&(k.bumpMap.value=O.bumpMap,k.bumpScale.value=O.bumpScale,O.side===je&&(k.bumpScale.value*=-1)),O.normalMap&&(k.normalMap.value=O.normalMap,k.normalScale.value.copy(O.normalScale),O.side===je&&k.normalScale.value.negate()),O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias),i.get(O).envMap&&(k.envMapIntensity.value=O.envMapIntensity)}function C(k,O){S(k,O),k.reflectivity.value=O.reflectivity,k.clearcoat.value=O.clearcoat,k.clearcoatRoughness.value=O.clearcoatRoughness,O.sheen&&k.sheen.value.copy(O.sheen),O.clearcoatMap&&(k.clearcoatMap.value=O.clearcoatMap),O.clearcoatRoughnessMap&&(k.clearcoatRoughnessMap.value=O.clearcoatRoughnessMap),O.clearcoatNormalMap&&(k.clearcoatNormalScale.value.copy(O.clearcoatNormalScale),k.clearcoatNormalMap.value=O.clearcoatNormalMap,O.side===je&&k.clearcoatNormalScale.value.negate()),k.transmission.value=O.transmission,O.transmissionMap&&(k.transmissionMap.value=O.transmissionMap)}function I(k,O){O.matcap&&(k.matcap.value=O.matcap),O.bumpMap&&(k.bumpMap.value=O.bumpMap,k.bumpScale.value=O.bumpScale,O.side===je&&(k.bumpScale.value*=-1)),O.normalMap&&(k.normalMap.value=O.normalMap,k.normalScale.value.copy(O.normalScale),O.side===je&&k.normalScale.value.negate()),O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias)}function F(k,O){O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias)}function z(k,O){O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias),k.referencePosition.value.copy(O.referencePosition),k.nearDistance.value=O.nearDistance,k.farDistance.value=O.farDistance}function G(k,O){O.bumpMap&&(k.bumpMap.value=O.bumpMap,k.bumpScale.value=O.bumpScale,O.side===je&&(k.bumpScale.value*=-1)),O.normalMap&&(k.normalMap.value=O.normalMap,k.normalScale.value.copy(O.normalScale),O.side===je&&k.normalScale.value.negate()),O.displacementMap&&(k.displacementMap.value=O.displacementMap,k.displacementScale.value=O.displacementScale,k.displacementBias.value=O.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function GA(){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.style.display="block",i}function Dl(i){i=i||{};const t=i.canvas!==void 0?i.canvas:GA(),n=i.context!==void 0?i.context:null,u=i.alpha!==void 0?i.alpha:!1,c=i.depth!==void 0?i.depth:!0,h=i.stencil!==void 0?i.stencil:!0,p=i.antialias!==void 0?i.antialias:!1,g=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,_=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,x=i.powerPreference!==void 0?i.powerPreference:"default",E=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let S=null,C=null;const I=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=ls,this.physicallyCorrectLights=!1,this.toneMapping=Ia,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const F=this;let z=!1,G=null,k=0,O=0,se=null,oe=null,re=-1,X=null;const me=new pi,ke=new pi;let xe=null,Se=t.width,we=t.height,Re=1,he=null,ce=null;const pe=new pi(0,0,Se,we),Te=new pi(0,0,Se,we);let He=!1;const Xe=new pc;let Qe=!1,lt=!1;const rt=new Ut,Et=new te,Dt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ht(){return se===null?Re:1}let Ve=n;function zi(ee,Oe){for(let Ae=0;Ae<ee.length;Ae++){const Ne=ee[Ae],pt=t.getContext(Ne,Oe);if(pt!==null)return pt}return null}try{const ee={alpha:u,depth:c,stencil:h,antialias:p,premultipliedAlpha:g,preserveDrawingBuffer:_,powerPreference:x,failIfMajorPerformanceCaveat:E};if(t.addEventListener("webglcontextlost",Ei,!1),t.addEventListener("webglcontextrestored",pn,!1),Ve===null){const Oe=["webgl2","webgl","experimental-webgl"];if(F.isWebGL1Renderer===!0&&Oe.shift(),Ve=zi(Oe,ee),Ve===null)throw zi(Oe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ve.getShaderPrecisionFormat===void 0&&(Ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ee){throw console.error("THREE.WebGLRenderer: "+ee.message),ee}let It,qt,Rt,ti,kt,$e,nt,st,ve,Ze,$,Q,Ue,Be,le,Fe,dt,bt,ot,yt,mt;function Bt(){It=new _T(Ve),qt=new gT(Ve,It,i),It.init(qt),yt=new HA(Ve,It,qt),Rt=new NA(Ve,It,qt),Rt.scissor(ke.copy(Te).multiplyScalar(Re).floor()),Rt.viewport(me.copy(pe).multiplyScalar(Re).floor()),ti=new TT,kt=new EA,$e=new UA(Ve,It,Rt,kt,qt,yt,ti),nt=new yT(F),st=new W_(Ve,qt),mt=new pT(Ve,It,st,qt),ve=new xT(Ve,st,ti,mt),Ze=new ET(Ve,ve,st,ti),dt=new wT(Ve),le=new vT(kt),$=new wA(F,nt,It,qt,mt,le),Q=new VA(kt),Ue=new PA(kt),Be=new FA(It,qt),Fe=new fT(F,nt,Rt,Ze,g),bt=new mT(Ve,It,ti,qt),ot=new bT(Ve,It,ti,qt),ti.programs=$.programs,F.capabilities=qt,F.extensions=It,F.properties=kt,F.renderLists=Ue,F.state=Rt,F.info=ti}Bt();const _t=new Gm(F,Ve);this.xr=_t;const Ct=new Vm(F,Ze,qt.maxTextureSize);this.shadowMap=Ct,this.getContext=function(){return Ve},this.getContextAttributes=function(){return Ve.getContextAttributes()},this.forceContextLoss=function(){const ee=It.get("WEBGL_lose_context");ee&&ee.loseContext()},this.forceContextRestore=function(){const ee=It.get("WEBGL_lose_context");ee&&ee.restoreContext()},this.getPixelRatio=function(){return Re},this.setPixelRatio=function(ee){ee!==void 0&&(Re=ee,this.setSize(Se,we,!1))},this.getSize=function(ee){return ee===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ee=new be),ee.set(Se,we)},this.setSize=function(ee,Oe,Ae){if(_t.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Se=ee,we=Oe,t.width=Math.floor(ee*Re),t.height=Math.floor(Oe*Re),Ae!==!1&&(t.style.width=ee+"px",t.style.height=Oe+"px"),this.setViewport(0,0,ee,Oe)},this.getDrawingBufferSize=function(ee){return ee===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ee=new be),ee.set(Se*Re,we*Re).floor()},this.setDrawingBufferSize=function(ee,Oe,Ae){Se=ee,we=Oe,Re=Ae,t.width=Math.floor(ee*Ae),t.height=Math.floor(Oe*Ae),this.setViewport(0,0,ee,Oe)},this.getCurrentViewport=function(ee){return ee===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ee=new pi),ee.copy(me)},this.getViewport=function(ee){return ee.copy(pe)},this.setViewport=function(ee,Oe,Ae,Ne){ee.isVector4?pe.set(ee.x,ee.y,ee.z,ee.w):pe.set(ee,Oe,Ae,Ne),Rt.viewport(me.copy(pe).multiplyScalar(Re).floor())},this.getScissor=function(ee){return ee.copy(Te)},this.setScissor=function(ee,Oe,Ae,Ne){ee.isVector4?Te.set(ee.x,ee.y,ee.z,ee.w):Te.set(ee,Oe,Ae,Ne),Rt.scissor(ke.copy(Te).multiplyScalar(Re).floor())},this.getScissorTest=function(){return He},this.setScissorTest=function(ee){Rt.setScissorTest(He=ee)},this.setOpaqueSort=function(ee){he=ee},this.setTransparentSort=function(ee){ce=ee},this.getClearColor=function(ee){return ee===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),ee=new Mt),ee.copy(Fe.getClearColor())},this.setClearColor=function(){Fe.setClearColor.apply(Fe,arguments)},this.getClearAlpha=function(){return Fe.getClearAlpha()},this.setClearAlpha=function(){Fe.setClearAlpha.apply(Fe,arguments)},this.clear=function(ee,Oe,Ae){let Ne=0;(ee===void 0||ee)&&(Ne|=16384),(Oe===void 0||Oe)&&(Ne|=256),(Ae===void 0||Ae)&&(Ne|=1024),Ve.clear(Ne)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ei,!1),t.removeEventListener("webglcontextrestored",pn,!1),Ue.dispose(),Be.dispose(),kt.dispose(),nt.dispose(),Ze.dispose(),mt.dispose(),_t.dispose(),As.stop()};function Ei(ee){ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),z=!0}function pn(){console.log("THREE.WebGLRenderer: Context Restored."),z=!1,Bt()}function Ya(ee){const Oe=ee.target;Oe.removeEventListener("dispose",Ya),Sf(Oe)}function Sf(ee){Ka(ee),kt.remove(ee)}function Ka(ee){const Oe=kt.get(ee).program;Oe!==void 0&&$.releaseProgram(Oe)}function fa(ee,Oe){ee.render(function(Ae){F.renderBufferImmediate(Ae,Oe)})}this.renderBufferImmediate=function(ee,Oe){mt.initAttributes();const Ae=kt.get(ee);ee.hasPositions&&!Ae.position&&(Ae.position=Ve.createBuffer()),ee.hasNormals&&!Ae.normal&&(Ae.normal=Ve.createBuffer()),ee.hasUvs&&!Ae.uv&&(Ae.uv=Ve.createBuffer()),ee.hasColors&&!Ae.color&&(Ae.color=Ve.createBuffer());const Ne=Oe.getAttributes();ee.hasPositions&&(Ve.bindBuffer(34962,Ae.position),Ve.bufferData(34962,ee.positionArray,35048),mt.enableAttribute(Ne.position),Ve.vertexAttribPointer(Ne.position,3,5126,!1,0,0)),ee.hasNormals&&(Ve.bindBuffer(34962,Ae.normal),Ve.bufferData(34962,ee.normalArray,35048),mt.enableAttribute(Ne.normal),Ve.vertexAttribPointer(Ne.normal,3,5126,!1,0,0)),ee.hasUvs&&(Ve.bindBuffer(34962,Ae.uv),Ve.bufferData(34962,ee.uvArray,35048),mt.enableAttribute(Ne.uv),Ve.vertexAttribPointer(Ne.uv,2,5126,!1,0,0)),ee.hasColors&&(Ve.bindBuffer(34962,Ae.color),Ve.bufferData(34962,ee.colorArray,35048),mt.enableAttribute(Ne.color),Ve.vertexAttribPointer(Ne.color,3,5126,!1,0,0)),mt.disableUnusedAttributes(),Ve.drawArrays(4,0,ee.count),ee.count=0},this.renderBufferDirect=function(ee,Oe,Ae,Ne,pt,Yt){Oe===null&&(Oe=Dt);const zt=pt.isMesh&&pt.matrixWorld.determinant()<0,$t=Nc(ee,Oe,Ne,pt);Rt.setMaterial(Ne,zt);let Wt=Ae.index;const Hi=Ae.attributes.position;if(Wt===null){if(Hi===void 0||Hi.count===0)return}else if(Wt.count===0)return;let Ni=1;Ne.wireframe===!0&&(Wt=ve.getWireframeAttribute(Ae),Ni=2),(Ne.morphTargets||Ne.morphNormals)&&dt.update(pt,Ae,Ne,$t),mt.setup(pt,Ne,$t,Ae,Wt);let Vt,di=bt;Wt!==null&&(Vt=st.get(Wt),di=ot,di.setIndex(Vt));const br=Wt!==null?Wt.count:Hi.count,xi=Ae.drawRange.start*Ni,oi=Ae.drawRange.count*Ni,Yi=Yt!==null?Yt.start*Ni:0,Za=Yt!==null?Yt.count*Ni:1/0,ni=Math.max(xi,Yi),M=Math.min(br,xi+oi,Yi+Za)-1,D=Math.max(0,M-ni+1);if(D!==0){if(pt.isMesh)Ne.wireframe===!0?(Rt.setLineWidth(Ne.wireframeLinewidth*Ht()),di.setMode(1)):di.setMode(4);else if(pt.isLine){let N=Ne.linewidth;N===void 0&&(N=1),Rt.setLineWidth(N*Ht()),pt.isLineSegments?di.setMode(1):pt.isLineLoop?di.setMode(2):di.setMode(3)}else pt.isPoints?di.setMode(0):pt.isSprite&&di.setMode(4);if(pt.isInstancedMesh)di.renderInstances(ni,D,pt.count);else if(Ae.isInstancedBufferGeometry){const N=Math.min(Ae.instanceCount,Ae._maxInstanceCount);di.renderInstances(ni,D,N)}else di.render(ni,D)}},this.compile=function(ee,Oe){C=Be.get(ee),C.init(),ee.traverseVisible(function(Ne){Ne.isLight&&Ne.layers.test(Oe.layers)&&(C.pushLight(Ne),Ne.castShadow&&C.pushShadow(Ne))}),C.setupLights();const Ae=new WeakMap;ee.traverse(function(Ne){const pt=Ne.material;if(pt)if(Array.isArray(pt))for(let Yt=0;Yt<pt.length;Yt++){const zt=pt[Yt];Ae.has(zt)===!1&&(xr(zt,ee,Ne),Ae.set(zt))}else Ae.has(pt)===!1&&(xr(pt,ee,Ne),Ae.set(pt))})};let Eo=null;function Rn(ee){_t.isPresenting||Eo&&Eo(ee)}const As=new _m;As.setAnimationLoop(Rn),typeof window<"u"&&As.setContext(window),this.setAnimationLoop=function(ee){Eo=ee,_t.setAnimationLoop(ee),ee===null?As.stop():As.start()},this.render=function(ee,Oe){let Ae,Ne;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Ae=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Ne=arguments[3]),Oe!==void 0&&Oe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(z===!0)return;mt.resetDefaultState(),re=-1,X=null,ee.autoUpdate===!0&&ee.updateMatrixWorld(),Oe.parent===null&&Oe.updateMatrixWorld(),_t.enabled===!0&&_t.isPresenting===!0&&(Oe=_t.getCamera(Oe)),ee.isScene===!0&&ee.onBeforeRender(F,ee,Oe,Ae||se),C=Be.get(ee,I.length),C.init(),I.push(C),rt.multiplyMatrices(Oe.projectionMatrix,Oe.matrixWorldInverse),Xe.setFromProjectionMatrix(rt),lt=this.localClippingEnabled,Qe=le.init(this.clippingPlanes,lt,Oe),S=Ue.get(ee,Oe),S.init(),kc(ee,Oe,0,F.sortObjects),S.finish(),F.sortObjects===!0&&S.sort(he,ce),Qe===!0&&le.beginShadows();const pt=C.state.shadowsArray;Ct.render(pt,ee,Oe),C.setupLights(),C.setupLightsView(Oe),Qe===!0&&le.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ae!==void 0&&this.setRenderTarget(Ae),Fe.render(S,ee,Oe,Ne);const Yt=S.opaque,zt=S.transparent;Yt.length>0&&Bc(Yt,ee,Oe),zt.length>0&&Bc(zt,ee,Oe),ee.isScene===!0&&ee.onAfterRender(F,ee,Oe),se!==null&&($e.updateRenderTargetMipmap(se),$e.updateMultisampleRenderTarget(se)),Rt.buffers.depth.setTest(!0),Rt.buffers.depth.setMask(!0),Rt.buffers.color.setMask(!0),Rt.setPolygonOffset(!1),I.pop(),I.length>0?C=I[I.length-1]:C=null,S=null};function kc(ee,Oe,Ae,Ne){if(ee.visible===!1)return;if(ee.layers.test(Oe.layers)){if(ee.isGroup)Ae=ee.renderOrder;else if(ee.isLOD)ee.autoUpdate===!0&&ee.update(Oe);else if(ee.isLight)C.pushLight(ee),ee.castShadow&&C.pushShadow(ee);else if(ee.isSprite){if(!ee.frustumCulled||Xe.intersectsSprite(ee)){Ne&&Et.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(rt);const zt=Ze.update(ee),$t=ee.material;$t.visible&&S.push(ee,zt,$t,Ae,Et.z,null)}}else if(ee.isImmediateRenderObject)Ne&&Et.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(rt),S.push(ee,null,ee.material,Ae,Et.z,null);else if((ee.isMesh||ee.isLine||ee.isPoints)&&(ee.isSkinnedMesh&&ee.skeleton.frame!==ti.render.frame&&(ee.skeleton.update(),ee.skeleton.frame=ti.render.frame),!ee.frustumCulled||Xe.intersectsObject(ee))){Ne&&Et.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(rt);const zt=Ze.update(ee),$t=ee.material;if(Array.isArray($t)){const Wt=zt.groups;for(let Hi=0,Ni=Wt.length;Hi<Ni;Hi++){const Vt=Wt[Hi],di=$t[Vt.materialIndex];di&&di.visible&&S.push(ee,zt,di,Ae,Et.z,Vt)}}else $t.visible&&S.push(ee,zt,$t,Ae,Et.z,null)}}const Yt=ee.children;for(let zt=0,$t=Yt.length;zt<$t;zt++)kc(Yt[zt],Oe,Ae,Ne)}function Bc(ee,Oe,Ae){const Ne=Oe.isScene===!0?Oe.overrideMaterial:null;for(let pt=0,Yt=ee.length;pt<Yt;pt++){const zt=ee[pt],$t=zt.object,Wt=zt.geometry,Hi=Ne===null?zt.material:Ne,Ni=zt.group;if(Ae.isArrayCamera){const Vt=Ae.cameras;for(let di=0,br=Vt.length;di<br;di++){const xi=Vt[di];$t.layers.test(xi.layers)&&(Rt.viewport(me.copy(xi.viewport)),C.setupLightsView(xi),Mo($t,Oe,xi,Wt,Hi,Ni))}}else Mo($t,Oe,Ae,Wt,Hi,Ni)}}function Mo(ee,Oe,Ae,Ne,pt,Yt){if(ee.onBeforeRender(F,Oe,Ae,Ne,pt,Yt),ee.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),ee.isImmediateRenderObject){const zt=Nc(Ae,Oe,pt,ee);Rt.setMaterial(pt),mt.reset(),fa(ee,zt)}else F.renderBufferDirect(Ae,Oe,Ne,pt,ee,Yt);ee.onAfterRender(F,Oe,Ae,Ne,pt,Yt)}function xr(ee,Oe,Ae){Oe.isScene!==!0&&(Oe=Dt);const Ne=kt.get(ee),pt=C.state.lights,Yt=C.state.shadowsArray,zt=pt.state.version,$t=$.getParameters(ee,pt.state,Yt,Oe,Ae),Wt=$.getProgramCacheKey($t);let Hi=Ne.program,Ni=!0;if(Ne.environment=ee.isMeshStandardMaterial?Oe.environment:null,Ne.fog=Oe.fog,Ne.envMap=nt.get(ee.envMap||Ne.environment),Hi===void 0)ee.addEventListener("dispose",Ya);else if(Hi.cacheKey!==Wt)Ka(ee);else if(Ne.lightsStateVersion!==zt)Ni=!1;else{if($t.shaderID!==void 0)return;Ni=!1}Ni&&($t.uniforms=$.getUniforms(ee),ee.onBeforeCompile($t,F),Hi=$.acquireProgram($t,Wt),Ne.program=Hi,Ne.uniforms=$t.uniforms,Ne.outputEncoding=$t.outputEncoding);const Vt=Ne.uniforms;(!ee.isShaderMaterial&&!ee.isRawShaderMaterial||ee.clipping===!0)&&(Ne.numClippingPlanes=le.numPlanes,Ne.numIntersection=le.numIntersection,Vt.clippingPlanes=le.uniform),Ne.needsLights=wf(ee),Ne.lightsStateVersion=zt,Ne.needsLights&&(Vt.ambientLightColor.value=pt.state.ambient,Vt.lightProbe.value=pt.state.probe,Vt.directionalLights.value=pt.state.directional,Vt.directionalLightShadows.value=pt.state.directionalShadow,Vt.spotLights.value=pt.state.spot,Vt.spotLightShadows.value=pt.state.spotShadow,Vt.rectAreaLights.value=pt.state.rectArea,Vt.ltc_1.value=pt.state.rectAreaLTC1,Vt.ltc_2.value=pt.state.rectAreaLTC2,Vt.pointLights.value=pt.state.point,Vt.pointLightShadows.value=pt.state.pointShadow,Vt.hemisphereLights.value=pt.state.hemi,Vt.directionalShadowMap.value=pt.state.directionalShadowMap,Vt.directionalShadowMatrix.value=pt.state.directionalShadowMatrix,Vt.spotShadowMap.value=pt.state.spotShadowMap,Vt.spotShadowMatrix.value=pt.state.spotShadowMatrix,Vt.pointShadowMap.value=pt.state.pointShadowMap,Vt.pointShadowMatrix.value=pt.state.pointShadowMatrix);const di=Ne.program.getUniforms(),br=qa.seqWithValue(di.seq,Vt);Ne.uniformsList=br}function Nc(ee,Oe,Ae,Ne){Oe.isScene!==!0&&(Oe=Dt),$e.resetTextureUnits();const pt=Oe.fog,Yt=Ae.isMeshStandardMaterial?Oe.environment:null,zt=se===null?F.outputEncoding:se.texture.encoding,$t=nt.get(Ae.envMap||Yt),Wt=kt.get(Ae),Hi=C.state.lights;if(Qe===!0&&(lt===!0||ee!==X)){const Yi=ee===X&&Ae.id===re;le.setState(Ae,ee,Yi)}Ae.version===Wt.__version?(Ae.fog&&Wt.fog!==pt||Wt.environment!==Yt||Wt.needsLights&&Wt.lightsStateVersion!==Hi.state.version||Wt.numClippingPlanes!==void 0&&(Wt.numClippingPlanes!==le.numPlanes||Wt.numIntersection!==le.numIntersection)||Wt.outputEncoding!==zt||Wt.envMap!==$t)&&xr(Ae,Oe,Ne):(xr(Ae,Oe,Ne),Wt.__version=Ae.version);let Ni=!1,Vt=!1,di=!1;const br=Wt.program,xi=br.getUniforms(),oi=Wt.uniforms;if(Rt.useProgram(br.program)&&(Ni=!0,Vt=!0,di=!0),Ae.id!==re&&(re=Ae.id,Vt=!0),Ni||X!==ee){if(xi.setValue(Ve,"projectionMatrix",ee.projectionMatrix),qt.logarithmicDepthBuffer&&xi.setValue(Ve,"logDepthBufFC",2/(Math.log(ee.far+1)/Math.LN2)),X!==ee&&(X=ee,Vt=!0,di=!0),Ae.isShaderMaterial||Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshStandardMaterial||Ae.envMap){const Yi=xi.map.cameraPosition;Yi!==void 0&&Yi.setValue(Ve,Et.setFromMatrixPosition(ee.matrixWorld))}(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&xi.setValue(Ve,"isOrthographic",ee.isOrthographicCamera===!0),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial||Ae.isShadowMaterial||Ae.skinning)&&xi.setValue(Ve,"viewMatrix",ee.matrixWorldInverse)}if(Ae.skinning){xi.setOptional(Ve,Ne,"bindMatrix"),xi.setOptional(Ve,Ne,"bindMatrixInverse");const Yi=Ne.skeleton;if(Yi){const Za=Yi.bones;if(qt.floatVertexTextures){if(Yi.boneTexture===null){let ni=Math.sqrt(Za.length*4);ni=At.ceilPowerOfTwo(ni),ni=Math.max(ni,4);const M=new Float32Array(ni*ni*4);M.set(Yi.boneMatrices);const D=new oo(M,ni,ni,fi,ei);Yi.boneMatrices=M,Yi.boneTexture=D,Yi.boneTextureSize=ni}xi.setValue(Ve,"boneTexture",Yi.boneTexture,$e),xi.setValue(Ve,"boneTextureSize",Yi.boneTextureSize)}else xi.setOptional(Ve,Yi,"boneMatrices")}}return(Vt||Wt.receiveShadow!==Ne.receiveShadow)&&(Wt.receiveShadow=Ne.receiveShadow,xi.setValue(Ve,"receiveShadow",Ne.receiveShadow)),Vt&&(xi.setValue(Ve,"toneMappingExposure",F.toneMappingExposure),Wt.needsLights&&pa(oi,di),pt&&Ae.fog&&Q.refreshFogUniforms(oi,pt),Q.refreshMaterialUniforms(oi,Ae,Re,we),qa.upload(Ve,Wt.uniformsList,oi,$e)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&(qa.upload(Ve,Wt.uniformsList,oi,$e),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&xi.setValue(Ve,"center",Ne.center),xi.setValue(Ve,"modelViewMatrix",Ne.modelViewMatrix),xi.setValue(Ve,"normalMatrix",Ne.normalMatrix),xi.setValue(Ve,"modelMatrix",Ne.matrixWorld),br}function pa(ee,Oe){ee.ambientLightColor.needsUpdate=Oe,ee.lightProbe.needsUpdate=Oe,ee.directionalLights.needsUpdate=Oe,ee.directionalLightShadows.needsUpdate=Oe,ee.pointLights.needsUpdate=Oe,ee.pointLightShadows.needsUpdate=Oe,ee.spotLights.needsUpdate=Oe,ee.spotLightShadows.needsUpdate=Oe,ee.rectAreaLights.needsUpdate=Oe,ee.hemisphereLights.needsUpdate=Oe}function wf(ee){return ee.isMeshLambertMaterial||ee.isMeshToonMaterial||ee.isMeshPhongMaterial||ee.isMeshStandardMaterial||ee.isShadowMaterial||ee.isShaderMaterial&&ee.lights===!0}this.setFramebuffer=function(ee){G!==ee&&se===null&&Ve.bindFramebuffer(36160,ee),G=ee},this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return O},this.getRenderList=function(){return S},this.setRenderList=function(ee){S=ee},this.getRenderTarget=function(){return se},this.setRenderTarget=function(ee,Oe=0,Ae=0){se=ee,k=Oe,O=Ae,ee&&kt.get(ee).__webglFramebuffer===void 0&&$e.setupRenderTarget(ee);let Ne=G,pt=!1;if(ee){const Yt=kt.get(ee).__webglFramebuffer;ee.isWebGLCubeRenderTarget?(Ne=Yt[Oe],pt=!0):ee.isWebGLMultisampleRenderTarget?Ne=kt.get(ee).__webglMultisampledFramebuffer:Ne=Yt,me.copy(ee.viewport),ke.copy(ee.scissor),xe=ee.scissorTest}else me.copy(pe).multiplyScalar(Re).floor(),ke.copy(Te).multiplyScalar(Re).floor(),xe=He;if(oe!==Ne&&(Ve.bindFramebuffer(36160,Ne),oe=Ne),Rt.viewport(me),Rt.scissor(ke),Rt.setScissorTest(xe),pt){const Yt=kt.get(ee.texture);Ve.framebufferTexture2D(36160,36064,34069+Oe,Yt.__webglTexture,Ae)}},this.readRenderTargetPixels=function(ee,Oe,Ae,Ne,pt,Yt,zt){if(!(ee&&ee.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let $t=kt.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&zt!==void 0&&($t=$t[zt]),$t){let Wt=!1;$t!==oe&&(Ve.bindFramebuffer(36160,$t),Wt=!0);try{const Hi=ee.texture,Ni=Hi.format,Vt=Hi.type;if(Ni!==fi&&yt.convert(Ni)!==Ve.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const di=Vt===Fs&&(It.has("EXT_color_buffer_half_float")||qt.isWebGL2&&It.has("EXT_color_buffer_float"));if(Vt!==ln&&yt.convert(Vt)!==Ve.getParameter(35738)&&!(Vt===ei&&(qt.isWebGL2||It.has("OES_texture_float")||It.has("WEBGL_color_buffer_float")))&&!di){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ve.checkFramebufferStatus(36160)===36053?Oe>=0&&Oe<=ee.width-Ne&&Ae>=0&&Ae<=ee.height-pt&&Ve.readPixels(Oe,Ae,Ne,pt,yt.convert(Ni),yt.convert(Vt),Yt):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Wt&&Ve.bindFramebuffer(36160,oe)}}},this.copyFramebufferToTexture=function(ee,Oe,Ae=0){const Ne=Math.pow(2,-Ae),pt=Math.floor(Oe.image.width*Ne),Yt=Math.floor(Oe.image.height*Ne),zt=yt.convert(Oe.format);$e.setTexture2D(Oe,0),Ve.copyTexImage2D(3553,Ae,zt,ee.x,ee.y,pt,Yt,0),Rt.unbindTexture()},this.copyTextureToTexture=function(ee,Oe,Ae,Ne=0){const pt=Oe.image.width,Yt=Oe.image.height,zt=yt.convert(Ae.format),$t=yt.convert(Ae.type);$e.setTexture2D(Ae,0),Ve.pixelStorei(37440,Ae.flipY),Ve.pixelStorei(37441,Ae.premultiplyAlpha),Ve.pixelStorei(3317,Ae.unpackAlignment),Oe.isDataTexture?Ve.texSubImage2D(3553,Ne,ee.x,ee.y,pt,Yt,zt,$t,Oe.image.data):Oe.isCompressedTexture?Ve.compressedTexSubImage2D(3553,Ne,ee.x,ee.y,Oe.mipmaps[0].width,Oe.mipmaps[0].height,zt,Oe.mipmaps[0].data):Ve.texSubImage2D(3553,Ne,ee.x,ee.y,zt,$t,Oe.image),Ne===0&&Ae.generateMipmaps&&Ve.generateMipmap(3553),Rt.unbindTexture()},this.initTexture=function(ee){$e.setTexture2D(ee,0),Rt.unbindTexture()},this.resetState=function(){Rt.reset(),mt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function zm(i){Dl.call(this,i)}zm.prototype=J(Object.create(Dl.prototype),{constructor:zm,isWebGL1Renderer:!0});class Wm extends gt{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,n){return super.copy(t,n),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const n=super.toJSON(t);return this.background!==null&&(n.object.background=this.background.toJSON(t)),this.environment!==null&&(n.object.environment=this.environment.toJSON(t)),this.fog!==null&&(n.object.fog=this.fog.toJSON()),n}}function nr(i,t){this.array=i,this.stride=t,this.count=i!==void 0?i.length/t:0,this.usage=Qs,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=At.generateUUID()}Object.defineProperty(nr.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),J(nr.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,t,n){i*=this.stride,n*=t.stride;for(let u=0,c=this.stride;u<c;u++)this.array[i+u]=t.array[n+u];return this},set:function(i,t=0){return this.array.set(i,t),this},clone:function(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=At.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),n=new nr(t,this.stride);return n.setUsage(this.usage),n},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=At.generateUUID()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const gs=new te;function vs(i,t,n,u){this.name="",this.data=i,this.itemSize=t,this.offset=n,this.normalized=u===!0}Object.defineProperties(vs.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}}),J(vs.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(let t=0,n=this.data.count;t<n;t++)gs.x=this.getX(t),gs.y=this.getY(t),gs.z=this.getZ(t),gs.applyMatrix4(i),this.setXYZ(t,gs.x,gs.y,gs.z);return this},setX:function(i,t){return this.data.array[i*this.data.stride+this.offset]=t,this},setY:function(i,t){return this.data.array[i*this.data.stride+this.offset+1]=t,this},setZ:function(i,t){return this.data.array[i*this.data.stride+this.offset+2]=t,this},setW:function(i,t){return this.data.array[i*this.data.stride+this.offset+3]=t,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,t,n){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=n,this},setXYZ:function(i,t,n,u){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=n,this.data.array[i+2]=u,this},setXYZW:function(i,t,n,u,c){return i=i*this.data.stride+this.offset,this.data.array[i+0]=t,this.data.array[i+1]=n,this.data.array[i+2]=u,this.data.array[i+3]=c,this},clone:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const u=n*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)t.push(this.data.array[u+c])}return new Qt(new this.array.constructor(t),this.itemSize,this.normalized)}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new vs(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const u=n*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)t.push(this.data.array[u+c])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});function ys(i){Lt.call(this),this.type="SpriteMaterial",this.color=new Mt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(i)}ys.prototype=Object.create(Lt.prototype),ys.prototype.constructor=ys,ys.prototype.isSpriteMaterial=!0,ys.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.rotation=i.rotation,this.sizeAttenuation=i.sizeAttenuation,this};let ho;const Rl=new te,fo=new te,po=new te,mo=new be,Ol=new be,jm=new Ut,mc=new te,Fl=new te,gc=new te,qm=new be,jh=new be,Xm=new be;function Qm(i){if(gt.call(this),this.type="Sprite",ho===void 0){ho=new mi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new nr(t,5);ho.setIndex([0,1,2,0,2,3]),ho.setAttribute("position",new vs(n,3,0,!1)),ho.setAttribute("uv",new vs(n,2,3,!1))}this.geometry=ho,this.material=i!==void 0?i:new ys,this.center=new be(.5,.5)}Qm.prototype=J(Object.create(gt.prototype),{constructor:Qm,isSprite:!0,raycast:function(i,t){i.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),fo.setFromMatrixScale(this.matrixWorld),jm.copy(i.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(i.camera.matrixWorldInverse,this.matrixWorld),po.setFromMatrixPosition(this.modelViewMatrix),i.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&fo.multiplyScalar(-po.z);const n=this.material.rotation;let u,c;n!==0&&(c=Math.cos(n),u=Math.sin(n));const h=this.center;vc(mc.set(-.5,-.5,0),po,h,fo,u,c),vc(Fl.set(.5,-.5,0),po,h,fo,u,c),vc(gc.set(.5,.5,0),po,h,fo,u,c),qm.set(0,0),jh.set(1,0),Xm.set(1,1);let p=i.ray.intersectTriangle(mc,Fl,gc,!1,Rl);if(p===null&&(vc(Fl.set(-.5,.5,0),po,h,fo,u,c),jh.set(0,1),p=i.ray.intersectTriangle(mc,gc,Fl,!1,Rl),p===null))return;const g=i.ray.origin.distanceTo(Rl);g<i.near||g>i.far||t.push({distance:g,point:Rl.clone(),uv:yn.getUV(Rl,mc,Fl,gc,qm,jh,Xm,new be),face:null,object:this})},copy:function(i){return gt.prototype.copy.call(this,i),i.center!==void 0&&this.center.copy(i.center),this.material=i.material,this}});function vc(i,t,n,u,c,h){mo.subVectors(i,n).addScalar(.5).multiply(u),c!==void 0?(Ol.x=h*mo.x-c*mo.y,Ol.y=c*mo.x+h*mo.y):Ol.copy(mo),i.copy(t),i.x+=Ol.x,i.y+=Ol.y,i.applyMatrix4(jm)}const yc=new te,Ym=new te;function qh(){gt.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}qh.prototype=J(Object.create(gt.prototype),{constructor:qh,isLOD:!0,copy:function(i){gt.prototype.copy.call(this,i,!1);const t=i.levels;for(let n=0,u=t.length;n<u;n++){const c=t[n];this.addLevel(c.object.clone(),c.distance)}return this.autoUpdate=i.autoUpdate,this},addLevel:function(i,t=0){t=Math.abs(t);const n=this.levels;let u;for(u=0;u<n.length&&!(t<n[u].distance);u++);return n.splice(u,0,{distance:t,object:i}),this.add(i),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(i){const t=this.levels;if(t.length>0){let n,u;for(n=1,u=t.length;n<u&&!(i<t[n].distance);n++);return t[n-1].object}return null},raycast:function(i,t){if(this.levels.length>0){yc.setFromMatrixPosition(this.matrixWorld);const u=i.ray.origin.distanceTo(yc);this.getObjectForDistance(u).raycast(i,t)}},update:function(i){const t=this.levels;if(t.length>1){yc.setFromMatrixPosition(i.matrixWorld),Ym.setFromMatrixPosition(this.matrixWorld);const n=yc.distanceTo(Ym)/i.zoom;t[0].object.visible=!0;let u,c;for(u=1,c=t.length;u<c&&n>=t[u].distance;u++)t[u-1].object.visible=!1,t[u].object.visible=!0;for(this._currentLevel=u-1;u<c;u++)t[u].object.visible=!1}},toJSON:function(i){const t=gt.prototype.toJSON.call(this,i);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let u=0,c=n.length;u<c;u++){const h=n[u];t.object.levels.push({object:h.object.uuid,distance:h.distance})}return t}});const Km=new te,Zm=new pi,$m=new pi,zA=new te,Jm=new Ut;function Xh(i,t){i&&i.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ii.call(this,i,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ut,this.bindMatrixInverse=new Ut}Xh.prototype=J(Object.create(Ii.prototype),{constructor:Xh,isSkinnedMesh:!0,copy:function(i){return Ii.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,t){this.skeleton=i,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const i=new pi,t=this.geometry.attributes.skinWeight;for(let n=0,u=t.count;n<u;n++){i.x=t.getX(n),i.y=t.getY(n),i.z=t.getZ(n),i.w=t.getW(n);const c=1/i.manhattanLength();c!==1/0?i.multiplyScalar(c):i.set(1,0,0,0),t.setXYZW(n,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){Ii.prototype.updateMatrixWorld.call(this,i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,t){const n=this.skeleton,u=this.geometry;Zm.fromBufferAttribute(u.attributes.skinIndex,i),$m.fromBufferAttribute(u.attributes.skinWeight,i),Km.fromBufferAttribute(u.attributes.position,i).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let c=0;c<4;c++){const h=$m.getComponent(c);if(h!==0){const p=Zm.getComponent(c);Jm.multiplyMatrices(n.bones[p].matrixWorld,n.boneInverses[p]),t.addScaledVector(zA.copy(Km).applyMatrix4(Jm),h)}}return t.applyMatrix4(this.bindMatrixInverse)}});function Qh(){gt.call(this),this.type="Bone"}Qh.prototype=J(Object.create(gt.prototype),{constructor:Qh,isBone:!0});const eg=new Ut,WA=new Ut;function Yh(i=[],t=[]){this.uuid=At.generateUUID(),this.bones=i.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}J(Yh.prototype,{init:function(){const i=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(i.length*16),t.length===0)this.calculateInverses();else if(i.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,u=this.bones.length;n<u;n++)this.boneInverses.push(new Ut)}},calculateInverses:function(){this.boneInverses.length=0;for(let i=0,t=this.bones.length;i<t;i++){const n=new Ut;this.bones[i]&&n.copy(this.bones[i].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(let i=0,t=this.bones.length;i<t;i++){const n=this.bones[i];n&&n.matrixWorld.copy(this.boneInverses[i]).invert()}for(let i=0,t=this.bones.length;i<t;i++){const n=this.bones[i];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}},update:function(){const i=this.bones,t=this.boneInverses,n=this.boneMatrices,u=this.boneTexture;for(let c=0,h=i.length;c<h;c++){const p=i[c]?i[c].matrixWorld:WA;eg.multiplyMatrices(p,t[c]),eg.toArray(n,c*16)}u!==null&&(u.needsUpdate=!0)},clone:function(){return new Yh(this.bones,this.boneInverses)},getBoneByName:function(i){for(let t=0,n=this.bones.length;t<n;t++){const u=this.bones[t];if(u.name===i)return u}},dispose:function(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(i,t){this.uuid=i.uuid;for(let n=0,u=i.bones.length;n<u;n++){const c=i.bones[n];let h=t[c];h===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",c),h=new Qh),this.bones.push(h),this.boneInverses.push(new Ut().fromArray(i.boneInverses[n]))}return this.init(),this},toJSON:function(){const i={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let u=0,c=t.length;u<c;u++){const h=t[u];i.bones.push(h.uuid);const p=n[u];i.boneInverses.push(p.toArray())}return i}});const tg=new Ut,ig=new Ut,_c=[],kl=new Ii;function ng(i,t,n){Ii.call(this,i,t),this.instanceMatrix=new Qt(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}ng.prototype=J(Object.create(Ii.prototype),{constructor:ng,isInstancedMesh:!0,copy:function(i){return Ii.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this},getColorAt:function(i,t){t.fromArray(this.instanceColor.array,i*3)},getMatrixAt:function(i,t){t.fromArray(this.instanceMatrix.array,i*16)},raycast:function(i,t){const n=this.matrixWorld,u=this.count;if(kl.geometry=this.geometry,kl.material=this.material,kl.material!==void 0)for(let c=0;c<u;c++){this.getMatrixAt(c,tg),ig.multiplyMatrices(n,tg),kl.matrixWorld=ig,kl.raycast(i,_c);for(let h=0,p=_c.length;h<p;h++){const g=_c[h];g.instanceId=c,g.object=this,t.push(g)}_c.length=0}},setColorAt:function(i,t){this.instanceColor===null&&(this.instanceColor=new Qt(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,i*3)},setMatrixAt:function(i,t){t.toArray(this.instanceMatrix.array,i*16)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Br(i){Lt.call(this),this.type="LineBasicMaterial",this.color=new Mt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(i)}Br.prototype=Object.create(Lt.prototype),Br.prototype.constructor=Br,Br.prototype.isLineBasicMaterial=!0,Br.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.morphTargets=i.morphTargets,this};const rg=new te,ag=new te,sg=new Ut,Kh=new hs,xc=new sa;function go(i=new mi,t=new Br){gt.call(this),this.type="Line",this.geometry=i,this.material=t,this.updateMorphTargets()}go.prototype=J(Object.create(gt.prototype),{constructor:go,isLine:!0,copy:function(i){return gt.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const t=i.attributes.position,n=[0];for(let u=1,c=t.count;u<c;u++)rg.fromBufferAttribute(t,u-1),ag.fromBufferAttribute(t,u),n[u]=n[u-1],n[u]+=rg.distanceTo(ag);i.setAttribute("lineDistance",new ki(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(i,t){const n=this.geometry,u=this.matrixWorld,c=i.params.Line.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),xc.copy(n.boundingSphere),xc.applyMatrix4(u),xc.radius+=c,i.ray.intersectsSphere(xc)===!1)return;sg.copy(u).invert(),Kh.copy(i.ray).applyMatrix4(sg);const h=c/((this.scale.x+this.scale.y+this.scale.z)/3),p=h*h,g=new te,_=new te,x=new te,E=new te,S=this.isLineSegments?2:1;if(n.isBufferGeometry){const C=n.index,F=n.attributes.position;if(C!==null){const z=C.array;for(let G=0,k=z.length-1;G<k;G+=S){const O=z[G],se=z[G+1];if(g.fromBufferAttribute(F,O),_.fromBufferAttribute(F,se),Kh.distanceSqToSegment(g,_,E,x)>p)continue;E.applyMatrix4(this.matrixWorld);const re=i.ray.origin.distanceTo(E);re<i.near||re>i.far||t.push({distance:re,point:x.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else for(let z=0,G=F.count-1;z<G;z+=S){if(g.fromBufferAttribute(F,z),_.fromBufferAttribute(F,z+1),Kh.distanceSqToSegment(g,_,E,x)>p)continue;E.applyMatrix4(this.matrixWorld);const O=i.ray.origin.distanceTo(E);O<i.near||O>i.far||t.push({distance:O,point:x.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const t=i.morphAttributes,n=Object.keys(t);if(n.length>0){const u=t[n[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,h=u.length;c<h;c++){const p=u[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=c}}}}else{const t=i.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const og=new te,lg=new te;function ug(i,t){go.call(this,i,t),this.type="LineSegments"}ug.prototype=J(Object.create(go.prototype),{constructor:ug,isLineSegments:!0,computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(i.index===null){const t=i.attributes.position,n=[];for(let u=0,c=t.count;u<c;u+=2)og.fromBufferAttribute(t,u),lg.fromBufferAttribute(t,u+1),n[u]=u===0?0:n[u-1],n[u+1]=n[u]+og.distanceTo(lg);i.setAttribute("lineDistance",new ki(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});function cg(i,t){go.call(this,i,t),this.type="LineLoop"}cg.prototype=J(Object.create(go.prototype),{constructor:cg,isLineLoop:!0});function _s(i){Lt.call(this),this.type="PointsMaterial",this.color=new Mt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(i)}_s.prototype=Object.create(Lt.prototype),_s.prototype.constructor=_s,_s.prototype.isPointsMaterial=!0,_s.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.size=i.size,this.sizeAttenuation=i.sizeAttenuation,this.morphTargets=i.morphTargets,this};const dg=new Ut,Zh=new hs,bc=new sa,Tc=new te;function hg(i=new mi,t=new _s){gt.call(this),this.type="Points",this.geometry=i,this.material=t,this.updateMorphTargets()}hg.prototype=J(Object.create(gt.prototype),{constructor:hg,isPoints:!0,copy:function(i){return gt.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,t){const n=this.geometry,u=this.matrixWorld,c=i.params.Points.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),bc.copy(n.boundingSphere),bc.applyMatrix4(u),bc.radius+=c,i.ray.intersectsSphere(bc)===!1)return;dg.copy(u).invert(),Zh.copy(i.ray).applyMatrix4(dg);const h=c/((this.scale.x+this.scale.y+this.scale.z)/3),p=h*h;if(n.isBufferGeometry){const g=n.index,x=n.attributes.position;if(g!==null){const E=g.array;for(let S=0,C=E.length;S<C;S++){const I=E[S];Tc.fromBufferAttribute(x,I),fg(Tc,I,p,u,i,t,this)}}else for(let E=0,S=x.count;E<S;E++)Tc.fromBufferAttribute(x,E),fg(Tc,E,p,u,i,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const t=i.morphAttributes,n=Object.keys(t);if(n.length>0){const u=t[n[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,h=u.length;c<h;c++){const p=u[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=c}}}}else{const t=i.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function fg(i,t,n,u,c,h,p){const g=Zh.distanceSqToPoint(i);if(g<n){const _=new te;Zh.closestPointToPoint(i,_),_.applyMatrix4(u);const x=c.ray.origin.distanceTo(_);if(x<c.near||x>c.far)return;h.push({distance:x,distanceToRay:Math.sqrt(g),point:_,index:t,face:null,object:p})}}function $h(i,t,n,u,c,h,p,g,_){gi.call(this,i,t,n,u,c,h,p,g,_),this.format=p!==void 0?p:Bn,this.minFilter=h!==void 0?h:qi,this.magFilter=c!==void 0?c:qi,this.generateMipmaps=!1;const x=this;function E(){x.needsUpdate=!0,i.requestVideoFrameCallback(E)}"requestVideoFrameCallback"in i&&i.requestVideoFrameCallback(E)}$h.prototype=J(Object.create(gi.prototype),{constructor:$h,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const i=this.image;"requestVideoFrameCallback"in i===!1&&i.readyState>=i.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function Bl(i,t,n,u,c,h,p,g,_,x,E,S){gi.call(this,null,h,p,g,_,x,u,c,E,S),this.image={width:t,height:n},this.mipmaps=i,this.flipY=!1,this.generateMipmaps=!1}Bl.prototype=Object.create(gi.prototype),Bl.prototype.constructor=Bl,Bl.prototype.isCompressedTexture=!0;function Ac(i,t,n,u,c,h,p,g,_){gi.call(this,i,t,n,u,c,h,p,g,_),this.needsUpdate=!0}Ac.prototype=Object.create(gi.prototype),Ac.prototype.constructor=Ac,Ac.prototype.isCanvasTexture=!0;function Sc(i,t,n,u,c,h,p,g,_,x){if(x=x!==void 0?x:$r,x!==$r&&x!==Jr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&x===$r&&(n=Kr),n===void 0&&x===Jr&&(n=kn),gi.call(this,null,u,c,h,p,g,x,n,_),this.image={width:i,height:t},this.magFilter=p!==void 0?p:on,this.minFilter=g!==void 0?g:on,this.flipY=!1,this.generateMipmaps=!1}Sc.prototype=Object.create(gi.prototype),Sc.prototype.constructor=Sc,Sc.prototype.isDepthTexture=!0,new te,new te,new te,new yn;const jA={triangulate:function(i,t,n){n=n||2;const u=t&&t.length,c=u?t[0]*n:i.length;let h=pg(i,0,c,n,!0);const p=[];if(!h||h.next===h.prev)return p;let g,_,x,E,S,C,I;if(u&&(h=KA(i,t,h,n)),i.length>80*n){g=x=i[0],_=E=i[1];for(let F=n;F<c;F+=n)S=i[F],C=i[F+1],S<g&&(g=S),C<_&&(_=C),S>x&&(x=S),C>E&&(E=C);I=Math.max(x-g,E-_),I=I!==0?1/I:0}return Nl(h,p,n,g,_,I),p}};function pg(i,t,n,u,c){let h,p;if(c===o1(i,t,n,u)>0)for(h=t;h<n;h+=u)p=vg(h,i[h],i[h+1],p);else for(h=n-u;h>=t;h-=u)p=vg(h,i[h],i[h+1],p);return p&&wc(p,p.next)&&(Hl(p),p=p.next),p}function Xa(i,t){if(!i)return i;t||(t=i);let n=i,u;do if(u=!1,!n.steiner&&(wc(n,n.next)||Bi(n.prev,n,n.next)===0)){if(Hl(n),n=t=n.prev,n===n.next)break;u=!0}else n=n.next;while(u||n!==t);return t}function Nl(i,t,n,u,c,h,p){if(!i)return;!p&&h&&t1(i,u,c,h);let g=i,_,x;for(;i.prev!==i.next;){if(_=i.prev,x=i.next,h?XA(i,u,c,h):qA(i)){t.push(_.i/n),t.push(i.i/n),t.push(x.i/n),Hl(i),i=x.next,g=x.next;continue}if(i=x,i===g){p?p===1?(i=QA(Xa(i),t,n),Nl(i,t,n,u,c,h,2)):p===2&&YA(i,t,n,u,c,h):Nl(Xa(i),t,n,u,c,h,1);break}}}function qA(i){const t=i.prev,n=i,u=i.next;if(Bi(t,n,u)>=0)return!1;let c=i.next.next;for(;c!==i.prev;){if(vo(t.x,t.y,n.x,n.y,u.x,u.y,c.x,c.y)&&Bi(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function XA(i,t,n,u){const c=i.prev,h=i,p=i.next;if(Bi(c,h,p)>=0)return!1;const g=c.x<h.x?c.x<p.x?c.x:p.x:h.x<p.x?h.x:p.x,_=c.y<h.y?c.y<p.y?c.y:p.y:h.y<p.y?h.y:p.y,x=c.x>h.x?c.x>p.x?c.x:p.x:h.x>p.x?h.x:p.x,E=c.y>h.y?c.y>p.y?c.y:p.y:h.y>p.y?h.y:p.y,S=Jh(g,_,t,n,u),C=Jh(x,E,t,n,u);let I=i.prevZ,F=i.nextZ;for(;I&&I.z>=S&&F&&F.z<=C;){if(I!==i.prev&&I!==i.next&&vo(c.x,c.y,h.x,h.y,p.x,p.y,I.x,I.y)&&Bi(I.prev,I,I.next)>=0||(I=I.prevZ,F!==i.prev&&F!==i.next&&vo(c.x,c.y,h.x,h.y,p.x,p.y,F.x,F.y)&&Bi(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;I&&I.z>=S;){if(I!==i.prev&&I!==i.next&&vo(c.x,c.y,h.x,h.y,p.x,p.y,I.x,I.y)&&Bi(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;F&&F.z<=C;){if(F!==i.prev&&F!==i.next&&vo(c.x,c.y,h.x,h.y,p.x,p.y,F.x,F.y)&&Bi(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function QA(i,t,n){let u=i;do{const c=u.prev,h=u.next.next;!wc(c,h)&&mg(c,u,u.next,h)&&Ul(c,h)&&Ul(h,c)&&(t.push(c.i/n),t.push(u.i/n),t.push(h.i/n),Hl(u),Hl(u.next),u=i=h),u=u.next}while(u!==i);return Xa(u)}function YA(i,t,n,u,c,h){let p=i;do{let g=p.next.next;for(;g!==p.prev;){if(p.i!==g.i&&r1(p,g)){let _=gg(p,g);p=Xa(p,p.next),_=Xa(_,_.next),Nl(p,t,n,u,c,h),Nl(_,t,n,u,c,h);return}g=g.next}p=p.next}while(p!==i)}function KA(i,t,n,u){const c=[];let h,p,g,_,x;for(h=0,p=t.length;h<p;h++)g=t[h]*u,_=h<p-1?t[h+1]*u:i.length,x=pg(i,g,_,u,!1),x===x.next&&(x.steiner=!0),c.push(n1(x));for(c.sort(ZA),h=0;h<c.length;h++)$A(c[h],n),n=Xa(n,n.next);return n}function ZA(i,t){return i.x-t.x}function $A(i,t){if(t=JA(i,t),t){const n=gg(t,i);Xa(t,t.next),Xa(n,n.next)}}function JA(i,t){let n=t;const u=i.x,c=i.y;let h=-1/0,p;do{if(c<=n.y&&c>=n.next.y&&n.next.y!==n.y){const C=n.x+(c-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(C<=u&&C>h){if(h=C,C===u){if(c===n.y)return n;if(c===n.next.y)return n.next}p=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!p)return null;if(u===h)return p;const g=p,_=p.x,x=p.y;let E=1/0,S;n=p;do u>=n.x&&n.x>=_&&u!==n.x&&vo(c<x?u:h,c,_,x,c<x?h:u,c,n.x,n.y)&&(S=Math.abs(c-n.y)/(u-n.x),Ul(n,i)&&(S<E||S===E&&(n.x>p.x||n.x===p.x&&e1(p,n)))&&(p=n,E=S)),n=n.next;while(n!==g);return p}function e1(i,t){return Bi(i.prev,i,t.prev)<0&&Bi(t.next,i,i.next)<0}function t1(i,t,n,u){let c=i;do c.z===null&&(c.z=Jh(c.x,c.y,t,n,u)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next;while(c!==i);c.prevZ.nextZ=null,c.prevZ=null,i1(c)}function i1(i){let t,n,u,c,h,p,g,_,x=1;do{for(n=i,i=null,h=null,p=0;n;){for(p++,u=n,g=0,t=0;t<x&&(g++,u=u.nextZ,!!u);t++);for(_=x;g>0||_>0&&u;)g!==0&&(_===0||!u||n.z<=u.z)?(c=n,n=n.nextZ,g--):(c=u,u=u.nextZ,_--),h?h.nextZ=c:i=c,c.prevZ=h,h=c;n=u}h.nextZ=null,x*=2}while(p>1);return i}function Jh(i,t,n,u,c){return i=32767*(i-n)*c,t=32767*(t-u)*c,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function n1(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function vo(i,t,n,u,c,h,p,g){return(c-p)*(t-g)-(i-p)*(h-g)>=0&&(i-p)*(u-g)-(n-p)*(t-g)>=0&&(n-p)*(h-g)-(c-p)*(u-g)>=0}function r1(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!a1(i,t)&&(Ul(i,t)&&Ul(t,i)&&s1(i,t)&&(Bi(i.prev,i,t.prev)||Bi(i,t.prev,t))||wc(i,t)&&Bi(i.prev,i,i.next)>0&&Bi(t.prev,t,t.next)>0)}function Bi(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function wc(i,t){return i.x===t.x&&i.y===t.y}function mg(i,t,n,u){const c=Mc(Bi(i,t,n)),h=Mc(Bi(i,t,u)),p=Mc(Bi(n,u,i)),g=Mc(Bi(n,u,t));return!!(c!==h&&p!==g||c===0&&Ec(i,n,t)||h===0&&Ec(i,u,t)||p===0&&Ec(n,i,u)||g===0&&Ec(n,t,u))}function Ec(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Mc(i){return i>0?1:i<0?-1:0}function a1(i,t){let n=i;do{if(n.i!==i.i&&n.next.i!==i.i&&n.i!==t.i&&n.next.i!==t.i&&mg(n,n.next,i,t))return!0;n=n.next}while(n!==i);return!1}function Ul(i,t){return Bi(i.prev,i,i.next)<0?Bi(i,t,i.next)>=0&&Bi(i,i.prev,t)>=0:Bi(i,t,i.prev)<0||Bi(i,i.next,t)<0}function s1(i,t){let n=i,u=!1;const c=(i.x+t.x)/2,h=(i.y+t.y)/2;do n.y>h!=n.next.y>h&&n.next.y!==n.y&&c<(n.next.x-n.x)*(h-n.y)/(n.next.y-n.y)+n.x&&(u=!u),n=n.next;while(n!==i);return u}function gg(i,t){const n=new ef(i.i,i.x,i.y),u=new ef(t.i,t.x,t.y),c=i.next,h=t.prev;return i.next=t,t.prev=i,n.next=c,c.prev=n,u.next=n,n.prev=u,h.next=u,u.prev=h,u}function vg(i,t,n,u){const c=new ef(i,t,n);return u?(c.next=u.next,c.prev=u,u.next.prev=c,u.next=c):(c.prev=c,c.next=c),c}function Hl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ef(i,t,n){this.i=i,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function o1(i,t,n,u){let c=0;for(let h=t,p=n-u;h<n;h+=u)c+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return c}const Qa={area:function(i){const t=i.length;let n=0;for(let u=t-1,c=0;c<t;u=c++)n+=i[u].x*i[c].y-i[c].x*i[u].y;return n*.5},isClockWise:function(i){return Qa.area(i)<0},triangulateShape:function(i,t){const n=[],u=[],c=[];yg(i),_g(n,i);let h=i.length;t.forEach(yg);for(let g=0;g<t.length;g++)u.push(h),h+=t[g].length,_g(n,t[g]);const p=jA.triangulate(n,u);for(let g=0;g<p.length;g+=3)c.push(p.slice(g,g+3));return c}};function yg(i){const t=i.length;t>2&&i[t-1].equals(i[0])&&i.pop()}function _g(i,t){for(let n=0;n<t.length;n++)i.push(t[n].x),i.push(t[n].y)}class xg extends mi{constructor(t,n){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:n},t=Array.isArray(t)?t:[t];const u=this,c=[],h=[];for(let g=0,_=t.length;g<_;g++){const x=t[g];p(x)}this.setAttribute("position",new ki(c,3)),this.setAttribute("uv",new ki(h,2)),this.computeVertexNormals();function p(g){const _=[],x=n.curveSegments!==void 0?n.curveSegments:12,E=n.steps!==void 0?n.steps:1;let S=n.depth!==void 0?n.depth:100,C=n.bevelEnabled!==void 0?n.bevelEnabled:!0,I=n.bevelThickness!==void 0?n.bevelThickness:6,F=n.bevelSize!==void 0?n.bevelSize:I-2,z=n.bevelOffset!==void 0?n.bevelOffset:0,G=n.bevelSegments!==void 0?n.bevelSegments:3;const k=n.extrudePath,O=n.UVGenerator!==void 0?n.UVGenerator:l1;n.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),S=n.amount);let se,oe=!1,re,X,me,ke;k&&(se=k.getSpacedPoints(E),oe=!0,C=!1,re=k.computeFrenetFrames(E,!1),X=new te,me=new te,ke=new te),C||(G=0,I=0,F=0,z=0);const xe=g.extractPoints(x);let Se=xe.shape;const we=xe.holes;if(!Qa.isClockWise(Se)){Se=Se.reverse();for(let $e=0,nt=we.length;$e<nt;$e++){const st=we[$e];Qa.isClockWise(st)&&(we[$e]=st.reverse())}}const he=Qa.triangulateShape(Se,we),ce=Se;for(let $e=0,nt=we.length;$e<nt;$e++){const st=we[$e];Se=Se.concat(st)}function pe($e,nt,st){return nt||console.error("THREE.ExtrudeGeometry: vec does not exist"),nt.clone().multiplyScalar(st).add($e)}const Te=Se.length,He=he.length;function Xe($e,nt,st){let ve,Ze,$;const Q=$e.x-nt.x,Ue=$e.y-nt.y,Be=st.x-$e.x,le=st.y-$e.y,Fe=Q*Q+Ue*Ue,dt=Q*le-Ue*Be;if(Math.abs(dt)>Number.EPSILON){const bt=Math.sqrt(Fe),ot=Math.sqrt(Be*Be+le*le),yt=nt.x-Ue/bt,mt=nt.y+Q/bt,Bt=st.x-le/ot,_t=st.y+Be/ot,Ct=((Bt-yt)*le-(_t-mt)*Be)/(Q*le-Ue*Be);ve=yt+Q*Ct-$e.x,Ze=mt+Ue*Ct-$e.y;const Ei=ve*ve+Ze*Ze;if(Ei<=2)return new be(ve,Ze);$=Math.sqrt(Ei/2)}else{let bt=!1;Q>Number.EPSILON?Be>Number.EPSILON&&(bt=!0):Q<-Number.EPSILON?Be<-Number.EPSILON&&(bt=!0):Math.sign(Ue)===Math.sign(le)&&(bt=!0),bt?(ve=-Ue,Ze=Q,$=Math.sqrt(Fe)):(ve=Q,Ze=Ue,$=Math.sqrt(Fe/2))}return new be(ve/$,Ze/$)}const Qe=[];for(let $e=0,nt=ce.length,st=nt-1,ve=$e+1;$e<nt;$e++,st++,ve++)st===nt&&(st=0),ve===nt&&(ve=0),Qe[$e]=Xe(ce[$e],ce[st],ce[ve]);const lt=[];let rt,Et=Qe.concat();for(let $e=0,nt=we.length;$e<nt;$e++){const st=we[$e];rt=[];for(let ve=0,Ze=st.length,$=Ze-1,Q=ve+1;ve<Ze;ve++,$++,Q++)$===Ze&&($=0),Q===Ze&&(Q=0),rt[ve]=Xe(st[ve],st[$],st[Q]);lt.push(rt),Et=Et.concat(rt)}for(let $e=0;$e<G;$e++){const nt=$e/G,st=I*Math.cos(nt*Math.PI/2),ve=F*Math.sin(nt*Math.PI/2)+z;for(let Ze=0,$=ce.length;Ze<$;Ze++){const Q=pe(ce[Ze],Qe[Ze],ve);It(Q.x,Q.y,-st)}for(let Ze=0,$=we.length;Ze<$;Ze++){const Q=we[Ze];rt=lt[Ze];for(let Ue=0,Be=Q.length;Ue<Be;Ue++){const le=pe(Q[Ue],rt[Ue],ve);It(le.x,le.y,-st)}}}const Dt=F+z;for(let $e=0;$e<Te;$e++){const nt=C?pe(Se[$e],Et[$e],Dt):Se[$e];oe?(me.copy(re.normals[0]).multiplyScalar(nt.x),X.copy(re.binormals[0]).multiplyScalar(nt.y),ke.copy(se[0]).add(me).add(X),It(ke.x,ke.y,ke.z)):It(nt.x,nt.y,0)}for(let $e=1;$e<=E;$e++)for(let nt=0;nt<Te;nt++){const st=C?pe(Se[nt],Et[nt],Dt):Se[nt];oe?(me.copy(re.normals[$e]).multiplyScalar(st.x),X.copy(re.binormals[$e]).multiplyScalar(st.y),ke.copy(se[$e]).add(me).add(X),It(ke.x,ke.y,ke.z)):It(st.x,st.y,S/E*$e)}for(let $e=G-1;$e>=0;$e--){const nt=$e/G,st=I*Math.cos(nt*Math.PI/2),ve=F*Math.sin(nt*Math.PI/2)+z;for(let Ze=0,$=ce.length;Ze<$;Ze++){const Q=pe(ce[Ze],Qe[Ze],ve);It(Q.x,Q.y,S+st)}for(let Ze=0,$=we.length;Ze<$;Ze++){const Q=we[Ze];rt=lt[Ze];for(let Ue=0,Be=Q.length;Ue<Be;Ue++){const le=pe(Q[Ue],rt[Ue],ve);oe?It(le.x,le.y+se[E-1].y,se[E-1].x+st):It(le.x,le.y,S+st)}}}Ht(),Ve();function Ht(){const $e=c.length/3;if(C){let nt=0,st=Te*nt;for(let ve=0;ve<He;ve++){const Ze=he[ve];qt(Ze[2]+st,Ze[1]+st,Ze[0]+st)}nt=E+G*2,st=Te*nt;for(let ve=0;ve<He;ve++){const Ze=he[ve];qt(Ze[0]+st,Ze[1]+st,Ze[2]+st)}}else{for(let nt=0;nt<He;nt++){const st=he[nt];qt(st[2],st[1],st[0])}for(let nt=0;nt<He;nt++){const st=he[nt];qt(st[0]+Te*E,st[1]+Te*E,st[2]+Te*E)}}u.addGroup($e,c.length/3-$e,0)}function Ve(){const $e=c.length/3;let nt=0;zi(ce,nt),nt+=ce.length;for(let st=0,ve=we.length;st<ve;st++){const Ze=we[st];zi(Ze,nt),nt+=Ze.length}u.addGroup($e,c.length/3-$e,1)}function zi($e,nt){let st=$e.length;for(;--st>=0;){const ve=st;let Ze=st-1;Ze<0&&(Ze=$e.length-1);for(let $=0,Q=E+G*2;$<Q;$++){const Ue=Te*$,Be=Te*($+1),le=nt+ve+Ue,Fe=nt+Ze+Ue,dt=nt+Ze+Be,bt=nt+ve+Be;Rt(le,Fe,dt,bt)}}}function It($e,nt,st){_.push($e),_.push(nt),_.push(st)}function qt($e,nt,st){ti($e),ti(nt),ti(st);const ve=c.length/3,Ze=O.generateTopUV(u,c,ve-3,ve-2,ve-1);kt(Ze[0]),kt(Ze[1]),kt(Ze[2])}function Rt($e,nt,st,ve){ti($e),ti(nt),ti(ve),ti(nt),ti(st),ti(ve);const Ze=c.length/3,$=O.generateSideWallUV(u,c,Ze-6,Ze-3,Ze-2,Ze-1);kt($[0]),kt($[1]),kt($[3]),kt($[1]),kt($[2]),kt($[3])}function ti($e){c.push(_[$e*3+0]),c.push(_[$e*3+1]),c.push(_[$e*3+2])}function kt($e){h.push($e.x),h.push($e.y)}}}toJSON(){const t=mi.prototype.toJSON.call(this),n=this.parameters.shapes,u=this.parameters.options;return u1(n,u,t)}}const l1={generateTopUV:function(i,t,n,u,c){const h=t[n*3],p=t[n*3+1],g=t[u*3],_=t[u*3+1],x=t[c*3],E=t[c*3+1];return[new be(h,p),new be(g,_),new be(x,E)]},generateSideWallUV:function(i,t,n,u,c,h){const p=t[n*3],g=t[n*3+1],_=t[n*3+2],x=t[u*3],E=t[u*3+1],S=t[u*3+2],C=t[c*3],I=t[c*3+1],F=t[c*3+2],z=t[h*3],G=t[h*3+1],k=t[h*3+2];return Math.abs(g-E)<.01?[new be(p,1-_),new be(x,1-S),new be(C,1-F),new be(z,1-k)]:[new be(g,1-_),new be(E,1-S),new be(I,1-F),new be(G,1-k)]}};function u1(i,t,n){if(n.shapes=[],Array.isArray(i))for(let u=0,c=i.length;u<c;u++){const h=i[u];n.shapes.push(h.uuid)}else n.shapes.push(i.uuid);return t.extrudePath!==void 0&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function tf(i,t,n){mi.call(this),this.type="ParametricGeometry",this.parameters={func:i,slices:t,stacks:n};const u=[],c=[],h=[],p=[],g=1e-5,_=new te,x=new te,E=new te,S=new te,C=new te;i.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const I=t+1;for(let F=0;F<=n;F++){const z=F/n;for(let G=0;G<=t;G++){const k=G/t;i(k,z,x),c.push(x.x,x.y,x.z),k-g>=0?(i(k-g,z,E),S.subVectors(x,E)):(i(k+g,z,E),S.subVectors(E,x)),z-g>=0?(i(k,z-g,E),C.subVectors(x,E)):(i(k,z+g,E),C.subVectors(E,x)),_.crossVectors(S,C).normalize(),h.push(_.x,_.y,_.z),p.push(k,z)}}for(let F=0;F<n;F++)for(let z=0;z<t;z++){const G=F*I+z,k=F*I+z+1,O=(F+1)*I+z+1,se=(F+1)*I+z;u.push(G,k,se),u.push(k,O,se)}this.setIndex(u),this.setAttribute("position",new ki(c,3)),this.setAttribute("normal",new ki(h,3)),this.setAttribute("uv",new ki(p,2))}tf.prototype=Object.create(mi.prototype),tf.prototype.constructor=tf;class c1 extends mi{constructor(t,n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:n};const u=[],c=[],h=[],p=[];let g=0,_=0;if(Array.isArray(t)===!1)x(t);else for(let E=0;E<t.length;E++)x(t[E]),this.addGroup(g,_,E),g+=_,_=0;this.setIndex(u),this.setAttribute("position",new ki(c,3)),this.setAttribute("normal",new ki(h,3)),this.setAttribute("uv",new ki(p,2));function x(E){const S=c.length/3,C=E.extractPoints(n);let I=C.shape;const F=C.holes;Qa.isClockWise(I)===!1&&(I=I.reverse());for(let G=0,k=F.length;G<k;G++){const O=F[G];Qa.isClockWise(O)===!0&&(F[G]=O.reverse())}const z=Qa.triangulateShape(I,F);for(let G=0,k=F.length;G<k;G++){const O=F[G];I=I.concat(O)}for(let G=0,k=I.length;G<k;G++){const O=I[G];c.push(O.x,O.y,0),h.push(0,0,1),p.push(O.x,O.y)}for(let G=0,k=z.length;G<k;G++){const O=z[G],se=O[0]+S,oe=O[1]+S,re=O[2]+S;u.push(se,oe,re),_+=3}}}toJSON(){const t=mi.prototype.toJSON.call(this),n=this.parameters.shapes;return d1(n,t)}}function d1(i,t){if(t.shapes=[],Array.isArray(i))for(let n=0,u=i.length;n<u;n++){const c=i[n];t.shapes.push(c.uuid)}else t.shapes.push(i.uuid);return t}class Vl extends mi{constructor(t=1,n=8,u=6,c=0,h=Math.PI*2,p=0,g=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:n,heightSegments:u,phiStart:c,phiLength:h,thetaStart:p,thetaLength:g},n=Math.max(3,Math.floor(n)),u=Math.max(2,Math.floor(u));const _=Math.min(p+g,Math.PI);let x=0;const E=[],S=new te,C=new te,I=[],F=[],z=[],G=[];for(let k=0;k<=u;k++){const O=[],se=k/u;let oe=0;k==0&&p==0?oe=.5/n:k==u&&_==Math.PI&&(oe=-.5/n);for(let re=0;re<=n;re++){const X=re/n;S.x=-t*Math.cos(c+X*h)*Math.sin(p+se*g),S.y=t*Math.cos(p+se*g),S.z=t*Math.sin(c+X*h)*Math.sin(p+se*g),F.push(S.x,S.y,S.z),C.copy(S).normalize(),z.push(C.x,C.y,C.z),G.push(X+oe,1-se),O.push(x++)}E.push(O)}for(let k=0;k<u;k++)for(let O=0;O<n;O++){const se=E[k][O+1],oe=E[k][O],re=E[k+1][O],X=E[k+1][O+1];(k!==0||p>0)&&I.push(se,oe,X),(k!==u-1||_<Math.PI)&&I.push(oe,re,X)}this.setIndex(I),this.setAttribute("position",new ki(F,3)),this.setAttribute("normal",new ki(z,3)),this.setAttribute("uv",new ki(G,2))}}function yo(i){Lt.call(this),this.type="ShadowMaterial",this.color=new Mt(0),this.transparent=!0,this.setValues(i)}yo.prototype=Object.create(Lt.prototype),yo.prototype.constructor=yo,yo.prototype.isShadowMaterial=!0,yo.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this};function Gl(i){_n.call(this,i),this.type="RawShaderMaterial"}Gl.prototype=Object.create(_n.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isRawShaderMaterial=!0;function la(i){Lt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Mt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fa,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(i)}la.prototype=Object.create(Lt.prototype),la.prototype.constructor=la,la.prototype.isMeshStandardMaterial=!0,la.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.vertexTangents=i.vertexTangents,this};function xs(i){la.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new be(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=At.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(i)}xs.prototype=Object.create(la.prototype),xs.prototype.constructor=xs,xs.prototype.isMeshPhysicalMaterial=!0,xs.prototype.copy=function(i){return la.prototype.copy.call(this,i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.reflectivity=i.reflectivity,i.sheen?this.sheen=(this.sheen||new Mt).copy(i.sheen):this.sheen=null,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this};function bs(i){Lt.call(this),this.type="MeshPhongMaterial",this.color=new Mt(16777215),this.specular=new Mt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fa,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=La,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}bs.prototype=Object.create(Lt.prototype),bs.prototype.constructor=bs,bs.prototype.isMeshPhongMaterial=!0,bs.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.specular.copy(i.specular),this.shininess=i.shininess,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function _o(i){Lt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Mt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fa,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}_o.prototype=Object.create(Lt.prototype),_o.prototype.constructor=_o,_o.prototype.isMeshToonMaterial=!0,_o.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.gradientMap=i.gradientMap,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function xo(i){Lt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fa,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}xo.prototype=Object.create(Lt.prototype),xo.prototype.constructor=xo,xo.prototype.isMeshNormalMaterial=!0,xo.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function bo(i){Lt.call(this),this.type="MeshLambertMaterial",this.color=new Mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=La,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}bo.prototype=Object.create(Lt.prototype),bo.prototype.constructor=bo,bo.prototype.isMeshLambertMaterial=!0,bo.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function To(i){Lt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Mt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fa,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}To.prototype=Object.create(Lt.prototype),To.prototype.constructor=To,To.prototype.isMeshMatcapMaterial=!0,To.prototype.copy=function(i){return Lt.prototype.copy.call(this,i),this.defines={MATCAP:""},this.color.copy(i.color),this.matcap=i.matcap,this.map=i.map,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this};function Ao(i){Br.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(i)}Ao.prototype=Object.create(Br.prototype),Ao.prototype.constructor=Ao,Ao.prototype.isLineDashedMaterial=!0,Ao.prototype.copy=function(i){return Br.prototype.copy.call(this,i),this.scale=i.scale,this.dashSize=i.dashSize,this.gapSize=i.gapSize,this};var h1=Object.freeze({__proto__:null,ShadowMaterial:yo,SpriteMaterial:ys,RawShaderMaterial:Gl,ShaderMaterial:_n,PointsMaterial:_s,MeshPhysicalMaterial:xs,MeshStandardMaterial:la,MeshPhongMaterial:bs,MeshToonMaterial:_o,MeshNormalMaterial:xo,MeshLambertMaterial:bo,MeshDepthMaterial:ps,MeshDistanceMaterial:ms,MeshBasicMaterial:Dn,MeshMatcapMaterial:To,LineDashedMaterial:Ao,LineBasicMaterial:Br,Material:Lt});const Di={arraySlice:function(i,t,n){return Di.isTypedArray(i)?new i.constructor(i.subarray(t,n!==void 0?n:i.length)):i.slice(t,n)},convertArray:function(i,t,n){return!i||!n&&i.constructor===t?i:typeof t.BYTES_PER_ELEMENT=="number"?new t(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function t(c,h){return i[c]-i[h]}const n=i.length,u=new Array(n);for(let c=0;c!==n;++c)u[c]=c;return u.sort(t),u},sortedArray:function(i,t,n){const u=i.length,c=new i.constructor(u);for(let h=0,p=0;p!==u;++h){const g=n[h]*t;for(let _=0;_!==t;++_)c[p++]=i[g+_]}return c},flattenJSON:function(i,t,n,u){let c=1,h=i[0];for(;h!==void 0&&h[u]===void 0;)h=i[c++];if(h===void 0)return;let p=h[u];if(p!==void 0)if(Array.isArray(p))do p=h[u],p!==void 0&&(t.push(h.time),n.push.apply(n,p)),h=i[c++];while(h!==void 0);else if(p.toArray!==void 0)do p=h[u],p!==void 0&&(t.push(h.time),p.toArray(n,n.length)),h=i[c++];while(h!==void 0);else do p=h[u],p!==void 0&&(t.push(h.time),n.push(p)),h=i[c++];while(h!==void 0)},subclip:function(i,t,n,u,c=30){const h=i.clone();h.name=t;const p=[];for(let _=0;_<h.tracks.length;++_){const x=h.tracks[_],E=x.getValueSize(),S=[],C=[];for(let I=0;I<x.times.length;++I){const F=x.times[I]*c;if(!(F<n||F>=u)){S.push(x.times[I]);for(let z=0;z<E;++z)C.push(x.values[I*E+z])}}S.length!==0&&(x.times=Di.convertArray(S,x.times.constructor),x.values=Di.convertArray(C,x.values.constructor),p.push(x))}h.tracks=p;let g=1/0;for(let _=0;_<h.tracks.length;++_)g>h.tracks[_].times[0]&&(g=h.tracks[_].times[0]);for(let _=0;_<h.tracks.length;++_)h.tracks[_].shift(-1*g);return h.resetDuration(),h},makeClipAdditive:function(i,t=0,n=i,u=30){u<=0&&(u=30);const c=n.tracks.length,h=t/u;for(let p=0;p<c;++p){const g=n.tracks[p],_=g.ValueTypeName;if(_==="bool"||_==="string")continue;const x=i.tracks.find(function(k){return k.name===g.name&&k.ValueTypeName===_});if(x===void 0)continue;let E=0;const S=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(E=S/3);let C=0;const I=x.getValueSize();x.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(C=I/3);const F=g.times.length-1;let z;if(h<=g.times[0]){const k=E,O=S-E;z=Di.arraySlice(g.values,k,O)}else if(h>=g.times[F]){const k=F*S+E,O=k+S-E;z=Di.arraySlice(g.values,k,O)}else{const k=g.createInterpolant(),O=E,se=S-E;k.evaluate(h),z=Di.arraySlice(k.resultBuffer,O,se)}_==="quaternion"&&new Fi().fromArray(z).normalize().conjugate().toArray(z);const G=x.times.length;for(let k=0;k<G;++k){const O=k*I+C;if(_==="quaternion")Fi.multiplyQuaternionsFlat(x.values,O,z,0,x.values,O);else{const se=I-C*2;for(let oe=0;oe<se;++oe)x.values[O+oe]-=z[oe]}}}return i.blendMode=vl,i}};function rr(i,t,n,u){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=u!==void 0?u:new t.constructor(n),this.sampleValues=t,this.valueSize=n}J(rr.prototype,{evaluate:function(i){const t=this.parameterPositions;let n=this._cachedIndex,u=t[n],c=t[n-1];e:{t:{let h;i:{n:if(!(i<u)){for(let p=n+2;;){if(u===void 0){if(i<c)break n;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,c)}if(n===p)break;if(c=u,u=t[++n],i<u)break t}h=t.length;break i}if(!(i>=c)){const p=t[1];i<p&&(n=2,c=p);for(let g=n-2;;){if(c===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,u);if(n===g)break;if(u=c,c=t[--n-1],i>=c)break t}h=n,n=0;break i}break e}for(;n<h;){const p=n+h>>>1;i<t[p]?h=p:n=p+1}if(u=t[n],c=t[n-1],c===void 0)return this._cachedIndex=0,this.beforeStart_(0,i,u);if(u===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,c,i)}this._cachedIndex=n,this.intervalChanged_(n,c,u)}return this.interpolate_(n,c,i,u)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){const t=this.resultBuffer,n=this.sampleValues,u=this.valueSize,c=i*u;for(let h=0;h!==u;++h)t[h]=n[c+h];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),J(rr.prototype,{beforeStart_:rr.prototype.copySampleValue_,afterEnd_:rr.prototype.copySampleValue_});function nf(i,t,n,u){rr.call(this,i,t,n,u),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}nf.prototype=J(Object.create(rr.prototype),{constructor:nf,DefaultSettings_:{endingStart:Cn,endingEnd:Cn},intervalChanged_:function(i,t,n){const u=this.parameterPositions;let c=i-2,h=i+1,p=u[c],g=u[h];if(p===void 0)switch(this.getSettings_().endingStart){case Oa:c=i,p=2*t-n;break;case os:c=u.length-2,p=t+u[c]-u[c+1];break;default:c=i,p=n}if(g===void 0)switch(this.getSettings_().endingEnd){case Oa:h=i,g=2*n-t;break;case os:h=1,g=n+u[1]-u[0];break;default:h=i-1,g=t}const _=(n-t)*.5,x=this.valueSize;this._weightPrev=_/(t-p),this._weightNext=_/(g-n),this._offsetPrev=c*x,this._offsetNext=h*x},interpolate_:function(i,t,n,u){const c=this.resultBuffer,h=this.sampleValues,p=this.valueSize,g=i*p,_=g-p,x=this._offsetPrev,E=this._offsetNext,S=this._weightPrev,C=this._weightNext,I=(n-t)/(u-t),F=I*I,z=F*I,G=-S*z+2*S*F-S*I,k=(1+S)*z+(-1.5-2*S)*F+(-.5+S)*I+1,O=(-1-C)*z+(1.5+C)*F+.5*I,se=C*z-C*F;for(let oe=0;oe!==p;++oe)c[oe]=G*h[x+oe]+k*h[_+oe]+O*h[g+oe]+se*h[E+oe];return c}});function Cc(i,t,n,u){rr.call(this,i,t,n,u)}Cc.prototype=J(Object.create(rr.prototype),{constructor:Cc,interpolate_:function(i,t,n,u){const c=this.resultBuffer,h=this.sampleValues,p=this.valueSize,g=i*p,_=g-p,x=(n-t)/(u-t),E=1-x;for(let S=0;S!==p;++S)c[S]=h[_+S]*E+h[g+S]*x;return c}});function rf(i,t,n,u){rr.call(this,i,t,n,u)}rf.prototype=J(Object.create(rr.prototype),{constructor:rf,interpolate_:function(i){return this.copySampleValue_(i-1)}});function fn(i,t,n,u){if(i===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+i);this.name=i,this.times=Di.convertArray(t,this.TimeBufferType),this.values=Di.convertArray(n,this.ValueBufferType),this.setInterpolation(u||this.DefaultInterpolation)}J(fn,{toJSON:function(i){const t=i.constructor;let n;if(t.toJSON!==void 0)n=t.toJSON(i);else{n={name:i.name,times:Di.convertArray(i.times,Array),values:Di.convertArray(i.values,Array)};const u=i.getInterpolation();u!==i.DefaultInterpolation&&(n.interpolation=u)}return n.type=i.ValueTypeName,n}}),J(fn.prototype,{constructor:fn,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Lr,InterpolantFactoryMethodDiscrete:function(i){return new rf(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodLinear:function(i){return new Cc(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodSmooth:function(i){return new nf(this.times,this.values,this.getValueSize(),i)},setInterpolation:function(i){let t;switch(i){case ta:t=this.InterpolantFactoryMethodDiscrete;break;case Lr:t=this.InterpolantFactoryMethodLinear;break;case Ra:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(i!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ta;case this.InterpolantFactoryMethodLinear:return Lr;case this.InterpolantFactoryMethodSmooth:return Ra}},getValueSize:function(){return this.values.length/this.times.length},shift:function(i){if(i!==0){const t=this.times;for(let n=0,u=t.length;n!==u;++n)t[n]+=i}return this},scale:function(i){if(i!==1){const t=this.times;for(let n=0,u=t.length;n!==u;++n)t[n]*=i}return this},trim:function(i,t){const n=this.times,u=n.length;let c=0,h=u-1;for(;c!==u&&n[c]<i;)++c;for(;h!==-1&&n[h]>t;)--h;if(++h,c!==0||h!==u){c>=h&&(h=Math.max(h,1),c=h-1);const p=this.getValueSize();this.times=Di.arraySlice(n,c,h),this.values=Di.arraySlice(this.values,c*p,h*p)}return this},validate:function(){let i=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),i=!1);const n=this.times,u=this.values,c=n.length;c===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),i=!1);let h=null;for(let p=0;p!==c;p++){const g=n[p];if(typeof g=="number"&&isNaN(g)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,p,g),i=!1;break}if(h!==null&&h>g){console.error("THREE.KeyframeTrack: Out of order keys.",this,p,g,h),i=!1;break}h=g}if(u!==void 0&&Di.isTypedArray(u))for(let p=0,g=u.length;p!==g;++p){const _=u[p];if(isNaN(_)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,p,_),i=!1;break}}return i},optimize:function(){const i=Di.arraySlice(this.times),t=Di.arraySlice(this.values),n=this.getValueSize(),u=this.getInterpolation()===Ra,c=i.length-1;let h=1;for(let p=1;p<c;++p){let g=!1;const _=i[p],x=i[p+1];if(_!==x&&(p!==1||_!==i[0]))if(u)g=!0;else{const E=p*n,S=E-n,C=E+n;for(let I=0;I!==n;++I){const F=t[E+I];if(F!==t[S+I]||F!==t[C+I]){g=!0;break}}}if(g){if(p!==h){i[h]=i[p];const E=p*n,S=h*n;for(let C=0;C!==n;++C)t[S+C]=t[E+C]}++h}}if(c>0){i[h]=i[c];for(let p=c*n,g=h*n,_=0;_!==n;++_)t[g+_]=t[p+_];++h}return h!==i.length?(this.times=Di.arraySlice(i,0,h),this.values=Di.arraySlice(t,0,h*n)):(this.times=i,this.values=t),this},clone:function(){const i=Di.arraySlice(this.times,0),t=Di.arraySlice(this.values,0),n=this.constructor,u=new n(this.name,i,t);return u.createInterpolant=this.createInterpolant,u}});function af(i,t,n){fn.call(this,i,t,n)}af.prototype=J(Object.create(fn.prototype),{constructor:af,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ta,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function sf(i,t,n,u){fn.call(this,i,t,n,u)}sf.prototype=J(Object.create(fn.prototype),{constructor:sf,ValueTypeName:"color"});function zl(i,t,n,u){fn.call(this,i,t,n,u)}zl.prototype=J(Object.create(fn.prototype),{constructor:zl,ValueTypeName:"number"});function of(i,t,n,u){rr.call(this,i,t,n,u)}of.prototype=J(Object.create(rr.prototype),{constructor:of,interpolate_:function(i,t,n,u){const c=this.resultBuffer,h=this.sampleValues,p=this.valueSize,g=(n-t)/(u-t);let _=i*p;for(let x=_+p;_!==x;_+=4)Fi.slerpFlat(c,0,h,_-p,h,_,g);return c}});function Pc(i,t,n,u){fn.call(this,i,t,n,u)}Pc.prototype=J(Object.create(fn.prototype),{constructor:Pc,ValueTypeName:"quaternion",DefaultInterpolation:Lr,InterpolantFactoryMethodLinear:function(i){return new of(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodSmooth:void 0});function lf(i,t,n,u){fn.call(this,i,t,n,u)}lf.prototype=J(Object.create(fn.prototype),{constructor:lf,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ta,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Wl(i,t,n,u){fn.call(this,i,t,n,u)}Wl.prototype=J(Object.create(fn.prototype),{constructor:Wl,ValueTypeName:"vector"});function vr(i,t=-1,n,u=qs){this.name=i,this.tracks=n,this.duration=t,this.blendMode=u,this.uuid=At.generateUUID(),this.duration<0&&this.resetDuration()}function f1(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zl;case"vector":case"vector2":case"vector3":case"vector4":return Wl;case"color":return sf;case"quaternion":return Pc;case"bool":case"boolean":return af;case"string":return lf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function p1(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=f1(i.type);if(i.times===void 0){const n=[],u=[];Di.flattenJSON(i.keys,n,u,"value"),i.times=n,i.values=u}return t.parse!==void 0?t.parse(i):new t(i.name,i.times,i.values,i.interpolation)}J(vr,{parse:function(i){const t=[],n=i.tracks,u=1/(i.fps||1);for(let h=0,p=n.length;h!==p;++h)t.push(p1(n[h]).scale(u));const c=new vr(i.name,i.duration,t,i.blendMode);return c.uuid=i.uuid,c},toJSON:function(i){const t=[],n=i.tracks,u={name:i.name,duration:i.duration,tracks:t,uuid:i.uuid,blendMode:i.blendMode};for(let c=0,h=n.length;c!==h;++c)t.push(fn.toJSON(n[c]));return u},CreateFromMorphTargetSequence:function(i,t,n,u){const c=t.length,h=[];for(let p=0;p<c;p++){let g=[],_=[];g.push((p+c-1)%c,p,(p+1)%c),_.push(0,1,0);const x=Di.getKeyframeOrder(g);g=Di.sortedArray(g,1,x),_=Di.sortedArray(_,1,x),!u&&g[0]===0&&(g.push(c),_.push(_[0])),h.push(new zl(".morphTargetInfluences["+t[p].name+"]",g,_).scale(1/n))}return new vr(i,-1,h)},findByName:function(i,t){let n=i;if(!Array.isArray(i)){const u=i;n=u.geometry&&u.geometry.animations||u.animations}for(let u=0;u<n.length;u++)if(n[u].name===t)return n[u];return null},CreateClipsFromMorphTargetSequences:function(i,t,n){const u={},c=/^([\w-]*?)([\d]+)$/;for(let p=0,g=i.length;p<g;p++){const _=i[p],x=_.name.match(c);if(x&&x.length>1){const E=x[1];let S=u[E];S||(u[E]=S=[]),S.push(_)}}const h=[];for(const p in u)h.push(vr.CreateFromMorphTargetSequence(p,u[p],t,n));return h},parseAnimation:function(i,t){if(!i)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(E,S,C,I,F){if(C.length!==0){const z=[],G=[];Di.flattenJSON(C,z,G,I),z.length!==0&&F.push(new E(S,z,G))}},u=[],c=i.name||"default",h=i.fps||30,p=i.blendMode;let g=i.length||-1;const _=i.hierarchy||[];for(let E=0;E<_.length;E++){const S=_[E].keys;if(!(!S||S.length===0))if(S[0].morphTargets){const C={};let I;for(I=0;I<S.length;I++)if(S[I].morphTargets)for(let F=0;F<S[I].morphTargets.length;F++)C[S[I].morphTargets[F]]=-1;for(const F in C){const z=[],G=[];for(let k=0;k!==S[I].morphTargets.length;++k){const O=S[I];z.push(O.time),G.push(O.morphTarget===F?1:0)}u.push(new zl(".morphTargetInfluence["+F+"]",z,G))}g=C.length*h}else{const C=".bones["+t[E].name+"]";n(Wl,C+".position",S,"pos",u),n(Pc,C+".quaternion",S,"rot",u),n(Wl,C+".scale",S,"scl",u)}}return u.length===0?null:new vr(c,g,u,p)}}),J(vr.prototype,{resetDuration:function(){const i=this.tracks;let t=0;for(let n=0,u=i.length;n!==u;++n){const c=this.tracks[n];t=Math.max(t,c.times[c.times.length-1])}return this.duration=t,this},trim:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},validate:function(){let i=!0;for(let t=0;t<this.tracks.length;t++)i=i&&this.tracks[t].validate();return i},optimize:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this},clone:function(){const i=[];for(let t=0;t<this.tracks.length;t++)i.push(this.tracks[t].clone());return new vr(this.name,this.duration,i,this.blendMode)},toJSON:function(){return vr.toJSON(this)}});const So={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};function m1(i,t,n){const u=this;let c=!1,h=0,p=0,g;const _=[];this.onStart=void 0,this.onLoad=i,this.onProgress=t,this.onError=n,this.itemStart=function(x){p++,c===!1&&u.onStart!==void 0&&u.onStart(x,h,p),c=!0},this.itemEnd=function(x){h++,u.onProgress!==void 0&&u.onProgress(x,h,p),h===p&&(c=!1,u.onLoad!==void 0&&u.onLoad())},this.itemError=function(x){u.onError!==void 0&&u.onError(x)},this.resolveURL=function(x){return g?g(x):x},this.setURLModifier=function(x){return g=x,this},this.addHandler=function(x,E){return _.push(x,E),this},this.removeHandler=function(x){const E=_.indexOf(x);return E!==-1&&_.splice(E,2),this},this.getHandler=function(x){for(let E=0,S=_.length;E<S;E+=2){const C=_[E],I=_[E+1];if(C.global&&(C.lastIndex=0),C.test(x))return I}return null}}const g1=new m1;function _i(i){this.manager=i!==void 0?i:g1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}J(_i.prototype,{load:function(){},loadAsync:function(i,t){const n=this;return new Promise(function(u,c){n.load(i,u,t,c)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});const yr={};function ua(i){_i.call(this,i)}ua.prototype=J(Object.create(_i.prototype),{constructor:ua,load:function(i,t,n,u){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const c=this,h=So.get(i);if(h!==void 0)return c.manager.itemStart(i),setTimeout(function(){t&&t(h),c.manager.itemEnd(i)},0),h;if(yr[i]!==void 0){yr[i].push({onLoad:t,onProgress:n,onError:u});return}const p=/^data:(.*?)(;base64)?,(.*)$/,g=i.match(p);let _;if(g){const x=g[1],E=!!g[2];let S=g[3];S=decodeURIComponent(S),E&&(S=atob(S));try{let C;const I=(this.responseType||"").toLowerCase();switch(I){case"arraybuffer":case"blob":const F=new Uint8Array(S.length);for(let G=0;G<S.length;G++)F[G]=S.charCodeAt(G);I==="blob"?C=new Blob([F.buffer],{type:x}):C=F.buffer;break;case"document":C=new DOMParser().parseFromString(S,x);break;case"json":C=JSON.parse(S);break;default:C=S;break}setTimeout(function(){t&&t(C),c.manager.itemEnd(i)},0)}catch(C){setTimeout(function(){u&&u(C),c.manager.itemError(i),c.manager.itemEnd(i)},0)}}else{yr[i]=[],yr[i].push({onLoad:t,onProgress:n,onError:u}),_=new XMLHttpRequest,_.open("GET",i,!0),_.addEventListener("load",function(x){const E=this.response,S=yr[i];if(delete yr[i],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),So.add(i,E);for(let C=0,I=S.length;C<I;C++){const F=S[C];F.onLoad&&F.onLoad(E)}c.manager.itemEnd(i)}else{for(let C=0,I=S.length;C<I;C++){const F=S[C];F.onError&&F.onError(x)}c.manager.itemError(i),c.manager.itemEnd(i)}},!1),_.addEventListener("progress",function(x){const E=yr[i];for(let S=0,C=E.length;S<C;S++){const I=E[S];I.onProgress&&I.onProgress(x)}},!1),_.addEventListener("error",function(x){const E=yr[i];delete yr[i];for(let S=0,C=E.length;S<C;S++){const I=E[S];I.onError&&I.onError(x)}c.manager.itemError(i),c.manager.itemEnd(i)},!1),_.addEventListener("abort",function(x){const E=yr[i];delete yr[i];for(let S=0,C=E.length;S<C;S++){const I=E[S];I.onError&&I.onError(x)}c.manager.itemError(i),c.manager.itemEnd(i)},!1),this.responseType!==void 0&&(_.responseType=this.responseType),this.withCredentials!==void 0&&(_.withCredentials=this.withCredentials),_.overrideMimeType&&_.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const x in this.requestHeader)_.setRequestHeader(x,this.requestHeader[x]);_.send(null)}return c.manager.itemStart(i),_},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}});function bg(i){_i.call(this,i)}bg.prototype=J(Object.create(_i.prototype),{constructor:bg,load:function(i,t,n,u){const c=this,h=new ua(c.manager);h.setPath(c.path),h.setRequestHeader(c.requestHeader),h.setWithCredentials(c.withCredentials),h.load(i,function(p){try{t(c.parse(JSON.parse(p)))}catch(g){u?u(g):console.error(g),c.manager.itemError(i)}},n,u)},parse:function(i){const t=[];for(let n=0;n<i.length;n++){const u=vr.parse(i[n]);t.push(u)}return t}});function Tg(i){_i.call(this,i)}Tg.prototype=J(Object.create(_i.prototype),{constructor:Tg,load:function(i,t,n,u){const c=this,h=[],p=new Bl,g=new ua(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(c.withCredentials);let _=0;function x(E){g.load(i[E],function(S){const C=c.parse(S,!0);h[E]={width:C.width,height:C.height,format:C.format,mipmaps:C.mipmaps},_+=1,_===6&&(C.mipmapCount===1&&(p.minFilter=qi),p.image=h,p.format=C.format,p.needsUpdate=!0,t&&t(p))},n,u)}if(Array.isArray(i))for(let E=0,S=i.length;E<S;++E)x(E);else g.load(i,function(E){const S=c.parse(E,!0);if(S.isCubemap){const C=S.mipmaps.length/S.mipmapCount;for(let I=0;I<C;I++){h[I]={mipmaps:[]};for(let F=0;F<S.mipmapCount;F++)h[I].mipmaps.push(S.mipmaps[I*S.mipmapCount+F]),h[I].format=S.format,h[I].width=S.width,h[I].height=S.height}p.image=h}else p.image.width=S.width,p.image.height=S.height,p.mipmaps=S.mipmaps;S.mipmapCount===1&&(p.minFilter=qi),p.format=S.format,p.needsUpdate=!0,t&&t(p)},n,u);return p}});function Lc(i){_i.call(this,i)}Lc.prototype=J(Object.create(_i.prototype),{constructor:Lc,load:function(i,t,n,u){this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const c=this,h=So.get(i);if(h!==void 0)return c.manager.itemStart(i),setTimeout(function(){t&&t(h),c.manager.itemEnd(i)},0),h;const p=document.createElementNS("http://www.w3.org/1999/xhtml","img");function g(){p.removeEventListener("load",g,!1),p.removeEventListener("error",_,!1),So.add(i,this),t&&t(this),c.manager.itemEnd(i)}function _(x){p.removeEventListener("load",g,!1),p.removeEventListener("error",_,!1),u&&u(x),c.manager.itemError(i),c.manager.itemEnd(i)}return p.addEventListener("load",g,!1),p.addEventListener("error",_,!1),i.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(p.crossOrigin=this.crossOrigin),c.manager.itemStart(i),p.src=i,p}});function uf(i){_i.call(this,i)}uf.prototype=J(Object.create(_i.prototype),{constructor:uf,load:function(i,t,n,u){const c=new ja,h=new Lc(this.manager);h.setCrossOrigin(this.crossOrigin),h.setPath(this.path);let p=0;function g(_){h.load(i[_],function(x){c.images[_]=x,p++,p===6&&(c.needsUpdate=!0,t&&t(c))},void 0,u)}for(let _=0;_<i.length;++_)g(_);return c}});function Ag(i){_i.call(this,i)}Ag.prototype=J(Object.create(_i.prototype),{constructor:Ag,load:function(i,t,n,u){const c=this,h=new oo,p=new ua(this.manager);return p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setPath(this.path),p.setWithCredentials(c.withCredentials),p.load(i,function(g){const _=c.parse(g);_&&(_.image!==void 0?h.image=_.image:_.data!==void 0&&(h.image.width=_.width,h.image.height=_.height,h.image.data=_.data),h.wrapS=_.wrapS!==void 0?_.wrapS:Ai,h.wrapT=_.wrapT!==void 0?_.wrapT:Ai,h.magFilter=_.magFilter!==void 0?_.magFilter:qi,h.minFilter=_.minFilter!==void 0?_.minFilter:qi,h.anisotropy=_.anisotropy!==void 0?_.anisotropy:1,_.encoding!==void 0&&(h.encoding=_.encoding),_.flipY!==void 0&&(h.flipY=_.flipY),_.format!==void 0&&(h.format=_.format),_.type!==void 0&&(h.type=_.type),_.mipmaps!==void 0&&(h.mipmaps=_.mipmaps,h.minFilter=Pr),_.mipmapCount===1&&(h.minFilter=qi),h.needsUpdate=!0,t&&t(h,_))},n,u),h}});function cf(i){_i.call(this,i)}cf.prototype=J(Object.create(_i.prototype),{constructor:cf,load:function(i,t,n,u){const c=new gi,h=new Lc(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(i,function(p){c.image=p;const g=i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0;c.format=g?Bn:fi,c.needsUpdate=!0,t!==void 0&&t(c)},n,u),c}});function Tt(){this.type="Curve",this.arcLengthDivisions=200}J(Tt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,t){const n=this.getUtoTmapping(i);return this.getPoint(n,t)},getPoints:function(i=5){const t=[];for(let n=0;n<=i;n++)t.push(this.getPoint(n/i));return t},getSpacedPoints:function(i=5){const t=[];for(let n=0;n<=i;n++)t.push(this.getPointAt(n/i));return t},getLength:function(){const i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(i===void 0&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,u=this.getPoint(0),c=0;t.push(0);for(let h=1;h<=i;h++)n=this.getPoint(h/i),c+=n.distanceTo(u),t.push(c),u=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,t){const n=this.getLengths();let u=0;const c=n.length;let h;t?h=t:h=i*n[c-1];let p=0,g=c-1,_;for(;p<=g;)if(u=Math.floor(p+(g-p)/2),_=n[u]-h,_<0)p=u+1;else if(_>0)g=u-1;else{g=u;break}if(u=g,n[u]===h)return u/(c-1);const x=n[u],S=n[u+1]-x,C=(h-x)/S;return(u+C)/(c-1)},getTangent:function(i,t){let u=i-1e-4,c=i+1e-4;u<0&&(u=0),c>1&&(c=1);const h=this.getPoint(u),p=this.getPoint(c),g=t||(h.isVector2?new be:new te);return g.copy(p).sub(h).normalize(),g},getTangentAt:function(i,t){const n=this.getUtoTmapping(i);return this.getTangent(n,t)},computeFrenetFrames:function(i,t){const n=new te,u=[],c=[],h=[],p=new te,g=new Ut;for(let C=0;C<=i;C++){const I=C/i;u[C]=this.getTangentAt(I,new te),u[C].normalize()}c[0]=new te,h[0]=new te;let _=Number.MAX_VALUE;const x=Math.abs(u[0].x),E=Math.abs(u[0].y),S=Math.abs(u[0].z);x<=_&&(_=x,n.set(1,0,0)),E<=_&&(_=E,n.set(0,1,0)),S<=_&&n.set(0,0,1),p.crossVectors(u[0],n).normalize(),c[0].crossVectors(u[0],p),h[0].crossVectors(u[0],c[0]);for(let C=1;C<=i;C++){if(c[C]=c[C-1].clone(),h[C]=h[C-1].clone(),p.crossVectors(u[C-1],u[C]),p.length()>Number.EPSILON){p.normalize();const I=Math.acos(At.clamp(u[C-1].dot(u[C]),-1,1));c[C].applyMatrix4(g.makeRotationAxis(p,I))}h[C].crossVectors(u[C],c[C])}if(t===!0){let C=Math.acos(At.clamp(c[0].dot(c[i]),-1,1));C/=i,u[0].dot(p.crossVectors(c[0],c[i]))>0&&(C=-C);for(let I=1;I<=i;I++)c[I].applyMatrix4(g.makeRotationAxis(u[I],C*I)),h[I].crossVectors(u[I],c[I])}return{tangents:u,normals:c,binormals:h}},clone:function(){return new this.constructor().copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}});function ar(i,t,n,u,c,h,p,g){Tt.call(this),this.type="EllipseCurve",this.aX=i||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=u||1,this.aStartAngle=c||0,this.aEndAngle=h||2*Math.PI,this.aClockwise=p||!1,this.aRotation=g||0}ar.prototype=Object.create(Tt.prototype),ar.prototype.constructor=ar,ar.prototype.isEllipseCurve=!0,ar.prototype.getPoint=function(i,t){const n=t||new be,u=Math.PI*2;let c=this.aEndAngle-this.aStartAngle;const h=Math.abs(c)<Number.EPSILON;for(;c<0;)c+=u;for(;c>u;)c-=u;c<Number.EPSILON&&(h?c=0:c=u),this.aClockwise===!0&&!h&&(c===u?c=-u:c=c-u);const p=this.aStartAngle+i*c;let g=this.aX+this.xRadius*Math.cos(p),_=this.aY+this.yRadius*Math.sin(p);if(this.aRotation!==0){const x=Math.cos(this.aRotation),E=Math.sin(this.aRotation),S=g-this.aX,C=_-this.aY;g=S*x-C*E+this.aX,_=S*E+C*x+this.aY}return n.set(g,_)},ar.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this},ar.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.aX=this.aX,i.aY=this.aY,i.xRadius=this.xRadius,i.yRadius=this.yRadius,i.aStartAngle=this.aStartAngle,i.aEndAngle=this.aEndAngle,i.aClockwise=this.aClockwise,i.aRotation=this.aRotation,i},ar.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this};function jl(i,t,n,u,c,h){ar.call(this,i,t,n,n,u,c,h),this.type="ArcCurve"}jl.prototype=Object.create(ar.prototype),jl.prototype.constructor=jl,jl.prototype.isArcCurve=!0;function df(){let i=0,t=0,n=0,u=0;function c(h,p,g,_){i=h,t=g,n=-3*h+3*p-2*g-_,u=2*h-2*p+g+_}return{initCatmullRom:function(h,p,g,_,x){c(p,g,x*(g-h),x*(_-p))},initNonuniformCatmullRom:function(h,p,g,_,x,E,S){let C=(p-h)/x-(g-h)/(x+E)+(g-p)/E,I=(g-p)/E-(_-p)/(E+S)+(_-g)/S;C*=E,I*=E,c(p,g,C,I)},calc:function(h){const p=h*h,g=p*h;return i+t*h+n*p+u*g}}}const Ic=new te,hf=new df,ff=new df,pf=new df;function _r(i=[],t=!1,n="centripetal",u=.5){Tt.call(this),this.type="CatmullRomCurve3",this.points=i,this.closed=t,this.curveType=n,this.tension=u}_r.prototype=Object.create(Tt.prototype),_r.prototype.constructor=_r,_r.prototype.isCatmullRomCurve3=!0,_r.prototype.getPoint=function(i,t=new te){const n=t,u=this.points,c=u.length,h=(c-(this.closed?0:1))*i;let p=Math.floor(h),g=h-p;this.closed?p+=p>0?0:(Math.floor(Math.abs(p)/c)+1)*c:g===0&&p===c-1&&(p=c-2,g=1);let _,x;this.closed||p>0?_=u[(p-1)%c]:(Ic.subVectors(u[0],u[1]).add(u[0]),_=Ic);const E=u[p%c],S=u[(p+1)%c];if(this.closed||p+2<c?x=u[(p+2)%c]:(Ic.subVectors(u[c-1],u[c-2]).add(u[c-1]),x=Ic),this.curveType==="centripetal"||this.curveType==="chordal"){const C=this.curveType==="chordal"?.5:.25;let I=Math.pow(_.distanceToSquared(E),C),F=Math.pow(E.distanceToSquared(S),C),z=Math.pow(S.distanceToSquared(x),C);F<1e-4&&(F=1),I<1e-4&&(I=F),z<1e-4&&(z=F),hf.initNonuniformCatmullRom(_.x,E.x,S.x,x.x,I,F,z),ff.initNonuniformCatmullRom(_.y,E.y,S.y,x.y,I,F,z),pf.initNonuniformCatmullRom(_.z,E.z,S.z,x.z,I,F,z)}else this.curveType==="catmullrom"&&(hf.initCatmullRom(_.x,E.x,S.x,x.x,this.tension),ff.initCatmullRom(_.y,E.y,S.y,x.y,this.tension),pf.initCatmullRom(_.z,E.z,S.z,x.z,this.tension));return n.set(hf.calc(g),ff.calc(g),pf.calc(g)),n},_r.prototype.copy=function(i){Tt.prototype.copy.call(this,i),this.points=[];for(let t=0,n=i.points.length;t<n;t++){const u=i.points[t];this.points.push(u.clone())}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this},_r.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);i.points=[];for(let t=0,n=this.points.length;t<n;t++){const u=this.points[t];i.points.push(u.toArray())}return i.closed=this.closed,i.curveType=this.curveType,i.tension=this.tension,i},_r.prototype.fromJSON=function(i){Tt.prototype.fromJSON.call(this,i),this.points=[];for(let t=0,n=i.points.length;t<n;t++){const u=i.points[t];this.points.push(new te().fromArray(u))}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this};function Sg(i,t,n,u,c){const h=(u-t)*.5,p=(c-n)*.5,g=i*i,_=i*g;return(2*n-2*u+h+p)*_+(-3*n+3*u-2*h-p)*g+h*i+n}function v1(i,t){const n=1-i;return n*n*t}function y1(i,t){return 2*(1-i)*i*t}function _1(i,t){return i*i*t}function ql(i,t,n,u){return v1(i,t)+y1(i,n)+_1(i,u)}function x1(i,t){const n=1-i;return n*n*n*t}function b1(i,t){const n=1-i;return 3*n*n*i*t}function T1(i,t){return 3*(1-i)*i*i*t}function A1(i,t){return i*i*i*t}function Xl(i,t,n,u,c){return x1(i,t)+b1(i,n)+T1(i,u)+A1(i,c)}function Nr(i=new be,t=new be,n=new be,u=new be){Tt.call(this),this.type="CubicBezierCurve",this.v0=i,this.v1=t,this.v2=n,this.v3=u}Nr.prototype=Object.create(Tt.prototype),Nr.prototype.constructor=Nr,Nr.prototype.isCubicBezierCurve=!0,Nr.prototype.getPoint=function(i,t=new be){const n=t,u=this.v0,c=this.v1,h=this.v2,p=this.v3;return n.set(Xl(i,u.x,c.x,h.x,p.x),Xl(i,u.y,c.y,h.y,p.y)),n},Nr.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this},Nr.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i},Nr.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this};function ca(i=new te,t=new te,n=new te,u=new te){Tt.call(this),this.type="CubicBezierCurve3",this.v0=i,this.v1=t,this.v2=n,this.v3=u}ca.prototype=Object.create(Tt.prototype),ca.prototype.constructor=ca,ca.prototype.isCubicBezierCurve3=!0,ca.prototype.getPoint=function(i,t=new te){const n=t,u=this.v0,c=this.v1,h=this.v2,p=this.v3;return n.set(Xl(i,u.x,c.x,h.x,p.x),Xl(i,u.y,c.y,h.y,p.y),Xl(i,u.z,c.z,h.z,p.z)),n},ca.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this},ca.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i},ca.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this};function zn(i=new be,t=new be){Tt.call(this),this.type="LineCurve",this.v1=i,this.v2=t}zn.prototype=Object.create(Tt.prototype),zn.prototype.constructor=zn,zn.prototype.isLineCurve=!0,zn.prototype.getPoint=function(i,t=new be){const n=t;return i===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(i).add(this.v1)),n},zn.prototype.getPointAt=function(i,t){return this.getPoint(i,t)},zn.prototype.getTangent=function(i,t){const n=t||new be;return n.copy(this.v2).sub(this.v1).normalize(),n},zn.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.v1.copy(i.v1),this.v2.copy(i.v2),this},zn.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},zn.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function Ur(i=new te,t=new te){Tt.call(this),this.type="LineCurve3",this.v1=i,this.v2=t}Ur.prototype=Object.create(Tt.prototype),Ur.prototype.constructor=Ur,Ur.prototype.isLineCurve3=!0,Ur.prototype.getPoint=function(i,t=new te){const n=t;return i===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(i).add(this.v1)),n},Ur.prototype.getPointAt=function(i,t){return this.getPoint(i,t)},Ur.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Ur.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Ur.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function Hr(i=new be,t=new be,n=new be){Tt.call(this),this.type="QuadraticBezierCurve",this.v0=i,this.v1=t,this.v2=n}Hr.prototype=Object.create(Tt.prototype),Hr.prototype.constructor=Hr,Hr.prototype.isQuadraticBezierCurve=!0,Hr.prototype.getPoint=function(i,t=new be){const n=t,u=this.v0,c=this.v1,h=this.v2;return n.set(ql(i,u.x,c.x,h.x),ql(i,u.y,c.y,h.y)),n},Hr.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Hr.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Hr.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function da(i=new te,t=new te,n=new te){Tt.call(this),this.type="QuadraticBezierCurve3",this.v0=i,this.v1=t,this.v2=n}da.prototype=Object.create(Tt.prototype),da.prototype.constructor=da,da.prototype.isQuadraticBezierCurve3=!0,da.prototype.getPoint=function(i,t=new te){const n=t,u=this.v0,c=this.v1,h=this.v2;return n.set(ql(i,u.x,c.x,h.x),ql(i,u.y,c.y,h.y),ql(i,u.z,c.z,h.z)),n},da.prototype.copy=function(i){return Tt.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this},da.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},da.prototype.fromJSON=function(i){return Tt.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this};function Vr(i=[]){Tt.call(this),this.type="SplineCurve",this.points=i}Vr.prototype=Object.create(Tt.prototype),Vr.prototype.constructor=Vr,Vr.prototype.isSplineCurve=!0,Vr.prototype.getPoint=function(i,t=new be){const n=t,u=this.points,c=(u.length-1)*i,h=Math.floor(c),p=c-h,g=u[h===0?h:h-1],_=u[h],x=u[h>u.length-2?u.length-1:h+1],E=u[h>u.length-3?u.length-1:h+2];return n.set(Sg(p,g.x,_.x,x.x,E.x),Sg(p,g.y,_.y,x.y,E.y)),n},Vr.prototype.copy=function(i){Tt.prototype.copy.call(this,i),this.points=[];for(let t=0,n=i.points.length;t<n;t++){const u=i.points[t];this.points.push(u.clone())}return this},Vr.prototype.toJSON=function(){const i=Tt.prototype.toJSON.call(this);i.points=[];for(let t=0,n=this.points.length;t<n;t++){const u=this.points[t];i.points.push(u.toArray())}return i},Vr.prototype.fromJSON=function(i){Tt.prototype.fromJSON.call(this,i),this.points=[];for(let t=0,n=i.points.length;t<n;t++){const u=i.points[t];this.points.push(new be().fromArray(u))}return this};var S1=Object.freeze({__proto__:null,ArcCurve:jl,CatmullRomCurve3:_r,CubicBezierCurve:Nr,CubicBezierCurve3:ca,EllipseCurve:ar,LineCurve:zn,LineCurve3:Ur,QuadraticBezierCurve:Hr,QuadraticBezierCurve3:da,SplineCurve:Vr});function Ts(){Tt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}Ts.prototype=J(Object.create(Tt.prototype),{constructor:Ts,add:function(i){this.curves.push(i)},closePath:function(){const i=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);i.equals(t)||this.curves.push(new zn(t,i))},getPoint:function(i){const t=i*this.getLength(),n=this.getCurveLengths();let u=0;for(;u<n.length;){if(n[u]>=t){const c=n[u]-t,h=this.curves[u],p=h.getLength(),g=p===0?0:1-c/p;return h.getPointAt(g)}u++}return null},getLength:function(){const i=this.getCurveLengths();return i[i.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const i=[];let t=0;for(let n=0,u=this.curves.length;n<u;n++)t+=this.curves[n].getLength(),i.push(t);return this.cacheLengths=i,i},getSpacedPoints:function(i=40){const t=[];for(let n=0;n<=i;n++)t.push(this.getPoint(n/i));return this.autoClose&&t.push(t[0]),t},getPoints:function(i=12){const t=[];let n;for(let u=0,c=this.curves;u<c.length;u++){const h=c[u],p=h&&h.isEllipseCurve?i*2:h&&(h.isLineCurve||h.isLineCurve3)?1:h&&h.isSplineCurve?i*h.points.length:i,g=h.getPoints(p);for(let _=0;_<g.length;_++){const x=g[_];n&&n.equals(x)||(t.push(x),n=x)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(i){Tt.prototype.copy.call(this,i),this.curves=[];for(let t=0,n=i.curves.length;t<n;t++){const u=i.curves[t];this.curves.push(u.clone())}return this.autoClose=i.autoClose,this},toJSON:function(){const i=Tt.prototype.toJSON.call(this);i.autoClose=this.autoClose,i.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const u=this.curves[t];i.curves.push(u.toJSON())}return i},fromJSON:function(i){Tt.prototype.fromJSON.call(this,i),this.autoClose=i.autoClose,this.curves=[];for(let t=0,n=i.curves.length;t<n;t++){const u=i.curves[t];this.curves.push(new S1[u.type]().fromJSON(u))}return this}});function Gr(i){Ts.call(this),this.type="Path",this.currentPoint=new be,i&&this.setFromPoints(i)}Gr.prototype=J(Object.create(Ts.prototype),{constructor:Gr,setFromPoints:function(i){this.moveTo(i[0].x,i[0].y);for(let t=1,n=i.length;t<n;t++)this.lineTo(i[t].x,i[t].y);return this},moveTo:function(i,t){return this.currentPoint.set(i,t),this},lineTo:function(i,t){const n=new zn(this.currentPoint.clone(),new be(i,t));return this.curves.push(n),this.currentPoint.set(i,t),this},quadraticCurveTo:function(i,t,n,u){const c=new Hr(this.currentPoint.clone(),new be(i,t),new be(n,u));return this.curves.push(c),this.currentPoint.set(n,u),this},bezierCurveTo:function(i,t,n,u,c,h){const p=new Nr(this.currentPoint.clone(),new be(i,t),new be(n,u),new be(c,h));return this.curves.push(p),this.currentPoint.set(c,h),this},splineThru:function(i){const t=[this.currentPoint.clone()].concat(i),n=new Vr(t);return this.curves.push(n),this.currentPoint.copy(i[i.length-1]),this},arc:function(i,t,n,u,c,h){const p=this.currentPoint.x,g=this.currentPoint.y;return this.absarc(i+p,t+g,n,u,c,h),this},absarc:function(i,t,n,u,c,h){return this.absellipse(i,t,n,n,u,c,h),this},ellipse:function(i,t,n,u,c,h,p,g){const _=this.currentPoint.x,x=this.currentPoint.y;return this.absellipse(i+_,t+x,n,u,c,h,p,g),this},absellipse:function(i,t,n,u,c,h,p,g){const _=new ar(i,t,n,u,c,h,p,g);if(this.curves.length>0){const E=_.getPoint(0);E.equals(this.currentPoint)||this.lineTo(E.x,E.y)}this.curves.push(_);const x=_.getPoint(1);return this.currentPoint.copy(x),this},copy:function(i){return Ts.prototype.copy.call(this,i),this.currentPoint.copy(i.currentPoint),this},toJSON:function(){const i=Ts.prototype.toJSON.call(this);return i.currentPoint=this.currentPoint.toArray(),i},fromJSON:function(i){return Ts.prototype.fromJSON.call(this,i),this.currentPoint.fromArray(i.currentPoint),this}});function wo(i){Gr.call(this,i),this.uuid=At.generateUUID(),this.type="Shape",this.holes=[]}wo.prototype=J(Object.create(Gr.prototype),{constructor:wo,getPointsHoles:function(i){const t=[];for(let n=0,u=this.holes.length;n<u;n++)t[n]=this.holes[n].getPoints(i);return t},extractPoints:function(i){return{shape:this.getPoints(i),holes:this.getPointsHoles(i)}},copy:function(i){Gr.prototype.copy.call(this,i),this.holes=[];for(let t=0,n=i.holes.length;t<n;t++){const u=i.holes[t];this.holes.push(u.clone())}return this},toJSON:function(){const i=Gr.prototype.toJSON.call(this);i.uuid=this.uuid,i.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const u=this.holes[t];i.holes.push(u.toJSON())}return i},fromJSON:function(i){Gr.prototype.fromJSON.call(this,i),this.uuid=i.uuid,this.holes=[];for(let t=0,n=i.holes.length;t<n;t++){const u=i.holes[t];this.holes.push(new Gr().fromJSON(u))}return this}});function wi(i,t=1){gt.call(this),this.type="Light",this.color=new Mt(i),this.intensity=t}wi.prototype=J(Object.create(gt.prototype),{constructor:wi,isLight:!0,copy:function(i){return gt.prototype.copy.call(this,i),this.color.copy(i.color),this.intensity=i.intensity,this},toJSON:function(i){const t=gt.prototype.toJSON.call(this,i);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}});function wg(i,t,n){wi.call(this,i,n),this.type="HemisphereLight",this.position.copy(gt.DefaultUp),this.updateMatrix(),this.groundColor=new Mt(t)}wg.prototype=J(Object.create(wi.prototype),{constructor:wg,isHemisphereLight:!0,copy:function(i){return wi.prototype.copy.call(this,i),this.groundColor.copy(i.groundColor),this}});function ha(i){this.camera=i,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new be(512,512),this.map=null,this.mapPass=null,this.matrix=new Ut,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pc,this._frameExtents=new be(1,1),this._viewportCount=1,this._viewports=[new pi(0,0,1,1)]}J(ha.prototype,{_projScreenMatrix:new Ut,_lightPositionWorld:new te,_lookTarget:new te,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(i){const t=this.camera,n=this.matrix,u=this._projScreenMatrix,c=this._lookTarget,h=this._lightPositionWorld;h.setFromMatrixPosition(i.matrixWorld),t.position.copy(h),c.setFromMatrixPosition(i.target.matrixWorld),t.lookAt(c),t.updateMatrixWorld(),u.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(u),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(i){return this._viewports[i]},getFrameExtents:function(){return this._frameExtents},copy:function(i){return this.camera=i.camera.clone(),this.bias=i.bias,this.radius=i.radius,this.mapSize.copy(i.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const i={};return this.bias!==0&&(i.bias=this.bias),this.normalBias!==0&&(i.normalBias=this.normalBias),this.radius!==1&&(i.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}});function mf(){ha.call(this,new Qi(50,1,.5,500)),this.focus=1}mf.prototype=J(Object.create(ha.prototype),{constructor:mf,isSpotLightShadow:!0,updateMatrices:function(i){const t=this.camera,n=At.RAD2DEG*2*i.angle*this.focus,u=this.mapSize.width/this.mapSize.height,c=i.distance||t.far;(n!==t.fov||u!==t.aspect||c!==t.far)&&(t.fov=n,t.aspect=u,t.far=c,t.updateProjectionMatrix()),ha.prototype.updateMatrices.call(this,i)}});function Eg(i,t,n,u,c,h){wi.call(this,i,t),this.type="SpotLight",this.position.copy(gt.DefaultUp),this.updateMatrix(),this.target=new gt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(p){this.intensity=p/Math.PI}}),this.distance=n!==void 0?n:0,this.angle=u!==void 0?u:Math.PI/3,this.penumbra=c!==void 0?c:0,this.decay=h!==void 0?h:1,this.shadow=new mf}Eg.prototype=J(Object.create(wi.prototype),{constructor:Eg,isSpotLight:!0,copy:function(i){return wi.prototype.copy.call(this,i),this.distance=i.distance,this.angle=i.angle,this.penumbra=i.penumbra,this.decay=i.decay,this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}});function gf(){ha.call(this,new Qi(90,1,.5,500)),this._frameExtents=new be(4,2),this._viewportCount=6,this._viewports=[new pi(2,1,1,1),new pi(0,1,1,1),new pi(3,1,1,1),new pi(1,1,1,1),new pi(3,0,1,1),new pi(1,0,1,1)],this._cubeDirections=[new te(1,0,0),new te(-1,0,0),new te(0,0,1),new te(0,0,-1),new te(0,1,0),new te(0,-1,0)],this._cubeUps=[new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,0,1),new te(0,0,-1)]}gf.prototype=J(Object.create(ha.prototype),{constructor:gf,isPointLightShadow:!0,updateMatrices:function(i,t=0){const n=this.camera,u=this.matrix,c=this._lightPositionWorld,h=this._lookTarget,p=this._projScreenMatrix;c.setFromMatrixPosition(i.matrixWorld),n.position.copy(c),h.copy(n.position),h.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(h),n.updateMatrixWorld(),u.makeTranslation(-c.x,-c.y,-c.z),p.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(p)}});function Mg(i,t,n,u){wi.call(this,i,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(c){this.intensity=c/(4*Math.PI)}}),this.distance=n!==void 0?n:0,this.decay=u!==void 0?u:1,this.shadow=new gf}Mg.prototype=J(Object.create(wi.prototype),{constructor:Mg,isPointLight:!0,copy:function(i){return wi.prototype.copy.call(this,i),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}});function vf(i=-1,t=1,n=1,u=-1,c=.1,h=2e3){Wa.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=t,this.top=n,this.bottom=u,this.near=c,this.far=h,this.updateProjectionMatrix()}vf.prototype=J(Object.create(Wa.prototype),{constructor:vf,isOrthographicCamera:!0,copy:function(i,t){return Wa.prototype.copy.call(this,i,t),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=i.view===null?null:J({},i.view),this},setViewOffset:function(i,t,n,u,c,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=u,this.view.width=c,this.view.height=h,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,u=(this.top+this.bottom)/2;let c=n-i,h=n+i,p=u+t,g=u-t;if(this.view!==null&&this.view.enabled){const _=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;c+=_*this.view.offsetX,h=c+_*this.view.width,p-=x*this.view.offsetY,g=p-x*this.view.height}this.projectionMatrix.makeOrthographic(c,h,p,g,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const t=gt.prototype.toJSON.call(this,i);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=J({},this.view)),t}});function yf(){ha.call(this,new vf(-5,5,5,-5,.5,500))}yf.prototype=J(Object.create(ha.prototype),{constructor:yf,isDirectionalLightShadow:!0,updateMatrices:function(i){ha.prototype.updateMatrices.call(this,i)}});function Cg(i,t){wi.call(this,i,t),this.type="DirectionalLight",this.position.copy(gt.DefaultUp),this.updateMatrix(),this.target=new gt,this.shadow=new yf}Cg.prototype=J(Object.create(wi.prototype),{constructor:Cg,isDirectionalLight:!0,copy:function(i){return wi.prototype.copy.call(this,i),this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}});function Pg(i,t){wi.call(this,i,t),this.type="AmbientLight"}Pg.prototype=J(Object.create(wi.prototype),{constructor:Pg,isAmbientLight:!0});function Lg(i,t,n,u){wi.call(this,i,t),this.type="RectAreaLight",this.width=n!==void 0?n:10,this.height=u!==void 0?u:10}Lg.prototype=J(Object.create(wi.prototype),{constructor:Lg,isRectAreaLight:!0,copy:function(i){return wi.prototype.copy.call(this,i),this.width=i.width,this.height=i.height,this},toJSON:function(i){const t=wi.prototype.toJSON.call(this,i);return t.object.width=this.width,t.object.height=this.height,t}});class w1{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new te)}set(t){for(let n=0;n<9;n++)this.coefficients[n].copy(t[n]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,n){const u=t.x,c=t.y,h=t.z,p=this.coefficients;return n.copy(p[0]).multiplyScalar(.282095),n.addScaledVector(p[1],.488603*c),n.addScaledVector(p[2],.488603*h),n.addScaledVector(p[3],.488603*u),n.addScaledVector(p[4],1.092548*(u*c)),n.addScaledVector(p[5],1.092548*(c*h)),n.addScaledVector(p[6],.315392*(3*h*h-1)),n.addScaledVector(p[7],1.092548*(u*h)),n.addScaledVector(p[8],.546274*(u*u-c*c)),n}getIrradianceAt(t,n){const u=t.x,c=t.y,h=t.z,p=this.coefficients;return n.copy(p[0]).multiplyScalar(.886227),n.addScaledVector(p[1],2*.511664*c),n.addScaledVector(p[2],2*.511664*h),n.addScaledVector(p[3],2*.511664*u),n.addScaledVector(p[4],2*.429043*u*c),n.addScaledVector(p[5],2*.429043*c*h),n.addScaledVector(p[6],.743125*h*h-.247708),n.addScaledVector(p[7],2*.429043*u*h),n.addScaledVector(p[8],.429043*(u*u-c*c)),n}add(t){for(let n=0;n<9;n++)this.coefficients[n].add(t.coefficients[n]);return this}addScaledSH(t,n){for(let u=0;u<9;u++)this.coefficients[u].addScaledVector(t.coefficients[u],n);return this}scale(t){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(t);return this}lerp(t,n){for(let u=0;u<9;u++)this.coefficients[u].lerp(t.coefficients[u],n);return this}equals(t){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(t.coefficients[n]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,n=0){const u=this.coefficients;for(let c=0;c<9;c++)u[c].fromArray(t,n+c*3);return this}toArray(t=[],n=0){const u=this.coefficients;for(let c=0;c<9;c++)u[c].toArray(t,n+c*3);return t}static getBasisAt(t,n){const u=t.x,c=t.y,h=t.z;n[0]=.282095,n[1]=.488603*c,n[2]=.488603*h,n[3]=.488603*u,n[4]=1.092548*u*c,n[5]=1.092548*c*h,n[6]=.315392*(3*h*h-1),n[7]=1.092548*u*h,n[8]=.546274*(u*u-c*c)}}function zr(i,t){wi.call(this,void 0,t),this.type="LightProbe",this.sh=i!==void 0?i:new w1}zr.prototype=J(Object.create(wi.prototype),{constructor:zr,isLightProbe:!0,copy:function(i){return wi.prototype.copy.call(this,i),this.sh.copy(i.sh),this},fromJSON:function(i){return this.intensity=i.intensity,this.sh.fromArray(i.sh),this},toJSON:function(i){const t=wi.prototype.toJSON.call(this,i);return t.object.sh=this.sh.toArray(),t}});function Ig(i){_i.call(this,i),this.textures={}}Ig.prototype=J(Object.create(_i.prototype),{constructor:Ig,load:function(i,t,n,u){const c=this,h=new ua(c.manager);h.setPath(c.path),h.setRequestHeader(c.requestHeader),h.setWithCredentials(c.withCredentials),h.load(i,function(p){try{t(c.parse(JSON.parse(p)))}catch(g){u?u(g):console.error(g),c.manager.itemError(i)}},n,u)},parse:function(i){const t=this.textures;function n(c){return t[c]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",c),t[c]}const u=new h1[i.type];if(i.uuid!==void 0&&(u.uuid=i.uuid),i.name!==void 0&&(u.name=i.name),i.color!==void 0&&u.color!==void 0&&u.color.setHex(i.color),i.roughness!==void 0&&(u.roughness=i.roughness),i.metalness!==void 0&&(u.metalness=i.metalness),i.sheen!==void 0&&(u.sheen=new Mt().setHex(i.sheen)),i.emissive!==void 0&&u.emissive!==void 0&&u.emissive.setHex(i.emissive),i.specular!==void 0&&u.specular!==void 0&&u.specular.setHex(i.specular),i.shininess!==void 0&&(u.shininess=i.shininess),i.clearcoat!==void 0&&(u.clearcoat=i.clearcoat),i.clearcoatRoughness!==void 0&&(u.clearcoatRoughness=i.clearcoatRoughness),i.fog!==void 0&&(u.fog=i.fog),i.flatShading!==void 0&&(u.flatShading=i.flatShading),i.blending!==void 0&&(u.blending=i.blending),i.combine!==void 0&&(u.combine=i.combine),i.side!==void 0&&(u.side=i.side),i.opacity!==void 0&&(u.opacity=i.opacity),i.transparent!==void 0&&(u.transparent=i.transparent),i.alphaTest!==void 0&&(u.alphaTest=i.alphaTest),i.depthTest!==void 0&&(u.depthTest=i.depthTest),i.depthWrite!==void 0&&(u.depthWrite=i.depthWrite),i.colorWrite!==void 0&&(u.colorWrite=i.colorWrite),i.stencilWrite!==void 0&&(u.stencilWrite=i.stencilWrite),i.stencilWriteMask!==void 0&&(u.stencilWriteMask=i.stencilWriteMask),i.stencilFunc!==void 0&&(u.stencilFunc=i.stencilFunc),i.stencilRef!==void 0&&(u.stencilRef=i.stencilRef),i.stencilFuncMask!==void 0&&(u.stencilFuncMask=i.stencilFuncMask),i.stencilFail!==void 0&&(u.stencilFail=i.stencilFail),i.stencilZFail!==void 0&&(u.stencilZFail=i.stencilZFail),i.stencilZPass!==void 0&&(u.stencilZPass=i.stencilZPass),i.wireframe!==void 0&&(u.wireframe=i.wireframe),i.wireframeLinewidth!==void 0&&(u.wireframeLinewidth=i.wireframeLinewidth),i.wireframeLinecap!==void 0&&(u.wireframeLinecap=i.wireframeLinecap),i.wireframeLinejoin!==void 0&&(u.wireframeLinejoin=i.wireframeLinejoin),i.rotation!==void 0&&(u.rotation=i.rotation),i.linewidth!==1&&(u.linewidth=i.linewidth),i.dashSize!==void 0&&(u.dashSize=i.dashSize),i.gapSize!==void 0&&(u.gapSize=i.gapSize),i.scale!==void 0&&(u.scale=i.scale),i.polygonOffset!==void 0&&(u.polygonOffset=i.polygonOffset),i.polygonOffsetFactor!==void 0&&(u.polygonOffsetFactor=i.polygonOffsetFactor),i.polygonOffsetUnits!==void 0&&(u.polygonOffsetUnits=i.polygonOffsetUnits),i.skinning!==void 0&&(u.skinning=i.skinning),i.morphTargets!==void 0&&(u.morphTargets=i.morphTargets),i.morphNormals!==void 0&&(u.morphNormals=i.morphNormals),i.dithering!==void 0&&(u.dithering=i.dithering),i.vertexTangents!==void 0&&(u.vertexTangents=i.vertexTangents),i.visible!==void 0&&(u.visible=i.visible),i.toneMapped!==void 0&&(u.toneMapped=i.toneMapped),i.userData!==void 0&&(u.userData=i.userData),i.vertexColors!==void 0&&(typeof i.vertexColors=="number"?u.vertexColors=i.vertexColors>0:u.vertexColors=i.vertexColors),i.uniforms!==void 0)for(const c in i.uniforms){const h=i.uniforms[c];switch(u.uniforms[c]={},h.type){case"t":u.uniforms[c].value=n(h.value);break;case"c":u.uniforms[c].value=new Mt().setHex(h.value);break;case"v2":u.uniforms[c].value=new be().fromArray(h.value);break;case"v3":u.uniforms[c].value=new te().fromArray(h.value);break;case"v4":u.uniforms[c].value=new pi().fromArray(h.value);break;case"m3":u.uniforms[c].value=new Ji().fromArray(h.value);break;case"m4":u.uniforms[c].value=new Ut().fromArray(h.value);break;default:u.uniforms[c].value=h.value}}if(i.defines!==void 0&&(u.defines=i.defines),i.vertexShader!==void 0&&(u.vertexShader=i.vertexShader),i.fragmentShader!==void 0&&(u.fragmentShader=i.fragmentShader),i.extensions!==void 0)for(const c in i.extensions)u.extensions[c]=i.extensions[c];if(i.shading!==void 0&&(u.flatShading=i.shading===1),i.size!==void 0&&(u.size=i.size),i.sizeAttenuation!==void 0&&(u.sizeAttenuation=i.sizeAttenuation),i.map!==void 0&&(u.map=n(i.map)),i.matcap!==void 0&&(u.matcap=n(i.matcap)),i.alphaMap!==void 0&&(u.alphaMap=n(i.alphaMap)),i.bumpMap!==void 0&&(u.bumpMap=n(i.bumpMap)),i.bumpScale!==void 0&&(u.bumpScale=i.bumpScale),i.normalMap!==void 0&&(u.normalMap=n(i.normalMap)),i.normalMapType!==void 0&&(u.normalMapType=i.normalMapType),i.normalScale!==void 0){let c=i.normalScale;Array.isArray(c)===!1&&(c=[c,c]),u.normalScale=new be().fromArray(c)}return i.displacementMap!==void 0&&(u.displacementMap=n(i.displacementMap)),i.displacementScale!==void 0&&(u.displacementScale=i.displacementScale),i.displacementBias!==void 0&&(u.displacementBias=i.displacementBias),i.roughnessMap!==void 0&&(u.roughnessMap=n(i.roughnessMap)),i.metalnessMap!==void 0&&(u.metalnessMap=n(i.metalnessMap)),i.emissiveMap!==void 0&&(u.emissiveMap=n(i.emissiveMap)),i.emissiveIntensity!==void 0&&(u.emissiveIntensity=i.emissiveIntensity),i.specularMap!==void 0&&(u.specularMap=n(i.specularMap)),i.envMap!==void 0&&(u.envMap=n(i.envMap)),i.envMapIntensity!==void 0&&(u.envMapIntensity=i.envMapIntensity),i.reflectivity!==void 0&&(u.reflectivity=i.reflectivity),i.refractionRatio!==void 0&&(u.refractionRatio=i.refractionRatio),i.lightMap!==void 0&&(u.lightMap=n(i.lightMap)),i.lightMapIntensity!==void 0&&(u.lightMapIntensity=i.lightMapIntensity),i.aoMap!==void 0&&(u.aoMap=n(i.aoMap)),i.aoMapIntensity!==void 0&&(u.aoMapIntensity=i.aoMapIntensity),i.gradientMap!==void 0&&(u.gradientMap=n(i.gradientMap)),i.clearcoatMap!==void 0&&(u.clearcoatMap=n(i.clearcoatMap)),i.clearcoatRoughnessMap!==void 0&&(u.clearcoatRoughnessMap=n(i.clearcoatRoughnessMap)),i.clearcoatNormalMap!==void 0&&(u.clearcoatNormalMap=n(i.clearcoatNormalMap)),i.clearcoatNormalScale!==void 0&&(u.clearcoatNormalScale=new be().fromArray(i.clearcoatNormalScale)),i.transmission!==void 0&&(u.transmission=i.transmission),i.transmissionMap!==void 0&&(u.transmissionMap=n(i.transmissionMap)),u},setTextures:function(i){return this.textures=i,this}});const E1={decodeText:function(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let t="";for(let n=0,u=i.length;n<u;n++)t+=String.fromCharCode(i[n]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(i){const t=i.lastIndexOf("/");return t===-1?"./":i.substr(0,t+1)}};function Dc(){mi.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}Dc.prototype=J(Object.create(mi.prototype),{constructor:Dc,isInstancedBufferGeometry:!0,copy:function(i){return mi.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const i=mi.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}});function _f(i,t,n,u){typeof n=="number"&&(u=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Qt.call(this,i,t,n),this.meshPerAttribute=u||1}_f.prototype=J(Object.create(Qt.prototype),{constructor:_f,isInstancedBufferAttribute:!0,copy:function(i){return Qt.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){const i=Qt.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}});function Dg(i){_i.call(this,i)}Dg.prototype=J(Object.create(_i.prototype),{constructor:Dg,load:function(i,t,n,u){const c=this,h=new ua(c.manager);h.setPath(c.path),h.setRequestHeader(c.requestHeader),h.setWithCredentials(c.withCredentials),h.load(i,function(p){try{t(c.parse(JSON.parse(p)))}catch(g){u?u(g):console.error(g),c.manager.itemError(i)}},n,u)},parse:function(i){const t={},n={};function u(C,I){if(t[I]!==void 0)return t[I];const z=C.interleavedBuffers[I],G=c(C,z.buffer),k=rc(z.type,G),O=new nr(k,z.stride);return O.uuid=z.uuid,t[I]=O,O}function c(C,I){if(n[I]!==void 0)return n[I];const z=C.arrayBuffers[I],G=new Uint32Array(z).buffer;return n[I]=G,G}const h=i.isInstancedBufferGeometry?new Dc:new mi,p=i.data.index;if(p!==void 0){const C=rc(p.type,p.array);h.setIndex(new Qt(C,1))}const g=i.data.attributes;for(const C in g){const I=g[C];let F;if(I.isInterleavedBufferAttribute){const z=u(i.data,I.data);F=new vs(z,I.itemSize,I.offset,I.normalized)}else{const z=rc(I.type,I.array),G=I.isInstancedBufferAttribute?_f:Qt;F=new G(z,I.itemSize,I.normalized)}I.name!==void 0&&(F.name=I.name),h.setAttribute(C,F)}const _=i.data.morphAttributes;if(_)for(const C in _){const I=_[C],F=[];for(let z=0,G=I.length;z<G;z++){const k=I[z];let O;if(k.isInterleavedBufferAttribute){const se=u(i.data,k.data);O=new vs(se,k.itemSize,k.offset,k.normalized)}else{const se=rc(k.type,k.array);O=new Qt(se,k.itemSize,k.normalized)}k.name!==void 0&&(O.name=k.name),F.push(O)}h.morphAttributes[C]=F}i.data.morphTargetsRelative&&(h.morphTargetsRelative=!0);const E=i.data.groups||i.data.drawcalls||i.data.offsets;if(E!==void 0)for(let C=0,I=E.length;C!==I;++C){const F=E[C];h.addGroup(F.start,F.count,F.materialIndex)}const S=i.data.boundingSphere;if(S!==void 0){const C=new te;S.center!==void 0&&C.fromArray(S.center),h.boundingSphere=new sa(C,S.radius)}return i.name&&(h.name=i.name),i.userData&&(h.userData=i.userData),h}});function Rg(i){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),_i.call(this,i),this.options={premultiplyAlpha:"none"}}Rg.prototype=J(Object.create(_i.prototype),{constructor:Rg,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(i,t,n,u){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const c=this,h=So.get(i);if(h!==void 0)return c.manager.itemStart(i),setTimeout(function(){t&&t(h),c.manager.itemEnd(i)},0),h;const p={};p.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",fetch(i,p).then(function(g){return g.blob()}).then(function(g){return createImageBitmap(g,c.options)}).then(function(g){So.add(i,g),t&&t(g),c.manager.itemEnd(i)}).catch(function(g){u&&u(g),c.manager.itemError(i),c.manager.itemEnd(i)}),c.manager.itemStart(i)}});function Og(){this.type="ShapePath",this.color=new Mt,this.subPaths=[],this.currentPath=null}J(Og.prototype,{moveTo:function(i,t){return this.currentPath=new Gr,this.subPaths.push(this.currentPath),this.currentPath.moveTo(i,t),this},lineTo:function(i,t){return this.currentPath.lineTo(i,t),this},quadraticCurveTo:function(i,t,n,u){return this.currentPath.quadraticCurveTo(i,t,n,u),this},bezierCurveTo:function(i,t,n,u,c,h){return this.currentPath.bezierCurveTo(i,t,n,u,c,h),this},splineThru:function(i){return this.currentPath.splineThru(i),this},toShapes:function(i,t){function n(k){const O=[];for(let se=0,oe=k.length;se<oe;se++){const re=k[se],X=new wo;X.curves=re.curves,O.push(X)}return O}function u(k,O){const se=O.length;let oe=!1;for(let re=se-1,X=0;X<se;re=X++){let me=O[re],ke=O[X],xe=ke.x-me.x,Se=ke.y-me.y;if(Math.abs(Se)>Number.EPSILON){if(Se<0&&(me=O[X],xe=-xe,ke=O[re],Se=-Se),k.y<me.y||k.y>ke.y)continue;if(k.y===me.y){if(k.x===me.x)return!0}else{const we=Se*(k.x-me.x)-xe*(k.y-me.y);if(we===0)return!0;if(we<0)continue;oe=!oe}}else{if(k.y!==me.y)continue;if(ke.x<=k.x&&k.x<=me.x||me.x<=k.x&&k.x<=ke.x)return!0}}return oe}const c=Qa.isClockWise,h=this.subPaths;if(h.length===0)return[];if(t===!0)return n(h);let p,g,_;const x=[];if(h.length===1)return g=h[0],_=new wo,_.curves=g.curves,x.push(_),x;let E=!c(h[0].getPoints());E=i?!E:E;const S=[],C=[];let I=[],F=0,z;C[F]=void 0,I[F]=[];for(let k=0,O=h.length;k<O;k++)g=h[k],z=g.getPoints(),p=c(z),p=i?!p:p,p?(!E&&C[F]&&F++,C[F]={s:new wo,p:z},C[F].s.curves=g.curves,E&&F++,I[F]=[]):I[F].push({h:g,p:z[0]});if(!C[0])return n(h);if(C.length>1){let k=!1;const O=[];for(let se=0,oe=C.length;se<oe;se++)S[se]=[];for(let se=0,oe=C.length;se<oe;se++){const re=I[se];for(let X=0;X<re.length;X++){const me=re[X];let ke=!0;for(let xe=0;xe<C.length;xe++)u(me.p,C[xe].p)&&(se!==xe&&O.push({froms:se,tos:xe,hole:X}),ke?(ke=!1,S[xe].push(me)):k=!0);ke&&S[se].push(me)}}O.length>0&&(k||(I=S))}let G;for(let k=0,O=C.length;k<O;k++){_=C[k].s,x.push(_),G=I[k];for(let se=0,oe=G.length;se<oe;se++)_.holes.push(G[se].h)}return x}});class M1{constructor(t){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=t}generateShapes(t,n=100){const u=[],c=C1(t,n,this.data);for(let h=0,p=c.length;h<p;h++)Array.prototype.push.apply(u,c[h].toShapes());return u}}function C1(i,t,n){const u=Array.from?Array.from(i):String(i).split(""),c=t/n.resolution,h=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*c,p=[];let g=0,_=0;for(let x=0;x<u.length;x++){const E=u[x];if(E===`
`)g=0,_-=h;else{const S=P1(E,c,g,_,n);g+=S.offsetX,p.push(S.path)}}return p}function P1(i,t,n,u,c){const h=c.glyphs[i]||c.glyphs["?"];if(!h){console.error('THREE.Font: character "'+i+'" does not exists in font family '+c.familyName+".");return}const p=new Og;let g,_,x,E,S,C,I,F;if(h.o){const z=h._cachedOutline||(h._cachedOutline=h.o.split(" "));for(let G=0,k=z.length;G<k;)switch(z[G++]){case"m":g=z[G++]*t+n,_=z[G++]*t+u,p.moveTo(g,_);break;case"l":g=z[G++]*t+n,_=z[G++]*t+u,p.lineTo(g,_);break;case"q":x=z[G++]*t+n,E=z[G++]*t+u,S=z[G++]*t+n,C=z[G++]*t+u,p.quadraticCurveTo(S,C,x,E);break;case"b":x=z[G++]*t+n,E=z[G++]*t+u,S=z[G++]*t+n,C=z[G++]*t+u,I=z[G++]*t+n,F=z[G++]*t+u,p.bezierCurveTo(S,C,I,F,x,E);break}}return{offsetX:h.ha*t,path:p}}function Fg(i){_i.call(this,i)}Fg.prototype=J(Object.create(_i.prototype),{constructor:Fg,load:function(i,t,n,u){const c=this,h=new ua(this.manager);h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(c.withCredentials),h.load(i,function(p){let g;try{g=JSON.parse(p)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),g=JSON.parse(p.substring(65,p.length-2))}const _=c.parse(g);t&&t(_)},n,u)},parse:function(i){return new M1(i)}});let Rc;const kg={getContext:function(){return Rc===void 0&&(Rc=new(window.AudioContext||window.webkitAudioContext)),Rc},setContext:function(i){Rc=i}};function Bg(i){_i.call(this,i)}Bg.prototype=J(Object.create(_i.prototype),{constructor:Bg,load:function(i,t,n,u){const c=this,h=new ua(c.manager);h.setResponseType("arraybuffer"),h.setPath(c.path),h.setRequestHeader(c.requestHeader),h.setWithCredentials(c.withCredentials),h.load(i,function(p){try{const g=p.slice(0);kg.getContext().decodeAudioData(g,function(x){t(x)})}catch(g){u?u(g):console.error(g),c.manager.itemError(i)}},n,u)}});function Ng(i,t,n){zr.call(this,void 0,n);const u=new Mt().set(i),c=new Mt().set(t),h=new te(u.r,u.g,u.b),p=new te(c.r,c.g,c.b),g=Math.sqrt(Math.PI),_=g*Math.sqrt(.75);this.sh.coefficients[0].copy(h).add(p).multiplyScalar(g),this.sh.coefficients[1].copy(h).sub(p).multiplyScalar(_)}Ng.prototype=J(Object.create(zr.prototype),{constructor:Ng,isHemisphereLightProbe:!0,copy:function(i){return zr.prototype.copy.call(this,i),this},toJSON:function(i){return zr.prototype.toJSON.call(this,i)}});function Ug(i,t){zr.call(this,void 0,t);const n=new Mt().set(i);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Ug.prototype=J(Object.create(zr.prototype),{constructor:Ug,isAmbientLightProbe:!0,copy:function(i){return zr.prototype.copy.call(this,i),this},toJSON:function(i){return zr.prototype.toJSON.call(this,i)}});const Hg=new Ut,Vg=new Ut;function L1(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Qi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Qi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}J(L1.prototype,{update:function(i){const t=this._cache;if(t.focus!==i.focus||t.fov!==i.fov||t.aspect!==i.aspect*this.aspect||t.near!==i.near||t.far!==i.far||t.zoom!==i.zoom||t.eyeSep!==this.eyeSep){t.focus=i.focus,t.fov=i.fov,t.aspect=i.aspect*this.aspect,t.near=i.near,t.far=i.far,t.zoom=i.zoom,t.eyeSep=this.eyeSep;const u=i.projectionMatrix.clone(),c=t.eyeSep/2,h=c*t.near/t.focus,p=t.near*Math.tan(At.DEG2RAD*t.fov*.5)/t.zoom;let g,_;Vg.elements[12]=-c,Hg.elements[12]=c,g=-p*t.aspect+h,_=p*t.aspect+h,u.elements[0]=2*t.near/(_-g),u.elements[8]=(_+g)/(_-g),this.cameraL.projectionMatrix.copy(u),g=-p*t.aspect-h,_=p*t.aspect-h,u.elements[0]=2*t.near/(_-g),u.elements[8]=(_+g)/(_-g),this.cameraR.projectionMatrix.copy(u)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(Vg),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(Hg)}});function Gg(i,t,n){this.binding=i,this.valueSize=n;let u,c,h;switch(t){case"quaternion":u=this._slerp,c=this._slerpAdditive,h=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":u=this._select,c=this._select,h=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:u=this._lerp,c=this._lerpAdditive,h=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=u,this._mixBufferRegionAdditive=c,this._setIdentity=h,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}J(Gg.prototype,{accumulate:function(i,t){const n=this.buffer,u=this.valueSize,c=i*u+u;let h=this.cumulativeWeight;if(h===0){for(let p=0;p!==u;++p)n[c+p]=n[p];h=t}else{h+=t;const p=t/h;this._mixBufferRegion(n,c,0,p,u)}this.cumulativeWeight=h},accumulateAdditive:function(i){const t=this.buffer,n=this.valueSize,u=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,u,0,i,n),this.cumulativeWeightAdditive+=i},apply:function(i){const t=this.valueSize,n=this.buffer,u=i*t+t,c=this.cumulativeWeight,h=this.cumulativeWeightAdditive,p=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,c<1){const g=t*this._origIndex;this._mixBufferRegion(n,u,g,1-c,t)}h>0&&this._mixBufferRegionAdditive(n,u,this._addIndex*t,1,t);for(let g=t,_=t+t;g!==_;++g)if(n[g]!==n[g+t]){p.setValue(n,u);break}},saveOriginalState:function(){const i=this.binding,t=this.buffer,n=this.valueSize,u=n*this._origIndex;i.getValue(t,u);for(let c=n,h=u;c!==h;++c)t[c]=t[u+c%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const i=this.valueSize*3;this.binding.setValue(this.buffer,i)},_setAdditiveIdentityNumeric:function(){const i=this._addIndex*this.valueSize,t=i+this.valueSize;for(let n=i;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const i=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[i+n]},_select:function(i,t,n,u,c){if(u>=.5)for(let h=0;h!==c;++h)i[t+h]=i[n+h]},_slerp:function(i,t,n,u){Fi.slerpFlat(i,t,i,t,i,n,u)},_slerpAdditive:function(i,t,n,u,c){const h=this._workIndex*c;Fi.multiplyQuaternionsFlat(i,h,i,t,i,n),Fi.slerpFlat(i,t,i,t,i,h,u)},_lerp:function(i,t,n,u,c){const h=1-u;for(let p=0;p!==c;++p){const g=t+p;i[g]=i[g]*h+i[n+p]*u}},_lerpAdditive:function(i,t,n,u,c){for(let h=0;h!==c;++h){const p=t+h;i[p]=i[p]+i[n+h]*u}}});const xf="\\[\\]\\.:\\/",I1=new RegExp("["+xf+"]","g"),bf="[^"+xf+"]",D1="[^"+xf.replace("\\.","")+"]",R1=/((?:WC+[\/:])*)/.source.replace("WC",bf),O1=/(WCOD+)?/.source.replace("WCOD",D1),F1=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bf),k1=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bf),B1=new RegExp("^"+R1+O1+F1+k1+"$"),N1=["material","materials","bones"];function zg(i,t,n){const u=n||xn.parseTrackName(t);this._targetGroup=i,this._bindings=i.subscribe_(t,u)}J(zg.prototype,{getValue:function(i,t){this.bind();const n=this._targetGroup.nCachedObjects_,u=this._bindings[n];u!==void 0&&u.getValue(i,t)},setValue:function(i,t){const n=this._bindings;for(let u=this._targetGroup.nCachedObjects_,c=n.length;u!==c;++u)n[u].setValue(i,t)},bind:function(){const i=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=i.length;t!==n;++t)i[t].bind()},unbind:function(){const i=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=i.length;t!==n;++t)i[t].unbind()}});function xn(i,t,n){this.path=t,this.parsedPath=n||xn.parseTrackName(t),this.node=xn.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i}J(xn,{Composite:zg,create:function(i,t,n){return i&&i.isAnimationObjectGroup?new xn.Composite(i,t,n):new xn(i,t,n)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(I1,"")},parseTrackName:function(i){const t=B1.exec(i);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},u=n.nodeName&&n.nodeName.lastIndexOf(".");if(u!==void 0&&u!==-1){const c=n.nodeName.substring(u+1);N1.indexOf(c)!==-1&&(n.nodeName=n.nodeName.substring(0,u),n.objectName=c)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return n},findNode:function(i,t){if(!t||t===""||t==="."||t===-1||t===i.name||t===i.uuid)return i;if(i.skeleton){const n=i.skeleton.getBoneByName(t);if(n!==void 0)return n}if(i.children){const n=function(c){for(let h=0;h<c.length;h++){const p=c[h];if(p.name===t||p.uuid===t)return p;const g=n(p.children);if(g)return g}return null},u=n(i.children);if(u)return u}return null}}),J(xn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,n){t[n]=this.node[this.propertyName]},function(t,n){const u=this.resolvedProperty;for(let c=0,h=u.length;c!==h;++c)t[n++]=u[c]},function(t,n){t[n]=this.resolvedProperty[this.propertyIndex]},function(t,n){this.resolvedProperty.toArray(t,n)}],SetterByBindingTypeAndVersioning:[[function(t,n){this.targetObject[this.propertyName]=t[n]},function(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.needsUpdate=!0},function(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){const u=this.resolvedProperty;for(let c=0,h=u.length;c!==h;++c)u[c]=t[n++]},function(t,n){const u=this.resolvedProperty;for(let c=0,h=u.length;c!==h;++c)u[c]=t[n++];this.targetObject.needsUpdate=!0},function(t,n){const u=this.resolvedProperty;for(let c=0,h=u.length;c!==h;++c)u[c]=t[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){this.resolvedProperty[this.propertyIndex]=t[n]},function(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.needsUpdate=!0},function(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){this.resolvedProperty.fromArray(t,n)},function(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.needsUpdate=!0},function(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,n){this.bind(),this.getValue(t,n)},setValue:function(t,n){this.bind(),this.setValue(t,n)},bind:function(){let i=this.node;const t=this.parsedPath,n=t.objectName,u=t.propertyName;let c=t.propertyIndex;if(i||(i=xn.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let _=t.objectIndex;switch(n){case"materials":if(!i.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!i.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}i=i.material.materials;break;case"bones":if(!i.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}i=i.skeleton.bones;for(let x=0;x<i.length;x++)if(i[x].name===_){_=x;break}break;default:if(i[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}i=i[n]}if(_!==void 0){if(i[_]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);return}i=i[_]}}const h=i[u];if(h===void 0){const _=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+_+"."+u+" but it wasn't found.",i);return}let p=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?p=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(p=this.Versioning.MatrixWorldNeedsUpdate);let g=this.BindingType.Direct;if(c!==void 0){if(u==="morphTargetInfluences"){if(!i.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(i.geometry.isBufferGeometry){if(!i.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}i.morphTargetDictionary[c]!==void 0&&(c=i.morphTargetDictionary[c])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}g=this.BindingType.ArrayElement,this.resolvedProperty=h,this.propertyIndex=c}else h.fromArray!==void 0&&h.toArray!==void 0?(g=this.BindingType.HasFromToArray,this.resolvedProperty=h):Array.isArray(h)?(g=this.BindingType.EntireArray,this.resolvedProperty=h):this.propertyName=u;this.getValue=this.GetterByBindingType[g],this.setValue=this.SetterByBindingTypeAndVersioning[g][p]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),J(xn.prototype,{_getValue_unbound:xn.prototype.getValue,_setValue_unbound:xn.prototype.setValue});function U1(){this.uuid=At.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let n=0,u=arguments.length;n!==u;++n)i[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}J(U1.prototype,{isAnimationObjectGroup:!0,add:function(){const i=this._objects,t=this._indicesByUUID,n=this._paths,u=this._parsedPaths,c=this._bindings,h=c.length;let p,g=i.length,_=this.nCachedObjects_;for(let x=0,E=arguments.length;x!==E;++x){const S=arguments[x],C=S.uuid;let I=t[C];if(I===void 0){I=g++,t[C]=I,i.push(S);for(let F=0,z=h;F!==z;++F)c[F].push(new xn(S,n[F],u[F]))}else if(I<_){p=i[I];const F=--_,z=i[F];t[z.uuid]=I,i[I]=z,t[C]=F,i[F]=S;for(let G=0,k=h;G!==k;++G){const O=c[G],se=O[F];let oe=O[I];O[I]=se,oe===void 0&&(oe=new xn(S,n[G],u[G])),O[F]=oe}}else i[I]!==p&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=_},remove:function(){const i=this._objects,t=this._indicesByUUID,n=this._bindings,u=n.length;let c=this.nCachedObjects_;for(let h=0,p=arguments.length;h!==p;++h){const g=arguments[h],_=g.uuid,x=t[_];if(x!==void 0&&x>=c){const E=c++,S=i[E];t[S.uuid]=x,i[x]=S,t[_]=E,i[E]=g;for(let C=0,I=u;C!==I;++C){const F=n[C],z=F[E],G=F[x];F[x]=z,F[E]=G}}}this.nCachedObjects_=c},uncache:function(){const i=this._objects,t=this._indicesByUUID,n=this._bindings,u=n.length;let c=this.nCachedObjects_,h=i.length;for(let p=0,g=arguments.length;p!==g;++p){const _=arguments[p],x=_.uuid,E=t[x];if(E!==void 0)if(delete t[x],E<c){const S=--c,C=i[S],I=--h,F=i[I];t[C.uuid]=E,i[E]=C,t[F.uuid]=S,i[S]=F,i.pop();for(let z=0,G=u;z!==G;++z){const k=n[z],O=k[S],se=k[I];k[E]=O,k[S]=se,k.pop()}}else{const S=--h,C=i[S];S>0&&(t[C.uuid]=E),i[E]=C,i.pop();for(let I=0,F=u;I!==F;++I){const z=n[I];z[E]=z[S],z.pop()}}}this.nCachedObjects_=c},subscribe_:function(i,t){const n=this._bindingsIndicesByPath;let u=n[i];const c=this._bindings;if(u!==void 0)return c[u];const h=this._paths,p=this._parsedPaths,g=this._objects,_=g.length,x=this.nCachedObjects_,E=new Array(_);u=c.length,n[i]=u,h.push(i),p.push(t),c.push(E);for(let S=x,C=g.length;S!==C;++S){const I=g[S];E[S]=new xn(I,i,t)}return E},unsubscribe_:function(i){const t=this._bindingsIndicesByPath,n=t[i];if(n!==void 0){const u=this._paths,c=this._parsedPaths,h=this._bindings,p=h.length-1,g=h[p],_=i[p];t[_]=n,h[n]=g,h.pop(),c[n]=c[p],c.pop(),u[n]=u[p],u.pop()}}});class H1{constructor(t,n,u=null,c=n.blendMode){this._mixer=t,this._clip=n,this._localRoot=u,this.blendMode=c;const h=n.tracks,p=h.length,g=new Array(p),_={endingStart:Cn,endingEnd:Cn};for(let x=0;x!==p;++x){const E=h[x].createInterpolant(null);g[x]=E,E.settings=_}this._interpolantSettings=_,this._interpolants=g,this._propertyBindings=new Array(p),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=hh,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,n){return this.loop=t,this.repetitions=n,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,n,u){if(t.fadeOut(n),this.fadeIn(n),u){const c=this._clip.duration,h=t._clip.duration,p=h/c,g=c/h;t.warp(1,p,n),this.warp(g,1,n)}return this}crossFadeTo(t,n,u){return t.crossFadeFrom(this,n,u)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,n,u){const c=this._mixer,h=c.time,p=this.timeScale;let g=this._timeScaleInterpolant;g===null&&(g=c._lendControlInterpolant(),this._timeScaleInterpolant=g);const _=g.parameterPositions,x=g.sampleValues;return _[0]=h,_[1]=h+u,x[0]=t/p,x[1]=n/p,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,n,u,c){if(!this.enabled){this._updateWeight(t);return}const h=this._startTime;if(h!==null){const _=(t-h)*u;if(_<0||u===0)return;this._startTime=null,n=u*_}n*=this._updateTimeScale(t);const p=this._updateTime(n),g=this._updateWeight(t);if(g>0){const _=this._interpolants,x=this._propertyBindings;switch(this.blendMode){case vl:for(let E=0,S=_.length;E!==S;++E)_[E].evaluate(p),x[E].accumulateAdditive(g);break;case qs:default:for(let E=0,S=_.length;E!==S;++E)_[E].evaluate(p),x[E].accumulate(c,g)}}}_updateWeight(t){let n=0;if(this.enabled){n=this.weight;const u=this._weightInterpolant;if(u!==null){const c=u.evaluate(t)[0];n*=c,t>u.parameterPositions[1]&&(this.stopFading(),c===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(t){let n=0;if(!this.paused){n=this.timeScale;const u=this._timeScaleInterpolant;if(u!==null){const c=u.evaluate(t)[0];n*=c,t>u.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(t){const n=this._clip.duration,u=this.loop;let c=this.time+t,h=this._loopCount;const p=u===fh;if(t===0)return h===-1?c:p&&(h&1)===1?n-c:c;if(u===dh){h===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(c>=n)c=n;else if(c<0)c=0;else{this.time=c;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=c,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(h===-1&&(t>=0?(h=0,this._setEndings(!0,this.repetitions===0,p)):this._setEndings(this.repetitions===0,!0,p)),c>=n||c<0){const g=Math.floor(c/n);c-=n*g,h+=Math.abs(g);const _=this.repetitions-h;if(_<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,c=t>0?n:0,this.time=c,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(_===1){const x=t<0;this._setEndings(x,!x,p)}else this._setEndings(!1,!1,p);this._loopCount=h,this.time=c,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=c;if(p&&(h&1)===1)return n-c}return c}_setEndings(t,n,u){const c=this._interpolantSettings;u?(c.endingStart=Oa,c.endingEnd=Oa):(t?c.endingStart=this.zeroSlopeAtStart?Oa:Cn:c.endingStart=os,n?c.endingEnd=this.zeroSlopeAtEnd?Oa:Cn:c.endingEnd=os)}_scheduleFading(t,n,u){const c=this._mixer,h=c.time;let p=this._weightInterpolant;p===null&&(p=c._lendControlInterpolant(),this._weightInterpolant=p);const g=p.parameterPositions,_=p.sampleValues;return g[0]=h,_[0]=n,g[1]=h+t,_[1]=u,this}}function Wg(i){this._root=i,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Wg.prototype=J(Object.create($n.prototype),{constructor:Wg,_bindAction:function(i,t){const n=i._localRoot||this._root,u=i._clip.tracks,c=u.length,h=i._propertyBindings,p=i._interpolants,g=n.uuid,_=this._bindingsByRootAndName;let x=_[g];x===void 0&&(x={},_[g]=x);for(let E=0;E!==c;++E){const S=u[E],C=S.name;let I=x[C];if(I!==void 0)h[E]=I;else{if(I=h[E],I!==void 0){I._cacheIndex===null&&(++I.referenceCount,this._addInactiveBinding(I,g,C));continue}const F=t&&t._propertyBindings[E].binding.parsedPath;I=new Gg(xn.create(n,C,F),S.ValueTypeName,S.getValueSize()),++I.referenceCount,this._addInactiveBinding(I,g,C),h[E]=I}p[E].resultBuffer=I.buffer}},_activateAction:function(i){if(!this._isActiveAction(i)){if(i._cacheIndex===null){const n=(i._localRoot||this._root).uuid,u=i._clip.uuid,c=this._actionsByClip[u];this._bindAction(i,c&&c.knownActions[0]),this._addInactiveAction(i,u,n)}const t=i._propertyBindings;for(let n=0,u=t.length;n!==u;++n){const c=t[n];c.useCount++===0&&(this._lendBinding(c),c.saveOriginalState())}this._lendAction(i)}},_deactivateAction:function(i){if(this._isActiveAction(i)){const t=i._propertyBindings;for(let n=0,u=t.length;n!==u;++n){const c=t[n];--c.useCount===0&&(c.restoreOriginalState(),this._takeBackBinding(c))}this._takeBackAction(i)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const i=this;this.stats={actions:{get total(){return i._actions.length},get inUse(){return i._nActiveActions}},bindings:{get total(){return i._bindings.length},get inUse(){return i._nActiveBindings}},controlInterpolants:{get total(){return i._controlInterpolants.length},get inUse(){return i._nActiveControlInterpolants}}}},_isActiveAction:function(i){const t=i._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(i,t,n){const u=this._actions,c=this._actionsByClip;let h=c[t];if(h===void 0)h={knownActions:[i],actionByRoot:{}},i._byClipCacheIndex=0,c[t]=h;else{const p=h.knownActions;i._byClipCacheIndex=p.length,p.push(i)}i._cacheIndex=u.length,u.push(i),h.actionByRoot[n]=i},_removeInactiveAction:function(i){const t=this._actions,n=t[t.length-1],u=i._cacheIndex;n._cacheIndex=u,t[u]=n,t.pop(),i._cacheIndex=null;const c=i._clip.uuid,h=this._actionsByClip,p=h[c],g=p.knownActions,_=g[g.length-1],x=i._byClipCacheIndex;_._byClipCacheIndex=x,g[x]=_,g.pop(),i._byClipCacheIndex=null;const E=p.actionByRoot,S=(i._localRoot||this._root).uuid;delete E[S],g.length===0&&delete h[c],this._removeInactiveBindingsForAction(i)},_removeInactiveBindingsForAction:function(i){const t=i._propertyBindings;for(let n=0,u=t.length;n!==u;++n){const c=t[n];--c.referenceCount===0&&this._removeInactiveBinding(c)}},_lendAction:function(i){const t=this._actions,n=i._cacheIndex,u=this._nActiveActions++,c=t[u];i._cacheIndex=u,t[u]=i,c._cacheIndex=n,t[n]=c},_takeBackAction:function(i){const t=this._actions,n=i._cacheIndex,u=--this._nActiveActions,c=t[u];i._cacheIndex=u,t[u]=i,c._cacheIndex=n,t[n]=c},_addInactiveBinding:function(i,t,n){const u=this._bindingsByRootAndName,c=this._bindings;let h=u[t];h===void 0&&(h={},u[t]=h),h[n]=i,i._cacheIndex=c.length,c.push(i)},_removeInactiveBinding:function(i){const t=this._bindings,n=i.binding,u=n.rootNode.uuid,c=n.path,h=this._bindingsByRootAndName,p=h[u],g=t[t.length-1],_=i._cacheIndex;g._cacheIndex=_,t[_]=g,t.pop(),delete p[c],Object.keys(p).length===0&&delete h[u]},_lendBinding:function(i){const t=this._bindings,n=i._cacheIndex,u=this._nActiveBindings++,c=t[u];i._cacheIndex=u,t[u]=i,c._cacheIndex=n,t[n]=c},_takeBackBinding:function(i){const t=this._bindings,n=i._cacheIndex,u=--this._nActiveBindings,c=t[u];i._cacheIndex=u,t[u]=i,c._cacheIndex=n,t[n]=c},_lendControlInterpolant:function(){const i=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=i[t];return n===void 0&&(n=new Cc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,i[t]=n),n},_takeBackControlInterpolant:function(i){const t=this._controlInterpolants,n=i.__cacheIndex,u=--this._nActiveControlInterpolants,c=t[u];i.__cacheIndex=u,t[u]=i,c.__cacheIndex=n,t[n]=c},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(i,t,n){const u=t||this._root,c=u.uuid;let h=typeof i=="string"?vr.findByName(u,i):i;const p=h!==null?h.uuid:i,g=this._actionsByClip[p];let _=null;if(n===void 0&&(h!==null?n=h.blendMode:n=qs),g!==void 0){const E=g.actionByRoot[c];if(E!==void 0&&E.blendMode===n)return E;_=g.knownActions[0],h===null&&(h=_._clip)}if(h===null)return null;const x=new H1(this,h,t,n);return this._bindAction(x,_),this._addInactiveAction(x,p,c),x},existingAction:function(i,t){const n=t||this._root,u=n.uuid,c=typeof i=="string"?vr.findByName(n,i):i,h=c?c.uuid:i,p=this._actionsByClip[h];return p!==void 0&&p.actionByRoot[u]||null},stopAllAction:function(){const i=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)i[n].stop();return this},update:function(i){i*=this.timeScale;const t=this._actions,n=this._nActiveActions,u=this.time+=i,c=Math.sign(i),h=this._accuIndex^=1;for(let _=0;_!==n;++_)t[_]._update(u,i,c,h);const p=this._bindings,g=this._nActiveBindings;for(let _=0;_!==g;++_)p[_].apply(h);return this},setTime:function(i){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(i)},getRoot:function(){return this._root},uncacheClip:function(i){const t=this._actions,n=i.uuid,u=this._actionsByClip,c=u[n];if(c!==void 0){const h=c.knownActions;for(let p=0,g=h.length;p!==g;++p){const _=h[p];this._deactivateAction(_);const x=_._cacheIndex,E=t[t.length-1];_._cacheIndex=null,_._byClipCacheIndex=null,E._cacheIndex=x,t[x]=E,t.pop(),this._removeInactiveBindingsForAction(_)}delete u[n]}},uncacheRoot:function(i){const t=i.uuid,n=this._actionsByClip;for(const h in n){const p=n[h].actionByRoot,g=p[t];g!==void 0&&(this._deactivateAction(g),this._removeInactiveAction(g))}const u=this._bindingsByRootAndName,c=u[t];if(c!==void 0)for(const h in c){const p=c[h];p.restoreOriginalState(),this._removeInactiveBinding(p)}},uncacheAction:function(i,t){const n=this.existingAction(i,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}});function jg(i,t,n){nr.call(this,i,t),this.meshPerAttribute=n||1}jg.prototype=J(Object.create(nr.prototype),{constructor:jg,isInstancedInterleavedBuffer:!0,copy:function(i){return nr.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){const t=nr.prototype.clone.call(this,i);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(i){const t=nr.prototype.toJSON.call(this,i);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}});function qg(i,t,n,u,c){this.buffer=i,this.type=t,this.itemSize=n,this.elementSize=u,this.count=c,this.version=0}Object.defineProperty(qg.prototype,"needsUpdate",{set:function(i){i===!0&&this.version++}}),J(qg.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,t){return this.type=i,this.elementSize=t,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}});function Xg(i,t,n,u){this.ray=new hs(i,t),this.near=n||0,this.far=u||1/0,this.camera=null,this.layers=new w,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Qg(i,t){return i.distance-t.distance}function Tf(i,t,n,u){if(i.layers.test(t.layers)&&i.raycast(t,n),u===!0){const c=i.children;for(let h=0,p=c.length;h<p;h++)Tf(c[h],t,n,!0)}}J(Xg.prototype,{set:function(i,t){this.ray.set(i,t)},setFromCamera:function(i,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(i,t,n){const u=n||[];return Tf(i,this,u,t),u.sort(Qg),u},intersectObjects:function(i,t,n){const u=n||[];if(Array.isArray(i)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),u;for(let c=0,h=i.length;c<h;c++)Tf(i[c],this,u,t);return u.sort(Qg),u}});class Yg{constructor(t=1,n=0,u=0){return this.radius=t,this.phi=n,this.theta=u,this}set(t,n,u){return this.radius=t,this.phi=n,this.theta=u,this}clone(){return new this.constructor().copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,n,u){return this.radius=Math.sqrt(t*t+n*n+u*u),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,u),this.phi=Math.acos(At.clamp(n/this.radius,-1,1))),this}}const Kg=new be;class V1{constructor(t,n){Object.defineProperty(this,"isBox2",{value:!0}),this.min=t!==void 0?t:new be(1/0,1/0),this.max=n!==void 0?n:new be(-1/0,-1/0)}set(t,n){return this.min.copy(t),this.max.copy(n),this}setFromPoints(t){this.makeEmpty();for(let n=0,u=t.length;n<u;n++)this.expandByPoint(t[n]);return this}setFromCenterAndSize(t,n){const u=Kg.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(u),this.max.copy(t).add(u),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new be),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new be),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,n){return n===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),n=new be),n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,n){return n===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),n=new be),n.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Kg.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function Oc(i){gt.call(this),this.material=i,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Oc.prototype=Object.create(gt.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isImmediateRenderObject=!0;const G1=new Dn({side:je,depthWrite:!1,depthTest:!1});new Ii(new El,G1),Tt.create=function(i,t){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(Tt.prototype),i.prototype.constructor=i,i.prototype.getPoint=t,i},J(Gr.prototype,{fromPoints:function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)}});function Zg(i){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),_r.call(this,i),this.type="catmullrom"}Zg.prototype=Object.create(_r.prototype),J(Zg.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),J(_i.prototype,{extractUrlBase:function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),E1.extractUrlBase(i)}}),_i.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},J(V1.prototype,{center:function(i){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(i)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(i){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},size:function(i){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(i)}}),J(Dr.prototype,{center:function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},isIntersectionSphere:function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)},size:function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)}}),J(sa.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),pc.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)},J(At,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(i){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),At.floorPowerOfTwo(i)},nextPowerOfTwo:function(i){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),At.ceilPowerOfTwo(i)}}),J(Ji.prototype,{flattenToArrayOffset:function(i,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,t)},multiplyVector3:function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()}}),J(Ut.prototype,{extractPosition:function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)},flattenToArrayOffset:function(i,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new te().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},multiplyVector4:function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)},crossVector:function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(i,t,n,u,c,h){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,t,u,n,c,h)},getInverse:function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()}}),tr.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)},J(Fi.prototype,{multiplyVector3:function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),J(hs.prototype,{isIntersectionBox:function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},isIntersectionPlane:function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)},isIntersectionSphere:function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)}}),J(yn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(i,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,t)},midpoint:function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)},normal:function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)},plane:function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)}}),J(yn,{barycoordFromPoint:function(i,t,n,u,c){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),yn.getBarycoord(i,t,n,u,c)},normal:function(i,t,n,u){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),yn.getNormal(i,t,n,u)}}),J(wo.prototype,{extractAllPoints:function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)},extrude:function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new xg(this,i)},makeGeometry:function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new c1(this,i)}}),J(be.prototype,{fromAttribute:function(i,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,n)},distanceToManhattan:function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),J(te.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)},getScaleFromMatrix:function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)},getColumnFromMatrix:function(i,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,i)},applyProjection:function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)},fromAttribute:function(i,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,n)},distanceToManhattan:function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),J(pi.prototype,{fromAttribute:function(i,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),J(gt.prototype,{getChildByName:function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(i,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,i)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.defineProperties(gt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),J(Ii.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Ii.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),ph},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(qh.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Yh.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Xh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Tt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}}),Qi.prototype.setLens=function(i,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(i)},Object.defineProperties(wi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}}),Object.defineProperties(Qt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===ka},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(ka)}}}),J(Qt.prototype,{setDynamic:function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?ka:Qs),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),J(mi.prototype,{addIndex:function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)},addAttribute:function(i,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new Qt(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(i,t)},addDrawCall:function(i,t,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)},applyMatrix:function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.defineProperties(mi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Dc.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}}),Object.defineProperties(Xg.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}}),Object.defineProperties(nr.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===ka},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}}),J(nr.prototype,{setDynamic:function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?ka:Qs),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),J(xg.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),J(Wm.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Lt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Mt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===Kt}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}}),Object.defineProperties(bs.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(xs.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}}),Object.defineProperties(_n.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}}),J(Dl.prototype,{clearTarget:function(i,t,n,u){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(t,n,u)},animate:function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Dl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?Ku:ls}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Vm.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(us.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}}),so.prototype.updateCubeMap=function(i,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,t)},so.prototype.clear=function(i,t,n,u){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,t,n,u)},Na.crossOrigin=void 0,Na.loadTexture=function(i,t,n,u){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const c=new cf;c.setCrossOrigin(this.crossOrigin);const h=c.load(i,n,void 0,u);return t&&(h.mapping=t),h},Na.loadTextureCube=function(i,t,n,u){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const c=new uf;c.setCrossOrigin(this.crossOrigin);const h=c.load(i,n,void 0,u);return t&&(h.mapping=t),h},Na.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Na.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:at}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=at);const z1=function(i,t){var n=this,u,c,h=new Ut,p=null;"VRFrameData"in window&&(p=new VRFrameData);function g(_){c=_,_.length>0?u=_[0]:t&&t("VR input not available.")}navigator.getVRDisplays&&navigator.getVRDisplays().then(g).catch(function(){console.warn("THREE.VRControls: Unable to get VR Displays")}),this.scale=1,this.standing=!1,this.userHeight=1.6,this.getVRDisplay=function(){return u},this.setVRDisplay=function(_){u=_},this.getVRDisplays=function(){return console.warn("THREE.VRControls: getVRDisplays() is being deprecated."),c},this.getStandingMatrix=function(){return h},this.update=function(){if(u){var _;u.getFrameData?(u.getFrameData(p),_=p.pose):u.getPose&&(_=u.getPose()),_.orientation!==null&&i.quaternion.fromArray(_.orientation),_.position!==null?i.position.fromArray(_.position):i.position.set(0,0,0),this.standing&&(u.stageParameters?(i.updateMatrix(),h.fromArray(u.stageParameters.sittingToStandingTransform),i.applyMatrix(h)):i.position.setY(i.position.y+this.userHeight)),i.position.multiplyScalar(n.scale)}},this.dispose=function(){u=null}},W1=function(i,t){var n,u,c=new te,h=new te,p,g,_=new Ut,x=new Ut,E=new Ut,S=null;"VRFrameData"in window&&(S=new window.VRFrameData);function C(he){u=he,he.length>0?n=he[0]:t&&t("HMD not available")}navigator.getVRDisplays&&navigator.getVRDisplays().then(C).catch(function(){console.warn("THREE.VREffect: Unable to get VR Displays")}),this.isPresenting=!1;var I=this,F=i.getSize(),z=!1,G=i.getPixelRatio();this.getVRDisplay=function(){return n},this.setVRDisplay=function(he){n=he},this.getVRDisplays=function(){return console.warn("THREE.VREffect: getVRDisplays() is being deprecated."),u},this.setSize=function(he,ce,pe){if(F={width:he,height:ce},z=pe,I.isPresenting){var Te=n.getEyeParameters("left");i.setPixelRatio(1),i.setSize(Te.renderWidth*2,Te.renderHeight,!1)}else i.setPixelRatio(G),i.setSize(he,ce,pe)};var k=i.domElement,O=[0,0,.5,1],se=[.5,0,.5,1];function oe(){var he=I.isPresenting;if(I.isPresenting=n!==void 0&&n.isPresenting,I.isPresenting){var ce=n.getEyeParameters("left"),pe=ce.renderWidth,Te=ce.renderHeight;he||(G=i.getPixelRatio(),F=i.getSize(),i.setPixelRatio(1),i.setSize(pe*2,Te,!1))}else he&&(i.setPixelRatio(G),i.setSize(F.width,F.height,z))}window.addEventListener("vrdisplaypresentchange",oe,!1),this.setFullScreen=function(he){return new Promise(function(ce,pe){if(n===void 0){pe(new Error("No VR hardware found."));return}if(I.isPresenting===he){ce();return}ce(he?n.requestPresent([{source:k}]):n.exitPresent())})},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)},this.requestAnimationFrame=function(he){return n!==void 0?n.requestAnimationFrame(he):window.requestAnimationFrame(he)},this.cancelAnimationFrame=function(he){n!==void 0?n.cancelAnimationFrame(he):window.cancelAnimationFrame(he)},this.submitFrame=function(){n!==void 0&&I.isPresenting&&n.submitFrame()},this.autoSubmitFrame=!0;var re=new Qi;re.layers.enable(1);var X=new Qi;X.layers.enable(2),this.render=function(he,ce,pe,Te){if(n&&I.isPresenting){var He=he.autoUpdate;He&&(he.updateMatrixWorld(),he.autoUpdate=!1),Array.isArray(he)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),he=he[0]);var Xe=i.getSize(),Qe=n.getLayers(),lt,rt;if(Qe.length){var Et=Qe[0];lt=Et.leftBounds!==null&&Et.leftBounds.length===4?Et.leftBounds:O,rt=Et.rightBounds!==null&&Et.rightBounds.length===4?Et.rightBounds:se}else lt=O,rt=se;if(p={x:Math.round(Xe.width*lt[0]),y:Math.round(Xe.height*lt[1]),width:Math.round(Xe.width*lt[2]),height:Math.round(Xe.height*lt[3])},g={x:Math.round(Xe.width*rt[0]),y:Math.round(Xe.height*rt[1]),width:Math.round(Xe.width*rt[2]),height:Math.round(Xe.height*rt[3])},pe?(i.setRenderTarget(pe),pe.scissorTest=!0):(i.setRenderTarget(null),i.setScissorTest(!0)),(i.autoClear||Te)&&i.clear(),ce.parent===null&&ce.updateMatrixWorld(),ce.matrixWorld.decompose(re.position,re.quaternion,re.scale),X.position.copy(re.position),X.quaternion.copy(re.quaternion),X.scale.copy(re.scale),n.getFrameData)n.depthNear=ce.near,n.depthFar=ce.far,n.getFrameData(S),re.projectionMatrix.elements=S.leftProjectionMatrix,X.projectionMatrix.elements=S.rightProjectionMatrix,xe(S),re.updateMatrix(),re.matrix.multiply(x),re.matrix.decompose(re.position,re.quaternion,re.scale),X.updateMatrix(),X.matrix.multiply(E),X.matrix.decompose(X.position,X.quaternion,X.scale);else{var Dt=n.getEyeParameters("left"),Ht=n.getEyeParameters("right");re.projectionMatrix=Re(Dt.fieldOfView,!0,ce.near,ce.far),X.projectionMatrix=Re(Ht.fieldOfView,!0,ce.near,ce.far),c.fromArray(Dt.offset),h.fromArray(Ht.offset),re.translateOnAxis(c,re.scale.x),X.translateOnAxis(h,X.scale.x)}pe?(pe.viewport.set(p.x,p.y,p.width,p.height),pe.scissor.set(p.x,p.y,p.width,p.height)):(i.setViewport(p.x,p.y,p.width,p.height),i.setScissor(p.x,p.y,p.width,p.height)),i.render(he,re,pe,Te),pe?(pe.viewport.set(g.x,g.y,g.width,g.height),pe.scissor.set(g.x,g.y,g.width,g.height)):(i.setViewport(g.x,g.y,g.width,g.height),i.setScissor(g.x,g.y,g.width,g.height)),i.render(he,X,pe,Te),pe?(pe.viewport.set(0,0,Xe.width,Xe.height),pe.scissor.set(0,0,Xe.width,Xe.height),pe.scissorTest=!1,i.setRenderTarget(null)):(i.setViewport(0,0,Xe.width,Xe.height),i.setScissorTest(!1)),He&&(he.autoUpdate=!0),I.autoSubmitFrame&&I.submitFrame();return}i.render(he,ce,pe,Te)},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",oe,!1)};var me=new Fi,ke=new te;function xe(he){he.pose.orientation?(me.fromArray(he.pose.orientation),_.makeRotationFromQuaternion(me)):_.identity(),he.pose.position&&(ke.fromArray(he.pose.position),_.setPosition(ke)),x.fromArray(he.leftViewMatrix),x.multiply(_),E.fromArray(he.rightViewMatrix),E.multiply(_),x.getInverse(x),E.getInverse(E)}function Se(he){var ce=2/(he.leftTan+he.rightTan),pe=(he.leftTan-he.rightTan)*ce*.5,Te=2/(he.upTan+he.downTan),He=(he.upTan-he.downTan)*Te*.5;return{scale:[ce,Te],offset:[pe,He]}}function we(he,ce,pe,Te){ce=ce===void 0?!0:ce,pe=pe===void 0?.01:pe,Te=Te===void 0?1e4:Te;var He=ce?-1:1,Xe=new Ut,Qe=Xe.elements,lt=Se(he);return Qe[0*4+0]=lt.scale[0],Qe[0*4+1]=0,Qe[0*4+2]=lt.offset[0]*He,Qe[0*4+3]=0,Qe[1*4+0]=0,Qe[1*4+1]=lt.scale[1],Qe[1*4+2]=-lt.offset[1]*He,Qe[1*4+3]=0,Qe[2*4+0]=0,Qe[2*4+1]=0,Qe[2*4+2]=Te/(pe-Te)*-He,Qe[2*4+3]=Te*pe/(pe-Te),Qe[3*4+0]=0,Qe[3*4+1]=0,Qe[3*4+2]=He,Qe[3*4+3]=0,Xe.transpose(),Xe}function Re(he,ce,pe,Te){var He=Math.PI/180,Xe={upTan:Math.tan(he.upDegrees*He),downTan:Math.tan(he.downDegrees*He),leftTan:Math.tan(he.leftDegrees*He),rightTan:Math.tan(he.rightDegrees*He)};return we(Xe,ce,pe,Te)}},Ql=function(i,t){this.object=i,this.domElement=t!==void 0?t:document,this.enabled=!0,this.target=new te,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:Me.LEFT,ZOOM:Me.MIDDLE,PAN:Me.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return x.phi},this.getAzimuthalAngle=function(){return x.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(u),n.update(),g=p.NONE},this.update=function(){var ve=new te,Ze=new Fi().setFromUnitVectors(i.up,new te(0,1,0)),$=Ze.clone().inverse(),Q=new te,Ue=new Fi;return function(){var le=n.object.position;return ve.copy(le).sub(n.target),ve.applyQuaternion(Ze),x.setFromVector3(ve),n.autoRotate&&g===p.NONE&&n.rotateLeft(me()),x.theta+=E.theta,x.phi+=E.phi,x.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,x.theta)),x.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,x.phi)),x.makeSafe(),x.radius*=S,x.radius=Math.max(n.minDistance,Math.min(n.maxDistance,x.radius)),n.target.add(C),ve.setFromSpherical(x),ve.applyQuaternion($),le.copy(n.target).add(ve),n.object.lookAt(n.target),n.enableDamping===!0?(E.theta*=1-n.dampingFactor,E.phi*=1-n.dampingFactor,C.multiplyScalar(1-n.dampingFactor)):(E.set(0,0,0),C.set(0,0,0)),S=1,I||Q.distanceToSquared(n.object.position)>_||8*(1-Ue.dot(n.object.quaternion))>_?(n.dispatchEvent(u),Q.copy(n.object.position),Ue.copy(n.object.quaternion),I=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",st,!1),n.domElement.removeEventListener("mousedown",zi,!1),n.domElement.removeEventListener("wheel",Rt,!1),n.domElement.removeEventListener("touchstart",kt,!1),n.domElement.removeEventListener("touchend",nt,!1),n.domElement.removeEventListener("touchmove",$e,!1),document.removeEventListener("mousemove",It,!1),document.removeEventListener("mouseup",qt,!1),window.removeEventListener("keydown",ti,!1)};var n=this,u={type:"change"},c={type:"start"},h={type:"end"},p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},g=p.NONE,_=1e-6,x=new Yg,E=new Yg,S=1,C=new te,I=!1,F=new be,z=new be,G=new be,k=new be,O=new be,se=new be,oe=new be,re=new be,X=new be;function me(){return 2*Math.PI/60/60*n.autoRotateSpeed}function ke(){return Math.pow(.95,n.zoomSpeed)}n.rotateLeft=function(Ze){E.theta-=Ze},n.rotateUp=function(Ze){E.phi-=Ze};var xe=function(){var ve=new te;return function($,Q){ve.setFromMatrixColumn(Q,0),ve.multiplyScalar(-$),C.add(ve)}}(),Se=function(){var ve=new te;return function($,Q){n.screenSpacePanning===!0?ve.setFromMatrixColumn(Q,1):(ve.setFromMatrixColumn(Q,0),ve.crossVectors(n.object.up,ve)),ve.multiplyScalar($),C.add(ve)}}(),we=function(){var ve=new te;return function($,Q){var Ue=n.domElement===document?n.domElement.body:n.domElement;if(n.object.isPerspectiveCamera){var Be=n.object.position;ve.copy(Be).sub(n.target);var le=ve.length();le*=Math.tan(n.object.fov/2*Math.PI/180),xe(2*$*le/Ue.clientHeight,n.object.matrix),Se(2*Q*le/Ue.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(xe($*(n.object.right-n.object.left)/n.object.zoom/Ue.clientWidth,n.object.matrix),Se(Q*(n.object.top-n.object.bottom)/n.object.zoom/Ue.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function Re(ve){n.object.isPerspectiveCamera?S/=ve:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*ve)),n.object.updateProjectionMatrix(),I=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function he(ve){n.object.isPerspectiveCamera?S*=ve:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/ve)),n.object.updateProjectionMatrix(),I=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ce(ve){F.set(ve.clientX,ve.clientY)}function pe(ve){oe.set(ve.clientX,ve.clientY)}function Te(ve){k.set(ve.clientX,ve.clientY)}function He(ve){z.set(ve.clientX,ve.clientY),G.subVectors(z,F).multiplyScalar(n.rotateSpeed);var Ze=n.domElement===document?n.domElement.body:n.domElement;n.rotateLeft(2*Math.PI*G.x/Ze.clientHeight),n.rotateUp(2*Math.PI*G.y/Ze.clientHeight),F.copy(z),n.update()}function Xe(ve){re.set(ve.clientX,ve.clientY),X.subVectors(re,oe),X.y>0?Re(ke()):X.y<0&&he(ke()),oe.copy(re),n.update()}function Qe(ve){O.set(ve.clientX,ve.clientY),se.subVectors(O,k).multiplyScalar(n.panSpeed),we(se.x,se.y),k.copy(O),n.update()}function lt(ve){ve.deltaY<0?he(ke()):ve.deltaY>0&&Re(ke()),n.update()}function rt(ve){switch(ve.keyCode){case n.keys.UP:we(0,n.keyPanSpeed),n.update();break;case n.keys.BOTTOM:we(0,-n.keyPanSpeed),n.update();break;case n.keys.LEFT:we(n.keyPanSpeed,0),n.update();break;case n.keys.RIGHT:we(-n.keyPanSpeed,0),n.update();break}}function Et(ve){F.set(ve.touches[0].pageX,ve.touches[0].pageY)}function Dt(ve){if(n.enableZoom){var Ze=ve.touches[0].pageX-ve.touches[1].pageX,$=ve.touches[0].pageY-ve.touches[1].pageY,Q=Math.sqrt(Ze*Ze+$*$);oe.set(0,Q)}if(n.enablePan){var Ue=.5*(ve.touches[0].pageX+ve.touches[1].pageX),Be=.5*(ve.touches[0].pageY+ve.touches[1].pageY);k.set(Ue,Be)}}function Ht(ve){z.set(ve.touches[0].pageX,ve.touches[0].pageY),G.subVectors(z,F).multiplyScalar(n.rotateSpeed);var Ze=n.domElement===document?n.domElement.body:n.domElement;n.rotateLeft(2*Math.PI*G.x/Ze.clientHeight),n.rotateUp(2*Math.PI*G.y/Ze.clientHeight),F.copy(z),n.update()}function Ve(ve){if(n.enableZoom){var Ze=ve.touches[0].pageX-ve.touches[1].pageX,$=ve.touches[0].pageY-ve.touches[1].pageY,Q=Math.sqrt(Ze*Ze+$*$);re.set(0,Q),X.set(0,Math.pow(re.y/oe.y,n.zoomSpeed)),Re(X.y),oe.copy(re)}if(n.enablePan){var Ue=.5*(ve.touches[0].pageX+ve.touches[1].pageX),Be=.5*(ve.touches[0].pageY+ve.touches[1].pageY);O.set(Ue,Be),se.subVectors(O,k).multiplyScalar(n.panSpeed),we(se.x,se.y),k.copy(O)}n.update()}function zi(ve){if(n.enabled!==!1){switch(ve.preventDefault(),ve.button){case n.mouseButtons.ORBIT:if(n.enableRotate===!1)return;ce(ve),g=p.ROTATE;break;case n.mouseButtons.ZOOM:if(n.enableZoom===!1)return;pe(ve),g=p.DOLLY;break;case n.mouseButtons.PAN:if(n.enablePan===!1)return;Te(ve),g=p.PAN;break}g!==p.NONE&&(document.addEventListener("mousemove",It,!1),document.addEventListener("mouseup",qt,!1),n.dispatchEvent(c))}}function It(ve){if(n.enabled!==!1)switch(ve.preventDefault(),g){case p.ROTATE:if(n.enableRotate===!1)return;He(ve);break;case p.DOLLY:if(n.enableZoom===!1)return;Xe(ve);break;case p.PAN:if(n.enablePan===!1)return;Qe(ve);break}}function qt(ve){n.enabled!==!1&&(document.removeEventListener("mousemove",It,!1),document.removeEventListener("mouseup",qt,!1),n.dispatchEvent(h),g=p.NONE)}function Rt(ve){n.enabled===!1||n.enableZoom===!1||g!==p.NONE&&g!==p.ROTATE||(ve.preventDefault(),ve.stopPropagation(),n.dispatchEvent(c),lt(ve),n.dispatchEvent(h))}function ti(ve){n.enabled===!1||n.enableKeys===!1||n.enablePan===!1||rt(ve)}function kt(ve){if(n.enabled!==!1){switch(ve.preventDefault(),ve.touches.length){case 1:if(n.enableRotate===!1)return;Et(ve),g=p.TOUCH_ROTATE;break;case 2:if(n.enableZoom===!1&&n.enablePan===!1)return;Dt(ve),g=p.TOUCH_DOLLY_PAN;break;default:g=p.NONE}g!==p.NONE&&n.dispatchEvent(c)}}function $e(ve){if(n.enabled!==!1)switch(ve.preventDefault(),ve.stopPropagation(),ve.touches.length){case 1:if(n.enableRotate===!1||g!==p.TOUCH_ROTATE)return;Ht(ve);break;case 2:if(n.enableZoom===!1&&n.enablePan===!1||g!==p.TOUCH_DOLLY_PAN)return;Ve(ve);break;default:g=p.NONE}}function nt(ve){n.enabled!==!1&&(n.dispatchEvent(h),g=p.NONE)}function st(ve){n.enabled!==!1&&ve.preventDefault()}n.domElement.addEventListener("mousedown",zi,!1),n.domElement.addEventListener("wheel",Rt,!1),n.domElement.addEventListener("touchstart",kt,!1),n.domElement.addEventListener("touchend",nt,!1),n.domElement.addEventListener("touchmove",$e,!1),window.addEventListener("keydown",ti,!1),this.update()};Ql.prototype=Object.create($n.prototype),Ql.prototype.constructor=Ql,Object.defineProperties(Ql.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(i){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!i}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(i){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!i}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(i){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!i}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(i){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!i}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(i){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!i}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(i){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=i}}});const j1=function(i){var t=this;this.object=i,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var n=function(h){t.deviceOrientation=h},u=function(){t.screenOrientation=window.orientation||0},c=function(){var h=new te(0,0,1),p=new y,g=new Fi,_=new Fi(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(x,E,S,C,I){p.set(S,E,-C,"YXZ"),x.setFromEuler(p),x.multiply(_),x.multiply(g.setFromAxisAngle(h,-I))}}();this.connect=function(){u(),window.addEventListener("orientationchange",u,!1),window.addEventListener("deviceorientation",n,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",u,!1),window.removeEventListener("deviceorientation",n,!1),t.enabled=!1},this.update=function(){if(t.enabled!==!1){var h=t.deviceOrientation;if(h){var p=h.alpha?At.degToRad(h.alpha)+t.alphaOffset:0,g=h.beta?At.degToRad(h.beta):0,_=h.gamma?At.degToRad(h.gamma):0,x=t.screenOrientation?At.degToRad(t.screenOrientation):0;c(t.object.quaternion,p,g,_,x)}}},this.dispose=function(){t.disconnect()},this.connect()};function q1(i,t,n,u){const c=i*t+n*u;if(c>.499){const S=2*Math.atan2(i,u),C=Math.PI/2,I=0;return new te(C,I,S)}if(c<-.499){const S=-2*Math.atan2(i,u),C=-Math.PI/2,I=0;return new te(C,I,S)}const h=i*i,p=t*t,g=n*n,_=Math.atan2(2*t*u-2*i*n,1-2*p-2*g),x=Math.asin(2*c),E=Math.atan2(2*i*u-2*t*n,1-2*h-2*g);return new te(x,E,_)}class X1{constructor(t){this.object=t.camera,this.domElement=t.canvas,this.orbit=new Ql(this.object,this.domElement),this.speed=.5,this.orbit.target.set(0,0,-1),this.orbit.enableZoom=!1,this.orbit.enablePan=!1,this.orbit.rotateSpeed=-this.speed,t.orientation&&(this.orientation=new j1(this.object)),t.halfView&&(this.orbit.minAzimuthAngle=-Math.PI/4,this.orbit.maxAzimuthAngle=Math.PI/4)}update(){if(this.orientation){this.orientation.update();const t=this.orientation.object.quaternion,n=q1(t.x,t.y,t.z,t.w);typeof this.lastAngle_>"u"&&(this.lastAngle_=n),this.orbit.rotateLeft((this.lastAngle_.z-n.z)*(1+this.speed)),this.orbit.rotateUp((this.lastAngle_.y-n.y)*(1+this.speed)),this.lastAngle_=n}this.orbit.update()}dispose(){this.orbit.dispose(),this.orientation&&this.orientation.dispose()}}const Q1=function(){const i=document.createElement("video");return i.crossOrigin="anonymous",i.hasAttribute("crossorigin")}(),Fc=["360","360_LR","360_TB","360_CUBE","EAC","EAC_LR","NONE","AUTO","Sphere","Cube","equirectangular","180","180_LR","180_MONO"],Af=function(i){if(i){if(i=i.toString().trim(),/sphere/i.test(i))return"360";if(/cube/i.test(i))return"360_CUBE";if(/equirectangular/i.test(i))return"360";for(let t=0;t<Fc.length;t++)if(new RegExp("^"+Fc[t]+"$","i").test(i))return Fc[t]}};class Y1 extends e.default.EventTarget{constructor(t,n,u){super(),this.player=t,this.canvas=n,this.options=u,this.onMoveEnd=e.default.bind(this,this.onMoveEnd),this.onMoveStart=e.default.bind(this,this.onMoveStart),this.onMove=e.default.bind(this,this.onMove),this.onControlBarMove=e.default.bind(this,this.onControlBarMove),this.player.controlBar.on(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],this.onControlBarMove),this.oldReportUserActivity=this.player.reportUserActivity,this.player.reportUserActivity=()=>{},this.canvas.addEventListener("mousedown",this.onMoveStart),this.canvas.addEventListener("touchstart",this.onMoveStart),this.canvas.addEventListener("mousemove",this.onMove),this.canvas.addEventListener("touchmove",this.onMove),this.canvas.addEventListener("mouseup",this.onMoveEnd),this.canvas.addEventListener("touchend",this.onMoveEnd),this.shouldTogglePlay=!1}togglePlay(){this.player.paused()?this.player.play():this.player.pause()}onMoveStart(t){if(this.options.disableTogglePlay||!this.player.controls()||t.type==="mousedown"&&!e.default.dom.isSingleLeftClick(t)){this.shouldTogglePlay=!1;return}this.shouldTogglePlay=!0,this.touchMoveCount_=0}onMoveEnd(t){if(t.type==="touchend"&&this.touchMoveCount_<10){if(this.player.userActive()===!1){this.player.userActive(!0);return}this.player.userActive(!1);return}this.shouldTogglePlay&&t.type==="mouseup"&&this.togglePlay()}onMove(t){this.touchMoveCount_++,this.shouldTogglePlay=!1}onControlBarMove(t){this.player.userActive(!0)}dispose(){this.canvas.removeEventListener("mousedown",this.onMoveStart),this.canvas.removeEventListener("touchstart",this.onMoveStart),this.canvas.removeEventListener("mousemove",this.onMove),this.canvas.removeEventListener("touchmove",this.onMove),this.canvas.removeEventListener("mouseup",this.onMoveEnd),this.canvas.removeEventListener("touchend",this.onMoveEnd),this.player.controlBar.off(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],this.onControlBarMove),this.player.reportUserActivity=this.oldReportUserActivity}}class K1 extends e.default.EventTarget{constructor(t,n,u,c){super();const h=e.default.mergeOptions({channelMap:e.default.browser.IS_SAFARI?[2,0,1,3]:[0,1,2,3],ambisonicOrder:1},c);this.videoElementSource=t.createMediaElementSource(u),this.foaRenderer=n.createFOARenderer(t,h),this.foaRenderer.initialize().then(()=>{t.state==="suspended"&&this.trigger({type:"audiocontext-suspended"}),this.videoElementSource.connect(this.foaRenderer.input),this.foaRenderer.output.connect(t.destination),this.initialized=!0,this.trigger({type:"omnitone-ready"})},p=>{e.default.log.warn(`videojs-vr: Omnitone initializes failed with the following error: ${p})`)})}update(t){this.initialized&&this.foaRenderer.setRotationMatrixFromCamera(t.matrix)}dispose(){this.initialized=!1,this.foaRenderer.setRenderingMode("bypass"),this.foaRenderer=null}}const Z1=e.default.getComponent("Button");class $1 extends Z1{constructor(t,n){super(t,n),this.handleVrDisplayActivate_=e.default.bind(this,this.handleVrDisplayActivate_),this.handleVrDisplayDeactivate_=e.default.bind(this,this.handleVrDisplayDeactivate_),this.handleVrDisplayPresentChange_=e.default.bind(this,this.handleVrDisplayPresentChange_),this.handleOrientationChange_=e.default.bind(this,this.handleOrientationChange_),window.addEventListener("orientationchange",this.handleOrientationChange_),window.addEventListener("vrdisplayactivate",this.handleVrDisplayActivate_),window.addEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_),window.addEventListener("vrdisplaypresentchange",this.handleVrDisplayPresentChange_),e.default.browser.IS_ANDROID&&this.on(t,"fullscreenchange",()=>{t.isFullscreen()?this.hide():this.show()})}buildCSSClass(){return`vjs-button-vr ${super.buildCSSClass()}`}handleVrDisplayPresentChange_(){!this.player_.vr().vrDisplay.isPresenting&&this.active_&&this.handleVrDisplayDeactivate_(),this.player_.vr().vrDisplay.isPresenting&&!this.active_&&this.handleVrDisplayActivate_()}handleOrientationChange_(){this.active_&&e.default.browser.IS_IOS&&this.changeSize_()}changeSize_(){this.player_.width(window.innerWidth),this.player_.height(window.innerHeight),window.dispatchEvent(new window.Event("resize"))}handleVrDisplayActivate_(){e.default.browser.IS_IOS&&(this.oldWidth_=this.player_.currentWidth(),this.oldHeight_=this.player_.currentHeight(),this.player_.enterFullWindow(),this.changeSize_()),this.active_=!0}handleVrDisplayDeactivate_(){e.default.browser.IS_IOS&&(this.oldWidth_&&this.player_.width(this.oldWidth_),this.oldHeight_&&this.player_.height(this.oldHeight_),this.player_.exitFullWindow()),this.active_=!1}handleClick(t){this.active_?window.dispatchEvent(new window.Event("vrdisplaydeactivate")):(!this.player_.hasStarted()&&e.default.browser.IS_ANDROID&&this.player_.play(),window.dispatchEvent(new window.Event("vrdisplayactivate")))}dispose(){super.dispose(),window.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_),window.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_),window.removeEventListener("vrdisplaypresentchange",this.handleVrDisplayPresentChange_)}}e.default.registerComponent("CardboardButton",$1);const J1=e.default.getComponent("BigPlayButton");class eS extends J1{buildCSSClass(){return`vjs-big-vr-play-button ${super.buildCSSClass()}`}}e.default.registerComponent("BigVrPlayButton",eS);const tS={debug:!1,omnitone:!1,forceCardboard:!1,omnitoneOptions:{},projection:"AUTO",sphereDetail:32,disableTogglePlay:!1},$g={"web-vr-out-of-date":{headline:"360 is out of date",type:"360_OUT_OF_DATE",message:"Your browser supports 360 but not the latest version. See <a href='http://webvr.info'>http://webvr.info</a> for more info."},"web-vr-not-supported":{headline:"360 not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser does not support 360. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."},"web-vr-hls-cors-not-supported":{headline:"360 HLS video not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser/device does not support HLS 360 video. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."}},iS=e.default.getPlugin("plugin"),Jg=e.default.getComponent("Component");class Yl extends iS{constructor(t,n){const u=e.default.mergeOptions(tS,n);if(super(t,u),this.options_=u,this.player_=t,this.bigPlayButtonIndex_=t.children().indexOf(t.getChild("BigPlayButton"))||0,this.videojsErrorsSupport_=!!e.default.errors,this.videojsErrorsSupport_&&t.errors({errors:$g}),e.default.browser.IE_VERSION||!Q1){this.player_.on("loadstart",()=>{this.triggerError_({code:"web-vr-not-supported",dismiss:!1})});return}this.polyfill_=new Y({ROTATE_INSTRUCTIONS_DISABLED:!0}),this.polyfill_=new Y,this.handleVrDisplayActivate_=e.default.bind(this,this.handleVrDisplayActivate_),this.handleVrDisplayDeactivate_=e.default.bind(this,this.handleVrDisplayDeactivate_),this.handleResize_=e.default.bind(this,this.handleResize_),this.animate_=e.default.bind(this,this.animate_),this.setProjection(this.options_.projection),this.on(t,"adstart",()=>t.setTimeout(()=>{if(!t.ads||!t.ads.videoElementRecycled()){this.log("video element not recycled for this ad, no need to reset");return}this.log("video element recycled for this ad, reseting"),this.reset(),this.one(t,"playing",this.init)}),1),this.on(t,"loadedmetadata",this.init)}changeProjection_(t){t=Af(t),t||(t="NONE");const n={x:0,y:0,z:0};if(this.scene&&this.scene.remove(this.movieScreen),t==="AUTO"){if(this.player_.mediainfo&&this.player_.mediainfo.projection&&this.player_.mediainfo.projection!=="AUTO"){const u=Af(this.player_.mediainfo.projection);return this.changeProjection_(u)}return this.changeProjection_("NONE")}else if(t==="360")this.movieGeometry=new Vl(256,this.options_.sphereDetail,this.options_.sphereDetail),this.movieMaterial=new Dn({map:this.videoTexture,overdraw:!0,side:je}),this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(n.x,n.y,n.z),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.scene.add(this.movieScreen);else if(t==="360_LR"||t==="360_TB"){let u=new Vl(256,this.options_.sphereDetail,this.options_.sphereDetail),c=u.faceVertexUvs[0];for(let h=0;h<c.length;h++)for(let p=0;p<3;p++)t==="360_LR"?c[h][p].x*=.5:(c[h][p].y*=.5,c[h][p].y+=.5);this.movieGeometry=new mi().fromGeometry(u),this.movieMaterial=new Dn({map:this.videoTexture,overdraw:!0,side:je}),this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),u=new Vl(256,this.options_.sphereDetail,this.options_.sphereDetail),c=u.faceVertexUvs[0];for(let h=0;h<c.length;h++)for(let p=0;p<3;p++)t==="360_LR"?(c[h][p].x*=.5,c[h][p].x+=.5):c[h][p].y*=.5;this.movieGeometry=new mi().fromGeometry(u),this.movieMaterial=new Dn({map:this.videoTexture,overdraw:!0,side:je}),this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if(t==="360_CUBE"){this.movieGeometry=new El(256,256,256),this.movieMaterial=new Dn({map:this.videoTexture,overdraw:!0,side:je});const u=[new be(0,.5),new be(.333,.5),new be(.333,1),new be(0,1)],c=[new be(.333,.5),new be(.666,.5),new be(.666,1),new be(.333,1)],h=[new be(.666,.5),new be(1,.5),new be(1,1),new be(.666,1)],p=[new be(0,0),new be(.333,0),new be(.333,.5),new be(0,.5)],g=[new be(.333,0),new be(.666,0),new be(.666,.5),new be(.333,.5)],_=[new be(.666,0),new be(1,0),new be(1,.5),new be(.666,.5)];this.movieGeometry.faceVertexUvs[0]=[],this.movieGeometry.faceVertexUvs[0][0]=[c[2],c[1],c[3]],this.movieGeometry.faceVertexUvs[0][1]=[c[1],c[0],c[3]],this.movieGeometry.faceVertexUvs[0][2]=[u[2],u[1],u[3]],this.movieGeometry.faceVertexUvs[0][3]=[u[1],u[0],u[3]],this.movieGeometry.faceVertexUvs[0][4]=[h[2],h[1],h[3]],this.movieGeometry.faceVertexUvs[0][5]=[h[1],h[0],h[3]],this.movieGeometry.faceVertexUvs[0][6]=[p[2],p[1],p[3]],this.movieGeometry.faceVertexUvs[0][7]=[p[1],p[0],p[3]],this.movieGeometry.faceVertexUvs[0][8]=[g[2],g[1],g[3]],this.movieGeometry.faceVertexUvs[0][9]=[g[1],g[0],g[3]],this.movieGeometry.faceVertexUvs[0][10]=[_[2],_[1],_[3]],this.movieGeometry.faceVertexUvs[0][11]=[_[1],_[0],_[3]],this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(n.x,n.y,n.z),this.movieScreen.rotation.y=-Math.PI,this.scene.add(this.movieScreen)}else if(t==="180"||t==="180_LR"||t==="180_MONO"){let u=new Vl(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI);u.scale(-1,1,1);let c=u.faceVertexUvs[0];if(t!=="180_MONO")for(let h=0;h<c.length;h++)for(let p=0;p<3;p++)c[h][p].x*=.5;this.movieGeometry=new mi().fromGeometry(u),this.movieMaterial=new Dn({map:this.videoTexture,overdraw:!0}),this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),u=new Vl(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI),u.scale(-1,1,1),c=u.faceVertexUvs[0];for(let h=0;h<c.length;h++)for(let p=0;p<3;p++)c[h][p].x*=.5,c[h][p].x+=.5;this.movieGeometry=new mi().fromGeometry(u),this.movieMaterial=new Dn({map:this.videoTexture,overdraw:!0}),this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if(t==="EAC"||t==="EAC_LR"){const u=(c,h)=>{this.movieGeometry=new El(256,256,256),this.movieMaterial=new _n({overdraw:!0,side:je,uniforms:{mapped:{value:this.videoTexture},mapMatrix:{value:c},contCorrect:{value:2},faceWH:{value:new be(.3333333333333333,.5).applyMatrix3(h)},vidWH:{value:new be(this.videoTexture.image.videoWidth,this.videoTexture.image.videoHeight).applyMatrix3(h)}},vertexShader:`
varying vec2 vUv;
uniform mat3 mapMatrix;

void main() {
  vUv = (mapMatrix * vec3(uv, 1.)).xy;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
}`,fragmentShader:`
varying vec2 vUv;
uniform sampler2D mapped;
uniform vec2 faceWH;
uniform vec2 vidWH;
uniform float contCorrect;

const float PI = 3.1415926535897932384626433832795;

void main() {
  vec2 corner = vUv - mod(vUv, faceWH) + vec2(0, contCorrect / vidWH.y);

  vec2 faceWHadj = faceWH - vec2(0, contCorrect * 2. / vidWH.y);

  vec2 p = (vUv - corner) / faceWHadj - .5;
  vec2 q = 2. / PI * atan(2. * p) + .5;

  vec2 eUv = corner + q * faceWHadj;

  gl_FragColor = texture2D(mapped, eUv);
}`});const g=[new be(0,1/2),new be(1/3,1/2),new be(1/3,1),new be(0,1)],_=[new be(1/3,1/2),new be(2/3,1/2),new be(2/3,1),new be(1/3,1)],x=[new be(2/3,1/2),new be(1,1/2),new be(1,1),new be(2/3,1)],E=[new be(1/3,0),new be(1/3,1/2),new be(0,1/2),new be(0,0)],S=[new be(1/3,1/2),new be(1/3,0),new be(2/3,0),new be(2/3,1/2)],C=[new be(1,0),new be(1,1/2),new be(2/3,1/2),new be(2/3,0)];for(const I of[g,_,x,E,S,C]){const F=this.videoTexture.image.videoHeight;let z=1,G=0;for(const k of I)k.y<z&&(z=k.y),k.y>G&&(G=k.y);for(const k of I)Math.abs(k.y-z)<Number.EPSILON&&(k.y+=2/F),Math.abs(k.y-G)<Number.EPSILON&&(k.y-=2/F),k.x=k.x/F*(F-4)+2/F}return this.movieGeometry.faceVertexUvs[0]=[],this.movieGeometry.faceVertexUvs[0][0]=[g[2],g[1],g[3]],this.movieGeometry.faceVertexUvs[0][1]=[g[1],g[0],g[3]],this.movieGeometry.faceVertexUvs[0][2]=[x[2],x[1],x[3]],this.movieGeometry.faceVertexUvs[0][3]=[x[1],x[0],x[3]],this.movieGeometry.faceVertexUvs[0][4]=[C[2],C[1],C[3]],this.movieGeometry.faceVertexUvs[0][5]=[C[1],C[0],C[3]],this.movieGeometry.faceVertexUvs[0][6]=[E[2],E[1],E[3]],this.movieGeometry.faceVertexUvs[0][7]=[E[1],E[0],E[3]],this.movieGeometry.faceVertexUvs[0][8]=[_[2],_[1],_[3]],this.movieGeometry.faceVertexUvs[0][9]=[_[1],_[0],_[3]],this.movieGeometry.faceVertexUvs[0][10]=[S[2],S[1],S[3]],this.movieGeometry.faceVertexUvs[0][11]=[S[1],S[0],S[3]],this.movieScreen=new Ii(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(n.x,n.y,n.z),this.movieScreen.rotation.y=-Math.PI,this.movieScreen};if(t==="EAC")this.scene.add(u(new Ji,new Ji));else{const c=new Ji().set(0,.5,0,1,0,0,0,0,1);u(new Ji().set(0,-.5,.5,1,0,0,0,0,1),c),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),u(new Ji().set(0,-.5,1,1,0,0,0,0,1),c),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}}this.currentProjection_=t}triggerError_(t){if(this.videojsErrorsSupport_)this.player_.error(t);else{const n=document.createElement("div");n.innerHTML=$g[t.code].message;const u=n.textContent||n.innerText||"";this.player_.error({code:t.code,message:u})}}log(...t){this.options_.debug&&t.forEach(n=>{e.default.log("VR: ",n)})}handleVrDisplayActivate_(){this.vrDisplay&&this.vrDisplay.requestPresent([{source:this.renderedCanvas}]).then(()=>{if(!this.vrDisplay.cardboardUI_||!e.default.browser.IS_IOS)return;let t=[];const n=c=>{for(let h=0;h<c.touches.length;h++)t.push(c.touches[h])},u=c=>{t.length&&(t.forEach(h=>{const p=new window.MouseEvent("click",{screenX:h.screenX,screenY:h.screenY,clientX:h.clientX,clientY:h.clientY});this.renderedCanvas.dispatchEvent(p)}),t=[])};this.renderedCanvas.addEventListener("touchstart",n),this.renderedCanvas.addEventListener("touchend",u),this.iosRevertTouchToClick_=()=>{this.renderedCanvas.removeEventListener("touchstart",n),this.renderedCanvas.removeEventListener("touchend",u),this.iosRevertTouchToClick_=null}})}handleVrDisplayDeactivate_(){!this.vrDisplay||!this.vrDisplay.isPresenting||(this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.vrDisplay.exitPresent())}requestAnimationFrame(t){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(t):this.player_.requestAnimationFrame(t)}cancelAnimationFrame(t){return this.vrDisplay?this.vrDisplay.cancelAnimationFrame(t):this.player_.cancelAnimationFrame(t)}togglePlay_(){this.player_.paused()?this.player_.play():this.player_.pause()}animate_(){if(this.initialized_){if(this.getVideoEl_().readyState===this.getVideoEl_().HAVE_ENOUGH_DATA&&this.videoTexture&&(this.videoTexture.needsUpdate=!0),this.controls3d.update(),this.omniController&&this.omniController.update(this.camera),this.effect.render(this.scene,this.camera),window.navigator.getGamepads){const t=window.navigator.getGamepads();for(let n=0;n<t.length;++n){const u=t[n];if(!(!u||!u.timestamp||u.timestamp===this.prevTimestamps_[n])){for(let c=0;c<u.buttons.length;++c)if(u.buttons[c].pressed){this.togglePlay_(),this.prevTimestamps_[n]=u.timestamp;break}}}}this.camera.getWorldDirection(this.cameraVector),this.animationFrameId_=this.requestAnimationFrame(this.animate_)}}handleResize_(){const t=this.player_.currentWidth(),n=this.player_.currentHeight();this.effect.setSize(t,n,!1),this.camera.aspect=t/n,this.camera.updateProjectionMatrix()}setProjection(t){if(!Af(t)){e.default.log.error("videojs-vr: please pass a valid projection "+Fc.join(", "));return}this.currentProjection_=t,this.defaultProjection_=t}init(){if(this.reset(),this.camera=new Qi(75,this.player_.currentWidth()/this.player_.currentHeight(),1,1e3),this.cameraVector=new te,(this.currentProjection_==="360_LR"||this.currentProjection_==="360_TB"||this.currentProjection_==="180"||this.currentProjection_==="180_LR"||this.currentProjection_==="180_MONO"||this.currentProjection_==="EAC_LR")&&this.camera.layers.enable(1),this.scene=new Wm,this.videoTexture=new $h(this.getVideoEl_()),this.videoTexture.generateMipmaps=!1,this.videoTexture.minFilter=qi,this.videoTexture.magFilter=qi,this.videoTexture.format=Bn,this.changeProjection_(this.currentProjection_),this.currentProjection_==="NONE"){this.log("Projection is NONE, dont init"),this.reset();return}this.player_.removeChild("BigPlayButton"),this.player_.addChild("BigVrPlayButton",{},this.bigPlayButtonIndex_),this.player_.bigPlayButton=this.player_.getChild("BigVrPlayButton"),(this.options_.forceCardboard||e.default.browser.IS_ANDROID||e.default.browser.IS_IOS)&&this.addCardboardButton_(),e.default.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.hide(),this.camera.position.set(0,0,0),this.renderer=new Dl({devicePixelRatio:window.devicePixelRatio,alpha:!1,clearColor:16777215,antialias:!0});const t=this.renderer.getContext("webgl"),n=t.texImage2D;t.texImage2D=(...c)=>{try{return n.apply(t,c)}catch(h){throw this.reset(),this.player_.pause(),this.triggerError_({code:"web-vr-hls-cors-not-supported",dismiss:!1}),new Error(h)}},this.renderer.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.effect=new W1(this.renderer),this.effect.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.vrDisplay=null,this.prevTimestamps_=[],this.renderedCanvas=this.renderer.domElement,this.renderedCanvas.setAttribute("style","width: 100%; height: 100%; position: absolute; top:0;");const u=this.getVideoEl_().style;if(this.player_.el().insertBefore(this.renderedCanvas,this.player_.el().firstChild),u.zIndex="-1",u.opacity="0",window.navigator.getVRDisplays?(this.log("is supported, getting vr displays"),window.navigator.getVRDisplays().then(c=>{if(c.length>0&&(this.log("Displays found",c),this.vrDisplay=c[0],this.vrDisplay.isPolyfilled||(this.log("Real HMD found using VRControls",this.vrDisplay),this.addCardboardButton_(),this.controls3d=new z1(this.camera))),!this.controls3d){this.log("no HMD found Using Orbit & Orientation Controls");const h={camera:this.camera,canvas:this.renderedCanvas,halfView:this.currentProjection_.indexOf("180")===0,orientation:e.default.browser.IS_IOS||e.default.browser.IS_ANDROID||!1};this.options_.motionControls===!1&&(h.orientation=!1),this.controls3d=new X1(h),this.canvasPlayerControls=new Y1(this.player_,this.renderedCanvas,this.options_)}this.animationFrameId_=this.requestAnimationFrame(this.animate_)})):window.navigator.getVRDevices?this.triggerError_({code:"web-vr-out-of-date",dismiss:!1}):this.triggerError_({code:"web-vr-not-supported",dismiss:!1}),this.options_.omnitone){const c=kg.getContext();this.omniController=new K1(c,this.options_.omnitone,this.getVideoEl_(),this.options_.omnitoneOptions),this.omniController.one("audiocontext-suspended",()=>{this.player.pause(),this.player.one("playing",()=>{c.resume()})})}this.on(this.player_,"fullscreenchange",this.handleResize_),window.addEventListener("vrdisplaypresentchange",this.handleResize_,!0),window.addEventListener("resize",this.handleResize_,!0),window.addEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),window.addEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.initialized_=!0,this.trigger("initialized")}addCardboardButton_(){this.player_.controlBar.getChild("CardboardButton")||this.player_.controlBar.addChild("CardboardButton",{})}getVideoEl_(){return this.player_.el().getElementsByTagName("video")[0]}reset(){if(!this.initialized_)return;this.omniController&&(this.omniController.off("audiocontext-suspended"),this.omniController.dispose(),this.omniController=void 0),this.controls3d&&(this.controls3d.dispose(),this.controls3d=null),this.canvasPlayerControls&&(this.canvasPlayerControls.dispose(),this.canvasPlayerControls=null),this.effect&&(this.effect.dispose(),this.effect=null),window.removeEventListener("resize",this.handleResize_,!0),window.removeEventListener("vrdisplaypresentchange",this.handleResize_,!0),window.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),window.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.player_.getChild("BigPlayButton")||this.player_.addChild("BigPlayButton",{},this.bigPlayButtonIndex_),this.player_.getChild("BigVrPlayButton")&&this.player_.removeChild("BigVrPlayButton"),this.player_.getChild("CardboardButton")&&this.player_.controlBar.removeChild("CardboardButton"),e.default.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.show();const t=this.getVideoEl_().style;t.zIndex="",t.opacity="",this.currentProjection_=this.defaultProjection_,this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.renderedCanvas&&this.renderedCanvas.parentNode.removeChild(this.renderedCanvas),this.animationFrameId_&&this.cancelAnimationFrame(this.animationFrameId_),this.initialized_=!1}dispose(){super.dispose(),this.reset()}polyfillVersion(){return Y.version}}return Yl.prototype.setTimeout=Jg.prototype.setTimeout,Yl.prototype.clearTimeout=Jg.prototype.clearTimeout,Yl.VERSION=r,e.default.registerPlugin("vr",Yl),Yl})}(Kc)),Kc.exports}var O_=r3();const a3=Xo(O_),o3=oS({__proto__:null,default:a3},[O_]);export{o3 as v};
